(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var s5=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function o5(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var a5={exports:{}},Zb={},l5={exports:{}},En={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var E1=Symbol.for("react.element"),P$=Symbol.for("react.portal"),R$=Symbol.for("react.fragment"),I$=Symbol.for("react.strict_mode"),L$=Symbol.for("react.profiler"),D$=Symbol.for("react.provider"),N$=Symbol.for("react.context"),F$=Symbol.for("react.forward_ref"),k$=Symbol.for("react.suspense"),U$=Symbol.for("react.memo"),O$=Symbol.for("react.lazy"),pL=Symbol.iterator;function B$(i){return i===null||typeof i!="object"?null:(i=pL&&i[pL]||i["@@iterator"],typeof i=="function"?i:null)}var c5={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},u5=Object.assign,h5={};function Sm(i,e,t){this.props=i,this.context=e,this.refs=h5,this.updater=t||c5}Sm.prototype.isReactComponent={};Sm.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};Sm.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function d5(){}d5.prototype=Sm.prototype;function oP(i,e,t){this.props=i,this.context=e,this.refs=h5,this.updater=t||c5}var aP=oP.prototype=new d5;aP.constructor=oP;u5(aP,Sm.prototype);aP.isPureReactComponent=!0;var mL=Array.isArray,f5=Object.prototype.hasOwnProperty,lP={current:null},p5={key:!0,ref:!0,__self:!0,__source:!0};function m5(i,e,t){var n,r={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)f5.call(e,n)&&!p5.hasOwnProperty(n)&&(r[n]=e[n]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(i&&i.defaultProps)for(n in a=i.defaultProps,a)r[n]===void 0&&(r[n]=a[n]);return{$$typeof:E1,type:i,key:s,ref:o,props:r,_owner:lP.current}}function z$(i,e){return{$$typeof:E1,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function cP(i){return typeof i=="object"&&i!==null&&i.$$typeof===E1}function G$(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var gL=/\/+/g;function iw(i,e){return typeof i=="object"&&i!==null&&i.key!=null?G$(""+i.key):e.toString(36)}function lx(i,e,t,n,r){var s=typeof i;(s==="undefined"||s==="boolean")&&(i=null);var o=!1;if(i===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(i.$$typeof){case E1:case P$:o=!0}}if(o)return o=i,r=r(o),i=n===""?"."+iw(o,0):n,mL(r)?(t="",i!=null&&(t=i.replace(gL,"$&/")+"/"),lx(r,e,t,"",function(c){return c})):r!=null&&(cP(r)&&(r=z$(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(gL,"$&/")+"/")+i)),e.push(r)),1;if(o=0,n=n===""?".":n+":",mL(i))for(var a=0;a<i.length;a++){s=i[a];var l=n+iw(s,a);o+=lx(s,e,t,l,r)}else if(l=B$(i),typeof l=="function")for(i=l.call(i),a=0;!(s=i.next()).done;)s=s.value,l=n+iw(s,a++),o+=lx(s,e,t,l,r);else if(s==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Wv(i,e,t){if(i==null)return i;var n=[],r=0;return lx(i,n,"","",function(s){return e.call(t,s,r++)}),n}function V$(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var Fs={current:null},cx={transition:null},H$={ReactCurrentDispatcher:Fs,ReactCurrentBatchConfig:cx,ReactCurrentOwner:lP};function g5(){throw Error("act(...) is not supported in production builds of React.")}En.Children={map:Wv,forEach:function(i,e,t){Wv(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return Wv(i,function(){e++}),e},toArray:function(i){return Wv(i,function(e){return e})||[]},only:function(i){if(!cP(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};En.Component=Sm;En.Fragment=R$;En.Profiler=L$;En.PureComponent=oP;En.StrictMode=I$;En.Suspense=k$;En.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H$;En.act=g5;En.cloneElement=function(i,e,t){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var n=u5({},i.props),r=i.key,s=i.ref,o=i._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=lP.current),e.key!==void 0&&(r=""+e.key),i.type&&i.type.defaultProps)var a=i.type.defaultProps;for(l in e)f5.call(e,l)&&!p5.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];n.children=a}return{$$typeof:E1,type:i.type,key:r,ref:s,props:n,_owner:o}};En.createContext=function(i){return i={$$typeof:N$,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:D$,_context:i},i.Consumer=i};En.createElement=m5;En.createFactory=function(i){var e=m5.bind(null,i);return e.type=i,e};En.createRef=function(){return{current:null}};En.forwardRef=function(i){return{$$typeof:F$,render:i}};En.isValidElement=cP;En.lazy=function(i){return{$$typeof:O$,_payload:{_status:-1,_result:i},_init:V$}};En.memo=function(i,e){return{$$typeof:U$,type:i,compare:e===void 0?null:e}};En.startTransition=function(i){var e=cx.transition;cx.transition={};try{i()}finally{cx.transition=e}};En.unstable_act=g5;En.useCallback=function(i,e){return Fs.current.useCallback(i,e)};En.useContext=function(i){return Fs.current.useContext(i)};En.useDebugValue=function(){};En.useDeferredValue=function(i){return Fs.current.useDeferredValue(i)};En.useEffect=function(i,e){return Fs.current.useEffect(i,e)};En.useId=function(){return Fs.current.useId()};En.useImperativeHandle=function(i,e,t){return Fs.current.useImperativeHandle(i,e,t)};En.useInsertionEffect=function(i,e){return Fs.current.useInsertionEffect(i,e)};En.useLayoutEffect=function(i,e){return Fs.current.useLayoutEffect(i,e)};En.useMemo=function(i,e){return Fs.current.useMemo(i,e)};En.useReducer=function(i,e,t){return Fs.current.useReducer(i,e,t)};En.useRef=function(i){return Fs.current.useRef(i)};En.useState=function(i){return Fs.current.useState(i)};En.useSyncExternalStore=function(i,e,t){return Fs.current.useSyncExternalStore(i,e,t)};En.useTransition=function(){return Fs.current.useTransition()};En.version="18.3.1";l5.exports=En;var Re=l5.exports;const $$=o5(Re);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W$=Re,j$=Symbol.for("react.element"),X$=Symbol.for("react.fragment"),q$=Object.prototype.hasOwnProperty,Y$=W$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,K$={key:!0,ref:!0,__self:!0,__source:!0};function v5(i,e,t){var n,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)q$.call(e,n)&&!K$.hasOwnProperty(n)&&(r[n]=e[n]);if(i&&i.defaultProps)for(n in e=i.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:j$,type:i,key:s,ref:o,props:r,_owner:Y$.current}}Zb.Fragment=X$;Zb.jsx=v5;Zb.jsxs=v5;a5.exports=Zb;var _e=a5.exports,_E={},_5={exports:{}},Do={},y5={exports:{}},x5={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(U,z){var O=U.length;U.push(z);e:for(;0<O;){var D=O-1>>>1,B=U[D];if(0<r(B,z))U[D]=z,U[O]=B,O=D;else break e}}function t(U){return U.length===0?null:U[0]}function n(U){if(U.length===0)return null;var z=U[0],O=U.pop();if(O!==z){U[0]=O;e:for(var D=0,B=U.length,W=B>>>1;D<W;){var q=2*(D+1)-1,j=U[q],te=q+1,ne=U[te];if(0>r(j,O))te<B&&0>r(ne,j)?(U[D]=ne,U[te]=O,D=te):(U[D]=j,U[q]=O,D=q);else if(te<B&&0>r(ne,O))U[D]=ne,U[te]=O,D=te;else break e}}return z}function r(U,z){var O=U.sortIndex-z.sortIndex;return O!==0?O:U.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(U){for(var z=t(c);z!==null;){if(z.callback===null)n(c);else if(z.startTime<=U)n(c),z.sortIndex=z.expirationTime,e(l,z);else break;z=t(c)}}function y(U){if(_=!1,m(U),!p)if(t(l)!==null)p=!0,V(A);else{var z=t(c);z!==null&&G(y,z.startTime-U)}}function A(U,z){p=!1,_&&(_=!1,g(T),T=-1),f=!0;var O=d;try{for(m(z),h=t(l);h!==null&&(!(h.expirationTime>z)||U&&!N());){var D=h.callback;if(typeof D=="function"){h.callback=null,d=h.priorityLevel;var B=D(h.expirationTime<=z);z=i.unstable_now(),typeof B=="function"?h.callback=B:h===t(l)&&n(l),m(z)}else n(l);h=t(l)}if(h!==null)var W=!0;else{var q=t(c);q!==null&&G(y,q.startTime-z),W=!1}return W}finally{h=null,d=O,f=!1}}var w=!1,M=null,T=-1,E=5,C=-1;function N(){return!(i.unstable_now()-C<E)}function P(){if(M!==null){var U=i.unstable_now();C=U;var z=!0;try{z=M(!0,U)}finally{z?L():(w=!1,M=null)}}else w=!1}var L;if(typeof b=="function")L=function(){b(P)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,F=R.port2;R.port1.onmessage=P,L=function(){F.postMessage(null)}}else L=function(){v(P,0)};function V(U){M=U,w||(w=!0,L())}function G(U,z){T=v(function(){U(i.unstable_now())},z)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(U){U.callback=null},i.unstable_continueExecution=function(){p||f||(p=!0,V(A))},i.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<U?Math.floor(1e3/U):5},i.unstable_getCurrentPriorityLevel=function(){return d},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(U){switch(d){case 1:case 2:case 3:var z=3;break;default:z=d}var O=d;d=z;try{return U()}finally{d=O}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(U,z){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var O=d;d=U;try{return z()}finally{d=O}},i.unstable_scheduleCallback=function(U,z,O){var D=i.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?D+O:D):O=D,U){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=O+B,U={id:u++,callback:z,priorityLevel:U,startTime:O,expirationTime:B,sortIndex:-1},O>D?(U.sortIndex=O,e(c,U),t(l)===null&&U===t(c)&&(_?(g(T),T=-1):_=!0,G(y,O-D))):(U.sortIndex=B,e(l,U),p||f||(p=!0,V(A))),U},i.unstable_shouldYield=N,i.unstable_wrapCallback=function(U){var z=d;return function(){var O=d;d=z;try{return U.apply(this,arguments)}finally{d=O}}}})(x5);y5.exports=x5;var Z$=y5.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q$=Re,Ro=Z$;function Pt(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var b5=new Set,k0={};function kd(i,e){qp(i,e),qp(i+"Capture",e)}function qp(i,e){for(k0[i]=e,i=0;i<e.length;i++)b5.add(e[i])}var gc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),yE=Object.prototype.hasOwnProperty,J$=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,vL={},_L={};function e7(i){return yE.call(_L,i)?!0:yE.call(vL,i)?!1:J$.test(i)?_L[i]=!0:(vL[i]=!0,!1)}function t7(i,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function n7(i,e,t,n){if(e===null||typeof e>"u"||t7(i,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ks(i,e,t,n,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Xr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Xr[i]=new ks(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];Xr[e]=new ks(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Xr[i]=new ks(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Xr[i]=new ks(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Xr[i]=new ks(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Xr[i]=new ks(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Xr[i]=new ks(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Xr[i]=new ks(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Xr[i]=new ks(i,5,!1,i.toLowerCase(),null,!1,!1)});var uP=/[\-:]([a-z])/g;function hP(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(uP,hP);Xr[e]=new ks(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(uP,hP);Xr[e]=new ks(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(uP,hP);Xr[e]=new ks(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Xr[i]=new ks(i,1,!1,i.toLowerCase(),null,!1,!1)});Xr.xlinkHref=new ks("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Xr[i]=new ks(i,1,!1,i.toLowerCase(),null,!0,!0)});function dP(i,e,t,n){var r=Xr.hasOwnProperty(e)?Xr[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(n7(e,t,r,n)&&(t=null),n||r===null?e7(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):r.mustUseProperty?i[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,n=r.attributeNamespace,t===null?i.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,n?i.setAttributeNS(n,e,t):i.setAttribute(e,t))))}var Tc=Q$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,jv=Symbol.for("react.element"),lp=Symbol.for("react.portal"),cp=Symbol.for("react.fragment"),fP=Symbol.for("react.strict_mode"),xE=Symbol.for("react.profiler"),S5=Symbol.for("react.provider"),w5=Symbol.for("react.context"),pP=Symbol.for("react.forward_ref"),bE=Symbol.for("react.suspense"),SE=Symbol.for("react.suspense_list"),mP=Symbol.for("react.memo"),su=Symbol.for("react.lazy"),M5=Symbol.for("react.offscreen"),yL=Symbol.iterator;function cg(i){return i===null||typeof i!="object"?null:(i=yL&&i[yL]||i["@@iterator"],typeof i=="function"?i:null)}var Di=Object.assign,rw;function Yg(i){if(rw===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);rw=e&&e[1]||""}return`
`+rw+i}var sw=!1;function ow(i,e){if(!i||sw)return"";sw=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var n=c}Reflect.construct(i,[],e)}else{try{e.call()}catch(c){n=c}i.call(e.prototype)}else{try{throw Error()}catch(c){n=c}i()}}catch(c){if(c&&n&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=n.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return i.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",i.displayName)),l}while(1<=o&&0<=a);break}}}finally{sw=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?Yg(i):""}function i7(i){switch(i.tag){case 5:return Yg(i.type);case 16:return Yg("Lazy");case 13:return Yg("Suspense");case 19:return Yg("SuspenseList");case 0:case 2:case 15:return i=ow(i.type,!1),i;case 11:return i=ow(i.type.render,!1),i;case 1:return i=ow(i.type,!0),i;default:return""}}function wE(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case cp:return"Fragment";case lp:return"Portal";case xE:return"Profiler";case fP:return"StrictMode";case bE:return"Suspense";case SE:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case w5:return(i.displayName||"Context")+".Consumer";case S5:return(i._context.displayName||"Context")+".Provider";case pP:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case mP:return e=i.displayName||null,e!==null?e:wE(i.type)||"Memo";case su:e=i._payload,i=i._init;try{return wE(i(e))}catch{}}return null}function r7(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return wE(e);case 8:return e===fP?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ku(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function A5(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function s7(i){var e=A5(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),n=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function Xv(i){i._valueTracker||(i._valueTracker=s7(i))}function E5(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return i&&(n=A5(i)?i.checked?"true":"false":i.value),i=n,i!==t?(e.setValue(i),!0):!1}function Xx(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function ME(i,e){var t=e.checked;return Di({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??i._wrapperState.initialChecked})}function xL(i,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=ku(e.value!=null?e.value:t),i._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function T5(i,e){e=e.checked,e!=null&&dP(i,"checked",e,!1)}function AE(i,e){T5(i,e);var t=ku(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(n==="submit"||n==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?EE(i,e.type,t):e.hasOwnProperty("defaultValue")&&EE(i,e.type,ku(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function bL(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function EE(i,e,t){(e!=="number"||Xx(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}var Kg=Array.isArray;function Lp(i,e,t,n){if(i=i.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<i.length;t++)r=e.hasOwnProperty("$"+i[t].value),i[t].selected!==r&&(i[t].selected=r),r&&n&&(i[t].defaultSelected=!0)}else{for(t=""+ku(t),e=null,r=0;r<i.length;r++){if(i[r].value===t){i[r].selected=!0,n&&(i[r].defaultSelected=!0);return}e!==null||i[r].disabled||(e=i[r])}e!==null&&(e.selected=!0)}}function TE(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Pt(91));return Di({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function SL(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Pt(92));if(Kg(t)){if(1<t.length)throw Error(Pt(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:ku(t)}}function C5(i,e){var t=ku(e.value),n=ku(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),n!=null&&(i.defaultValue=""+n)}function wL(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function P5(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function CE(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?P5(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var qv,R5=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return i(e,t,n,r)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(qv=qv||document.createElement("div"),qv.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=qv.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function U0(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var h0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},o7=["Webkit","ms","Moz","O"];Object.keys(h0).forEach(function(i){o7.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),h0[e]=h0[i]})});function I5(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||h0.hasOwnProperty(i)&&h0[i]?(""+e).trim():e+"px"}function L5(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,r=I5(t,e[t],n);t==="float"&&(t="cssFloat"),n?i.setProperty(t,r):i[t]=r}}var a7=Di({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function PE(i,e){if(e){if(a7[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Pt(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Pt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Pt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Pt(62))}}function RE(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var IE=null;function gP(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var LE=null,Dp=null,Np=null;function ML(i){if(i=P1(i)){if(typeof LE!="function")throw Error(Pt(280));var e=i.stateNode;e&&(e=nS(e),LE(i.stateNode,i.type,e))}}function D5(i){Dp?Np?Np.push(i):Np=[i]:Dp=i}function N5(){if(Dp){var i=Dp,e=Np;if(Np=Dp=null,ML(i),e)for(i=0;i<e.length;i++)ML(e[i])}}function F5(i,e){return i(e)}function k5(){}var aw=!1;function U5(i,e,t){if(aw)return i(e,t);aw=!0;try{return F5(i,e,t)}finally{aw=!1,(Dp!==null||Np!==null)&&(k5(),N5())}}function O0(i,e){var t=i.stateNode;if(t===null)return null;var n=nS(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(i=i.type,n=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!n;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(Pt(231,e,typeof t));return t}var DE=!1;if(gc)try{var ug={};Object.defineProperty(ug,"passive",{get:function(){DE=!0}}),window.addEventListener("test",ug,ug),window.removeEventListener("test",ug,ug)}catch{DE=!1}function l7(i,e,t,n,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var d0=!1,qx=null,Yx=!1,NE=null,c7={onError:function(i){d0=!0,qx=i}};function u7(i,e,t,n,r,s,o,a,l){d0=!1,qx=null,l7.apply(c7,arguments)}function h7(i,e,t,n,r,s,o,a,l){if(u7.apply(this,arguments),d0){if(d0){var c=qx;d0=!1,qx=null}else throw Error(Pt(198));Yx||(Yx=!0,NE=c)}}function Ud(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function O5(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function AL(i){if(Ud(i)!==i)throw Error(Pt(188))}function d7(i){var e=i.alternate;if(!e){if(e=Ud(i),e===null)throw Error(Pt(188));return e!==i?null:i}for(var t=i,n=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(n=r.return,n!==null){t=n;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return AL(r),i;if(s===n)return AL(r),e;s=s.sibling}throw Error(Pt(188))}if(t.return!==n.return)t=r,n=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,n=s;break}if(a===n){o=!0,n=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=r;break}if(a===n){o=!0,n=s,t=r;break}a=a.sibling}if(!o)throw Error(Pt(189))}}if(t.alternate!==n)throw Error(Pt(190))}if(t.tag!==3)throw Error(Pt(188));return t.stateNode.current===t?i:e}function B5(i){return i=d7(i),i!==null?z5(i):null}function z5(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=z5(i);if(e!==null)return e;i=i.sibling}return null}var G5=Ro.unstable_scheduleCallback,EL=Ro.unstable_cancelCallback,f7=Ro.unstable_shouldYield,p7=Ro.unstable_requestPaint,Ki=Ro.unstable_now,m7=Ro.unstable_getCurrentPriorityLevel,vP=Ro.unstable_ImmediatePriority,V5=Ro.unstable_UserBlockingPriority,Kx=Ro.unstable_NormalPriority,g7=Ro.unstable_LowPriority,H5=Ro.unstable_IdlePriority,Qb=null,dl=null;function v7(i){if(dl&&typeof dl.onCommitFiberRoot=="function")try{dl.onCommitFiberRoot(Qb,i,void 0,(i.current.flags&128)===128)}catch{}}var Ua=Math.clz32?Math.clz32:x7,_7=Math.log,y7=Math.LN2;function x7(i){return i>>>=0,i===0?32:31-(_7(i)/y7|0)|0}var Yv=64,Kv=4194304;function Zg(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Zx(i,e){var t=i.pendingLanes;if(t===0)return 0;var n=0,r=i.suspendedLanes,s=i.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?n=Zg(a):(s&=o,s!==0&&(n=Zg(s)))}else o=t&~r,o!==0?n=Zg(o):s!==0&&(n=Zg(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=n;0<e;)t=31-Ua(e),r=1<<t,n|=i[t],e&=~r;return n}function b7(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function S7(i,e){for(var t=i.suspendedLanes,n=i.pingedLanes,r=i.expirationTimes,s=i.pendingLanes;0<s;){var o=31-Ua(s),a=1<<o,l=r[o];l===-1?(!(a&t)||a&n)&&(r[o]=b7(a,e)):l<=e&&(i.expiredLanes|=a),s&=~a}}function FE(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function $5(){var i=Yv;return Yv<<=1,!(Yv&4194240)&&(Yv=64),i}function lw(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function T1(i,e,t){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-Ua(e),i[e]=t}function w7(i,e){var t=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var n=i.eventTimes;for(i=i.expirationTimes;0<t;){var r=31-Ua(t),s=1<<r;e[r]=0,n[r]=-1,i[r]=-1,t&=~s}}function _P(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var n=31-Ua(t),r=1<<n;r&e|i[n]&e&&(i[n]|=e),t&=~r}}var jn=0;function W5(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var j5,yP,X5,q5,Y5,kE=!1,Zv=[],yu=null,xu=null,bu=null,B0=new Map,z0=new Map,du=[],M7="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function TL(i,e){switch(i){case"focusin":case"focusout":yu=null;break;case"dragenter":case"dragleave":xu=null;break;case"mouseover":case"mouseout":bu=null;break;case"pointerover":case"pointerout":B0.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":z0.delete(e.pointerId)}}function hg(i,e,t,n,r,s){return i===null||i.nativeEvent!==s?(i={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},e!==null&&(e=P1(e),e!==null&&yP(e)),i):(i.eventSystemFlags|=n,e=i.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),i)}function A7(i,e,t,n,r){switch(e){case"focusin":return yu=hg(yu,i,e,t,n,r),!0;case"dragenter":return xu=hg(xu,i,e,t,n,r),!0;case"mouseover":return bu=hg(bu,i,e,t,n,r),!0;case"pointerover":var s=r.pointerId;return B0.set(s,hg(B0.get(s)||null,i,e,t,n,r)),!0;case"gotpointercapture":return s=r.pointerId,z0.set(s,hg(z0.get(s)||null,i,e,t,n,r)),!0}return!1}function K5(i){var e=qh(i.target);if(e!==null){var t=Ud(e);if(t!==null){if(e=t.tag,e===13){if(e=O5(t),e!==null){i.blockedOn=e,Y5(i.priority,function(){X5(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function ux(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=UE(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t===null){t=i.nativeEvent;var n=new t.constructor(t.type,t);IE=n,t.target.dispatchEvent(n),IE=null}else return e=P1(t),e!==null&&yP(e),i.blockedOn=t,!1;e.shift()}return!0}function CL(i,e,t){ux(i)&&t.delete(e)}function E7(){kE=!1,yu!==null&&ux(yu)&&(yu=null),xu!==null&&ux(xu)&&(xu=null),bu!==null&&ux(bu)&&(bu=null),B0.forEach(CL),z0.forEach(CL)}function dg(i,e){i.blockedOn===e&&(i.blockedOn=null,kE||(kE=!0,Ro.unstable_scheduleCallback(Ro.unstable_NormalPriority,E7)))}function G0(i){function e(r){return dg(r,i)}if(0<Zv.length){dg(Zv[0],i);for(var t=1;t<Zv.length;t++){var n=Zv[t];n.blockedOn===i&&(n.blockedOn=null)}}for(yu!==null&&dg(yu,i),xu!==null&&dg(xu,i),bu!==null&&dg(bu,i),B0.forEach(e),z0.forEach(e),t=0;t<du.length;t++)n=du[t],n.blockedOn===i&&(n.blockedOn=null);for(;0<du.length&&(t=du[0],t.blockedOn===null);)K5(t),t.blockedOn===null&&du.shift()}var Fp=Tc.ReactCurrentBatchConfig,Qx=!0;function T7(i,e,t,n){var r=jn,s=Fp.transition;Fp.transition=null;try{jn=1,xP(i,e,t,n)}finally{jn=r,Fp.transition=s}}function C7(i,e,t,n){var r=jn,s=Fp.transition;Fp.transition=null;try{jn=4,xP(i,e,t,n)}finally{jn=r,Fp.transition=s}}function xP(i,e,t,n){if(Qx){var r=UE(i,e,t,n);if(r===null)_w(i,e,n,Jx,t),TL(i,n);else if(A7(r,i,e,t,n))n.stopPropagation();else if(TL(i,n),e&4&&-1<M7.indexOf(i)){for(;r!==null;){var s=P1(r);if(s!==null&&j5(s),s=UE(i,e,t,n),s===null&&_w(i,e,n,Jx,t),s===r)break;r=s}r!==null&&n.stopPropagation()}else _w(i,e,n,null,t)}}var Jx=null;function UE(i,e,t,n){if(Jx=null,i=gP(n),i=qh(i),i!==null)if(e=Ud(i),e===null)i=null;else if(t=e.tag,t===13){if(i=O5(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return Jx=i,null}function Z5(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(m7()){case vP:return 1;case V5:return 4;case Kx:case g7:return 16;case H5:return 536870912;default:return 16}default:return 16}}var mu=null,bP=null,hx=null;function Q5(){if(hx)return hx;var i,e=bP,t=e.length,n,r="value"in mu?mu.value:mu.textContent,s=r.length;for(i=0;i<t&&e[i]===r[i];i++);var o=t-i;for(n=1;n<=o&&e[t-n]===r[s-n];n++);return hx=r.slice(i,1<n?1-n:void 0)}function dx(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function Qv(){return!0}function PL(){return!1}function No(i){function e(t,n,r,s,o){this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in i)i.hasOwnProperty(a)&&(t=i[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Qv:PL,this.isPropagationStopped=PL,this}return Di(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Qv)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Qv)},persist:function(){},isPersistent:Qv}),e}var wm={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},SP=No(wm),C1=Di({},wm,{view:0,detail:0}),P7=No(C1),cw,uw,fg,Jb=Di({},C1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wP,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==fg&&(fg&&i.type==="mousemove"?(cw=i.screenX-fg.screenX,uw=i.screenY-fg.screenY):uw=cw=0,fg=i),cw)},movementY:function(i){return"movementY"in i?i.movementY:uw}}),RL=No(Jb),R7=Di({},Jb,{dataTransfer:0}),I7=No(R7),L7=Di({},C1,{relatedTarget:0}),hw=No(L7),D7=Di({},wm,{animationName:0,elapsedTime:0,pseudoElement:0}),N7=No(D7),F7=Di({},wm,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),k7=No(F7),U7=Di({},wm,{data:0}),IL=No(U7),O7={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},B7={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},z7={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function G7(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=z7[i])?!!e[i]:!1}function wP(){return G7}var V7=Di({},C1,{key:function(i){if(i.key){var e=O7[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=dx(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?B7[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wP,charCode:function(i){return i.type==="keypress"?dx(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?dx(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),H7=No(V7),$7=Di({},Jb,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),LL=No($7),W7=Di({},C1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wP}),j7=No(W7),X7=Di({},wm,{propertyName:0,elapsedTime:0,pseudoElement:0}),q7=No(X7),Y7=Di({},Jb,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),K7=No(Y7),Z7=[9,13,27,32],MP=gc&&"CompositionEvent"in window,f0=null;gc&&"documentMode"in document&&(f0=document.documentMode);var Q7=gc&&"TextEvent"in window&&!f0,J5=gc&&(!MP||f0&&8<f0&&11>=f0),DL=" ",NL=!1;function eB(i,e){switch(i){case"keyup":return Z7.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tB(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var up=!1;function J7(i,e){switch(i){case"compositionend":return tB(e);case"keypress":return e.which!==32?null:(NL=!0,DL);case"textInput":return i=e.data,i===DL&&NL?null:i;default:return null}}function e9(i,e){if(up)return i==="compositionend"||!MP&&eB(i,e)?(i=Q5(),hx=bP=mu=null,up=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return J5&&e.locale!=="ko"?null:e.data;default:return null}}var t9={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function FL(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!t9[i.type]:e==="textarea"}function nB(i,e,t,n){D5(n),e=eb(e,"onChange"),0<e.length&&(t=new SP("onChange","change",null,t,n),i.push({event:t,listeners:e}))}var p0=null,V0=null;function n9(i){fB(i,0)}function eS(i){var e=fp(i);if(E5(e))return i}function i9(i,e){if(i==="change")return e}var iB=!1;if(gc){var dw;if(gc){var fw="oninput"in document;if(!fw){var kL=document.createElement("div");kL.setAttribute("oninput","return;"),fw=typeof kL.oninput=="function"}dw=fw}else dw=!1;iB=dw&&(!document.documentMode||9<document.documentMode)}function UL(){p0&&(p0.detachEvent("onpropertychange",rB),V0=p0=null)}function rB(i){if(i.propertyName==="value"&&eS(V0)){var e=[];nB(e,V0,i,gP(i)),U5(n9,e)}}function r9(i,e,t){i==="focusin"?(UL(),p0=e,V0=t,p0.attachEvent("onpropertychange",rB)):i==="focusout"&&UL()}function s9(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return eS(V0)}function o9(i,e){if(i==="click")return eS(e)}function a9(i,e){if(i==="input"||i==="change")return eS(e)}function l9(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var za=typeof Object.is=="function"?Object.is:l9;function H0(i,e){if(za(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var r=t[n];if(!yE.call(e,r)||!za(i[r],e[r]))return!1}return!0}function OL(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function BL(i,e){var t=OL(i);i=0;for(var n;t;){if(t.nodeType===3){if(n=i+t.textContent.length,i<=e&&n>=e)return{node:t,offset:e-i};i=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=OL(t)}}function sB(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?sB(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function oB(){for(var i=window,e=Xx();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=Xx(i.document)}return e}function AP(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function c9(i){var e=oB(),t=i.focusedElem,n=i.selectionRange;if(e!==t&&t&&t.ownerDocument&&sB(t.ownerDocument.documentElement,t)){if(n!==null&&AP(t)){if(e=n.start,i=n.end,i===void 0&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if(i=(e=t.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var r=t.textContent.length,s=Math.min(n.start,r);n=n.end===void 0?s:Math.min(n.end,r),!i.extend&&s>n&&(r=n,n=s,s=r),r=BL(t,s);var o=BL(t,n);r&&o&&(i.rangeCount!==1||i.anchorNode!==r.node||i.anchorOffset!==r.offset||i.focusNode!==o.node||i.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),i.removeAllRanges(),s>n?(i.addRange(e),i.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)i=e[t],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var u9=gc&&"documentMode"in document&&11>=document.documentMode,hp=null,OE=null,m0=null,BE=!1;function zL(i,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;BE||hp==null||hp!==Xx(n)||(n=hp,"selectionStart"in n&&AP(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),m0&&H0(m0,n)||(m0=n,n=eb(OE,"onSelect"),0<n.length&&(e=new SP("onSelect","select",null,e,t),i.push({event:e,listeners:n}),e.target=hp)))}function Jv(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var dp={animationend:Jv("Animation","AnimationEnd"),animationiteration:Jv("Animation","AnimationIteration"),animationstart:Jv("Animation","AnimationStart"),transitionend:Jv("Transition","TransitionEnd")},pw={},aB={};gc&&(aB=document.createElement("div").style,"AnimationEvent"in window||(delete dp.animationend.animation,delete dp.animationiteration.animation,delete dp.animationstart.animation),"TransitionEvent"in window||delete dp.transitionend.transition);function tS(i){if(pw[i])return pw[i];if(!dp[i])return i;var e=dp[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in aB)return pw[i]=e[t];return i}var lB=tS("animationend"),cB=tS("animationiteration"),uB=tS("animationstart"),hB=tS("transitionend"),dB=new Map,GL="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ju(i,e){dB.set(i,e),kd(e,[i])}for(var mw=0;mw<GL.length;mw++){var gw=GL[mw],h9=gw.toLowerCase(),d9=gw[0].toUpperCase()+gw.slice(1);ju(h9,"on"+d9)}ju(lB,"onAnimationEnd");ju(cB,"onAnimationIteration");ju(uB,"onAnimationStart");ju("dblclick","onDoubleClick");ju("focusin","onFocus");ju("focusout","onBlur");ju(hB,"onTransitionEnd");qp("onMouseEnter",["mouseout","mouseover"]);qp("onMouseLeave",["mouseout","mouseover"]);qp("onPointerEnter",["pointerout","pointerover"]);qp("onPointerLeave",["pointerout","pointerover"]);kd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));kd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));kd("onBeforeInput",["compositionend","keypress","textInput","paste"]);kd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));kd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));kd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f9=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qg));function VL(i,e,t){var n=i.type||"unknown-event";i.currentTarget=t,h7(n,e,void 0,i),i.currentTarget=null}function fB(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var n=i[t],r=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;VL(r,a,c),s=l}else for(o=0;o<n.length;o++){if(a=n[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;VL(r,a,c),s=l}}}if(Yx)throw i=NE,Yx=!1,NE=null,i}function oi(i,e){var t=e[$E];t===void 0&&(t=e[$E]=new Set);var n=i+"__bubble";t.has(n)||(pB(e,i,2,!1),t.add(n))}function vw(i,e,t){var n=0;e&&(n|=4),pB(t,i,n,e)}var e_="_reactListening"+Math.random().toString(36).slice(2);function $0(i){if(!i[e_]){i[e_]=!0,b5.forEach(function(t){t!=="selectionchange"&&(f9.has(t)||vw(t,!1,i),vw(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[e_]||(e[e_]=!0,vw("selectionchange",!1,e))}}function pB(i,e,t,n){switch(Z5(e)){case 1:var r=T7;break;case 4:r=C7;break;default:r=xP}t=r.bind(null,e,t,i),r=void 0,!DE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?i.addEventListener(e,t,{capture:!0,passive:r}):i.addEventListener(e,t,!0):r!==void 0?i.addEventListener(e,t,{passive:r}):i.addEventListener(e,t,!1)}function _w(i,e,t,n,r){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=n.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=qh(a),o===null)return;if(l=o.tag,l===5||l===6){n=s=o;continue e}a=a.parentNode}}n=n.return}U5(function(){var c=s,u=gP(t),h=[];e:{var d=dB.get(i);if(d!==void 0){var f=SP,p=i;switch(i){case"keypress":if(dx(t)===0)break e;case"keydown":case"keyup":f=H7;break;case"focusin":p="focus",f=hw;break;case"focusout":p="blur",f=hw;break;case"beforeblur":case"afterblur":f=hw;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=RL;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=I7;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=j7;break;case lB:case cB:case uB:f=N7;break;case hB:f=q7;break;case"scroll":f=P7;break;case"wheel":f=K7;break;case"copy":case"cut":case"paste":f=k7;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=LL}var _=(e&4)!==0,v=!_&&i==="scroll",g=_?d!==null?d+"Capture":null:d;_=[];for(var b=c,m;b!==null;){m=b;var y=m.stateNode;if(m.tag===5&&y!==null&&(m=y,g!==null&&(y=O0(b,g),y!=null&&_.push(W0(b,y,m)))),v)break;b=b.return}0<_.length&&(d=new f(d,p,null,t,u),h.push({event:d,listeners:_}))}}if(!(e&7)){e:{if(d=i==="mouseover"||i==="pointerover",f=i==="mouseout"||i==="pointerout",d&&t!==IE&&(p=t.relatedTarget||t.fromElement)&&(qh(p)||p[vc]))break e;if((f||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,f?(p=t.relatedTarget||t.toElement,f=c,p=p?qh(p):null,p!==null&&(v=Ud(p),p!==v||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(_=RL,y="onMouseLeave",g="onMouseEnter",b="mouse",(i==="pointerout"||i==="pointerover")&&(_=LL,y="onPointerLeave",g="onPointerEnter",b="pointer"),v=f==null?d:fp(f),m=p==null?d:fp(p),d=new _(y,b+"leave",f,t,u),d.target=v,d.relatedTarget=m,y=null,qh(u)===c&&(_=new _(g,b+"enter",p,t,u),_.target=m,_.relatedTarget=v,y=_),v=y,f&&p)t:{for(_=f,g=p,b=0,m=_;m;m=of(m))b++;for(m=0,y=g;y;y=of(y))m++;for(;0<b-m;)_=of(_),b--;for(;0<m-b;)g=of(g),m--;for(;b--;){if(_===g||g!==null&&_===g.alternate)break t;_=of(_),g=of(g)}_=null}else _=null;f!==null&&HL(h,d,f,_,!1),p!==null&&v!==null&&HL(h,v,p,_,!0)}}e:{if(d=c?fp(c):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var A=i9;else if(FL(d))if(iB)A=a9;else{A=s9;var w=r9}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(A=o9);if(A&&(A=A(i,c))){nB(h,A,t,u);break e}w&&w(i,d,c),i==="focusout"&&(w=d._wrapperState)&&w.controlled&&d.type==="number"&&EE(d,"number",d.value)}switch(w=c?fp(c):window,i){case"focusin":(FL(w)||w.contentEditable==="true")&&(hp=w,OE=c,m0=null);break;case"focusout":m0=OE=hp=null;break;case"mousedown":BE=!0;break;case"contextmenu":case"mouseup":case"dragend":BE=!1,zL(h,t,u);break;case"selectionchange":if(u9)break;case"keydown":case"keyup":zL(h,t,u)}var M;if(MP)e:{switch(i){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else up?eB(i,t)&&(T="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(T="onCompositionStart");T&&(J5&&t.locale!=="ko"&&(up||T!=="onCompositionStart"?T==="onCompositionEnd"&&up&&(M=Q5()):(mu=u,bP="value"in mu?mu.value:mu.textContent,up=!0)),w=eb(c,T),0<w.length&&(T=new IL(T,i,null,t,u),h.push({event:T,listeners:w}),M?T.data=M:(M=tB(t),M!==null&&(T.data=M)))),(M=Q7?J7(i,t):e9(i,t))&&(c=eb(c,"onBeforeInput"),0<c.length&&(u=new IL("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=M))}fB(h,e)})}function W0(i,e,t){return{instance:i,listener:e,currentTarget:t}}function eb(i,e){for(var t=e+"Capture",n=[];i!==null;){var r=i,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=O0(i,t),s!=null&&n.unshift(W0(i,s,r)),s=O0(i,e),s!=null&&n.push(W0(i,s,r))),i=i.return}return n}function of(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function HL(i,e,t,n,r){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&c!==null&&(a=c,r?(l=O0(t,s),l!=null&&o.unshift(W0(t,l,a))):r||(l=O0(t,s),l!=null&&o.push(W0(t,l,a)))),t=t.return}o.length!==0&&i.push({event:e,listeners:o})}var p9=/\r\n?/g,m9=/\u0000|\uFFFD/g;function $L(i){return(typeof i=="string"?i:""+i).replace(p9,`
`).replace(m9,"")}function t_(i,e,t){if(e=$L(e),$L(i)!==e&&t)throw Error(Pt(425))}function tb(){}var zE=null,GE=null;function VE(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var HE=typeof setTimeout=="function"?setTimeout:void 0,g9=typeof clearTimeout=="function"?clearTimeout:void 0,WL=typeof Promise=="function"?Promise:void 0,v9=typeof queueMicrotask=="function"?queueMicrotask:typeof WL<"u"?function(i){return WL.resolve(null).then(i).catch(_9)}:HE;function _9(i){setTimeout(function(){throw i})}function yw(i,e){var t=e,n=0;do{var r=t.nextSibling;if(i.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(n===0){i.removeChild(r),G0(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=r}while(t);G0(e)}function Su(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function jL(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var Mm=Math.random().toString(36).slice(2),al="__reactFiber$"+Mm,j0="__reactProps$"+Mm,vc="__reactContainer$"+Mm,$E="__reactEvents$"+Mm,y9="__reactListeners$"+Mm,x9="__reactHandles$"+Mm;function qh(i){var e=i[al];if(e)return e;for(var t=i.parentNode;t;){if(e=t[vc]||t[al]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=jL(i);i!==null;){if(t=i[al])return t;i=jL(i)}return e}i=t,t=i.parentNode}return null}function P1(i){return i=i[al]||i[vc],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function fp(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Pt(33))}function nS(i){return i[j0]||null}var WE=[],pp=-1;function Xu(i){return{current:i}}function di(i){0>pp||(i.current=WE[pp],WE[pp]=null,pp--)}function ni(i,e){pp++,WE[pp]=i.current,i.current=e}var Uu={},us=Xu(Uu),Js=Xu(!1),_d=Uu;function Yp(i,e){var t=i.type.contextTypes;if(!t)return Uu;var n=i.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=r),r}function eo(i){return i=i.childContextTypes,i!=null}function nb(){di(Js),di(us)}function XL(i,e,t){if(us.current!==Uu)throw Error(Pt(168));ni(us,e),ni(Js,t)}function mB(i,e,t){var n=i.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(Pt(108,r7(i)||"Unknown",r));return Di({},t,n)}function ib(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Uu,_d=us.current,ni(us,i),ni(Js,Js.current),!0}function qL(i,e,t){var n=i.stateNode;if(!n)throw Error(Pt(169));t?(i=mB(i,e,_d),n.__reactInternalMemoizedMergedChildContext=i,di(Js),di(us),ni(us,i)):di(Js),ni(Js,t)}var ic=null,iS=!1,xw=!1;function gB(i){ic===null?ic=[i]:ic.push(i)}function b9(i){iS=!0,gB(i)}function qu(){if(!xw&&ic!==null){xw=!0;var i=0,e=jn;try{var t=ic;for(jn=1;i<t.length;i++){var n=t[i];do n=n(!0);while(n!==null)}ic=null,iS=!1}catch(r){throw ic!==null&&(ic=ic.slice(i+1)),G5(vP,qu),r}finally{jn=e,xw=!1}}return null}var mp=[],gp=0,rb=null,sb=0,Qo=[],Jo=0,yd=null,oc=1,ac="";function Fh(i,e){mp[gp++]=sb,mp[gp++]=rb,rb=i,sb=e}function vB(i,e,t){Qo[Jo++]=oc,Qo[Jo++]=ac,Qo[Jo++]=yd,yd=i;var n=oc;i=ac;var r=32-Ua(n)-1;n&=~(1<<r),t+=1;var s=32-Ua(e)+r;if(30<s){var o=r-r%5;s=(n&(1<<o)-1).toString(32),n>>=o,r-=o,oc=1<<32-Ua(e)+r|t<<r|n,ac=s+i}else oc=1<<s|t<<r|n,ac=i}function EP(i){i.return!==null&&(Fh(i,1),vB(i,1,0))}function TP(i){for(;i===rb;)rb=mp[--gp],mp[gp]=null,sb=mp[--gp],mp[gp]=null;for(;i===yd;)yd=Qo[--Jo],Qo[Jo]=null,ac=Qo[--Jo],Qo[Jo]=null,oc=Qo[--Jo],Qo[Jo]=null}var Co=null,Eo=null,yi=!1,Ea=null;function _B(i,e){var t=ta(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=i,e=i.deletions,e===null?(i.deletions=[t],i.flags|=16):e.push(t)}function YL(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,Co=i,Eo=Su(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,Co=i,Eo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=yd!==null?{id:oc,overflow:ac}:null,i.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ta(18,null,null,0),t.stateNode=e,t.return=i,i.child=t,Co=i,Eo=null,!0):!1;default:return!1}}function jE(i){return(i.mode&1)!==0&&(i.flags&128)===0}function XE(i){if(yi){var e=Eo;if(e){var t=e;if(!YL(i,e)){if(jE(i))throw Error(Pt(418));e=Su(t.nextSibling);var n=Co;e&&YL(i,e)?_B(n,t):(i.flags=i.flags&-4097|2,yi=!1,Co=i)}}else{if(jE(i))throw Error(Pt(418));i.flags=i.flags&-4097|2,yi=!1,Co=i}}}function KL(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Co=i}function n_(i){if(i!==Co)return!1;if(!yi)return KL(i),yi=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!VE(i.type,i.memoizedProps)),e&&(e=Eo)){if(jE(i))throw yB(),Error(Pt(418));for(;e;)_B(i,e),e=Su(e.nextSibling)}if(KL(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Pt(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){Eo=Su(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}Eo=null}}else Eo=Co?Su(i.stateNode.nextSibling):null;return!0}function yB(){for(var i=Eo;i;)i=Su(i.nextSibling)}function Kp(){Eo=Co=null,yi=!1}function CP(i){Ea===null?Ea=[i]:Ea.push(i)}var S9=Tc.ReactCurrentBatchConfig;function pg(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Pt(309));var n=t.stateNode}if(!n)throw Error(Pt(147,i));var r=n,s=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof i!="string")throw Error(Pt(284));if(!t._owner)throw Error(Pt(290,i))}return i}function i_(i,e){throw i=Object.prototype.toString.call(e),Error(Pt(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function ZL(i){var e=i._init;return e(i._payload)}function xB(i){function e(g,b){if(i){var m=g.deletions;m===null?(g.deletions=[b],g.flags|=16):m.push(b)}}function t(g,b){if(!i)return null;for(;b!==null;)e(g,b),b=b.sibling;return null}function n(g,b){for(g=new Map;b!==null;)b.key!==null?g.set(b.key,b):g.set(b.index,b),b=b.sibling;return g}function r(g,b){return g=Eu(g,b),g.index=0,g.sibling=null,g}function s(g,b,m){return g.index=m,i?(m=g.alternate,m!==null?(m=m.index,m<b?(g.flags|=2,b):m):(g.flags|=2,b)):(g.flags|=1048576,b)}function o(g){return i&&g.alternate===null&&(g.flags|=2),g}function a(g,b,m,y){return b===null||b.tag!==6?(b=Tw(m,g.mode,y),b.return=g,b):(b=r(b,m),b.return=g,b)}function l(g,b,m,y){var A=m.type;return A===cp?u(g,b,m.props.children,y,m.key):b!==null&&(b.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===su&&ZL(A)===b.type)?(y=r(b,m.props),y.ref=pg(g,b,m),y.return=g,y):(y=yx(m.type,m.key,m.props,null,g.mode,y),y.ref=pg(g,b,m),y.return=g,y)}function c(g,b,m,y){return b===null||b.tag!==4||b.stateNode.containerInfo!==m.containerInfo||b.stateNode.implementation!==m.implementation?(b=Cw(m,g.mode,y),b.return=g,b):(b=r(b,m.children||[]),b.return=g,b)}function u(g,b,m,y,A){return b===null||b.tag!==7?(b=rd(m,g.mode,y,A),b.return=g,b):(b=r(b,m),b.return=g,b)}function h(g,b,m){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Tw(""+b,g.mode,m),b.return=g,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case jv:return m=yx(b.type,b.key,b.props,null,g.mode,m),m.ref=pg(g,null,b),m.return=g,m;case lp:return b=Cw(b,g.mode,m),b.return=g,b;case su:var y=b._init;return h(g,y(b._payload),m)}if(Kg(b)||cg(b))return b=rd(b,g.mode,m,null),b.return=g,b;i_(g,b)}return null}function d(g,b,m,y){var A=b!==null?b.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return A!==null?null:a(g,b,""+m,y);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case jv:return m.key===A?l(g,b,m,y):null;case lp:return m.key===A?c(g,b,m,y):null;case su:return A=m._init,d(g,b,A(m._payload),y)}if(Kg(m)||cg(m))return A!==null?null:u(g,b,m,y,null);i_(g,m)}return null}function f(g,b,m,y,A){if(typeof y=="string"&&y!==""||typeof y=="number")return g=g.get(m)||null,a(b,g,""+y,A);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case jv:return g=g.get(y.key===null?m:y.key)||null,l(b,g,y,A);case lp:return g=g.get(y.key===null?m:y.key)||null,c(b,g,y,A);case su:var w=y._init;return f(g,b,m,w(y._payload),A)}if(Kg(y)||cg(y))return g=g.get(m)||null,u(b,g,y,A,null);i_(b,y)}return null}function p(g,b,m,y){for(var A=null,w=null,M=b,T=b=0,E=null;M!==null&&T<m.length;T++){M.index>T?(E=M,M=null):E=M.sibling;var C=d(g,M,m[T],y);if(C===null){M===null&&(M=E);break}i&&M&&C.alternate===null&&e(g,M),b=s(C,b,T),w===null?A=C:w.sibling=C,w=C,M=E}if(T===m.length)return t(g,M),yi&&Fh(g,T),A;if(M===null){for(;T<m.length;T++)M=h(g,m[T],y),M!==null&&(b=s(M,b,T),w===null?A=M:w.sibling=M,w=M);return yi&&Fh(g,T),A}for(M=n(g,M);T<m.length;T++)E=f(M,g,T,m[T],y),E!==null&&(i&&E.alternate!==null&&M.delete(E.key===null?T:E.key),b=s(E,b,T),w===null?A=E:w.sibling=E,w=E);return i&&M.forEach(function(N){return e(g,N)}),yi&&Fh(g,T),A}function _(g,b,m,y){var A=cg(m);if(typeof A!="function")throw Error(Pt(150));if(m=A.call(m),m==null)throw Error(Pt(151));for(var w=A=null,M=b,T=b=0,E=null,C=m.next();M!==null&&!C.done;T++,C=m.next()){M.index>T?(E=M,M=null):E=M.sibling;var N=d(g,M,C.value,y);if(N===null){M===null&&(M=E);break}i&&M&&N.alternate===null&&e(g,M),b=s(N,b,T),w===null?A=N:w.sibling=N,w=N,M=E}if(C.done)return t(g,M),yi&&Fh(g,T),A;if(M===null){for(;!C.done;T++,C=m.next())C=h(g,C.value,y),C!==null&&(b=s(C,b,T),w===null?A=C:w.sibling=C,w=C);return yi&&Fh(g,T),A}for(M=n(g,M);!C.done;T++,C=m.next())C=f(M,g,T,C.value,y),C!==null&&(i&&C.alternate!==null&&M.delete(C.key===null?T:C.key),b=s(C,b,T),w===null?A=C:w.sibling=C,w=C);return i&&M.forEach(function(P){return e(g,P)}),yi&&Fh(g,T),A}function v(g,b,m,y){if(typeof m=="object"&&m!==null&&m.type===cp&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case jv:e:{for(var A=m.key,w=b;w!==null;){if(w.key===A){if(A=m.type,A===cp){if(w.tag===7){t(g,w.sibling),b=r(w,m.props.children),b.return=g,g=b;break e}}else if(w.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===su&&ZL(A)===w.type){t(g,w.sibling),b=r(w,m.props),b.ref=pg(g,w,m),b.return=g,g=b;break e}t(g,w);break}else e(g,w);w=w.sibling}m.type===cp?(b=rd(m.props.children,g.mode,y,m.key),b.return=g,g=b):(y=yx(m.type,m.key,m.props,null,g.mode,y),y.ref=pg(g,b,m),y.return=g,g=y)}return o(g);case lp:e:{for(w=m.key;b!==null;){if(b.key===w)if(b.tag===4&&b.stateNode.containerInfo===m.containerInfo&&b.stateNode.implementation===m.implementation){t(g,b.sibling),b=r(b,m.children||[]),b.return=g,g=b;break e}else{t(g,b);break}else e(g,b);b=b.sibling}b=Cw(m,g.mode,y),b.return=g,g=b}return o(g);case su:return w=m._init,v(g,b,w(m._payload),y)}if(Kg(m))return p(g,b,m,y);if(cg(m))return _(g,b,m,y);i_(g,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,b!==null&&b.tag===6?(t(g,b.sibling),b=r(b,m),b.return=g,g=b):(t(g,b),b=Tw(m,g.mode,y),b.return=g,g=b),o(g)):t(g,b)}return v}var Zp=xB(!0),bB=xB(!1),ob=Xu(null),ab=null,vp=null,PP=null;function RP(){PP=vp=ab=null}function IP(i){var e=ob.current;di(ob),i._currentValue=e}function qE(i,e,t){for(;i!==null;){var n=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),i===t)break;i=i.return}}function kp(i,e){ab=i,PP=vp=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(Qs=!0),i.firstContext=null)}function ra(i){var e=i._currentValue;if(PP!==i)if(i={context:i,memoizedValue:e,next:null},vp===null){if(ab===null)throw Error(Pt(308));vp=i,ab.dependencies={lanes:0,firstContext:i}}else vp=vp.next=i;return e}var Yh=null;function LP(i){Yh===null?Yh=[i]:Yh.push(i)}function SB(i,e,t,n){var r=e.interleaved;return r===null?(t.next=t,LP(e)):(t.next=r.next,r.next=t),e.interleaved=t,_c(i,n)}function _c(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}var ou=!1;function DP(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function wB(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function hc(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function wu(i,e,t){var n=i.updateQueue;if(n===null)return null;if(n=n.shared,In&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,_c(i,t)}return r=n.interleaved,r===null?(e.next=e,LP(n)):(e.next=r.next,r.next=e),n.interleaved=e,_c(i,t)}function fx(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,_P(i,t)}}function QL(i,e){var t=i.updateQueue,n=i.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function lb(i,e,t,n){var r=i.updateQueue;ou=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=i.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;o=0,u=c=l=null,a=s;do{var d=a.lane,f=a.eventTime;if((n&d)===d){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=i,_=a;switch(d=e,f=t,_.tag){case 1:if(p=_.payload,typeof p=="function"){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=_.payload,d=typeof p=="function"?p.call(f,h,d):p,d==null)break e;h=Di({},h,d);break e;case 2:ou=!0}}a.callback!==null&&a.lane!==0&&(i.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=h):u=u.next=f,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(u===null&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);bd|=o,i.lanes=o,i.memoizedState=h}}function JL(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var n=i[e],r=n.callback;if(r!==null){if(n.callback=null,n=t,typeof r!="function")throw Error(Pt(191,r));r.call(n)}}}var R1={},fl=Xu(R1),X0=Xu(R1),q0=Xu(R1);function Kh(i){if(i===R1)throw Error(Pt(174));return i}function NP(i,e){switch(ni(q0,e),ni(X0,i),ni(fl,R1),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:CE(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=CE(e,i)}di(fl),ni(fl,e)}function Qp(){di(fl),di(X0),di(q0)}function MB(i){Kh(q0.current);var e=Kh(fl.current),t=CE(e,i.type);e!==t&&(ni(X0,i),ni(fl,t))}function FP(i){X0.current===i&&(di(fl),di(X0))}var Ei=Xu(0);function cb(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var bw=[];function kP(){for(var i=0;i<bw.length;i++)bw[i]._workInProgressVersionPrimary=null;bw.length=0}var px=Tc.ReactCurrentDispatcher,Sw=Tc.ReactCurrentBatchConfig,xd=0,Ii=null,vr=null,Dr=null,ub=!1,g0=!1,Y0=0,w9=0;function es(){throw Error(Pt(321))}function UP(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!za(i[t],e[t]))return!1;return!0}function OP(i,e,t,n,r,s){if(xd=s,Ii=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,px.current=i===null||i.memoizedState===null?T9:C9,i=t(n,r),g0){s=0;do{if(g0=!1,Y0=0,25<=s)throw Error(Pt(301));s+=1,Dr=vr=null,e.updateQueue=null,px.current=P9,i=t(n,r)}while(g0)}if(px.current=hb,e=vr!==null&&vr.next!==null,xd=0,Dr=vr=Ii=null,ub=!1,e)throw Error(Pt(300));return i}function BP(){var i=Y0!==0;return Y0=0,i}function rl(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dr===null?Ii.memoizedState=Dr=i:Dr=Dr.next=i,Dr}function sa(){if(vr===null){var i=Ii.alternate;i=i!==null?i.memoizedState:null}else i=vr.next;var e=Dr===null?Ii.memoizedState:Dr.next;if(e!==null)Dr=e,vr=i;else{if(i===null)throw Error(Pt(310));vr=i,i={memoizedState:vr.memoizedState,baseState:vr.baseState,baseQueue:vr.baseQueue,queue:vr.queue,next:null},Dr===null?Ii.memoizedState=Dr=i:Dr=Dr.next=i}return Dr}function K0(i,e){return typeof e=="function"?e(i):e}function ww(i){var e=sa(),t=e.queue;if(t===null)throw Error(Pt(311));t.lastRenderedReducer=i;var n=vr,r=n.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}n.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,n=n.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((xd&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),n=c.hasEagerState?c.eagerState:i(n,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=n):l=l.next=h,Ii.lanes|=u,bd|=u}c=c.next}while(c!==null&&c!==s);l===null?o=n:l.next=a,za(n,e.memoizedState)||(Qs=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=l,t.lastRenderedState=n}if(i=t.interleaved,i!==null){r=i;do s=r.lane,Ii.lanes|=s,bd|=s,r=r.next;while(r!==i)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Mw(i){var e=sa(),t=e.queue;if(t===null)throw Error(Pt(311));t.lastRenderedReducer=i;var n=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=i(s,o.action),o=o.next;while(o!==r);za(s,e.memoizedState)||(Qs=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function AB(){}function EB(i,e){var t=Ii,n=sa(),r=e(),s=!za(n.memoizedState,r);if(s&&(n.memoizedState=r,Qs=!0),n=n.queue,zP(PB.bind(null,t,n,i),[i]),n.getSnapshot!==e||s||Dr!==null&&Dr.memoizedState.tag&1){if(t.flags|=2048,Z0(9,CB.bind(null,t,n,r,e),void 0,null),Fr===null)throw Error(Pt(349));xd&30||TB(t,e,r)}return r}function TB(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=Ii.updateQueue,e===null?(e={lastEffect:null,stores:null},Ii.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function CB(i,e,t,n){e.value=t,e.getSnapshot=n,RB(e)&&IB(i)}function PB(i,e,t){return t(function(){RB(e)&&IB(i)})}function RB(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!za(i,t)}catch{return!0}}function IB(i){var e=_c(i,1);e!==null&&Oa(e,i,1,-1)}function eD(i){var e=rl();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:K0,lastRenderedState:i},e.queue=i,i=i.dispatch=E9.bind(null,Ii,i),[e.memoizedState,i]}function Z0(i,e,t,n){return i={tag:i,create:e,destroy:t,deps:n,next:null},e=Ii.updateQueue,e===null?(e={lastEffect:null,stores:null},Ii.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(n=t.next,t.next=i,i.next=n,e.lastEffect=i)),i}function LB(){return sa().memoizedState}function mx(i,e,t,n){var r=rl();Ii.flags|=i,r.memoizedState=Z0(1|e,t,void 0,n===void 0?null:n)}function rS(i,e,t,n){var r=sa();n=n===void 0?null:n;var s=void 0;if(vr!==null){var o=vr.memoizedState;if(s=o.destroy,n!==null&&UP(n,o.deps)){r.memoizedState=Z0(e,t,s,n);return}}Ii.flags|=i,r.memoizedState=Z0(1|e,t,s,n)}function tD(i,e){return mx(8390656,8,i,e)}function zP(i,e){return rS(2048,8,i,e)}function DB(i,e){return rS(4,2,i,e)}function NB(i,e){return rS(4,4,i,e)}function FB(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function kB(i,e,t){return t=t!=null?t.concat([i]):null,rS(4,4,FB.bind(null,e,i),t)}function GP(){}function UB(i,e){var t=sa();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&UP(e,n[1])?n[0]:(t.memoizedState=[i,e],i)}function OB(i,e){var t=sa();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&UP(e,n[1])?n[0]:(i=i(),t.memoizedState=[i,e],i)}function BB(i,e,t){return xd&21?(za(t,e)||(t=$5(),Ii.lanes|=t,bd|=t,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,Qs=!0),i.memoizedState=t)}function M9(i,e){var t=jn;jn=t!==0&&4>t?t:4,i(!0);var n=Sw.transition;Sw.transition={};try{i(!1),e()}finally{jn=t,Sw.transition=n}}function zB(){return sa().memoizedState}function A9(i,e,t){var n=Au(i);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},GB(i))VB(e,t);else if(t=SB(i,e,t,n),t!==null){var r=Rs();Oa(t,i,n,r),HB(t,e,n)}}function E9(i,e,t){var n=Au(i),r={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(GB(i))VB(e,r);else{var s=i.alternate;if(i.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(r.hasEagerState=!0,r.eagerState=a,za(a,o)){var l=e.interleaved;l===null?(r.next=r,LP(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=SB(i,e,r,n),t!==null&&(r=Rs(),Oa(t,i,n,r),HB(t,e,n))}}function GB(i){var e=i.alternate;return i===Ii||e!==null&&e===Ii}function VB(i,e){g0=ub=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function HB(i,e,t){if(t&4194240){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,_P(i,t)}}var hb={readContext:ra,useCallback:es,useContext:es,useEffect:es,useImperativeHandle:es,useInsertionEffect:es,useLayoutEffect:es,useMemo:es,useReducer:es,useRef:es,useState:es,useDebugValue:es,useDeferredValue:es,useTransition:es,useMutableSource:es,useSyncExternalStore:es,useId:es,unstable_isNewReconciler:!1},T9={readContext:ra,useCallback:function(i,e){return rl().memoizedState=[i,e===void 0?null:e],i},useContext:ra,useEffect:tD,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,mx(4194308,4,FB.bind(null,e,i),t)},useLayoutEffect:function(i,e){return mx(4194308,4,i,e)},useInsertionEffect:function(i,e){return mx(4,2,i,e)},useMemo:function(i,e){var t=rl();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var n=rl();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},n.queue=i,i=i.dispatch=A9.bind(null,Ii,i),[n.memoizedState,i]},useRef:function(i){var e=rl();return i={current:i},e.memoizedState=i},useState:eD,useDebugValue:GP,useDeferredValue:function(i){return rl().memoizedState=i},useTransition:function(){var i=eD(!1),e=i[0];return i=M9.bind(null,i[1]),rl().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,t){var n=Ii,r=rl();if(yi){if(t===void 0)throw Error(Pt(407));t=t()}else{if(t=e(),Fr===null)throw Error(Pt(349));xd&30||TB(n,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,tD(PB.bind(null,n,s,i),[i]),n.flags|=2048,Z0(9,CB.bind(null,n,s,t,e),void 0,null),t},useId:function(){var i=rl(),e=Fr.identifierPrefix;if(yi){var t=ac,n=oc;t=(n&~(1<<32-Ua(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Y0++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=w9++,e=":"+e+"r"+t.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},C9={readContext:ra,useCallback:UB,useContext:ra,useEffect:zP,useImperativeHandle:kB,useInsertionEffect:DB,useLayoutEffect:NB,useMemo:OB,useReducer:ww,useRef:LB,useState:function(){return ww(K0)},useDebugValue:GP,useDeferredValue:function(i){var e=sa();return BB(e,vr.memoizedState,i)},useTransition:function(){var i=ww(K0)[0],e=sa().memoizedState;return[i,e]},useMutableSource:AB,useSyncExternalStore:EB,useId:zB,unstable_isNewReconciler:!1},P9={readContext:ra,useCallback:UB,useContext:ra,useEffect:zP,useImperativeHandle:kB,useInsertionEffect:DB,useLayoutEffect:NB,useMemo:OB,useReducer:Mw,useRef:LB,useState:function(){return Mw(K0)},useDebugValue:GP,useDeferredValue:function(i){var e=sa();return vr===null?e.memoizedState=i:BB(e,vr.memoizedState,i)},useTransition:function(){var i=Mw(K0)[0],e=sa().memoizedState;return[i,e]},useMutableSource:AB,useSyncExternalStore:EB,useId:zB,unstable_isNewReconciler:!1};function Sa(i,e){if(i&&i.defaultProps){e=Di({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}function YE(i,e,t,n){e=i.memoizedState,t=t(n,e),t=t==null?e:Di({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var sS={isMounted:function(i){return(i=i._reactInternals)?Ud(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var n=Rs(),r=Au(i),s=hc(n,r);s.payload=e,t!=null&&(s.callback=t),e=wu(i,s,r),e!==null&&(Oa(e,i,r,n),fx(e,i,r))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var n=Rs(),r=Au(i),s=hc(n,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=wu(i,s,r),e!==null&&(Oa(e,i,r,n),fx(e,i,r))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=Rs(),n=Au(i),r=hc(t,n);r.tag=2,e!=null&&(r.callback=e),e=wu(i,r,n),e!==null&&(Oa(e,i,n,t),fx(e,i,n))}};function nD(i,e,t,n,r,s,o){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!H0(t,n)||!H0(r,s):!0}function $B(i,e,t){var n=!1,r=Uu,s=e.contextType;return typeof s=="object"&&s!==null?s=ra(s):(r=eo(e)?_d:us.current,n=e.contextTypes,s=(n=n!=null)?Yp(i,r):Uu),e=new e(t,s),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=sS,i.stateNode=e,e._reactInternals=i,n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=s),e}function iD(i,e,t,n){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==i&&sS.enqueueReplaceState(e,e.state,null)}function KE(i,e,t,n){var r=i.stateNode;r.props=t,r.state=i.memoizedState,r.refs={},DP(i);var s=e.contextType;typeof s=="object"&&s!==null?r.context=ra(s):(s=eo(e)?_d:us.current,r.context=Yp(i,s)),r.state=i.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(YE(i,e,s,t),r.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&sS.enqueueReplaceState(r,r.state,null),lb(i,t,r,n),r.state=i.memoizedState),typeof r.componentDidMount=="function"&&(i.flags|=4194308)}function Jp(i,e){try{var t="",n=e;do t+=i7(n),n=n.return;while(n);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:i,source:e,stack:r,digest:null}}function Aw(i,e,t){return{value:i,source:null,stack:t??null,digest:e??null}}function ZE(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var R9=typeof WeakMap=="function"?WeakMap:Map;function WB(i,e,t){t=hc(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){fb||(fb=!0,aT=n),ZE(i,e)},t}function jB(i,e,t){t=hc(-1,t),t.tag=3;var n=i.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;t.payload=function(){return n(r)},t.callback=function(){ZE(i,e)}}var s=i.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){ZE(i,e),typeof n!="function"&&(Mu===null?Mu=new Set([this]):Mu.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function rD(i,e,t){var n=i.pingCache;if(n===null){n=i.pingCache=new R9;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(t)||(r.add(t),i=$9.bind(null,i,e,t),e.then(i,i))}function sD(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function oD(i,e,t,n,r){return i.mode&1?(i.flags|=65536,i.lanes=r,i):(i===e?i.flags|=65536:(i.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=hc(-1,1),e.tag=2,wu(t,e,1))),t.lanes|=1),i)}var I9=Tc.ReactCurrentOwner,Qs=!1;function Ts(i,e,t,n){e.child=i===null?bB(e,null,t,n):Zp(e,i.child,t,n)}function aD(i,e,t,n,r){t=t.render;var s=e.ref;return kp(e,r),n=OP(i,e,t,n,s,r),t=BP(),i!==null&&!Qs?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,yc(i,e,r)):(yi&&t&&EP(e),e.flags|=1,Ts(i,e,n,r),e.child)}function lD(i,e,t,n,r){if(i===null){var s=t.type;return typeof s=="function"&&!YP(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,XB(i,e,s,n,r)):(i=yx(t.type,null,n,e,e.mode,r),i.ref=e.ref,i.return=e,e.child=i)}if(s=i.child,!(i.lanes&r)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:H0,t(o,n)&&i.ref===e.ref)return yc(i,e,r)}return e.flags|=1,i=Eu(s,n),i.ref=e.ref,i.return=e,e.child=i}function XB(i,e,t,n,r){if(i!==null){var s=i.memoizedProps;if(H0(s,n)&&i.ref===e.ref)if(Qs=!1,e.pendingProps=n=s,(i.lanes&r)!==0)i.flags&131072&&(Qs=!0);else return e.lanes=i.lanes,yc(i,e,r)}return QE(i,e,t,n,r)}function qB(i,e,t){var n=e.pendingProps,r=n.children,s=i!==null?i.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ni(yp,wo),wo|=t;else{if(!(t&1073741824))return i=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,ni(yp,wo),wo|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,ni(yp,wo),wo|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,ni(yp,wo),wo|=n;return Ts(i,e,r,t),e.child}function YB(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function QE(i,e,t,n,r){var s=eo(t)?_d:us.current;return s=Yp(e,s),kp(e,r),t=OP(i,e,t,n,s,r),n=BP(),i!==null&&!Qs?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,yc(i,e,r)):(yi&&n&&EP(e),e.flags|=1,Ts(i,e,t,r),e.child)}function cD(i,e,t,n,r){if(eo(t)){var s=!0;ib(e)}else s=!1;if(kp(e,r),e.stateNode===null)gx(i,e),$B(e,t,n),KE(e,t,n,r),n=!0;else if(i===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=ra(c):(c=eo(t)?_d:us.current,c=Yp(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||l!==c)&&iD(e,o,n,c),ou=!1;var d=e.memoizedState;o.state=d,lb(e,n,o,r),l=e.memoizedState,a!==n||d!==l||Js.current||ou?(typeof u=="function"&&(YE(e,t,u,n),l=e.memoizedState),(a=ou||nD(e,t,a,n,d,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),o.props=n,o.state=l,o.context=c,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,wB(i,e),a=e.memoizedProps,c=e.type===e.elementType?a:Sa(e.type,a),o.props=c,h=e.pendingProps,d=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=ra(l):(l=eo(t)?_d:us.current,l=Yp(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&iD(e,o,n,l),ou=!1,d=e.memoizedState,o.state=d,lb(e,n,o,r);var p=e.memoizedState;a!==h||d!==p||Js.current||ou?(typeof f=="function"&&(YE(e,t,f,n),p=e.memoizedState),(c=ou||nD(e,t,c,n,d,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=p),o.props=n,o.state=p,o.context=l,n=c):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(e.flags|=1024),n=!1)}return JE(i,e,t,n,s,r)}function JE(i,e,t,n,r,s){YB(i,e);var o=(e.flags&128)!==0;if(!n&&!o)return r&&qL(e,t,!1),yc(i,e,s);n=e.stateNode,I9.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,i!==null&&o?(e.child=Zp(e,i.child,null,s),e.child=Zp(e,null,a,s)):Ts(i,e,a,s),e.memoizedState=n.state,r&&qL(e,t,!0),e.child}function KB(i){var e=i.stateNode;e.pendingContext?XL(i,e.pendingContext,e.pendingContext!==e.context):e.context&&XL(i,e.context,!1),NP(i,e.containerInfo)}function uD(i,e,t,n,r){return Kp(),CP(r),e.flags|=256,Ts(i,e,t,n),e.child}var eT={dehydrated:null,treeContext:null,retryLane:0};function tT(i){return{baseLanes:i,cachePool:null,transitions:null}}function ZB(i,e,t){var n=e.pendingProps,r=Ei.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=i!==null&&i.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(r|=1),ni(Ei,r&1),i===null)return XE(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,i=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=lS(o,n,0,null),i=rd(i,n,t,null),s.return=e,i.return=e,s.sibling=i,e.child=s,e.child.memoizedState=tT(t),e.memoizedState=eT,i):VP(e,o));if(r=i.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return L9(i,e,o,n,a,r,t);if(s){s=n.fallback,o=e.mode,r=i.child,a=r.sibling;var l={mode:"hidden",children:n.children};return!(o&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=Eu(r,l),n.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Eu(a,s):(s=rd(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=i.child.memoizedState,o=o===null?tT(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=i.childLanes&~t,e.memoizedState=eT,n}return s=i.child,i=s.sibling,n=Eu(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,i!==null&&(t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)),e.child=n,e.memoizedState=null,n}function VP(i,e){return e=lS({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function r_(i,e,t,n){return n!==null&&CP(n),Zp(e,i.child,null,t),i=VP(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function L9(i,e,t,n,r,s,o){if(t)return e.flags&256?(e.flags&=-257,n=Aw(Error(Pt(422))),r_(i,e,o,n)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(s=n.fallback,r=e.mode,n=lS({mode:"visible",children:n.children},r,0,null),s=rd(s,r,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&Zp(e,i.child,null,o),e.child.memoizedState=tT(o),e.memoizedState=eT,s);if(!(e.mode&1))return r_(i,e,o,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(Pt(419)),n=Aw(s,n,void 0),r_(i,e,o,n)}if(a=(o&i.childLanes)!==0,Qs||a){if(n=Fr,n!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,_c(i,r),Oa(n,i,r,-1))}return qP(),n=Aw(Error(Pt(421))),r_(i,e,o,n)}return r.data==="$?"?(e.flags|=128,e.child=i.child,e=W9.bind(null,i),r._reactRetry=e,null):(i=s.treeContext,Eo=Su(r.nextSibling),Co=e,yi=!0,Ea=null,i!==null&&(Qo[Jo++]=oc,Qo[Jo++]=ac,Qo[Jo++]=yd,oc=i.id,ac=i.overflow,yd=e),e=VP(e,n.children),e.flags|=4096,e)}function hD(i,e,t){i.lanes|=e;var n=i.alternate;n!==null&&(n.lanes|=e),qE(i.return,e,t)}function Ew(i,e,t,n,r){var s=i.memoizedState;s===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=r)}function QB(i,e,t){var n=e.pendingProps,r=n.revealOrder,s=n.tail;if(Ts(i,e,n.children,t),n=Ei.current,n&2)n=n&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&hD(i,t,e);else if(i.tag===19)hD(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}n&=1}if(ni(Ei,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)i=t.alternate,i!==null&&cb(i)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Ew(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(i=r.alternate,i!==null&&cb(i)===null){e.child=r;break}i=r.sibling,r.sibling=t,t=r,r=i}Ew(e,!0,t,null,s);break;case"together":Ew(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function gx(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function yc(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),bd|=e.lanes,!(t&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(Pt(153));if(e.child!==null){for(i=e.child,t=Eu(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=Eu(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function D9(i,e,t){switch(e.tag){case 3:KB(e),Kp();break;case 5:MB(e);break;case 1:eo(e.type)&&ib(e);break;case 4:NP(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;ni(ob,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(ni(Ei,Ei.current&1),e.flags|=128,null):t&e.child.childLanes?ZB(i,e,t):(ni(Ei,Ei.current&1),i=yc(i,e,t),i!==null?i.sibling:null);ni(Ei,Ei.current&1);break;case 19:if(n=(t&e.childLanes)!==0,i.flags&128){if(n)return QB(i,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ni(Ei,Ei.current),n)break;return null;case 22:case 23:return e.lanes=0,qB(i,e,t)}return yc(i,e,t)}var JB,nT,ez,tz;JB=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};nT=function(){};ez=function(i,e,t,n){var r=i.memoizedProps;if(r!==n){i=e.stateNode,Kh(fl.current);var s=null;switch(t){case"input":r=ME(i,r),n=ME(i,n),s=[];break;case"select":r=Di({},r,{value:void 0}),n=Di({},n,{value:void 0}),s=[];break;case"textarea":r=TE(i,r),n=TE(i,n),s=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(i.onclick=tb)}PE(t,n);var o;t=null;for(c in r)if(!n.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(k0.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in n){var l=n[c];if(a=r!=null?r[c]:void 0,n.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(k0.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&oi("scroll",i),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};tz=function(i,e,t,n){t!==n&&(e.flags|=4)};function mg(i,e){if(!yi)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:n.sibling=null}}function ts(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,n=0;if(e)for(var r=i.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=i,r=r.sibling;else for(r=i.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=i,r=r.sibling;return i.subtreeFlags|=n,i.childLanes=t,e}function N9(i,e,t){var n=e.pendingProps;switch(TP(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ts(e),null;case 1:return eo(e.type)&&nb(),ts(e),null;case 3:return n=e.stateNode,Qp(),di(Js),di(us),kP(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(i===null||i.child===null)&&(n_(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ea!==null&&(uT(Ea),Ea=null))),nT(i,e),ts(e),null;case 5:FP(e);var r=Kh(q0.current);if(t=e.type,i!==null&&e.stateNode!=null)ez(i,e,t,n,r),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Pt(166));return ts(e),null}if(i=Kh(fl.current),n_(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[al]=e,n[j0]=s,i=(e.mode&1)!==0,t){case"dialog":oi("cancel",n),oi("close",n);break;case"iframe":case"object":case"embed":oi("load",n);break;case"video":case"audio":for(r=0;r<Qg.length;r++)oi(Qg[r],n);break;case"source":oi("error",n);break;case"img":case"image":case"link":oi("error",n),oi("load",n);break;case"details":oi("toggle",n);break;case"input":xL(n,s),oi("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},oi("invalid",n);break;case"textarea":SL(n,s),oi("invalid",n)}PE(t,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&t_(n.textContent,a,i),r=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&t_(n.textContent,a,i),r=["children",""+a]):k0.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&oi("scroll",n)}switch(t){case"input":Xv(n),bL(n,s,!0);break;case"textarea":Xv(n),wL(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=tb)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=P5(t)),i==="http://www.w3.org/1999/xhtml"?t==="script"?(i=o.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof n.is=="string"?i=o.createElement(t,{is:n.is}):(i=o.createElement(t),t==="select"&&(o=i,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):i=o.createElementNS(i,t),i[al]=e,i[j0]=n,JB(i,e,!1,!1),e.stateNode=i;e:{switch(o=RE(t,n),t){case"dialog":oi("cancel",i),oi("close",i),r=n;break;case"iframe":case"object":case"embed":oi("load",i),r=n;break;case"video":case"audio":for(r=0;r<Qg.length;r++)oi(Qg[r],i);r=n;break;case"source":oi("error",i),r=n;break;case"img":case"image":case"link":oi("error",i),oi("load",i),r=n;break;case"details":oi("toggle",i),r=n;break;case"input":xL(i,n),r=ME(i,n),oi("invalid",i);break;case"option":r=n;break;case"select":i._wrapperState={wasMultiple:!!n.multiple},r=Di({},n,{value:void 0}),oi("invalid",i);break;case"textarea":SL(i,n),r=TE(i,n),oi("invalid",i);break;default:r=n}PE(t,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?L5(i,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&R5(i,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&U0(i,l):typeof l=="number"&&U0(i,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(k0.hasOwnProperty(s)?l!=null&&s==="onScroll"&&oi("scroll",i):l!=null&&dP(i,s,l,o))}switch(t){case"input":Xv(i),bL(i,n,!1);break;case"textarea":Xv(i),wL(i);break;case"option":n.value!=null&&i.setAttribute("value",""+ku(n.value));break;case"select":i.multiple=!!n.multiple,s=n.value,s!=null?Lp(i,!!n.multiple,s,!1):n.defaultValue!=null&&Lp(i,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(i.onclick=tb)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ts(e),null;case 6:if(i&&e.stateNode!=null)tz(i,e,i.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Pt(166));if(t=Kh(q0.current),Kh(fl.current),n_(e)){if(n=e.stateNode,t=e.memoizedProps,n[al]=e,(s=n.nodeValue!==t)&&(i=Co,i!==null))switch(i.tag){case 3:t_(n.nodeValue,t,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&t_(n.nodeValue,t,(i.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[al]=e,e.stateNode=n}return ts(e),null;case 13:if(di(Ei),n=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(yi&&Eo!==null&&e.mode&1&&!(e.flags&128))yB(),Kp(),e.flags|=98560,s=!1;else if(s=n_(e),n!==null&&n.dehydrated!==null){if(i===null){if(!s)throw Error(Pt(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Pt(317));s[al]=e}else Kp(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ts(e),s=!1}else Ea!==null&&(uT(Ea),Ea=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(i!==null&&i.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(i===null||Ei.current&1?yr===0&&(yr=3):qP())),e.updateQueue!==null&&(e.flags|=4),ts(e),null);case 4:return Qp(),nT(i,e),i===null&&$0(e.stateNode.containerInfo),ts(e),null;case 10:return IP(e.type._context),ts(e),null;case 17:return eo(e.type)&&nb(),ts(e),null;case 19:if(di(Ei),s=e.memoizedState,s===null)return ts(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)mg(s,!1);else{if(yr!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(o=cb(i),o!==null){for(e.flags|=128,mg(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,i=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,i=o.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return ni(Ei,Ei.current&1|2),e.child}i=i.sibling}s.tail!==null&&Ki()>em&&(e.flags|=128,n=!0,mg(s,!1),e.lanes=4194304)}else{if(!n)if(i=cb(o),i!==null){if(e.flags|=128,n=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),mg(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!yi)return ts(e),null}else 2*Ki()-s.renderingStartTime>em&&t!==1073741824&&(e.flags|=128,n=!0,mg(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ki(),e.sibling=null,t=Ei.current,ni(Ei,n?t&1|2:t&1),e):(ts(e),null);case 22:case 23:return XP(),n=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?wo&1073741824&&(ts(e),e.subtreeFlags&6&&(e.flags|=8192)):ts(e),null;case 24:return null;case 25:return null}throw Error(Pt(156,e.tag))}function F9(i,e){switch(TP(e),e.tag){case 1:return eo(e.type)&&nb(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Qp(),di(Js),di(us),kP(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return FP(e),null;case 13:if(di(Ei),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(Pt(340));Kp()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return di(Ei),null;case 4:return Qp(),null;case 10:return IP(e.type._context),null;case 22:case 23:return XP(),null;case 24:return null;default:return null}}var s_=!1,ls=!1,k9=typeof WeakSet=="function"?WeakSet:Set,Vt=null;function _p(i,e){var t=i.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Bi(i,e,n)}else t.current=null}function iT(i,e,t){try{t()}catch(n){Bi(i,e,n)}}var dD=!1;function U9(i,e){if(zE=Qx,i=oB(),AP(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var r=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=i,d=null;t:for(;;){for(var f;h!==t||r!==0&&h.nodeType!==3||(a=o+r),h!==s||n!==0&&h.nodeType!==3||(l=o+n),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===i)break t;if(d===t&&++c===r&&(a=o),d===s&&++u===n&&(l=o),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(GE={focusedElem:i,selectionRange:t},Qx=!1,Vt=e;Vt!==null;)if(e=Vt,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,Vt=i;else for(;Vt!==null;){e=Vt;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var _=p.memoizedProps,v=p.memoizedState,g=e.stateNode,b=g.getSnapshotBeforeUpdate(e.elementType===e.type?_:Sa(e.type,_),v);g.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var m=e.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Pt(163))}}catch(y){Bi(e,e.return,y)}if(i=e.sibling,i!==null){i.return=e.return,Vt=i;break}Vt=e.return}return p=dD,dD=!1,p}function v0(i,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&i)===i){var s=r.destroy;r.destroy=void 0,s!==void 0&&iT(e,t,s)}r=r.next}while(r!==n)}}function oS(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&i)===i){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function rT(i){var e=i.ref;if(e!==null){var t=i.stateNode;switch(i.tag){case 5:i=t;break;default:i=t}typeof e=="function"?e(i):e.current=i}}function nz(i){var e=i.alternate;e!==null&&(i.alternate=null,nz(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[al],delete e[j0],delete e[$E],delete e[y9],delete e[x9])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function iz(i){return i.tag===5||i.tag===3||i.tag===4}function fD(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||iz(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function sT(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=tb));else if(n!==4&&(i=i.child,i!==null))for(sT(i,e,t),i=i.sibling;i!==null;)sT(i,e,t),i=i.sibling}function oT(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(n!==4&&(i=i.child,i!==null))for(oT(i,e,t),i=i.sibling;i!==null;)oT(i,e,t),i=i.sibling}var Vr=null,Ma=!1;function Gc(i,e,t){for(t=t.child;t!==null;)rz(i,e,t),t=t.sibling}function rz(i,e,t){if(dl&&typeof dl.onCommitFiberUnmount=="function")try{dl.onCommitFiberUnmount(Qb,t)}catch{}switch(t.tag){case 5:ls||_p(t,e);case 6:var n=Vr,r=Ma;Vr=null,Gc(i,e,t),Vr=n,Ma=r,Vr!==null&&(Ma?(i=Vr,t=t.stateNode,i.nodeType===8?i.parentNode.removeChild(t):i.removeChild(t)):Vr.removeChild(t.stateNode));break;case 18:Vr!==null&&(Ma?(i=Vr,t=t.stateNode,i.nodeType===8?yw(i.parentNode,t):i.nodeType===1&&yw(i,t),G0(i)):yw(Vr,t.stateNode));break;case 4:n=Vr,r=Ma,Vr=t.stateNode.containerInfo,Ma=!0,Gc(i,e,t),Vr=n,Ma=r;break;case 0:case 11:case 14:case 15:if(!ls&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&iT(t,e,o),r=r.next}while(r!==n)}Gc(i,e,t);break;case 1:if(!ls&&(_p(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){Bi(t,e,a)}Gc(i,e,t);break;case 21:Gc(i,e,t);break;case 22:t.mode&1?(ls=(n=ls)||t.memoizedState!==null,Gc(i,e,t),ls=n):Gc(i,e,t);break;default:Gc(i,e,t)}}function pD(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new k9),e.forEach(function(n){var r=j9.bind(null,i,n);t.has(n)||(t.add(n),n.then(r,r))})}}function ua(i,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];try{var s=i,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Vr=a.stateNode,Ma=!1;break e;case 3:Vr=a.stateNode.containerInfo,Ma=!0;break e;case 4:Vr=a.stateNode.containerInfo,Ma=!0;break e}a=a.return}if(Vr===null)throw Error(Pt(160));rz(s,o,r),Vr=null,Ma=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Bi(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)sz(e,i),e=e.sibling}function sz(i,e){var t=i.alternate,n=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(ua(e,i),el(i),n&4){try{v0(3,i,i.return),oS(3,i)}catch(_){Bi(i,i.return,_)}try{v0(5,i,i.return)}catch(_){Bi(i,i.return,_)}}break;case 1:ua(e,i),el(i),n&512&&t!==null&&_p(t,t.return);break;case 5:if(ua(e,i),el(i),n&512&&t!==null&&_p(t,t.return),i.flags&32){var r=i.stateNode;try{U0(r,"")}catch(_){Bi(i,i.return,_)}}if(n&4&&(r=i.stateNode,r!=null)){var s=i.memoizedProps,o=t!==null?t.memoizedProps:s,a=i.type,l=i.updateQueue;if(i.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&T5(r,s),RE(a,o);var c=RE(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?L5(r,h):u==="dangerouslySetInnerHTML"?R5(r,h):u==="children"?U0(r,h):dP(r,u,h,c)}switch(a){case"input":AE(r,s);break;case"textarea":C5(r,s);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?Lp(r,!!s.multiple,f,!1):d!==!!s.multiple&&(s.defaultValue!=null?Lp(r,!!s.multiple,s.defaultValue,!0):Lp(r,!!s.multiple,s.multiple?[]:"",!1))}r[j0]=s}catch(_){Bi(i,i.return,_)}}break;case 6:if(ua(e,i),el(i),n&4){if(i.stateNode===null)throw Error(Pt(162));r=i.stateNode,s=i.memoizedProps;try{r.nodeValue=s}catch(_){Bi(i,i.return,_)}}break;case 3:if(ua(e,i),el(i),n&4&&t!==null&&t.memoizedState.isDehydrated)try{G0(e.containerInfo)}catch(_){Bi(i,i.return,_)}break;case 4:ua(e,i),el(i);break;case 13:ua(e,i),el(i),r=i.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(WP=Ki())),n&4&&pD(i);break;case 22:if(u=t!==null&&t.memoizedState!==null,i.mode&1?(ls=(c=ls)||u,ua(e,i),ls=c):ua(e,i),el(i),n&8192){if(c=i.memoizedState!==null,(i.stateNode.isHidden=c)&&!u&&i.mode&1)for(Vt=i,u=i.child;u!==null;){for(h=Vt=u;Vt!==null;){switch(d=Vt,f=d.child,d.tag){case 0:case 11:case 14:case 15:v0(4,d,d.return);break;case 1:_p(d,d.return);var p=d.stateNode;if(typeof p.componentWillUnmount=="function"){n=d,t=d.return;try{e=n,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(_){Bi(n,t,_)}}break;case 5:_p(d,d.return);break;case 22:if(d.memoizedState!==null){gD(h);continue}}f!==null?(f.return=d,Vt=f):gD(h)}u=u.sibling}e:for(u=null,h=i;;){if(h.tag===5){if(u===null){u=h;try{r=h.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=I5("display",o))}catch(_){Bi(i,i.return,_)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(_){Bi(i,i.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===i)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===i)break e;for(;h.sibling===null;){if(h.return===null||h.return===i)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ua(e,i),el(i),n&4&&pD(i);break;case 21:break;default:ua(e,i),el(i)}}function el(i){var e=i.flags;if(e&2){try{e:{for(var t=i.return;t!==null;){if(iz(t)){var n=t;break e}t=t.return}throw Error(Pt(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(U0(r,""),n.flags&=-33);var s=fD(i);oT(i,s,r);break;case 3:case 4:var o=n.stateNode.containerInfo,a=fD(i);sT(i,a,o);break;default:throw Error(Pt(161))}}catch(l){Bi(i,i.return,l)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function O9(i,e,t){Vt=i,oz(i)}function oz(i,e,t){for(var n=(i.mode&1)!==0;Vt!==null;){var r=Vt,s=r.child;if(r.tag===22&&n){var o=r.memoizedState!==null||s_;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||ls;a=s_;var c=ls;if(s_=o,(ls=l)&&!c)for(Vt=r;Vt!==null;)o=Vt,l=o.child,o.tag===22&&o.memoizedState!==null?vD(r):l!==null?(l.return=o,Vt=l):vD(r);for(;s!==null;)Vt=s,oz(s),s=s.sibling;Vt=r,s_=a,ls=c}mD(i)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Vt=s):mD(i)}}function mD(i){for(;Vt!==null;){var e=Vt;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ls||oS(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!ls)if(t===null)n.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Sa(e.type,t.memoizedProps);n.componentDidUpdate(r,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&JL(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}JL(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&G0(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Pt(163))}ls||e.flags&512&&rT(e)}catch(d){Bi(e,e.return,d)}}if(e===i){Vt=null;break}if(t=e.sibling,t!==null){t.return=e.return,Vt=t;break}Vt=e.return}}function gD(i){for(;Vt!==null;){var e=Vt;if(e===i){Vt=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Vt=t;break}Vt=e.return}}function vD(i){for(;Vt!==null;){var e=Vt;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{oS(4,e)}catch(l){Bi(e,t,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(l){Bi(e,r,l)}}var s=e.return;try{rT(e)}catch(l){Bi(e,s,l)}break;case 5:var o=e.return;try{rT(e)}catch(l){Bi(e,o,l)}}}catch(l){Bi(e,e.return,l)}if(e===i){Vt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Vt=a;break}Vt=e.return}}var B9=Math.ceil,db=Tc.ReactCurrentDispatcher,HP=Tc.ReactCurrentOwner,na=Tc.ReactCurrentBatchConfig,In=0,Fr=null,lr=null,Wr=0,wo=0,yp=Xu(0),yr=0,Q0=null,bd=0,aS=0,$P=0,_0=null,Xs=null,WP=0,em=1/0,Jl=null,fb=!1,aT=null,Mu=null,o_=!1,gu=null,pb=0,y0=0,lT=null,vx=-1,_x=0;function Rs(){return In&6?Ki():vx!==-1?vx:vx=Ki()}function Au(i){return i.mode&1?In&2&&Wr!==0?Wr&-Wr:S9.transition!==null?(_x===0&&(_x=$5()),_x):(i=jn,i!==0||(i=window.event,i=i===void 0?16:Z5(i.type)),i):1}function Oa(i,e,t,n){if(50<y0)throw y0=0,lT=null,Error(Pt(185));T1(i,t,n),(!(In&2)||i!==Fr)&&(i===Fr&&(!(In&2)&&(aS|=t),yr===4&&fu(i,Wr)),to(i,n),t===1&&In===0&&!(e.mode&1)&&(em=Ki()+500,iS&&qu()))}function to(i,e){var t=i.callbackNode;S7(i,e);var n=Zx(i,i===Fr?Wr:0);if(n===0)t!==null&&EL(t),i.callbackNode=null,i.callbackPriority=0;else if(e=n&-n,i.callbackPriority!==e){if(t!=null&&EL(t),e===1)i.tag===0?b9(_D.bind(null,i)):gB(_D.bind(null,i)),v9(function(){!(In&6)&&qu()}),t=null;else{switch(W5(n)){case 1:t=vP;break;case 4:t=V5;break;case 16:t=Kx;break;case 536870912:t=H5;break;default:t=Kx}t=pz(t,az.bind(null,i))}i.callbackPriority=e,i.callbackNode=t}}function az(i,e){if(vx=-1,_x=0,In&6)throw Error(Pt(327));var t=i.callbackNode;if(Up()&&i.callbackNode!==t)return null;var n=Zx(i,i===Fr?Wr:0);if(n===0)return null;if(n&30||n&i.expiredLanes||e)e=mb(i,n);else{e=n;var r=In;In|=2;var s=cz();(Fr!==i||Wr!==e)&&(Jl=null,em=Ki()+500,id(i,e));do try{V9();break}catch(a){lz(i,a)}while(!0);RP(),db.current=s,In=r,lr!==null?e=0:(Fr=null,Wr=0,e=yr)}if(e!==0){if(e===2&&(r=FE(i),r!==0&&(n=r,e=cT(i,r))),e===1)throw t=Q0,id(i,0),fu(i,n),to(i,Ki()),t;if(e===6)fu(i,n);else{if(r=i.current.alternate,!(n&30)&&!z9(r)&&(e=mb(i,n),e===2&&(s=FE(i),s!==0&&(n=s,e=cT(i,s))),e===1))throw t=Q0,id(i,0),fu(i,n),to(i,Ki()),t;switch(i.finishedWork=r,i.finishedLanes=n,e){case 0:case 1:throw Error(Pt(345));case 2:kh(i,Xs,Jl);break;case 3:if(fu(i,n),(n&130023424)===n&&(e=WP+500-Ki(),10<e)){if(Zx(i,0)!==0)break;if(r=i.suspendedLanes,(r&n)!==n){Rs(),i.pingedLanes|=i.suspendedLanes&r;break}i.timeoutHandle=HE(kh.bind(null,i,Xs,Jl),e);break}kh(i,Xs,Jl);break;case 4:if(fu(i,n),(n&4194240)===n)break;for(e=i.eventTimes,r=-1;0<n;){var o=31-Ua(n);s=1<<o,o=e[o],o>r&&(r=o),n&=~s}if(n=r,n=Ki()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*B9(n/1960))-n,10<n){i.timeoutHandle=HE(kh.bind(null,i,Xs,Jl),n);break}kh(i,Xs,Jl);break;case 5:kh(i,Xs,Jl);break;default:throw Error(Pt(329))}}}return to(i,Ki()),i.callbackNode===t?az.bind(null,i):null}function cT(i,e){var t=_0;return i.current.memoizedState.isDehydrated&&(id(i,e).flags|=256),i=mb(i,e),i!==2&&(e=Xs,Xs=t,e!==null&&uT(e)),i}function uT(i){Xs===null?Xs=i:Xs.push.apply(Xs,i)}function z9(i){for(var e=i;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var r=t[n],s=r.getSnapshot;r=r.value;try{if(!za(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function fu(i,e){for(e&=~$P,e&=~aS,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-Ua(e),n=1<<t;i[t]=-1,e&=~n}}function _D(i){if(In&6)throw Error(Pt(327));Up();var e=Zx(i,0);if(!(e&1))return to(i,Ki()),null;var t=mb(i,e);if(i.tag!==0&&t===2){var n=FE(i);n!==0&&(e=n,t=cT(i,n))}if(t===1)throw t=Q0,id(i,0),fu(i,e),to(i,Ki()),t;if(t===6)throw Error(Pt(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,kh(i,Xs,Jl),to(i,Ki()),null}function jP(i,e){var t=In;In|=1;try{return i(e)}finally{In=t,In===0&&(em=Ki()+500,iS&&qu())}}function Sd(i){gu!==null&&gu.tag===0&&!(In&6)&&Up();var e=In;In|=1;var t=na.transition,n=jn;try{if(na.transition=null,jn=1,i)return i()}finally{jn=n,na.transition=t,In=e,!(In&6)&&qu()}}function XP(){wo=yp.current,di(yp)}function id(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,g9(t)),lr!==null)for(t=lr.return;t!==null;){var n=t;switch(TP(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&nb();break;case 3:Qp(),di(Js),di(us),kP();break;case 5:FP(n);break;case 4:Qp();break;case 13:di(Ei);break;case 19:di(Ei);break;case 10:IP(n.type._context);break;case 22:case 23:XP()}t=t.return}if(Fr=i,lr=i=Eu(i.current,null),Wr=wo=e,yr=0,Q0=null,$P=aS=bd=0,Xs=_0=null,Yh!==null){for(e=0;e<Yh.length;e++)if(t=Yh[e],n=t.interleaved,n!==null){t.interleaved=null;var r=n.next,s=t.pending;if(s!==null){var o=s.next;s.next=r,n.next=o}t.pending=n}Yh=null}return i}function lz(i,e){do{var t=lr;try{if(RP(),px.current=hb,ub){for(var n=Ii.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}ub=!1}if(xd=0,Dr=vr=Ii=null,g0=!1,Y0=0,HP.current=null,t===null||t.return===null){yr=1,Q0=e,lr=null;break}e:{var s=i,o=t.return,a=t,l=e;if(e=Wr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=sD(o);if(f!==null){f.flags&=-257,oD(f,o,a,s,e),f.mode&1&&rD(s,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var _=new Set;_.add(l),e.updateQueue=_}else p.add(l);break e}else{if(!(e&1)){rD(s,c,e),qP();break e}l=Error(Pt(426))}}else if(yi&&a.mode&1){var v=sD(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),oD(v,o,a,s,e),CP(Jp(l,a));break e}}s=l=Jp(l,a),yr!==4&&(yr=2),_0===null?_0=[s]:_0.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=WB(s,l,e);QL(s,g);break e;case 1:a=l;var b=s.type,m=s.stateNode;if(!(s.flags&128)&&(typeof b.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Mu===null||!Mu.has(m)))){s.flags|=65536,e&=-e,s.lanes|=e;var y=jB(s,a,e);QL(s,y);break e}}s=s.return}while(s!==null)}hz(t)}catch(A){e=A,lr===t&&t!==null&&(lr=t=t.return);continue}break}while(!0)}function cz(){var i=db.current;return db.current=hb,i===null?hb:i}function qP(){(yr===0||yr===3||yr===2)&&(yr=4),Fr===null||!(bd&268435455)&&!(aS&268435455)||fu(Fr,Wr)}function mb(i,e){var t=In;In|=2;var n=cz();(Fr!==i||Wr!==e)&&(Jl=null,id(i,e));do try{G9();break}catch(r){lz(i,r)}while(!0);if(RP(),In=t,db.current=n,lr!==null)throw Error(Pt(261));return Fr=null,Wr=0,yr}function G9(){for(;lr!==null;)uz(lr)}function V9(){for(;lr!==null&&!f7();)uz(lr)}function uz(i){var e=fz(i.alternate,i,wo);i.memoizedProps=i.pendingProps,e===null?hz(i):lr=e,HP.current=null}function hz(i){var e=i;do{var t=e.alternate;if(i=e.return,e.flags&32768){if(t=F9(t,e),t!==null){t.flags&=32767,lr=t;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{yr=6,lr=null;return}}else if(t=N9(t,e,wo),t!==null){lr=t;return}if(e=e.sibling,e!==null){lr=e;return}lr=e=i}while(e!==null);yr===0&&(yr=5)}function kh(i,e,t){var n=jn,r=na.transition;try{na.transition=null,jn=1,H9(i,e,t,n)}finally{na.transition=r,jn=n}return null}function H9(i,e,t,n){do Up();while(gu!==null);if(In&6)throw Error(Pt(327));t=i.finishedWork;var r=i.finishedLanes;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(Pt(177));i.callbackNode=null,i.callbackPriority=0;var s=t.lanes|t.childLanes;if(w7(i,s),i===Fr&&(lr=Fr=null,Wr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||o_||(o_=!0,pz(Kx,function(){return Up(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=na.transition,na.transition=null;var o=jn;jn=1;var a=In;In|=4,HP.current=null,U9(i,t),sz(t,i),c9(GE),Qx=!!zE,GE=zE=null,i.current=t,O9(t),p7(),In=a,jn=o,na.transition=s}else i.current=t;if(o_&&(o_=!1,gu=i,pb=r),s=i.pendingLanes,s===0&&(Mu=null),v7(t.stateNode),to(i,Ki()),e!==null)for(n=i.onRecoverableError,t=0;t<e.length;t++)r=e[t],n(r.value,{componentStack:r.stack,digest:r.digest});if(fb)throw fb=!1,i=aT,aT=null,i;return pb&1&&i.tag!==0&&Up(),s=i.pendingLanes,s&1?i===lT?y0++:(y0=0,lT=i):y0=0,qu(),null}function Up(){if(gu!==null){var i=W5(pb),e=na.transition,t=jn;try{if(na.transition=null,jn=16>i?16:i,gu===null)var n=!1;else{if(i=gu,gu=null,pb=0,In&6)throw Error(Pt(331));var r=In;for(In|=4,Vt=i.current;Vt!==null;){var s=Vt,o=s.child;if(Vt.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Vt=c;Vt!==null;){var u=Vt;switch(u.tag){case 0:case 11:case 15:v0(8,u,s)}var h=u.child;if(h!==null)h.return=u,Vt=h;else for(;Vt!==null;){u=Vt;var d=u.sibling,f=u.return;if(nz(u),u===c){Vt=null;break}if(d!==null){d.return=f,Vt=d;break}Vt=f}}}var p=s.alternate;if(p!==null){var _=p.child;if(_!==null){p.child=null;do{var v=_.sibling;_.sibling=null,_=v}while(_!==null)}}Vt=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Vt=o;else e:for(;Vt!==null;){if(s=Vt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:v0(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,Vt=g;break e}Vt=s.return}}var b=i.current;for(Vt=b;Vt!==null;){o=Vt;var m=o.child;if(o.subtreeFlags&2064&&m!==null)m.return=o,Vt=m;else e:for(o=b;Vt!==null;){if(a=Vt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:oS(9,a)}}catch(A){Bi(a,a.return,A)}if(a===o){Vt=null;break e}var y=a.sibling;if(y!==null){y.return=a.return,Vt=y;break e}Vt=a.return}}if(In=r,qu(),dl&&typeof dl.onPostCommitFiberRoot=="function")try{dl.onPostCommitFiberRoot(Qb,i)}catch{}n=!0}return n}finally{jn=t,na.transition=e}}return!1}function yD(i,e,t){e=Jp(t,e),e=WB(i,e,1),i=wu(i,e,1),e=Rs(),i!==null&&(T1(i,1,e),to(i,e))}function Bi(i,e,t){if(i.tag===3)yD(i,i,t);else for(;e!==null;){if(e.tag===3){yD(e,i,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Mu===null||!Mu.has(n))){i=Jp(t,i),i=jB(e,i,1),e=wu(e,i,1),i=Rs(),e!==null&&(T1(e,1,i),to(e,i));break}}e=e.return}}function $9(i,e,t){var n=i.pingCache;n!==null&&n.delete(e),e=Rs(),i.pingedLanes|=i.suspendedLanes&t,Fr===i&&(Wr&t)===t&&(yr===4||yr===3&&(Wr&130023424)===Wr&&500>Ki()-WP?id(i,0):$P|=t),to(i,e)}function dz(i,e){e===0&&(i.mode&1?(e=Kv,Kv<<=1,!(Kv&130023424)&&(Kv=4194304)):e=1);var t=Rs();i=_c(i,e),i!==null&&(T1(i,e,t),to(i,t))}function W9(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),dz(i,t)}function j9(i,e){var t=0;switch(i.tag){case 13:var n=i.stateNode,r=i.memoizedState;r!==null&&(t=r.retryLane);break;case 19:n=i.stateNode;break;default:throw Error(Pt(314))}n!==null&&n.delete(e),dz(i,t)}var fz;fz=function(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps||Js.current)Qs=!0;else{if(!(i.lanes&t)&&!(e.flags&128))return Qs=!1,D9(i,e,t);Qs=!!(i.flags&131072)}else Qs=!1,yi&&e.flags&1048576&&vB(e,sb,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;gx(i,e),i=e.pendingProps;var r=Yp(e,us.current);kp(e,t),r=OP(null,e,n,i,r,t);var s=BP();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,eo(n)?(s=!0,ib(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,DP(e),r.updater=sS,e.stateNode=r,r._reactInternals=e,KE(e,n,i,t),e=JE(null,e,n,!0,s,t)):(e.tag=0,yi&&s&&EP(e),Ts(null,e,r,t),e=e.child),e;case 16:n=e.elementType;e:{switch(gx(i,e),i=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=q9(n),i=Sa(n,i),r){case 0:e=QE(null,e,n,i,t);break e;case 1:e=cD(null,e,n,i,t);break e;case 11:e=aD(null,e,n,i,t);break e;case 14:e=lD(null,e,n,Sa(n.type,i),t);break e}throw Error(Pt(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Sa(n,r),QE(i,e,n,r,t);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Sa(n,r),cD(i,e,n,r,t);case 3:e:{if(KB(e),i===null)throw Error(Pt(387));n=e.pendingProps,s=e.memoizedState,r=s.element,wB(i,e),lb(e,n,null,t);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Jp(Error(Pt(423)),e),e=uD(i,e,n,t,r);break e}else if(n!==r){r=Jp(Error(Pt(424)),e),e=uD(i,e,n,t,r);break e}else for(Eo=Su(e.stateNode.containerInfo.firstChild),Co=e,yi=!0,Ea=null,t=bB(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Kp(),n===r){e=yc(i,e,t);break e}Ts(i,e,n,t)}e=e.child}return e;case 5:return MB(e),i===null&&XE(e),n=e.type,r=e.pendingProps,s=i!==null?i.memoizedProps:null,o=r.children,VE(n,r)?o=null:s!==null&&VE(n,s)&&(e.flags|=32),YB(i,e),Ts(i,e,o,t),e.child;case 6:return i===null&&XE(e),null;case 13:return ZB(i,e,t);case 4:return NP(e,e.stateNode.containerInfo),n=e.pendingProps,i===null?e.child=Zp(e,null,n,t):Ts(i,e,n,t),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Sa(n,r),aD(i,e,n,r,t);case 7:return Ts(i,e,e.pendingProps,t),e.child;case 8:return Ts(i,e,e.pendingProps.children,t),e.child;case 12:return Ts(i,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,ni(ob,n._currentValue),n._currentValue=o,s!==null)if(za(s.value,o)){if(s.children===r.children&&!Js.current){e=yc(i,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(s.tag===1){l=hc(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),qE(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Pt(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),qE(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ts(i,e,r.children,t),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,kp(e,t),r=ra(r),n=n(r),e.flags|=1,Ts(i,e,n,t),e.child;case 14:return n=e.type,r=Sa(n,e.pendingProps),r=Sa(n.type,r),lD(i,e,n,r,t);case 15:return XB(i,e,e.type,e.pendingProps,t);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Sa(n,r),gx(i,e),e.tag=1,eo(n)?(i=!0,ib(e)):i=!1,kp(e,t),$B(e,n,r),KE(e,n,r,t),JE(null,e,n,!0,i,t);case 19:return QB(i,e,t);case 22:return qB(i,e,t)}throw Error(Pt(156,e.tag))};function pz(i,e){return G5(i,e)}function X9(i,e,t,n){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ta(i,e,t,n){return new X9(i,e,t,n)}function YP(i){return i=i.prototype,!(!i||!i.isReactComponent)}function q9(i){if(typeof i=="function")return YP(i)?1:0;if(i!=null){if(i=i.$$typeof,i===pP)return 11;if(i===mP)return 14}return 2}function Eu(i,e){var t=i.alternate;return t===null?(t=ta(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&14680064,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function yx(i,e,t,n,r,s){var o=2;if(n=i,typeof i=="function")YP(i)&&(o=1);else if(typeof i=="string")o=5;else e:switch(i){case cp:return rd(t.children,r,s,e);case fP:o=8,r|=8;break;case xE:return i=ta(12,t,e,r|2),i.elementType=xE,i.lanes=s,i;case bE:return i=ta(13,t,e,r),i.elementType=bE,i.lanes=s,i;case SE:return i=ta(19,t,e,r),i.elementType=SE,i.lanes=s,i;case M5:return lS(t,r,s,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case S5:o=10;break e;case w5:o=9;break e;case pP:o=11;break e;case mP:o=14;break e;case su:o=16,n=null;break e}throw Error(Pt(130,i==null?i:typeof i,""))}return e=ta(o,t,e,r),e.elementType=i,e.type=n,e.lanes=s,e}function rd(i,e,t,n){return i=ta(7,i,n,e),i.lanes=t,i}function lS(i,e,t,n){return i=ta(22,i,n,e),i.elementType=M5,i.lanes=t,i.stateNode={isHidden:!1},i}function Tw(i,e,t){return i=ta(6,i,null,e),i.lanes=t,i}function Cw(i,e,t){return e=ta(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function Y9(i,e,t,n,r){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lw(0),this.expirationTimes=lw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lw(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function KP(i,e,t,n,r,s,o,a,l){return i=new Y9(i,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=ta(3,null,null,e),i.current=s,s.stateNode=i,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},DP(s),i}function K9(i,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:lp,key:n==null?null:""+n,children:i,containerInfo:e,implementation:t}}function mz(i){if(!i)return Uu;i=i._reactInternals;e:{if(Ud(i)!==i||i.tag!==1)throw Error(Pt(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(eo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Pt(171))}if(i.tag===1){var t=i.type;if(eo(t))return mB(i,t,e)}return e}function gz(i,e,t,n,r,s,o,a,l){return i=KP(t,n,!0,i,r,s,o,a,l),i.context=mz(null),t=i.current,n=Rs(),r=Au(t),s=hc(n,r),s.callback=e??null,wu(t,s,r),i.current.lanes=r,T1(i,r,n),to(i,n),i}function cS(i,e,t,n){var r=e.current,s=Rs(),o=Au(r);return t=mz(t),e.context===null?e.context=t:e.pendingContext=t,e=hc(s,o),e.payload={element:i},n=n===void 0?null:n,n!==null&&(e.callback=n),i=wu(r,e,o),i!==null&&(Oa(i,r,o,s),fx(i,r,o)),o}function gb(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function xD(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function ZP(i,e){xD(i,e),(i=i.alternate)&&xD(i,e)}function Z9(){return null}var vz=typeof reportError=="function"?reportError:function(i){console.error(i)};function QP(i){this._internalRoot=i}uS.prototype.render=QP.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(Pt(409));cS(i,e,null,null)};uS.prototype.unmount=QP.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;Sd(function(){cS(null,i,null,null)}),e[vc]=null}};function uS(i){this._internalRoot=i}uS.prototype.unstable_scheduleHydration=function(i){if(i){var e=q5();i={blockedOn:null,target:i,priority:e};for(var t=0;t<du.length&&e!==0&&e<du[t].priority;t++);du.splice(t,0,i),t===0&&K5(i)}};function JP(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function hS(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function bD(){}function Q9(i,e,t,n,r){if(r){if(typeof n=="function"){var s=n;n=function(){var c=gb(o);s.call(c)}}var o=gz(e,n,i,0,null,!1,!1,"",bD);return i._reactRootContainer=o,i[vc]=o.current,$0(i.nodeType===8?i.parentNode:i),Sd(),o}for(;r=i.lastChild;)i.removeChild(r);if(typeof n=="function"){var a=n;n=function(){var c=gb(l);a.call(c)}}var l=KP(i,0,!1,null,null,!1,!1,"",bD);return i._reactRootContainer=l,i[vc]=l.current,$0(i.nodeType===8?i.parentNode:i),Sd(function(){cS(e,l,t,n)}),l}function dS(i,e,t,n,r){var s=t._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=gb(o);a.call(l)}}cS(e,o,i,r)}else o=Q9(t,e,i,r,n);return gb(o)}j5=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var t=Zg(e.pendingLanes);t!==0&&(_P(e,t|1),to(e,Ki()),!(In&6)&&(em=Ki()+500,qu()))}break;case 13:Sd(function(){var n=_c(i,1);if(n!==null){var r=Rs();Oa(n,i,1,r)}}),ZP(i,1)}};yP=function(i){if(i.tag===13){var e=_c(i,134217728);if(e!==null){var t=Rs();Oa(e,i,134217728,t)}ZP(i,134217728)}};X5=function(i){if(i.tag===13){var e=Au(i),t=_c(i,e);if(t!==null){var n=Rs();Oa(t,i,e,n)}ZP(i,e)}};q5=function(){return jn};Y5=function(i,e){var t=jn;try{return jn=i,e()}finally{jn=t}};LE=function(i,e,t){switch(e){case"input":if(AE(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==i&&n.form===i.form){var r=nS(n);if(!r)throw Error(Pt(90));E5(n),AE(n,r)}}}break;case"textarea":C5(i,t);break;case"select":e=t.value,e!=null&&Lp(i,!!t.multiple,e,!1)}};F5=jP;k5=Sd;var J9={usingClientEntryPoint:!1,Events:[P1,fp,nS,D5,N5,jP]},gg={findFiberByHostInstance:qh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},eW={bundleType:gg.bundleType,version:gg.version,rendererPackageName:gg.rendererPackageName,rendererConfig:gg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Tc.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=B5(i),i===null?null:i.stateNode},findFiberByHostInstance:gg.findFiberByHostInstance||Z9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var a_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!a_.isDisabled&&a_.supportsFiber)try{Qb=a_.inject(eW),dl=a_}catch{}}Do.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=J9;Do.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!JP(e))throw Error(Pt(200));return K9(i,e,null,t)};Do.createRoot=function(i,e){if(!JP(i))throw Error(Pt(299));var t=!1,n="",r=vz;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=KP(i,1,!1,null,null,t,!1,n,r),i[vc]=e.current,$0(i.nodeType===8?i.parentNode:i),new QP(e)};Do.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(Pt(188)):(i=Object.keys(i).join(","),Error(Pt(268,i)));return i=B5(e),i=i===null?null:i.stateNode,i};Do.flushSync=function(i){return Sd(i)};Do.hydrate=function(i,e,t){if(!hS(e))throw Error(Pt(200));return dS(null,i,e,!0,t)};Do.hydrateRoot=function(i,e,t){if(!JP(i))throw Error(Pt(405));var n=t!=null&&t.hydratedSources||null,r=!1,s="",o=vz;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=gz(e,null,i,1,t??null,r,!1,s,o),i[vc]=e.current,$0(i),n)for(i=0;i<n.length;i++)t=n[i],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new uS(e)};Do.render=function(i,e,t){if(!hS(e))throw Error(Pt(200));return dS(null,i,e,!1,t)};Do.unmountComponentAtNode=function(i){if(!hS(i))throw Error(Pt(40));return i._reactRootContainer?(Sd(function(){dS(null,null,i,!1,function(){i._reactRootContainer=null,i[vc]=null})}),!0):!1};Do.unstable_batchedUpdates=jP;Do.unstable_renderSubtreeIntoContainer=function(i,e,t,n){if(!hS(t))throw Error(Pt(200));if(i==null||i._reactInternals===void 0)throw Error(Pt(38));return dS(i,e,t,!1,n)};Do.version="18.3.1-next-f1338f8080-20240426";function _z(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_z)}catch(i){console.error(i)}}_z(),_5.exports=Do;var tW=_5.exports,yz,SD=tW;yz=_E.createRoot=SD.createRoot,_E.hydrateRoot=SD.hydrateRoot;/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const I1="160",nW={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},iW={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},xz=0,hT=1,bz=2,rW=3,Sz=0,fS=1,x0=2,wa=3,Sl=0,Is=1,cr=2,sW=2,dc=0,sd=1,dT=2,fT=3,pT=4,wz=5,pu=100,Mz=101,Az=102,mT=103,gT=104,Ez=200,Tz=201,Cz=202,Pz=203,vb=204,_b=205,Rz=206,Iz=207,Lz=208,Dz=209,Nz=210,Fz=211,kz=212,Uz=213,Oz=214,Bz=0,zz=1,Gz=2,J0=3,Vz=4,Hz=5,$z=6,Wz=7,L1=0,jz=1,Xz=2,pl=0,qz=1,Yz=2,Kz=3,eR=4,Zz=5,Qz=6,vT="attached",Jz="detached",pS=300,xc=301,Ou=302,e1=303,t1=304,Am=306,Bu=1e3,$r=1001,tm=1002,zi=1003,n1=1004,oW=1004,Op=1005,aW=1005,hi=1006,mS=1007,lW=1007,wl=1008,cW=1008,ml=1009,e6=1010,t6=1011,gS=1012,tR=1013,lc=1014,Na=1015,nm=1016,nR=1017,iR=1018,Tu=1020,n6=1021,Ps=1023,i6=1024,r6=1025,Cu=1026,wd=1027,s6=1028,rR=1029,o6=1030,sR=1031,oR=1033,xx=33776,bx=33777,Sx=33778,wx=33779,_T=35840,yT=35841,xT=35842,bT=35843,aR=36196,ST=37492,wT=37496,MT=37808,AT=37809,ET=37810,TT=37811,CT=37812,PT=37813,RT=37814,IT=37815,LT=37816,DT=37817,NT=37818,FT=37819,kT=37820,UT=37821,Mx=36492,OT=36494,BT=36495,a6=36283,zT=36284,GT=36285,VT=36286,l6=2200,c6=2201,u6=2202,im=2300,Md=2301,Ax=2302,Zh=2400,Qh=2401,i1=2402,vS=2500,lR=2501,h6=0,cR=1,yb=2,uR=3e3,Pu=3001,d6=3200,hR=3201,Yu=0,f6=1,Ao="",_r="srgb",Ml="srgb-linear",_S="display-p3",D1="display-p3-linear",r1="linear",ti="srgb",s1="rec709",o1="p3",uW=0,Uh=7680,hW=7681,dW=7682,fW=7683,pW=34055,mW=34056,gW=5386,vW=512,_W=513,yW=514,xW=515,bW=516,SW=517,wW=518,HT=519,p6=512,m6=513,g6=514,dR=515,v6=516,_6=517,y6=518,x6=519,a1=35044,MW=35048,AW=35040,EW=35045,TW=35049,CW=35041,PW=35046,RW=35050,IW=35042,LW="100",$T="300 es",xb=1035,Fa=2e3,rm=2001;let Cc=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};const ns=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let wD=1234567;const od=Math.PI/180,sm=180/Math.PI;function Po(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ns[i&255]+ns[i>>8&255]+ns[i>>16&255]+ns[i>>24&255]+"-"+ns[e&255]+ns[e>>8&255]+"-"+ns[e>>16&15|64]+ns[e>>24&255]+"-"+ns[t&63|128]+ns[t>>8&255]+"-"+ns[t>>16&255]+ns[t>>24&255]+ns[n&255]+ns[n>>8&255]+ns[n>>16&255]+ns[n>>24&255]).toLowerCase()}function Gi(i,e,t){return Math.max(e,Math.min(t,i))}function fR(i,e){return(i%e+e)%e}function DW(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function NW(i,e,t){return i!==e?(t-i)/(e-i):0}function b0(i,e,t){return(1-t)*i+t*e}function FW(i,e,t,n){return b0(i,e,1-Math.exp(-t*n))}function kW(i,e=1){return e-Math.abs(fR(i,e*2)-e)}function UW(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function OW(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function BW(i,e){return i+Math.floor(Math.random()*(e-i+1))}function zW(i,e){return i+Math.random()*(e-i)}function GW(i){return i*(.5-Math.random())}function VW(i){i!==void 0&&(wD=i);let e=wD+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function HW(i){return i*od}function $W(i){return i*sm}function WT(i){return(i&i-1)===0&&i!==0}function WW(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function bb(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function jW(i,e,t,n,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+n)/2),u=o((e+n)/2),h=s((e-n)/2),d=o((e-n)/2),f=s((n-e)/2),p=o((n-e)/2);switch(r){case"XYX":i.set(a*u,l*h,l*d,a*c);break;case"YZY":i.set(l*d,a*u,l*h,a*c);break;case"ZXZ":i.set(l*h,l*d,a*u,a*c);break;case"XZX":i.set(a*u,l*p,l*f,a*c);break;case"YXY":i.set(l*f,a*u,l*p,a*c);break;case"ZYZ":i.set(l*p,l*f,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Ks(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function pn(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const au={DEG2RAD:od,RAD2DEG:sm,generateUUID:Po,clamp:Gi,euclideanModulo:fR,mapLinear:DW,inverseLerp:NW,lerp:b0,damp:FW,pingpong:kW,smoothstep:UW,smootherstep:OW,randInt:BW,randFloat:zW,randFloatSpread:GW,seededRandom:VW,degToRad:HW,radToDeg:$W,isPowerOfTwo:WT,ceilPowerOfTwo:WW,floorPowerOfTwo:bb,setQuaternionFromProperEuler:jW,normalize:pn,denormalize:Ks};let yt=class b6{constructor(e=0,t=0){b6.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Gi(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},bn=class S6{constructor(e,t,n,r,s,o,a,l,c){S6.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c)}set(e,t,n,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],u=n[4],h=n[7],d=n[2],f=n[5],p=n[8],_=r[0],v=r[3],g=r[6],b=r[1],m=r[4],y=r[7],A=r[2],w=r[5],M=r[8];return s[0]=o*_+a*b+l*A,s[3]=o*v+a*m+l*w,s[6]=o*g+a*y+l*M,s[1]=c*_+u*b+h*A,s[4]=c*v+u*m+h*w,s[7]=c*g+u*y+h*M,s[2]=d*_+f*b+p*A,s[5]=d*v+f*m+p*w,s[8]=d*g+f*y+p*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-n*s*u+n*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,d=a*l-u*s,f=c*s-o*l,p=t*h+n*d+r*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/p;return e[0]=h*_,e[1]=(r*c-u*n)*_,e[2]=(a*n-r*o)*_,e[3]=d*_,e[4]=(u*t-r*l)*_,e[5]=(r*s-a*t)*_,e[6]=f*_,e[7]=(n*l-c*t)*_,e[8]=(o*t-n*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Pw.makeScale(e,t)),this}rotate(e){return this.premultiply(Pw.makeRotation(-e)),this}translate(e,t){return this.premultiply(Pw.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const Pw=new bn;function w6(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const XW={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function xp(i,e){return new XW[i](e)}function l1(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function M6(){const i=l1("canvas");return i.style.display="block",i}const MD={};function S0(i){i in MD||(MD[i]=!0,console.warn(i))}const AD=new bn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),ED=new bn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),l_={[Ml]:{transfer:r1,primaries:s1,toReference:i=>i,fromReference:i=>i},[_r]:{transfer:ti,primaries:s1,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[D1]:{transfer:r1,primaries:o1,toReference:i=>i.applyMatrix3(ED),fromReference:i=>i.applyMatrix3(AD)},[_S]:{transfer:ti,primaries:o1,toReference:i=>i.convertSRGBToLinear().applyMatrix3(ED),fromReference:i=>i.applyMatrix3(AD).convertLinearToSRGB()}},qW=new Set([Ml,D1]),Vn={enabled:!0,_workingColorSpace:Ml,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!qW.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const n=l_[e].toReference,r=l_[t].fromReference;return r(n(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this._workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this._workingColorSpace)},getPrimaries:function(i){return l_[i].primaries},getTransfer:function(i){return i===Ao?r1:l_[i].transfer}};function Bp(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function Rw(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let af,pR=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{af===void 0&&(af=l1("canvas")),af.width=e.width,af.height=e.height;const n=af.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=af}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=l1("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Bp(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Bp(t[n]/255)*255):t[n]=Bp(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},YW=0,Jh=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:YW++}),this.uuid=Po(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(Iw(r[o].image)):s.push(Iw(r[o]))}else s=Iw(r);n.url=s}return t||(e.images[this.uuid]=n),n}};function Iw(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?pR.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let KW=0,dr=class Ex extends Cc{constructor(e=Ex.DEFAULT_IMAGE,t=Ex.DEFAULT_MAPPING,n=$r,r=$r,s=hi,o=wl,a=Ps,l=ml,c=Ex.DEFAULT_ANISOTROPY,u=Ao){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:KW++}),this.uuid=Po(),this.name="",this.source=new Jh(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new yt(0,0),this.repeat=new yt(1,1),this.center=new yt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new bn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(S0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===Pu?_r:Ao),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==pS)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Bu:e.x=e.x-Math.floor(e.x);break;case $r:e.x=e.x<0?0:1;break;case tm:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Bu:e.y=e.y-Math.floor(e.y);break;case $r:e.y=e.y<0?0:1;break;case tm:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return S0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===_r?Pu:uR}set encoding(e){S0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Pu?_r:Ao}};dr.DEFAULT_IMAGE=null;dr.DEFAULT_MAPPING=pS;dr.DEFAULT_ANISOTROPY=1;let Wn=class A6{constructor(e=0,t=0,n=0,r=1){A6.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],f=l[5],p=l[9],_=l[2],v=l[6],g=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-_)<.01&&Math.abs(p-v)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+_)<.1&&Math.abs(p+v)<.1&&Math.abs(c+f+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const m=(c+1)/2,y=(f+1)/2,A=(g+1)/2,w=(u+d)/4,M=(h+_)/4,T=(p+v)/4;return m>y&&m>A?m<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(m),r=w/n,s=M/n):y>A?y<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(y),n=w/r,s=T/r):A<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(A),n=M/s,r=T/s),this.set(n,r,s,t),this}let b=Math.sqrt((v-p)*(v-p)+(h-_)*(h-_)+(d-u)*(d-u));return Math.abs(b)<.001&&(b=1),this.x=(v-p)/b,this.y=(h-_)/b,this.z=(d-u)/b,this.w=Math.acos((c+f+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},E6=class extends Cc{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Wn(0,0,e,t),this.scissorTest=!1,this.viewport=new Wn(0,0,e,t);const r={width:e,height:t,depth:1};n.encoding!==void 0&&(S0("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Pu?_r:Ao),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:hi,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new dr(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Jh(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Ga=class extends E6{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}},yS=class extends dr{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=zi,this.minFilter=zi,this.wrapR=$r,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class ZW extends Ga{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new yS(null,e,t,n),this.texture.isRenderTargetTexture=!0}}let mR=class extends dr{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=zi,this.minFilter=zi,this.wrapR=$r,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class QW extends Ga{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new mR(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class JW extends Ga{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}let jr=class{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,a){let l=n[r+0],c=n[r+1],u=n[r+2],h=n[r+3];const d=s[o+0],f=s[o+1],p=s[o+2],_=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=d,e[t+1]=f,e[t+2]=p,e[t+3]=_;return}if(h!==_||l!==d||c!==f||u!==p){let v=1-a;const g=l*d+c*f+u*p+h*_,b=g>=0?1:-1,m=1-g*g;if(m>Number.EPSILON){const A=Math.sqrt(m),w=Math.atan2(A,g*b);v=Math.sin(v*w)/A,a=Math.sin(a*w)/A}const y=a*b;if(l=l*v+d*y,c=c*v+f*y,u=u*v+p*y,h=h*v+_*y,v===1-a){const A=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=A,c*=A,u*=A,h*=A}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],l=n[r+1],c=n[r+2],u=n[r+3],h=s[o],d=s[o+1],f=s[o+2],p=s[o+3];return e[t]=a*p+u*h+l*f-c*d,e[t+1]=l*p+u*d+c*h-a*f,e[t+2]=c*p+u*f+a*d-l*h,e[t+3]=u*p-a*h-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(r/2),h=a(s/2),d=l(n/2),f=l(r/2),p=l(s/2);switch(o){case"XYZ":this._x=d*u*h+c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h-d*f*p;break;case"YXZ":this._x=d*u*h+c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h+d*f*p;break;case"ZXY":this._x=d*u*h-c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h-d*f*p;break;case"ZYX":this._x=d*u*h-c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h+d*f*p;break;case"YZX":this._x=d*u*h+c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h-d*f*p;break;case"XZY":this._x=d*u*h-c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],d=n+a+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(o-r)*f}else if(n>a&&n>h){const f=2*Math.sqrt(1+n-a-h);this._w=(u-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+c)/f}else if(a>h){const f=2*Math.sqrt(1+a-n-h);this._w=(s-c)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-n-a);this._w=(o-r)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Gi(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-n*c,this._z=s*u+o*c+n*l-r*a,this._w=o*u-n*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*n+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=o*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(s),n*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Te=class T6{constructor(e=0,t=0,n=0){T6.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(TD.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(TD.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*n),u=2*(a*t-s*r),h=2*(s*n-o*t);return this.x=t+l*c+o*h-a*u,this.y=n+l*u+a*c-s*h,this.z=r+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Lw.copy(this).projectOnVector(e),this.sub(Lw)}reflect(e){return this.sub(Lw.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Gi(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const Lw=new Te,TD=new jr;let kr=class{constructor(e=new Te(1/0,1/0,1/0),t=new Te(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(ha.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(ha.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ha.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,ha):ha.fromBufferAttribute(s,o),ha.applyMatrix4(e.matrixWorld),this.expandByPoint(ha);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),c_.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),c_.copy(n.boundingBox)),c_.applyMatrix4(e.matrixWorld),this.union(c_)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ha),ha.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(vg),u_.subVectors(this.max,vg),lf.subVectors(e.a,vg),cf.subVectors(e.b,vg),uf.subVectors(e.c,vg),Vc.subVectors(cf,lf),Hc.subVectors(uf,cf),mh.subVectors(lf,uf);let t=[0,-Vc.z,Vc.y,0,-Hc.z,Hc.y,0,-mh.z,mh.y,Vc.z,0,-Vc.x,Hc.z,0,-Hc.x,mh.z,0,-mh.x,-Vc.y,Vc.x,0,-Hc.y,Hc.x,0,-mh.y,mh.x,0];return!Dw(t,lf,cf,uf,u_)||(t=[1,0,0,0,1,0,0,0,1],!Dw(t,lf,cf,uf,u_))?!1:(h_.crossVectors(Vc,Hc),t=[h_.x,h_.y,h_.z],Dw(t,lf,cf,uf,u_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ha).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ha).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(kl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),kl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),kl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),kl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),kl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),kl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),kl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),kl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(kl),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};const kl=[new Te,new Te,new Te,new Te,new Te,new Te,new Te,new Te],ha=new Te,c_=new kr,lf=new Te,cf=new Te,uf=new Te,Vc=new Te,Hc=new Te,mh=new Te,vg=new Te,u_=new Te,h_=new Te,gh=new Te;function Dw(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){gh.fromArray(i,s);const a=r.x*Math.abs(gh.x)+r.y*Math.abs(gh.y)+r.z*Math.abs(gh.z),l=e.dot(gh),c=t.dot(gh),u=n.dot(gh);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const ej=new kr,_g=new Te,Nw=new Te;let Ur=class{constructor(e=new Te,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):ej.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_g.subVectors(e,this.center);const t=_g.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(_g,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Nw.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_g.copy(e.center).add(Nw)),this.expandByPoint(_g.copy(e.center).sub(Nw))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}};const Ul=new Te,Fw=new Te,d_=new Te,$c=new Te,kw=new Te,f_=new Te,Uw=new Te;let Em=class{constructor(e=new Te,t=new Te(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ul)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ul.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ul.copy(this.origin).addScaledVector(this.direction,t),Ul.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){Fw.copy(e).add(t).multiplyScalar(.5),d_.copy(t).sub(e).normalize(),$c.copy(this.origin).sub(Fw);const s=e.distanceTo(t)*.5,o=-this.direction.dot(d_),a=$c.dot(this.direction),l=-$c.dot(d_),c=$c.lengthSq(),u=Math.abs(1-o*o);let h,d,f,p;if(u>0)if(h=o*l-a,d=o*a-l,p=s*u,h>=0)if(d>=-p)if(d<=p){const _=1/u;h*=_,d*=_,f=h*(h+o*d+2*a)+d*(o*h+d+2*l)+c}else d=s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d<=-p?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c):d<=p?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(Fw).addScaledVector(d_,d),f}intersectSphere(e,t){Ul.subVectors(e.center,this.origin);const n=Ul.dot(this.direction),r=Ul.dot(Ul)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(n=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(n=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),u>=0?(s=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,Ul)!==null}intersectTriangle(e,t,n,r,s){kw.subVectors(t,e),f_.subVectors(n,e),Uw.crossVectors(kw,f_);let o=this.direction.dot(Uw),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;$c.subVectors(this.origin,e);const l=a*this.direction.dot(f_.crossVectors($c,f_));if(l<0)return null;const c=a*this.direction.dot(kw.cross($c));if(c<0||l+c>o)return null;const u=-a*$c.dot(Uw);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},en=class jT{constructor(e,t,n,r,s,o,a,l,c,u,h,d,f,p,_,v){jT.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c,u,h,d,f,p,_,v)}set(e,t,n,r,s,o,a,l,c,u,h,d,f,p,_,v){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=s,g[5]=o,g[9]=a,g[13]=l,g[2]=c,g[6]=u,g[10]=h,g[14]=d,g[3]=f,g[7]=p,g[11]=_,g[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new jT().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/hf.setFromMatrixColumn(e,0).length(),s=1/hf.setFromMatrixColumn(e,1).length(),o=1/hf.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*u,f=o*h,p=a*u,_=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=f+p*c,t[5]=d-_*c,t[9]=-a*l,t[2]=_-d*c,t[6]=p+f*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*u,f=l*h,p=c*u,_=c*h;t[0]=d+_*a,t[4]=p*a-f,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=f*a-p,t[6]=_+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*u,f=l*h,p=c*u,_=c*h;t[0]=d-_*a,t[4]=-o*h,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*u,t[9]=_-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*u,f=o*h,p=a*u,_=a*h;t[0]=l*u,t[4]=p*c-f,t[8]=d*c+_,t[1]=l*h,t[5]=_*c+d,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,f=o*c,p=a*l,_=a*c;t[0]=l*u,t[4]=_-d*h,t[8]=p*h+f,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*h+p,t[10]=d-_*h}else if(e.order==="XZY"){const d=o*l,f=o*c,p=a*l,_=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=d*h+_,t[5]=o*u,t[9]=f*h-p,t[2]=p*h-f,t[6]=a*u,t[10]=_*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(tj,e,nj)}lookAt(e,t,n){const r=this.elements;return vo.subVectors(e,t),vo.lengthSq()===0&&(vo.z=1),vo.normalize(),Wc.crossVectors(n,vo),Wc.lengthSq()===0&&(Math.abs(n.z)===1?vo.x+=1e-4:vo.z+=1e-4,vo.normalize(),Wc.crossVectors(n,vo)),Wc.normalize(),p_.crossVectors(vo,Wc),r[0]=Wc.x,r[4]=p_.x,r[8]=vo.x,r[1]=Wc.y,r[5]=p_.y,r[9]=vo.y,r[2]=Wc.z,r[6]=p_.z,r[10]=vo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],u=n[1],h=n[5],d=n[9],f=n[13],p=n[2],_=n[6],v=n[10],g=n[14],b=n[3],m=n[7],y=n[11],A=n[15],w=r[0],M=r[4],T=r[8],E=r[12],C=r[1],N=r[5],P=r[9],L=r[13],R=r[2],F=r[6],V=r[10],G=r[14],U=r[3],z=r[7],O=r[11],D=r[15];return s[0]=o*w+a*C+l*R+c*U,s[4]=o*M+a*N+l*F+c*z,s[8]=o*T+a*P+l*V+c*O,s[12]=o*E+a*L+l*G+c*D,s[1]=u*w+h*C+d*R+f*U,s[5]=u*M+h*N+d*F+f*z,s[9]=u*T+h*P+d*V+f*O,s[13]=u*E+h*L+d*G+f*D,s[2]=p*w+_*C+v*R+g*U,s[6]=p*M+_*N+v*F+g*z,s[10]=p*T+_*P+v*V+g*O,s[14]=p*E+_*L+v*G+g*D,s[3]=b*w+m*C+y*R+A*U,s[7]=b*M+m*N+y*F+A*z,s[11]=b*T+m*P+y*V+A*O,s[15]=b*E+m*L+y*G+A*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],f=e[14],p=e[3],_=e[7],v=e[11],g=e[15];return p*(+s*l*h-r*c*h-s*a*d+n*c*d+r*a*f-n*l*f)+_*(+t*l*f-t*c*d+s*o*d-r*o*f+r*c*u-s*l*u)+v*(+t*c*h-t*a*f-s*o*h+n*o*f+s*a*u-n*c*u)+g*(-r*a*u-t*l*h+t*a*d+r*o*h-n*o*d+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],_=e[13],v=e[14],g=e[15],b=h*v*c-_*d*c+_*l*f-a*v*f-h*l*g+a*d*g,m=p*d*c-u*v*c-p*l*f+o*v*f+u*l*g-o*d*g,y=u*_*c-p*h*c+p*a*f-o*_*f-u*a*g+o*h*g,A=p*h*l-u*_*l-p*a*d+o*_*d+u*a*v-o*h*v,w=t*b+n*m+r*y+s*A;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/w;return e[0]=b*M,e[1]=(_*d*s-h*v*s-_*r*f+n*v*f+h*r*g-n*d*g)*M,e[2]=(a*v*s-_*l*s+_*r*c-n*v*c-a*r*g+n*l*g)*M,e[3]=(h*l*s-a*d*s-h*r*c+n*d*c+a*r*f-n*l*f)*M,e[4]=m*M,e[5]=(u*v*s-p*d*s+p*r*f-t*v*f-u*r*g+t*d*g)*M,e[6]=(p*l*s-o*v*s-p*r*c+t*v*c+o*r*g-t*l*g)*M,e[7]=(o*d*s-u*l*s+u*r*c-t*d*c-o*r*f+t*l*f)*M,e[8]=y*M,e[9]=(p*h*s-u*_*s-p*n*f+t*_*f+u*n*g-t*h*g)*M,e[10]=(o*_*s-p*a*s+p*n*c-t*_*c-o*n*g+t*a*g)*M,e[11]=(u*a*s-o*h*s-u*n*c+t*h*c+o*n*f-t*a*f)*M,e[12]=A*M,e[13]=(u*_*r-p*h*r+p*n*d-t*_*d-u*n*v+t*h*v)*M,e[14]=(p*a*r-o*_*r-p*n*l+t*_*l+o*n*v-t*a*v)*M,e[15]=(o*h*r-u*a*r+u*n*l-t*h*l-o*n*d+t*a*d)*M,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+n,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+n,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,h=a+a,d=s*c,f=s*u,p=s*h,_=o*u,v=o*h,g=a*h,b=l*c,m=l*u,y=l*h,A=n.x,w=n.y,M=n.z;return r[0]=(1-(_+g))*A,r[1]=(f+y)*A,r[2]=(p-m)*A,r[3]=0,r[4]=(f-y)*w,r[5]=(1-(d+g))*w,r[6]=(v+b)*w,r[7]=0,r[8]=(p+m)*M,r[9]=(v-b)*M,r[10]=(1-(d+_))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=hf.set(r[0],r[1],r[2]).length();const o=hf.set(r[4],r[5],r[6]).length(),a=hf.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],da.copy(this);const c=1/s,u=1/o,h=1/a;return da.elements[0]*=c,da.elements[1]*=c,da.elements[2]*=c,da.elements[4]*=u,da.elements[5]*=u,da.elements[6]*=u,da.elements[8]*=h,da.elements[9]*=h,da.elements[10]*=h,t.setFromRotationMatrix(da),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o,a=Fa){const l=this.elements,c=2*s/(t-e),u=2*s/(n-r),h=(t+e)/(t-e),d=(n+r)/(n-r);let f,p;if(a===Fa)f=-(o+s)/(o-s),p=-2*o*s/(o-s);else if(a===rm)f=-o/(o-s),p=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,s,o,a=Fa){const l=this.elements,c=1/(t-e),u=1/(n-r),h=1/(o-s),d=(t+e)*c,f=(n+r)*u;let p,_;if(a===Fa)p=(o+s)*h,_=-2*h;else if(a===rm)p=s*h,_=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=_,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};const hf=new Te,da=new en,tj=new Te(0,0,0),nj=new Te(1,1,1),Wc=new Te,p_=new Te,vo=new Te,CD=new en,PD=new jr;let N1=class C6{constructor(e=0,t=0,n=0,r=C6.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(Gi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Gi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Gi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Gi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Gi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Gi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return CD.makeRotationFromQuaternion(e),this.setFromRotationMatrix(CD,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return PD.setFromEuler(this),this.setFromQuaternion(PD,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};N1.DEFAULT_ORDER="XYZ";let ad=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},ij=0;const RD=new Te,df=new jr,Ol=new en,m_=new Te,yg=new Te,rj=new Te,sj=new jr,ID=new Te(1,0,0),LD=new Te(0,1,0),DD=new Te(0,0,1),oj={type:"added"},aj={type:"removed"};let Gn=class Tx extends Cc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ij++}),this.uuid=Po(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Tx.DEFAULT_UP.clone();const e=new Te,t=new N1,n=new jr,r=new Te(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new en},normalMatrix:{value:new bn}}),this.matrix=new en,this.matrixWorld=new en,this.matrixAutoUpdate=Tx.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Tx.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ad,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return df.setFromAxisAngle(e,t),this.quaternion.multiply(df),this}rotateOnWorldAxis(e,t){return df.setFromAxisAngle(e,t),this.quaternion.premultiply(df),this}rotateX(e){return this.rotateOnAxis(ID,e)}rotateY(e){return this.rotateOnAxis(LD,e)}rotateZ(e){return this.rotateOnAxis(DD,e)}translateOnAxis(e,t){return RD.copy(e).applyQuaternion(this.quaternion),this.position.add(RD.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ID,e)}translateY(e){return this.translateOnAxis(LD,e)}translateZ(e){return this.translateOnAxis(DD,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ol.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?m_.copy(e):m_.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),yg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ol.lookAt(yg,m_,this.up):Ol.lookAt(m_,yg,this.up),this.quaternion.setFromRotationMatrix(Ol),r&&(Ol.extractRotation(r.matrixWorld),df.setFromRotationMatrix(Ol),this.quaternion.premultiply(df.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(oj)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(aj)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ol.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ol.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ol),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(yg,e,rj),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(yg,sj,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const s=t[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),d=o(e.skeletons),f=o(e.animations),p=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),h.length>0&&(n.shapes=h),d.length>0&&(n.skeletons=d),f.length>0&&(n.animations=f),p.length>0&&(n.nodes=p)}return n.object=r,n;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}};Gn.DEFAULT_UP=new Te(0,1,0);Gn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Gn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const fa=new Te,Bl=new Te,Ow=new Te,zl=new Te,ff=new Te,pf=new Te,ND=new Te,Bw=new Te,zw=new Te,Gw=new Te;let g_=!1,ed=class Oh{constructor(e=new Te,t=new Te,n=new Te){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),fa.subVectors(e,t),r.cross(fa);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){fa.subVectors(r,t),Bl.subVectors(n,t),Ow.subVectors(e,t);const o=fa.dot(fa),a=fa.dot(Bl),l=fa.dot(Ow),c=Bl.dot(Bl),u=Bl.dot(Ow),h=o*c-a*a;if(h===0)return s.set(0,0,0),null;const d=1/h,f=(c*l-a*u)*d,p=(o*u-a*l)*d;return s.set(1-f-p,p,f)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,zl)===null?!1:zl.x>=0&&zl.y>=0&&zl.x+zl.y<=1}static getUV(e,t,n,r,s,o,a,l){return g_===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),g_=!0),this.getInterpolation(e,t,n,r,s,o,a,l)}static getInterpolation(e,t,n,r,s,o,a,l){return this.getBarycoord(e,t,n,r,zl)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,zl.x),l.addScaledVector(o,zl.y),l.addScaledVector(a,zl.z),l)}static isFrontFacing(e,t,n,r){return fa.subVectors(n,t),Bl.subVectors(e,t),fa.cross(Bl).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return fa.subVectors(this.c,this.b),Bl.subVectors(this.a,this.b),fa.cross(Bl).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Oh.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Oh.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,s){return g_===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),g_=!0),Oh.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}getInterpolation(e,t,n,r,s){return Oh.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return Oh.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Oh.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;ff.subVectors(r,n),pf.subVectors(s,n),Bw.subVectors(e,n);const l=ff.dot(Bw),c=pf.dot(Bw);if(l<=0&&c<=0)return t.copy(n);zw.subVectors(e,r);const u=ff.dot(zw),h=pf.dot(zw);if(u>=0&&h<=u)return t.copy(r);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(ff,o);Gw.subVectors(e,s);const f=ff.dot(Gw),p=pf.dot(Gw);if(p>=0&&f<=p)return t.copy(s);const _=f*c-l*p;if(_<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(n).addScaledVector(pf,a);const v=u*p-f*h;if(v<=0&&h-u>=0&&f-p>=0)return ND.subVectors(s,r),a=(h-u)/(h-u+(f-p)),t.copy(r).addScaledVector(ND,a);const g=1/(v+_+d);return o=_*g,a=d*g,t.copy(n).addScaledVector(ff,o).addScaledVector(pf,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const P6={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jc={h:0,s:0,l:0},v_={h:0,s:0,l:0};function Vw(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}let It=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=_r){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Vn.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=Vn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Vn.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=Vn.workingColorSpace){if(e=fR(e,1),t=Gi(t,0,1),n=Gi(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=Vw(o,s,e+1/3),this.g=Vw(o,s,e),this.b=Vw(o,s,e-1/3)}return Vn.toWorkingColorSpace(this,r),this}setStyle(e,t=_r){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=_r){const n=P6[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Bp(e.r),this.g=Bp(e.g),this.b=Bp(e.b),this}copyLinearToSRGB(e){return this.r=Rw(e.r),this.g=Rw(e.g),this.b=Rw(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=_r){return Vn.fromWorkingColorSpace(is.copy(this),e),Math.round(Gi(is.r*255,0,255))*65536+Math.round(Gi(is.g*255,0,255))*256+Math.round(Gi(is.b*255,0,255))}getHexString(e=_r){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Vn.workingColorSpace){Vn.fromWorkingColorSpace(is.copy(this),t);const n=is.r,r=is.g,s=is.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case n:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-n)/h+2;break;case s:l=(n-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Vn.workingColorSpace){return Vn.fromWorkingColorSpace(is.copy(this),t),e.r=is.r,e.g=is.g,e.b=is.b,e}getStyle(e=_r){Vn.fromWorkingColorSpace(is.copy(this),e);const t=is.r,n=is.g,r=is.b;return e!==_r?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(jc),this.setHSL(jc.h+e,jc.s+t,jc.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(jc),e.getHSL(v_);const n=b0(jc.h,v_.h,t),r=b0(jc.s,v_.s,t),s=b0(jc.l,v_.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const is=new It;It.NAMES=P6;let lj=0,ur=class extends Cc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:lj++}),this.uuid=Po(),this.name="",this.type="Material",this.blending=sd,this.side=Sl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=vb,this.blendDst=_b,this.blendEquation=pu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new It(0,0,0),this.blendAlpha=0,this.depthFunc=J0,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=HT,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Uh,this.stencilZFail=Uh,this.stencilZPass=Uh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==sd&&(n.blending=this.blending),this.side!==Sl&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==vb&&(n.blendSrc=this.blendSrc),this.blendDst!==_b&&(n.blendDst=this.blendDst),this.blendEquation!==pu&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==J0&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==HT&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Uh&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Uh&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Uh&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},fi=class extends ur{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new It(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=L1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}};const sc=cj();function cj(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(n[l]=0,n[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,r[l]=24,r[l|256]=24):(n[l]=31744,n[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function $s(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=Gi(i,-65504,65504),sc.floatView[0]=i;const e=sc.uint32View[0],t=e>>23&511;return sc.baseTable[t]+((e&8388607)>>sc.shiftTable[t])}function Jg(i){const e=i>>10;return sc.uint32View[0]=sc.mantissaTable[sc.offsetTable[e]+(i&1023)]+sc.exponentTable[e],sc.floatView[0]}const uj={toHalfFloat:$s,fromHalfFloat:Jg},ir=new Te,__=new yt;let An=class{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=a1,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Na,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)__.fromBufferAttribute(this,t),__.applyMatrix3(e),this.setXY(t,__.x,__.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix3(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ir.fromBufferAttribute(this,t),ir.applyMatrix4(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ir.fromBufferAttribute(this,t),ir.applyNormalMatrix(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ir.fromBufferAttribute(this,t),ir.transformDirection(e),this.setXYZ(t,ir.x,ir.y,ir.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Ks(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=pn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Ks(t,this.array)),t}setX(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ks(t,this.array)),t}setY(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ks(t,this.array)),t}setZ(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ks(t,this.array)),t}setW(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=pn(t,this.array),n=pn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=pn(t,this.array),n=pn(n,this.array),r=pn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=pn(t,this.array),n=pn(n,this.array),r=pn(r,this.array),s=pn(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==a1&&(e.usage=this.usage),e}};class hj extends An{constructor(e,t,n){super(new Int8Array(e),t,n)}}class dj extends An{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class fj extends An{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class pj extends An{constructor(e,t,n){super(new Int16Array(e),t,n)}}let gR=class extends An{constructor(e,t,n){super(new Uint16Array(e),t,n)}};class mj extends An{constructor(e,t,n){super(new Int32Array(e),t,n)}}let vR=class extends An{constructor(e,t,n){super(new Uint32Array(e),t,n)}};class gj extends An{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Jg(this.array[e*this.itemSize]);return this.normalized&&(t=Ks(t,this.array)),t}setX(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize]=$s(t),this}getY(e){let t=Jg(this.array[e*this.itemSize+1]);return this.normalized&&(t=Ks(t,this.array)),t}setY(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize+1]=$s(t),this}getZ(e){let t=Jg(this.array[e*this.itemSize+2]);return this.normalized&&(t=Ks(t,this.array)),t}setZ(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize+2]=$s(t),this}getW(e){let t=Jg(this.array[e*this.itemSize+3]);return this.normalized&&(t=Ks(t,this.array)),t}setW(e,t){return this.normalized&&(t=pn(t,this.array)),this.array[e*this.itemSize+3]=$s(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=pn(t,this.array),n=pn(n,this.array)),this.array[e+0]=$s(t),this.array[e+1]=$s(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=pn(t,this.array),n=pn(n,this.array),r=pn(r,this.array)),this.array[e+0]=$s(t),this.array[e+1]=$s(n),this.array[e+2]=$s(r),this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=pn(t,this.array),n=pn(n,this.array),r=pn(r,this.array),s=pn(s,this.array)),this.array[e+0]=$s(t),this.array[e+1]=$s(n),this.array[e+2]=$s(r),this.array[e+3]=$s(s),this}}let jt=class extends An{constructor(e,t,n){super(new Float32Array(e),t,n)}};class vj extends An{constructor(e,t,n){super(new Float64Array(e),t,n)}}let _j=0;const $o=new en,Hw=new Gn,mf=new Te,_o=new kr,xg=new kr,Rr=new Te;let mn=class R6 extends Cc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_j++}),this.uuid=Po(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(w6(e)?vR:gR)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new bn().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return $o.makeRotationFromQuaternion(e),this.applyMatrix4($o),this}rotateX(e){return $o.makeRotationX(e),this.applyMatrix4($o),this}rotateY(e){return $o.makeRotationY(e),this.applyMatrix4($o),this}rotateZ(e){return $o.makeRotationZ(e),this.applyMatrix4($o),this}translate(e,t,n){return $o.makeTranslation(e,t,n),this.applyMatrix4($o),this}scale(e,t,n){return $o.makeScale(e,t,n),this.applyMatrix4($o),this}lookAt(e){return Hw.lookAt(e),Hw.updateMatrix(),this.applyMatrix4(Hw.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(mf).negate(),this.translate(mf.x,mf.y,mf.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new jt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new kr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Te(-1/0,-1/0,-1/0),new Te(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];_o.setFromBufferAttribute(s),this.morphTargetsRelative?(Rr.addVectors(this.boundingBox.min,_o.min),this.boundingBox.expandByPoint(Rr),Rr.addVectors(this.boundingBox.max,_o.max),this.boundingBox.expandByPoint(Rr)):(this.boundingBox.expandByPoint(_o.min),this.boundingBox.expandByPoint(_o.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ur);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Te,1/0);return}if(e){const n=this.boundingSphere.center;if(_o.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];xg.setFromBufferAttribute(a),this.morphTargetsRelative?(Rr.addVectors(_o.min,xg.min),_o.expandByPoint(Rr),Rr.addVectors(_o.max,xg.max),_o.expandByPoint(Rr)):(_o.expandByPoint(xg.min),_o.expandByPoint(xg.max))}_o.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)Rr.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Rr));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Rr.fromBufferAttribute(a,c),l&&(mf.fromBufferAttribute(e,c),Rr.add(mf)),r=Math.max(r,n.distanceToSquared(Rr))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new An(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let C=0;C<a;C++)c[C]=new Te,u[C]=new Te;const h=new Te,d=new Te,f=new Te,p=new yt,_=new yt,v=new yt,g=new Te,b=new Te;function m(C,N,P){h.fromArray(r,C*3),d.fromArray(r,N*3),f.fromArray(r,P*3),p.fromArray(o,C*2),_.fromArray(o,N*2),v.fromArray(o,P*2),d.sub(h),f.sub(h),_.sub(p),v.sub(p);const L=1/(_.x*v.y-v.x*_.y);isFinite(L)&&(g.copy(d).multiplyScalar(v.y).addScaledVector(f,-_.y).multiplyScalar(L),b.copy(f).multiplyScalar(_.x).addScaledVector(d,-v.x).multiplyScalar(L),c[C].add(g),c[N].add(g),c[P].add(g),u[C].add(b),u[N].add(b),u[P].add(b))}let y=this.groups;y.length===0&&(y=[{start:0,count:n.length}]);for(let C=0,N=y.length;C<N;++C){const P=y[C],L=P.start,R=P.count;for(let F=L,V=L+R;F<V;F+=3)m(n[F+0],n[F+1],n[F+2])}const A=new Te,w=new Te,M=new Te,T=new Te;function E(C){M.fromArray(s,C*3),T.copy(M);const N=c[C];A.copy(N),A.sub(M.multiplyScalar(M.dot(N))).normalize(),w.crossVectors(T,N);const L=w.dot(u[C])<0?-1:1;l[C*4]=A.x,l[C*4+1]=A.y,l[C*4+2]=A.z,l[C*4+3]=L}for(let C=0,N=y.length;C<N;++C){const P=y[C],L=P.start,R=P.count;for(let F=L,V=L+R;F<V;F+=3)E(n[F+0]),E(n[F+1]),E(n[F+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new An(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let d=0,f=n.count;d<f;d++)n.setXYZ(d,0,0,0);const r=new Te,s=new Te,o=new Te,a=new Te,l=new Te,c=new Te,u=new Te,h=new Te;if(e)for(let d=0,f=e.count;d<f;d+=3){const p=e.getX(d+0),_=e.getX(d+1),v=e.getX(d+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,v),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,_),c.fromBufferAttribute(n,v),a.add(u),l.add(u),c.add(u),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(_,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let d=0,f=t.count;d<f;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),n.setXYZ(d+0,u.x,u.y,u.z),n.setXYZ(d+1,u.x,u.y,u.z),n.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Rr.fromBufferAttribute(e,t),Rr.normalize(),e.setXYZ(t,Rr.x,Rr.y,Rr.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,d=new c.constructor(l.length*u);let f=0,p=0;for(let _=0,v=l.length;_<v;_++){a.isInterleavedBufferAttribute?f=l[_]*a.data.stride+a.offset:f=l[_]*u;for(let g=0;g<u;g++)d[p++]=c[f++]}return new An(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new R6,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,n);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const d=c[u],f=e(d,n);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h];u.push(f.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const FD=new en,vh=new Em,y_=new Ur,kD=new Te,gf=new Te,vf=new Te,_f=new Te,$w=new Te,x_=new Te,b_=new yt,S_=new yt,w_=new yt,UD=new Te,OD=new Te,BD=new Te,M_=new Te,A_=new Te;let Tn=class extends Gn{constructor(e=new mn,t=new fi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){x_.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],h=s[l];u!==0&&($w.fromBufferAttribute(h,e),o?x_.addScaledVector($w,u):x_.addScaledVector($w.sub(t),u))}t.add(x_)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),y_.copy(n.boundingSphere),y_.applyMatrix4(s),vh.copy(e.ray).recast(e.near),!(y_.containsPoint(vh.origin)===!1&&(vh.intersectSphere(y_,kD)===null||vh.origin.distanceToSquared(kD)>(e.far-e.near)**2))&&(FD.copy(s).invert(),vh.copy(e.ray).applyMatrix4(FD),!(n.boundingBox!==null&&vh.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,vh)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,_=d.length;p<_;p++){const v=d[p],g=o[v.materialIndex],b=Math.max(v.start,f.start),m=Math.min(a.count,Math.min(v.start+v.count,f.start+f.count));for(let y=b,A=m;y<A;y+=3){const w=a.getX(y),M=a.getX(y+1),T=a.getX(y+2);r=E_(this,g,e,n,c,u,h,w,M,T),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=v.materialIndex,t.push(r))}}else{const p=Math.max(0,f.start),_=Math.min(a.count,f.start+f.count);for(let v=p,g=_;v<g;v+=3){const b=a.getX(v),m=a.getX(v+1),y=a.getX(v+2);r=E_(this,o,e,n,c,u,h,b,m,y),r&&(r.faceIndex=Math.floor(v/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let p=0,_=d.length;p<_;p++){const v=d[p],g=o[v.materialIndex],b=Math.max(v.start,f.start),m=Math.min(l.count,Math.min(v.start+v.count,f.start+f.count));for(let y=b,A=m;y<A;y+=3){const w=y,M=y+1,T=y+2;r=E_(this,g,e,n,c,u,h,w,M,T),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=v.materialIndex,t.push(r))}}else{const p=Math.max(0,f.start),_=Math.min(l.count,f.start+f.count);for(let v=p,g=_;v<g;v+=3){const b=v,m=v+1,y=v+2;r=E_(this,o,e,n,c,u,h,b,m,y),r&&(r.faceIndex=Math.floor(v/3),t.push(r))}}}};function yj(i,e,t,n,r,s,o,a){let l;if(e.side===Is?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,e.side===Sl,a),l===null)return null;A_.copy(a),A_.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(A_);return c<t.near||c>t.far?null:{distance:c,point:A_.clone(),object:i}}function E_(i,e,t,n,r,s,o,a,l,c){i.getVertexPosition(a,gf),i.getVertexPosition(l,vf),i.getVertexPosition(c,_f);const u=yj(i,e,t,n,gf,vf,_f,M_);if(u){r&&(b_.fromBufferAttribute(r,a),S_.fromBufferAttribute(r,l),w_.fromBufferAttribute(r,c),u.uv=ed.getInterpolation(M_,gf,vf,_f,b_,S_,w_,new yt)),s&&(b_.fromBufferAttribute(s,a),S_.fromBufferAttribute(s,l),w_.fromBufferAttribute(s,c),u.uv1=ed.getInterpolation(M_,gf,vf,_f,b_,S_,w_,new yt),u.uv2=u.uv1),o&&(UD.fromBufferAttribute(o,a),OD.fromBufferAttribute(o,l),BD.fromBufferAttribute(o,c),u.normal=ed.getInterpolation(M_,gf,vf,_f,UD,OD,BD,new Te),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:l,c,normal:new Te,materialIndex:0};ed.getNormal(gf,vf,_f,h.normal),u.face=h}return u}let F1=class I6 extends mn{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],h=[];let d=0,f=0;p("z","y","x",-1,-1,n,t,e,o,s,0),p("z","y","x",1,-1,n,t,-e,o,s,1),p("x","z","y",1,1,e,n,t,r,o,2),p("x","z","y",1,-1,e,n,-t,r,o,3),p("x","y","z",1,-1,e,t,n,r,s,4),p("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new jt(c,3)),this.setAttribute("normal",new jt(u,3)),this.setAttribute("uv",new jt(h,2));function p(_,v,g,b,m,y,A,w,M,T,E){const C=y/M,N=A/T,P=y/2,L=A/2,R=w/2,F=M+1,V=T+1;let G=0,U=0;const z=new Te;for(let O=0;O<V;O++){const D=O*N-L;for(let B=0;B<F;B++){const W=B*C-P;z[_]=W*b,z[v]=D*m,z[g]=R,c.push(z.x,z.y,z.z),z[_]=0,z[v]=0,z[g]=w>0?1:-1,u.push(z.x,z.y,z.z),h.push(B/M),h.push(1-O/T),G+=1}}for(let O=0;O<T;O++)for(let D=0;D<M;D++){const B=d+D+F*O,W=d+D+F*(O+1),q=d+(D+1)+F*(O+1),j=d+(D+1)+F*O;l.push(B,W,j),l.push(W,q,j),U+=6}a.addGroup(f,U,E),f+=U,d+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new I6(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function om(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function Ms(i){const e={};for(let t=0;t<i.length;t++){const n=om(i[t]);for(const r in n)e[r]=n[r]}return e}function xj(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function L6(i){return i.getRenderTarget()===null?i.outputColorSpace:Vn.workingColorSpace}const _R={clone:om,merge:Ms};var bj=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Sj=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;let Al=class extends ur{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=bj,this.fragmentShader=Sj,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=om(e.uniforms),this.uniformsGroups=xj(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}},k1=class extends Gn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new en,this.projectionMatrix=new en,this.projectionMatrixInverse=new en,this.coordinateSystem=Fa}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Zi=class extends k1{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=sm*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(od*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return sm*2*Math.atan(Math.tan(od*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(od*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*n/c,r*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const yf=-90,xf=1;let D6=class extends Gn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Zi(yf,xf,e,t);r.layers=this.layers,this.add(r);const s=new Zi(yf,xf,e,t);s.layers=this.layers,this.add(s);const o=new Zi(yf,xf,e,t);o.layers=this.layers,this.add(o);const a=new Zi(yf,xf,e,t);a.layers=this.layers,this.add(a);const l=new Zi(yf,xf,e,t);l.layers=this.layers,this.add(l);const c=new Zi(yf,xf,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===Fa)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===rm)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const _=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,l),e.setRenderTarget(n,4,r),e.render(t,c),n.texture.generateMipmaps=_,e.setRenderTarget(n,5,r),e.render(t,u),e.setRenderTarget(h,d,f),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}},U1=class extends dr{constructor(e,t,n,r,s,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:xc,super(e,t,n,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},N6=class extends Ga{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];t.encoding!==void 0&&(S0("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Pu?_r:Ao),this.texture=new U1(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:hi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new F1(5,5,5),s=new Al({name:"CubemapFromEquirect",uniforms:om(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Is,blending:dc});s.uniforms.tEquirect.value=t;const o=new Tn(r,s),a=t.minFilter;return t.minFilter===wl&&(t.minFilter=hi),new D6(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}};const Ww=new Te,wj=new Te,Mj=new bn;let lu=class{constructor(e=new Te(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Ww.subVectors(n,t).cross(wj.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Ww),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Mj.getNormalMatrix(e),r=this.coplanarPoint(Ww).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const _h=new Ur,T_=new Te;let O1=class{constructor(e=new lu,t=new lu,n=new lu,r=new lu,s=new lu,o=new lu){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Fa){const n=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],h=r[6],d=r[7],f=r[8],p=r[9],_=r[10],v=r[11],g=r[12],b=r[13],m=r[14],y=r[15];if(n[0].setComponents(l-s,d-c,v-f,y-g).normalize(),n[1].setComponents(l+s,d+c,v+f,y+g).normalize(),n[2].setComponents(l+o,d+u,v+p,y+b).normalize(),n[3].setComponents(l-o,d-u,v-p,y-b).normalize(),n[4].setComponents(l-a,d-h,v-_,y-m).normalize(),t===Fa)n[5].setComponents(l+a,d+h,v+_,y+m).normalize();else if(t===rm)n[5].setComponents(a,h,_,m).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),_h.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),_h.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(_h)}intersectsSprite(e){return _h.center.set(0,0,0),_h.radius=.7071067811865476,_h.applyMatrix4(e.matrixWorld),this.intersectsSphere(_h)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(T_.x=r.normal.x>0?e.max.x:e.min.x,T_.y=r.normal.y>0?e.max.y:e.min.y,T_.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(T_)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function F6(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function Aj(i,e){const t=e.isWebGL2,n=new WeakMap;function r(c,u){const h=c.array,d=c.usage,f=h.byteLength,p=i.createBuffer();i.bindBuffer(u,p),i.bufferData(u,h,d),c.onUploadCallback();let _;if(h instanceof Float32Array)_=i.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)_=i.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else _=i.UNSIGNED_SHORT;else if(h instanceof Int16Array)_=i.SHORT;else if(h instanceof Uint32Array)_=i.UNSIGNED_INT;else if(h instanceof Int32Array)_=i.INT;else if(h instanceof Int8Array)_=i.BYTE;else if(h instanceof Uint8Array)_=i.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)_=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:_,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version,size:f}}function s(c,u,h){const d=u.array,f=u._updateRange,p=u.updateRanges;if(i.bindBuffer(h,c),f.count===-1&&p.length===0&&i.bufferSubData(h,0,d),p.length!==0){for(let _=0,v=p.length;_<v;_++){const g=p[_];t?i.bufferSubData(h,g.start*d.BYTES_PER_ELEMENT,d,g.start,g.count):i.bufferSubData(h,g.start*d.BYTES_PER_ELEMENT,d.subarray(g.start,g.start+g.count))}u.clearUpdateRanges()}f.count!==-1&&(t?i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=n.get(c);u&&(i.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const d=n.get(c);(!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=n.get(c);if(h===void 0)n.set(c,r(c,u));else if(h.version<c.version){if(h.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(h.buffer,c,u),h.version=c.version}}return{get:o,remove:a,update:l}}let Va=class k6 extends mn{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(r),c=a+1,u=l+1,h=e/a,d=t/l,f=[],p=[],_=[],v=[];for(let g=0;g<u;g++){const b=g*d-o;for(let m=0;m<c;m++){const y=m*h-s;p.push(y,-b,0),_.push(0,0,1),v.push(m/a),v.push(1-g/l)}}for(let g=0;g<l;g++)for(let b=0;b<a;b++){const m=b+c*g,y=b+c*(g+1),A=b+1+c*(g+1),w=b+1+c*g;f.push(m,y,w),f.push(y,A,w)}this.setIndex(f),this.setAttribute("position",new jt(p,3)),this.setAttribute("normal",new jt(_,3)),this.setAttribute("uv",new jt(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new k6(e.width,e.height,e.widthSegments,e.heightSegments)}};var Ej=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Tj=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Cj=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Pj=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Rj=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Ij=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Lj=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Dj=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Nj=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Fj=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,kj=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Uj=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Oj=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Bj=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,zj=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Gj=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Vj=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Hj=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,$j=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Wj=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,jj=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Xj=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,qj=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Yj=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Kj=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Zj=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Qj=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Jj=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,eX=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,tX=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,nX="gl_FragColor = linearToOutputTexel( gl_FragColor );",iX=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,rX=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,sX=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,oX=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,aX=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,lX=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,cX=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,uX=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,hX=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,dX=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,fX=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,pX=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,mX=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,gX=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,vX=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,_X=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,yX=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,xX=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,bX=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,SX=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,wX=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,MX=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,AX=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,EX=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,TX=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,CX=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,PX=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,RX=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,IX=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,LX=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,DX=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,NX=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,FX=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,kX=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,UX=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,OX=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,BX=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,zX=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,GX=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,VX=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,HX=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,$X=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,WX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,jX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,XX=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,qX=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,YX=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,KX=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,ZX=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,QX=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,JX=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,eq=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,tq=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,nq=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,iq=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,rq=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,sq=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,oq=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,aq=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,lq=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,cq=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,uq=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,hq=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,dq=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,fq=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,pq=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,mq=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,gq=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,vq=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,_q=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color *= toneMappingExposure;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	return color;
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,yq=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,xq=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,bq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Sq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,wq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Mq=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Aq=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Eq=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Tq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Cq=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Pq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Rq=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Iq=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Lq=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Dq=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Nq=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Fq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,kq=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Uq=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Oq=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Bq=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,zq=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Gq=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Vq=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Hq=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,$q=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Wq=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,jq=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Xq=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qq=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Yq=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Kq=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Zq=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Qq=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Jq=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,eY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,tY=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nY=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,iY=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,rY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,un={alphahash_fragment:Ej,alphahash_pars_fragment:Tj,alphamap_fragment:Cj,alphamap_pars_fragment:Pj,alphatest_fragment:Rj,alphatest_pars_fragment:Ij,aomap_fragment:Lj,aomap_pars_fragment:Dj,batching_pars_vertex:Nj,batching_vertex:Fj,begin_vertex:kj,beginnormal_vertex:Uj,bsdfs:Oj,iridescence_fragment:Bj,bumpmap_pars_fragment:zj,clipping_planes_fragment:Gj,clipping_planes_pars_fragment:Vj,clipping_planes_pars_vertex:Hj,clipping_planes_vertex:$j,color_fragment:Wj,color_pars_fragment:jj,color_pars_vertex:Xj,color_vertex:qj,common:Yj,cube_uv_reflection_fragment:Kj,defaultnormal_vertex:Zj,displacementmap_pars_vertex:Qj,displacementmap_vertex:Jj,emissivemap_fragment:eX,emissivemap_pars_fragment:tX,colorspace_fragment:nX,colorspace_pars_fragment:iX,envmap_fragment:rX,envmap_common_pars_fragment:sX,envmap_pars_fragment:oX,envmap_pars_vertex:aX,envmap_physical_pars_fragment:yX,envmap_vertex:lX,fog_vertex:cX,fog_pars_vertex:uX,fog_fragment:hX,fog_pars_fragment:dX,gradientmap_pars_fragment:fX,lightmap_fragment:pX,lightmap_pars_fragment:mX,lights_lambert_fragment:gX,lights_lambert_pars_fragment:vX,lights_pars_begin:_X,lights_toon_fragment:xX,lights_toon_pars_fragment:bX,lights_phong_fragment:SX,lights_phong_pars_fragment:wX,lights_physical_fragment:MX,lights_physical_pars_fragment:AX,lights_fragment_begin:EX,lights_fragment_maps:TX,lights_fragment_end:CX,logdepthbuf_fragment:PX,logdepthbuf_pars_fragment:RX,logdepthbuf_pars_vertex:IX,logdepthbuf_vertex:LX,map_fragment:DX,map_pars_fragment:NX,map_particle_fragment:FX,map_particle_pars_fragment:kX,metalnessmap_fragment:UX,metalnessmap_pars_fragment:OX,morphcolor_vertex:BX,morphnormal_vertex:zX,morphtarget_pars_vertex:GX,morphtarget_vertex:VX,normal_fragment_begin:HX,normal_fragment_maps:$X,normal_pars_fragment:WX,normal_pars_vertex:jX,normal_vertex:XX,normalmap_pars_fragment:qX,clearcoat_normal_fragment_begin:YX,clearcoat_normal_fragment_maps:KX,clearcoat_pars_fragment:ZX,iridescence_pars_fragment:QX,opaque_fragment:JX,packing:eq,premultiplied_alpha_fragment:tq,project_vertex:nq,dithering_fragment:iq,dithering_pars_fragment:rq,roughnessmap_fragment:sq,roughnessmap_pars_fragment:oq,shadowmap_pars_fragment:aq,shadowmap_pars_vertex:lq,shadowmap_vertex:cq,shadowmask_pars_fragment:uq,skinbase_vertex:hq,skinning_pars_vertex:dq,skinning_vertex:fq,skinnormal_vertex:pq,specularmap_fragment:mq,specularmap_pars_fragment:gq,tonemapping_fragment:vq,tonemapping_pars_fragment:_q,transmission_fragment:yq,transmission_pars_fragment:xq,uv_pars_fragment:bq,uv_pars_vertex:Sq,uv_vertex:wq,worldpos_vertex:Mq,background_vert:Aq,background_frag:Eq,backgroundCube_vert:Tq,backgroundCube_frag:Cq,cube_vert:Pq,cube_frag:Rq,depth_vert:Iq,depth_frag:Lq,distanceRGBA_vert:Dq,distanceRGBA_frag:Nq,equirect_vert:Fq,equirect_frag:kq,linedashed_vert:Uq,linedashed_frag:Oq,meshbasic_vert:Bq,meshbasic_frag:zq,meshlambert_vert:Gq,meshlambert_frag:Vq,meshmatcap_vert:Hq,meshmatcap_frag:$q,meshnormal_vert:Wq,meshnormal_frag:jq,meshphong_vert:Xq,meshphong_frag:qq,meshphysical_vert:Yq,meshphysical_frag:Kq,meshtoon_vert:Zq,meshtoon_frag:Qq,points_vert:Jq,points_frag:eY,shadow_vert:tY,shadow_frag:nY,sprite_vert:iY,sprite_frag:rY},kt={common:{diffuse:{value:new It(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new bn},alphaMap:{value:null},alphaMapTransform:{value:new bn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new bn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new bn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new bn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new bn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new bn},normalScale:{value:new yt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new bn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new bn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new bn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new bn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new It(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new It(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new bn},alphaTest:{value:0},uvTransform:{value:new bn}},sprite:{diffuse:{value:new It(16777215)},opacity:{value:1},center:{value:new yt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new bn},alphaMap:{value:null},alphaMapTransform:{value:new bn},alphaTest:{value:0}}},Ta={basic:{uniforms:Ms([kt.common,kt.specularmap,kt.envmap,kt.aomap,kt.lightmap,kt.fog]),vertexShader:un.meshbasic_vert,fragmentShader:un.meshbasic_frag},lambert:{uniforms:Ms([kt.common,kt.specularmap,kt.envmap,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.fog,kt.lights,{emissive:{value:new It(0)}}]),vertexShader:un.meshlambert_vert,fragmentShader:un.meshlambert_frag},phong:{uniforms:Ms([kt.common,kt.specularmap,kt.envmap,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.fog,kt.lights,{emissive:{value:new It(0)},specular:{value:new It(1118481)},shininess:{value:30}}]),vertexShader:un.meshphong_vert,fragmentShader:un.meshphong_frag},standard:{uniforms:Ms([kt.common,kt.envmap,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.roughnessmap,kt.metalnessmap,kt.fog,kt.lights,{emissive:{value:new It(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:un.meshphysical_vert,fragmentShader:un.meshphysical_frag},toon:{uniforms:Ms([kt.common,kt.aomap,kt.lightmap,kt.emissivemap,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.gradientmap,kt.fog,kt.lights,{emissive:{value:new It(0)}}]),vertexShader:un.meshtoon_vert,fragmentShader:un.meshtoon_frag},matcap:{uniforms:Ms([kt.common,kt.bumpmap,kt.normalmap,kt.displacementmap,kt.fog,{matcap:{value:null}}]),vertexShader:un.meshmatcap_vert,fragmentShader:un.meshmatcap_frag},points:{uniforms:Ms([kt.points,kt.fog]),vertexShader:un.points_vert,fragmentShader:un.points_frag},dashed:{uniforms:Ms([kt.common,kt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:un.linedashed_vert,fragmentShader:un.linedashed_frag},depth:{uniforms:Ms([kt.common,kt.displacementmap]),vertexShader:un.depth_vert,fragmentShader:un.depth_frag},normal:{uniforms:Ms([kt.common,kt.bumpmap,kt.normalmap,kt.displacementmap,{opacity:{value:1}}]),vertexShader:un.meshnormal_vert,fragmentShader:un.meshnormal_frag},sprite:{uniforms:Ms([kt.sprite,kt.fog]),vertexShader:un.sprite_vert,fragmentShader:un.sprite_frag},background:{uniforms:{uvTransform:{value:new bn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:un.background_vert,fragmentShader:un.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:un.backgroundCube_vert,fragmentShader:un.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:un.cube_vert,fragmentShader:un.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:un.equirect_vert,fragmentShader:un.equirect_frag},distanceRGBA:{uniforms:Ms([kt.common,kt.displacementmap,{referencePosition:{value:new Te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:un.distanceRGBA_vert,fragmentShader:un.distanceRGBA_frag},shadow:{uniforms:Ms([kt.lights,kt.fog,{color:{value:new It(0)},opacity:{value:1}}]),vertexShader:un.shadow_vert,fragmentShader:un.shadow_frag}};Ta.physical={uniforms:Ms([Ta.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new bn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new bn},clearcoatNormalScale:{value:new yt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new bn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new bn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new bn},sheen:{value:0},sheenColor:{value:new It(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new bn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new bn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new bn},transmissionSamplerSize:{value:new yt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new bn},attenuationDistance:{value:0},attenuationColor:{value:new It(0)},specularColor:{value:new It(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new bn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new bn},anisotropyVector:{value:new yt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new bn}}]),vertexShader:un.meshphysical_vert,fragmentShader:un.meshphysical_frag};const C_={r:0,b:0,g:0};function sY(i,e,t,n,r,s,o){const a=new It(0);let l=s===!0?0:1,c,u,h=null,d=0,f=null;function p(v,g){let b=!1,m=g.isScene===!0?g.background:null;m&&m.isTexture&&(m=(g.backgroundBlurriness>0?t:e).get(m)),m===null?_(a,l):m&&m.isColor&&(_(m,1),b=!0);const y=i.xr.getEnvironmentBlendMode();y==="additive"?n.buffers.color.setClear(0,0,0,1,o):y==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||b)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),m&&(m.isCubeTexture||m.mapping===Am)?(u===void 0&&(u=new Tn(new F1(1,1,1),new Al({name:"BackgroundCubeMaterial",uniforms:om(Ta.backgroundCube.uniforms),vertexShader:Ta.backgroundCube.vertexShader,fragmentShader:Ta.backgroundCube.fragmentShader,side:Is,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(A,w,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=m,u.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=Vn.getTransfer(m.colorSpace)!==ti,(h!==m||d!==m.version||f!==i.toneMapping)&&(u.material.needsUpdate=!0,h=m,d=m.version,f=i.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):m&&m.isTexture&&(c===void 0&&(c=new Tn(new Va(2,2),new Al({name:"BackgroundMaterial",uniforms:om(Ta.background.uniforms),vertexShader:Ta.background.vertexShader,fragmentShader:Ta.background.fragmentShader,side:Sl,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=m,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=Vn.getTransfer(m.colorSpace)!==ti,m.matrixAutoUpdate===!0&&m.updateMatrix(),c.material.uniforms.uvTransform.value.copy(m.matrix),(h!==m||d!==m.version||f!==i.toneMapping)&&(c.material.needsUpdate=!0,h=m,d=m.version,f=i.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}function _(v,g){v.getRGB(C_,L6(i)),n.buffers.color.setClear(C_.r,C_.g,C_.b,g,o)}return{getClearColor:function(){return a},setClearColor:function(v,g=1){a.set(v),l=g,_(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,_(a,l)},render:p}}function oY(i,e,t,n){const r=i.getParameter(i.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=v(null);let c=l,u=!1;function h(R,F,V,G,U){let z=!1;if(o){const O=_(G,V,F);c!==O&&(c=O,f(c.object)),z=g(R,G,V,U),z&&b(R,G,V,U)}else{const O=F.wireframe===!0;(c.geometry!==G.id||c.program!==V.id||c.wireframe!==O)&&(c.geometry=G.id,c.program=V.id,c.wireframe=O,z=!0)}U!==null&&t.update(U,i.ELEMENT_ARRAY_BUFFER),(z||u)&&(u=!1,T(R,F,V,G),U!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.get(U).buffer))}function d(){return n.isWebGL2?i.createVertexArray():s.createVertexArrayOES()}function f(R){return n.isWebGL2?i.bindVertexArray(R):s.bindVertexArrayOES(R)}function p(R){return n.isWebGL2?i.deleteVertexArray(R):s.deleteVertexArrayOES(R)}function _(R,F,V){const G=V.wireframe===!0;let U=a[R.id];U===void 0&&(U={},a[R.id]=U);let z=U[F.id];z===void 0&&(z={},U[F.id]=z);let O=z[G];return O===void 0&&(O=v(d()),z[G]=O),O}function v(R){const F=[],V=[],G=[];for(let U=0;U<r;U++)F[U]=0,V[U]=0,G[U]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:V,attributeDivisors:G,object:R,attributes:{},index:null}}function g(R,F,V,G){const U=c.attributes,z=F.attributes;let O=0;const D=V.getAttributes();for(const B in D)if(D[B].location>=0){const q=U[B];let j=z[B];if(j===void 0&&(B==="instanceMatrix"&&R.instanceMatrix&&(j=R.instanceMatrix),B==="instanceColor"&&R.instanceColor&&(j=R.instanceColor)),q===void 0||q.attribute!==j||j&&q.data!==j.data)return!0;O++}return c.attributesNum!==O||c.index!==G}function b(R,F,V,G){const U={},z=F.attributes;let O=0;const D=V.getAttributes();for(const B in D)if(D[B].location>=0){let q=z[B];q===void 0&&(B==="instanceMatrix"&&R.instanceMatrix&&(q=R.instanceMatrix),B==="instanceColor"&&R.instanceColor&&(q=R.instanceColor));const j={};j.attribute=q,q&&q.data&&(j.data=q.data),U[B]=j,O++}c.attributes=U,c.attributesNum=O,c.index=G}function m(){const R=c.newAttributes;for(let F=0,V=R.length;F<V;F++)R[F]=0}function y(R){A(R,0)}function A(R,F){const V=c.newAttributes,G=c.enabledAttributes,U=c.attributeDivisors;V[R]=1,G[R]===0&&(i.enableVertexAttribArray(R),G[R]=1),U[R]!==F&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,F),U[R]=F)}function w(){const R=c.newAttributes,F=c.enabledAttributes;for(let V=0,G=F.length;V<G;V++)F[V]!==R[V]&&(i.disableVertexAttribArray(V),F[V]=0)}function M(R,F,V,G,U,z,O){O===!0?i.vertexAttribIPointer(R,F,V,U,z):i.vertexAttribPointer(R,F,V,G,U,z)}function T(R,F,V,G){if(n.isWebGL2===!1&&(R.isInstancedMesh||G.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;m();const U=G.attributes,z=V.getAttributes(),O=F.defaultAttributeValues;for(const D in z){const B=z[D];if(B.location>=0){let W=U[D];if(W===void 0&&(D==="instanceMatrix"&&R.instanceMatrix&&(W=R.instanceMatrix),D==="instanceColor"&&R.instanceColor&&(W=R.instanceColor)),W!==void 0){const q=W.normalized,j=W.itemSize,te=t.get(W);if(te===void 0)continue;const ne=te.buffer,Z=te.type,le=te.bytesPerElement,re=n.isWebGL2===!0&&(Z===i.INT||Z===i.UNSIGNED_INT||W.gpuType===tR);if(W.isInterleavedBufferAttribute){const se=W.data,$=se.stride,fe=W.offset;if(se.isInstancedInterleavedBuffer){for(let xe=0;xe<B.locationSize;xe++)A(B.location+xe,se.meshPerAttribute);R.isInstancedMesh!==!0&&G._maxInstanceCount===void 0&&(G._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let xe=0;xe<B.locationSize;xe++)y(B.location+xe);i.bindBuffer(i.ARRAY_BUFFER,ne);for(let xe=0;xe<B.locationSize;xe++)M(B.location+xe,j/B.locationSize,Z,q,$*le,(fe+j/B.locationSize*xe)*le,re)}else{if(W.isInstancedBufferAttribute){for(let se=0;se<B.locationSize;se++)A(B.location+se,W.meshPerAttribute);R.isInstancedMesh!==!0&&G._maxInstanceCount===void 0&&(G._maxInstanceCount=W.meshPerAttribute*W.count)}else for(let se=0;se<B.locationSize;se++)y(B.location+se);i.bindBuffer(i.ARRAY_BUFFER,ne);for(let se=0;se<B.locationSize;se++)M(B.location+se,j/B.locationSize,Z,q,j*le,j/B.locationSize*se*le,re)}}else if(O!==void 0){const q=O[D];if(q!==void 0)switch(q.length){case 2:i.vertexAttrib2fv(B.location,q);break;case 3:i.vertexAttrib3fv(B.location,q);break;case 4:i.vertexAttrib4fv(B.location,q);break;default:i.vertexAttrib1fv(B.location,q)}}}}w()}function E(){P();for(const R in a){const F=a[R];for(const V in F){const G=F[V];for(const U in G)p(G[U].object),delete G[U];delete F[V]}delete a[R]}}function C(R){if(a[R.id]===void 0)return;const F=a[R.id];for(const V in F){const G=F[V];for(const U in G)p(G[U].object),delete G[U];delete F[V]}delete a[R.id]}function N(R){for(const F in a){const V=a[F];if(V[R.id]===void 0)continue;const G=V[R.id];for(const U in G)p(G[U].object),delete G[U];delete V[R.id]}}function P(){L(),u=!0,c!==l&&(c=l,f(c.object))}function L(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:P,resetDefaultState:L,dispose:E,releaseStatesOfGeometry:C,releaseStatesOfProgram:N,initAttributes:m,enableAttribute:y,disableUnusedAttributes:w}}function aY(i,e,t,n){const r=n.isWebGL2;let s;function o(u){s=u}function a(u,h){i.drawArrays(s,u,h),t.update(h,s,1)}function l(u,h,d){if(d===0)return;let f,p;if(r)f=i,p="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[p](s,u,h,d),t.update(h,s,d)}function c(u,h,d){if(d===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<d;p++)this.render(u[p],h[p]);else{f.multiDrawArraysWEBGL(s,u,0,h,0,d);let p=0;for(let _=0;_<d;_++)p+=h[_];t.update(p,s,1)}}this.setMode=o,this.render=a,this.renderInstances=l,this.renderMultiDraw=c}function lY(i,e,t){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(M){if(M==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&i.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),d=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=i.getParameter(i.MAX_TEXTURE_SIZE),p=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),_=i.getParameter(i.MAX_VERTEX_ATTRIBS),v=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),g=i.getParameter(i.MAX_VARYING_VECTORS),b=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),m=d>0,y=o||e.has("OES_texture_float"),A=m&&y,w=o?i.getParameter(i.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:_,maxVertexUniforms:v,maxVaryings:g,maxFragmentUniforms:b,vertexTextures:m,floatFragmentTextures:y,floatVertexTextures:A,maxSamples:w}}function cY(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new lu,a=new bn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||n!==0||r;return r=d,n=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=u(h,d,0)},this.setState=function(h,d,f){const p=h.clippingPlanes,_=h.clipIntersection,v=h.clipShadows,g=i.get(h);if(!r||p===null||p.length===0||s&&!v)s?u(null):c();else{const b=s?0:n,m=b*4;let y=g.clippingState||null;l.value=y,y=u(p,d,m,f);for(let A=0;A!==m;++A)y[A]=t[A];g.clippingState=y,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,d,f,p){const _=h!==null?h.length:0;let v=null;if(_!==0){if(v=l.value,p!==!0||v===null){const g=f+_*4,b=d.matrixWorldInverse;a.getNormalMatrix(b),(v===null||v.length<g)&&(v=new Float32Array(g));for(let m=0,y=f;m!==_;++m,y+=4)o.copy(h[m]).applyMatrix4(b,a),o.normal.toArray(v,y),v[y+3]=o.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,v}}function uY(i){let e=new WeakMap;function t(o,a){return a===e1?o.mapping=xc:a===t1&&(o.mapping=Ou),o}function n(o){if(o&&o.isTexture){const a=o.mapping;if(a===e1||a===t1)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new N6(l.height/2);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}let Ku=class extends k1{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};const bp=4,zD=[.125,.215,.35,.446,.526,.582],$h=20,jw=new Ku,GD=new It;let Xw=null,qw=0,Yw=0;const Bh=(1+Math.sqrt(5))/2,bf=1/Bh,VD=[new Te(1,1,1),new Te(-1,1,1),new Te(1,1,-1),new Te(-1,1,-1),new Te(0,Bh,bf),new Te(0,Bh,-bf),new Te(bf,0,Bh),new Te(-bf,0,Bh),new Te(Bh,bf,0),new Te(-Bh,bf,0)];let XT=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){Xw=this._renderer.getRenderTarget(),qw=this._renderer.getActiveCubeFace(),Yw=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=WD(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=$D(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Xw,qw,Yw),e.scissorTest=!1,P_(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===xc||e.mapping===Ou?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Xw=this._renderer.getRenderTarget(),qw=this._renderer.getActiveCubeFace(),Yw=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:hi,minFilter:hi,generateMipmaps:!1,type:nm,format:Ps,colorSpace:Ml,depthBuffer:!1},r=HD(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=HD(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=hY(s)),this._blurMaterial=dY(s,e,t)}return r}_compileMaterial(e){const t=new Tn(this._lodPlanes[0],e);this._renderer.compile(t,jw)}_sceneToCubeUV(e,t,n,r){const a=new Zi(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(GD),u.toneMapping=pl,u.autoClear=!1;const f=new fi({name:"PMREM.Background",side:Is,depthWrite:!1,depthTest:!1}),p=new Tn(new F1,f);let _=!1;const v=e.background;v?v.isColor&&(f.color.copy(v),e.background=null,_=!0):(f.color.copy(GD),_=!0);for(let g=0;g<6;g++){const b=g%3;b===0?(a.up.set(0,l[g],0),a.lookAt(c[g],0,0)):b===1?(a.up.set(0,0,l[g]),a.lookAt(0,c[g],0)):(a.up.set(0,l[g],0),a.lookAt(0,0,c[g]));const m=this._cubeSize;P_(r,b*m,g>2?m:0,m,m),u.setRenderTarget(r),_&&u.render(p,a),u.render(e,a)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=d,u.autoClear=h,e.background=v}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===xc||e.mapping===Ou;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=WD()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=$D());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new Tn(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;P_(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,jw)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=VD[(r-1)%VD.length];this._blur(e,r-1,r,s,o)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new Tn(this._lodPlanes[r],c),d=c.uniforms,f=this._sizeLods[n]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*$h-1),_=s/p,v=isFinite(s)?1+Math.floor(u*_):$h;v>$h&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${$h}`);const g=[];let b=0;for(let M=0;M<$h;++M){const T=M/_,E=Math.exp(-T*T/2);g.push(E),M===0?b+=E:M<v&&(b+=2*E)}for(let M=0;M<g.length;M++)g[M]=g[M]/b;d.envMap.value=e.texture,d.samples.value=v,d.weights.value=g,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:m}=this;d.dTheta.value=p,d.mipInt.value=m-n;const y=this._sizeLods[r],A=3*y*(r>m-bp?r-m+bp:0),w=4*(this._cubeSize-y);P_(t,A,w,3*y,2*y),l.setRenderTarget(t),l.render(h,jw)}};function hY(i){const e=[],t=[],n=[];let r=i;const s=i-bp+1+zD.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>i-bp?l=zD[o-i+bp-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,p=6,_=3,v=2,g=1,b=new Float32Array(_*p*f),m=new Float32Array(v*p*f),y=new Float32Array(g*p*f);for(let w=0;w<f;w++){const M=w%3*2/3-1,T=w>2?0:-1,E=[M,T,0,M+2/3,T,0,M+2/3,T+1,0,M,T,0,M+2/3,T+1,0,M,T+1,0];b.set(E,_*p*w),m.set(d,v*p*w);const C=[w,w,w,w,w,w];y.set(C,g*p*w)}const A=new mn;A.setAttribute("position",new An(b,_)),A.setAttribute("uv",new An(m,v)),A.setAttribute("faceIndex",new An(y,g)),e.push(A),r>bp&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function HD(i,e,t){const n=new Ga(i,e,t);return n.texture.mapping=Am,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function P_(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function dY(i,e,t){const n=new Float32Array($h),r=new Te(0,1,0);return new Al({name:"SphericalGaussianBlur",defines:{n:$h,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:yR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:dc,depthTest:!1,depthWrite:!1})}function $D(){return new Al({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:yR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:dc,depthTest:!1,depthWrite:!1})}function WD(){return new Al({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:yR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:dc,depthTest:!1,depthWrite:!1})}function yR(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function fY(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===e1||l===t1,u=l===xc||l===Ou;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new XT(i)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{const h=a.image;if(c&&h&&h.height>0||u&&h&&r(h)){t===null&&(t=new XT(i));const d=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",s),d.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function pY(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const r=t(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function mY(i,e,t,n){const r={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);for(const p in d.morphAttributes){const _=d.morphAttributes[p];for(let v=0,g=_.length;v<g;v++)e.remove(_[v])}d.removeEventListener("dispose",o),delete r[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const p in d)e.update(d[p],i.ARRAY_BUFFER);const f=h.morphAttributes;for(const p in f){const _=f[p];for(let v=0,g=_.length;v<g;v++)e.update(_[v],i.ARRAY_BUFFER)}}function c(h){const d=[],f=h.index,p=h.attributes.position;let _=0;if(f!==null){const b=f.array;_=f.version;for(let m=0,y=b.length;m<y;m+=3){const A=b[m+0],w=b[m+1],M=b[m+2];d.push(A,w,w,M,M,A)}}else if(p!==void 0){const b=p.array;_=p.version;for(let m=0,y=b.length/3-1;m<y;m+=3){const A=m+0,w=m+1,M=m+2;d.push(A,w,w,M,M,A)}}else return;const v=new(w6(d)?vR:gR)(d,1);v.version=_;const g=s.get(h);g&&e.remove(g),s.set(h,v)}function u(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function gY(i,e,t,n){const r=n.isWebGL2;let s;function o(f){s=f}let a,l;function c(f){a=f.type,l=f.bytesPerElement}function u(f,p){i.drawElements(s,p,a,f*l),t.update(p,s,1)}function h(f,p,_){if(_===0)return;let v,g;if(r)v=i,g="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[g](s,p,a,f*l,_),t.update(p,s,_)}function d(f,p,_){if(_===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let g=0;g<_;g++)this.render(f[g]/l,p[g]);else{v.multiDrawElementsWEBGL(s,p,0,a,f,0,_);let g=0;for(let b=0;b<_;b++)g+=p[b];t.update(g,s,1)}}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h,this.renderMultiDraw=d}function vY(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=a*(s/3);break;case i.LINES:t.lines+=a*(s/2);break;case i.LINE_STRIP:t.lines+=a*(s-1);break;case i.LINE_LOOP:t.lines+=a*s;break;case i.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function _Y(i,e){return i[0]-e[0]}function yY(i,e){return Math.abs(e[1])-Math.abs(i[1])}function xY(i,e,t){const n={},r=new Float32Array(8),s=new WeakMap,o=new Wn,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,h){const d=c.morphTargetInfluences;if(e.isWebGL2===!0){const p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,_=p!==void 0?p.length:0;let v=s.get(u);if(v===void 0||v.count!==_){let F=function(){L.dispose(),s.delete(u),u.removeEventListener("dispose",F)};var f=F;v!==void 0&&v.texture.dispose();const m=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,A=u.morphAttributes.color!==void 0,w=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],T=u.morphAttributes.color||[];let E=0;m===!0&&(E=1),y===!0&&(E=2),A===!0&&(E=3);let C=u.attributes.position.count*E,N=1;C>e.maxTextureSize&&(N=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const P=new Float32Array(C*N*4*_),L=new yS(P,C,N,_);L.type=Na,L.needsUpdate=!0;const R=E*4;for(let V=0;V<_;V++){const G=w[V],U=M[V],z=T[V],O=C*N*4*V;for(let D=0;D<G.count;D++){const B=D*R;m===!0&&(o.fromBufferAttribute(G,D),P[O+B+0]=o.x,P[O+B+1]=o.y,P[O+B+2]=o.z,P[O+B+3]=0),y===!0&&(o.fromBufferAttribute(U,D),P[O+B+4]=o.x,P[O+B+5]=o.y,P[O+B+6]=o.z,P[O+B+7]=0),A===!0&&(o.fromBufferAttribute(z,D),P[O+B+8]=o.x,P[O+B+9]=o.y,P[O+B+10]=o.z,P[O+B+11]=z.itemSize===4?o.w:1)}}v={count:_,texture:L,size:new yt(C,N)},s.set(u,v),u.addEventListener("dispose",F)}let g=0;for(let m=0;m<d.length;m++)g+=d[m];const b=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(i,"morphTargetBaseInfluence",b),h.getUniforms().setValue(i,"morphTargetInfluences",d),h.getUniforms().setValue(i,"morphTargetsTexture",v.texture,t),h.getUniforms().setValue(i,"morphTargetsTextureSize",v.size)}else{const p=d===void 0?0:d.length;let _=n[u.id];if(_===void 0||_.length!==p){_=[];for(let y=0;y<p;y++)_[y]=[y,0];n[u.id]=_}for(let y=0;y<p;y++){const A=_[y];A[0]=y,A[1]=d[y]}_.sort(yY);for(let y=0;y<8;y++)y<p&&_[y][1]?(a[y][0]=_[y][0],a[y][1]=_[y][1]):(a[y][0]=Number.MAX_SAFE_INTEGER,a[y][1]=0);a.sort(_Y);const v=u.morphAttributes.position,g=u.morphAttributes.normal;let b=0;for(let y=0;y<8;y++){const A=a[y],w=A[0],M=A[1];w!==Number.MAX_SAFE_INTEGER&&M?(v&&u.getAttribute("morphTarget"+y)!==v[w]&&u.setAttribute("morphTarget"+y,v[w]),g&&u.getAttribute("morphNormal"+y)!==g[w]&&u.setAttribute("morphNormal"+y,g[w]),r[y]=M,b+=M):(v&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),g&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),r[y]=0)}const m=u.morphTargetsRelative?1:1-b;h.getUniforms().setValue(i,"morphTargetBaseInfluence",m),h.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function bY(i,e,t,n){let r=new WeakMap;function s(l){const c=n.render.frame,u=l.geometry,h=e.get(l,u);if(r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==c&&(d.update(),r.set(d,c))}return h}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}let xR=class extends dr{constructor(e,t,n,r,s,o,a,l,c,u){if(u=u!==void 0?u:Cu,u!==Cu&&u!==wd)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===Cu&&(n=lc),n===void 0&&u===wd&&(n=Tu),super(null,r,s,o,a,l,u,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:zi,this.minFilter=l!==void 0?l:zi,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}};const U6=new dr,O6=new xR(1,1);O6.compareFunction=dR;const B6=new yS,z6=new mR,G6=new U1,jD=[],XD=[],qD=new Float32Array(16),YD=new Float32Array(9),KD=new Float32Array(4);function Tm(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=jD[r];if(s===void 0&&(s=new Float32Array(r),jD[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(s,a)}return s}function xr(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function br(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function xS(i,e){let t=XD[e];t===void 0&&(t=new Int32Array(e),XD[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function SY(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function wY(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(xr(t,e))return;i.uniform2fv(this.addr,e),br(t,e)}}function MY(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(xr(t,e))return;i.uniform3fv(this.addr,e),br(t,e)}}function AY(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(xr(t,e))return;i.uniform4fv(this.addr,e),br(t,e)}}function EY(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(xr(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),br(t,e)}else{if(xr(t,n))return;KD.set(n),i.uniformMatrix2fv(this.addr,!1,KD),br(t,n)}}function TY(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(xr(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),br(t,e)}else{if(xr(t,n))return;YD.set(n),i.uniformMatrix3fv(this.addr,!1,YD),br(t,n)}}function CY(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(xr(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),br(t,e)}else{if(xr(t,n))return;qD.set(n),i.uniformMatrix4fv(this.addr,!1,qD),br(t,n)}}function PY(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function RY(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(xr(t,e))return;i.uniform2iv(this.addr,e),br(t,e)}}function IY(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(xr(t,e))return;i.uniform3iv(this.addr,e),br(t,e)}}function LY(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(xr(t,e))return;i.uniform4iv(this.addr,e),br(t,e)}}function DY(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function NY(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(xr(t,e))return;i.uniform2uiv(this.addr,e),br(t,e)}}function FY(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(xr(t,e))return;i.uniform3uiv(this.addr,e),br(t,e)}}function kY(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(xr(t,e))return;i.uniform4uiv(this.addr,e),br(t,e)}}function UY(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r);const s=this.type===i.SAMPLER_2D_SHADOW?O6:U6;t.setTexture2D(e||s,r)}function OY(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||z6,r)}function BY(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||G6,r)}function zY(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||B6,r)}function GY(i){switch(i){case 5126:return SY;case 35664:return wY;case 35665:return MY;case 35666:return AY;case 35674:return EY;case 35675:return TY;case 35676:return CY;case 5124:case 35670:return PY;case 35667:case 35671:return RY;case 35668:case 35672:return IY;case 35669:case 35673:return LY;case 5125:return DY;case 36294:return NY;case 36295:return FY;case 36296:return kY;case 35678:case 36198:case 36298:case 36306:case 35682:return UY;case 35679:case 36299:case 36307:return OY;case 35680:case 36300:case 36308:case 36293:return BY;case 36289:case 36303:case 36311:case 36292:return zY}}function VY(i,e){i.uniform1fv(this.addr,e)}function HY(i,e){const t=Tm(e,this.size,2);i.uniform2fv(this.addr,t)}function $Y(i,e){const t=Tm(e,this.size,3);i.uniform3fv(this.addr,t)}function WY(i,e){const t=Tm(e,this.size,4);i.uniform4fv(this.addr,t)}function jY(i,e){const t=Tm(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function XY(i,e){const t=Tm(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function qY(i,e){const t=Tm(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function YY(i,e){i.uniform1iv(this.addr,e)}function KY(i,e){i.uniform2iv(this.addr,e)}function ZY(i,e){i.uniform3iv(this.addr,e)}function QY(i,e){i.uniform4iv(this.addr,e)}function JY(i,e){i.uniform1uiv(this.addr,e)}function eK(i,e){i.uniform2uiv(this.addr,e)}function tK(i,e){i.uniform3uiv(this.addr,e)}function nK(i,e){i.uniform4uiv(this.addr,e)}function iK(i,e,t){const n=this.cache,r=e.length,s=xS(t,r);xr(n,s)||(i.uniform1iv(this.addr,s),br(n,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||U6,s[o])}function rK(i,e,t){const n=this.cache,r=e.length,s=xS(t,r);xr(n,s)||(i.uniform1iv(this.addr,s),br(n,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||z6,s[o])}function sK(i,e,t){const n=this.cache,r=e.length,s=xS(t,r);xr(n,s)||(i.uniform1iv(this.addr,s),br(n,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||G6,s[o])}function oK(i,e,t){const n=this.cache,r=e.length,s=xS(t,r);xr(n,s)||(i.uniform1iv(this.addr,s),br(n,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||B6,s[o])}function aK(i){switch(i){case 5126:return VY;case 35664:return HY;case 35665:return $Y;case 35666:return WY;case 35674:return jY;case 35675:return XY;case 35676:return qY;case 5124:case 35670:return YY;case 35667:case 35671:return KY;case 35668:case 35672:return ZY;case 35669:case 35673:return QY;case 5125:return JY;case 36294:return eK;case 36295:return tK;case 36296:return nK;case 35678:case 36198:case 36298:case 36306:case 35682:return iK;case 35679:case 36299:case 36307:return rK;case 35680:case 36300:case 36308:case 36293:return sK;case 36289:case 36303:case 36311:case 36292:return oK}}let lK=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=GY(t.type)}},cK=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=aK(t.type)}},uK=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],n)}}};const Kw=/(\w+)(\])?(\[|\.)?/g;function ZD(i,e){i.seq.push(e),i.map[e.id]=e}function hK(i,e,t){const n=i.name,r=n.length;for(Kw.lastIndex=0;;){const s=Kw.exec(n),o=Kw.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){ZD(t,c===void 0?new lK(a,i,e):new cK(a,i,e));break}else{let h=t.map[a];h===void 0&&(h=new uK(a),ZD(t,h)),t=h}}}let Cx=class{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);hK(s,o,this)}}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&n.push(o)}return n}};function QD(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const dK=37297;let fK=0;function pK(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}function mK(i){const e=Vn.getPrimaries(Vn.workingColorSpace),t=Vn.getPrimaries(i);let n;switch(e===t?n="":e===o1&&t===s1?n="LinearDisplayP3ToLinearSRGB":e===s1&&t===o1&&(n="LinearSRGBToLinearDisplayP3"),i){case Ml:case D1:return[n,"LinearTransferOETF"];case _r:case _S:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",i),[n,"LinearTransferOETF"]}}function JD(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+pK(i.getShaderSource(e),o)}else return r}function gK(i,e){const t=mK(e);return`vec4 ${i}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function vK(i,e){let t;switch(e){case qz:t="Linear";break;case Yz:t="Reinhard";break;case Kz:t="OptimizedCineon";break;case eR:t="ACESFilmic";break;case Qz:t="AgX";break;case Zz:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function _K(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Sp).join(`
`)}function yK(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(Sp).join(`
`)}function xK(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function bK(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let a=1;s.type===i.FLOAT_MAT2&&(a=2),s.type===i.FLOAT_MAT3&&(a=3),s.type===i.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function Sp(i){return i!==""}function eN(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function tN(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const SK=/^[ \t]*#include +<([\w\d./]+)>/gm;function qT(i){return i.replace(SK,MK)}const wK=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function MK(i,e){let t=un[e];if(t===void 0){const n=wK.get(e);if(n!==void 0)t=un[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return qT(t)}const AK=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function nN(i){return i.replace(AK,EK)}function EK(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function iN(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function TK(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===fS?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===x0?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===wa&&(e="SHADOWMAP_TYPE_VSM"),e}function CK(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case xc:case Ou:e="ENVMAP_TYPE_CUBE";break;case Am:e="ENVMAP_TYPE_CUBE_UV";break}return e}function PK(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Ou:e="ENVMAP_MODE_REFRACTION";break}return e}function RK(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case L1:e="ENVMAP_BLENDING_MULTIPLY";break;case jz:e="ENVMAP_BLENDING_MIX";break;case Xz:e="ENVMAP_BLENDING_ADD";break}return e}function IK(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function LK(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=TK(t),c=CK(t),u=PK(t),h=RK(t),d=IK(t),f=t.isWebGL2?"":_K(t),p=yK(t),_=xK(s),v=r.createProgram();let g,b,m=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(Sp).join(`
`),g.length>0&&(g+=`
`),b=[f,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(Sp).join(`
`),b.length>0&&(b+=`
`)):(g=[iN(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Sp).join(`
`),b=[f,iN(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==pl?"#define TONE_MAPPING":"",t.toneMapping!==pl?un.tonemapping_pars_fragment:"",t.toneMapping!==pl?vK("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",un.colorspace_pars_fragment,gK("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Sp).join(`
`)),o=qT(o),o=eN(o,t),o=tN(o,t),a=qT(a),a=eN(a,t),a=tN(a,t),o=nN(o),a=nN(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(m=`#version 300 es
`,g=[p,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,b=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===$T?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===$T?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);const y=m+g+o,A=m+b+a,w=QD(r,r.VERTEX_SHADER,y),M=QD(r,r.FRAGMENT_SHADER,A);r.attachShader(v,w),r.attachShader(v,M),t.index0AttributeName!==void 0?r.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v);function T(P){if(i.debug.checkShaderErrors){const L=r.getProgramInfoLog(v).trim(),R=r.getShaderInfoLog(w).trim(),F=r.getShaderInfoLog(M).trim();let V=!0,G=!0;if(r.getProgramParameter(v,r.LINK_STATUS)===!1)if(V=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,v,w,M);else{const U=JD(r,w,"vertex"),z=JD(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(v,r.VALIDATE_STATUS)+`

Program Info Log: `+L+`
`+U+`
`+z)}else L!==""?console.warn("THREE.WebGLProgram: Program Info Log:",L):(R===""||F==="")&&(G=!1);G&&(P.diagnostics={runnable:V,programLog:L,vertexShader:{log:R,prefix:g},fragmentShader:{log:F,prefix:b}})}r.deleteShader(w),r.deleteShader(M),E=new Cx(r,v),C=bK(r,v)}let E;this.getUniforms=function(){return E===void 0&&T(this),E};let C;this.getAttributes=function(){return C===void 0&&T(this),C};let N=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return N===!1&&(N=r.getProgramParameter(v,dK)),N},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=fK++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=M,this}let DK=0,NK=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new FK(e),t.set(e,n)),n}},FK=class{constructor(e){this.id=DK++,this.code=e,this.usedTimes=0}};function kK(i,e,t,n,r,s,o){const a=new ad,l=new NK,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures;let f=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(E){return E===0?"uv":`uv${E}`}function v(E,C,N,P,L){const R=P.fog,F=L.geometry,V=E.isMeshStandardMaterial?P.environment:null,G=(E.isMeshStandardMaterial?t:e).get(E.envMap||V),U=G&&G.mapping===Am?G.image.height:null,z=p[E.type];E.precision!==null&&(f=r.getMaxPrecision(E.precision),f!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",f,"instead."));const O=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,D=O!==void 0?O.length:0;let B=0;F.morphAttributes.position!==void 0&&(B=1),F.morphAttributes.normal!==void 0&&(B=2),F.morphAttributes.color!==void 0&&(B=3);let W,q,j,te;if(z){const J=Ta[z];W=J.vertexShader,q=J.fragmentShader}else W=E.vertexShader,q=E.fragmentShader,l.update(E),j=l.getVertexShaderID(E),te=l.getFragmentShaderID(E);const ne=i.getRenderTarget(),Z=L.isInstancedMesh===!0,le=L.isBatchedMesh===!0,re=!!E.map,se=!!E.matcap,$=!!G,fe=!!E.aoMap,xe=!!E.lightMap,Ie=!!E.bumpMap,ge=!!E.normalMap,Oe=!!E.displacementMap,Me=!!E.emissiveMap,Y=!!E.metalnessMap,Q=!!E.roughnessMap,de=E.anisotropy>0,Le=E.clearcoat>0,ie=E.iridescence>0,K=E.sheen>0,be=E.transmission>0,Ue=de&&!!E.anisotropyMap,ve=Le&&!!E.clearcoatMap,Ne=Le&&!!E.clearcoatNormalMap,$e=Le&&!!E.clearcoatRoughnessMap,Ee=ie&&!!E.iridescenceMap,Ze=ie&&!!E.iridescenceThicknessMap,nt=K&&!!E.sheenColorMap,rt=K&&!!E.sheenRoughnessMap,Be=!!E.specularMap,qe=!!E.specularColorMap,it=!!E.specularIntensityMap,at=be&&!!E.transmissionMap,ht=be&&!!E.thicknessMap,Qe=!!E.gradientMap,je=!!E.alphaMap,ee=E.alphaTest>0,Ge=!!E.alphaHash,Ce=!!E.extensions,De=!!F.attributes.uv1,Xe=!!F.attributes.uv2,gt=!!F.attributes.uv3;let _t=pl;return E.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(_t=i.toneMapping),{isWebGL2:u,shaderID:z,shaderType:E.type,shaderName:E.name,vertexShader:W,fragmentShader:q,defines:E.defines,customVertexShaderID:j,customFragmentShaderID:te,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:f,batching:le,instancing:Z,instancingColor:Z&&L.instanceColor!==null,supportsVertexTextures:d,outputColorSpace:ne===null?i.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:Ml,map:re,matcap:se,envMap:$,envMapMode:$&&G.mapping,envMapCubeUVHeight:U,aoMap:fe,lightMap:xe,bumpMap:Ie,normalMap:ge,displacementMap:d&&Oe,emissiveMap:Me,normalMapObjectSpace:ge&&E.normalMapType===f6,normalMapTangentSpace:ge&&E.normalMapType===Yu,metalnessMap:Y,roughnessMap:Q,anisotropy:de,anisotropyMap:Ue,clearcoat:Le,clearcoatMap:ve,clearcoatNormalMap:Ne,clearcoatRoughnessMap:$e,iridescence:ie,iridescenceMap:Ee,iridescenceThicknessMap:Ze,sheen:K,sheenColorMap:nt,sheenRoughnessMap:rt,specularMap:Be,specularColorMap:qe,specularIntensityMap:it,transmission:be,transmissionMap:at,thicknessMap:ht,gradientMap:Qe,opaque:E.transparent===!1&&E.blending===sd,alphaMap:je,alphaTest:ee,alphaHash:Ge,combine:E.combine,mapUv:re&&_(E.map.channel),aoMapUv:fe&&_(E.aoMap.channel),lightMapUv:xe&&_(E.lightMap.channel),bumpMapUv:Ie&&_(E.bumpMap.channel),normalMapUv:ge&&_(E.normalMap.channel),displacementMapUv:Oe&&_(E.displacementMap.channel),emissiveMapUv:Me&&_(E.emissiveMap.channel),metalnessMapUv:Y&&_(E.metalnessMap.channel),roughnessMapUv:Q&&_(E.roughnessMap.channel),anisotropyMapUv:Ue&&_(E.anisotropyMap.channel),clearcoatMapUv:ve&&_(E.clearcoatMap.channel),clearcoatNormalMapUv:Ne&&_(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:$e&&_(E.clearcoatRoughnessMap.channel),iridescenceMapUv:Ee&&_(E.iridescenceMap.channel),iridescenceThicknessMapUv:Ze&&_(E.iridescenceThicknessMap.channel),sheenColorMapUv:nt&&_(E.sheenColorMap.channel),sheenRoughnessMapUv:rt&&_(E.sheenRoughnessMap.channel),specularMapUv:Be&&_(E.specularMap.channel),specularColorMapUv:qe&&_(E.specularColorMap.channel),specularIntensityMapUv:it&&_(E.specularIntensityMap.channel),transmissionMapUv:at&&_(E.transmissionMap.channel),thicknessMapUv:ht&&_(E.thicknessMap.channel),alphaMapUv:je&&_(E.alphaMap.channel),vertexTangents:!!F.attributes.tangent&&(ge||de),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,vertexUv1s:De,vertexUv2s:Xe,vertexUv3s:gt,pointsUvs:L.isPoints===!0&&!!F.attributes.uv&&(re||je),fog:!!R,useFog:E.fog===!0,fogExp2:R&&R.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:L.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:D,morphTextureStride:B,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numSpotLightMaps:C.spotLightMap.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numSpotLightShadowsWithMaps:C.numSpotLightShadowsWithMaps,numLightProbes:C.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:E.dithering,shadowMapEnabled:i.shadowMap.enabled&&N.length>0,shadowMapType:i.shadowMap.type,toneMapping:_t,useLegacyLights:i._useLegacyLights,decodeVideoTexture:re&&E.map.isVideoTexture===!0&&Vn.getTransfer(E.map.colorSpace)===ti,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===cr,flipSided:E.side===Is,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:Ce&&E.extensions.derivatives===!0,extensionFragDepth:Ce&&E.extensions.fragDepth===!0,extensionDrawBuffers:Ce&&E.extensions.drawBuffers===!0,extensionShaderTextureLOD:Ce&&E.extensions.shaderTextureLOD===!0,extensionClipCullDistance:Ce&&E.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()}}function g(E){const C=[];if(E.shaderID?C.push(E.shaderID):(C.push(E.customVertexShaderID),C.push(E.customFragmentShaderID)),E.defines!==void 0)for(const N in E.defines)C.push(N),C.push(E.defines[N]);return E.isRawShaderMaterial===!1&&(b(C,E),m(C,E),C.push(i.outputColorSpace)),C.push(E.customProgramCacheKey),C.join()}function b(E,C){E.push(C.precision),E.push(C.outputColorSpace),E.push(C.envMapMode),E.push(C.envMapCubeUVHeight),E.push(C.mapUv),E.push(C.alphaMapUv),E.push(C.lightMapUv),E.push(C.aoMapUv),E.push(C.bumpMapUv),E.push(C.normalMapUv),E.push(C.displacementMapUv),E.push(C.emissiveMapUv),E.push(C.metalnessMapUv),E.push(C.roughnessMapUv),E.push(C.anisotropyMapUv),E.push(C.clearcoatMapUv),E.push(C.clearcoatNormalMapUv),E.push(C.clearcoatRoughnessMapUv),E.push(C.iridescenceMapUv),E.push(C.iridescenceThicknessMapUv),E.push(C.sheenColorMapUv),E.push(C.sheenRoughnessMapUv),E.push(C.specularMapUv),E.push(C.specularColorMapUv),E.push(C.specularIntensityMapUv),E.push(C.transmissionMapUv),E.push(C.thicknessMapUv),E.push(C.combine),E.push(C.fogExp2),E.push(C.sizeAttenuation),E.push(C.morphTargetsCount),E.push(C.morphAttributeCount),E.push(C.numDirLights),E.push(C.numPointLights),E.push(C.numSpotLights),E.push(C.numSpotLightMaps),E.push(C.numHemiLights),E.push(C.numRectAreaLights),E.push(C.numDirLightShadows),E.push(C.numPointLightShadows),E.push(C.numSpotLightShadows),E.push(C.numSpotLightShadowsWithMaps),E.push(C.numLightProbes),E.push(C.shadowMapType),E.push(C.toneMapping),E.push(C.numClippingPlanes),E.push(C.numClipIntersection),E.push(C.depthPacking)}function m(E,C){a.disableAll(),C.isWebGL2&&a.enable(0),C.supportsVertexTextures&&a.enable(1),C.instancing&&a.enable(2),C.instancingColor&&a.enable(3),C.matcap&&a.enable(4),C.envMap&&a.enable(5),C.normalMapObjectSpace&&a.enable(6),C.normalMapTangentSpace&&a.enable(7),C.clearcoat&&a.enable(8),C.iridescence&&a.enable(9),C.alphaTest&&a.enable(10),C.vertexColors&&a.enable(11),C.vertexAlphas&&a.enable(12),C.vertexUv1s&&a.enable(13),C.vertexUv2s&&a.enable(14),C.vertexUv3s&&a.enable(15),C.vertexTangents&&a.enable(16),C.anisotropy&&a.enable(17),C.alphaHash&&a.enable(18),C.batching&&a.enable(19),E.push(a.mask),a.disableAll(),C.fog&&a.enable(0),C.useFog&&a.enable(1),C.flatShading&&a.enable(2),C.logarithmicDepthBuffer&&a.enable(3),C.skinning&&a.enable(4),C.morphTargets&&a.enable(5),C.morphNormals&&a.enable(6),C.morphColors&&a.enable(7),C.premultipliedAlpha&&a.enable(8),C.shadowMapEnabled&&a.enable(9),C.useLegacyLights&&a.enable(10),C.doubleSided&&a.enable(11),C.flipSided&&a.enable(12),C.useDepthPacking&&a.enable(13),C.dithering&&a.enable(14),C.transmission&&a.enable(15),C.sheen&&a.enable(16),C.opaque&&a.enable(17),C.pointsUvs&&a.enable(18),C.decodeVideoTexture&&a.enable(19),E.push(a.mask)}function y(E){const C=p[E.type];let N;if(C){const P=Ta[C];N=_R.clone(P.uniforms)}else N=E.uniforms;return N}function A(E,C){let N;for(let P=0,L=c.length;P<L;P++){const R=c[P];if(R.cacheKey===C){N=R,++N.usedTimes;break}}return N===void 0&&(N=new LK(i,C,E,s),c.push(N)),N}function w(E){if(--E.usedTimes===0){const C=c.indexOf(E);c[C]=c[c.length-1],c.pop(),E.destroy()}}function M(E){l.remove(E)}function T(){l.dispose()}return{getParameters:v,getProgramCacheKey:g,getUniforms:y,acquireProgram:A,releaseProgram:w,releaseShaderCache:M,programs:c,dispose:T}}function UK(){let i=new WeakMap;function e(s){let o=i.get(s);return o===void 0&&(o={},i.set(s,o)),o}function t(s){i.delete(s)}function n(s,o,a){i.get(s)[o]=a}function r(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:r}}function OK(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function rN(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function sN(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(h,d,f,p,_,v){let g=i[e];return g===void 0?(g={id:h.id,object:h,geometry:d,material:f,groupOrder:p,renderOrder:h.renderOrder,z:_,group:v},i[e]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=f,g.groupOrder=p,g.renderOrder=h.renderOrder,g.z=_,g.group=v),e++,g}function a(h,d,f,p,_,v){const g=o(h,d,f,p,_,v);f.transmission>0?n.push(g):f.transparent===!0?r.push(g):t.push(g)}function l(h,d,f,p,_,v){const g=o(h,d,f,p,_,v);f.transmission>0?n.unshift(g):f.transparent===!0?r.unshift(g):t.unshift(g)}function c(h,d){t.length>1&&t.sort(h||OK),n.length>1&&n.sort(d||rN),r.length>1&&r.sort(d||rN)}function u(){for(let h=e,d=i.length;h<d;h++){const f=i[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function BK(){let i=new WeakMap;function e(n,r){const s=i.get(n);let o;return s===void 0?(o=new sN,i.set(n,[o])):r>=s.length?(o=new sN,s.push(o)):o=s[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function zK(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Te,color:new It};break;case"SpotLight":t={position:new Te,direction:new Te,color:new It,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Te,color:new It,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Te,skyColor:new It,groundColor:new It};break;case"RectAreaLight":t={color:new It,position:new Te,halfWidth:new Te,halfHeight:new Te};break}return i[e.id]=t,t}}}function GK(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let VK=0;function HK(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function $K(i,e){const t=new zK,n=GK(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new Te);const s=new Te,o=new en,a=new en;function l(u,h){let d=0,f=0,p=0;for(let P=0;P<9;P++)r.probe[P].set(0,0,0);let _=0,v=0,g=0,b=0,m=0,y=0,A=0,w=0,M=0,T=0,E=0;u.sort(HK);const C=h===!0?Math.PI:1;for(let P=0,L=u.length;P<L;P++){const R=u[P],F=R.color,V=R.intensity,G=R.distance,U=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)d+=F.r*V*C,f+=F.g*V*C,p+=F.b*V*C;else if(R.isLightProbe){for(let z=0;z<9;z++)r.probe[z].addScaledVector(R.sh.coefficients[z],V);E++}else if(R.isDirectionalLight){const z=t.get(R);if(z.color.copy(R.color).multiplyScalar(R.intensity*C),R.castShadow){const O=R.shadow,D=n.get(R);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,r.directionalShadow[_]=D,r.directionalShadowMap[_]=U,r.directionalShadowMatrix[_]=R.shadow.matrix,y++}r.directional[_]=z,_++}else if(R.isSpotLight){const z=t.get(R);z.position.setFromMatrixPosition(R.matrixWorld),z.color.copy(F).multiplyScalar(V*C),z.distance=G,z.coneCos=Math.cos(R.angle),z.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),z.decay=R.decay,r.spot[g]=z;const O=R.shadow;if(R.map&&(r.spotLightMap[M]=R.map,M++,O.updateMatrices(R),R.castShadow&&T++),r.spotLightMatrix[g]=O.matrix,R.castShadow){const D=n.get(R);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,r.spotShadow[g]=D,r.spotShadowMap[g]=U,w++}g++}else if(R.isRectAreaLight){const z=t.get(R);z.color.copy(F).multiplyScalar(V),z.halfWidth.set(R.width*.5,0,0),z.halfHeight.set(0,R.height*.5,0),r.rectArea[b]=z,b++}else if(R.isPointLight){const z=t.get(R);if(z.color.copy(R.color).multiplyScalar(R.intensity*C),z.distance=R.distance,z.decay=R.decay,R.castShadow){const O=R.shadow,D=n.get(R);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,D.shadowCameraNear=O.camera.near,D.shadowCameraFar=O.camera.far,r.pointShadow[v]=D,r.pointShadowMap[v]=U,r.pointShadowMatrix[v]=R.shadow.matrix,A++}r.point[v]=z,v++}else if(R.isHemisphereLight){const z=t.get(R);z.skyColor.copy(R.color).multiplyScalar(V*C),z.groundColor.copy(R.groundColor).multiplyScalar(V*C),r.hemi[m]=z,m++}}b>0&&(e.isWebGL2?i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=kt.LTC_FLOAT_1,r.rectAreaLTC2=kt.LTC_FLOAT_2):(r.rectAreaLTC1=kt.LTC_HALF_1,r.rectAreaLTC2=kt.LTC_HALF_2):i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=kt.LTC_FLOAT_1,r.rectAreaLTC2=kt.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=kt.LTC_HALF_1,r.rectAreaLTC2=kt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=d,r.ambient[1]=f,r.ambient[2]=p;const N=r.hash;(N.directionalLength!==_||N.pointLength!==v||N.spotLength!==g||N.rectAreaLength!==b||N.hemiLength!==m||N.numDirectionalShadows!==y||N.numPointShadows!==A||N.numSpotShadows!==w||N.numSpotMaps!==M||N.numLightProbes!==E)&&(r.directional.length=_,r.spot.length=g,r.rectArea.length=b,r.point.length=v,r.hemi.length=m,r.directionalShadow.length=y,r.directionalShadowMap.length=y,r.pointShadow.length=A,r.pointShadowMap.length=A,r.spotShadow.length=w,r.spotShadowMap.length=w,r.directionalShadowMatrix.length=y,r.pointShadowMatrix.length=A,r.spotLightMatrix.length=w+M-T,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=T,r.numLightProbes=E,N.directionalLength=_,N.pointLength=v,N.spotLength=g,N.rectAreaLength=b,N.hemiLength=m,N.numDirectionalShadows=y,N.numPointShadows=A,N.numSpotShadows=w,N.numSpotMaps=M,N.numLightProbes=E,r.version=VK++)}function c(u,h){let d=0,f=0,p=0,_=0,v=0;const g=h.matrixWorldInverse;for(let b=0,m=u.length;b<m;b++){const y=u[b];if(y.isDirectionalLight){const A=r.directional[d];A.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(g),d++}else if(y.isSpotLight){const A=r.spot[p];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),A.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(g),p++}else if(y.isRectAreaLight){const A=r.rectArea[_];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),a.identity(),o.copy(y.matrixWorld),o.premultiply(g),a.extractRotation(o),A.halfWidth.set(y.width*.5,0,0),A.halfHeight.set(0,y.height*.5,0),A.halfWidth.applyMatrix4(a),A.halfHeight.applyMatrix4(a),_++}else if(y.isPointLight){const A=r.point[f];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),f++}else if(y.isHemisphereLight){const A=r.hemi[v];A.direction.setFromMatrixPosition(y.matrixWorld),A.direction.transformDirection(g),v++}}}return{setup:l,setupView:c,state:r}}function oN(i,e){const t=new $K(i,e),n=[],r=[];function s(){n.length=0,r.length=0}function o(h){n.push(h)}function a(h){r.push(h)}function l(h){t.setup(n,h)}function c(h){t.setupView(n,h)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function WK(i,e){let t=new WeakMap;function n(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new oN(i,e),t.set(s,[l])):o>=a.length?(l=new oN(i,e),a.push(l)):l=a[o],l}function r(){t=new WeakMap}return{get:n,dispose:r}}let bS=class extends ur{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=d6,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},SS=class extends ur{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};const jK=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,XK=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function qK(i,e,t){let n=new O1;const r=new yt,s=new yt,o=new Wn,a=new bS({depthPacking:hR}),l=new SS,c={},u=t.maxTextureSize,h={[Sl]:Is,[Is]:Sl,[cr]:cr},d=new Al({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new yt},radius:{value:4}},vertexShader:jK,fragmentShader:XK}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new mn;p.setAttribute("position",new An(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new Tn(p,d),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=fS;let g=this.type;this.render=function(w,M,T){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||w.length===0)return;const E=i.getRenderTarget(),C=i.getActiveCubeFace(),N=i.getActiveMipmapLevel(),P=i.state;P.setBlending(dc),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);const L=g!==wa&&this.type===wa,R=g===wa&&this.type!==wa;for(let F=0,V=w.length;F<V;F++){const G=w[F],U=G.shadow;if(U===void 0){console.warn("THREE.WebGLShadowMap:",G,"has no shadow.");continue}if(U.autoUpdate===!1&&U.needsUpdate===!1)continue;r.copy(U.mapSize);const z=U.getFrameExtents();if(r.multiply(z),s.copy(U.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/z.x),r.x=s.x*z.x,U.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/z.y),r.y=s.y*z.y,U.mapSize.y=s.y)),U.map===null||L===!0||R===!0){const D=this.type!==wa?{minFilter:zi,magFilter:zi}:{};U.map!==null&&U.map.dispose(),U.map=new Ga(r.x,r.y,D),U.map.texture.name=G.name+".shadowMap",U.camera.updateProjectionMatrix()}i.setRenderTarget(U.map),i.clear();const O=U.getViewportCount();for(let D=0;D<O;D++){const B=U.getViewport(D);o.set(s.x*B.x,s.y*B.y,s.x*B.z,s.y*B.w),P.viewport(o),U.updateMatrices(G,D),n=U.getFrustum(),y(M,T,U.camera,G,this.type)}U.isPointLightShadow!==!0&&this.type===wa&&b(U,T),U.needsUpdate=!1}g=this.type,v.needsUpdate=!1,i.setRenderTarget(E,C,N)};function b(w,M){const T=e.update(_);d.defines.VSM_SAMPLES!==w.blurSamples&&(d.defines.VSM_SAMPLES=w.blurSamples,f.defines.VSM_SAMPLES=w.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new Ga(r.x,r.y)),d.uniforms.shadow_pass.value=w.map.texture,d.uniforms.resolution.value=w.mapSize,d.uniforms.radius.value=w.radius,i.setRenderTarget(w.mapPass),i.clear(),i.renderBufferDirect(M,null,T,d,_,null),f.uniforms.shadow_pass.value=w.mapPass.texture,f.uniforms.resolution.value=w.mapSize,f.uniforms.radius.value=w.radius,i.setRenderTarget(w.map),i.clear(),i.renderBufferDirect(M,null,T,f,_,null)}function m(w,M,T,E){let C=null;const N=T.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(N!==void 0)C=N;else if(C=T.isPointLight===!0?l:a,i.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const P=C.uuid,L=M.uuid;let R=c[P];R===void 0&&(R={},c[P]=R);let F=R[L];F===void 0&&(F=C.clone(),R[L]=F,M.addEventListener("dispose",A)),C=F}if(C.visible=M.visible,C.wireframe=M.wireframe,E===wa?C.side=M.shadowSide!==null?M.shadowSide:M.side:C.side=M.shadowSide!==null?M.shadowSide:h[M.side],C.alphaMap=M.alphaMap,C.alphaTest=M.alphaTest,C.map=M.map,C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.displacementMap=M.displacementMap,C.displacementScale=M.displacementScale,C.displacementBias=M.displacementBias,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,T.isPointLight===!0&&C.isMeshDistanceMaterial===!0){const P=i.properties.get(C);P.light=T}return C}function y(w,M,T,E,C){if(w.visible===!1)return;if(w.layers.test(M.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&C===wa)&&(!w.frustumCulled||n.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,w.matrixWorld);const L=e.update(w),R=w.material;if(Array.isArray(R)){const F=L.groups;for(let V=0,G=F.length;V<G;V++){const U=F[V],z=R[U.materialIndex];if(z&&z.visible){const O=m(w,z,E,C);w.onBeforeShadow(i,w,M,T,L,O,U),i.renderBufferDirect(T,null,L,O,w,U),w.onAfterShadow(i,w,M,T,L,O,U)}}}else if(R.visible){const F=m(w,R,E,C);w.onBeforeShadow(i,w,M,T,L,F,null),i.renderBufferDirect(T,null,L,F,w,null),w.onAfterShadow(i,w,M,T,L,F,null)}}const P=w.children;for(let L=0,R=P.length;L<R;L++)y(P[L],M,T,E,C)}function A(w){w.target.removeEventListener("dispose",A);for(const T in c){const E=c[T],C=w.target.uuid;C in E&&(E[C].dispose(),delete E[C])}}}function YK(i,e,t){const n=t.isWebGL2;function r(){let ee=!1;const Ge=new Wn;let Ce=null;const De=new Wn(0,0,0,0);return{setMask:function(Xe){Ce!==Xe&&!ee&&(i.colorMask(Xe,Xe,Xe,Xe),Ce=Xe)},setLocked:function(Xe){ee=Xe},setClear:function(Xe,gt,_t,Mt,J){J===!0&&(Xe*=Mt,gt*=Mt,_t*=Mt),Ge.set(Xe,gt,_t,Mt),De.equals(Ge)===!1&&(i.clearColor(Xe,gt,_t,Mt),De.copy(Ge))},reset:function(){ee=!1,Ce=null,De.set(-1,0,0,0)}}}function s(){let ee=!1,Ge=null,Ce=null,De=null;return{setTest:function(Xe){Xe?le(i.DEPTH_TEST):re(i.DEPTH_TEST)},setMask:function(Xe){Ge!==Xe&&!ee&&(i.depthMask(Xe),Ge=Xe)},setFunc:function(Xe){if(Ce!==Xe){switch(Xe){case Bz:i.depthFunc(i.NEVER);break;case zz:i.depthFunc(i.ALWAYS);break;case Gz:i.depthFunc(i.LESS);break;case J0:i.depthFunc(i.LEQUAL);break;case Vz:i.depthFunc(i.EQUAL);break;case Hz:i.depthFunc(i.GEQUAL);break;case $z:i.depthFunc(i.GREATER);break;case Wz:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Ce=Xe}},setLocked:function(Xe){ee=Xe},setClear:function(Xe){De!==Xe&&(i.clearDepth(Xe),De=Xe)},reset:function(){ee=!1,Ge=null,Ce=null,De=null}}}function o(){let ee=!1,Ge=null,Ce=null,De=null,Xe=null,gt=null,_t=null,Mt=null,J=null;return{setTest:function(ae){ee||(ae?le(i.STENCIL_TEST):re(i.STENCIL_TEST))},setMask:function(ae){Ge!==ae&&!ee&&(i.stencilMask(ae),Ge=ae)},setFunc:function(ae,ue,ye){(Ce!==ae||De!==ue||Xe!==ye)&&(i.stencilFunc(ae,ue,ye),Ce=ae,De=ue,Xe=ye)},setOp:function(ae,ue,ye){(gt!==ae||_t!==ue||Mt!==ye)&&(i.stencilOp(ae,ue,ye),gt=ae,_t=ue,Mt=ye)},setLocked:function(ae){ee=ae},setClear:function(ae){J!==ae&&(i.clearStencil(ae),J=ae)},reset:function(){ee=!1,Ge=null,Ce=null,De=null,Xe=null,gt=null,_t=null,Mt=null,J=null}}}const a=new r,l=new s,c=new o,u=new WeakMap,h=new WeakMap;let d={},f={},p=new WeakMap,_=[],v=null,g=!1,b=null,m=null,y=null,A=null,w=null,M=null,T=null,E=new It(0,0,0),C=0,N=!1,P=null,L=null,R=null,F=null,V=null;const G=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let U=!1,z=0;const O=i.getParameter(i.VERSION);O.indexOf("WebGL")!==-1?(z=parseFloat(/^WebGL (\d)/.exec(O)[1]),U=z>=1):O.indexOf("OpenGL ES")!==-1&&(z=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),U=z>=2);let D=null,B={};const W=i.getParameter(i.SCISSOR_BOX),q=i.getParameter(i.VIEWPORT),j=new Wn().fromArray(W),te=new Wn().fromArray(q);function ne(ee,Ge,Ce,De){const Xe=new Uint8Array(4),gt=i.createTexture();i.bindTexture(ee,gt),i.texParameteri(ee,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(ee,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let _t=0;_t<Ce;_t++)n&&(ee===i.TEXTURE_3D||ee===i.TEXTURE_2D_ARRAY)?i.texImage3D(Ge,0,i.RGBA,1,1,De,0,i.RGBA,i.UNSIGNED_BYTE,Xe):i.texImage2D(Ge+_t,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Xe);return gt}const Z={};Z[i.TEXTURE_2D]=ne(i.TEXTURE_2D,i.TEXTURE_2D,1),Z[i.TEXTURE_CUBE_MAP]=ne(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Z[i.TEXTURE_2D_ARRAY]=ne(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),Z[i.TEXTURE_3D]=ne(i.TEXTURE_3D,i.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),le(i.DEPTH_TEST),l.setFunc(J0),Me(!1),Y(hT),le(i.CULL_FACE),ge(dc);function le(ee){d[ee]!==!0&&(i.enable(ee),d[ee]=!0)}function re(ee){d[ee]!==!1&&(i.disable(ee),d[ee]=!1)}function se(ee,Ge){return f[ee]!==Ge?(i.bindFramebuffer(ee,Ge),f[ee]=Ge,n&&(ee===i.DRAW_FRAMEBUFFER&&(f[i.FRAMEBUFFER]=Ge),ee===i.FRAMEBUFFER&&(f[i.DRAW_FRAMEBUFFER]=Ge)),!0):!1}function $(ee,Ge){let Ce=_,De=!1;if(ee)if(Ce=p.get(Ge),Ce===void 0&&(Ce=[],p.set(Ge,Ce)),ee.isWebGLMultipleRenderTargets){const Xe=ee.texture;if(Ce.length!==Xe.length||Ce[0]!==i.COLOR_ATTACHMENT0){for(let gt=0,_t=Xe.length;gt<_t;gt++)Ce[gt]=i.COLOR_ATTACHMENT0+gt;Ce.length=Xe.length,De=!0}}else Ce[0]!==i.COLOR_ATTACHMENT0&&(Ce[0]=i.COLOR_ATTACHMENT0,De=!0);else Ce[0]!==i.BACK&&(Ce[0]=i.BACK,De=!0);De&&(t.isWebGL2?i.drawBuffers(Ce):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ce))}function fe(ee){return v!==ee?(i.useProgram(ee),v=ee,!0):!1}const xe={[pu]:i.FUNC_ADD,[Mz]:i.FUNC_SUBTRACT,[Az]:i.FUNC_REVERSE_SUBTRACT};if(n)xe[mT]=i.MIN,xe[gT]=i.MAX;else{const ee=e.get("EXT_blend_minmax");ee!==null&&(xe[mT]=ee.MIN_EXT,xe[gT]=ee.MAX_EXT)}const Ie={[Ez]:i.ZERO,[Tz]:i.ONE,[Cz]:i.SRC_COLOR,[vb]:i.SRC_ALPHA,[Nz]:i.SRC_ALPHA_SATURATE,[Lz]:i.DST_COLOR,[Rz]:i.DST_ALPHA,[Pz]:i.ONE_MINUS_SRC_COLOR,[_b]:i.ONE_MINUS_SRC_ALPHA,[Dz]:i.ONE_MINUS_DST_COLOR,[Iz]:i.ONE_MINUS_DST_ALPHA,[Fz]:i.CONSTANT_COLOR,[kz]:i.ONE_MINUS_CONSTANT_COLOR,[Uz]:i.CONSTANT_ALPHA,[Oz]:i.ONE_MINUS_CONSTANT_ALPHA};function ge(ee,Ge,Ce,De,Xe,gt,_t,Mt,J,ae){if(ee===dc){g===!0&&(re(i.BLEND),g=!1);return}if(g===!1&&(le(i.BLEND),g=!0),ee!==wz){if(ee!==b||ae!==N){if((m!==pu||w!==pu)&&(i.blendEquation(i.FUNC_ADD),m=pu,w=pu),ae)switch(ee){case sd:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case dT:i.blendFunc(i.ONE,i.ONE);break;case fT:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case pT:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}else switch(ee){case sd:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case dT:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case fT:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case pT:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}y=null,A=null,M=null,T=null,E.set(0,0,0),C=0,b=ee,N=ae}return}Xe=Xe||Ge,gt=gt||Ce,_t=_t||De,(Ge!==m||Xe!==w)&&(i.blendEquationSeparate(xe[Ge],xe[Xe]),m=Ge,w=Xe),(Ce!==y||De!==A||gt!==M||_t!==T)&&(i.blendFuncSeparate(Ie[Ce],Ie[De],Ie[gt],Ie[_t]),y=Ce,A=De,M=gt,T=_t),(Mt.equals(E)===!1||J!==C)&&(i.blendColor(Mt.r,Mt.g,Mt.b,J),E.copy(Mt),C=J),b=ee,N=!1}function Oe(ee,Ge){ee.side===cr?re(i.CULL_FACE):le(i.CULL_FACE);let Ce=ee.side===Is;Ge&&(Ce=!Ce),Me(Ce),ee.blending===sd&&ee.transparent===!1?ge(dc):ge(ee.blending,ee.blendEquation,ee.blendSrc,ee.blendDst,ee.blendEquationAlpha,ee.blendSrcAlpha,ee.blendDstAlpha,ee.blendColor,ee.blendAlpha,ee.premultipliedAlpha),l.setFunc(ee.depthFunc),l.setTest(ee.depthTest),l.setMask(ee.depthWrite),a.setMask(ee.colorWrite);const De=ee.stencilWrite;c.setTest(De),De&&(c.setMask(ee.stencilWriteMask),c.setFunc(ee.stencilFunc,ee.stencilRef,ee.stencilFuncMask),c.setOp(ee.stencilFail,ee.stencilZFail,ee.stencilZPass)),de(ee.polygonOffset,ee.polygonOffsetFactor,ee.polygonOffsetUnits),ee.alphaToCoverage===!0?le(i.SAMPLE_ALPHA_TO_COVERAGE):re(i.SAMPLE_ALPHA_TO_COVERAGE)}function Me(ee){P!==ee&&(ee?i.frontFace(i.CW):i.frontFace(i.CCW),P=ee)}function Y(ee){ee!==xz?(le(i.CULL_FACE),ee!==L&&(ee===hT?i.cullFace(i.BACK):ee===bz?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):re(i.CULL_FACE),L=ee}function Q(ee){ee!==R&&(U&&i.lineWidth(ee),R=ee)}function de(ee,Ge,Ce){ee?(le(i.POLYGON_OFFSET_FILL),(F!==Ge||V!==Ce)&&(i.polygonOffset(Ge,Ce),F=Ge,V=Ce)):re(i.POLYGON_OFFSET_FILL)}function Le(ee){ee?le(i.SCISSOR_TEST):re(i.SCISSOR_TEST)}function ie(ee){ee===void 0&&(ee=i.TEXTURE0+G-1),D!==ee&&(i.activeTexture(ee),D=ee)}function K(ee,Ge,Ce){Ce===void 0&&(D===null?Ce=i.TEXTURE0+G-1:Ce=D);let De=B[Ce];De===void 0&&(De={type:void 0,texture:void 0},B[Ce]=De),(De.type!==ee||De.texture!==Ge)&&(D!==Ce&&(i.activeTexture(Ce),D=Ce),i.bindTexture(ee,Ge||Z[ee]),De.type=ee,De.texture=Ge)}function be(){const ee=B[D];ee!==void 0&&ee.type!==void 0&&(i.bindTexture(ee.type,null),ee.type=void 0,ee.texture=void 0)}function Ue(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ve(){try{i.compressedTexImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ne(){try{i.texSubImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function $e(){try{i.texSubImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ee(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ze(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function nt(){try{i.texStorage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function rt(){try{i.texStorage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Be(){try{i.texImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function qe(){try{i.texImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function it(ee){j.equals(ee)===!1&&(i.scissor(ee.x,ee.y,ee.z,ee.w),j.copy(ee))}function at(ee){te.equals(ee)===!1&&(i.viewport(ee.x,ee.y,ee.z,ee.w),te.copy(ee))}function ht(ee,Ge){let Ce=h.get(Ge);Ce===void 0&&(Ce=new WeakMap,h.set(Ge,Ce));let De=Ce.get(ee);De===void 0&&(De=i.getUniformBlockIndex(Ge,ee.name),Ce.set(ee,De))}function Qe(ee,Ge){const De=h.get(Ge).get(ee);u.get(Ge)!==De&&(i.uniformBlockBinding(Ge,De,ee.__bindingPointIndex),u.set(Ge,De))}function je(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),n===!0&&(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),d={},D=null,B={},f={},p=new WeakMap,_=[],v=null,g=!1,b=null,m=null,y=null,A=null,w=null,M=null,T=null,E=new It(0,0,0),C=0,N=!1,P=null,L=null,R=null,F=null,V=null,j.set(0,0,i.canvas.width,i.canvas.height),te.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:le,disable:re,bindFramebuffer:se,drawBuffers:$,useProgram:fe,setBlending:ge,setMaterial:Oe,setFlipSided:Me,setCullFace:Y,setLineWidth:Q,setPolygonOffset:de,setScissorTest:Le,activeTexture:ie,bindTexture:K,unbindTexture:be,compressedTexImage2D:Ue,compressedTexImage3D:ve,texImage2D:Be,texImage3D:qe,updateUBOMapping:ht,uniformBlockBinding:Qe,texStorage2D:nt,texStorage3D:rt,texSubImage2D:Ne,texSubImage3D:$e,compressedTexSubImage2D:Ee,compressedTexSubImage3D:Ze,scissor:it,viewport:at,reset:je}}function KK(i,e,t,n,r,s,o){const a=r.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(Y,Q){return f?new OffscreenCanvas(Y,Q):l1("canvas")}function _(Y,Q,de,Le){let ie=1;if((Y.width>Le||Y.height>Le)&&(ie=Le/Math.max(Y.width,Y.height)),ie<1||Q===!0)if(typeof HTMLImageElement<"u"&&Y instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Y instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Y instanceof ImageBitmap){const K=Q?bb:Math.floor,be=K(ie*Y.width),Ue=K(ie*Y.height);h===void 0&&(h=p(be,Ue));const ve=de?p(be,Ue):h;return ve.width=be,ve.height=Ue,ve.getContext("2d").drawImage(Y,0,0,be,Ue),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Y.width+"x"+Y.height+") to ("+be+"x"+Ue+")."),ve}else return"data"in Y&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Y.width+"x"+Y.height+")."),Y;return Y}function v(Y){return WT(Y.width)&&WT(Y.height)}function g(Y){return a?!1:Y.wrapS!==$r||Y.wrapT!==$r||Y.minFilter!==zi&&Y.minFilter!==hi}function b(Y,Q){return Y.generateMipmaps&&Q&&Y.minFilter!==zi&&Y.minFilter!==hi}function m(Y){i.generateMipmap(Y)}function y(Y,Q,de,Le,ie=!1){if(a===!1)return Q;if(Y!==null){if(i[Y]!==void 0)return i[Y];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Y+"'")}let K=Q;if(Q===i.RED&&(de===i.FLOAT&&(K=i.R32F),de===i.HALF_FLOAT&&(K=i.R16F),de===i.UNSIGNED_BYTE&&(K=i.R8)),Q===i.RED_INTEGER&&(de===i.UNSIGNED_BYTE&&(K=i.R8UI),de===i.UNSIGNED_SHORT&&(K=i.R16UI),de===i.UNSIGNED_INT&&(K=i.R32UI),de===i.BYTE&&(K=i.R8I),de===i.SHORT&&(K=i.R16I),de===i.INT&&(K=i.R32I)),Q===i.RG&&(de===i.FLOAT&&(K=i.RG32F),de===i.HALF_FLOAT&&(K=i.RG16F),de===i.UNSIGNED_BYTE&&(K=i.RG8)),Q===i.RGBA){const be=ie?r1:Vn.getTransfer(Le);de===i.FLOAT&&(K=i.RGBA32F),de===i.HALF_FLOAT&&(K=i.RGBA16F),de===i.UNSIGNED_BYTE&&(K=be===ti?i.SRGB8_ALPHA8:i.RGBA8),de===i.UNSIGNED_SHORT_4_4_4_4&&(K=i.RGBA4),de===i.UNSIGNED_SHORT_5_5_5_1&&(K=i.RGB5_A1)}return(K===i.R16F||K===i.R32F||K===i.RG16F||K===i.RG32F||K===i.RGBA16F||K===i.RGBA32F)&&e.get("EXT_color_buffer_float"),K}function A(Y,Q,de){return b(Y,de)===!0||Y.isFramebufferTexture&&Y.minFilter!==zi&&Y.minFilter!==hi?Math.log2(Math.max(Q.width,Q.height))+1:Y.mipmaps!==void 0&&Y.mipmaps.length>0?Y.mipmaps.length:Y.isCompressedTexture&&Array.isArray(Y.image)?Q.mipmaps.length:1}function w(Y){return Y===zi||Y===n1||Y===Op?i.NEAREST:i.LINEAR}function M(Y){const Q=Y.target;Q.removeEventListener("dispose",M),E(Q),Q.isVideoTexture&&u.delete(Q)}function T(Y){const Q=Y.target;Q.removeEventListener("dispose",T),N(Q)}function E(Y){const Q=n.get(Y);if(Q.__webglInit===void 0)return;const de=Y.source,Le=d.get(de);if(Le){const ie=Le[Q.__cacheKey];ie.usedTimes--,ie.usedTimes===0&&C(Y),Object.keys(Le).length===0&&d.delete(de)}n.remove(Y)}function C(Y){const Q=n.get(Y);i.deleteTexture(Q.__webglTexture);const de=Y.source,Le=d.get(de);delete Le[Q.__cacheKey],o.memory.textures--}function N(Y){const Q=Y.texture,de=n.get(Y),Le=n.get(Q);if(Le.__webglTexture!==void 0&&(i.deleteTexture(Le.__webglTexture),o.memory.textures--),Y.depthTexture&&Y.depthTexture.dispose(),Y.isWebGLCubeRenderTarget)for(let ie=0;ie<6;ie++){if(Array.isArray(de.__webglFramebuffer[ie]))for(let K=0;K<de.__webglFramebuffer[ie].length;K++)i.deleteFramebuffer(de.__webglFramebuffer[ie][K]);else i.deleteFramebuffer(de.__webglFramebuffer[ie]);de.__webglDepthbuffer&&i.deleteRenderbuffer(de.__webglDepthbuffer[ie])}else{if(Array.isArray(de.__webglFramebuffer))for(let ie=0;ie<de.__webglFramebuffer.length;ie++)i.deleteFramebuffer(de.__webglFramebuffer[ie]);else i.deleteFramebuffer(de.__webglFramebuffer);if(de.__webglDepthbuffer&&i.deleteRenderbuffer(de.__webglDepthbuffer),de.__webglMultisampledFramebuffer&&i.deleteFramebuffer(de.__webglMultisampledFramebuffer),de.__webglColorRenderbuffer)for(let ie=0;ie<de.__webglColorRenderbuffer.length;ie++)de.__webglColorRenderbuffer[ie]&&i.deleteRenderbuffer(de.__webglColorRenderbuffer[ie]);de.__webglDepthRenderbuffer&&i.deleteRenderbuffer(de.__webglDepthRenderbuffer)}if(Y.isWebGLMultipleRenderTargets)for(let ie=0,K=Q.length;ie<K;ie++){const be=n.get(Q[ie]);be.__webglTexture&&(i.deleteTexture(be.__webglTexture),o.memory.textures--),n.remove(Q[ie])}n.remove(Q),n.remove(Y)}let P=0;function L(){P=0}function R(){const Y=P;return Y>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Y+" texture units while this GPU supports only "+r.maxTextures),P+=1,Y}function F(Y){const Q=[];return Q.push(Y.wrapS),Q.push(Y.wrapT),Q.push(Y.wrapR||0),Q.push(Y.magFilter),Q.push(Y.minFilter),Q.push(Y.anisotropy),Q.push(Y.internalFormat),Q.push(Y.format),Q.push(Y.type),Q.push(Y.generateMipmaps),Q.push(Y.premultiplyAlpha),Q.push(Y.flipY),Q.push(Y.unpackAlignment),Q.push(Y.colorSpace),Q.join()}function V(Y,Q){const de=n.get(Y);if(Y.isVideoTexture&&Oe(Y),Y.isRenderTargetTexture===!1&&Y.version>0&&de.__version!==Y.version){const Le=Y.image;if(Le===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Le.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{j(de,Y,Q);return}}t.bindTexture(i.TEXTURE_2D,de.__webglTexture,i.TEXTURE0+Q)}function G(Y,Q){const de=n.get(Y);if(Y.version>0&&de.__version!==Y.version){j(de,Y,Q);return}t.bindTexture(i.TEXTURE_2D_ARRAY,de.__webglTexture,i.TEXTURE0+Q)}function U(Y,Q){const de=n.get(Y);if(Y.version>0&&de.__version!==Y.version){j(de,Y,Q);return}t.bindTexture(i.TEXTURE_3D,de.__webglTexture,i.TEXTURE0+Q)}function z(Y,Q){const de=n.get(Y);if(Y.version>0&&de.__version!==Y.version){te(de,Y,Q);return}t.bindTexture(i.TEXTURE_CUBE_MAP,de.__webglTexture,i.TEXTURE0+Q)}const O={[Bu]:i.REPEAT,[$r]:i.CLAMP_TO_EDGE,[tm]:i.MIRRORED_REPEAT},D={[zi]:i.NEAREST,[n1]:i.NEAREST_MIPMAP_NEAREST,[Op]:i.NEAREST_MIPMAP_LINEAR,[hi]:i.LINEAR,[mS]:i.LINEAR_MIPMAP_NEAREST,[wl]:i.LINEAR_MIPMAP_LINEAR},B={[p6]:i.NEVER,[x6]:i.ALWAYS,[m6]:i.LESS,[dR]:i.LEQUAL,[g6]:i.EQUAL,[y6]:i.GEQUAL,[v6]:i.GREATER,[_6]:i.NOTEQUAL};function W(Y,Q,de){if(de?(i.texParameteri(Y,i.TEXTURE_WRAP_S,O[Q.wrapS]),i.texParameteri(Y,i.TEXTURE_WRAP_T,O[Q.wrapT]),(Y===i.TEXTURE_3D||Y===i.TEXTURE_2D_ARRAY)&&i.texParameteri(Y,i.TEXTURE_WRAP_R,O[Q.wrapR]),i.texParameteri(Y,i.TEXTURE_MAG_FILTER,D[Q.magFilter]),i.texParameteri(Y,i.TEXTURE_MIN_FILTER,D[Q.minFilter])):(i.texParameteri(Y,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(Y,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(Y===i.TEXTURE_3D||Y===i.TEXTURE_2D_ARRAY)&&i.texParameteri(Y,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),(Q.wrapS!==$r||Q.wrapT!==$r)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(Y,i.TEXTURE_MAG_FILTER,w(Q.magFilter)),i.texParameteri(Y,i.TEXTURE_MIN_FILTER,w(Q.minFilter)),Q.minFilter!==zi&&Q.minFilter!==hi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),Q.compareFunction&&(i.texParameteri(Y,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(Y,i.TEXTURE_COMPARE_FUNC,B[Q.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Le=e.get("EXT_texture_filter_anisotropic");if(Q.magFilter===zi||Q.minFilter!==Op&&Q.minFilter!==wl||Q.type===Na&&e.has("OES_texture_float_linear")===!1||a===!1&&Q.type===nm&&e.has("OES_texture_half_float_linear")===!1)return;(Q.anisotropy>1||n.get(Q).__currentAnisotropy)&&(i.texParameterf(Y,Le.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Q.anisotropy,r.getMaxAnisotropy())),n.get(Q).__currentAnisotropy=Q.anisotropy)}}function q(Y,Q){let de=!1;Y.__webglInit===void 0&&(Y.__webglInit=!0,Q.addEventListener("dispose",M));const Le=Q.source;let ie=d.get(Le);ie===void 0&&(ie={},d.set(Le,ie));const K=F(Q);if(K!==Y.__cacheKey){ie[K]===void 0&&(ie[K]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,de=!0),ie[K].usedTimes++;const be=ie[Y.__cacheKey];be!==void 0&&(ie[Y.__cacheKey].usedTimes--,be.usedTimes===0&&C(Q)),Y.__cacheKey=K,Y.__webglTexture=ie[K].texture}return de}function j(Y,Q,de){let Le=i.TEXTURE_2D;(Q.isDataArrayTexture||Q.isCompressedArrayTexture)&&(Le=i.TEXTURE_2D_ARRAY),Q.isData3DTexture&&(Le=i.TEXTURE_3D);const ie=q(Y,Q),K=Q.source;t.bindTexture(Le,Y.__webglTexture,i.TEXTURE0+de);const be=n.get(K);if(K.version!==be.__version||ie===!0){t.activeTexture(i.TEXTURE0+de);const Ue=Vn.getPrimaries(Vn.workingColorSpace),ve=Q.colorSpace===Ao?null:Vn.getPrimaries(Q.colorSpace),Ne=Q.colorSpace===Ao||Ue===ve?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,Q.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,Q.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ne);const $e=g(Q)&&v(Q.image)===!1;let Ee=_(Q.image,$e,!1,r.maxTextureSize);Ee=Me(Q,Ee);const Ze=v(Ee)||a,nt=s.convert(Q.format,Q.colorSpace);let rt=s.convert(Q.type),Be=y(Q.internalFormat,nt,rt,Q.colorSpace,Q.isVideoTexture);W(Le,Q,Ze);let qe;const it=Q.mipmaps,at=a&&Q.isVideoTexture!==!0&&Be!==aR,ht=be.__version===void 0||ie===!0,Qe=A(Q,Ee,Ze);if(Q.isDepthTexture)Be=i.DEPTH_COMPONENT,a?Q.type===Na?Be=i.DEPTH_COMPONENT32F:Q.type===lc?Be=i.DEPTH_COMPONENT24:Q.type===Tu?Be=i.DEPTH24_STENCIL8:Be=i.DEPTH_COMPONENT16:Q.type===Na&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Q.format===Cu&&Be===i.DEPTH_COMPONENT&&Q.type!==gS&&Q.type!==lc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Q.type=lc,rt=s.convert(Q.type)),Q.format===wd&&Be===i.DEPTH_COMPONENT&&(Be=i.DEPTH_STENCIL,Q.type!==Tu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Q.type=Tu,rt=s.convert(Q.type))),ht&&(at?t.texStorage2D(i.TEXTURE_2D,1,Be,Ee.width,Ee.height):t.texImage2D(i.TEXTURE_2D,0,Be,Ee.width,Ee.height,0,nt,rt,null));else if(Q.isDataTexture)if(it.length>0&&Ze){at&&ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Be,it[0].width,it[0].height);for(let je=0,ee=it.length;je<ee;je++)qe=it[je],at?t.texSubImage2D(i.TEXTURE_2D,je,0,0,qe.width,qe.height,nt,rt,qe.data):t.texImage2D(i.TEXTURE_2D,je,Be,qe.width,qe.height,0,nt,rt,qe.data);Q.generateMipmaps=!1}else at?(ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Be,Ee.width,Ee.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,Ee.width,Ee.height,nt,rt,Ee.data)):t.texImage2D(i.TEXTURE_2D,0,Be,Ee.width,Ee.height,0,nt,rt,Ee.data);else if(Q.isCompressedTexture)if(Q.isCompressedArrayTexture){at&&ht&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Qe,Be,it[0].width,it[0].height,Ee.depth);for(let je=0,ee=it.length;je<ee;je++)qe=it[je],Q.format!==Ps?nt!==null?at?t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,je,0,0,0,qe.width,qe.height,Ee.depth,nt,qe.data,0,0):t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,je,Be,qe.width,qe.height,Ee.depth,0,qe.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):at?t.texSubImage3D(i.TEXTURE_2D_ARRAY,je,0,0,0,qe.width,qe.height,Ee.depth,nt,rt,qe.data):t.texImage3D(i.TEXTURE_2D_ARRAY,je,Be,qe.width,qe.height,Ee.depth,0,nt,rt,qe.data)}else{at&&ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Be,it[0].width,it[0].height);for(let je=0,ee=it.length;je<ee;je++)qe=it[je],Q.format!==Ps?nt!==null?at?t.compressedTexSubImage2D(i.TEXTURE_2D,je,0,0,qe.width,qe.height,nt,qe.data):t.compressedTexImage2D(i.TEXTURE_2D,je,Be,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):at?t.texSubImage2D(i.TEXTURE_2D,je,0,0,qe.width,qe.height,nt,rt,qe.data):t.texImage2D(i.TEXTURE_2D,je,Be,qe.width,qe.height,0,nt,rt,qe.data)}else if(Q.isDataArrayTexture)at?(ht&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Qe,Be,Ee.width,Ee.height,Ee.depth),t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Ee.width,Ee.height,Ee.depth,nt,rt,Ee.data)):t.texImage3D(i.TEXTURE_2D_ARRAY,0,Be,Ee.width,Ee.height,Ee.depth,0,nt,rt,Ee.data);else if(Q.isData3DTexture)at?(ht&&t.texStorage3D(i.TEXTURE_3D,Qe,Be,Ee.width,Ee.height,Ee.depth),t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Ee.width,Ee.height,Ee.depth,nt,rt,Ee.data)):t.texImage3D(i.TEXTURE_3D,0,Be,Ee.width,Ee.height,Ee.depth,0,nt,rt,Ee.data);else if(Q.isFramebufferTexture){if(ht)if(at)t.texStorage2D(i.TEXTURE_2D,Qe,Be,Ee.width,Ee.height);else{let je=Ee.width,ee=Ee.height;for(let Ge=0;Ge<Qe;Ge++)t.texImage2D(i.TEXTURE_2D,Ge,Be,je,ee,0,nt,rt,null),je>>=1,ee>>=1}}else if(it.length>0&&Ze){at&&ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Be,it[0].width,it[0].height);for(let je=0,ee=it.length;je<ee;je++)qe=it[je],at?t.texSubImage2D(i.TEXTURE_2D,je,0,0,nt,rt,qe):t.texImage2D(i.TEXTURE_2D,je,Be,nt,rt,qe);Q.generateMipmaps=!1}else at?(ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Be,Ee.width,Ee.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,nt,rt,Ee)):t.texImage2D(i.TEXTURE_2D,0,Be,nt,rt,Ee);b(Q,Ze)&&m(Le),be.__version=K.version,Q.onUpdate&&Q.onUpdate(Q)}Y.__version=Q.version}function te(Y,Q,de){if(Q.image.length!==6)return;const Le=q(Y,Q),ie=Q.source;t.bindTexture(i.TEXTURE_CUBE_MAP,Y.__webglTexture,i.TEXTURE0+de);const K=n.get(ie);if(ie.version!==K.__version||Le===!0){t.activeTexture(i.TEXTURE0+de);const be=Vn.getPrimaries(Vn.workingColorSpace),Ue=Q.colorSpace===Ao?null:Vn.getPrimaries(Q.colorSpace),ve=Q.colorSpace===Ao||be===Ue?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,Q.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,Q.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,ve);const Ne=Q.isCompressedTexture||Q.image[0].isCompressedTexture,$e=Q.image[0]&&Q.image[0].isDataTexture,Ee=[];for(let je=0;je<6;je++)!Ne&&!$e?Ee[je]=_(Q.image[je],!1,!0,r.maxCubemapSize):Ee[je]=$e?Q.image[je].image:Q.image[je],Ee[je]=Me(Q,Ee[je]);const Ze=Ee[0],nt=v(Ze)||a,rt=s.convert(Q.format,Q.colorSpace),Be=s.convert(Q.type),qe=y(Q.internalFormat,rt,Be,Q.colorSpace),it=a&&Q.isVideoTexture!==!0,at=K.__version===void 0||Le===!0;let ht=A(Q,Ze,nt);W(i.TEXTURE_CUBE_MAP,Q,nt);let Qe;if(Ne){it&&at&&t.texStorage2D(i.TEXTURE_CUBE_MAP,ht,qe,Ze.width,Ze.height);for(let je=0;je<6;je++){Qe=Ee[je].mipmaps;for(let ee=0;ee<Qe.length;ee++){const Ge=Qe[ee];Q.format!==Ps?rt!==null?it?t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee,0,0,Ge.width,Ge.height,rt,Ge.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee,qe,Ge.width,Ge.height,0,Ge.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee,0,0,Ge.width,Ge.height,rt,Be,Ge.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee,qe,Ge.width,Ge.height,0,rt,Be,Ge.data)}}}else{Qe=Q.mipmaps,it&&at&&(Qe.length>0&&ht++,t.texStorage2D(i.TEXTURE_CUBE_MAP,ht,qe,Ee[0].width,Ee[0].height));for(let je=0;je<6;je++)if($e){it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,0,0,Ee[je].width,Ee[je].height,rt,Be,Ee[je].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,qe,Ee[je].width,Ee[je].height,0,rt,Be,Ee[je].data);for(let ee=0;ee<Qe.length;ee++){const Ce=Qe[ee].image[je].image;it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee+1,0,0,Ce.width,Ce.height,rt,Be,Ce.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee+1,qe,Ce.width,Ce.height,0,rt,Be,Ce.data)}}else{it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,0,0,rt,Be,Ee[je]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,qe,rt,Be,Ee[je]);for(let ee=0;ee<Qe.length;ee++){const Ge=Qe[ee];it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee+1,0,0,rt,Be,Ge.image[je]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee+1,qe,rt,Be,Ge.image[je])}}}b(Q,nt)&&m(i.TEXTURE_CUBE_MAP),K.__version=ie.version,Q.onUpdate&&Q.onUpdate(Q)}Y.__version=Q.version}function ne(Y,Q,de,Le,ie,K){const be=s.convert(de.format,de.colorSpace),Ue=s.convert(de.type),ve=y(de.internalFormat,be,Ue,de.colorSpace);if(!n.get(Q).__hasExternalTextures){const $e=Math.max(1,Q.width>>K),Ee=Math.max(1,Q.height>>K);ie===i.TEXTURE_3D||ie===i.TEXTURE_2D_ARRAY?t.texImage3D(ie,K,ve,$e,Ee,Q.depth,0,be,Ue,null):t.texImage2D(ie,K,ve,$e,Ee,0,be,Ue,null)}t.bindFramebuffer(i.FRAMEBUFFER,Y),ge(Q)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Le,ie,n.get(de).__webglTexture,0,Ie(Q)):(ie===i.TEXTURE_2D||ie>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&ie<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Le,ie,n.get(de).__webglTexture,K),t.bindFramebuffer(i.FRAMEBUFFER,null)}function Z(Y,Q,de){if(i.bindRenderbuffer(i.RENDERBUFFER,Y),Q.depthBuffer&&!Q.stencilBuffer){let Le=a===!0?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT16;if(de||ge(Q)){const ie=Q.depthTexture;ie&&ie.isDepthTexture&&(ie.type===Na?Le=i.DEPTH_COMPONENT32F:ie.type===lc&&(Le=i.DEPTH_COMPONENT24));const K=Ie(Q);ge(Q)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,K,Le,Q.width,Q.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,K,Le,Q.width,Q.height)}else i.renderbufferStorage(i.RENDERBUFFER,Le,Q.width,Q.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,Y)}else if(Q.depthBuffer&&Q.stencilBuffer){const Le=Ie(Q);de&&ge(Q)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Le,i.DEPTH24_STENCIL8,Q.width,Q.height):ge(Q)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Le,i.DEPTH24_STENCIL8,Q.width,Q.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,Q.width,Q.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,Y)}else{const Le=Q.isWebGLMultipleRenderTargets===!0?Q.texture:[Q.texture];for(let ie=0;ie<Le.length;ie++){const K=Le[ie],be=s.convert(K.format,K.colorSpace),Ue=s.convert(K.type),ve=y(K.internalFormat,be,Ue,K.colorSpace),Ne=Ie(Q);de&&ge(Q)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Ne,ve,Q.width,Q.height):ge(Q)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Ne,ve,Q.width,Q.height):i.renderbufferStorage(i.RENDERBUFFER,ve,Q.width,Q.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function le(Y,Q){if(Q&&Q.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,Y),!(Q.depthTexture&&Q.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(Q.depthTexture).__webglTexture||Q.depthTexture.image.width!==Q.width||Q.depthTexture.image.height!==Q.height)&&(Q.depthTexture.image.width=Q.width,Q.depthTexture.image.height=Q.height,Q.depthTexture.needsUpdate=!0),V(Q.depthTexture,0);const Le=n.get(Q.depthTexture).__webglTexture,ie=Ie(Q);if(Q.depthTexture.format===Cu)ge(Q)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Le,0,ie):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Le,0);else if(Q.depthTexture.format===wd)ge(Q)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Le,0,ie):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Le,0);else throw new Error("Unknown depthTexture format")}function re(Y){const Q=n.get(Y),de=Y.isWebGLCubeRenderTarget===!0;if(Y.depthTexture&&!Q.__autoAllocateDepthBuffer){if(de)throw new Error("target.depthTexture not supported in Cube render targets");le(Q.__webglFramebuffer,Y)}else if(de){Q.__webglDepthbuffer=[];for(let Le=0;Le<6;Le++)t.bindFramebuffer(i.FRAMEBUFFER,Q.__webglFramebuffer[Le]),Q.__webglDepthbuffer[Le]=i.createRenderbuffer(),Z(Q.__webglDepthbuffer[Le],Y,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,Q.__webglFramebuffer),Q.__webglDepthbuffer=i.createRenderbuffer(),Z(Q.__webglDepthbuffer,Y,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}function se(Y,Q,de){const Le=n.get(Y);Q!==void 0&&ne(Le.__webglFramebuffer,Y,Y.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),de!==void 0&&re(Y)}function $(Y){const Q=Y.texture,de=n.get(Y),Le=n.get(Q);Y.addEventListener("dispose",T),Y.isWebGLMultipleRenderTargets!==!0&&(Le.__webglTexture===void 0&&(Le.__webglTexture=i.createTexture()),Le.__version=Q.version,o.memory.textures++);const ie=Y.isWebGLCubeRenderTarget===!0,K=Y.isWebGLMultipleRenderTargets===!0,be=v(Y)||a;if(ie){de.__webglFramebuffer=[];for(let Ue=0;Ue<6;Ue++)if(a&&Q.mipmaps&&Q.mipmaps.length>0){de.__webglFramebuffer[Ue]=[];for(let ve=0;ve<Q.mipmaps.length;ve++)de.__webglFramebuffer[Ue][ve]=i.createFramebuffer()}else de.__webglFramebuffer[Ue]=i.createFramebuffer()}else{if(a&&Q.mipmaps&&Q.mipmaps.length>0){de.__webglFramebuffer=[];for(let Ue=0;Ue<Q.mipmaps.length;Ue++)de.__webglFramebuffer[Ue]=i.createFramebuffer()}else de.__webglFramebuffer=i.createFramebuffer();if(K)if(r.drawBuffers){const Ue=Y.texture;for(let ve=0,Ne=Ue.length;ve<Ne;ve++){const $e=n.get(Ue[ve]);$e.__webglTexture===void 0&&($e.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&Y.samples>0&&ge(Y)===!1){const Ue=K?Q:[Q];de.__webglMultisampledFramebuffer=i.createFramebuffer(),de.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,de.__webglMultisampledFramebuffer);for(let ve=0;ve<Ue.length;ve++){const Ne=Ue[ve];de.__webglColorRenderbuffer[ve]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,de.__webglColorRenderbuffer[ve]);const $e=s.convert(Ne.format,Ne.colorSpace),Ee=s.convert(Ne.type),Ze=y(Ne.internalFormat,$e,Ee,Ne.colorSpace,Y.isXRRenderTarget===!0),nt=Ie(Y);i.renderbufferStorageMultisample(i.RENDERBUFFER,nt,Ze,Y.width,Y.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+ve,i.RENDERBUFFER,de.__webglColorRenderbuffer[ve])}i.bindRenderbuffer(i.RENDERBUFFER,null),Y.depthBuffer&&(de.__webglDepthRenderbuffer=i.createRenderbuffer(),Z(de.__webglDepthRenderbuffer,Y,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(ie){t.bindTexture(i.TEXTURE_CUBE_MAP,Le.__webglTexture),W(i.TEXTURE_CUBE_MAP,Q,be);for(let Ue=0;Ue<6;Ue++)if(a&&Q.mipmaps&&Q.mipmaps.length>0)for(let ve=0;ve<Q.mipmaps.length;ve++)ne(de.__webglFramebuffer[Ue][ve],Y,Q,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,ve);else ne(de.__webglFramebuffer[Ue],Y,Q,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,0);b(Q,be)&&m(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(K){const Ue=Y.texture;for(let ve=0,Ne=Ue.length;ve<Ne;ve++){const $e=Ue[ve],Ee=n.get($e);t.bindTexture(i.TEXTURE_2D,Ee.__webglTexture),W(i.TEXTURE_2D,$e,be),ne(de.__webglFramebuffer,Y,$e,i.COLOR_ATTACHMENT0+ve,i.TEXTURE_2D,0),b($e,be)&&m(i.TEXTURE_2D)}t.unbindTexture()}else{let Ue=i.TEXTURE_2D;if((Y.isWebGL3DRenderTarget||Y.isWebGLArrayRenderTarget)&&(a?Ue=Y.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Ue,Le.__webglTexture),W(Ue,Q,be),a&&Q.mipmaps&&Q.mipmaps.length>0)for(let ve=0;ve<Q.mipmaps.length;ve++)ne(de.__webglFramebuffer[ve],Y,Q,i.COLOR_ATTACHMENT0,Ue,ve);else ne(de.__webglFramebuffer,Y,Q,i.COLOR_ATTACHMENT0,Ue,0);b(Q,be)&&m(Ue),t.unbindTexture()}Y.depthBuffer&&re(Y)}function fe(Y){const Q=v(Y)||a,de=Y.isWebGLMultipleRenderTargets===!0?Y.texture:[Y.texture];for(let Le=0,ie=de.length;Le<ie;Le++){const K=de[Le];if(b(K,Q)){const be=Y.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,Ue=n.get(K).__webglTexture;t.bindTexture(be,Ue),m(be),t.unbindTexture()}}}function xe(Y){if(a&&Y.samples>0&&ge(Y)===!1){const Q=Y.isWebGLMultipleRenderTargets?Y.texture:[Y.texture],de=Y.width,Le=Y.height;let ie=i.COLOR_BUFFER_BIT;const K=[],be=Y.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Ue=n.get(Y),ve=Y.isWebGLMultipleRenderTargets===!0;if(ve)for(let Ne=0;Ne<Q.length;Ne++)t.bindFramebuffer(i.FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ne,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Ue.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ne,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ue.__webglFramebuffer);for(let Ne=0;Ne<Q.length;Ne++){K.push(i.COLOR_ATTACHMENT0+Ne),Y.depthBuffer&&K.push(be);const $e=Ue.__ignoreDepthValues!==void 0?Ue.__ignoreDepthValues:!1;if($e===!1&&(Y.depthBuffer&&(ie|=i.DEPTH_BUFFER_BIT),Y.stencilBuffer&&(ie|=i.STENCIL_BUFFER_BIT)),ve&&i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Ue.__webglColorRenderbuffer[Ne]),$e===!0&&(i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[be]),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[be])),ve){const Ee=n.get(Q[Ne]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Ee,0)}i.blitFramebuffer(0,0,de,Le,0,0,de,Le,ie,i.NEAREST),c&&i.invalidateFramebuffer(i.READ_FRAMEBUFFER,K)}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),ve)for(let Ne=0;Ne<Q.length;Ne++){t.bindFramebuffer(i.FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ne,i.RENDERBUFFER,Ue.__webglColorRenderbuffer[Ne]);const $e=n.get(Q[Ne]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Ue.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ne,i.TEXTURE_2D,$e,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ue.__webglMultisampledFramebuffer)}}function Ie(Y){return Math.min(r.maxSamples,Y.samples)}function ge(Y){const Q=n.get(Y);return a&&Y.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Q.__useRenderToTexture!==!1}function Oe(Y){const Q=o.render.frame;u.get(Y)!==Q&&(u.set(Y,Q),Y.update())}function Me(Y,Q){const de=Y.colorSpace,Le=Y.format,ie=Y.type;return Y.isCompressedTexture===!0||Y.isVideoTexture===!0||Y.format===xb||de!==Ml&&de!==Ao&&(Vn.getTransfer(de)===ti?a===!1?e.has("EXT_sRGB")===!0&&Le===Ps?(Y.format=xb,Y.minFilter=hi,Y.generateMipmaps=!1):Q=pR.sRGBToLinear(Q):(Le!==Ps||ie!==ml)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",de)),Q}this.allocateTextureUnit=R,this.resetTextureUnits=L,this.setTexture2D=V,this.setTexture2DArray=G,this.setTexture3D=U,this.setTextureCube=z,this.rebindTextures=se,this.setupRenderTarget=$,this.updateRenderTargetMipmap=fe,this.updateMultisampleRenderTarget=xe,this.setupDepthRenderbuffer=re,this.setupFrameBufferTexture=ne,this.useMultisampledRTT=ge}function V6(i,e,t){const n=t.isWebGL2;function r(s,o=Ao){let a;const l=Vn.getTransfer(o);if(s===ml)return i.UNSIGNED_BYTE;if(s===nR)return i.UNSIGNED_SHORT_4_4_4_4;if(s===iR)return i.UNSIGNED_SHORT_5_5_5_1;if(s===e6)return i.BYTE;if(s===t6)return i.SHORT;if(s===gS)return i.UNSIGNED_SHORT;if(s===tR)return i.INT;if(s===lc)return i.UNSIGNED_INT;if(s===Na)return i.FLOAT;if(s===nm)return n?i.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===n6)return i.ALPHA;if(s===Ps)return i.RGBA;if(s===i6)return i.LUMINANCE;if(s===r6)return i.LUMINANCE_ALPHA;if(s===Cu)return i.DEPTH_COMPONENT;if(s===wd)return i.DEPTH_STENCIL;if(s===xb)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===s6)return i.RED;if(s===rR)return i.RED_INTEGER;if(s===o6)return i.RG;if(s===sR)return i.RG_INTEGER;if(s===oR)return i.RGBA_INTEGER;if(s===xx||s===bx||s===Sx||s===wx)if(l===ti)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===xx)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===bx)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===Sx)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===wx)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===xx)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===bx)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===Sx)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===wx)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===_T||s===yT||s===xT||s===bT)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===_T)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===yT)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===xT)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===bT)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===aR)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===ST||s===wT)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===ST)return l===ti?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===wT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===MT||s===AT||s===ET||s===TT||s===CT||s===PT||s===RT||s===IT||s===LT||s===DT||s===NT||s===FT||s===kT||s===UT)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===MT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===AT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===ET)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===TT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===CT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===PT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===RT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===IT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===LT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===DT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===NT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===FT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===kT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===UT)return l===ti?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===Mx||s===OT||s===BT)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===Mx)return l===ti?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===OT)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===BT)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===a6||s===zT||s===GT||s===VT)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===Mx)return a.COMPRESSED_RED_RGTC1_EXT;if(s===zT)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===GT)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===VT)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Tu?n?i.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[s]!==void 0?i[s]:null}return{convert:r}}let H6=class extends Zi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},To=class extends Gn{constructor(){super(),this.isGroup=!0,this.type="Group"}};const ZK={type:"move"};let Zw=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new To,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new To,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Te,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Te),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new To,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Te,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Te),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const _ of e.hand.values()){const v=t.getJointPose(_,n),g=this._getHandJoint(c,_);v!==null&&(g.matrix.fromArray(v.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=v.radius),g.visible=v!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),f=.02,p=.005;c.inputState.pinching&&d>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ZK)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new To;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}},QK=class extends Cc{constructor(e,t){super();const n=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,h=null,d=null,f=null,p=null;const _=t.getContextAttributes();let v=null,g=null;const b=[],m=[],y=new yt;let A=null;const w=new Zi;w.layers.enable(1),w.viewport=new Wn;const M=new Zi;M.layers.enable(2),M.viewport=new Wn;const T=[w,M],E=new H6;E.layers.enable(1),E.layers.enable(2);let C=null,N=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(W){let q=b[W];return q===void 0&&(q=new Zw,b[W]=q),q.getTargetRaySpace()},this.getControllerGrip=function(W){let q=b[W];return q===void 0&&(q=new Zw,b[W]=q),q.getGripSpace()},this.getHand=function(W){let q=b[W];return q===void 0&&(q=new Zw,b[W]=q),q.getHandSpace()};function P(W){const q=m.indexOf(W.inputSource);if(q===-1)return;const j=b[q];j!==void 0&&(j.update(W.inputSource,W.frame,c||o),j.dispatchEvent({type:W.type,data:W.inputSource}))}function L(){r.removeEventListener("select",P),r.removeEventListener("selectstart",P),r.removeEventListener("selectend",P),r.removeEventListener("squeeze",P),r.removeEventListener("squeezestart",P),r.removeEventListener("squeezeend",P),r.removeEventListener("end",L),r.removeEventListener("inputsourceschange",R);for(let W=0;W<b.length;W++){const q=m[W];q!==null&&(m[W]=null,b[W].disconnect(q))}C=null,N=null,e.setRenderTarget(v),f=null,d=null,h=null,r=null,g=null,B.stop(),n.isPresenting=!1,e.setPixelRatio(A),e.setSize(y.width,y.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(W){s=W,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(W){a=W,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(W){c=W},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(W){if(r=W,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",P),r.addEventListener("selectstart",P),r.addEventListener("selectend",P),r.addEventListener("squeeze",P),r.addEventListener("squeezestart",P),r.addEventListener("squeezeend",P),r.addEventListener("end",L),r.addEventListener("inputsourceschange",R),_.xrCompatible!==!0&&await t.makeXRCompatible(),A=e.getPixelRatio(),e.getSize(y),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const q={antialias:r.renderState.layers===void 0?_.antialias:!0,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(r,t,q),r.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),g=new Ga(f.framebufferWidth,f.framebufferHeight,{format:Ps,type:ml,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil})}else{let q=null,j=null,te=null;_.depth&&(te=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,q=_.stencil?wd:Cu,j=_.stencil?Tu:lc);const ne={colorFormat:t.RGBA8,depthFormat:te,scaleFactor:s};h=new XRWebGLBinding(r,t),d=h.createProjectionLayer(ne),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),g=new Ga(d.textureWidth,d.textureHeight,{format:Ps,type:ml,depthTexture:new xR(d.textureWidth,d.textureHeight,j,void 0,void 0,void 0,void 0,void 0,void 0,q),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0});const Z=e.properties.get(g);Z.__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),B.setContext(r),B.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function R(W){for(let q=0;q<W.removed.length;q++){const j=W.removed[q],te=m.indexOf(j);te>=0&&(m[te]=null,b[te].disconnect(j))}for(let q=0;q<W.added.length;q++){const j=W.added[q];let te=m.indexOf(j);if(te===-1){for(let Z=0;Z<b.length;Z++)if(Z>=m.length){m.push(j),te=Z;break}else if(m[Z]===null){m[Z]=j,te=Z;break}if(te===-1)break}const ne=b[te];ne&&ne.connect(j)}}const F=new Te,V=new Te;function G(W,q,j){F.setFromMatrixPosition(q.matrixWorld),V.setFromMatrixPosition(j.matrixWorld);const te=F.distanceTo(V),ne=q.projectionMatrix.elements,Z=j.projectionMatrix.elements,le=ne[14]/(ne[10]-1),re=ne[14]/(ne[10]+1),se=(ne[9]+1)/ne[5],$=(ne[9]-1)/ne[5],fe=(ne[8]-1)/ne[0],xe=(Z[8]+1)/Z[0],Ie=le*fe,ge=le*xe,Oe=te/(-fe+xe),Me=Oe*-fe;q.matrixWorld.decompose(W.position,W.quaternion,W.scale),W.translateX(Me),W.translateZ(Oe),W.matrixWorld.compose(W.position,W.quaternion,W.scale),W.matrixWorldInverse.copy(W.matrixWorld).invert();const Y=le+Oe,Q=re+Oe,de=Ie-Me,Le=ge+(te-Me),ie=se*re/Q*Y,K=$*re/Q*Y;W.projectionMatrix.makePerspective(de,Le,ie,K,Y,Q),W.projectionMatrixInverse.copy(W.projectionMatrix).invert()}function U(W,q){q===null?W.matrixWorld.copy(W.matrix):W.matrixWorld.multiplyMatrices(q.matrixWorld,W.matrix),W.matrixWorldInverse.copy(W.matrixWorld).invert()}this.updateCamera=function(W){if(r===null)return;E.near=M.near=w.near=W.near,E.far=M.far=w.far=W.far,(C!==E.near||N!==E.far)&&(r.updateRenderState({depthNear:E.near,depthFar:E.far}),C=E.near,N=E.far);const q=W.parent,j=E.cameras;U(E,q);for(let te=0;te<j.length;te++)U(j[te],q);j.length===2?G(E,w,M):E.projectionMatrix.copy(w.projectionMatrix),z(W,E,q)};function z(W,q,j){j===null?W.matrix.copy(q.matrixWorld):(W.matrix.copy(j.matrixWorld),W.matrix.invert(),W.matrix.multiply(q.matrixWorld)),W.matrix.decompose(W.position,W.quaternion,W.scale),W.updateMatrixWorld(!0),W.projectionMatrix.copy(q.projectionMatrix),W.projectionMatrixInverse.copy(q.projectionMatrixInverse),W.isPerspectiveCamera&&(W.fov=sm*2*Math.atan(1/W.projectionMatrix.elements[5]),W.zoom=1)}this.getCamera=function(){return E},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(W){l=W,d!==null&&(d.fixedFoveation=W),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=W)};let O=null;function D(W,q){if(u=q.getViewerPose(c||o),p=q,u!==null){const j=u.views;f!==null&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let te=!1;j.length!==E.cameras.length&&(E.cameras.length=0,te=!0);for(let ne=0;ne<j.length;ne++){const Z=j[ne];let le=null;if(f!==null)le=f.getViewport(Z);else{const se=h.getViewSubImage(d,Z);le=se.viewport,ne===0&&(e.setRenderTargetTextures(g,se.colorTexture,d.ignoreDepthValues?void 0:se.depthStencilTexture),e.setRenderTarget(g))}let re=T[ne];re===void 0&&(re=new Zi,re.layers.enable(ne),re.viewport=new Wn,T[ne]=re),re.matrix.fromArray(Z.transform.matrix),re.matrix.decompose(re.position,re.quaternion,re.scale),re.projectionMatrix.fromArray(Z.projectionMatrix),re.projectionMatrixInverse.copy(re.projectionMatrix).invert(),re.viewport.set(le.x,le.y,le.width,le.height),ne===0&&(E.matrix.copy(re.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),te===!0&&E.cameras.push(re)}}for(let j=0;j<b.length;j++){const te=m[j],ne=b[j];te!==null&&ne!==void 0&&ne.update(te,q,c||o)}O&&O(W,q),q.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:q}),p=null}const B=new F6;B.setAnimationLoop(D),this.setAnimationLoop=function(W){O=W},this.dispose=function(){}}};function JK(i,e){function t(v,g){v.matrixAutoUpdate===!0&&v.updateMatrix(),g.value.copy(v.matrix)}function n(v,g){g.color.getRGB(v.fogColor.value,L6(i)),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function r(v,g,b,m,y){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(v,g):g.isMeshToonMaterial?(s(v,g),h(v,g)):g.isMeshPhongMaterial?(s(v,g),u(v,g)):g.isMeshStandardMaterial?(s(v,g),d(v,g),g.isMeshPhysicalMaterial&&f(v,g,y)):g.isMeshMatcapMaterial?(s(v,g),p(v,g)):g.isMeshDepthMaterial?s(v,g):g.isMeshDistanceMaterial?(s(v,g),_(v,g)):g.isMeshNormalMaterial?s(v,g):g.isLineBasicMaterial?(o(v,g),g.isLineDashedMaterial&&a(v,g)):g.isPointsMaterial?l(v,g,b,m):g.isSpriteMaterial?c(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function s(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.bumpMap&&(v.bumpMap.value=g.bumpMap,t(g.bumpMap,v.bumpMapTransform),v.bumpScale.value=g.bumpScale,g.side===Is&&(v.bumpScale.value*=-1)),g.normalMap&&(v.normalMap.value=g.normalMap,t(g.normalMap,v.normalMapTransform),v.normalScale.value.copy(g.normalScale),g.side===Is&&v.normalScale.value.negate()),g.displacementMap&&(v.displacementMap.value=g.displacementMap,t(g.displacementMap,v.displacementMapTransform),v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,v.emissiveMapTransform)),g.specularMap&&(v.specularMap.value=g.specularMap,t(g.specularMap,v.specularMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);const b=e.get(g).envMap;if(b&&(v.envMap.value=b,v.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap){v.lightMap.value=g.lightMap;const m=i._useLegacyLights===!0?Math.PI:1;v.lightMapIntensity.value=g.lightMapIntensity*m,t(g.lightMap,v.lightMapTransform)}g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,v.aoMapTransform))}function o(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform))}function a(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function l(v,g,b,m){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*b,v.scale.value=m*.5,g.map&&(v.map.value=g.map,t(g.map,v.uvTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function c(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function u(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function h(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function d(v,g){v.metalness.value=g.metalness,g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,v.metalnessMapTransform)),v.roughness.value=g.roughness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,v.roughnessMapTransform)),e.get(g).envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function f(v,g,b){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,v.sheenColorMapTransform)),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,v.sheenRoughnessMapTransform))),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,v.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(v.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===Is&&v.clearcoatNormalScale.value.negate())),g.iridescence>0&&(v.iridescence.value=g.iridescence,v.iridescenceIOR.value=g.iridescenceIOR,v.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(v.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,v.iridescenceMapTransform)),g.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=b.texture,v.transmissionSamplerSize.value.set(b.width,b.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,v.transmissionMapTransform)),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(v.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(v.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,v.specularColorMapTransform)),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,v.specularIntensityMapTransform))}function p(v,g){g.matcap&&(v.matcap.value=g.matcap)}function _(v,g){const b=e.get(g).light;v.referencePosition.value.setFromMatrixPosition(b.matrixWorld),v.nearDistance.value=b.shadow.camera.near,v.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function eZ(i,e,t,n){let r={},s={},o=[];const a=t.isWebGL2?i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(b,m){const y=m.program;n.uniformBlockBinding(b,y)}function c(b,m){let y=r[b.id];y===void 0&&(p(b),y=u(b),r[b.id]=y,b.addEventListener("dispose",v));const A=m.program;n.updateUBOMapping(b,A);const w=e.render.frame;s[b.id]!==w&&(d(b),s[b.id]=w)}function u(b){const m=h();b.__bindingPointIndex=m;const y=i.createBuffer(),A=b.__size,w=b.usage;return i.bindBuffer(i.UNIFORM_BUFFER,y),i.bufferData(i.UNIFORM_BUFFER,A,w),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,m,y),y}function h(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(b){const m=r[b.id],y=b.uniforms,A=b.__cache;i.bindBuffer(i.UNIFORM_BUFFER,m);for(let w=0,M=y.length;w<M;w++){const T=Array.isArray(y[w])?y[w]:[y[w]];for(let E=0,C=T.length;E<C;E++){const N=T[E];if(f(N,w,E,A)===!0){const P=N.__offset,L=Array.isArray(N.value)?N.value:[N.value];let R=0;for(let F=0;F<L.length;F++){const V=L[F],G=_(V);typeof V=="number"||typeof V=="boolean"?(N.__data[0]=V,i.bufferSubData(i.UNIFORM_BUFFER,P+R,N.__data)):V.isMatrix3?(N.__data[0]=V.elements[0],N.__data[1]=V.elements[1],N.__data[2]=V.elements[2],N.__data[3]=0,N.__data[4]=V.elements[3],N.__data[5]=V.elements[4],N.__data[6]=V.elements[5],N.__data[7]=0,N.__data[8]=V.elements[6],N.__data[9]=V.elements[7],N.__data[10]=V.elements[8],N.__data[11]=0):(V.toArray(N.__data,R),R+=G.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,P,N.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function f(b,m,y,A){const w=b.value,M=m+"_"+y;if(A[M]===void 0)return typeof w=="number"||typeof w=="boolean"?A[M]=w:A[M]=w.clone(),!0;{const T=A[M];if(typeof w=="number"||typeof w=="boolean"){if(T!==w)return A[M]=w,!0}else if(T.equals(w)===!1)return T.copy(w),!0}return!1}function p(b){const m=b.uniforms;let y=0;const A=16;for(let M=0,T=m.length;M<T;M++){const E=Array.isArray(m[M])?m[M]:[m[M]];for(let C=0,N=E.length;C<N;C++){const P=E[C],L=Array.isArray(P.value)?P.value:[P.value];for(let R=0,F=L.length;R<F;R++){const V=L[R],G=_(V),U=y%A;U!==0&&A-U<G.boundary&&(y+=A-U),P.__data=new Float32Array(G.storage/Float32Array.BYTES_PER_ELEMENT),P.__offset=y,y+=G.storage}}}const w=y%A;return w>0&&(y+=A-w),b.__size=y,b.__cache={},this}function _(b){const m={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(m.boundary=4,m.storage=4):b.isVector2?(m.boundary=8,m.storage=8):b.isVector3||b.isColor?(m.boundary=16,m.storage=12):b.isVector4?(m.boundary=16,m.storage=16):b.isMatrix3?(m.boundary=48,m.storage=48):b.isMatrix4?(m.boundary=64,m.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),m}function v(b){const m=b.target;m.removeEventListener("dispose",v);const y=o.indexOf(m.__bindingPointIndex);o.splice(y,1),i.deleteBuffer(r[m.id]),delete r[m.id],delete s[m.id]}function g(){for(const b in r)i.deleteBuffer(r[b]);o=[],r={},s={}}return{bind:l,update:c,dispose:g}}let bR=class{constructor(e={}){const{canvas:t=M6(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let d;n!==null?d=n.getContextAttributes().alpha:d=o;const f=new Uint32Array(4),p=new Int32Array(4);let _=null,v=null;const g=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=_r,this._useLegacyLights=!1,this.toneMapping=pl,this.toneMappingExposure=1;const m=this;let y=!1,A=0,w=0,M=null,T=-1,E=null;const C=new Wn,N=new Wn;let P=null;const L=new It(0);let R=0,F=t.width,V=t.height,G=1,U=null,z=null;const O=new Wn(0,0,F,V),D=new Wn(0,0,F,V);let B=!1;const W=new O1;let q=!1,j=!1,te=null;const ne=new en,Z=new yt,le=new Te,re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function se(){return M===null?G:1}let $=n;function fe(H,pe){for(let Ae=0;Ae<H.length;Ae++){const we=H[Ae],Pe=t.getContext(we,pe);if(Pe!==null)return Pe}return null}try{const H={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${I1}`),t.addEventListener("webglcontextlost",je,!1),t.addEventListener("webglcontextrestored",ee,!1),t.addEventListener("webglcontextcreationerror",Ge,!1),$===null){const pe=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&pe.shift(),$=fe(pe,H),$===null)throw fe(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&$ instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),$.getShaderPrecisionFormat===void 0&&($.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H}let xe,Ie,ge,Oe,Me,Y,Q,de,Le,ie,K,be,Ue,ve,Ne,$e,Ee,Ze,nt,rt,Be,qe,it,at;function ht(){xe=new pY($),Ie=new lY($,xe,e),xe.init(Ie),qe=new V6($,xe,Ie),ge=new YK($,xe,Ie),Oe=new vY($),Me=new UK,Y=new KK($,xe,ge,Me,Ie,qe,Oe),Q=new uY(m),de=new fY(m),Le=new Aj($,Ie),it=new oY($,xe,Le,Ie),ie=new mY($,Le,Oe,it),K=new bY($,ie,Le,Oe),nt=new xY($,Ie,Y),$e=new cY(Me),be=new kK(m,Q,de,xe,Ie,it,$e),Ue=new JK(m,Me),ve=new BK,Ne=new WK(xe,Ie),Ze=new sY(m,Q,de,ge,K,d,l),Ee=new qK(m,K,Ie),at=new eZ($,Oe,Ie,ge),rt=new aY($,xe,Oe,Ie),Be=new gY($,xe,Oe,Ie),Oe.programs=be.programs,m.capabilities=Ie,m.extensions=xe,m.properties=Me,m.renderLists=ve,m.shadowMap=Ee,m.state=ge,m.info=Oe}ht();const Qe=new QK(m,$);this.xr=Qe,this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.forceContextLoss=function(){const H=xe.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){const H=xe.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(H){H!==void 0&&(G=H,this.setSize(F,V,!1))},this.getSize=function(H){return H.set(F,V)},this.setSize=function(H,pe,Ae=!0){if(Qe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}F=H,V=pe,t.width=Math.floor(H*G),t.height=Math.floor(pe*G),Ae===!0&&(t.style.width=H+"px",t.style.height=pe+"px"),this.setViewport(0,0,H,pe)},this.getDrawingBufferSize=function(H){return H.set(F*G,V*G).floor()},this.setDrawingBufferSize=function(H,pe,Ae){F=H,V=pe,G=Ae,t.width=Math.floor(H*Ae),t.height=Math.floor(pe*Ae),this.setViewport(0,0,H,pe)},this.getCurrentViewport=function(H){return H.copy(C)},this.getViewport=function(H){return H.copy(O)},this.setViewport=function(H,pe,Ae,we){H.isVector4?O.set(H.x,H.y,H.z,H.w):O.set(H,pe,Ae,we),ge.viewport(C.copy(O).multiplyScalar(G).floor())},this.getScissor=function(H){return H.copy(D)},this.setScissor=function(H,pe,Ae,we){H.isVector4?D.set(H.x,H.y,H.z,H.w):D.set(H,pe,Ae,we),ge.scissor(N.copy(D).multiplyScalar(G).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(H){ge.setScissorTest(B=H)},this.setOpaqueSort=function(H){U=H},this.setTransparentSort=function(H){z=H},this.getClearColor=function(H){return H.copy(Ze.getClearColor())},this.setClearColor=function(){Ze.setClearColor.apply(Ze,arguments)},this.getClearAlpha=function(){return Ze.getClearAlpha()},this.setClearAlpha=function(){Ze.setClearAlpha.apply(Ze,arguments)},this.clear=function(H=!0,pe=!0,Ae=!0){let we=0;if(H){let Pe=!1;if(M!==null){const et=M.texture.format;Pe=et===oR||et===sR||et===rR}if(Pe){const et=M.texture.type,dt=et===ml||et===lc||et===gS||et===Tu||et===nR||et===iR,xt=Ze.getClearColor(),Ye=Ze.getClearAlpha(),We=xt.r,st=xt.g,ct=xt.b;dt?(f[0]=We,f[1]=st,f[2]=ct,f[3]=Ye,$.clearBufferuiv($.COLOR,0,f)):(p[0]=We,p[1]=st,p[2]=ct,p[3]=Ye,$.clearBufferiv($.COLOR,0,p))}else we|=$.COLOR_BUFFER_BIT}pe&&(we|=$.DEPTH_BUFFER_BIT),Ae&&(we|=$.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),$.clear(we)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",je,!1),t.removeEventListener("webglcontextrestored",ee,!1),t.removeEventListener("webglcontextcreationerror",Ge,!1),ve.dispose(),Ne.dispose(),Me.dispose(),Q.dispose(),de.dispose(),K.dispose(),it.dispose(),at.dispose(),be.dispose(),Qe.dispose(),Qe.removeEventListener("sessionstart",J),Qe.removeEventListener("sessionend",ae),te&&(te.dispose(),te=null),ue.stop()};function je(H){H.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function ee(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const H=Oe.autoReset,pe=Ee.enabled,Ae=Ee.autoUpdate,we=Ee.needsUpdate,Pe=Ee.type;ht(),Oe.autoReset=H,Ee.enabled=pe,Ee.autoUpdate=Ae,Ee.needsUpdate=we,Ee.type=Pe}function Ge(H){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",H.statusMessage)}function Ce(H){const pe=H.target;pe.removeEventListener("dispose",Ce),De(pe)}function De(H){Xe(H),Me.remove(H)}function Xe(H){const pe=Me.get(H).programs;pe!==void 0&&(pe.forEach(function(Ae){be.releaseProgram(Ae)}),H.isShaderMaterial&&be.releaseShaderCache(H))}this.renderBufferDirect=function(H,pe,Ae,we,Pe,et){pe===null&&(pe=re);const dt=Pe.isMesh&&Pe.matrixWorld.determinant()<0,xt=Gt(H,pe,Ae,we,Pe);ge.setMaterial(we,dt);let Ye=Ae.index,We=1;if(we.wireframe===!0){if(Ye=ie.getWireframeAttribute(Ae),Ye===void 0)return;We=2}const st=Ae.drawRange,ct=Ae.attributes.position;let Nt=st.start*We,Ft=(st.start+st.count)*We;et!==null&&(Nt=Math.max(Nt,et.start*We),Ft=Math.min(Ft,(et.start+et.count)*We)),Ye!==null?(Nt=Math.max(Nt,0),Ft=Math.min(Ft,Ye.count)):ct!=null&&(Nt=Math.max(Nt,0),Ft=Math.min(Ft,ct.count));const Dt=Ft-Nt;if(Dt<0||Dt===1/0)return;it.setup(Pe,we,xt,Ae,Ye);let Bt,St=rt;if(Ye!==null&&(Bt=Le.get(Ye),St=Be,St.setIndex(Bt)),Pe.isMesh)we.wireframe===!0?(ge.setLineWidth(we.wireframeLinewidth*se()),St.setMode($.LINES)):St.setMode($.TRIANGLES);else if(Pe.isLine){let vt=we.linewidth;vt===void 0&&(vt=1),ge.setLineWidth(vt*se()),Pe.isLineSegments?St.setMode($.LINES):Pe.isLineLoop?St.setMode($.LINE_LOOP):St.setMode($.LINE_STRIP)}else Pe.isPoints?St.setMode($.POINTS):Pe.isSprite&&St.setMode($.TRIANGLES);if(Pe.isBatchedMesh)St.renderMultiDraw(Pe._multiDrawStarts,Pe._multiDrawCounts,Pe._multiDrawCount);else if(Pe.isInstancedMesh)St.renderInstances(Nt,Dt,Pe.count);else if(Ae.isInstancedBufferGeometry){const vt=Ae._maxInstanceCount!==void 0?Ae._maxInstanceCount:1/0,Wt=Math.min(Ae.instanceCount,vt);St.renderInstances(Nt,Dt,Wt)}else St.render(Nt,Dt)};function gt(H,pe,Ae){H.transparent===!0&&H.side===cr&&H.forceSinglePass===!1?(H.side=Is,H.needsUpdate=!0,lt(H,pe,Ae),H.side=Sl,H.needsUpdate=!0,lt(H,pe,Ae),H.side=cr):lt(H,pe,Ae)}this.compile=function(H,pe,Ae=null){Ae===null&&(Ae=H),v=Ne.get(Ae),v.init(),b.push(v),Ae.traverseVisible(function(Pe){Pe.isLight&&Pe.layers.test(pe.layers)&&(v.pushLight(Pe),Pe.castShadow&&v.pushShadow(Pe))}),H!==Ae&&H.traverseVisible(function(Pe){Pe.isLight&&Pe.layers.test(pe.layers)&&(v.pushLight(Pe),Pe.castShadow&&v.pushShadow(Pe))}),v.setupLights(m._useLegacyLights);const we=new Set;return H.traverse(function(Pe){const et=Pe.material;if(et)if(Array.isArray(et))for(let dt=0;dt<et.length;dt++){const xt=et[dt];gt(xt,Ae,Pe),we.add(xt)}else gt(et,Ae,Pe),we.add(et)}),b.pop(),v=null,we},this.compileAsync=function(H,pe,Ae=null){const we=this.compile(H,pe,Ae);return new Promise(Pe=>{function et(){if(we.forEach(function(dt){Me.get(dt).currentProgram.isReady()&&we.delete(dt)}),we.size===0){Pe(H);return}setTimeout(et,10)}xe.get("KHR_parallel_shader_compile")!==null?et():setTimeout(et,10)})};let _t=null;function Mt(H){_t&&_t(H)}function J(){ue.stop()}function ae(){ue.start()}const ue=new F6;ue.setAnimationLoop(Mt),typeof self<"u"&&ue.setContext(self),this.setAnimationLoop=function(H){_t=H,Qe.setAnimationLoop(H),H===null?ue.stop():ue.start()},Qe.addEventListener("sessionstart",J),Qe.addEventListener("sessionend",ae),this.render=function(H,pe){if(pe!==void 0&&pe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),pe.parent===null&&pe.matrixWorldAutoUpdate===!0&&pe.updateMatrixWorld(),Qe.enabled===!0&&Qe.isPresenting===!0&&(Qe.cameraAutoUpdate===!0&&Qe.updateCamera(pe),pe=Qe.getCamera()),H.isScene===!0&&H.onBeforeRender(m,H,pe,M),v=Ne.get(H,b.length),v.init(),b.push(v),ne.multiplyMatrices(pe.projectionMatrix,pe.matrixWorldInverse),W.setFromProjectionMatrix(ne),j=this.localClippingEnabled,q=$e.init(this.clippingPlanes,j),_=ve.get(H,g.length),_.init(),g.push(_),ye(H,pe,0,m.sortObjects),_.finish(),m.sortObjects===!0&&_.sort(U,z),this.info.render.frame++,q===!0&&$e.beginShadows();const Ae=v.state.shadowsArray;if(Ee.render(Ae,H,pe),q===!0&&$e.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ze.render(_,H),v.setupLights(m._useLegacyLights),pe.isArrayCamera){const we=pe.cameras;for(let Pe=0,et=we.length;Pe<et;Pe++){const dt=we[Pe];Se(_,H,dt,dt.viewport)}}else Se(_,H,pe);M!==null&&(Y.updateMultisampleRenderTarget(M),Y.updateRenderTargetMipmap(M)),H.isScene===!0&&H.onAfterRender(m,H,pe),it.resetDefaultState(),T=-1,E=null,b.pop(),b.length>0?v=b[b.length-1]:v=null,g.pop(),g.length>0?_=g[g.length-1]:_=null};function ye(H,pe,Ae,we){if(H.visible===!1)return;if(H.layers.test(pe.layers)){if(H.isGroup)Ae=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(pe);else if(H.isLight)v.pushLight(H),H.castShadow&&v.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||W.intersectsSprite(H)){we&&le.setFromMatrixPosition(H.matrixWorld).applyMatrix4(ne);const dt=K.update(H),xt=H.material;xt.visible&&_.push(H,dt,xt,Ae,le.z,null)}}else if((H.isMesh||H.isLine||H.isPoints)&&(!H.frustumCulled||W.intersectsObject(H))){const dt=K.update(H),xt=H.material;if(we&&(H.boundingSphere!==void 0?(H.boundingSphere===null&&H.computeBoundingSphere(),le.copy(H.boundingSphere.center)):(dt.boundingSphere===null&&dt.computeBoundingSphere(),le.copy(dt.boundingSphere.center)),le.applyMatrix4(H.matrixWorld).applyMatrix4(ne)),Array.isArray(xt)){const Ye=dt.groups;for(let We=0,st=Ye.length;We<st;We++){const ct=Ye[We],Nt=xt[ct.materialIndex];Nt&&Nt.visible&&_.push(H,dt,Nt,Ae,le.z,ct)}}else xt.visible&&_.push(H,dt,xt,Ae,le.z,null)}}const et=H.children;for(let dt=0,xt=et.length;dt<xt;dt++)ye(et[dt],pe,Ae,we)}function Se(H,pe,Ae,we){const Pe=H.opaque,et=H.transmissive,dt=H.transparent;v.setupLightsView(Ae),q===!0&&$e.setGlobalState(m.clippingPlanes,Ae),et.length>0&&Fe(Pe,et,pe,Ae),we&&ge.viewport(C.copy(we)),Pe.length>0&&ze(Pe,pe,Ae),et.length>0&&ze(et,pe,Ae),dt.length>0&&ze(dt,pe,Ae),ge.buffers.depth.setTest(!0),ge.buffers.depth.setMask(!0),ge.buffers.color.setMask(!0),ge.setPolygonOffset(!1)}function Fe(H,pe,Ae,we){if((Ae.isScene===!0?Ae.overrideMaterial:null)!==null)return;const et=Ie.isWebGL2;te===null&&(te=new Ga(1,1,{generateMipmaps:!0,type:xe.has("EXT_color_buffer_half_float")?nm:ml,minFilter:wl,samples:et?4:0})),m.getDrawingBufferSize(Z),et?te.setSize(Z.x,Z.y):te.setSize(bb(Z.x),bb(Z.y));const dt=m.getRenderTarget();m.setRenderTarget(te),m.getClearColor(L),R=m.getClearAlpha(),R<1&&m.setClearColor(16777215,.5),m.clear();const xt=m.toneMapping;m.toneMapping=pl,ze(H,Ae,we),Y.updateMultisampleRenderTarget(te),Y.updateRenderTargetMipmap(te);let Ye=!1;for(let We=0,st=pe.length;We<st;We++){const ct=pe[We],Nt=ct.object,Ft=ct.geometry,Dt=ct.material,Bt=ct.group;if(Dt.side===cr&&Nt.layers.test(we.layers)){const St=Dt.side;Dt.side=Is,Dt.needsUpdate=!0,He(Nt,Ae,we,Ft,Dt,Bt),Dt.side=St,Dt.needsUpdate=!0,Ye=!0}}Ye===!0&&(Y.updateMultisampleRenderTarget(te),Y.updateRenderTargetMipmap(te)),m.setRenderTarget(dt),m.setClearColor(L,R),m.toneMapping=xt}function ze(H,pe,Ae){const we=pe.isScene===!0?pe.overrideMaterial:null;for(let Pe=0,et=H.length;Pe<et;Pe++){const dt=H[Pe],xt=dt.object,Ye=dt.geometry,We=we===null?dt.material:we,st=dt.group;xt.layers.test(Ae.layers)&&He(xt,pe,Ae,Ye,We,st)}}function He(H,pe,Ae,we,Pe,et){H.onBeforeRender(m,pe,Ae,we,Pe,et),H.modelViewMatrix.multiplyMatrices(Ae.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),Pe.onBeforeRender(m,pe,Ae,we,H,et),Pe.transparent===!0&&Pe.side===cr&&Pe.forceSinglePass===!1?(Pe.side=Is,Pe.needsUpdate=!0,m.renderBufferDirect(Ae,pe,we,Pe,H,et),Pe.side=Sl,Pe.needsUpdate=!0,m.renderBufferDirect(Ae,pe,we,Pe,H,et),Pe.side=cr):m.renderBufferDirect(Ae,pe,we,Pe,H,et),H.onAfterRender(m,pe,Ae,we,Pe,et)}function lt(H,pe,Ae){pe.isScene!==!0&&(pe=re);const we=Me.get(H),Pe=v.state.lights,et=v.state.shadowsArray,dt=Pe.state.version,xt=be.getParameters(H,Pe.state,et,pe,Ae),Ye=be.getProgramCacheKey(xt);let We=we.programs;we.environment=H.isMeshStandardMaterial?pe.environment:null,we.fog=pe.fog,we.envMap=(H.isMeshStandardMaterial?de:Q).get(H.envMap||we.environment),We===void 0&&(H.addEventListener("dispose",Ce),We=new Map,we.programs=We);let st=We.get(Ye);if(st!==void 0){if(we.currentProgram===st&&we.lightsStateVersion===dt)return wt(H,xt),st}else xt.uniforms=be.getUniforms(H),H.onBuild(Ae,xt,m),H.onBeforeCompile(xt,m),st=be.acquireProgram(xt,Ye),We.set(Ye,st),we.uniforms=xt.uniforms;const ct=we.uniforms;return(!H.isShaderMaterial&&!H.isRawShaderMaterial||H.clipping===!0)&&(ct.clippingPlanes=$e.uniform),wt(H,xt),we.needsLights=bt(H),we.lightsStateVersion=dt,we.needsLights&&(ct.ambientLightColor.value=Pe.state.ambient,ct.lightProbe.value=Pe.state.probe,ct.directionalLights.value=Pe.state.directional,ct.directionalLightShadows.value=Pe.state.directionalShadow,ct.spotLights.value=Pe.state.spot,ct.spotLightShadows.value=Pe.state.spotShadow,ct.rectAreaLights.value=Pe.state.rectArea,ct.ltc_1.value=Pe.state.rectAreaLTC1,ct.ltc_2.value=Pe.state.rectAreaLTC2,ct.pointLights.value=Pe.state.point,ct.pointLightShadows.value=Pe.state.pointShadow,ct.hemisphereLights.value=Pe.state.hemi,ct.directionalShadowMap.value=Pe.state.directionalShadowMap,ct.directionalShadowMatrix.value=Pe.state.directionalShadowMatrix,ct.spotShadowMap.value=Pe.state.spotShadowMap,ct.spotLightMatrix.value=Pe.state.spotLightMatrix,ct.spotLightMap.value=Pe.state.spotLightMap,ct.pointShadowMap.value=Pe.state.pointShadowMap,ct.pointShadowMatrix.value=Pe.state.pointShadowMatrix),we.currentProgram=st,we.uniformsList=null,st}function mt(H){if(H.uniformsList===null){const pe=H.currentProgram.getUniforms();H.uniformsList=Cx.seqWithValue(pe.seq,H.uniforms)}return H.uniformsList}function wt(H,pe){const Ae=Me.get(H);Ae.outputColorSpace=pe.outputColorSpace,Ae.batching=pe.batching,Ae.instancing=pe.instancing,Ae.instancingColor=pe.instancingColor,Ae.skinning=pe.skinning,Ae.morphTargets=pe.morphTargets,Ae.morphNormals=pe.morphNormals,Ae.morphColors=pe.morphColors,Ae.morphTargetsCount=pe.morphTargetsCount,Ae.numClippingPlanes=pe.numClippingPlanes,Ae.numIntersection=pe.numClipIntersection,Ae.vertexAlphas=pe.vertexAlphas,Ae.vertexTangents=pe.vertexTangents,Ae.toneMapping=pe.toneMapping}function Gt(H,pe,Ae,we,Pe){pe.isScene!==!0&&(pe=re),Y.resetTextureUnits();const et=pe.fog,dt=we.isMeshStandardMaterial?pe.environment:null,xt=M===null?m.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:Ml,Ye=(we.isMeshStandardMaterial?de:Q).get(we.envMap||dt),We=we.vertexColors===!0&&!!Ae.attributes.color&&Ae.attributes.color.itemSize===4,st=!!Ae.attributes.tangent&&(!!we.normalMap||we.anisotropy>0),ct=!!Ae.morphAttributes.position,Nt=!!Ae.morphAttributes.normal,Ft=!!Ae.morphAttributes.color;let Dt=pl;we.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(Dt=m.toneMapping);const Bt=Ae.morphAttributes.position||Ae.morphAttributes.normal||Ae.morphAttributes.color,St=Bt!==void 0?Bt.length:0,vt=Me.get(we),Wt=v.state.lights;if(q===!0&&(j===!0||H!==E)){const dn=H===E&&we.id===T;$e.setState(we,H,dn)}let Lt=!1;we.version===vt.__version?(vt.needsLights&&vt.lightsStateVersion!==Wt.state.version||vt.outputColorSpace!==xt||Pe.isBatchedMesh&&vt.batching===!1||!Pe.isBatchedMesh&&vt.batching===!0||Pe.isInstancedMesh&&vt.instancing===!1||!Pe.isInstancedMesh&&vt.instancing===!0||Pe.isSkinnedMesh&&vt.skinning===!1||!Pe.isSkinnedMesh&&vt.skinning===!0||Pe.isInstancedMesh&&vt.instancingColor===!0&&Pe.instanceColor===null||Pe.isInstancedMesh&&vt.instancingColor===!1&&Pe.instanceColor!==null||vt.envMap!==Ye||we.fog===!0&&vt.fog!==et||vt.numClippingPlanes!==void 0&&(vt.numClippingPlanes!==$e.numPlanes||vt.numIntersection!==$e.numIntersection)||vt.vertexAlphas!==We||vt.vertexTangents!==st||vt.morphTargets!==ct||vt.morphNormals!==Nt||vt.morphColors!==Ft||vt.toneMapping!==Dt||Ie.isWebGL2===!0&&vt.morphTargetsCount!==St)&&(Lt=!0):(Lt=!0,vt.__version=we.version);let yn=vt.currentProgram;Lt===!0&&(yn=lt(we,pe,Pe));let bi=!1,qn=!1,Ln=!1;const tn=yn.getUniforms(),Yn=vt.uniforms;if(ge.useProgram(yn.program)&&(bi=!0,qn=!0,Ln=!0),we.id!==T&&(T=we.id,qn=!0),bi||E!==H){tn.setValue($,"projectionMatrix",H.projectionMatrix),tn.setValue($,"viewMatrix",H.matrixWorldInverse);const dn=tn.map.cameraPosition;dn!==void 0&&dn.setValue($,le.setFromMatrixPosition(H.matrixWorld)),Ie.logarithmicDepthBuffer&&tn.setValue($,"logDepthBufFC",2/(Math.log(H.far+1)/Math.LN2)),(we.isMeshPhongMaterial||we.isMeshToonMaterial||we.isMeshLambertMaterial||we.isMeshBasicMaterial||we.isMeshStandardMaterial||we.isShaderMaterial)&&tn.setValue($,"isOrthographic",H.isOrthographicCamera===!0),E!==H&&(E=H,qn=!0,Ln=!0)}if(Pe.isSkinnedMesh){tn.setOptional($,Pe,"bindMatrix"),tn.setOptional($,Pe,"bindMatrixInverse");const dn=Pe.skeleton;dn&&(Ie.floatVertexTextures?(dn.boneTexture===null&&dn.computeBoneTexture(),tn.setValue($,"boneTexture",dn.boneTexture,Y)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}Pe.isBatchedMesh&&(tn.setOptional($,Pe,"batchingTexture"),tn.setValue($,"batchingTexture",Pe._matricesTexture,Y));const Ji=Ae.morphAttributes;if((Ji.position!==void 0||Ji.normal!==void 0||Ji.color!==void 0&&Ie.isWebGL2===!0)&&nt.update(Pe,Ae,yn),(qn||vt.receiveShadow!==Pe.receiveShadow)&&(vt.receiveShadow=Pe.receiveShadow,tn.setValue($,"receiveShadow",Pe.receiveShadow)),we.isMeshGouraudMaterial&&we.envMap!==null&&(Yn.envMap.value=Ye,Yn.flipEnvMap.value=Ye.isCubeTexture&&Ye.isRenderTargetTexture===!1?-1:1),qn&&(tn.setValue($,"toneMappingExposure",m.toneMappingExposure),vt.needsLights&&Tt(Yn,Ln),et&&we.fog===!0&&Ue.refreshFogUniforms(Yn,et),Ue.refreshMaterialUniforms(Yn,we,G,V,te),Cx.upload($,mt(vt),Yn,Y)),we.isShaderMaterial&&we.uniformsNeedUpdate===!0&&(Cx.upload($,mt(vt),Yn,Y),we.uniformsNeedUpdate=!1),we.isSpriteMaterial&&tn.setValue($,"center",Pe.center),tn.setValue($,"modelViewMatrix",Pe.modelViewMatrix),tn.setValue($,"normalMatrix",Pe.normalMatrix),tn.setValue($,"modelMatrix",Pe.matrixWorld),we.isShaderMaterial||we.isRawShaderMaterial){const dn=we.uniformsGroups;for(let Qn=0,er=dn.length;Qn<er;Qn++)if(Ie.isWebGL2){const Mr=dn[Qn];at.update(Mr,yn),at.bind(Mr,yn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return yn}function Tt(H,pe){H.ambientLightColor.needsUpdate=pe,H.lightProbe.needsUpdate=pe,H.directionalLights.needsUpdate=pe,H.directionalLightShadows.needsUpdate=pe,H.pointLights.needsUpdate=pe,H.pointLightShadows.needsUpdate=pe,H.spotLights.needsUpdate=pe,H.spotLightShadows.needsUpdate=pe,H.rectAreaLights.needsUpdate=pe,H.hemisphereLights.needsUpdate=pe}function bt(H){return H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&H.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(H,pe,Ae){Me.get(H.texture).__webglTexture=pe,Me.get(H.depthTexture).__webglTexture=Ae;const we=Me.get(H);we.__hasExternalTextures=!0,we.__hasExternalTextures&&(we.__autoAllocateDepthBuffer=Ae===void 0,we.__autoAllocateDepthBuffer||xe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),we.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(H,pe){const Ae=Me.get(H);Ae.__webglFramebuffer=pe,Ae.__useDefaultFramebuffer=pe===void 0},this.setRenderTarget=function(H,pe=0,Ae=0){M=H,A=pe,w=Ae;let we=!0,Pe=null,et=!1,dt=!1;if(H){const Ye=Me.get(H);Ye.__useDefaultFramebuffer!==void 0?(ge.bindFramebuffer($.FRAMEBUFFER,null),we=!1):Ye.__webglFramebuffer===void 0?Y.setupRenderTarget(H):Ye.__hasExternalTextures&&Y.rebindTextures(H,Me.get(H.texture).__webglTexture,Me.get(H.depthTexture).__webglTexture);const We=H.texture;(We.isData3DTexture||We.isDataArrayTexture||We.isCompressedArrayTexture)&&(dt=!0);const st=Me.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(Array.isArray(st[pe])?Pe=st[pe][Ae]:Pe=st[pe],et=!0):Ie.isWebGL2&&H.samples>0&&Y.useMultisampledRTT(H)===!1?Pe=Me.get(H).__webglMultisampledFramebuffer:Array.isArray(st)?Pe=st[Ae]:Pe=st,C.copy(H.viewport),N.copy(H.scissor),P=H.scissorTest}else C.copy(O).multiplyScalar(G).floor(),N.copy(D).multiplyScalar(G).floor(),P=B;if(ge.bindFramebuffer($.FRAMEBUFFER,Pe)&&Ie.drawBuffers&&we&&ge.drawBuffers(H,Pe),ge.viewport(C),ge.scissor(N),ge.setScissorTest(P),et){const Ye=Me.get(H.texture);$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Ye.__webglTexture,Ae)}else if(dt){const Ye=Me.get(H.texture),We=pe||0;$.framebufferTextureLayer($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,Ye.__webglTexture,Ae||0,We)}T=-1},this.readRenderTargetPixels=function(H,pe,Ae,we,Pe,et,dt){if(!(H&&H.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let xt=Me.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&dt!==void 0&&(xt=xt[dt]),xt){ge.bindFramebuffer($.FRAMEBUFFER,xt);try{const Ye=H.texture,We=Ye.format,st=Ye.type;if(We!==Ps&&qe.convert(We)!==$.getParameter($.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ct=st===nm&&(xe.has("EXT_color_buffer_half_float")||Ie.isWebGL2&&xe.has("EXT_color_buffer_float"));if(st!==ml&&qe.convert(st)!==$.getParameter($.IMPLEMENTATION_COLOR_READ_TYPE)&&!(st===Na&&(Ie.isWebGL2||xe.has("OES_texture_float")||xe.has("WEBGL_color_buffer_float")))&&!ct){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}pe>=0&&pe<=H.width-we&&Ae>=0&&Ae<=H.height-Pe&&$.readPixels(pe,Ae,we,Pe,qe.convert(We),qe.convert(st),et)}finally{const Ye=M!==null?Me.get(M).__webglFramebuffer:null;ge.bindFramebuffer($.FRAMEBUFFER,Ye)}}},this.copyFramebufferToTexture=function(H,pe,Ae=0){const we=Math.pow(2,-Ae),Pe=Math.floor(pe.image.width*we),et=Math.floor(pe.image.height*we);Y.setTexture2D(pe,0),$.copyTexSubImage2D($.TEXTURE_2D,Ae,0,0,H.x,H.y,Pe,et),ge.unbindTexture()},this.copyTextureToTexture=function(H,pe,Ae,we=0){const Pe=pe.image.width,et=pe.image.height,dt=qe.convert(Ae.format),xt=qe.convert(Ae.type);Y.setTexture2D(Ae,0),$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,Ae.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ae.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,Ae.unpackAlignment),pe.isDataTexture?$.texSubImage2D($.TEXTURE_2D,we,H.x,H.y,Pe,et,dt,xt,pe.image.data):pe.isCompressedTexture?$.compressedTexSubImage2D($.TEXTURE_2D,we,H.x,H.y,pe.mipmaps[0].width,pe.mipmaps[0].height,dt,pe.mipmaps[0].data):$.texSubImage2D($.TEXTURE_2D,we,H.x,H.y,dt,xt,pe.image),we===0&&Ae.generateMipmaps&&$.generateMipmap($.TEXTURE_2D),ge.unbindTexture()},this.copyTextureToTexture3D=function(H,pe,Ae,we,Pe=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const et=H.max.x-H.min.x+1,dt=H.max.y-H.min.y+1,xt=H.max.z-H.min.z+1,Ye=qe.convert(we.format),We=qe.convert(we.type);let st;if(we.isData3DTexture)Y.setTexture3D(we,0),st=$.TEXTURE_3D;else if(we.isDataArrayTexture||we.isCompressedArrayTexture)Y.setTexture2DArray(we,0),st=$.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,we.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,we.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,we.unpackAlignment);const ct=$.getParameter($.UNPACK_ROW_LENGTH),Nt=$.getParameter($.UNPACK_IMAGE_HEIGHT),Ft=$.getParameter($.UNPACK_SKIP_PIXELS),Dt=$.getParameter($.UNPACK_SKIP_ROWS),Bt=$.getParameter($.UNPACK_SKIP_IMAGES),St=Ae.isCompressedTexture?Ae.mipmaps[Pe]:Ae.image;$.pixelStorei($.UNPACK_ROW_LENGTH,St.width),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,St.height),$.pixelStorei($.UNPACK_SKIP_PIXELS,H.min.x),$.pixelStorei($.UNPACK_SKIP_ROWS,H.min.y),$.pixelStorei($.UNPACK_SKIP_IMAGES,H.min.z),Ae.isDataTexture||Ae.isData3DTexture?$.texSubImage3D(st,Pe,pe.x,pe.y,pe.z,et,dt,xt,Ye,We,St.data):Ae.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),$.compressedTexSubImage3D(st,Pe,pe.x,pe.y,pe.z,et,dt,xt,Ye,St.data)):$.texSubImage3D(st,Pe,pe.x,pe.y,pe.z,et,dt,xt,Ye,We,St),$.pixelStorei($.UNPACK_ROW_LENGTH,ct),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,Nt),$.pixelStorei($.UNPACK_SKIP_PIXELS,Ft),$.pixelStorei($.UNPACK_SKIP_ROWS,Dt),$.pixelStorei($.UNPACK_SKIP_IMAGES,Bt),Pe===0&&we.generateMipmaps&&$.generateMipmap(st),ge.unbindTexture()},this.initTexture=function(H){H.isCubeTexture?Y.setTextureCube(H,0):H.isData3DTexture?Y.setTexture3D(H,0):H.isDataArrayTexture||H.isCompressedArrayTexture?Y.setTexture2DArray(H,0):Y.setTexture2D(H,0),ge.unbindTexture()},this.resetState=function(){A=0,w=0,M=null,ge.reset(),it.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Fa}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===_S?"display-p3":"srgb",t.unpackColorSpace=Vn.workingColorSpace===D1?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===_r?Pu:uR}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Pu?_r:Ml}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}},$6=class extends bR{};$6.prototype.isWebGL1Renderer=!0;class wS{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new It(e),this.density=t}clone(){return new wS(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}let W6=class j6{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new It(e),this.near=t,this.far=n}clone(){return new j6(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}},SR=class extends Gn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}};class B1{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=a1,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Po()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Po()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Po()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const bs=new Te;class zu{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.applyMatrix4(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.applyNormalMatrix(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)bs.fromBufferAttribute(this,t),bs.transformDirection(e),this.setXYZ(t,bs.x,bs.y,bs.z);return this}setX(e,t){return this.normalized&&(t=pn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=pn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=pn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=pn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Ks(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Ks(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Ks(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Ks(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=pn(t,this.array),n=pn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=pn(t,this.array),n=pn(n,this.array),r=pn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=pn(t,this.array),n=pn(n,this.array),r=pn(r,this.array),s=pn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new An(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new zu(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class wR extends ur{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new It(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Sf;const bg=new Te,wf=new Te,Mf=new Te,Af=new yt,Sg=new yt,X6=new en,R_=new Te,wg=new Te,I_=new Te,aN=new yt,Qw=new yt,lN=new yt;class q6 extends Gn{constructor(e=new wR){if(super(),this.isSprite=!0,this.type="Sprite",Sf===void 0){Sf=new mn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new B1(t,5);Sf.setIndex([0,1,2,0,2,3]),Sf.setAttribute("position",new zu(n,3,0,!1)),Sf.setAttribute("uv",new zu(n,2,3,!1))}this.geometry=Sf,this.material=e,this.center=new yt(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),wf.setFromMatrixScale(this.matrixWorld),X6.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Mf.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&wf.multiplyScalar(-Mf.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const o=this.center;L_(R_.set(-.5,-.5,0),Mf,o,wf,r,s),L_(wg.set(.5,-.5,0),Mf,o,wf,r,s),L_(I_.set(.5,.5,0),Mf,o,wf,r,s),aN.set(0,0),Qw.set(1,0),lN.set(1,1);let a=e.ray.intersectTriangle(R_,wg,I_,!1,bg);if(a===null&&(L_(wg.set(-.5,.5,0),Mf,o,wf,r,s),Qw.set(0,1),a=e.ray.intersectTriangle(R_,I_,wg,!1,bg),a===null))return;const l=e.ray.origin.distanceTo(bg);l<e.near||l>e.far||t.push({distance:l,point:bg.clone(),uv:ed.getInterpolation(bg,R_,wg,I_,aN,Qw,lN,new yt),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function L_(i,e,t,n,r,s){Af.subVectors(i,t).addScalar(.5).multiply(n),r!==void 0?(Sg.x=s*Af.x-r*Af.y,Sg.y=r*Af.x+s*Af.y):Sg.copy(Af),i.copy(e),i.x+=Sg.x,i.y+=Sg.y,i.applyMatrix4(X6)}const D_=new Te,cN=new Te;class Y6 extends Gn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,r=t.length;n<r;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let s=t[n].distance;if(t[n].object.visible&&(s-=s*t[n].hysteresis),e<s)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){D_.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(D_);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){D_.setFromMatrixPosition(e.matrixWorld),cN.setFromMatrixPosition(this.matrixWorld);const n=D_.distanceTo(cN)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s;r++){let o=t[r].distance;if(t[r].object.visible&&(o-=o*t[r].hysteresis),n>=o)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let r=0,s=n.length;r<s;r++){const o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const uN=new Te,hN=new Wn,dN=new Wn,tZ=new Te,fN=new en,N_=new Te,Jw=new Ur,pN=new en,eM=new Em;class MR extends Tn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=vT,this.bindMatrix=new en,this.bindMatrixInverse=new en,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new kr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,N_),this.boundingBox.expandByPoint(N_)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ur),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,N_),this.boundingSphere.expandByPoint(N_)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Jw.copy(this.boundingSphere),Jw.applyMatrix4(r),e.ray.intersectsSphere(Jw)!==!1&&(pN.copy(r).invert(),eM.copy(e.ray).applyMatrix4(pN),!(this.boundingBox!==null&&eM.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,eM)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Wn,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===vT?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Jz?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;hN.fromBufferAttribute(r.attributes.skinIndex,e),dN.fromBufferAttribute(r.attributes.skinWeight,e),uN.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=dN.getComponent(s);if(o!==0){const a=hN.getComponent(s);fN.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(tZ.copy(uN).applyMatrix4(fN),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class MS extends Gn{constructor(){super(),this.isBone=!0,this.type="Bone"}}let ld=class extends dr{constructor(e=null,t=1,n=1,r,s,o,a,l,c=zi,u=zi,h,d){super(null,o,a,l,c,u,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const mN=new en,nZ=new en;class z1{constructor(e=[],t=[]){this.uuid=Po(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new en)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new en;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:nZ;mN.multiplyMatrices(a,t[s]),mN.toArray(n,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new z1(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new ld(t,e,e,Ps,Na);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const s=e.bones[n];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new MS),this.bones.push(o),this.boneInverses.push(new en().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}class Gu extends An{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Ef=new en,gN=new en,F_=[],vN=new kr,iZ=new en,Mg=new Tn,Ag=new Ur;class AR extends Tn{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Gu(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,iZ)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new kr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Ef),vN.copy(e.boundingBox).applyMatrix4(Ef),this.boundingBox.union(vN)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ur),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Ef),Ag.copy(e.boundingSphere).applyMatrix4(Ef),this.boundingSphere.union(Ag)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(Mg.geometry=this.geometry,Mg.material=this.material,Mg.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Ag.copy(this.boundingSphere),Ag.applyMatrix4(n),e.ray.intersectsSphere(Ag)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Ef),gN.multiplyMatrices(n,Ef),Mg.matrixWorld=gN,Mg.raycast(e,F_);for(let o=0,a=F_.length;o<a;o++){const l=F_[o];l.instanceId=s,l.object=this,t.push(l)}F_.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Gu(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function rZ(i,e){return i.z-e.z}function sZ(i,e){return e.z-i.z}class oZ{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const s=n[this.index];r.push(s),this.index++,s.start=e.start,s.count=e.count,s.z=t}reset(){this.list.length=0,this.index=0}}const Tf="batchId",Xc=new en,_N=new en,aZ=new en,yN=new en,tM=new O1,k_=new kr,yh=new Ur,Eg=new Te,nM=new oZ,rs=new Tn,U_=[];function lZ(i,e,t=0){const n=e.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==e.array.constructor){const r=i.count;for(let s=0;s<r;s++)for(let o=0;o<n;o++)e.setComponent(s+t,o,i.getComponent(s,o))}else e.array.set(i.array,t*n);e.needsUpdate=!0}class K6 extends Tn{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,n=t*2,r){super(new mn,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new ld(t,e,e,Ps,Na);this._matricesTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxGeometryCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const a in e.attributes){const l=e.getAttribute(a),{array:c,itemSize:u,normalized:h}=l,d=new c.constructor(n*u),f=new l.constructor(d,u,h);f.setUsage(l.usage),t.setAttribute(a,f)}if(e.getIndex()!==null){const a=n>65536?new Uint32Array(s):new Uint16Array(s);t.setIndex(new An(a,1))}const o=r>65536?new Uint32Array(n):new Uint16Array(n);t.setAttribute(Tf,new An(o,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(Tf))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Tf}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(n===Tf)continue;if(!e.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),s=t.getAttribute(n);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new kr);const e=this._geometryCount,t=this.boundingBox,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)n[r]!==!1&&(this.getMatrixAt(r,Xc),this.getBoundingBoxAt(r,k_).applyMatrix4(Xc),t.union(k_))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ur);const e=this._geometryCount,t=this.boundingSphere,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)n[r]!==!1&&(this.getMatrixAt(r,Xc),this.getBoundingSphereAt(r,yh).applyMatrix4(Xc),t.union(yh))}addGeometry(e,t=-1,n=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let s=null;const o=this._reservedRanges,a=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(s=o[o.length-1]),t===-1?r.vertexCount=e.getAttribute("position").count:r.vertexCount=t,s===null?r.vertexStart=0:r.vertexStart=s.vertexStart+s.vertexCount;const c=e.getIndex(),u=c!==null;if(u&&(n===-1?r.indexCount=c.count:r.indexCount=n,s===null?r.indexStart=0:r.indexStart=s.indexStart+s.indexCount),r.indexStart!==-1&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._visibility,d=this._active,f=this._matricesTexture,p=this._matricesTexture.image.data;h.push(!0),d.push(!0);const _=this._geometryCount;this._geometryCount++,aZ.toArray(p,_*16),f.needsUpdate=!0,o.push(r),a.push({start:u?r.indexStart:r.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new kr,sphereInitialized:!1,sphere:new Ur});const v=this.geometry.getAttribute(Tf);for(let g=0;g<r.vertexCount;g++)v.setX(r.vertexStart+g,_);return v.needsUpdate=!0,this.setGeometryAt(_,e),_}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=n.getIndex()!==null,s=n.getIndex(),o=t.getIndex(),a=this._reservedRanges[e];if(r&&o.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.vertexCount;for(const f in n.attributes){if(f===Tf)continue;const p=t.getAttribute(f),_=n.getAttribute(f);lZ(p,_,l);const v=p.itemSize;for(let g=p.count,b=c;g<b;g++){const m=l+g;for(let y=0;y<v;y++)_.setComponent(m,y,0)}_.needsUpdate=!0}if(r){const f=a.indexStart;for(let p=0;p<o.count;p++)s.setX(f+p,l+o.getX(p));for(let p=o.count,_=a.indexCount;p<_;p++)s.setX(f+p,l);s.needsUpdate=!0}const u=this._bounds[e];t.boundingBox!==null?(u.box.copy(t.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,t.boundingSphere!==null?(u.sphere.copy(t.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;const h=this._drawRanges[e],d=t.getAttribute("position");return h.count=r?o.count:d.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1?this:(t[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(this._active[e]===!1)return this;const r=this._bounds[e],s=r.box,o=this.geometry;if(r.boxInitialized===!1){s.makeEmpty();const a=o.index,l=o.attributes.position,c=this._drawRanges[e];for(let u=c.start,h=c.start+c.count;u<h;u++){let d=u;a&&(d=a.getX(d)),s.expandByPoint(Eg.fromBufferAttribute(l,d))}r.boxInitialized=!0}return t.copy(s),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return this;const r=this._bounds[e],s=r.sphere,o=this.geometry;if(r.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(e,k_),k_.getCenter(s.center);const a=o.index,l=o.attributes.position,c=this._drawRanges[e];let u=0;for(let h=c.start,d=c.start+c.count;h<d;h++){let f=h;a&&(f=a.getX(f)),Eg.fromBufferAttribute(l,f),u=Math.max(u,s.center.distanceToSquared(Eg))}s.radius=Math.sqrt(u),r.sphereInitialized=!0}return t.copy(s),t}setMatrixAt(e,t){const n=this._active,r=this._matricesTexture,s=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||n[e]===!1?this:(t.toArray(s,e*16),r.needsUpdate=!0,this)}getMatrixAt(e,t){const n=this._active,r=this._matricesTexture.image.data,s=this._geometryCount;return e>=s||n[e]===!1?null:t.fromArray(r,e*16)}setVisibleAt(e,t){const n=this._visibility,r=this._active,s=this._geometryCount;return e>=s||r[e]===!1||n[e]===t?this:(n[e]=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._visibility,n=this._active,r=this._geometryCount;return e>=r||n[e]===!1?!1:t[e]}raycast(e,t){const n=this._visibility,r=this._active,s=this._drawRanges,o=this._geometryCount,a=this.matrixWorld,l=this.geometry;rs.material=this.material,rs.geometry.index=l.index,rs.geometry.attributes=l.attributes,rs.geometry.boundingBox===null&&(rs.geometry.boundingBox=new kr),rs.geometry.boundingSphere===null&&(rs.geometry.boundingSphere=new Ur);for(let c=0;c<o;c++){if(!n[c]||!r[c])continue;const u=s[c];rs.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(c,rs.matrixWorld).premultiply(a),this.getBoundingBoxAt(c,rs.geometry.boundingBox),this.getBoundingSphereAt(c,rs.geometry.boundingSphere),rs.raycast(e,U_);for(let h=0,d=U_.length;h<d;h++){const f=U_[h];f.object=this,f.batchId=c,t.push(f)}U_.length=0}rs.material=null,rs.geometry.index=null,rs.geometry.attributes={},rs.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,n,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=r.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._visibility,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._drawRanges,d=this.perObjectFrustumCulled;d&&(yN.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),tM.setFromProjectionMatrix(yN,e.isWebGPURenderer?rm:Fa));let f=0;if(this.sortObjects){_N.copy(this.matrixWorld).invert(),Eg.setFromMatrixPosition(n.matrixWorld).applyMatrix4(_N);for(let v=0,g=l.length;v<g;v++)if(l[v]){this.getMatrixAt(v,Xc),this.getBoundingSphereAt(v,yh).applyMatrix4(Xc);let b=!1;if(d&&(b=!tM.intersectsSphere(yh)),!b){const m=Eg.distanceTo(yh.center);nM.push(h[v],m)}}const p=nM.list,_=this.customSort;_===null?p.sort(s.transparent?sZ:rZ):_.call(this,p,n);for(let v=0,g=p.length;v<g;v++){const b=p[v];c[f]=b.start*a,u[f]=b.count,f++}nM.reset()}else for(let p=0,_=l.length;p<_;p++)if(l[p]){let v=!1;if(d&&(this.getMatrixAt(p,Xc),this.getBoundingSphereAt(p,yh).applyMatrix4(Xc),v=!tM.intersectsSphere(yh)),!v){const g=h[p];c[f]=g.start*a,u[f]=g.count,f++}}this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,s,o){this.onBeforeRender(e,null,r,s,o)}}let hs=class extends ur{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new It(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}};const xN=new Te,bN=new Te,SN=new en,iM=new Em,O_=new Ur;let bc=class extends Gn{constructor(e=new mn,t=new hs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)xN.fromBufferAttribute(t,r-1),bN.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=xN.distanceTo(bN);e.setAttribute("lineDistance",new jt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),O_.copy(n.boundingSphere),O_.applyMatrix4(r),O_.radius+=s,e.ray.intersectsSphere(O_)===!1)return;SN.copy(r).invert(),iM.copy(e.ray).applyMatrix4(SN);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new Te,u=new Te,h=new Te,d=new Te,f=this.isLineSegments?2:1,p=n.index,v=n.attributes.position;if(p!==null){const g=Math.max(0,o.start),b=Math.min(p.count,o.start+o.count);for(let m=g,y=b-1;m<y;m+=f){const A=p.getX(m),w=p.getX(m+1);if(c.fromBufferAttribute(v,A),u.fromBufferAttribute(v,w),iM.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const T=e.ray.origin.distanceTo(d);T<e.near||T>e.far||t.push({distance:T,point:h.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else{const g=Math.max(0,o.start),b=Math.min(v.count,o.start+o.count);for(let m=g,y=b-1;m<y;m+=f){if(c.fromBufferAttribute(v,m),u.fromBufferAttribute(v,m+1),iM.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const w=e.ray.origin.distanceTo(d);w<e.near||w>e.far||t.push({distance:w,point:h.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};const wN=new Te,MN=new Te;let $a=class extends bc{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,s=t.count;r<s;r+=2)wN.fromBufferAttribute(t,r),MN.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+wN.distanceTo(MN);e.setAttribute("lineDistance",new jt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}};class ER extends bc{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}let AS=class extends ur{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new It(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}};const AN=new en,YT=new Em,B_=new Ur,z_=new Te;let TR=class extends Gn{constructor(e=new mn,t=new AS){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),B_.copy(n.boundingSphere),B_.applyMatrix4(r),B_.radius+=s,e.ray.intersectsSphere(B_)===!1)return;AN.copy(r).invert(),YT.copy(e.ray).applyMatrix4(AN);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=n.index,h=n.attributes.position;if(c!==null){const d=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let p=d,_=f;p<_;p++){const v=c.getX(p);z_.fromBufferAttribute(h,v),EN(z_,v,l,r,e,t,this)}}else{const d=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let p=d,_=f;p<_;p++)z_.fromBufferAttribute(h,p),EN(z_,p,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};function EN(i,e,t,n,r,s,o){const a=YT.distanceSqToPoint(i);if(a<t){const l=new Te;YT.closestPointToPoint(i,l),l.applyMatrix4(n);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class cZ extends dr{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:hi,this.magFilter=s!==void 0?s:hi,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class uZ extends dr{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=zi,this.minFilter=zi,this.generateMipmaps=!1,this.needsUpdate=!0}}class ES extends dr{constructor(e,t,n,r,s,o,a,l,c,u,h,d){super(null,o,a,l,c,u,r,s,h,d),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class hZ extends ES{constructor(e,t,n,r,s,o){super(e,t,n,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=$r}}class dZ extends ES{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,xc),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}let Ad=class extends dr{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}};class Wa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=n[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,n[r]===o)return r/(s-1);const u=n[r],d=n[r+1]-u,f=(o-u)/d;return(r+f)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new yt:new Te);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Te,r=[],s=[],o=[],a=new Te,l=new en;for(let f=0;f<=e;f++){const p=f/e;r[f]=this.getTangentAt(p,new Te)}s[0]=new Te,o[0]=new Te;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=c&&(c=u,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),d<=c&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(r[f-1],r[f]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(Gi(r[f-1].dot(r[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(a,p))}o[f].crossVectors(r[f],s[f])}if(t===!0){let f=Math.acos(Gi(s[0].dot(s[e]),-1,1));f/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(f=-f);for(let p=1;p<=e;p++)s[p].applyMatrix4(l.makeRotationAxis(r[p],f*p)),o[p].crossVectors(r[p],s[p])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class TS extends Wa{constructor(e=0,t=0,n=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const n=t||new yt,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*u-f*h+this.aX,c=d*h+f*u+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Z6 extends TS{constructor(e,t,n,r,s,o){super(e,t,n,n,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function CR(){let i=0,e=0,t=0,n=0;function r(s,o,a,l){i=s,e=a,t=-3*s+3*o-2*a-l,n=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,u,h){let d=(o-s)/c-(a-s)/(c+u)+(a-o)/u,f=(a-o)/u-(l-o)/(u+h)+(l-a)/h;d*=u,f*=u,r(o,a,d,f)},calc:function(s){const o=s*s,a=o*s;return i+e*s+t*o+n*a}}}const G_=new Te,rM=new CR,sM=new CR,oM=new CR;class Q6 extends Wa{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new Te){const n=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,u;this.closed||a>0?c=r[(a-1)%s]:(G_.subVectors(r[0],r[1]).add(r[0]),c=G_);const h=r[a%s],d=r[(a+1)%s];if(this.closed||a+2<s?u=r[(a+2)%s]:(G_.subVectors(r[s-1],r[s-2]).add(r[s-1]),u=G_),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(c.distanceToSquared(h),f),_=Math.pow(h.distanceToSquared(d),f),v=Math.pow(d.distanceToSquared(u),f);_<1e-4&&(_=1),p<1e-4&&(p=_),v<1e-4&&(v=_),rM.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,p,_,v),sM.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,p,_,v),oM.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,p,_,v)}else this.curveType==="catmullrom"&&(rM.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),sM.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),oM.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return n.set(rM.calc(l),sM.calc(l),oM.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new Te().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function TN(i,e,t,n,r){const s=(n-e)*.5,o=(r-t)*.5,a=i*i,l=i*a;return(2*t-2*n+s+o)*l+(-3*t+3*n-2*s-o)*a+s*i+t}function fZ(i,e){const t=1-i;return t*t*e}function pZ(i,e){return 2*(1-i)*i*e}function mZ(i,e){return i*i*e}function w0(i,e,t,n){return fZ(i,e)+pZ(i,t)+mZ(i,n)}function gZ(i,e){const t=1-i;return t*t*t*e}function vZ(i,e){const t=1-i;return 3*t*t*i*e}function _Z(i,e){return 3*(1-i)*i*i*e}function yZ(i,e){return i*i*i*e}function M0(i,e,t,n,r){return gZ(i,e)+vZ(i,t)+_Z(i,n)+yZ(i,r)}class PR extends Wa{constructor(e=new yt,t=new yt,n=new yt,r=new yt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new yt){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(M0(e,r.x,s.x,o.x,a.x),M0(e,r.y,s.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class J6 extends Wa{constructor(e=new Te,t=new Te,n=new Te,r=new Te){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Te){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(M0(e,r.x,s.x,o.x,a.x),M0(e,r.y,s.y,o.y,a.y),M0(e,r.z,s.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class RR extends Wa{constructor(e=new yt,t=new yt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new yt){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new yt){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class e8 extends Wa{constructor(e=new Te,t=new Te){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Te){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Te){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class IR extends Wa{constructor(e=new yt,t=new yt,n=new yt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new yt){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(w0(e,r.x,s.x,o.x),w0(e,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class LR extends Wa{constructor(e=new Te,t=new Te,n=new Te){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Te){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(w0(e,r.x,s.x,o.x),w0(e,r.y,s.y,o.y),w0(e,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class DR extends Wa{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new yt){const n=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return n.set(TN(a,l.x,c.x,u.x,h.x),TN(a,l.y,c.y,u.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new yt().fromArray(r))}return this}}var Sb=Object.freeze({__proto__:null,ArcCurve:Z6,CatmullRomCurve3:Q6,CubicBezierCurve:PR,CubicBezierCurve3:J6,EllipseCurve:TS,LineCurve:RR,LineCurve3:e8,QuadraticBezierCurve:IR,QuadraticBezierCurve3:LR,SplineCurve:DR});class t8 extends Wa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Sb[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=n){const o=r[s]-n,a=this.curves[s],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const u=l[c];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(new Sb[r.type]().fromJSON(r))}return this}}class c1 extends t8{constructor(e){super(),this.type="Path",this.currentPoint=new yt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new RR(this.currentPoint.clone(),new yt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const s=new IR(this.currentPoint.clone(),new yt(e,t),new yt(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,s,o){const a=new PR(this.currentPoint.clone(),new yt(e,t),new yt(n,r),new yt(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new DR(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,r,s,o),this}absarc(e,t,n,r,s,o){return this.absellipse(e,t,n,n,r,s,o),this}ellipse(e,t,n,r,s,o,a,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,r,s,o,a,l),this}absellipse(e,t,n,r,s,o,a,l){const c=new TS(e,t,n,r,s,o,a,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class G1 extends mn{constructor(e=[new yt(0,-.5),new yt(.5,0),new yt(0,.5)],t=12,n=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Gi(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],c=[],u=1/t,h=new Te,d=new yt,f=new Te,p=new Te,_=new Te;let v=0,g=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:v=e[b+1].x-e[b].x,g=e[b+1].y-e[b].y,f.x=g*1,f.y=-v,f.z=g*0,_.copy(f),f.normalize(),l.push(f.x,f.y,f.z);break;case e.length-1:l.push(_.x,_.y,_.z);break;default:v=e[b+1].x-e[b].x,g=e[b+1].y-e[b].y,f.x=g*1,f.y=-v,f.z=g*0,p.copy(f),f.x+=_.x,f.y+=_.y,f.z+=_.z,f.normalize(),l.push(f.x,f.y,f.z),_.copy(p)}for(let b=0;b<=t;b++){const m=n+b*u*r,y=Math.sin(m),A=Math.cos(m);for(let w=0;w<=e.length-1;w++){h.x=e[w].x*y,h.y=e[w].y,h.z=e[w].x*A,o.push(h.x,h.y,h.z),d.x=b/t,d.y=w/(e.length-1),a.push(d.x,d.y);const M=l[3*w+0]*y,T=l[3*w+1],E=l[3*w+0]*A;c.push(M,T,E)}}for(let b=0;b<t;b++)for(let m=0;m<e.length-1;m++){const y=m+b*e.length,A=y,w=y+e.length,M=y+e.length+1,T=y+1;s.push(A,w,T),s.push(M,T,w)}this.setIndex(s),this.setAttribute("position",new jt(o,3)),this.setAttribute("uv",new jt(a,2)),this.setAttribute("normal",new jt(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new G1(e.points,e.segments,e.phiStart,e.phiLength)}}class CS extends G1{constructor(e=1,t=1,n=4,r=8){const s=new c1;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:r}}static fromJSON(e){return new CS(e.radius,e.length,e.capSegments,e.radialSegments)}}class PS extends mn{constructor(e=1,t=32,n=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],l=[],c=new Te,u=new yt;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=t;h++,d+=3){const f=n+h/t*r;c.x=e*Math.cos(f),c.y=e*Math.sin(f),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[d]/e+1)/2,u.y=(o[d+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=t;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new jt(o,3)),this.setAttribute("normal",new jt(a,3)),this.setAttribute("uv",new jt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PS(e.radius,e.segments,e.thetaStart,e.thetaLength)}}let am=class n8 extends mn{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],h=[],d=[],f=[];let p=0;const _=[],v=n/2;let g=0;b(),o===!1&&(e>0&&m(!0),t>0&&m(!1)),this.setIndex(u),this.setAttribute("position",new jt(h,3)),this.setAttribute("normal",new jt(d,3)),this.setAttribute("uv",new jt(f,2));function b(){const y=new Te,A=new Te;let w=0;const M=(t-e)/n;for(let T=0;T<=s;T++){const E=[],C=T/s,N=C*(t-e)+e;for(let P=0;P<=r;P++){const L=P/r,R=L*l+a,F=Math.sin(R),V=Math.cos(R);A.x=N*F,A.y=-C*n+v,A.z=N*V,h.push(A.x,A.y,A.z),y.set(F,M,V).normalize(),d.push(y.x,y.y,y.z),f.push(L,1-C),E.push(p++)}_.push(E)}for(let T=0;T<r;T++)for(let E=0;E<s;E++){const C=_[E][T],N=_[E+1][T],P=_[E+1][T+1],L=_[E][T+1];u.push(C,N,L),u.push(N,P,L),w+=6}c.addGroup(g,w,0),g+=w}function m(y){const A=p,w=new yt,M=new Te;let T=0;const E=y===!0?e:t,C=y===!0?1:-1;for(let P=1;P<=r;P++)h.push(0,v*C,0),d.push(0,C,0),f.push(.5,.5),p++;const N=p;for(let P=0;P<=r;P++){const R=P/r*l+a,F=Math.cos(R),V=Math.sin(R);M.x=E*V,M.y=v*C,M.z=E*F,h.push(M.x,M.y,M.z),d.push(0,C,0),w.x=F*.5+.5,w.y=V*.5*C+.5,f.push(w.x,w.y),p++}for(let P=0;P<r;P++){const L=A+P,R=N+P;y===!0?u.push(R,R+1,L):u.push(R+1,R,L),T+=3}c.addGroup(g,T,y===!0?1:2),g+=T}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new n8(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},NR=class i8 extends am{constructor(e=1,t=1,n=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,n,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new i8(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Cm=class r8 extends mn{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const s=[],o=[];a(r),c(n),u(),this.setAttribute("position",new jt(s,3)),this.setAttribute("normal",new jt(s.slice(),3)),this.setAttribute("uv",new jt(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const m=new Te,y=new Te,A=new Te;for(let w=0;w<t.length;w+=3)f(t[w+0],m),f(t[w+1],y),f(t[w+2],A),l(m,y,A,b)}function l(b,m,y,A){const w=A+1,M=[];for(let T=0;T<=w;T++){M[T]=[];const E=b.clone().lerp(y,T/w),C=m.clone().lerp(y,T/w),N=w-T;for(let P=0;P<=N;P++)P===0&&T===w?M[T][P]=E:M[T][P]=E.clone().lerp(C,P/N)}for(let T=0;T<w;T++)for(let E=0;E<2*(w-T)-1;E++){const C=Math.floor(E/2);E%2===0?(d(M[T][C+1]),d(M[T+1][C]),d(M[T][C])):(d(M[T][C+1]),d(M[T+1][C+1]),d(M[T+1][C]))}}function c(b){const m=new Te;for(let y=0;y<s.length;y+=3)m.x=s[y+0],m.y=s[y+1],m.z=s[y+2],m.normalize().multiplyScalar(b),s[y+0]=m.x,s[y+1]=m.y,s[y+2]=m.z}function u(){const b=new Te;for(let m=0;m<s.length;m+=3){b.x=s[m+0],b.y=s[m+1],b.z=s[m+2];const y=v(b)/2/Math.PI+.5,A=g(b)/Math.PI+.5;o.push(y,1-A)}p(),h()}function h(){for(let b=0;b<o.length;b+=6){const m=o[b+0],y=o[b+2],A=o[b+4],w=Math.max(m,y,A),M=Math.min(m,y,A);w>.9&&M<.1&&(m<.2&&(o[b+0]+=1),y<.2&&(o[b+2]+=1),A<.2&&(o[b+4]+=1))}}function d(b){s.push(b.x,b.y,b.z)}function f(b,m){const y=b*3;m.x=e[y+0],m.y=e[y+1],m.z=e[y+2]}function p(){const b=new Te,m=new Te,y=new Te,A=new Te,w=new yt,M=new yt,T=new yt;for(let E=0,C=0;E<s.length;E+=9,C+=6){b.set(s[E+0],s[E+1],s[E+2]),m.set(s[E+3],s[E+4],s[E+5]),y.set(s[E+6],s[E+7],s[E+8]),w.set(o[C+0],o[C+1]),M.set(o[C+2],o[C+3]),T.set(o[C+4],o[C+5]),A.copy(b).add(m).add(y).divideScalar(3);const N=v(A);_(w,C+0,b,N),_(M,C+2,m,N),_(T,C+4,y,N)}}function _(b,m,y,A){A<0&&b.x===1&&(o[m]=b.x-1),y.x===0&&y.z===0&&(o[m]=A/2/Math.PI+.5)}function v(b){return Math.atan2(b.z,-b.x)}function g(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new r8(e.vertices,e.indices,e.radius,e.details)}};class RS extends Cm{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new RS(e.radius,e.detail)}}const V_=new Te,H_=new Te,aM=new Te,$_=new ed;class s8 extends mn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(od*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},f=[];for(let p=0;p<l;p+=3){o?(c[0]=o.getX(p),c[1]=o.getX(p+1),c[2]=o.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);const{a:_,b:v,c:g}=$_;if(_.fromBufferAttribute(a,c[0]),v.fromBufferAttribute(a,c[1]),g.fromBufferAttribute(a,c[2]),$_.getNormal(aM),h[0]=`${Math.round(_.x*r)},${Math.round(_.y*r)},${Math.round(_.z*r)}`,h[1]=`${Math.round(v.x*r)},${Math.round(v.y*r)},${Math.round(v.z*r)}`,h[2]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let b=0;b<3;b++){const m=(b+1)%3,y=h[b],A=h[m],w=$_[u[b]],M=$_[u[m]],T=`${y}_${A}`,E=`${A}_${y}`;E in d&&d[E]?(aM.dot(d[E].normal)<=s&&(f.push(w.x,w.y,w.z),f.push(M.x,M.y,M.z)),d[E]=null):T in d||(d[T]={index0:c[b],index1:c[m],normal:aM.clone()})}}for(const p in d)if(d[p]){const{index0:_,index1:v}=d[p];V_.fromBufferAttribute(a,_),H_.fromBufferAttribute(a,v),f.push(V_.x,V_.y,V_.z),f.push(H_.x,H_.y,H_.z)}this.setAttribute("position",new jt(f,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class cd extends c1{constructor(e){super(e),this.uuid=Po(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(new c1().fromJSON(r))}return this}}const xZ={triangulate:function(i,e,t=2){const n=e&&e.length,r=n?e[0]*t:i.length;let s=o8(i,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,d,f;if(n&&(s=AZ(i,e,s,t)),i.length>80*t){a=c=i[0],l=u=i[1];for(let p=t;p<r;p+=t)h=i[p],d=i[p+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-a,u-l),f=f!==0?32767/f:0}return u1(s,o,t,a,l,f,0),o}};function o8(i,e,t,n,r){let s,o;if(r===kZ(i,e,t,n)>0)for(s=e;s<t;s+=n)o=CN(s,i[s],i[s+1],o);else for(s=t-n;s>=e;s-=n)o=CN(s,i[s],i[s+1],o);return o&&IS(o,o.next)&&(d1(o),o=o.next),o}function Ed(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(IS(t,t.next)||Ri(t.prev,t,t.next)===0)){if(d1(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function u1(i,e,t,n,r,s,o){if(!i)return;!o&&s&&RZ(i,n,r,s);let a=i,l,c;for(;i.prev!==i.next;){if(l=i.prev,c=i.next,s?SZ(i,n,r,s):bZ(i)){e.push(l.i/t|0),e.push(i.i/t|0),e.push(c.i/t|0),d1(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=wZ(Ed(i),e,t),u1(i,e,t,n,r,s,2)):o===2&&MZ(i,e,t,n,r,s):u1(Ed(i),e,t,n,r,s,1);break}}}function bZ(i){const e=i.prev,t=i,n=i.next;if(Ri(e,t,n)>=0)return!1;const r=e.x,s=t.x,o=n.x,a=e.y,l=t.y,c=n.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,f=a>l?a>c?a:c:l>c?l:c;let p=n.next;for(;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&wp(r,a,s,l,o,c,p.x,p.y)&&Ri(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function SZ(i,e,t,n){const r=i.prev,s=i,o=i.next;if(Ri(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,d=o.y,f=a<l?a<c?a:c:l<c?l:c,p=u<h?u<d?u:d:h<d?h:d,_=a>l?a>c?a:c:l>c?l:c,v=u>h?u>d?u:d:h>d?h:d,g=KT(f,p,e,t,n),b=KT(_,v,e,t,n);let m=i.prevZ,y=i.nextZ;for(;m&&m.z>=g&&y&&y.z<=b;){if(m.x>=f&&m.x<=_&&m.y>=p&&m.y<=v&&m!==r&&m!==o&&wp(a,u,l,h,c,d,m.x,m.y)&&Ri(m.prev,m,m.next)>=0||(m=m.prevZ,y.x>=f&&y.x<=_&&y.y>=p&&y.y<=v&&y!==r&&y!==o&&wp(a,u,l,h,c,d,y.x,y.y)&&Ri(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;m&&m.z>=g;){if(m.x>=f&&m.x<=_&&m.y>=p&&m.y<=v&&m!==r&&m!==o&&wp(a,u,l,h,c,d,m.x,m.y)&&Ri(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;y&&y.z<=b;){if(y.x>=f&&y.x<=_&&y.y>=p&&y.y<=v&&y!==r&&y!==o&&wp(a,u,l,h,c,d,y.x,y.y)&&Ri(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function wZ(i,e,t){let n=i;do{const r=n.prev,s=n.next.next;!IS(r,s)&&a8(r,n,n.next,s)&&h1(r,s)&&h1(s,r)&&(e.push(r.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),d1(n),d1(n.next),n=i=s),n=n.next}while(n!==i);return Ed(n)}function MZ(i,e,t,n,r,s){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&DZ(o,a)){let l=l8(o,a);o=Ed(o,o.next),l=Ed(l,l.next),u1(o,e,t,n,r,s,0),u1(l,e,t,n,r,s,0);return}a=a.next}o=o.next}while(o!==i)}function AZ(i,e,t,n){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:i.length,c=o8(i,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(LZ(c));for(r.sort(EZ),s=0;s<r.length;s++)t=TZ(r[s],t);return t}function EZ(i,e){return i.x-e.x}function TZ(i,e){const t=CZ(i,e);if(!t)return e;const n=l8(t,i);return Ed(n,n.next),Ed(t,t.next)}function CZ(i,e){let t=e,n=-1/0,r;const s=i.x,o=i.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const d=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=s&&d>n&&(n=d,r=t.x<t.next.x?t:t.next,d===s))return r}t=t.next}while(t!==e);if(!r)return null;const a=r,l=r.x,c=r.y;let u=1/0,h;t=r;do s>=t.x&&t.x>=l&&s!==t.x&&wp(o<c?s:n,o,l,c,o<c?n:s,o,t.x,t.y)&&(h=Math.abs(o-t.y)/(s-t.x),h1(t,i)&&(h<u||h===u&&(t.x>r.x||t.x===r.x&&PZ(r,t)))&&(r=t,u=h)),t=t.next;while(t!==a);return r}function PZ(i,e){return Ri(i.prev,i,e.prev)<0&&Ri(e.next,i,i.next)<0}function RZ(i,e,t,n){let r=i;do r.z===0&&(r.z=KT(r.x,r.y,e,t,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,IZ(r)}function IZ(i){let e,t,n,r,s,o,a,l,c=1;do{for(t=i,i=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(r=t,t=t.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:i=r,r.prevZ=s,s=r;t=n}s.nextZ=null,c*=2}while(o>1);return i}function KT(i,e,t,n,r){return i=(i-t)*r|0,e=(e-n)*r|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function LZ(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function wp(i,e,t,n,r,s,o,a){return(r-o)*(e-a)>=(i-o)*(s-a)&&(i-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(n-a)}function DZ(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!NZ(i,e)&&(h1(i,e)&&h1(e,i)&&FZ(i,e)&&(Ri(i.prev,i,e.prev)||Ri(i,e.prev,e))||IS(i,e)&&Ri(i.prev,i,i.next)>0&&Ri(e.prev,e,e.next)>0)}function Ri(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function IS(i,e){return i.x===e.x&&i.y===e.y}function a8(i,e,t,n){const r=j_(Ri(i,e,t)),s=j_(Ri(i,e,n)),o=j_(Ri(t,n,i)),a=j_(Ri(t,n,e));return!!(r!==s&&o!==a||r===0&&W_(i,t,e)||s===0&&W_(i,n,e)||o===0&&W_(t,i,n)||a===0&&W_(t,e,n))}function W_(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function j_(i){return i>0?1:i<0?-1:0}function NZ(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&a8(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function h1(i,e){return Ri(i.prev,i,i.next)<0?Ri(i,e,i.next)>=0&&Ri(i,i.prev,e)>=0:Ri(i,e,i.prev)<0||Ri(i,i.next,e)<0}function FZ(i,e){let t=i,n=!1;const r=(i.x+e.x)/2,s=(i.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function l8(i,e){const t=new ZT(i.i,i.x,i.y),n=new ZT(e.i,e.x,e.y),r=i.next,s=e.prev;return i.next=e,e.prev=i,t.next=r,r.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function CN(i,e,t,n){const r=new ZT(i,e,t);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function d1(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ZT(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function kZ(i,e,t,n){let r=0;for(let s=e,o=t-n;s<t;s+=n)r+=(i[o]-i[s])*(i[s+1]+i[o+1]),o=s;return r}class gl{static area(e){const t=e.length;let n=0;for(let r=t-1,s=0;s<t;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return n*.5}static isClockWise(e){return gl.area(e)<0}static triangulateShape(e,t){const n=[],r=[],s=[];PN(e),RN(n,e);let o=e.length;t.forEach(PN);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,RN(n,t[l]);const a=xZ.triangulate(n,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function PN(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function RN(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class LS extends mn{constructor(e=new cd([new yt(.5,.5),new yt(-.5,.5),new yt(-.5,-.5),new yt(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new jt(r,3)),this.setAttribute("uv",new jt(s,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1;let d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:.2,p=t.bevelSize!==void 0?t.bevelSize:f-.1,_=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3;const g=t.extrudePath,b=t.UVGenerator!==void 0?t.UVGenerator:UZ;let m,y=!1,A,w,M,T;g&&(m=g.getSpacedPoints(u),y=!0,d=!1,A=g.computeFrenetFrames(u,!1),w=new Te,M=new Te,T=new Te),d||(v=0,f=0,p=0,_=0);const E=a.extractPoints(c);let C=E.shape;const N=E.holes;if(!gl.isClockWise(C)){C=C.reverse();for(let $=0,fe=N.length;$<fe;$++){const xe=N[$];gl.isClockWise(xe)&&(N[$]=xe.reverse())}}const L=gl.triangulateShape(C,N),R=C;for(let $=0,fe=N.length;$<fe;$++){const xe=N[$];C=C.concat(xe)}function F($,fe,xe){return fe||console.error("THREE.ExtrudeGeometry: vec does not exist"),$.clone().addScaledVector(fe,xe)}const V=C.length,G=L.length;function U($,fe,xe){let Ie,ge,Oe;const Me=$.x-fe.x,Y=$.y-fe.y,Q=xe.x-$.x,de=xe.y-$.y,Le=Me*Me+Y*Y,ie=Me*de-Y*Q;if(Math.abs(ie)>Number.EPSILON){const K=Math.sqrt(Le),be=Math.sqrt(Q*Q+de*de),Ue=fe.x-Y/K,ve=fe.y+Me/K,Ne=xe.x-de/be,$e=xe.y+Q/be,Ee=((Ne-Ue)*de-($e-ve)*Q)/(Me*de-Y*Q);Ie=Ue+Me*Ee-$.x,ge=ve+Y*Ee-$.y;const Ze=Ie*Ie+ge*ge;if(Ze<=2)return new yt(Ie,ge);Oe=Math.sqrt(Ze/2)}else{let K=!1;Me>Number.EPSILON?Q>Number.EPSILON&&(K=!0):Me<-Number.EPSILON?Q<-Number.EPSILON&&(K=!0):Math.sign(Y)===Math.sign(de)&&(K=!0),K?(Ie=-Y,ge=Me,Oe=Math.sqrt(Le)):(Ie=Me,ge=Y,Oe=Math.sqrt(Le/2))}return new yt(Ie/Oe,ge/Oe)}const z=[];for(let $=0,fe=R.length,xe=fe-1,Ie=$+1;$<fe;$++,xe++,Ie++)xe===fe&&(xe=0),Ie===fe&&(Ie=0),z[$]=U(R[$],R[xe],R[Ie]);const O=[];let D,B=z.concat();for(let $=0,fe=N.length;$<fe;$++){const xe=N[$];D=[];for(let Ie=0,ge=xe.length,Oe=ge-1,Me=Ie+1;Ie<ge;Ie++,Oe++,Me++)Oe===ge&&(Oe=0),Me===ge&&(Me=0),D[Ie]=U(xe[Ie],xe[Oe],xe[Me]);O.push(D),B=B.concat(D)}for(let $=0;$<v;$++){const fe=$/v,xe=f*Math.cos(fe*Math.PI/2),Ie=p*Math.sin(fe*Math.PI/2)+_;for(let ge=0,Oe=R.length;ge<Oe;ge++){const Me=F(R[ge],z[ge],Ie);ne(Me.x,Me.y,-xe)}for(let ge=0,Oe=N.length;ge<Oe;ge++){const Me=N[ge];D=O[ge];for(let Y=0,Q=Me.length;Y<Q;Y++){const de=F(Me[Y],D[Y],Ie);ne(de.x,de.y,-xe)}}}const W=p+_;for(let $=0;$<V;$++){const fe=d?F(C[$],B[$],W):C[$];y?(M.copy(A.normals[0]).multiplyScalar(fe.x),w.copy(A.binormals[0]).multiplyScalar(fe.y),T.copy(m[0]).add(M).add(w),ne(T.x,T.y,T.z)):ne(fe.x,fe.y,0)}for(let $=1;$<=u;$++)for(let fe=0;fe<V;fe++){const xe=d?F(C[fe],B[fe],W):C[fe];y?(M.copy(A.normals[$]).multiplyScalar(xe.x),w.copy(A.binormals[$]).multiplyScalar(xe.y),T.copy(m[$]).add(M).add(w),ne(T.x,T.y,T.z)):ne(xe.x,xe.y,h/u*$)}for(let $=v-1;$>=0;$--){const fe=$/v,xe=f*Math.cos(fe*Math.PI/2),Ie=p*Math.sin(fe*Math.PI/2)+_;for(let ge=0,Oe=R.length;ge<Oe;ge++){const Me=F(R[ge],z[ge],Ie);ne(Me.x,Me.y,h+xe)}for(let ge=0,Oe=N.length;ge<Oe;ge++){const Me=N[ge];D=O[ge];for(let Y=0,Q=Me.length;Y<Q;Y++){const de=F(Me[Y],D[Y],Ie);y?ne(de.x,de.y+m[u-1].y,m[u-1].x+xe):ne(de.x,de.y,h+xe)}}}q(),j();function q(){const $=r.length/3;if(d){let fe=0,xe=V*fe;for(let Ie=0;Ie<G;Ie++){const ge=L[Ie];Z(ge[2]+xe,ge[1]+xe,ge[0]+xe)}fe=u+v*2,xe=V*fe;for(let Ie=0;Ie<G;Ie++){const ge=L[Ie];Z(ge[0]+xe,ge[1]+xe,ge[2]+xe)}}else{for(let fe=0;fe<G;fe++){const xe=L[fe];Z(xe[2],xe[1],xe[0])}for(let fe=0;fe<G;fe++){const xe=L[fe];Z(xe[0]+V*u,xe[1]+V*u,xe[2]+V*u)}}n.addGroup($,r.length/3-$,0)}function j(){const $=r.length/3;let fe=0;te(R,fe),fe+=R.length;for(let xe=0,Ie=N.length;xe<Ie;xe++){const ge=N[xe];te(ge,fe),fe+=ge.length}n.addGroup($,r.length/3-$,1)}function te($,fe){let xe=$.length;for(;--xe>=0;){const Ie=xe;let ge=xe-1;ge<0&&(ge=$.length-1);for(let Oe=0,Me=u+v*2;Oe<Me;Oe++){const Y=V*Oe,Q=V*(Oe+1),de=fe+Ie+Y,Le=fe+ge+Y,ie=fe+ge+Q,K=fe+Ie+Q;le(de,Le,ie,K)}}}function ne($,fe,xe){l.push($),l.push(fe),l.push(xe)}function Z($,fe,xe){re($),re(fe),re(xe);const Ie=r.length/3,ge=b.generateTopUV(n,r,Ie-3,Ie-2,Ie-1);se(ge[0]),se(ge[1]),se(ge[2])}function le($,fe,xe,Ie){re($),re(fe),re(Ie),re(fe),re(xe),re(Ie);const ge=r.length/3,Oe=b.generateSideWallUV(n,r,ge-6,ge-3,ge-2,ge-1);se(Oe[0]),se(Oe[1]),se(Oe[3]),se(Oe[1]),se(Oe[2]),se(Oe[3])}function re($){r.push(l[$*3+0]),r.push(l[$*3+1]),r.push(l[$*3+2])}function se($){s.push($.x),s.push($.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return OZ(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=t[e.shapes[s]];n.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new Sb[r.type]().fromJSON(r)),new LS(n,e.options)}}const UZ={generateTopUV:function(i,e,t,n,r){const s=e[t*3],o=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[r*3],u=e[r*3+1];return[new yt(s,o),new yt(a,l),new yt(c,u)]},generateSideWallUV:function(i,e,t,n,r,s){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],h=e[n*3+2],d=e[r*3],f=e[r*3+1],p=e[r*3+2],_=e[s*3],v=e[s*3+1],g=e[s*3+2];return Math.abs(a-u)<Math.abs(o-c)?[new yt(o,1-l),new yt(c,1-h),new yt(d,1-p),new yt(_,1-g)]:[new yt(a,1-l),new yt(u,1-h),new yt(f,1-p),new yt(v,1-g)]}};function OZ(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,r=i.length;n<r;n++){const s=i[n];t.shapes.push(s.uuid)}else t.shapes.push(i.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}let c8=class u8 extends Cm{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new u8(e.radius,e.detail)}},FR=class h8 extends Cm{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new h8(e.radius,e.detail)}};class DS extends mn{constructor(e=.5,t=1,n=32,r=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:o},n=Math.max(3,n),r=Math.max(1,r);const a=[],l=[],c=[],u=[];let h=e;const d=(t-e)/r,f=new Te,p=new yt;for(let _=0;_<=r;_++){for(let v=0;v<=n;v++){const g=s+v/n*o;f.x=h*Math.cos(g),f.y=h*Math.sin(g),l.push(f.x,f.y,f.z),c.push(0,0,1),p.x=(f.x/t+1)/2,p.y=(f.y/t+1)/2,u.push(p.x,p.y)}h+=d}for(let _=0;_<r;_++){const v=_*(n+1);for(let g=0;g<n;g++){const b=g+v,m=b,y=b+n+1,A=b+n+2,w=b+1;a.push(m,y,w),a.push(y,A,w)}}this.setIndex(a),this.setAttribute("position",new jt(l,3)),this.setAttribute("normal",new jt(c,3)),this.setAttribute("uv",new jt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new DS(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class NS extends mn{constructor(e=new cd([new yt(0,.5),new yt(-.5,-.5),new yt(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new jt(r,3)),this.setAttribute("normal",new jt(s,3)),this.setAttribute("uv",new jt(o,2));function c(u){const h=r.length/3,d=u.extractPoints(t);let f=d.shape;const p=d.holes;gl.isClockWise(f)===!1&&(f=f.reverse());for(let v=0,g=p.length;v<g;v++){const b=p[v];gl.isClockWise(b)===!0&&(p[v]=b.reverse())}const _=gl.triangulateShape(f,p);for(let v=0,g=p.length;v<g;v++){const b=p[v];f=f.concat(b)}for(let v=0,g=f.length;v<g;v++){const b=f[v];r.push(b.x,b.y,0),s.push(0,0,1),o.push(b.x,b.y)}for(let v=0,g=_.length;v<g;v++){const b=_[v],m=b[0]+h,y=b[1]+h,A=b[2]+h;n.push(m,y,A),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return BZ(t,e)}static fromJSON(e,t){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=t[e.shapes[r]];n.push(o)}return new NS(n,e.curveSegments)}}function BZ(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const r=i[t];e.shapes.push(r.uuid)}else e.shapes.push(i.uuid);return e}class Od extends mn{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let c=0;const u=[],h=new Te,d=new Te,f=[],p=[],_=[],v=[];for(let g=0;g<=n;g++){const b=[],m=g/n;let y=0;g===0&&o===0?y=.5/t:g===n&&l===Math.PI&&(y=-.5/t);for(let A=0;A<=t;A++){const w=A/t;h.x=-e*Math.cos(r+w*s)*Math.sin(o+m*a),h.y=e*Math.cos(o+m*a),h.z=e*Math.sin(r+w*s)*Math.sin(o+m*a),p.push(h.x,h.y,h.z),d.copy(h).normalize(),_.push(d.x,d.y,d.z),v.push(w+y,1-m),b.push(c++)}u.push(b)}for(let g=0;g<n;g++)for(let b=0;b<t;b++){const m=u[g][b+1],y=u[g][b],A=u[g+1][b],w=u[g+1][b+1];(g!==0||o>0)&&f.push(m,y,w),(g!==n-1||l<Math.PI)&&f.push(y,A,w)}this.setIndex(f),this.setAttribute("position",new jt(p,3)),this.setAttribute("normal",new jt(_,3)),this.setAttribute("uv",new jt(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Od(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}let d8=class f8 extends Cm{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new f8(e.radius,e.detail)}},p8=class m8 extends mn{constructor(e=1,t=.4,n=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new Te,h=new Te,d=new Te;for(let f=0;f<=n;f++)for(let p=0;p<=r;p++){const _=p/r*s,v=f/n*Math.PI*2;h.x=(e+t*Math.cos(v))*Math.cos(_),h.y=(e+t*Math.cos(v))*Math.sin(_),h.z=t*Math.sin(v),a.push(h.x,h.y,h.z),u.x=e*Math.cos(_),u.y=e*Math.sin(_),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(p/r),c.push(f/n)}for(let f=1;f<=n;f++)for(let p=1;p<=r;p++){const _=(r+1)*f+p-1,v=(r+1)*(f-1)+p-1,g=(r+1)*(f-1)+p,b=(r+1)*f+p;o.push(_,v,b),o.push(v,g,b)}this.setIndex(o),this.setAttribute("position",new jt(a,3)),this.setAttribute("normal",new jt(l,3)),this.setAttribute("uv",new jt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new m8(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}};class FS extends mn{constructor(e=1,t=.4,n=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:s,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],l=[],c=[],u=[],h=new Te,d=new Te,f=new Te,p=new Te,_=new Te,v=new Te,g=new Te;for(let m=0;m<=n;++m){const y=m/n*s*Math.PI*2;b(y,s,o,e,f),b(y+.01,s,o,e,p),v.subVectors(p,f),g.addVectors(p,f),_.crossVectors(v,g),g.crossVectors(_,v),_.normalize(),g.normalize();for(let A=0;A<=r;++A){const w=A/r*Math.PI*2,M=-t*Math.cos(w),T=t*Math.sin(w);h.x=f.x+(M*g.x+T*_.x),h.y=f.y+(M*g.y+T*_.y),h.z=f.z+(M*g.z+T*_.z),l.push(h.x,h.y,h.z),d.subVectors(h,f).normalize(),c.push(d.x,d.y,d.z),u.push(m/n),u.push(A/r)}}for(let m=1;m<=n;m++)for(let y=1;y<=r;y++){const A=(r+1)*(m-1)+(y-1),w=(r+1)*m+(y-1),M=(r+1)*m+y,T=(r+1)*(m-1)+y;a.push(A,w,T),a.push(w,M,T)}this.setIndex(a),this.setAttribute("position",new jt(l,3)),this.setAttribute("normal",new jt(c,3)),this.setAttribute("uv",new jt(u,2));function b(m,y,A,w,M){const T=Math.cos(m),E=Math.sin(m),C=A/y*m,N=Math.cos(C);M.x=w*(2+N)*.5*T,M.y=w*(2+N)*E*.5,M.z=w*Math.sin(C)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new FS(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class kS extends mn{constructor(e=new LR(new Te(-1,-1,0),new Te(-1,1,0),new Te(1,1,0)),t=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new Te,l=new Te,c=new yt;let u=new Te;const h=[],d=[],f=[],p=[];_(),this.setIndex(p),this.setAttribute("position",new jt(h,3)),this.setAttribute("normal",new jt(d,3)),this.setAttribute("uv",new jt(f,2));function _(){for(let m=0;m<t;m++)v(m);v(s===!1?t:0),b(),g()}function v(m){u=e.getPointAt(m/t,u);const y=o.normals[m],A=o.binormals[m];for(let w=0;w<=r;w++){const M=w/r*Math.PI*2,T=Math.sin(M),E=-Math.cos(M);l.x=E*y.x+T*A.x,l.y=E*y.y+T*A.y,l.z=E*y.z+T*A.z,l.normalize(),d.push(l.x,l.y,l.z),a.x=u.x+n*l.x,a.y=u.y+n*l.y,a.z=u.z+n*l.z,h.push(a.x,a.y,a.z)}}function g(){for(let m=1;m<=t;m++)for(let y=1;y<=r;y++){const A=(r+1)*(m-1)+(y-1),w=(r+1)*m+(y-1),M=(r+1)*m+y,T=(r+1)*(m-1)+y;p.push(A,w,T),p.push(w,M,T)}}function b(){for(let m=0;m<=t;m++)for(let y=0;y<=r;y++)c.x=m/t,c.y=y/r,f.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new kS(new Sb[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class g8 extends mn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,r=new Te,s=new Te;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,f=h.count;for(let p=d,_=d+f;p<_;p+=3)for(let v=0;v<3;v++){const g=a.getX(p+v),b=a.getX(p+(v+1)%3);r.fromBufferAttribute(o,g),s.fromBufferAttribute(o,b),IN(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const u=3*a+c,h=3*a+(c+1)%3;r.fromBufferAttribute(o,u),s.fromBufferAttribute(o,h),IN(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new jt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function IN(i,e,t){const n=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(n)===!0||t.has(r)===!0?!1:(t.add(n),t.add(r),!0)}var LN=Object.freeze({__proto__:null,BoxGeometry:F1,CapsuleGeometry:CS,CircleGeometry:PS,ConeGeometry:NR,CylinderGeometry:am,DodecahedronGeometry:RS,EdgesGeometry:s8,ExtrudeGeometry:LS,IcosahedronGeometry:c8,LatheGeometry:G1,OctahedronGeometry:FR,PlaneGeometry:Va,PolyhedronGeometry:Cm,RingGeometry:DS,ShapeGeometry:NS,SphereGeometry:Od,TetrahedronGeometry:d8,TorusGeometry:p8,TorusKnotGeometry:FS,TubeGeometry:kS,WireframeGeometry:g8});class v8 extends ur{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new It(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class _8 extends Al{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Td extends ur{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new It(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new It(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yu,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class so extends Td{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new yt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Gi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new It(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new It(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new It(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class y8 extends ur{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new It(16777215),this.specular=new It(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new It(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yu,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=L1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class x8 extends ur{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new It(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new It(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yu,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class b8 extends ur{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yu,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class S8 extends ur{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new It(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new It(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yu,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=L1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class w8 extends ur{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new It(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yu,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class M8 extends hs{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function td(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function A8(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function E8(i){function e(r,s){return i[r]-i[s]}const t=i.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(e),n}function QT(i,e,t){const n=i.length,r=new i.constructor(n);for(let s=0,o=0;o!==n;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=i[a+l]}return r}function kR(i,e,t,n){let r=1,s=i[0];for(;s!==void 0&&s[n]===void 0;)s=i[r++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=i[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=i[r++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),t.push(o)),s=i[r++];while(s!==void 0)}function zZ(i,e,t,n,r=30){const s=i.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let f=0;f<c.times.length;++f){const p=c.times[f]*r;if(!(p<t||p>=n)){h.push(c.times[f]);for(let _=0;_<u;++_)d.push(c.values[f*u+_])}}h.length!==0&&(c.times=td(h,c.times.constructor),c.values=td(d,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s}function GZ(i,e=0,t=i,n=30){n<=0&&(n=30);const r=t.tracks.length,s=e/n;for(let o=0;o<r;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(g){return g.name===a.name&&g.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const p=a.times.length-1;let _;if(s<=a.times[0]){const g=u,b=h-u;_=a.values.slice(g,b)}else if(s>=a.times[p]){const g=p*h+u,b=g+h-u;_=a.values.slice(g,b)}else{const g=a.createInterpolant(),b=u,m=h-u;g.evaluate(s),_=g.resultBuffer.slice(b,m)}l==="quaternion"&&new jr().fromArray(_).normalize().conjugate().toArray(_);const v=c.times.length;for(let g=0;g<v;++g){const b=g*f+d;if(l==="quaternion")jr.multiplyQuaternionsFlat(c.values,b,_,0,c.values,b);else{const m=f-d*2;for(let y=0;y<m;++y)c.values[b+y]-=_[y]}}}return i.blendMode=lR,i}const VZ={convertArray:td,isTypedArray:A8,getKeyframeOrder:E8,sortedArray:QT,flattenJSON:kR,subclip:zZ,makeClipAdditive:GZ};class Pm{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],s=t[n-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=n+2;;){if(r===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=r,r=t[++n],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(n=2,s=a);for(let l=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(r=s,s=t[--n-1],e>=s)break t}o=n,n=0;break n}break e}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(r=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=n[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class T8 extends Pm{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Zh,endingEnd:Zh}}intervalChanged_(e,t,n){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Qh:s=e,a=2*t-n;break;case i1:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Qh:o=e,l=2*n-t;break;case i1:o=1,l=n+r[1]-r[0];break;default:o=e-1,l=t}const c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(n-t)/(r-t),_=p*p,v=_*p,g=-d*v+2*d*_-d*p,b=(1+d)*v+(-1.5-2*d)*_+(-.5+d)*p+1,m=(-1-f)*v+(1.5+f)*_+.5*p,y=f*v-f*_;for(let A=0;A!==a;++A)s[A]=g*o[u+A]+b*o[c+A]+m*o[l+A]+y*o[h+A];return s}}class UR extends Pm{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(n-t)/(r-t),h=1-u;for(let d=0;d!==a;++d)s[d]=o[c+d]*h+o[l+d]*u;return s}}class C8 extends Pm{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class ja{constructor(e,t,n,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=td(t,this.TimeBufferType),this.values=td(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:td(e.times,Array),values:td(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(n.interpolation=r)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new C8(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new UR(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new T8(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case im:t=this.InterpolantFactoryMethodDiscrete;break;case Md:t=this.InterpolantFactoryMethodLinear;break;case Ax:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return im;case this.InterpolantFactoryMethodLinear:return Md;case this.InterpolantFactoryMethodSmooth:return Ax}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let s=0,o=r-1;for(;s!==r&&n[s]<e;)++s;for(;o!==-1&&n[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&A8(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===Ax,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(r)l=!0;else{const h=a*n,d=h-n,f=h+n;for(let p=0;p!==n;++p){const _=t[h+p];if(_!==t[d+p]||_!==t[f+p]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const h=a*n,d=o*n;for(let f=0;f!==n;++f)t[d+f]=t[h+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*n,l=o*n,c=0;c!==n;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}ja.prototype.TimeBufferType=Float32Array;ja.prototype.ValueBufferType=Float32Array;ja.prototype.DefaultInterpolation=Md;class Bd extends ja{}Bd.prototype.ValueTypeName="bool";Bd.prototype.ValueBufferType=Array;Bd.prototype.DefaultInterpolation=im;Bd.prototype.InterpolantFactoryMethodLinear=void 0;Bd.prototype.InterpolantFactoryMethodSmooth=void 0;class OR extends ja{}OR.prototype.ValueTypeName="color";class Cd extends ja{}Cd.prototype.ValueTypeName="number";class P8 extends Pm{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)jr.slerpFlat(s,0,o,c-a,o,c,l);return s}}class Vu extends ja{InterpolantFactoryMethodLinear(e){return new P8(this.times,this.values,this.getValueSize(),e)}}Vu.prototype.ValueTypeName="quaternion";Vu.prototype.DefaultInterpolation=Md;Vu.prototype.InterpolantFactoryMethodSmooth=void 0;class zd extends ja{}zd.prototype.ValueTypeName="string";zd.prototype.ValueBufferType=Array;zd.prototype.DefaultInterpolation=im;zd.prototype.InterpolantFactoryMethodLinear=void 0;zd.prototype.InterpolantFactoryMethodSmooth=void 0;class Pd extends ja{}Pd.prototype.ValueTypeName="vector";class lm{constructor(e,t=-1,n,r=vS){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Po(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push($Z(n[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=n.length;s!==o;++s)t.push(ja.toJSON(n[s]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=E8(l);l=QT(l,1,u),c=QT(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new Cd(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=r[h];d||(r[h]=d=[]),d.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(h,d,f,p,_){if(f.length!==0){const v=[],g=[];kR(f,v,g,p),v.length!==0&&_.push(new h(d,v,g))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let _=0;_<d[p].morphTargets.length;_++)f[d[p].morphTargets[_]]=-1;for(const _ in f){const v=[],g=[];for(let b=0;b!==d[p].morphTargets.length;++b){const m=d[p];v.push(m.time),g.push(m.morphTarget===_?1:0)}r.push(new Cd(".morphTargetInfluence["+_+"]",v,g))}l=f.length*o}else{const f=".bones["+t[h].name+"]";n(Pd,f+".position",d,"pos",r),n(Vu,f+".quaternion",d,"rot",r),n(Pd,f+".scale",d,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,r=e.length;n!==r;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function HZ(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Cd;case"vector":case"vector2":case"vector3":case"vector4":return Pd;case"color":return OR;case"quaternion":return Vu;case"bool":case"boolean":return Bd;case"string":return zd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function $Z(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=HZ(i.type);if(i.times===void 0){const t=[],n=[];kR(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const cc={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class BR{constructor(e,t,n){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const f=c[h],p=c[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}}const R8=new BR;class Us{constructor(e){this.manager=e!==void 0?e:R8,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Us.DEFAULT_MATERIAL_NAME="__DEFAULT";const Gl={};class WZ extends Error{constructor(e,t){super(e),this.response=t}}class Ha extends Us{constructor(e){super(e)}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=cc.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(Gl[e]!==void 0){Gl[e].push({onLoad:t,onProgress:n,onError:r});return}Gl[e]=[],Gl[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Gl[e],h=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),f=d?parseInt(d):0,p=f!==0;let _=0;const v=new ReadableStream({start(g){b();function b(){h.read().then(({done:m,value:y})=>{if(m)g.close();else{_+=y.byteLength;const A=new ProgressEvent("progress",{lengthComputable:p,loaded:_,total:f});for(let w=0,M=u.length;w<M;w++){const T=u[w];T.onProgress&&T.onProgress(A)}g.enqueue(y),b()}})}}});return new Response(v)}else throw new WZ(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),d=h&&h[1]?h[1].toLowerCase():void 0,f=new TextDecoder(d);return c.arrayBuffer().then(p=>f.decode(p))}}}).then(c=>{cc.add(e,c);const u=Gl[e];delete Gl[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=Gl[e];if(u===void 0)throw this.manager.itemError(e),c;delete Gl[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class jZ extends Us{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new Ha(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=lm.parse(e[n]);t.push(r)}return t}}class XZ extends Us{constructor(e){super(e)}load(e,t,n,r){const s=this,o=[],a=new ES,l=new Ha(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(e[h],function(d){const f=s.parse(d,!0);o[h]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(a.minFilter=hi),a.image=o,a.format=f.format,a.needsUpdate=!0,t&&t(a))},n,r)}if(Array.isArray(e))for(let h=0,d=e.length;h<d;++h)u(h);else l.load(e,function(h){const d=s.parse(h,!0);if(d.isCubemap){const f=d.mipmaps.length/d.mipmapCount;for(let p=0;p<f;p++){o[p]={mipmaps:[]};for(let _=0;_<d.mipmapCount;_++)o[p].mipmaps.push(d.mipmaps[p*d.mipmapCount+_]),o[p].format=d.format,o[p].width=d.width,o[p].height=d.height}a.image=o}else a.image.width=d.width,a.image.height=d.height,a.mipmaps=d.mipmaps;d.mipmapCount===1&&(a.minFilter=hi),a.format=d.format,a.needsUpdate=!0,t&&t(a)},n,r);return a}}class f1 extends Us{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=cc.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=l1("img");function l(){u(),cc.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(h){u(),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class qZ extends Us{constructor(e){super(e)}load(e,t,n,r){const s=new U1;s.colorSpace=_r;const o=new f1(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(u){s.images[c]=u,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class YZ extends Us{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new ld,a=new Ha(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){let c;try{c=s.parse(l)}catch(u){if(r!==void 0)r(u);else{console.error(u);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:$r,o.wrapT=c.wrapT!==void 0?c.wrapT:$r,o.magFilter=c.magFilter!==void 0?c.magFilter:hi,o.minFilter=c.minFilter!==void 0?c.minFilter:hi,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0?o.colorSpace=c.colorSpace:c.encoding!==void 0&&(o.encoding=c.encoding),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=wl),c.mipmapCount===1&&(o.minFilter=hi),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},n,r),o}}class I8 extends Us{constructor(e){super(e)}load(e,t,n,r){const s=new dr,o=new f1(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}let Zu=class extends Gn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new It(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};class L8 extends Zu{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Gn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new It(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const lM=new en,DN=new Te,NN=new Te;let zR=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new yt(512,512),this.map=null,this.mapPass=null,this.matrix=new en,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new O1,this._frameExtents=new yt(1,1),this._viewportCount=1,this._viewports=[new Wn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;DN.setFromMatrixPosition(e.matrixWorld),t.position.copy(DN),NN.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(NN),t.updateMatrixWorld(),lM.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(lM),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(lM)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}};class KZ extends zR{constructor(){super(new Zi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=sm*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class GR extends Zu{constructor(e,t,n=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Gn.DEFAULT_UP),this.updateMatrix(),this.target=new Gn,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new KZ}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const FN=new en,Tg=new Te,cM=new Te;class ZZ extends zR{constructor(){super(new Zi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new yt(4,2),this._viewportCount=6,this._viewports=[new Wn(2,1,1,1),new Wn(0,1,1,1),new Wn(3,1,1,1),new Wn(1,1,1,1),new Wn(3,0,1,1),new Wn(1,0,1,1)],this._cubeDirections=[new Te(1,0,0),new Te(-1,0,0),new Te(0,0,1),new Te(0,0,-1),new Te(0,1,0),new Te(0,-1,0)],this._cubeUps=[new Te(0,1,0),new Te(0,1,0),new Te(0,1,0),new Te(0,1,0),new Te(0,0,1),new Te(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),Tg.setFromMatrixPosition(e.matrixWorld),n.position.copy(Tg),cM.copy(n.position),cM.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(cM),n.updateMatrixWorld(),r.makeTranslation(-Tg.x,-Tg.y,-Tg.z),FN.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(FN)}}class VR extends Zu{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new ZZ}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}let QZ=class extends zR{constructor(){super(new Ku(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},US=class extends Zu{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Gn.DEFAULT_UP),this.updateMatrix(),this.target=new Gn,this.shadow=new QZ}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},HR=class extends Zu{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}};class D8 extends Zu{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class N8{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Te)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}class F8 extends Zu{constructor(e=new N8,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class OS extends Us{constructor(e){super(e),this.textures={}}load(e,t,n,r){const s=this,o=new Ha(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const r=OS.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new It().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=n(o.value);break;case"c":r.uniforms[s].value=new It().setHex(o.value);break;case"v2":r.uniforms[s].value=new yt().fromArray(o.value);break;case"v3":r.uniforms[s].value=new Te().fromArray(o.value);break;case"v4":r.uniforms[s].value=new Wn().fromArray(o.value);break;case"m3":r.uniforms[s].value=new bn().fromArray(o.value);break;case"m4":r.uniforms[s].value=new en().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=n(e.map)),e.matcap!==void 0&&(r.matcap=n(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new yt().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new yt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:v8,SpriteMaterial:wR,RawShaderMaterial:_8,ShaderMaterial:Al,PointsMaterial:AS,MeshPhysicalMaterial:so,MeshStandardMaterial:Td,MeshPhongMaterial:y8,MeshToonMaterial:x8,MeshNormalMaterial:b8,MeshLambertMaterial:S8,MeshDepthMaterial:bS,MeshDistanceMaterial:SS,MeshBasicMaterial:fi,MeshMatcapMaterial:w8,LineDashedMaterial:M8,LineBasicMaterial:hs,Material:ur};return new t[e]}}class Ru{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class $R extends mn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class k8 extends Us{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new Ha(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(f,p){if(t[p]!==void 0)return t[p];const v=f.interleavedBuffers[p],g=s(f,v.buffer),b=xp(v.type,g),m=new B1(b,v.stride);return m.uuid=v.uuid,t[p]=m,m}function s(f,p){if(n[p]!==void 0)return n[p];const v=f.arrayBuffers[p],g=new Uint32Array(v).buffer;return n[p]=g,g}const o=e.isInstancedBufferGeometry?new $R:new mn,a=e.data.index;if(a!==void 0){const f=xp(a.type,a.array);o.setIndex(new An(f,1))}const l=e.data.attributes;for(const f in l){const p=l[f];let _;if(p.isInterleavedBufferAttribute){const v=r(e.data,p.data);_=new zu(v,p.itemSize,p.offset,p.normalized)}else{const v=xp(p.type,p.array),g=p.isInstancedBufferAttribute?Gu:An;_=new g(v,p.itemSize,p.normalized)}p.name!==void 0&&(_.name=p.name),p.usage!==void 0&&_.setUsage(p.usage),o.setAttribute(f,_)}const c=e.data.morphAttributes;if(c)for(const f in c){const p=c[f],_=[];for(let v=0,g=p.length;v<g;v++){const b=p[v];let m;if(b.isInterleavedBufferAttribute){const y=r(e.data,b.data);m=new zu(y,b.itemSize,b.offset,b.normalized)}else{const y=xp(b.type,b.array);m=new An(y,b.itemSize,b.normalized)}b.name!==void 0&&(m.name=b.name),_.push(m)}o.morphAttributes[f]=_}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let f=0,p=h.length;f!==p;++f){const _=h[f];o.addGroup(_.start,_.count,_.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const f=new Te;d.center!==void 0&&f.fromArray(d.center),o.boundingSphere=new Ur(f,d.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class JZ extends Us{constructor(e){super(e)}load(e,t,n,r){const s=this,o=this.path===""?Ru.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new Ha(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){r!==void 0&&r(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,t)},n,r)}async loadAsync(e,t){const n=this,r=this.path===""?Ru.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new Ha(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(a)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,s,l,a,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),t!==void 0){let h=!1;for(const d in o)if(o[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let n=0,r=e.length;n<r;n++){const s=new cd().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new z1().fromJSON(e[s],r);n[a.uuid]=a}return n}parseGeometries(e,t){const n={};if(e!==void 0){const r=new k8;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;default:l.type in LN?a=LN[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),n[l.uuid]=a}}return n}parseMaterials(e,t){const n={},r={};if(e!==void 0){const s=new OS;s.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];n[l.uuid]===void 0&&(n[l.uuid]=s.parse(l)),r[l.uuid]=n[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const r=e[n],s=lm.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const n=this,r={};let s;function o(l){return n.manager.itemStart(l),s.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return o(u)}else return l.data?{data:xp(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new BR(t);s=new f1(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],d=h.url;if(Array.isArray(d)){const f=[];for(let p=0,_=d.length;p<_;p++){const v=d[p],g=a(v);g!==null&&(g instanceof HTMLImageElement?f.push(g):f.push(new ld(g.data,g.width,g.height)))}r[h.uuid]=new Jh(f)}else{const f=a(h.url);r[h.uuid]=new Jh(f)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:xp(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new f1(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h],p=await s(f);p!==null&&(p instanceof HTMLImageElement?u.push(p):u.push(new ld(p.data,p.width,p.height)))}n[l.uuid]=new Jh(u)}else{const u=await s(l.url);n[l.uuid]=new Jh(u)}}}return n}parseTextures(e,t){function n(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let u;Array.isArray(c)?(u=new U1,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new ld:u=new dr,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=a.uuid,a.name!==void 0&&(u.name=a.name),a.mapping!==void 0&&(u.mapping=n(a.mapping,eQ)),a.channel!==void 0&&(u.channel=a.channel),a.offset!==void 0&&u.offset.fromArray(a.offset),a.repeat!==void 0&&u.repeat.fromArray(a.repeat),a.center!==void 0&&u.center.fromArray(a.center),a.rotation!==void 0&&(u.rotation=a.rotation),a.wrap!==void 0&&(u.wrapS=n(a.wrap[0],kN),u.wrapT=n(a.wrap[1],kN)),a.format!==void 0&&(u.format=a.format),a.internalFormat!==void 0&&(u.internalFormat=a.internalFormat),a.type!==void 0&&(u.type=a.type),a.colorSpace!==void 0&&(u.colorSpace=a.colorSpace),a.encoding!==void 0&&(u.encoding=a.encoding),a.minFilter!==void 0&&(u.minFilter=n(a.minFilter,UN)),a.magFilter!==void 0&&(u.magFilter=n(a.magFilter,UN)),a.anisotropy!==void 0&&(u.anisotropy=a.anisotropy),a.flipY!==void 0&&(u.flipY=a.flipY),a.generateMipmaps!==void 0&&(u.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(u.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(u.compareFunction=a.compareFunction),a.userData!==void 0&&(u.userData=a.userData),r[a.uuid]=u}return r}parseObject(e,t,n,r,s){let o;function a(d){return t[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),t[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const f=[];for(let p=0,_=d.length;p<_;p++){const v=d[p];n[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),f.push(n[v])}return f}return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),n[d]}}function c(d){return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),r[d]}let u,h;switch(e.type){case"Scene":o=new SR,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new It(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new W6(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new wS(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new Zi(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Ku(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new HR(e.color,e.intensity);break;case"DirectionalLight":o=new US(e.color,e.intensity);break;case"PointLight":o=new VR(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new D8(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new GR(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new L8(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new F8().fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),h=l(e.material),o=new MR(u,h),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),h=l(e.material),o=new Tn(u,h);break;case"InstancedMesh":u=a(e.geometry),h=l(e.material);const d=e.count,f=e.instanceMatrix,p=e.instanceColor;o=new AR(u,h,d),o.instanceMatrix=new Gu(new Float32Array(f.array),16),p!==void 0&&(o.instanceColor=new Gu(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":u=a(e.geometry),h=l(e.material),o=new K6(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,h),o.geometry=u,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(_=>{const v=new kr;v.min.fromArray(_.boxMin),v.max.fromArray(_.boxMax);const g=new Ur;return g.radius=_.sphereRadius,g.center.fromArray(_.sphereCenter),{boxInitialized:_.boxInitialized,box:v,sphereInitialized:_.sphereInitialized,sphere:g}}),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=c(e.matricesTexture.uuid);break;case"LOD":o=new Y6;break;case"Line":o=new bc(a(e.geometry),l(e.material));break;case"LineLoop":o=new ER(a(e.geometry),l(e.material));break;case"LineSegments":o=new $a(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new TR(a(e.geometry),l(e.material));break;case"Sprite":o=new q6(l(e.material));break;case"Group":o=new To;break;case"Bone":o=new MS;break;default:o=new Gn}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let f=0;f<d.length;f++)o.add(this.parseObject(d[f],t,n,r,s))}if(e.animations!==void 0){const d=e.animations;for(let f=0;f<d.length;f++){const p=d[f];o.animations.push(s[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const d=e.levels;for(let f=0;f<d.length;f++){const p=d[f],_=o.getObjectByProperty("uuid",p.object);_!==void 0&&o.addLevel(_,p.distance,p.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const r=t[n.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(r,n.bindMatrix)}})}}const eQ={UVMapping:pS,CubeReflectionMapping:xc,CubeRefractionMapping:Ou,EquirectangularReflectionMapping:e1,EquirectangularRefractionMapping:t1,CubeUVReflectionMapping:Am},kN={RepeatWrapping:Bu,ClampToEdgeWrapping:$r,MirroredRepeatWrapping:tm},UN={NearestFilter:zi,NearestMipmapNearestFilter:n1,NearestMipmapLinearFilter:Op,LinearFilter:hi,LinearMipmapNearestFilter:mS,LinearMipmapLinearFilter:wl};class U8 extends Us{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=cc.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),s.manager.itemEnd(e)}).catch(c=>{r&&r(c)});return}return setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return cc.add(e,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){r&&r(c),cc.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});cc.add(e,l),s.manager.itemStart(e)}}let X_;class WR{static getContext(){return X_===void 0&&(X_=new(window.AudioContext||window.webkitAudioContext)),X_}static setContext(e){X_=e}}class tQ extends Us{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new Ha(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);WR.getContext().decodeAudioData(c,function(h){t(h)}).catch(a)}catch(c){a(c)}},n,r);function a(l){r?r(l):console.error(l),s.manager.itemError(e)}}}const ON=new en,BN=new en,xh=new en;let nQ=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Zi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Zi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,xh.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(od*t.fov*.5)/t.zoom;let a,l;BN.elements[12]=-r,ON.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,xh.elements[0]=2*t.near/(l-a),xh.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(xh),a=-o*t.aspect-s,l=o*t.aspect-s,xh.elements[0]=2*t.near/(l-a),xh.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(xh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(BN),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(ON)}};class jR{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=zN(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=zN();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function zN(){return(typeof performance>"u"?Date:performance).now()}const bh=new Te,GN=new jr,iQ=new Te,Sh=new Te;class rQ extends Gn{constructor(){super(),this.type="AudioListener",this.context=WR.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new jR}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(bh,GN,iQ),Sh.set(0,0,-1).applyQuaternion(GN),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(bh.x,r),t.positionY.linearRampToValueAtTime(bh.y,r),t.positionZ.linearRampToValueAtTime(bh.z,r),t.forwardX.linearRampToValueAtTime(Sh.x,r),t.forwardY.linearRampToValueAtTime(Sh.y,r),t.forwardZ.linearRampToValueAtTime(Sh.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(bh.x,bh.y,bh.z),t.setOrientation(Sh.x,Sh.y,Sh.z,n.x,n.y,n.z)}}class O8 extends Gn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const wh=new Te,VN=new jr,sQ=new Te,Mh=new Te;class oQ extends O8{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(wh,VN,sQ),Mh.set(0,0,1).applyQuaternion(VN);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(wh.x,n),t.positionY.linearRampToValueAtTime(wh.y,n),t.positionZ.linearRampToValueAtTime(wh.z,n),t.orientationX.linearRampToValueAtTime(Mh.x,n),t.orientationY.linearRampToValueAtTime(Mh.y,n),t.orientationZ.linearRampToValueAtTime(Mh.z,n)}else t.setPosition(wh.x,wh.y,wh.z),t.setOrientation(Mh.x,Mh.y,Mh.z)}}class aQ{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class B8{constructor(e,t,n){this.binding=e,this.valueSize=n;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)n[s+a]=n[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(n,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(n,r,l,1-s,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let s=n,o=r;s!==o;++s)t[s]=t[r+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[n+o]}_slerp(e,t,n,r){jr.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,s){const o=this._workIndex*s;jr.multiplyQuaternionsFlat(e,o,e,t,e,n),jr.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[n+a]*r}}_lerpAdditive(e,t,n,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[n+o]*r}}}const XR="\\[\\]\\.:\\/",lQ=new RegExp("["+XR+"]","g"),qR="[^"+XR+"]",cQ="[^"+XR.replace("\\.","")+"]",uQ=/((?:WC+[\/:])*)/.source.replace("WC",qR),hQ=/(WCOD+)?/.source.replace("WCOD",cQ),dQ=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",qR),fQ=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",qR),pQ=new RegExp("^"+uQ+hQ+dQ+fQ+"$"),mQ=["material","materials","bones","map"];class gQ{constructor(e,t,n){const r=n||Pn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Pn{constructor(e,t,n){this.path=t,this.parsedPath=n||Pn.parseTrackName(t),this.node=Pn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Pn.Composite(e,t,n):new Pn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(lQ,"")}static parseTrackName(e){const t=pQ.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=n.nodeName.substring(r+1);mQ.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=n(a.children);if(l)return l}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=Pn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Pn.Composite=gQ;Pn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Pn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Pn.prototype.GetterByBindingType=[Pn.prototype._getValue_direct,Pn.prototype._getValue_array,Pn.prototype._getValue_arrayElement,Pn.prototype._getValue_toArray];Pn.prototype.SetterByBindingTypeAndVersioning=[[Pn.prototype._setValue_direct,Pn.prototype._setValue_direct_setNeedsUpdate,Pn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Pn.prototype._setValue_array,Pn.prototype._setValue_array_setNeedsUpdate,Pn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Pn.prototype._setValue_arrayElement,Pn.prototype._setValue_arrayElement_setNeedsUpdate,Pn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Pn.prototype._setValue_fromArray,Pn.prototype._setValue_fromArray_setNeedsUpdate,Pn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class vQ{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Po(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],f=d.uuid;let p=t[f];if(p===void 0){p=l++,t[f]=p,e.push(d);for(let _=0,v=o;_!==v;++_)s[_].push(new Pn(d,n[_],r[_]))}else if(p<c){a=e[p];const _=--c,v=e[_];t[v.uuid]=p,e[p]=v,t[f]=_,e[_]=d;for(let g=0,b=o;g!==b;++g){const m=s[g],y=m[_];let A=m[p];m[p]=y,A===void 0&&(A=new Pn(d,n[g],r[g])),m[_]=A}}else e[p]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,u=t[c];if(u!==void 0&&u>=s){const h=s++,d=e[h];t[d.uuid]=u,e[u]=d,t[c]=h,e[h]=l;for(let f=0,p=r;f!==p;++f){const _=n[f],v=_[h],g=_[u];_[u]=v,_[h]=g}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],u=c.uuid,h=t[u];if(h!==void 0)if(delete t[u],h<s){const d=--s,f=e[d],p=--o,_=e[p];t[f.uuid]=h,e[h]=f,t[_.uuid]=d,e[d]=_,e.pop();for(let v=0,g=r;v!==g;++v){const b=n[v],m=b[d],y=b[p];b[h]=m,b[d]=y,b.pop()}}else{const d=--o,f=e[d];d>0&&(t[f.uuid]=h),e[h]=f,e.pop();for(let p=0,_=r;p!==_;++p){const v=n[p];v[h]=v[d],v.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);r=s.length,n[e]=r,o.push(e),a.push(t),s.push(h);for(let d=u,f=l.length;d!==f;++d){const p=l[d];h[d]=new Pn(p,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=n,o[n]=l,o.pop(),s[n]=s[a],s.pop(),r[n]=r[a],r.pop()}}}class z8{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:Zh,endingEnd:Zh};for(let c=0;c!==o;++c){const u=s[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=c6,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*n;l<0||n===0?t=0:(this._startTime=null,t=n*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case lR:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);break;case vS:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,s=this._loopCount;const o=n===u6;if(e===0)return s===-1?r:o&&(s&1)===1?t-r:r;if(n===l6){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Qh,r.endingEnd=Qh):(e?r.endingStart=this.zeroSlopeAtStart?Qh:Zh:r.endingStart=i1,t?r.endingEnd=this.zeroSlopeAtEnd?Qh:Zh:r.endingEnd=i1)}_scheduleFading(e,t,n){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=n,this}}const _Q=new Float32Array(1);class yQ extends Cc{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=r[h],f=d.name;let p=u[f];if(p!==void 0)++p.referenceCount,o[h]=p;else{if(p=o[h],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,f));continue}const _=t&&t._propertyBindings[h].binding.parsedPath;p=new B8(Pn.create(n,f,_),d.ValueTypeName,d.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,f),o[h]=p}a[h].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,n)}const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=a.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,a=o[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new UR(new Float32Array(2),new Float32Array(2),1,_Q),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?lm.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(n===void 0&&(o!==null?n=o.blendMode:n=vS),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===n)return h;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const u=new z8(this,o,t,n);return this._bindAction(u,c),this._addInactiveAction(u,a,s),u}existingAction(e,t){const n=t||this._root,r=n.uuid,s=typeof e=="string"?lm.findByName(n,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const u=c._cacheIndex,h=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}let xQ=class G8{constructor(e){this.value=e}clone(){return new G8(this.value.clone===void 0?this.value:this.value.clone())}},bQ=0;class SQ extends Cc{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:bQ++}),this.name="",this.usage=a1,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,r=t.length;n<r;n++){const s=Array.isArray(t[n])?t[n]:[t[n]];for(let o=0;o<s.length;o++)this.uniforms.push(s[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class wQ extends B1{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class MQ{constructor(e,t,n,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class YR{constructor(e,t,n=0,r=1/0){this.ray=new Em(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new ad,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return JT(e,this,n,t),n.sort(HN),n}intersectObjects(e,t=!0,n=[]){for(let r=0,s=e.length;r<s;r++)JT(e[r],this,n,t);return n.sort(HN),n}}function HN(i,e){return i.distance-e.distance}function JT(i,e,t,n){if(i.layers.test(e.layers)&&i.raycast(e,t),n===!0){const r=i.children;for(let s=0,o=r.length;s<o;s++)JT(r[s],e,t,!0)}}class AQ{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Gi(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class EQ{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const $N=new yt;class TQ{constructor(e=new yt(1/0,1/0),t=new yt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=$N.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,$N).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const WN=new Te,q_=new Te;class CQ{constructor(e=new Te,t=new Te){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){WN.subVectors(e,this.start),q_.subVectors(this.end,this.start);const n=q_.dot(q_);let s=q_.dot(WN)/n;return t&&(s=Gi(s,0,1)),s}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const jN=new Te;class PQ extends Gn{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new mn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,u=a/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new jt(r,3));const s=new hs({fog:!1,toneMapped:!1});this.cone=new $a(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),jN.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(jN),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const qc=new Te,Y_=new en,uM=new en;class RQ extends $a{constructor(e){const t=V8(e),n=new mn,r=[],s=[],o=new It(0,0,1),a=new It(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}n.setAttribute("position",new jt(r,3)),n.setAttribute("color",new jt(s,3));const l=new hs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");uM.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(Y_.multiplyMatrices(uM,a.matrixWorld),qc.setFromMatrixPosition(Y_),r.setXYZ(o,qc.x,qc.y,qc.z),Y_.multiplyMatrices(uM,a.parent.matrixWorld),qc.setFromMatrixPosition(Y_),r.setXYZ(o+1,qc.x,qc.y,qc.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function V8(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,V8(i.children[t]));return e}class IQ extends Tn{constructor(e,t,n){const r=new Od(t,4,2),s=new fi({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const LQ=new Te,XN=new It,qN=new It;class DQ extends Gn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new FR(t);r.rotateY(Math.PI*.5),this.material=new fi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new An(o,3)),this.add(new Tn(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");XN.copy(this.light.color),qN.copy(this.light.groundColor);for(let n=0,r=t.count;n<r;n++){const s=n<r/2?XN:qN;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(LQ.setFromMatrixPosition(this.light.matrixWorld).negate())}}class NQ extends $a{constructor(e=10,t=10,n=4473924,r=8947848){n=new It(n),r=new It(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let d=0,f=0,p=-a;d<=t;d++,p+=o){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);const _=d===s?n:r;_.toArray(c,f),f+=3,_.toArray(c,f),f+=3,_.toArray(c,f),f+=3,_.toArray(c,f),f+=3}const u=new mn;u.setAttribute("position",new jt(l,3)),u.setAttribute("color",new jt(c,3));const h=new hs({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class FQ extends $a{constructor(e=10,t=16,n=8,r=64,s=4473924,o=8947848){s=new It(s),o=new It(o);const a=[],l=[];if(t>1)for(let h=0;h<t;h++){const d=h/t*(Math.PI*2),f=Math.sin(d)*e,p=Math.cos(d)*e;a.push(0,0,0),a.push(f,0,p);const _=h&1?s:o;l.push(_.r,_.g,_.b),l.push(_.r,_.g,_.b)}for(let h=0;h<n;h++){const d=h&1?s:o,f=e-e/n*h;for(let p=0;p<r;p++){let _=p/r*(Math.PI*2),v=Math.sin(_)*f,g=Math.cos(_)*f;a.push(v,0,g),l.push(d.r,d.g,d.b),_=(p+1)/r*(Math.PI*2),v=Math.sin(_)*f,g=Math.cos(_)*f,a.push(v,0,g),l.push(d.r,d.g,d.b)}}const c=new mn;c.setAttribute("position",new jt(a,3)),c.setAttribute("color",new jt(l,3));const u=new hs({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const YN=new Te,K_=new Te,KN=new Te;class kQ extends Gn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new mn;r.setAttribute("position",new jt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new hs({fog:!1,toneMapped:!1});this.lightPlane=new bc(r,s),this.add(this.lightPlane),r=new mn,r.setAttribute("position",new jt([0,0,0,0,0,1],3)),this.targetLine=new bc(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),YN.setFromMatrixPosition(this.light.matrixWorld),K_.setFromMatrixPosition(this.light.target.matrixWorld),KN.subVectors(K_,YN),this.lightPlane.lookAt(K_),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(K_),this.targetLine.scale.z=KN.length()}}const Z_=new Te,Fi=new k1;class UQ extends $a{constructor(e){const t=new mn,n=new hs({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,_){l(p),l(_)}function l(p){r.push(0,0,0),s.push(0,0,0),o[p]===void 0&&(o[p]=[]),o[p].push(r.length/3-1)}t.setAttribute("position",new jt(r,3)),t.setAttribute("color",new jt(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new It(16755200),u=new It(16711680),h=new It(43775),d=new It(16777215),f=new It(3355443);this.setColors(c,u,h,d,f)}setColors(e,t,n,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,r=1;Fi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ji("c",t,e,Fi,0,0,-1),ji("t",t,e,Fi,0,0,1),ji("n1",t,e,Fi,-n,-r,-1),ji("n2",t,e,Fi,n,-r,-1),ji("n3",t,e,Fi,-n,r,-1),ji("n4",t,e,Fi,n,r,-1),ji("f1",t,e,Fi,-n,-r,1),ji("f2",t,e,Fi,n,-r,1),ji("f3",t,e,Fi,-n,r,1),ji("f4",t,e,Fi,n,r,1),ji("u1",t,e,Fi,n*.7,r*1.1,-1),ji("u2",t,e,Fi,-n*.7,r*1.1,-1),ji("u3",t,e,Fi,0,r*2,-1),ji("cf1",t,e,Fi,-n,0,1),ji("cf2",t,e,Fi,n,0,1),ji("cf3",t,e,Fi,0,-r,1),ji("cf4",t,e,Fi,0,r,1),ji("cn1",t,e,Fi,-n,0,-1),ji("cn2",t,e,Fi,n,0,-1),ji("cn3",t,e,Fi,0,-r,-1),ji("cn4",t,e,Fi,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ji(i,e,t,n,r,s,o){Z_.set(r,s,o).unproject(n);const a=e[i];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],Z_.x,Z_.y,Z_.z)}}const Q_=new kr;class OQ extends $a{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new mn;s.setIndex(new An(n,1)),s.setAttribute("position",new An(r,3)),super(s,new hs({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Q_.setFromObject(this.object),Q_.isEmpty())return;const t=Q_.min,n=Q_.max,r=this.geometry.attributes.position,s=r.array;s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=t.x,s[4]=n.y,s[5]=n.z,s[6]=t.x,s[7]=t.y,s[8]=n.z,s[9]=n.x,s[10]=t.y,s[11]=n.z,s[12]=n.x,s[13]=n.y,s[14]=t.z,s[15]=t.x,s[16]=n.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=n.x,s[22]=t.y,s[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class BQ extends $a{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new mn;s.setIndex(new An(n,1)),s.setAttribute("position",new jt(r,3)),super(s,new hs({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class zQ extends bc{constructor(e,t=1,n=16776960){const r=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new mn;o.setAttribute("position",new jt(s,3)),o.computeBoundingSphere(),super(o,new hs({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new mn;l.setAttribute("position",new jt(a,3)),l.computeBoundingSphere(),this.add(new Tn(l,new fi({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const ZN=new Te;let J_,hM;class GQ extends Gn{constructor(e=new Te(0,0,1),t=new Te(0,0,0),n=1,r=16776960,s=n*.2,o=s*.2){super(),this.type="ArrowHelper",J_===void 0&&(J_=new mn,J_.setAttribute("position",new jt([0,0,0,0,1,0],3)),hM=new am(0,.5,1,5,1),hM.translate(0,-.5,0)),this.position.copy(t),this.line=new bc(J_,new hs({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Tn(hM,new fi({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{ZN.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(ZN,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class VQ extends $a{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new mn;r.setAttribute("position",new jt(t,3)),r.setAttribute("color",new jt(n,3));const s=new hs({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,n){const r=new It,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(n),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class HQ{constructor(){this.type="ShapePath",this.color=new It,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new c1,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,s,o){return this.currentPath.bezierCurveTo(e,t,n,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(g){const b=[];for(let m=0,y=g.length;m<y;m++){const A=g[m],w=new cd;w.curves=A.curves,b.push(w)}return b}function n(g,b){const m=b.length;let y=!1;for(let A=m-1,w=0;w<m;A=w++){let M=b[A],T=b[w],E=T.x-M.x,C=T.y-M.y;if(Math.abs(C)>Number.EPSILON){if(C<0&&(M=b[w],E=-E,T=b[A],C=-C),g.y<M.y||g.y>T.y)continue;if(g.y===M.y){if(g.x===M.x)return!0}else{const N=C*(g.x-M.x)-E*(g.y-M.y);if(N===0)return!0;if(N<0)continue;y=!y}}else{if(g.y!==M.y)continue;if(T.x<=g.x&&g.x<=M.x||M.x<=g.x&&g.x<=T.x)return!0}}return y}const r=gl.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,a,l;const c=[];if(s.length===1)return a=s[0],l=new cd,l.curves=a.curves,c.push(l),c;let u=!r(s[0].getPoints());u=e?!u:u;const h=[],d=[];let f=[],p=0,_;d[p]=void 0,f[p]=[];for(let g=0,b=s.length;g<b;g++)a=s[g],_=a.getPoints(),o=r(_),o=e?!o:o,o?(!u&&d[p]&&p++,d[p]={s:new cd,p:_},d[p].s.curves=a.curves,u&&p++,f[p]=[]):f[p].push({h:a,p:_[0]});if(!d[0])return t(s);if(d.length>1){let g=!1,b=0;for(let m=0,y=d.length;m<y;m++)h[m]=[];for(let m=0,y=d.length;m<y;m++){const A=f[m];for(let w=0;w<A.length;w++){const M=A[w];let T=!0;for(let E=0;E<d.length;E++)n(M.p,d[E].p)&&(m!==E&&b++,T?(T=!1,h[E].push(M)):g=!0);T&&h[m].push(M)}}b>0&&g===!1&&(f=h)}let v;for(let g=0,b=d.length;g<b;g++){l=d[g].s,c.push(l),v=f[g];for(let m=0,y=v.length;m<y;m++)l.holes.push(v[m].h)}return c}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:I1}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=I1);const $Q=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:eR,AddEquation:pu,AddOperation:Xz,AdditiveAnimationBlendMode:lR,AdditiveBlending:dT,AgXToneMapping:Qz,AlphaFormat:n6,AlwaysCompare:x6,AlwaysDepth:zz,AlwaysStencilFunc:HT,AmbientLight:HR,AnimationAction:z8,AnimationClip:lm,AnimationLoader:jZ,AnimationMixer:yQ,AnimationObjectGroup:vQ,AnimationUtils:VZ,ArcCurve:Z6,ArrayCamera:H6,ArrowHelper:GQ,AttachedBindMode:vT,Audio:O8,AudioAnalyser:aQ,AudioContext:WR,AudioListener:rQ,AudioLoader:tQ,AxesHelper:VQ,BackSide:Is,BasicDepthPacking:d6,BasicShadowMap:Sz,BatchedMesh:K6,Bone:MS,BooleanKeyframeTrack:Bd,Box2:TQ,Box3:kr,Box3Helper:BQ,BoxGeometry:F1,BoxHelper:OQ,BufferAttribute:An,BufferGeometry:mn,BufferGeometryLoader:k8,ByteType:e6,Cache:cc,Camera:k1,CameraHelper:UQ,CanvasTexture:Ad,CapsuleGeometry:CS,CatmullRomCurve3:Q6,CineonToneMapping:Kz,CircleGeometry:PS,ClampToEdgeWrapping:$r,Clock:jR,Color:It,ColorKeyframeTrack:OR,ColorManagement:Vn,CompressedArrayTexture:hZ,CompressedCubeTexture:dZ,CompressedTexture:ES,CompressedTextureLoader:XZ,ConeGeometry:NR,ConstantAlphaFactor:Uz,ConstantColorFactor:Fz,CubeCamera:D6,CubeReflectionMapping:xc,CubeRefractionMapping:Ou,CubeTexture:U1,CubeTextureLoader:qZ,CubeUVReflectionMapping:Am,CubicBezierCurve:PR,CubicBezierCurve3:J6,CubicInterpolant:T8,CullFaceBack:hT,CullFaceFront:bz,CullFaceFrontBack:rW,CullFaceNone:xz,Curve:Wa,CurvePath:t8,CustomBlending:wz,CustomToneMapping:Zz,CylinderGeometry:am,Cylindrical:EQ,Data3DTexture:mR,DataArrayTexture:yS,DataTexture:ld,DataTextureLoader:YZ,DataUtils:uj,DecrementStencilOp:fW,DecrementWrapStencilOp:mW,DefaultLoadingManager:R8,DepthFormat:Cu,DepthStencilFormat:wd,DepthTexture:xR,DetachedBindMode:Jz,DirectionalLight:US,DirectionalLightHelper:kQ,DiscreteInterpolant:C8,DisplayP3ColorSpace:_S,DodecahedronGeometry:RS,DoubleSide:cr,DstAlphaFactor:Rz,DstColorFactor:Lz,DynamicCopyUsage:RW,DynamicDrawUsage:MW,DynamicReadUsage:TW,EdgesGeometry:s8,EllipseCurve:TS,EqualCompare:g6,EqualDepth:Vz,EqualStencilFunc:yW,EquirectangularReflectionMapping:e1,EquirectangularRefractionMapping:t1,Euler:N1,EventDispatcher:Cc,ExtrudeGeometry:LS,FileLoader:Ha,Float16BufferAttribute:gj,Float32BufferAttribute:jt,Float64BufferAttribute:vj,FloatType:Na,Fog:W6,FogExp2:wS,FramebufferTexture:uZ,FrontSide:Sl,Frustum:O1,GLBufferAttribute:MQ,GLSL1:LW,GLSL3:$T,GreaterCompare:v6,GreaterDepth:$z,GreaterEqualCompare:y6,GreaterEqualDepth:Hz,GreaterEqualStencilFunc:wW,GreaterStencilFunc:bW,GridHelper:NQ,Group:To,HalfFloatType:nm,HemisphereLight:L8,HemisphereLightHelper:DQ,IcosahedronGeometry:c8,ImageBitmapLoader:U8,ImageLoader:f1,ImageUtils:pR,IncrementStencilOp:dW,IncrementWrapStencilOp:pW,InstancedBufferAttribute:Gu,InstancedBufferGeometry:$R,InstancedInterleavedBuffer:wQ,InstancedMesh:AR,Int16BufferAttribute:pj,Int32BufferAttribute:mj,Int8BufferAttribute:hj,IntType:tR,InterleavedBuffer:B1,InterleavedBufferAttribute:zu,Interpolant:Pm,InterpolateDiscrete:im,InterpolateLinear:Md,InterpolateSmooth:Ax,InvertStencilOp:gW,KeepStencilOp:Uh,KeyframeTrack:ja,LOD:Y6,LatheGeometry:G1,Layers:ad,LessCompare:m6,LessDepth:Gz,LessEqualCompare:dR,LessEqualDepth:J0,LessEqualStencilFunc:xW,LessStencilFunc:_W,Light:Zu,LightProbe:F8,Line:bc,Line3:CQ,LineBasicMaterial:hs,LineCurve:RR,LineCurve3:e8,LineDashedMaterial:M8,LineLoop:ER,LineSegments:$a,LinearDisplayP3ColorSpace:D1,LinearEncoding:uR,LinearFilter:hi,LinearInterpolant:UR,LinearMipMapLinearFilter:cW,LinearMipMapNearestFilter:lW,LinearMipmapLinearFilter:wl,LinearMipmapNearestFilter:mS,LinearSRGBColorSpace:Ml,LinearToneMapping:qz,LinearTransfer:r1,Loader:Us,LoaderUtils:Ru,LoadingManager:BR,LoopOnce:l6,LoopPingPong:u6,LoopRepeat:c6,LuminanceAlphaFormat:r6,LuminanceFormat:i6,MOUSE:nW,Material:ur,MaterialLoader:OS,MathUtils:au,Matrix3:bn,Matrix4:en,MaxEquation:gT,Mesh:Tn,MeshBasicMaterial:fi,MeshDepthMaterial:bS,MeshDistanceMaterial:SS,MeshLambertMaterial:S8,MeshMatcapMaterial:w8,MeshNormalMaterial:b8,MeshPhongMaterial:y8,MeshPhysicalMaterial:so,MeshStandardMaterial:Td,MeshToonMaterial:x8,MinEquation:mT,MirroredRepeatWrapping:tm,MixOperation:jz,MultiplyBlending:pT,MultiplyOperation:L1,NearestFilter:zi,NearestMipMapLinearFilter:aW,NearestMipMapNearestFilter:oW,NearestMipmapLinearFilter:Op,NearestMipmapNearestFilter:n1,NeverCompare:p6,NeverDepth:Bz,NeverStencilFunc:vW,NoBlending:dc,NoColorSpace:Ao,NoToneMapping:pl,NormalAnimationBlendMode:vS,NormalBlending:sd,NotEqualCompare:_6,NotEqualDepth:Wz,NotEqualStencilFunc:SW,NumberKeyframeTrack:Cd,Object3D:Gn,ObjectLoader:JZ,ObjectSpaceNormalMap:f6,OctahedronGeometry:FR,OneFactor:Tz,OneMinusConstantAlphaFactor:Oz,OneMinusConstantColorFactor:kz,OneMinusDstAlphaFactor:Iz,OneMinusDstColorFactor:Dz,OneMinusSrcAlphaFactor:_b,OneMinusSrcColorFactor:Pz,OrthographicCamera:Ku,P3Primaries:o1,PCFShadowMap:fS,PCFSoftShadowMap:x0,PMREMGenerator:XT,Path:c1,PerspectiveCamera:Zi,Plane:lu,PlaneGeometry:Va,PlaneHelper:zQ,PointLight:VR,PointLightHelper:IQ,Points:TR,PointsMaterial:AS,PolarGridHelper:FQ,PolyhedronGeometry:Cm,PositionalAudio:oQ,PropertyBinding:Pn,PropertyMixer:B8,QuadraticBezierCurve:IR,QuadraticBezierCurve3:LR,Quaternion:jr,QuaternionKeyframeTrack:Vu,QuaternionLinearInterpolant:P8,RED_GREEN_RGTC2_Format:GT,RED_RGTC1_Format:a6,REVISION:I1,RGBADepthPacking:hR,RGBAFormat:Ps,RGBAIntegerFormat:oR,RGBA_ASTC_10x10_Format:FT,RGBA_ASTC_10x5_Format:LT,RGBA_ASTC_10x6_Format:DT,RGBA_ASTC_10x8_Format:NT,RGBA_ASTC_12x10_Format:kT,RGBA_ASTC_12x12_Format:UT,RGBA_ASTC_4x4_Format:MT,RGBA_ASTC_5x4_Format:AT,RGBA_ASTC_5x5_Format:ET,RGBA_ASTC_6x5_Format:TT,RGBA_ASTC_6x6_Format:CT,RGBA_ASTC_8x5_Format:PT,RGBA_ASTC_8x6_Format:RT,RGBA_ASTC_8x8_Format:IT,RGBA_BPTC_Format:Mx,RGBA_ETC2_EAC_Format:wT,RGBA_PVRTC_2BPPV1_Format:bT,RGBA_PVRTC_4BPPV1_Format:xT,RGBA_S3TC_DXT1_Format:bx,RGBA_S3TC_DXT3_Format:Sx,RGBA_S3TC_DXT5_Format:wx,RGB_BPTC_SIGNED_Format:OT,RGB_BPTC_UNSIGNED_Format:BT,RGB_ETC1_Format:aR,RGB_ETC2_Format:ST,RGB_PVRTC_2BPPV1_Format:yT,RGB_PVRTC_4BPPV1_Format:_T,RGB_S3TC_DXT1_Format:xx,RGFormat:o6,RGIntegerFormat:sR,RawShaderMaterial:_8,Ray:Em,Raycaster:YR,Rec709Primaries:s1,RectAreaLight:D8,RedFormat:s6,RedIntegerFormat:rR,ReinhardToneMapping:Yz,RenderTarget:E6,RepeatWrapping:Bu,ReplaceStencilOp:hW,ReverseSubtractEquation:Az,RingGeometry:DS,SIGNED_RED_GREEN_RGTC2_Format:VT,SIGNED_RED_RGTC1_Format:zT,SRGBColorSpace:_r,SRGBTransfer:ti,Scene:SR,ShaderChunk:un,ShaderLib:Ta,ShaderMaterial:Al,ShadowMaterial:v8,Shape:cd,ShapeGeometry:NS,ShapePath:HQ,ShapeUtils:gl,ShortType:t6,Skeleton:z1,SkeletonHelper:RQ,SkinnedMesh:MR,Source:Jh,Sphere:Ur,SphereGeometry:Od,Spherical:AQ,SphericalHarmonics3:N8,SplineCurve:DR,SpotLight:GR,SpotLightHelper:PQ,Sprite:q6,SpriteMaterial:wR,SrcAlphaFactor:vb,SrcAlphaSaturateFactor:Nz,SrcColorFactor:Cz,StaticCopyUsage:PW,StaticDrawUsage:a1,StaticReadUsage:EW,StereoCamera:nQ,StreamCopyUsage:IW,StreamDrawUsage:AW,StreamReadUsage:CW,StringKeyframeTrack:zd,SubtractEquation:Mz,SubtractiveBlending:fT,TOUCH:iW,TangentSpaceNormalMap:Yu,TetrahedronGeometry:d8,Texture:dr,TextureLoader:I8,TorusGeometry:p8,TorusKnotGeometry:FS,Triangle:ed,TriangleFanDrawMode:yb,TriangleStripDrawMode:cR,TrianglesDrawMode:h6,TubeGeometry:kS,TwoPassDoubleSide:sW,UVMapping:pS,Uint16BufferAttribute:gR,Uint32BufferAttribute:vR,Uint8BufferAttribute:dj,Uint8ClampedBufferAttribute:fj,Uniform:xQ,UniformsGroup:SQ,UniformsLib:kt,UniformsUtils:_R,UnsignedByteType:ml,UnsignedInt248Type:Tu,UnsignedIntType:lc,UnsignedShort4444Type:nR,UnsignedShort5551Type:iR,UnsignedShortType:gS,VSMShadowMap:wa,Vector2:yt,Vector3:Te,Vector4:Wn,VectorKeyframeTrack:Pd,VideoTexture:cZ,WebGL1Renderer:$6,WebGL3DRenderTarget:QW,WebGLArrayRenderTarget:ZW,WebGLCoordinateSystem:Fa,WebGLCubeRenderTarget:N6,WebGLMultipleRenderTargets:JW,WebGLRenderTarget:Ga,WebGLRenderer:bR,WebGLUtils:V6,WebGPUCoordinateSystem:rm,WireframeGeometry:g8,WrapAroundEnding:i1,ZeroCurvatureEnding:Zh,ZeroFactor:Ez,ZeroSlopeEnding:Qh,ZeroStencilOp:uW,_SRGBAFormat:xb,createCanvasElement:M6,sRGBEncoding:Pu},Symbol.toStringTag,{value:"Module"}));var H8={exports:{}},Gd={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Gd.ConcurrentRoot=1;Gd.ContinuousEventPriority=4;Gd.DefaultEventPriority=16;Gd.DiscreteEventPriority=1;Gd.IdleEventPriority=536870912;Gd.LegacyRoot=0;H8.exports=Gd;var Mp=H8.exports;function WQ(i){let e;const t=new Set,n=(c,u)=>{const h=typeof c=="function"?c(e):c;if(h!==e){const d=e;e=u?h:Object.assign({},e,h),t.forEach(f=>f(e,d))}},r=()=>e,s=(c,u=r,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(e);function f(){const p=u(e);if(!h(d,p)){const _=d;c(d=p,_)}}return t.add(f),()=>t.delete(f)},l={setState:n,getState:r,subscribe:(c,u,h)=>u||h?s(c,u,h):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=i(n,r,l),l}const jQ=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),QN=jQ?Re.useEffect:Re.useLayoutEffect;function $8(i){const e=typeof i=="function"?WQ(i):i,t=(n=e.getState,r=Object.is)=>{const[,s]=Re.useReducer(v=>v+1,0),o=e.getState(),a=Re.useRef(o),l=Re.useRef(n),c=Re.useRef(r),u=Re.useRef(!1),h=Re.useRef();h.current===void 0&&(h.current=n(o));let d,f=!1;(a.current!==o||l.current!==n||c.current!==r||u.current)&&(d=n(o),f=!r(h.current,d)),QN(()=>{f&&(h.current=d),a.current=o,l.current=n,c.current=r,u.current=!1});const p=Re.useRef(o);QN(()=>{const v=()=>{try{const b=e.getState(),m=l.current(b);c.current(h.current,m)||(a.current=b,h.current=m,s())}catch{u.current=!0,s()}},g=e.subscribe(v);return e.getState()!==p.current&&v(),g},[]);const _=f?d:h.current;return Re.useDebugValue(_),_};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const r=n.length<=0;return{value:n.shift(),done:r}}}},t}const XQ=i=>typeof i=="object"&&typeof i.then=="function",ey=[];function qQ(i,e,t=(n,r)=>n===r){if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let r=0;r<n;r++)if(!t(i[r],e[r]))return!1;return!0}function YQ(i,e=null,t=!1,n={}){e===null&&(e=[i]);for(const s of ey)if(qQ(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const r={keys:e,equal:n.equal,remove:()=>{const s=ey.indexOf(r);s!==-1&&ey.splice(s,1)},promise:(XQ(i)?i:i(...e)).then(s=>{r.response=s,n.lifespan&&n.lifespan>0&&(r.timeout=setTimeout(r.remove,n.lifespan))}).catch(s=>r.error=s)};if(ey.push(r),!t)throw r.promise}const KQ=(i,e,t)=>YQ(i,e,!1,t);var W8={exports:{}},j8={exports:{}},X8={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(U,z){var O=U.length;U.push(z);e:for(;0<O;){var D=O-1>>>1,B=U[D];if(0<r(B,z))U[D]=z,U[O]=B,O=D;else break e}}function t(U){return U.length===0?null:U[0]}function n(U){if(U.length===0)return null;var z=U[0],O=U.pop();if(O!==z){U[0]=O;e:for(var D=0,B=U.length,W=B>>>1;D<W;){var q=2*(D+1)-1,j=U[q],te=q+1,ne=U[te];if(0>r(j,O))te<B&&0>r(ne,j)?(U[D]=ne,U[te]=O,D=te):(U[D]=j,U[q]=O,D=q);else if(te<B&&0>r(ne,O))U[D]=ne,U[te]=O,D=te;else break e}}return z}function r(U,z){var O=U.sortIndex-z.sortIndex;return O!==0?O:U.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(U){for(var z=t(c);z!==null;){if(z.callback===null)n(c);else if(z.startTime<=U)n(c),z.sortIndex=z.expirationTime,e(l,z);else break;z=t(c)}}function y(U){if(_=!1,m(U),!p)if(t(l)!==null)p=!0,V(A);else{var z=t(c);z!==null&&G(y,z.startTime-U)}}function A(U,z){p=!1,_&&(_=!1,g(T),T=-1),f=!0;var O=d;try{for(m(z),h=t(l);h!==null&&(!(h.expirationTime>z)||U&&!N());){var D=h.callback;if(typeof D=="function"){h.callback=null,d=h.priorityLevel;var B=D(h.expirationTime<=z);z=i.unstable_now(),typeof B=="function"?h.callback=B:h===t(l)&&n(l),m(z)}else n(l);h=t(l)}if(h!==null)var W=!0;else{var q=t(c);q!==null&&G(y,q.startTime-z),W=!1}return W}finally{h=null,d=O,f=!1}}var w=!1,M=null,T=-1,E=5,C=-1;function N(){return!(i.unstable_now()-C<E)}function P(){if(M!==null){var U=i.unstable_now();C=U;var z=!0;try{z=M(!0,U)}finally{z?L():(w=!1,M=null)}}else w=!1}var L;if(typeof b=="function")L=function(){b(P)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,F=R.port2;R.port1.onmessage=P,L=function(){F.postMessage(null)}}else L=function(){v(P,0)};function V(U){M=U,w||(w=!0,L())}function G(U,z){T=v(function(){U(i.unstable_now())},z)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(U){U.callback=null},i.unstable_continueExecution=function(){p||f||(p=!0,V(A))},i.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<U?Math.floor(1e3/U):5},i.unstable_getCurrentPriorityLevel=function(){return d},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(U){switch(d){case 1:case 2:case 3:var z=3;break;default:z=d}var O=d;d=z;try{return U()}finally{d=O}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(U,z){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var O=d;d=U;try{return z()}finally{d=O}},i.unstable_scheduleCallback=function(U,z,O){var D=i.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?D+O:D):O=D,U){case 1:var B=-1;break;case 2:B=250;break;case 5:B=1073741823;break;case 4:B=1e4;break;default:B=5e3}return B=O+B,U={id:u++,callback:z,priorityLevel:U,startTime:O,expirationTime:B,sortIndex:-1},O>D?(U.sortIndex=O,e(c,U),t(l)===null&&U===t(c)&&(_?(g(T),T=-1):_=!0,G(y,O-D))):(U.sortIndex=B,e(l,U),p||f||(p=!0,V(A))),U},i.unstable_shouldYield=N,i.unstable_wrapCallback=function(U){var z=d;return function(){var O=d;d=z;try{return U.apply(this,arguments)}finally{d=O}}}})(X8);j8.exports=X8;var eC=j8.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZQ=function(e){var t={},n=Re,r=eC,s=Object.assign;function o(x){for(var S="https://reactjs.org/docs/error-decoder.html?invariant="+x,I=1;I<arguments.length;I++)S+="&args[]="+encodeURIComponent(arguments[I]);return"Minified React error #"+x+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),p=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),A=Symbol.iterator;function w(x){return x===null||typeof x!="object"?null:(x=A&&x[A]||x["@@iterator"],typeof x=="function"?x:null)}function M(x){if(x==null)return null;if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case v:return"Suspense";case g:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case p:return(x.displayName||"Context")+".Consumer";case f:return(x._context.displayName||"Context")+".Provider";case _:var S=x.render;return x=x.displayName,x||(x=S.displayName||S.name||"",x=x!==""?"ForwardRef("+x+")":"ForwardRef"),x;case b:return S=x.displayName||null,S!==null?S:M(x.type)||"Memo";case m:S=x._payload,x=x._init;try{return M(x(S))}catch{}}return null}function T(x){var S=x.type;switch(x.tag){case 24:return"Cache";case 9:return(S.displayName||"Context")+".Consumer";case 10:return(S._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return x=S.render,x=x.displayName||x.name||"",S.displayName||(x!==""?"ForwardRef("+x+")":"ForwardRef");case 7:return"Fragment";case 5:return S;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return M(S);case 8:return S===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof S=="function")return S.displayName||S.name||null;if(typeof S=="string")return S}return null}function E(x){var S=x,I=x;if(x.alternate)for(;S.return;)S=S.return;else{x=S;do S=x,S.flags&4098&&(I=S.return),x=S.return;while(x)}return S.tag===3?I:null}function C(x){if(E(x)!==x)throw Error(o(188))}function N(x){var S=x.alternate;if(!S){if(S=E(x),S===null)throw Error(o(188));return S!==x?null:x}for(var I=x,k=S;;){var X=I.return;if(X===null)break;var oe=X.alternate;if(oe===null){if(k=X.return,k!==null){I=k;continue}break}if(X.child===oe.child){for(oe=X.child;oe;){if(oe===I)return C(X),x;if(oe===k)return C(X),S;oe=oe.sibling}throw Error(o(188))}if(I.return!==k.return)I=X,k=oe;else{for(var ke=!1,Ke=X.child;Ke;){if(Ke===I){ke=!0,I=X,k=oe;break}if(Ke===k){ke=!0,k=X,I=oe;break}Ke=Ke.sibling}if(!ke){for(Ke=oe.child;Ke;){if(Ke===I){ke=!0,I=oe,k=X;break}if(Ke===k){ke=!0,k=oe,I=X;break}Ke=Ke.sibling}if(!ke)throw Error(o(189))}}if(I.alternate!==k)throw Error(o(190))}if(I.tag!==3)throw Error(o(188));return I.stateNode.current===I?x:S}function P(x){return x=N(x),x!==null?L(x):null}function L(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){var S=L(x);if(S!==null)return S;x=x.sibling}return null}function R(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){if(x.tag!==4){var S=R(x);if(S!==null)return S}x=x.sibling}return null}var F=Array.isArray,V=e.getPublicInstance,G=e.getRootHostContext,U=e.getChildHostContext,z=e.prepareForCommit,O=e.resetAfterCommit,D=e.createInstance,B=e.appendInitialChild,W=e.finalizeInitialChildren,q=e.prepareUpdate,j=e.shouldSetTextContent,te=e.createTextInstance,ne=e.scheduleTimeout,Z=e.cancelTimeout,le=e.noTimeout,re=e.isPrimaryRenderer,se=e.supportsMutation,$=e.supportsPersistence,fe=e.supportsHydration,xe=e.getInstanceFromNode,Ie=e.preparePortalMount,ge=e.getCurrentEventPriority,Oe=e.detachDeletedInstance,Me=e.supportsMicrotasks,Y=e.scheduleMicrotask,Q=e.supportsTestSelectors,de=e.findFiberRoot,Le=e.getBoundingRect,ie=e.getTextContent,K=e.isHiddenSubtree,be=e.matchAccessibilityRole,Ue=e.setFocusIfFocusable,ve=e.setupIntersectionObserver,Ne=e.appendChild,$e=e.appendChildToContainer,Ee=e.commitTextUpdate,Ze=e.commitMount,nt=e.commitUpdate,rt=e.insertBefore,Be=e.insertInContainerBefore,qe=e.removeChild,it=e.removeChildFromContainer,at=e.resetTextContent,ht=e.hideInstance,Qe=e.hideTextInstance,je=e.unhideInstance,ee=e.unhideTextInstance,Ge=e.clearContainer,Ce=e.cloneInstance,De=e.createContainerChildSet,Xe=e.appendChildToContainerChildSet,gt=e.finalizeContainerChildren,_t=e.replaceContainerChildren,Mt=e.cloneHiddenInstance,J=e.cloneHiddenTextInstance,ae=e.canHydrateInstance,ue=e.canHydrateTextInstance,ye=e.canHydrateSuspenseInstance,Se=e.isSuspenseInstancePending,Fe=e.isSuspenseInstanceFallback,ze=e.registerSuspenseInstanceRetry,He=e.getNextHydratableSibling,lt=e.getFirstHydratableChild,mt=e.getFirstHydratableChildWithinContainer,wt=e.getFirstHydratableChildWithinSuspenseInstance,Gt=e.hydrateInstance,Tt=e.hydrateTextInstance,bt=e.hydrateSuspenseInstance,H=e.getNextHydratableInstanceAfterSuspenseInstance,pe=e.commitHydratedContainer,Ae=e.commitHydratedSuspenseInstance,we=e.clearSuspenseBoundary,Pe=e.clearSuspenseBoundaryFromContainer,et=e.shouldDeleteUnhydratedTailInstances,dt=e.didNotMatchHydratedContainerTextInstance,xt=e.didNotMatchHydratedTextInstance,Ye;function We(x){if(Ye===void 0)try{throw Error()}catch(I){var S=I.stack.trim().match(/\n( *(at )?)/);Ye=S&&S[1]||""}return`
`+Ye+x}var st=!1;function ct(x,S){if(!x||st)return"";st=!0;var I=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(S)if(S=function(){throw Error()},Object.defineProperty(S.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(S,[])}catch(Rt){var k=Rt}Reflect.construct(x,[],S)}else{try{S.call()}catch(Rt){k=Rt}x.call(S.prototype)}else{try{throw Error()}catch(Rt){k=Rt}x()}}catch(Rt){if(Rt&&k&&typeof Rt.stack=="string"){for(var X=Rt.stack.split(`
`),oe=k.stack.split(`
`),ke=X.length-1,Ke=oe.length-1;1<=ke&&0<=Ke&&X[ke]!==oe[Ke];)Ke--;for(;1<=ke&&0<=Ke;ke--,Ke--)if(X[ke]!==oe[Ke]){if(ke!==1||Ke!==1)do if(ke--,Ke--,0>Ke||X[ke]!==oe[Ke]){var ft=`
`+X[ke].replace(" at new "," at ");return x.displayName&&ft.includes("<anonymous>")&&(ft=ft.replace("<anonymous>",x.displayName)),ft}while(1<=ke&&0<=Ke);break}}}finally{st=!1,Error.prepareStackTrace=I}return(x=x?x.displayName||x.name:"")?We(x):""}var Nt=Object.prototype.hasOwnProperty,Ft=[],Dt=-1;function Bt(x){return{current:x}}function St(x){0>Dt||(x.current=Ft[Dt],Ft[Dt]=null,Dt--)}function vt(x,S){Dt++,Ft[Dt]=x.current,x.current=S}var Wt={},Lt=Bt(Wt),yn=Bt(!1),bi=Wt;function qn(x,S){var I=x.type.contextTypes;if(!I)return Wt;var k=x.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===S)return k.__reactInternalMemoizedMaskedChildContext;var X={},oe;for(oe in I)X[oe]=S[oe];return k&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=S,x.__reactInternalMemoizedMaskedChildContext=X),X}function Ln(x){return x=x.childContextTypes,x!=null}function tn(){St(yn),St(Lt)}function Yn(x,S,I){if(Lt.current!==Wt)throw Error(o(168));vt(Lt,S),vt(yn,I)}function Ji(x,S,I){var k=x.stateNode;if(S=S.childContextTypes,typeof k.getChildContext!="function")return I;k=k.getChildContext();for(var X in k)if(!(X in S))throw Error(o(108,T(x)||"Unknown",X));return s({},I,k)}function dn(x){return x=(x=x.stateNode)&&x.__reactInternalMemoizedMergedChildContext||Wt,bi=Lt.current,vt(Lt,x),vt(yn,yn.current),!0}function Qn(x,S,I){var k=x.stateNode;if(!k)throw Error(o(169));I?(x=Ji(x,S,bi),k.__reactInternalMemoizedMergedChildContext=x,St(yn),St(Lt),vt(Lt,x)):St(yn),vt(yn,I)}var er=Math.clz32?Math.clz32:qa,Mr=Math.log,oo=Math.LN2;function qa(x){return x>>>=0,x===0?32:31-(Mr(x)/oo|0)|0}var ds=64,fs=4194304;function ps(x){switch(x&-x){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return x&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return x}}function ao(x,S){var I=x.pendingLanes;if(I===0)return 0;var k=0,X=x.suspendedLanes,oe=x.pingedLanes,ke=I&268435455;if(ke!==0){var Ke=ke&~X;Ke!==0?k=ps(Ke):(oe&=ke,oe!==0&&(k=ps(oe)))}else ke=I&~X,ke!==0?k=ps(ke):oe!==0&&(k=ps(oe));if(k===0)return 0;if(S!==0&&S!==k&&!(S&X)&&(X=k&-k,oe=S&-S,X>=oe||X===16&&(oe&4194240)!==0))return S;if(k&4&&(k|=I&16),S=x.entangledLanes,S!==0)for(x=x.entanglements,S&=k;0<S;)I=31-er(S),X=1<<I,k|=x[I],S&=~X;return k}function Ya(x,S){switch(x){case 1:case 2:case 4:return S+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oa(x,S){for(var I=x.suspendedLanes,k=x.pingedLanes,X=x.expirationTimes,oe=x.pendingLanes;0<oe;){var ke=31-er(oe),Ke=1<<ke,ft=X[ke];ft===-1?(!(Ke&I)||Ke&k)&&(X[ke]=Ya(Ke,S)):ft<=S&&(x.expiredLanes|=Ke),oe&=~Ke}}function Ar(x){return x=x.pendingLanes&-1073741825,x!==0?x:x&1073741824?1073741824:0}function aa(x){for(var S=[],I=0;31>I;I++)S.push(x);return S}function lo(x,S,I){x.pendingLanes|=S,S!==536870912&&(x.suspendedLanes=0,x.pingedLanes=0),x=x.eventTimes,S=31-er(S),x[S]=I}function fr(x,S){var I=x.pendingLanes&~S;x.pendingLanes=S,x.suspendedLanes=0,x.pingedLanes=0,x.expiredLanes&=S,x.mutableReadLanes&=S,x.entangledLanes&=S,S=x.entanglements;var k=x.eventTimes;for(x=x.expirationTimes;0<I;){var X=31-er(I),oe=1<<X;S[X]=0,k[X]=-1,x[X]=-1,I&=~oe}}function Yr(x,S){var I=x.entangledLanes|=S;for(x=x.entanglements;I;){var k=31-er(I),X=1<<k;X&S|x[k]&S&&(x[k]|=S),I&=~X}}var cn=0;function Pl(x){return x&=-x,1<x?4<x?x&268435455?16:536870912:4:1}var Rl=r.unstable_scheduleCallback,jd=r.unstable_cancelCallback,Gm=r.unstable_shouldYield,iv=r.unstable_requestPaint,Si=r.unstable_now,th=r.unstable_ImmediatePriority,rv=r.unstable_UserBlockingPriority,ms=r.unstable_NormalPriority,Vm=r.unstable_IdlePriority,nh=null,co=null;function Hm(x){if(co&&typeof co.onCommitFiberRoot=="function")try{co.onCommitFiberRoot(nh,x,void 0,(x.current.flags&128)===128)}catch{}}function sv(x,S){return x===S&&(x!==0||1/x===1/S)||x!==x&&S!==S}var uo=typeof Object.is=="function"?Object.is:sv,gs=null,Ka=!1,ko=!1;function $m(x){gs===null?gs=[x]:gs.push(x)}function Wm(x){Ka=!0,$m(x)}function Bs(){if(!ko&&gs!==null){ko=!0;var x=0,S=cn;try{var I=gs;for(cn=1;x<I.length;x++){var k=I[x];do k=k(!0);while(k!==null)}gs=null,Ka=!1}catch(X){throw gs!==null&&(gs=gs.slice(x+1)),Rl(th,Bs),X}finally{cn=S,ko=!1}}return null}var ih=a.ReactCurrentBatchConfig;function rh(x,S){if(uo(x,S))return!0;if(typeof x!="object"||x===null||typeof S!="object"||S===null)return!1;var I=Object.keys(x),k=Object.keys(S);if(I.length!==k.length)return!1;for(k=0;k<I.length;k++){var X=I[k];if(!Nt.call(S,X)||!uo(x[X],S[X]))return!1}return!0}function sh(x){switch(x.tag){case 5:return We(x.type);case 16:return We("Lazy");case 13:return We("Suspense");case 19:return We("SuspenseList");case 0:case 2:case 15:return x=ct(x.type,!1),x;case 11:return x=ct(x.type.render,!1),x;case 1:return x=ct(x.type,!0),x;default:return""}}function vs(x,S){if(x&&x.defaultProps){S=s({},S),x=x.defaultProps;for(var I in x)S[I]===void 0&&(S[I]=x[I]);return S}return S}var Er=Bt(null),Xd=null,la=null,Lc=null;function qd(){Lc=la=Xd=null}function ov(x,S,I){re?(vt(Er,S._currentValue),S._currentValue=I):(vt(Er,S._currentValue2),S._currentValue2=I)}function Tr(x){var S=Er.current;St(Er),re?x._currentValue=S:x._currentValue2=S}function _s(x,S,I){for(;x!==null;){var k=x.alternate;if((x.childLanes&S)!==S?(x.childLanes|=S,k!==null&&(k.childLanes|=S)):k!==null&&(k.childLanes&S)!==S&&(k.childLanes|=S),x===I)break;x=x.return}}function Hi(x,S){Xd=x,Lc=la=null,x=x.dependencies,x!==null&&x.firstContext!==null&&(x.lanes&S&&(mo=!0),x.firstContext=null)}function $i(x){var S=re?x._currentValue:x._currentValue2;if(Lc!==x)if(x={context:x,memoizedValue:S,next:null},la===null){if(Xd===null)throw Error(o(308));la=x,Xd.dependencies={lanes:0,firstContext:x}}else la=la.next=x;return S}var ho=null,Dc=!1;function u2(x){x.updateQueue={baseState:x.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function G3(x,S){x=x.updateQueue,S.updateQueue===x&&(S.updateQueue={baseState:x.baseState,firstBaseUpdate:x.firstBaseUpdate,lastBaseUpdate:x.lastBaseUpdate,shared:x.shared,effects:x.effects})}function Il(x,S){return{eventTime:x,lane:S,tag:0,payload:null,callback:null,next:null}}function Nc(x,S){var I=x.updateQueue;I!==null&&(I=I.shared,tr!==null&&x.mode&1&&!(xn&2)?(x=I.interleaved,x===null?(S.next=S,ho===null?ho=[I]:ho.push(I)):(S.next=x.next,x.next=S),I.interleaved=S):(x=I.pending,x===null?S.next=S:(S.next=x.next,x.next=S),I.pending=S))}function av(x,S,I){if(S=S.updateQueue,S!==null&&(S=S.shared,(I&4194240)!==0)){var k=S.lanes;k&=x.pendingLanes,I|=k,S.lanes=I,Yr(x,I)}}function V3(x,S){var I=x.updateQueue,k=x.alternate;if(k!==null&&(k=k.updateQueue,I===k)){var X=null,oe=null;if(I=I.firstBaseUpdate,I!==null){do{var ke={eventTime:I.eventTime,lane:I.lane,tag:I.tag,payload:I.payload,callback:I.callback,next:null};oe===null?X=oe=ke:oe=oe.next=ke,I=I.next}while(I!==null);oe===null?X=oe=S:oe=oe.next=S}else X=oe=S;I={baseState:k.baseState,firstBaseUpdate:X,lastBaseUpdate:oe,shared:k.shared,effects:k.effects},x.updateQueue=I;return}x=I.lastBaseUpdate,x===null?I.firstBaseUpdate=S:x.next=S,I.lastBaseUpdate=S}function lv(x,S,I,k){var X=x.updateQueue;Dc=!1;var oe=X.firstBaseUpdate,ke=X.lastBaseUpdate,Ke=X.shared.pending;if(Ke!==null){X.shared.pending=null;var ft=Ke,Rt=ft.next;ft.next=null,ke===null?oe=Rt:ke.next=Rt,ke=ft;var Ht=x.alternate;Ht!==null&&(Ht=Ht.updateQueue,Ke=Ht.lastBaseUpdate,Ke!==ke&&(Ke===null?Ht.firstBaseUpdate=Rt:Ke.next=Rt,Ht.lastBaseUpdate=ft))}if(oe!==null){var an=X.baseState;ke=0,Ht=Rt=ft=null,Ke=oe;do{var Jt=Ke.lane,Jn=Ke.eventTime;if((k&Jt)===Jt){Ht!==null&&(Ht=Ht.next={eventTime:Jn,lane:0,tag:Ke.tag,payload:Ke.payload,callback:Ke.callback,next:null});e:{var qt=x,Jr=Ke;switch(Jt=S,Jn=I,Jr.tag){case 1:if(qt=Jr.payload,typeof qt=="function"){an=qt.call(Jn,an,Jt);break e}an=qt;break e;case 3:qt.flags=qt.flags&-65537|128;case 0:if(qt=Jr.payload,Jt=typeof qt=="function"?qt.call(Jn,an,Jt):qt,Jt==null)break e;an=s({},an,Jt);break e;case 2:Dc=!0}}Ke.callback!==null&&Ke.lane!==0&&(x.flags|=64,Jt=X.effects,Jt===null?X.effects=[Ke]:Jt.push(Ke))}else Jn={eventTime:Jn,lane:Jt,tag:Ke.tag,payload:Ke.payload,callback:Ke.callback,next:null},Ht===null?(Rt=Ht=Jn,ft=an):Ht=Ht.next=Jn,ke|=Jt;if(Ke=Ke.next,Ke===null){if(Ke=X.shared.pending,Ke===null)break;Jt=Ke,Ke=Jt.next,Jt.next=null,X.lastBaseUpdate=Jt,X.shared.pending=null}}while(!0);if(Ht===null&&(ft=an),X.baseState=ft,X.firstBaseUpdate=Rt,X.lastBaseUpdate=Ht,S=X.shared.interleaved,S!==null){X=S;do ke|=X.lane,X=X.next;while(X!==S)}else oe===null&&(X.shared.lanes=0);rf|=ke,x.lanes=ke,x.memoizedState=an}}function H3(x,S,I){if(x=S.effects,S.effects=null,x!==null)for(S=0;S<x.length;S++){var k=x[S],X=k.callback;if(X!==null){if(k.callback=null,k=I,typeof X!="function")throw Error(o(191,X));X.call(k)}}}var $3=new n.Component().refs;function h2(x,S,I,k){S=x.memoizedState,I=I(k,S),I=I==null?S:s({},S,I),x.memoizedState=I,x.lanes===0&&(x.updateQueue.baseState=I)}var cv={isMounted:function(x){return(x=x._reactInternals)?E(x)===x:!1},enqueueSetState:function(x,S,I){x=x._reactInternals;var k=xs(),X=Uc(x),oe=Il(k,X);oe.payload=S,I!=null&&(oe.callback=I),Nc(x,oe),S=Go(x,X,k),S!==null&&av(S,x,X)},enqueueReplaceState:function(x,S,I){x=x._reactInternals;var k=xs(),X=Uc(x),oe=Il(k,X);oe.tag=1,oe.payload=S,I!=null&&(oe.callback=I),Nc(x,oe),S=Go(x,X,k),S!==null&&av(S,x,X)},enqueueForceUpdate:function(x,S){x=x._reactInternals;var I=xs(),k=Uc(x),X=Il(I,k);X.tag=2,S!=null&&(X.callback=S),Nc(x,X),S=Go(x,k,I),S!==null&&av(S,x,k)}};function W3(x,S,I,k,X,oe,ke){return x=x.stateNode,typeof x.shouldComponentUpdate=="function"?x.shouldComponentUpdate(k,oe,ke):S.prototype&&S.prototype.isPureReactComponent?!rh(I,k)||!rh(X,oe):!0}function j3(x,S,I){var k=!1,X=Wt,oe=S.contextType;return typeof oe=="object"&&oe!==null?oe=$i(oe):(X=Ln(S)?bi:Lt.current,k=S.contextTypes,oe=(k=k!=null)?qn(x,X):Wt),S=new S(I,oe),x.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=cv,x.stateNode=S,S._reactInternals=x,k&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=X,x.__reactInternalMemoizedMaskedChildContext=oe),S}function X3(x,S,I,k){x=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(I,k),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(I,k),S.state!==x&&cv.enqueueReplaceState(S,S.state,null)}function d2(x,S,I,k){var X=x.stateNode;X.props=I,X.state=x.memoizedState,X.refs=$3,u2(x);var oe=S.contextType;typeof oe=="object"&&oe!==null?X.context=$i(oe):(oe=Ln(S)?bi:Lt.current,X.context=qn(x,oe)),X.state=x.memoizedState,oe=S.getDerivedStateFromProps,typeof oe=="function"&&(h2(x,S,oe,I),X.state=x.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof X.getSnapshotBeforeUpdate=="function"||typeof X.UNSAFE_componentWillMount!="function"&&typeof X.componentWillMount!="function"||(S=X.state,typeof X.componentWillMount=="function"&&X.componentWillMount(),typeof X.UNSAFE_componentWillMount=="function"&&X.UNSAFE_componentWillMount(),S!==X.state&&cv.enqueueReplaceState(X,X.state,null),lv(x,I,X,k),X.state=x.memoizedState),typeof X.componentDidMount=="function"&&(x.flags|=4194308)}var Yd=[],Kd=0,uv=null,hv=0,Uo=[],Oo=0,oh=null,Ll=1,Dl="";function ah(x,S){Yd[Kd++]=hv,Yd[Kd++]=uv,uv=x,hv=S}function q3(x,S,I){Uo[Oo++]=Ll,Uo[Oo++]=Dl,Uo[Oo++]=oh,oh=x;var k=Ll;x=Dl;var X=32-er(k)-1;k&=~(1<<X),I+=1;var oe=32-er(S)+X;if(30<oe){var ke=X-X%5;oe=(k&(1<<ke)-1).toString(32),k>>=ke,X-=ke,Ll=1<<32-er(S)+X|I<<X|k,Dl=oe+x}else Ll=1<<oe|I<<X|k,Dl=x}function f2(x){x.return!==null&&(ah(x,1),q3(x,1,0))}function p2(x){for(;x===uv;)uv=Yd[--Kd],Yd[Kd]=null,hv=Yd[--Kd],Yd[Kd]=null;for(;x===oh;)oh=Uo[--Oo],Uo[Oo]=null,Dl=Uo[--Oo],Uo[Oo]=null,Ll=Uo[--Oo],Uo[Oo]=null}var fo=null,po=null,pi=!1,jm=!1,ca=null;function Y3(x,S){var I=Vo(5,null,null,0);I.elementType="DELETED",I.stateNode=S,I.return=x,S=x.deletions,S===null?(x.deletions=[I],x.flags|=16):S.push(I)}function K3(x,S){switch(x.tag){case 5:return S=ae(S,x.type,x.pendingProps),S!==null?(x.stateNode=S,fo=x,po=lt(S),!0):!1;case 6:return S=ue(S,x.pendingProps),S!==null?(x.stateNode=S,fo=x,po=null,!0):!1;case 13:if(S=ye(S),S!==null){var I=oh!==null?{id:Ll,overflow:Dl}:null;return x.memoizedState={dehydrated:S,treeContext:I,retryLane:1073741824},I=Vo(18,null,null,0),I.stateNode=S,I.return=x,x.child=I,fo=x,po=null,!0}return!1;default:return!1}}function m2(x){return(x.mode&1)!==0&&(x.flags&128)===0}function g2(x){if(pi){var S=po;if(S){var I=S;if(!K3(x,S)){if(m2(x))throw Error(o(418));S=He(I);var k=fo;S&&K3(x,S)?Y3(k,I):(x.flags=x.flags&-4097|2,pi=!1,fo=x)}}else{if(m2(x))throw Error(o(418));x.flags=x.flags&-4097|2,pi=!1,fo=x}}}function Z3(x){for(x=x.return;x!==null&&x.tag!==5&&x.tag!==3&&x.tag!==13;)x=x.return;fo=x}function Xm(x){if(!fe||x!==fo)return!1;if(!pi)return Z3(x),pi=!0,!1;if(x.tag!==3&&(x.tag!==5||et(x.type)&&!j(x.type,x.memoizedProps))){var S=po;if(S){if(m2(x)){for(x=po;x;)x=He(x);throw Error(o(418))}for(;S;)Y3(x,S),S=He(S)}}if(Z3(x),x.tag===13){if(!fe)throw Error(o(316));if(x=x.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(o(317));po=H(x)}else po=fo?He(x.stateNode):null;return!0}function Zd(){fe&&(po=fo=null,jm=pi=!1)}function v2(x){ca===null?ca=[x]:ca.push(x)}function qm(x,S,I){if(x=I.ref,x!==null&&typeof x!="function"&&typeof x!="object"){if(I._owner){if(I=I._owner,I){if(I.tag!==1)throw Error(o(309));var k=I.stateNode}if(!k)throw Error(o(147,x));var X=k,oe=""+x;return S!==null&&S.ref!==null&&typeof S.ref=="function"&&S.ref._stringRef===oe?S.ref:(S=function(ke){var Ke=X.refs;Ke===$3&&(Ke=X.refs={}),ke===null?delete Ke[oe]:Ke[oe]=ke},S._stringRef=oe,S)}if(typeof x!="string")throw Error(o(284));if(!I._owner)throw Error(o(290,x))}return x}function dv(x,S){throw x=Object.prototype.toString.call(S),Error(o(31,x==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":x))}function Q3(x){var S=x._init;return S(x._payload)}function J3(x){function S(ot,Je){if(x){var ut=ot.deletions;ut===null?(ot.deletions=[Je],ot.flags|=16):ut.push(Je)}}function I(ot,Je){if(!x)return null;for(;Je!==null;)S(ot,Je),Je=Je.sibling;return null}function k(ot,Je){for(ot=new Map;Je!==null;)Je.key!==null?ot.set(Je.key,Je):ot.set(Je.index,Je),Je=Je.sibling;return ot}function X(ot,Je){return ot=Bc(ot,Je),ot.index=0,ot.sibling=null,ot}function oe(ot,Je,ut){return ot.index=ut,x?(ut=ot.alternate,ut!==null?(ut=ut.index,ut<Je?(ot.flags|=2,Je):ut):(ot.flags|=2,Je)):(ot.flags|=1048576,Je)}function ke(ot){return x&&ot.alternate===null&&(ot.flags|=2),ot}function Ke(ot,Je,ut,zt){return Je===null||Je.tag!==6?(Je=ew(ut,ot.mode,zt),Je.return=ot,Je):(Je=X(Je,ut),Je.return=ot,Je)}function ft(ot,Je,ut,zt){var Xt=ut.type;return Xt===u?Ht(ot,Je,ut.props.children,zt,ut.key):Je!==null&&(Je.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===m&&Q3(Xt)===Je.type)?(zt=X(Je,ut.props),zt.ref=qm(ot,Je,ut),zt.return=ot,zt):(zt=Hv(ut.type,ut.key,ut.props,null,ot.mode,zt),zt.ref=qm(ot,Je,ut),zt.return=ot,zt)}function Rt(ot,Je,ut,zt){return Je===null||Je.tag!==4||Je.stateNode.containerInfo!==ut.containerInfo||Je.stateNode.implementation!==ut.implementation?(Je=tw(ut,ot.mode,zt),Je.return=ot,Je):(Je=X(Je,ut.children||[]),Je.return=ot,Je)}function Ht(ot,Je,ut,zt,Xt){return Je===null||Je.tag!==7?(Je=ph(ut,ot.mode,zt,Xt),Je.return=ot,Je):(Je=X(Je,ut),Je.return=ot,Je)}function an(ot,Je,ut){if(typeof Je=="string"&&Je!==""||typeof Je=="number")return Je=ew(""+Je,ot.mode,ut),Je.return=ot,Je;if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case l:return ut=Hv(Je.type,Je.key,Je.props,null,ot.mode,ut),ut.ref=qm(ot,null,Je),ut.return=ot,ut;case c:return Je=tw(Je,ot.mode,ut),Je.return=ot,Je;case m:var zt=Je._init;return an(ot,zt(Je._payload),ut)}if(F(Je)||w(Je))return Je=ph(Je,ot.mode,ut,null),Je.return=ot,Je;dv(ot,Je)}return null}function Jt(ot,Je,ut,zt){var Xt=Je!==null?Je.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number")return Xt!==null?null:Ke(ot,Je,""+ut,zt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case l:return ut.key===Xt?ft(ot,Je,ut,zt):null;case c:return ut.key===Xt?Rt(ot,Je,ut,zt):null;case m:return Xt=ut._init,Jt(ot,Je,Xt(ut._payload),zt)}if(F(ut)||w(ut))return Xt!==null?null:Ht(ot,Je,ut,zt,null);dv(ot,ut)}return null}function Jn(ot,Je,ut,zt,Xt){if(typeof zt=="string"&&zt!==""||typeof zt=="number")return ot=ot.get(ut)||null,Ke(Je,ot,""+zt,Xt);if(typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case l:return ot=ot.get(zt.key===null?ut:zt.key)||null,ft(Je,ot,zt,Xt);case c:return ot=ot.get(zt.key===null?ut:zt.key)||null,Rt(Je,ot,zt,Xt);case m:var gn=zt._init;return Jn(ot,Je,ut,gn(zt._payload),Xt)}if(F(zt)||w(zt))return ot=ot.get(ut)||null,Ht(Je,ot,zt,Xt,null);dv(Je,zt)}return null}function qt(ot,Je,ut,zt){for(var Xt=null,gn=null,ln=Je,Dn=Je=0,Pr=null;ln!==null&&Dn<ut.length;Dn++){ln.index>Dn?(Pr=ln,ln=null):Pr=ln.sibling;var Nn=Jt(ot,ln,ut[Dn],zt);if(Nn===null){ln===null&&(ln=Pr);break}x&&ln&&Nn.alternate===null&&S(ot,ln),Je=oe(Nn,Je,Dn),gn===null?Xt=Nn:gn.sibling=Nn,gn=Nn,ln=Pr}if(Dn===ut.length)return I(ot,ln),pi&&ah(ot,Dn),Xt;if(ln===null){for(;Dn<ut.length;Dn++)ln=an(ot,ut[Dn],zt),ln!==null&&(Je=oe(ln,Je,Dn),gn===null?Xt=ln:gn.sibling=ln,gn=ln);return pi&&ah(ot,Dn),Xt}for(ln=k(ot,ln);Dn<ut.length;Dn++)Pr=Jn(ln,ot,Dn,ut[Dn],zt),Pr!==null&&(x&&Pr.alternate!==null&&ln.delete(Pr.key===null?Dn:Pr.key),Je=oe(Pr,Je,Dn),gn===null?Xt=Pr:gn.sibling=Pr,gn=Pr);return x&&ln.forEach(function(zc){return S(ot,zc)}),pi&&ah(ot,Dn),Xt}function Jr(ot,Je,ut,zt){var Xt=w(ut);if(typeof Xt!="function")throw Error(o(150));if(ut=Xt.call(ut),ut==null)throw Error(o(151));for(var gn=Xt=null,ln=Je,Dn=Je=0,Pr=null,Nn=ut.next();ln!==null&&!Nn.done;Dn++,Nn=ut.next()){ln.index>Dn?(Pr=ln,ln=null):Pr=ln.sibling;var zc=Jt(ot,ln,Nn.value,zt);if(zc===null){ln===null&&(ln=Pr);break}x&&ln&&zc.alternate===null&&S(ot,ln),Je=oe(zc,Je,Dn),gn===null?Xt=zc:gn.sibling=zc,gn=zc,ln=Pr}if(Nn.done)return I(ot,ln),pi&&ah(ot,Dn),Xt;if(ln===null){for(;!Nn.done;Dn++,Nn=ut.next())Nn=an(ot,Nn.value,zt),Nn!==null&&(Je=oe(Nn,Je,Dn),gn===null?Xt=Nn:gn.sibling=Nn,gn=Nn);return pi&&ah(ot,Dn),Xt}for(ln=k(ot,ln);!Nn.done;Dn++,Nn=ut.next())Nn=Jn(ln,ot,Dn,Nn.value,zt),Nn!==null&&(x&&Nn.alternate!==null&&ln.delete(Nn.key===null?Dn:Nn.key),Je=oe(Nn,Je,Dn),gn===null?Xt=Nn:gn.sibling=Nn,gn=Nn);return x&&ln.forEach(function(C$){return S(ot,C$)}),pi&&ah(ot,Dn),Xt}function Ho(ot,Je,ut,zt){if(typeof ut=="object"&&ut!==null&&ut.type===u&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case l:e:{for(var Xt=ut.key,gn=Je;gn!==null;){if(gn.key===Xt){if(Xt=ut.type,Xt===u){if(gn.tag===7){I(ot,gn.sibling),Je=X(gn,ut.props.children),Je.return=ot,ot=Je;break e}}else if(gn.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===m&&Q3(Xt)===gn.type){I(ot,gn.sibling),Je=X(gn,ut.props),Je.ref=qm(ot,gn,ut),Je.return=ot,ot=Je;break e}I(ot,gn);break}else S(ot,gn);gn=gn.sibling}ut.type===u?(Je=ph(ut.props.children,ot.mode,zt,ut.key),Je.return=ot,ot=Je):(zt=Hv(ut.type,ut.key,ut.props,null,ot.mode,zt),zt.ref=qm(ot,Je,ut),zt.return=ot,ot=zt)}return ke(ot);case c:e:{for(gn=ut.key;Je!==null;){if(Je.key===gn)if(Je.tag===4&&Je.stateNode.containerInfo===ut.containerInfo&&Je.stateNode.implementation===ut.implementation){I(ot,Je.sibling),Je=X(Je,ut.children||[]),Je.return=ot,ot=Je;break e}else{I(ot,Je);break}else S(ot,Je);Je=Je.sibling}Je=tw(ut,ot.mode,zt),Je.return=ot,ot=Je}return ke(ot);case m:return gn=ut._init,Ho(ot,Je,gn(ut._payload),zt)}if(F(ut))return qt(ot,Je,ut,zt);if(w(ut))return Jr(ot,Je,ut,zt);dv(ot,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"?(ut=""+ut,Je!==null&&Je.tag===6?(I(ot,Je.sibling),Je=X(Je,ut),Je.return=ot,ot=Je):(I(ot,Je),Je=ew(ut,ot.mode,zt),Je.return=ot,ot=Je),ke(ot)):I(ot,Je)}return Ho}var Qd=J3(!0),eI=J3(!1),Ym={},Bo=Bt(Ym),Km=Bt(Ym),Jd=Bt(Ym);function Za(x){if(x===Ym)throw Error(o(174));return x}function _2(x,S){vt(Jd,S),vt(Km,x),vt(Bo,Ym),x=G(S),St(Bo),vt(Bo,x)}function ef(){St(Bo),St(Km),St(Jd)}function tI(x){var S=Za(Jd.current),I=Za(Bo.current);S=U(I,x.type,S),I!==S&&(vt(Km,x),vt(Bo,S))}function y2(x){Km.current===x&&(St(Bo),St(Km))}var wi=Bt(0);function fv(x){for(var S=x;S!==null;){if(S.tag===13){var I=S.memoizedState;if(I!==null&&(I=I.dehydrated,I===null||Se(I)||Fe(I)))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if(S.flags&128)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===x)break;for(;S.sibling===null;){if(S.return===null||S.return===x)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}var x2=[];function b2(){for(var x=0;x<x2.length;x++){var S=x2[x];re?S._workInProgressVersionPrimary=null:S._workInProgressVersionSecondary=null}x2.length=0}var pv=a.ReactCurrentDispatcher,zo=a.ReactCurrentBatchConfig,tf=0,Ni=null,Kr=null,Cr=null,mv=!1,Zm=!1,Qm=0,JH=0;function Zr(){throw Error(o(321))}function S2(x,S){if(S===null)return!1;for(var I=0;I<S.length&&I<x.length;I++)if(!uo(x[I],S[I]))return!1;return!0}function w2(x,S,I,k,X,oe){if(tf=oe,Ni=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,pv.current=x===null||x.memoizedState===null?i$:r$,x=I(k,X),Zm){oe=0;do{if(Zm=!1,Qm=0,25<=oe)throw Error(o(301));oe+=1,Cr=Kr=null,S.updateQueue=null,pv.current=s$,x=I(k,X)}while(Zm)}if(pv.current=xv,S=Kr!==null&&Kr.next!==null,tf=0,Cr=Kr=Ni=null,mv=!1,S)throw Error(o(300));return x}function M2(){var x=Qm!==0;return Qm=0,x}function Nl(){var x={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Cr===null?Ni.memoizedState=Cr=x:Cr=Cr.next=x,Cr}function Qa(){if(Kr===null){var x=Ni.alternate;x=x!==null?x.memoizedState:null}else x=Kr.next;var S=Cr===null?Ni.memoizedState:Cr.next;if(S!==null)Cr=S,Kr=x;else{if(x===null)throw Error(o(310));Kr=x,x={memoizedState:Kr.memoizedState,baseState:Kr.baseState,baseQueue:Kr.baseQueue,queue:Kr.queue,next:null},Cr===null?Ni.memoizedState=Cr=x:Cr=Cr.next=x}return Cr}function lh(x,S){return typeof S=="function"?S(x):S}function gv(x){var S=Qa(),I=S.queue;if(I===null)throw Error(o(311));I.lastRenderedReducer=x;var k=Kr,X=k.baseQueue,oe=I.pending;if(oe!==null){if(X!==null){var ke=X.next;X.next=oe.next,oe.next=ke}k.baseQueue=X=oe,I.pending=null}if(X!==null){oe=X.next,k=k.baseState;var Ke=ke=null,ft=null,Rt=oe;do{var Ht=Rt.lane;if((tf&Ht)===Ht)ft!==null&&(ft=ft.next={lane:0,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null}),k=Rt.hasEagerState?Rt.eagerState:x(k,Rt.action);else{var an={lane:Ht,action:Rt.action,hasEagerState:Rt.hasEagerState,eagerState:Rt.eagerState,next:null};ft===null?(Ke=ft=an,ke=k):ft=ft.next=an,Ni.lanes|=Ht,rf|=Ht}Rt=Rt.next}while(Rt!==null&&Rt!==oe);ft===null?ke=k:ft.next=Ke,uo(k,S.memoizedState)||(mo=!0),S.memoizedState=k,S.baseState=ke,S.baseQueue=ft,I.lastRenderedState=k}if(x=I.interleaved,x!==null){X=x;do oe=X.lane,Ni.lanes|=oe,rf|=oe,X=X.next;while(X!==x)}else X===null&&(I.lanes=0);return[S.memoizedState,I.dispatch]}function vv(x){var S=Qa(),I=S.queue;if(I===null)throw Error(o(311));I.lastRenderedReducer=x;var k=I.dispatch,X=I.pending,oe=S.memoizedState;if(X!==null){I.pending=null;var ke=X=X.next;do oe=x(oe,ke.action),ke=ke.next;while(ke!==X);uo(oe,S.memoizedState)||(mo=!0),S.memoizedState=oe,S.baseQueue===null&&(S.baseState=oe),I.lastRenderedState=oe}return[oe,k]}function nI(){}function iI(x,S){var I=Ni,k=Qa(),X=S(),oe=!uo(k.memoizedState,X);if(oe&&(k.memoizedState=X,mo=!0),k=k.queue,eg(oI.bind(null,I,k,x),[x]),k.getSnapshot!==S||oe||Cr!==null&&Cr.memoizedState.tag&1){if(I.flags|=2048,Jm(9,sI.bind(null,I,k,X,S),void 0,null),tr===null)throw Error(o(349));tf&30||rI(I,S,X)}return X}function rI(x,S,I){x.flags|=16384,x={getSnapshot:S,value:I},S=Ni.updateQueue,S===null?(S={lastEffect:null,stores:null},Ni.updateQueue=S,S.stores=[x]):(I=S.stores,I===null?S.stores=[x]:I.push(x))}function sI(x,S,I,k){S.value=I,S.getSnapshot=k,aI(S)&&Go(x,1,-1)}function oI(x,S,I){return I(function(){aI(S)&&Go(x,1,-1)})}function aI(x){var S=x.getSnapshot;x=x.value;try{var I=S();return!uo(x,I)}catch{return!0}}function A2(x){var S=Nl();return typeof x=="function"&&(x=x()),S.memoizedState=S.baseState=x,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lh,lastRenderedState:x},S.queue=x,x=x.dispatch=n$.bind(null,Ni,x),[S.memoizedState,x]}function Jm(x,S,I,k){return x={tag:x,create:S,destroy:I,deps:k,next:null},S=Ni.updateQueue,S===null?(S={lastEffect:null,stores:null},Ni.updateQueue=S,S.lastEffect=x.next=x):(I=S.lastEffect,I===null?S.lastEffect=x.next=x:(k=I.next,I.next=x,x.next=k,S.lastEffect=x)),x}function lI(){return Qa().memoizedState}function _v(x,S,I,k){var X=Nl();Ni.flags|=x,X.memoizedState=Jm(1|S,I,void 0,k===void 0?null:k)}function yv(x,S,I,k){var X=Qa();k=k===void 0?null:k;var oe=void 0;if(Kr!==null){var ke=Kr.memoizedState;if(oe=ke.destroy,k!==null&&S2(k,ke.deps)){X.memoizedState=Jm(S,I,oe,k);return}}Ni.flags|=x,X.memoizedState=Jm(1|S,I,oe,k)}function E2(x,S){return _v(8390656,8,x,S)}function eg(x,S){return yv(2048,8,x,S)}function cI(x,S){return yv(4,2,x,S)}function uI(x,S){return yv(4,4,x,S)}function hI(x,S){if(typeof S=="function")return x=x(),S(x),function(){S(null)};if(S!=null)return x=x(),S.current=x,function(){S.current=null}}function dI(x,S,I){return I=I!=null?I.concat([x]):null,yv(4,4,hI.bind(null,S,x),I)}function T2(){}function fI(x,S){var I=Qa();S=S===void 0?null:S;var k=I.memoizedState;return k!==null&&S!==null&&S2(S,k[1])?k[0]:(I.memoizedState=[x,S],x)}function pI(x,S){var I=Qa();S=S===void 0?null:S;var k=I.memoizedState;return k!==null&&S!==null&&S2(S,k[1])?k[0]:(x=x(),I.memoizedState=[x,S],x)}function e$(x,S){var I=cn;cn=I!==0&&4>I?I:4,x(!0);var k=zo.transition;zo.transition={};try{x(!1),S()}finally{cn=I,zo.transition=k}}function mI(){return Qa().memoizedState}function t$(x,S,I){var k=Uc(x);I={lane:k,action:I,hasEagerState:!1,eagerState:null,next:null},gI(x)?vI(S,I):(_I(x,S,I),I=xs(),x=Go(x,k,I),x!==null&&yI(x,S,k))}function n$(x,S,I){var k=Uc(x),X={lane:k,action:I,hasEagerState:!1,eagerState:null,next:null};if(gI(x))vI(S,X);else{_I(x,S,X);var oe=x.alternate;if(x.lanes===0&&(oe===null||oe.lanes===0)&&(oe=S.lastRenderedReducer,oe!==null))try{var ke=S.lastRenderedState,Ke=oe(ke,I);if(X.hasEagerState=!0,X.eagerState=Ke,uo(Ke,ke))return}catch{}finally{}I=xs(),x=Go(x,k,I),x!==null&&yI(x,S,k)}}function gI(x){var S=x.alternate;return x===Ni||S!==null&&S===Ni}function vI(x,S){Zm=mv=!0;var I=x.pending;I===null?S.next=S:(S.next=I.next,I.next=S),x.pending=S}function _I(x,S,I){tr!==null&&x.mode&1&&!(xn&2)?(x=S.interleaved,x===null?(I.next=I,ho===null?ho=[S]:ho.push(S)):(I.next=x.next,x.next=I),S.interleaved=I):(x=S.pending,x===null?I.next=I:(I.next=x.next,x.next=I),S.pending=I)}function yI(x,S,I){if(I&4194240){var k=S.lanes;k&=x.pendingLanes,I|=k,S.lanes=I,Yr(x,I)}}var xv={readContext:$i,useCallback:Zr,useContext:Zr,useEffect:Zr,useImperativeHandle:Zr,useInsertionEffect:Zr,useLayoutEffect:Zr,useMemo:Zr,useReducer:Zr,useRef:Zr,useState:Zr,useDebugValue:Zr,useDeferredValue:Zr,useTransition:Zr,useMutableSource:Zr,useSyncExternalStore:Zr,useId:Zr,unstable_isNewReconciler:!1},i$={readContext:$i,useCallback:function(x,S){return Nl().memoizedState=[x,S===void 0?null:S],x},useContext:$i,useEffect:E2,useImperativeHandle:function(x,S,I){return I=I!=null?I.concat([x]):null,_v(4194308,4,hI.bind(null,S,x),I)},useLayoutEffect:function(x,S){return _v(4194308,4,x,S)},useInsertionEffect:function(x,S){return _v(4,2,x,S)},useMemo:function(x,S){var I=Nl();return S=S===void 0?null:S,x=x(),I.memoizedState=[x,S],x},useReducer:function(x,S,I){var k=Nl();return S=I!==void 0?I(S):S,k.memoizedState=k.baseState=S,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:x,lastRenderedState:S},k.queue=x,x=x.dispatch=t$.bind(null,Ni,x),[k.memoizedState,x]},useRef:function(x){var S=Nl();return x={current:x},S.memoizedState=x},useState:A2,useDebugValue:T2,useDeferredValue:function(x){var S=A2(x),I=S[0],k=S[1];return E2(function(){var X=zo.transition;zo.transition={};try{k(x)}finally{zo.transition=X}},[x]),I},useTransition:function(){var x=A2(!1),S=x[0];return x=e$.bind(null,x[1]),Nl().memoizedState=x,[S,x]},useMutableSource:function(){},useSyncExternalStore:function(x,S,I){var k=Ni,X=Nl();if(pi){if(I===void 0)throw Error(o(407));I=I()}else{if(I=S(),tr===null)throw Error(o(349));tf&30||rI(k,S,I)}X.memoizedState=I;var oe={value:I,getSnapshot:S};return X.queue=oe,E2(oI.bind(null,k,oe,x),[x]),k.flags|=2048,Jm(9,sI.bind(null,k,oe,I,S),void 0,null),I},useId:function(){var x=Nl(),S=tr.identifierPrefix;if(pi){var I=Dl,k=Ll;I=(k&~(1<<32-er(k)-1)).toString(32)+I,S=":"+S+"R"+I,I=Qm++,0<I&&(S+="H"+I.toString(32)),S+=":"}else I=JH++,S=":"+S+"r"+I.toString(32)+":";return x.memoizedState=S},unstable_isNewReconciler:!1},r$={readContext:$i,useCallback:fI,useContext:$i,useEffect:eg,useImperativeHandle:dI,useInsertionEffect:cI,useLayoutEffect:uI,useMemo:pI,useReducer:gv,useRef:lI,useState:function(){return gv(lh)},useDebugValue:T2,useDeferredValue:function(x){var S=gv(lh),I=S[0],k=S[1];return eg(function(){var X=zo.transition;zo.transition={};try{k(x)}finally{zo.transition=X}},[x]),I},useTransition:function(){var x=gv(lh)[0],S=Qa().memoizedState;return[x,S]},useMutableSource:nI,useSyncExternalStore:iI,useId:mI,unstable_isNewReconciler:!1},s$={readContext:$i,useCallback:fI,useContext:$i,useEffect:eg,useImperativeHandle:dI,useInsertionEffect:cI,useLayoutEffect:uI,useMemo:pI,useReducer:vv,useRef:lI,useState:function(){return vv(lh)},useDebugValue:T2,useDeferredValue:function(x){var S=vv(lh),I=S[0],k=S[1];return eg(function(){var X=zo.transition;zo.transition={};try{k(x)}finally{zo.transition=X}},[x]),I},useTransition:function(){var x=vv(lh)[0],S=Qa().memoizedState;return[x,S]},useMutableSource:nI,useSyncExternalStore:iI,useId:mI,unstable_isNewReconciler:!1};function C2(x,S){try{var I="",k=S;do I+=sh(k),k=k.return;while(k);var X=I}catch(oe){X=`
Error generating stack: `+oe.message+`
`+oe.stack}return{value:x,source:S,stack:X}}function P2(x,S){try{console.error(S.value)}catch(I){setTimeout(function(){throw I})}}var o$=typeof WeakMap=="function"?WeakMap:Map;function xI(x,S,I){I=Il(-1,I),I.tag=3,I.payload={element:null};var k=S.value;return I.callback=function(){kv||(kv=!0,X2=k),P2(x,S)},I}function bI(x,S,I){I=Il(-1,I),I.tag=3;var k=x.type.getDerivedStateFromError;if(typeof k=="function"){var X=S.value;I.payload=function(){return k(X)},I.callback=function(){P2(x,S)}}var oe=x.stateNode;return oe!==null&&typeof oe.componentDidCatch=="function"&&(I.callback=function(){P2(x,S),typeof k!="function"&&(Fc===null?Fc=new Set([this]):Fc.add(this));var ke=S.stack;this.componentDidCatch(S.value,{componentStack:ke!==null?ke:""})}),I}function SI(x,S,I){var k=x.pingCache;if(k===null){k=x.pingCache=new o$;var X=new Set;k.set(S,X)}else X=k.get(S),X===void 0&&(X=new Set,k.set(S,X));X.has(I)||(X.add(I),x=x$.bind(null,x,S,I),S.then(x,x))}function wI(x){do{var S;if((S=x.tag===13)&&(S=x.memoizedState,S=S!==null?S.dehydrated!==null:!0),S)return x;x=x.return}while(x!==null);return null}function MI(x,S,I,k,X){return x.mode&1?(x.flags|=65536,x.lanes=X,x):(x===S?x.flags|=65536:(x.flags|=128,I.flags|=131072,I.flags&=-52805,I.tag===1&&(I.alternate===null?I.tag=17:(S=Il(-1,1),S.tag=2,Nc(I,S))),I.lanes|=1),x)}function Ja(x){x.flags|=4}function AI(x,S){if(x!==null&&x.child===S.child)return!0;if(S.flags&16)return!1;for(x=S.child;x!==null;){if(x.flags&12854||x.subtreeFlags&12854)return!1;x=x.sibling}return!0}var tg,ng,bv,Sv;if(se)tg=function(x,S){for(var I=S.child;I!==null;){if(I.tag===5||I.tag===6)B(x,I.stateNode);else if(I.tag!==4&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===S)break;for(;I.sibling===null;){if(I.return===null||I.return===S)return;I=I.return}I.sibling.return=I.return,I=I.sibling}},ng=function(){},bv=function(x,S,I,k,X){if(x=x.memoizedProps,x!==k){var oe=S.stateNode,ke=Za(Bo.current);I=q(oe,I,x,k,X,ke),(S.updateQueue=I)&&Ja(S)}},Sv=function(x,S,I,k){I!==k&&Ja(S)};else if($){tg=function(x,S,I,k){for(var X=S.child;X!==null;){if(X.tag===5){var oe=X.stateNode;I&&k&&(oe=Mt(oe,X.type,X.memoizedProps,X)),B(x,oe)}else if(X.tag===6)oe=X.stateNode,I&&k&&(oe=J(oe,X.memoizedProps,X)),B(x,oe);else if(X.tag!==4){if(X.tag===22&&X.memoizedState!==null)oe=X.child,oe!==null&&(oe.return=X),tg(x,X,!0,!0);else if(X.child!==null){X.child.return=X,X=X.child;continue}}if(X===S)break;for(;X.sibling===null;){if(X.return===null||X.return===S)return;X=X.return}X.sibling.return=X.return,X=X.sibling}};var EI=function(x,S,I,k){for(var X=S.child;X!==null;){if(X.tag===5){var oe=X.stateNode;I&&k&&(oe=Mt(oe,X.type,X.memoizedProps,X)),Xe(x,oe)}else if(X.tag===6)oe=X.stateNode,I&&k&&(oe=J(oe,X.memoizedProps,X)),Xe(x,oe);else if(X.tag!==4){if(X.tag===22&&X.memoizedState!==null)oe=X.child,oe!==null&&(oe.return=X),EI(x,X,!0,!0);else if(X.child!==null){X.child.return=X,X=X.child;continue}}if(X===S)break;for(;X.sibling===null;){if(X.return===null||X.return===S)return;X=X.return}X.sibling.return=X.return,X=X.sibling}};ng=function(x,S){var I=S.stateNode;if(!AI(x,S)){x=I.containerInfo;var k=De(x);EI(k,S,!1,!1),I.pendingChildren=k,Ja(S),gt(x,k)}},bv=function(x,S,I,k,X){var oe=x.stateNode,ke=x.memoizedProps;if((x=AI(x,S))&&ke===k)S.stateNode=oe;else{var Ke=S.stateNode,ft=Za(Bo.current),Rt=null;ke!==k&&(Rt=q(Ke,I,ke,k,X,ft)),x&&Rt===null?S.stateNode=oe:(oe=Ce(oe,Rt,I,ke,k,S,x,Ke),W(oe,I,k,X,ft)&&Ja(S),S.stateNode=oe,x?Ja(S):tg(oe,S,!1,!1))}},Sv=function(x,S,I,k){I!==k?(x=Za(Jd.current),I=Za(Bo.current),S.stateNode=te(k,x,I,S),Ja(S)):S.stateNode=x.stateNode}}else ng=function(){},bv=function(){},Sv=function(){};function ig(x,S){if(!pi)switch(x.tailMode){case"hidden":S=x.tail;for(var I=null;S!==null;)S.alternate!==null&&(I=S),S=S.sibling;I===null?x.tail=null:I.sibling=null;break;case"collapsed":I=x.tail;for(var k=null;I!==null;)I.alternate!==null&&(k=I),I=I.sibling;k===null?S||x.tail===null?x.tail=null:x.tail.sibling=null:k.sibling=null}}function Qr(x){var S=x.alternate!==null&&x.alternate.child===x.child,I=0,k=0;if(S)for(var X=x.child;X!==null;)I|=X.lanes|X.childLanes,k|=X.subtreeFlags&14680064,k|=X.flags&14680064,X.return=x,X=X.sibling;else for(X=x.child;X!==null;)I|=X.lanes|X.childLanes,k|=X.subtreeFlags,k|=X.flags,X.return=x,X=X.sibling;return x.subtreeFlags|=k,x.childLanes=I,S}function a$(x,S,I){var k=S.pendingProps;switch(p2(S),S.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qr(S),null;case 1:return Ln(S.type)&&tn(),Qr(S),null;case 3:return k=S.stateNode,ef(),St(yn),St(Lt),b2(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(x===null||x.child===null)&&(Xm(S)?Ja(S):x===null||x.memoizedState.isDehydrated&&!(S.flags&256)||(S.flags|=1024,ca!==null&&(K2(ca),ca=null))),ng(x,S),Qr(S),null;case 5:y2(S),I=Za(Jd.current);var X=S.type;if(x!==null&&S.stateNode!=null)bv(x,S,X,k,I),x.ref!==S.ref&&(S.flags|=512,S.flags|=2097152);else{if(!k){if(S.stateNode===null)throw Error(o(166));return Qr(S),null}if(x=Za(Bo.current),Xm(S)){if(!fe)throw Error(o(175));x=Gt(S.stateNode,S.type,S.memoizedProps,I,x,S,!jm),S.updateQueue=x,x!==null&&Ja(S)}else{var oe=D(X,k,I,x,S);tg(oe,S,!1,!1),S.stateNode=oe,W(oe,X,k,I,x)&&Ja(S)}S.ref!==null&&(S.flags|=512,S.flags|=2097152)}return Qr(S),null;case 6:if(x&&S.stateNode!=null)Sv(x,S,x.memoizedProps,k);else{if(typeof k!="string"&&S.stateNode===null)throw Error(o(166));if(x=Za(Jd.current),I=Za(Bo.current),Xm(S)){if(!fe)throw Error(o(176));if(x=S.stateNode,k=S.memoizedProps,(I=Tt(x,k,S,!jm))&&(X=fo,X!==null))switch(oe=(X.mode&1)!==0,X.tag){case 3:dt(X.stateNode.containerInfo,x,k,oe);break;case 5:xt(X.type,X.memoizedProps,X.stateNode,x,k,oe)}I&&Ja(S)}else S.stateNode=te(k,x,I,S)}return Qr(S),null;case 13:if(St(wi),k=S.memoizedState,pi&&po!==null&&S.mode&1&&!(S.flags&128)){for(x=po;x;)x=He(x);return Zd(),S.flags|=98560,S}if(k!==null&&k.dehydrated!==null){if(k=Xm(S),x===null){if(!k)throw Error(o(318));if(!fe)throw Error(o(344));if(x=S.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(o(317));bt(x,S)}else Zd(),!(S.flags&128)&&(S.memoizedState=null),S.flags|=4;return Qr(S),null}return ca!==null&&(K2(ca),ca=null),S.flags&128?(S.lanes=I,S):(k=k!==null,I=!1,x===null?Xm(S):I=x.memoizedState!==null,k&&!I&&(S.child.flags|=8192,S.mode&1&&(x===null||wi.current&1?pr===0&&(pr=3):Q2())),S.updateQueue!==null&&(S.flags|=4),Qr(S),null);case 4:return ef(),ng(x,S),x===null&&Ie(S.stateNode.containerInfo),Qr(S),null;case 10:return Tr(S.type._context),Qr(S),null;case 17:return Ln(S.type)&&tn(),Qr(S),null;case 19:if(St(wi),X=S.memoizedState,X===null)return Qr(S),null;if(k=(S.flags&128)!==0,oe=X.rendering,oe===null)if(k)ig(X,!1);else{if(pr!==0||x!==null&&x.flags&128)for(x=S.child;x!==null;){if(oe=fv(x),oe!==null){for(S.flags|=128,ig(X,!1),x=oe.updateQueue,x!==null&&(S.updateQueue=x,S.flags|=4),S.subtreeFlags=0,x=I,k=S.child;k!==null;)I=k,X=x,I.flags&=14680066,oe=I.alternate,oe===null?(I.childLanes=0,I.lanes=X,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=oe.childLanes,I.lanes=oe.lanes,I.child=oe.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=oe.memoizedProps,I.memoizedState=oe.memoizedState,I.updateQueue=oe.updateQueue,I.type=oe.type,X=oe.dependencies,I.dependencies=X===null?null:{lanes:X.lanes,firstContext:X.firstContext}),k=k.sibling;return vt(wi,wi.current&1|2),S.child}x=x.sibling}X.tail!==null&&Si()>j2&&(S.flags|=128,k=!0,ig(X,!1),S.lanes=4194304)}else{if(!k)if(x=fv(oe),x!==null){if(S.flags|=128,k=!0,x=x.updateQueue,x!==null&&(S.updateQueue=x,S.flags|=4),ig(X,!0),X.tail===null&&X.tailMode==="hidden"&&!oe.alternate&&!pi)return Qr(S),null}else 2*Si()-X.renderingStartTime>j2&&I!==1073741824&&(S.flags|=128,k=!0,ig(X,!1),S.lanes=4194304);X.isBackwards?(oe.sibling=S.child,S.child=oe):(x=X.last,x!==null?x.sibling=oe:S.child=oe,X.last=oe)}return X.tail!==null?(S=X.tail,X.rendering=S,X.tail=S.sibling,X.renderingStartTime=Si(),S.sibling=null,x=wi.current,vt(wi,k?x&1|2:x&1),S):(Qr(S),null);case 22:case 23:return Z2(),k=S.memoizedState!==null,x!==null&&x.memoizedState!==null!==k&&(S.flags|=8192),k&&S.mode&1?go&1073741824&&(Qr(S),se&&S.subtreeFlags&6&&(S.flags|=8192)):Qr(S),null;case 24:return null;case 25:return null}throw Error(o(156,S.tag))}var l$=a.ReactCurrentOwner,mo=!1;function ys(x,S,I,k){S.child=x===null?eI(S,null,I,k):Qd(S,x.child,I,k)}function TI(x,S,I,k,X){I=I.render;var oe=S.ref;return Hi(S,X),k=w2(x,S,I,k,oe,X),I=M2(),x!==null&&!mo?(S.updateQueue=x.updateQueue,S.flags&=-2053,x.lanes&=~X,Fl(x,S,X)):(pi&&I&&f2(S),S.flags|=1,ys(x,S,k,X),S.child)}function CI(x,S,I,k,X){if(x===null){var oe=I.type;return typeof oe=="function"&&!J2(oe)&&oe.defaultProps===void 0&&I.compare===null&&I.defaultProps===void 0?(S.tag=15,S.type=oe,PI(x,S,oe,k,X)):(x=Hv(I.type,null,k,S,S.mode,X),x.ref=S.ref,x.return=S,S.child=x)}if(oe=x.child,!(x.lanes&X)){var ke=oe.memoizedProps;if(I=I.compare,I=I!==null?I:rh,I(ke,k)&&x.ref===S.ref)return Fl(x,S,X)}return S.flags|=1,x=Bc(oe,k),x.ref=S.ref,x.return=S,S.child=x}function PI(x,S,I,k,X){if(x!==null&&rh(x.memoizedProps,k)&&x.ref===S.ref)if(mo=!1,(x.lanes&X)!==0)x.flags&131072&&(mo=!0);else return S.lanes=x.lanes,Fl(x,S,X);return R2(x,S,I,k,X)}function RI(x,S,I){var k=S.pendingProps,X=k.children,oe=x!==null?x.memoizedState:null;if(k.mode==="hidden")if(!(S.mode&1))S.memoizedState={baseLanes:0,cachePool:null},vt(nf,go),go|=I;else if(I&1073741824)S.memoizedState={baseLanes:0,cachePool:null},k=oe!==null?oe.baseLanes:I,vt(nf,go),go|=k;else return x=oe!==null?oe.baseLanes|I:I,S.lanes=S.childLanes=1073741824,S.memoizedState={baseLanes:x,cachePool:null},S.updateQueue=null,vt(nf,go),go|=x,null;else oe!==null?(k=oe.baseLanes|I,S.memoizedState=null):k=I,vt(nf,go),go|=k;return ys(x,S,X,I),S.child}function II(x,S){var I=S.ref;(x===null&&I!==null||x!==null&&x.ref!==I)&&(S.flags|=512,S.flags|=2097152)}function R2(x,S,I,k,X){var oe=Ln(I)?bi:Lt.current;return oe=qn(S,oe),Hi(S,X),I=w2(x,S,I,k,oe,X),k=M2(),x!==null&&!mo?(S.updateQueue=x.updateQueue,S.flags&=-2053,x.lanes&=~X,Fl(x,S,X)):(pi&&k&&f2(S),S.flags|=1,ys(x,S,I,X),S.child)}function LI(x,S,I,k,X){if(Ln(I)){var oe=!0;dn(S)}else oe=!1;if(Hi(S,X),S.stateNode===null)x!==null&&(x.alternate=null,S.alternate=null,S.flags|=2),j3(S,I,k),d2(S,I,k,X),k=!0;else if(x===null){var ke=S.stateNode,Ke=S.memoizedProps;ke.props=Ke;var ft=ke.context,Rt=I.contextType;typeof Rt=="object"&&Rt!==null?Rt=$i(Rt):(Rt=Ln(I)?bi:Lt.current,Rt=qn(S,Rt));var Ht=I.getDerivedStateFromProps,an=typeof Ht=="function"||typeof ke.getSnapshotBeforeUpdate=="function";an||typeof ke.UNSAFE_componentWillReceiveProps!="function"&&typeof ke.componentWillReceiveProps!="function"||(Ke!==k||ft!==Rt)&&X3(S,ke,k,Rt),Dc=!1;var Jt=S.memoizedState;ke.state=Jt,lv(S,k,ke,X),ft=S.memoizedState,Ke!==k||Jt!==ft||yn.current||Dc?(typeof Ht=="function"&&(h2(S,I,Ht,k),ft=S.memoizedState),(Ke=Dc||W3(S,I,Ke,k,Jt,ft,Rt))?(an||typeof ke.UNSAFE_componentWillMount!="function"&&typeof ke.componentWillMount!="function"||(typeof ke.componentWillMount=="function"&&ke.componentWillMount(),typeof ke.UNSAFE_componentWillMount=="function"&&ke.UNSAFE_componentWillMount()),typeof ke.componentDidMount=="function"&&(S.flags|=4194308)):(typeof ke.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=k,S.memoizedState=ft),ke.props=k,ke.state=ft,ke.context=Rt,k=Ke):(typeof ke.componentDidMount=="function"&&(S.flags|=4194308),k=!1)}else{ke=S.stateNode,G3(x,S),Ke=S.memoizedProps,Rt=S.type===S.elementType?Ke:vs(S.type,Ke),ke.props=Rt,an=S.pendingProps,Jt=ke.context,ft=I.contextType,typeof ft=="object"&&ft!==null?ft=$i(ft):(ft=Ln(I)?bi:Lt.current,ft=qn(S,ft));var Jn=I.getDerivedStateFromProps;(Ht=typeof Jn=="function"||typeof ke.getSnapshotBeforeUpdate=="function")||typeof ke.UNSAFE_componentWillReceiveProps!="function"&&typeof ke.componentWillReceiveProps!="function"||(Ke!==an||Jt!==ft)&&X3(S,ke,k,ft),Dc=!1,Jt=S.memoizedState,ke.state=Jt,lv(S,k,ke,X);var qt=S.memoizedState;Ke!==an||Jt!==qt||yn.current||Dc?(typeof Jn=="function"&&(h2(S,I,Jn,k),qt=S.memoizedState),(Rt=Dc||W3(S,I,Rt,k,Jt,qt,ft)||!1)?(Ht||typeof ke.UNSAFE_componentWillUpdate!="function"&&typeof ke.componentWillUpdate!="function"||(typeof ke.componentWillUpdate=="function"&&ke.componentWillUpdate(k,qt,ft),typeof ke.UNSAFE_componentWillUpdate=="function"&&ke.UNSAFE_componentWillUpdate(k,qt,ft)),typeof ke.componentDidUpdate=="function"&&(S.flags|=4),typeof ke.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof ke.componentDidUpdate!="function"||Ke===x.memoizedProps&&Jt===x.memoizedState||(S.flags|=4),typeof ke.getSnapshotBeforeUpdate!="function"||Ke===x.memoizedProps&&Jt===x.memoizedState||(S.flags|=1024),S.memoizedProps=k,S.memoizedState=qt),ke.props=k,ke.state=qt,ke.context=ft,k=Rt):(typeof ke.componentDidUpdate!="function"||Ke===x.memoizedProps&&Jt===x.memoizedState||(S.flags|=4),typeof ke.getSnapshotBeforeUpdate!="function"||Ke===x.memoizedProps&&Jt===x.memoizedState||(S.flags|=1024),k=!1)}return I2(x,S,I,k,oe,X)}function I2(x,S,I,k,X,oe){II(x,S);var ke=(S.flags&128)!==0;if(!k&&!ke)return X&&Qn(S,I,!1),Fl(x,S,oe);k=S.stateNode,l$.current=S;var Ke=ke&&typeof I.getDerivedStateFromError!="function"?null:k.render();return S.flags|=1,x!==null&&ke?(S.child=Qd(S,x.child,null,oe),S.child=Qd(S,null,Ke,oe)):ys(x,S,Ke,oe),S.memoizedState=k.state,X&&Qn(S,I,!0),S.child}function DI(x){var S=x.stateNode;S.pendingContext?Yn(x,S.pendingContext,S.pendingContext!==S.context):S.context&&Yn(x,S.context,!1),_2(x,S.containerInfo)}function NI(x,S,I,k,X){return Zd(),v2(X),S.flags|=256,ys(x,S,I,k),S.child}var wv={dehydrated:null,treeContext:null,retryLane:0};function Mv(x){return{baseLanes:x,cachePool:null}}function FI(x,S,I){var k=S.pendingProps,X=wi.current,oe=!1,ke=(S.flags&128)!==0,Ke;if((Ke=ke)||(Ke=x!==null&&x.memoizedState===null?!1:(X&2)!==0),Ke?(oe=!0,S.flags&=-129):(x===null||x.memoizedState!==null)&&(X|=1),vt(wi,X&1),x===null)return g2(S),x=S.memoizedState,x!==null&&(x=x.dehydrated,x!==null)?(S.mode&1?Fe(x)?S.lanes=8:S.lanes=1073741824:S.lanes=1,null):(X=k.children,x=k.fallback,oe?(k=S.mode,oe=S.child,X={mode:"hidden",children:X},!(k&1)&&oe!==null?(oe.childLanes=0,oe.pendingProps=X):oe=$v(X,k,0,null),x=ph(x,k,I,null),oe.return=S,x.return=S,oe.sibling=x,S.child=oe,S.child.memoizedState=Mv(I),S.memoizedState=wv,x):L2(S,X));if(X=x.memoizedState,X!==null){if(Ke=X.dehydrated,Ke!==null){if(ke)return S.flags&256?(S.flags&=-257,Av(x,S,I,Error(o(422)))):S.memoizedState!==null?(S.child=x.child,S.flags|=128,null):(oe=k.fallback,X=S.mode,k=$v({mode:"visible",children:k.children},X,0,null),oe=ph(oe,X,I,null),oe.flags|=2,k.return=S,oe.return=S,k.sibling=oe,S.child=k,S.mode&1&&Qd(S,x.child,null,I),S.child.memoizedState=Mv(I),S.memoizedState=wv,oe);if(!(S.mode&1))S=Av(x,S,I,null);else if(Fe(Ke))S=Av(x,S,I,Error(o(419)));else if(k=(I&x.childLanes)!==0,mo||k){if(k=tr,k!==null){switch(I&-I){case 4:oe=2;break;case 16:oe=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:oe=32;break;case 536870912:oe=268435456;break;default:oe=0}k=oe&(k.suspendedLanes|I)?0:oe,k!==0&&k!==X.retryLane&&(X.retryLane=k,Go(x,k,-1))}Q2(),S=Av(x,S,I,Error(o(421)))}else Se(Ke)?(S.flags|=128,S.child=x.child,S=b$.bind(null,x),ze(Ke,S),S=null):(I=X.treeContext,fe&&(po=wt(Ke),fo=S,pi=!0,ca=null,jm=!1,I!==null&&(Uo[Oo++]=Ll,Uo[Oo++]=Dl,Uo[Oo++]=oh,Ll=I.id,Dl=I.overflow,oh=S)),S=L2(S,S.pendingProps.children),S.flags|=4096);return S}return oe?(k=UI(x,S,k.children,k.fallback,I),oe=S.child,X=x.child.memoizedState,oe.memoizedState=X===null?Mv(I):{baseLanes:X.baseLanes|I,cachePool:null},oe.childLanes=x.childLanes&~I,S.memoizedState=wv,k):(I=kI(x,S,k.children,I),S.memoizedState=null,I)}return oe?(k=UI(x,S,k.children,k.fallback,I),oe=S.child,X=x.child.memoizedState,oe.memoizedState=X===null?Mv(I):{baseLanes:X.baseLanes|I,cachePool:null},oe.childLanes=x.childLanes&~I,S.memoizedState=wv,k):(I=kI(x,S,k.children,I),S.memoizedState=null,I)}function L2(x,S){return S=$v({mode:"visible",children:S},x.mode,0,null),S.return=x,x.child=S}function kI(x,S,I,k){var X=x.child;return x=X.sibling,I=Bc(X,{mode:"visible",children:I}),!(S.mode&1)&&(I.lanes=k),I.return=S,I.sibling=null,x!==null&&(k=S.deletions,k===null?(S.deletions=[x],S.flags|=16):k.push(x)),S.child=I}function UI(x,S,I,k,X){var oe=S.mode;x=x.child;var ke=x.sibling,Ke={mode:"hidden",children:I};return!(oe&1)&&S.child!==x?(I=S.child,I.childLanes=0,I.pendingProps=Ke,S.deletions=null):(I=Bc(x,Ke),I.subtreeFlags=x.subtreeFlags&14680064),ke!==null?k=Bc(ke,k):(k=ph(k,oe,X,null),k.flags|=2),k.return=S,I.return=S,I.sibling=k,S.child=I,k}function Av(x,S,I,k){return k!==null&&v2(k),Qd(S,x.child,null,I),x=L2(S,S.pendingProps.children),x.flags|=2,S.memoizedState=null,x}function OI(x,S,I){x.lanes|=S;var k=x.alternate;k!==null&&(k.lanes|=S),_s(x.return,S,I)}function D2(x,S,I,k,X){var oe=x.memoizedState;oe===null?x.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:k,tail:I,tailMode:X}:(oe.isBackwards=S,oe.rendering=null,oe.renderingStartTime=0,oe.last=k,oe.tail=I,oe.tailMode=X)}function BI(x,S,I){var k=S.pendingProps,X=k.revealOrder,oe=k.tail;if(ys(x,S,k.children,I),k=wi.current,k&2)k=k&1|2,S.flags|=128;else{if(x!==null&&x.flags&128)e:for(x=S.child;x!==null;){if(x.tag===13)x.memoizedState!==null&&OI(x,I,S);else if(x.tag===19)OI(x,I,S);else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===S)break e;for(;x.sibling===null;){if(x.return===null||x.return===S)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}k&=1}if(vt(wi,k),!(S.mode&1))S.memoizedState=null;else switch(X){case"forwards":for(I=S.child,X=null;I!==null;)x=I.alternate,x!==null&&fv(x)===null&&(X=I),I=I.sibling;I=X,I===null?(X=S.child,S.child=null):(X=I.sibling,I.sibling=null),D2(S,!1,X,I,oe);break;case"backwards":for(I=null,X=S.child,S.child=null;X!==null;){if(x=X.alternate,x!==null&&fv(x)===null){S.child=X;break}x=X.sibling,X.sibling=I,I=X,X=x}D2(S,!0,I,null,oe);break;case"together":D2(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function Fl(x,S,I){if(x!==null&&(S.dependencies=x.dependencies),rf|=S.lanes,!(I&S.childLanes))return null;if(x!==null&&S.child!==x.child)throw Error(o(153));if(S.child!==null){for(x=S.child,I=Bc(x,x.pendingProps),S.child=I,I.return=S;x.sibling!==null;)x=x.sibling,I=I.sibling=Bc(x,x.pendingProps),I.return=S;I.sibling=null}return S.child}function c$(x,S,I){switch(S.tag){case 3:DI(S),Zd();break;case 5:tI(S);break;case 1:Ln(S.type)&&dn(S);break;case 4:_2(S,S.stateNode.containerInfo);break;case 10:ov(S,S.type._context,S.memoizedProps.value);break;case 13:var k=S.memoizedState;if(k!==null)return k.dehydrated!==null?(vt(wi,wi.current&1),S.flags|=128,null):I&S.child.childLanes?FI(x,S,I):(vt(wi,wi.current&1),x=Fl(x,S,I),x!==null?x.sibling:null);vt(wi,wi.current&1);break;case 19:if(k=(I&S.childLanes)!==0,x.flags&128){if(k)return BI(x,S,I);S.flags|=128}var X=S.memoizedState;if(X!==null&&(X.rendering=null,X.tail=null,X.lastEffect=null),vt(wi,wi.current),k)break;return null;case 22:case 23:return S.lanes=0,RI(x,S,I)}return Fl(x,S,I)}function u$(x,S){switch(p2(S),S.tag){case 1:return Ln(S.type)&&tn(),x=S.flags,x&65536?(S.flags=x&-65537|128,S):null;case 3:return ef(),St(yn),St(Lt),b2(),x=S.flags,x&65536&&!(x&128)?(S.flags=x&-65537|128,S):null;case 5:return y2(S),null;case 13:if(St(wi),x=S.memoizedState,x!==null&&x.dehydrated!==null){if(S.alternate===null)throw Error(o(340));Zd()}return x=S.flags,x&65536?(S.flags=x&-65537|128,S):null;case 19:return St(wi),null;case 4:return ef(),null;case 10:return Tr(S.type._context),null;case 22:case 23:return Z2(),null;case 24:return null;default:return null}}var Ev=!1,ch=!1,h$=typeof WeakSet=="function"?WeakSet:Set,Ot=null;function Tv(x,S){var I=x.ref;if(I!==null)if(typeof I=="function")try{I(null)}catch(k){Vs(x,S,k)}else I.current=null}function N2(x,S,I){try{I()}catch(k){Vs(x,S,k)}}var zI=!1;function d$(x,S){for(z(x.containerInfo),Ot=S;Ot!==null;)if(x=Ot,S=x.child,(x.subtreeFlags&1028)!==0&&S!==null)S.return=x,Ot=S;else for(;Ot!==null;){x=Ot;try{var I=x.alternate;if(x.flags&1024)switch(x.tag){case 0:case 11:case 15:break;case 1:if(I!==null){var k=I.memoizedProps,X=I.memoizedState,oe=x.stateNode,ke=oe.getSnapshotBeforeUpdate(x.elementType===x.type?k:vs(x.type,k),X);oe.__reactInternalSnapshotBeforeUpdate=ke}break;case 3:se&&Ge(x.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Ke){Vs(x,x.return,Ke)}if(S=x.sibling,S!==null){S.return=x.return,Ot=S;break}Ot=x.return}return I=zI,zI=!1,I}function uh(x,S,I){var k=S.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var X=k=k.next;do{if((X.tag&x)===x){var oe=X.destroy;X.destroy=void 0,oe!==void 0&&N2(S,I,oe)}X=X.next}while(X!==k)}}function rg(x,S){if(S=S.updateQueue,S=S!==null?S.lastEffect:null,S!==null){var I=S=S.next;do{if((I.tag&x)===x){var k=I.create;I.destroy=k()}I=I.next}while(I!==S)}}function F2(x){var S=x.ref;if(S!==null){var I=x.stateNode;switch(x.tag){case 5:x=V(I);break;default:x=I}typeof S=="function"?S(x):S.current=x}}function GI(x,S,I){if(co&&typeof co.onCommitFiberUnmount=="function")try{co.onCommitFiberUnmount(nh,S)}catch{}switch(S.tag){case 0:case 11:case 14:case 15:if(x=S.updateQueue,x!==null&&(x=x.lastEffect,x!==null)){var k=x=x.next;do{var X=k,oe=X.destroy;X=X.tag,oe!==void 0&&(X&2||X&4)&&N2(S,I,oe),k=k.next}while(k!==x)}break;case 1:if(Tv(S,I),x=S.stateNode,typeof x.componentWillUnmount=="function")try{x.props=S.memoizedProps,x.state=S.memoizedState,x.componentWillUnmount()}catch(ke){Vs(S,I,ke)}break;case 5:Tv(S,I);break;case 4:se?XI(x,S,I):$&&$&&(S=S.stateNode.containerInfo,I=De(S),_t(S,I))}}function VI(x,S,I){for(var k=S;;)if(GI(x,k,I),k.child===null||se&&k.tag===4){if(k===S)break;for(;k.sibling===null;){if(k.return===null||k.return===S)return;k=k.return}k.sibling.return=k.return,k=k.sibling}else k.child.return=k,k=k.child}function HI(x){var S=x.alternate;S!==null&&(x.alternate=null,HI(S)),x.child=null,x.deletions=null,x.sibling=null,x.tag===5&&(S=x.stateNode,S!==null&&Oe(S)),x.stateNode=null,x.return=null,x.dependencies=null,x.memoizedProps=null,x.memoizedState=null,x.pendingProps=null,x.stateNode=null,x.updateQueue=null}function $I(x){return x.tag===5||x.tag===3||x.tag===4}function WI(x){e:for(;;){for(;x.sibling===null;){if(x.return===null||$I(x.return))return null;x=x.return}for(x.sibling.return=x.return,x=x.sibling;x.tag!==5&&x.tag!==6&&x.tag!==18;){if(x.flags&2||x.child===null||x.tag===4)continue e;x.child.return=x,x=x.child}if(!(x.flags&2))return x.stateNode}}function jI(x){if(se){e:{for(var S=x.return;S!==null;){if($I(S))break e;S=S.return}throw Error(o(160))}var I=S;switch(I.tag){case 5:S=I.stateNode,I.flags&32&&(at(S),I.flags&=-33),I=WI(x),U2(x,I,S);break;case 3:case 4:S=I.stateNode.containerInfo,I=WI(x),k2(x,I,S);break;default:throw Error(o(161))}}}function k2(x,S,I){var k=x.tag;if(k===5||k===6)x=x.stateNode,S?Be(I,x,S):$e(I,x);else if(k!==4&&(x=x.child,x!==null))for(k2(x,S,I),x=x.sibling;x!==null;)k2(x,S,I),x=x.sibling}function U2(x,S,I){var k=x.tag;if(k===5||k===6)x=x.stateNode,S?rt(I,x,S):Ne(I,x);else if(k!==4&&(x=x.child,x!==null))for(U2(x,S,I),x=x.sibling;x!==null;)U2(x,S,I),x=x.sibling}function XI(x,S,I){for(var k=S,X=!1,oe,ke;;){if(!X){X=k.return;e:for(;;){if(X===null)throw Error(o(160));switch(oe=X.stateNode,X.tag){case 5:ke=!1;break e;case 3:oe=oe.containerInfo,ke=!0;break e;case 4:oe=oe.containerInfo,ke=!0;break e}X=X.return}X=!0}if(k.tag===5||k.tag===6)VI(x,k,I),ke?it(oe,k.stateNode):qe(oe,k.stateNode);else if(k.tag===18)ke?Pe(oe,k.stateNode):we(oe,k.stateNode);else if(k.tag===4){if(k.child!==null){oe=k.stateNode.containerInfo,ke=!0,k.child.return=k,k=k.child;continue}}else if(GI(x,k,I),k.child!==null){k.child.return=k,k=k.child;continue}if(k===S)break;for(;k.sibling===null;){if(k.return===null||k.return===S)return;k=k.return,k.tag===4&&(X=!1)}k.sibling.return=k.return,k=k.sibling}}function O2(x,S){if(se){switch(S.tag){case 0:case 11:case 14:case 15:uh(3,S,S.return),rg(3,S),uh(5,S,S.return);return;case 1:return;case 5:var I=S.stateNode;if(I!=null){var k=S.memoizedProps;x=x!==null?x.memoizedProps:k;var X=S.type,oe=S.updateQueue;S.updateQueue=null,oe!==null&&nt(I,oe,X,x,k,S)}return;case 6:if(S.stateNode===null)throw Error(o(162));I=S.memoizedProps,Ee(S.stateNode,x!==null?x.memoizedProps:I,I);return;case 3:fe&&x!==null&&x.memoizedState.isDehydrated&&pe(S.stateNode.containerInfo);return;case 12:return;case 13:Cv(S);return;case 19:Cv(S);return;case 17:return}throw Error(o(163))}switch(S.tag){case 0:case 11:case 14:case 15:uh(3,S,S.return),rg(3,S),uh(5,S,S.return);return;case 12:return;case 13:Cv(S);return;case 19:Cv(S);return;case 3:fe&&x!==null&&x.memoizedState.isDehydrated&&pe(S.stateNode.containerInfo);break;case 22:case 23:return}e:if($){switch(S.tag){case 1:case 5:case 6:break e;case 3:case 4:S=S.stateNode,_t(S.containerInfo,S.pendingChildren);break e}throw Error(o(163))}}function Cv(x){var S=x.updateQueue;if(S!==null){x.updateQueue=null;var I=x.stateNode;I===null&&(I=x.stateNode=new h$),S.forEach(function(k){var X=S$.bind(null,x,k);I.has(k)||(I.add(k),k.then(X,X))})}}function f$(x,S){for(Ot=S;Ot!==null;){S=Ot;var I=S.deletions;if(I!==null)for(var k=0;k<I.length;k++){var X=I[k];try{var oe=x;se?XI(oe,X,S):VI(oe,X,S);var ke=X.alternate;ke!==null&&(ke.return=null),X.return=null}catch(Xt){Vs(X,S,Xt)}}if(I=S.child,S.subtreeFlags&12854&&I!==null)I.return=S,Ot=I;else for(;Ot!==null;){S=Ot;try{var Ke=S.flags;if(Ke&32&&se&&at(S.stateNode),Ke&512){var ft=S.alternate;if(ft!==null){var Rt=ft.ref;Rt!==null&&(typeof Rt=="function"?Rt(null):Rt.current=null)}}if(Ke&8192)switch(S.tag){case 13:if(S.memoizedState!==null){var Ht=S.alternate;(Ht===null||Ht.memoizedState===null)&&(W2=Si())}break;case 22:var an=S.memoizedState!==null,Jt=S.alternate,Jn=Jt!==null&&Jt.memoizedState!==null;if(I=S,se){e:if(k=I,X=an,oe=null,se)for(var qt=k;;){if(qt.tag===5){if(oe===null){oe=qt;var Jr=qt.stateNode;X?ht(Jr):je(qt.stateNode,qt.memoizedProps)}}else if(qt.tag===6){if(oe===null){var Ho=qt.stateNode;X?Qe(Ho):ee(Ho,qt.memoizedProps)}}else if((qt.tag!==22&&qt.tag!==23||qt.memoizedState===null||qt===k)&&qt.child!==null){qt.child.return=qt,qt=qt.child;continue}if(qt===k)break;for(;qt.sibling===null;){if(qt.return===null||qt.return===k)break e;oe===qt&&(oe=null),qt=qt.return}oe===qt&&(oe=null),qt.sibling.return=qt.return,qt=qt.sibling}}if(an&&!Jn&&I.mode&1){Ot=I;for(var ot=I.child;ot!==null;){for(I=Ot=ot;Ot!==null;){k=Ot;var Je=k.child;switch(k.tag){case 0:case 11:case 14:case 15:uh(4,k,k.return);break;case 1:Tv(k,k.return);var ut=k.stateNode;if(typeof ut.componentWillUnmount=="function"){var zt=k.return;try{ut.props=k.memoizedProps,ut.state=k.memoizedState,ut.componentWillUnmount()}catch(Xt){Vs(k,zt,Xt)}}break;case 5:Tv(k,k.return);break;case 22:if(k.memoizedState!==null){KI(I);continue}}Je!==null?(Je.return=k,Ot=Je):KI(I)}ot=ot.sibling}}}switch(Ke&4102){case 2:jI(S),S.flags&=-3;break;case 6:jI(S),S.flags&=-3,O2(S.alternate,S);break;case 4096:S.flags&=-4097;break;case 4100:S.flags&=-4097,O2(S.alternate,S);break;case 4:O2(S.alternate,S)}}catch(Xt){Vs(S,S.return,Xt)}if(I=S.sibling,I!==null){I.return=S.return,Ot=I;break}Ot=S.return}}}function p$(x,S,I){Ot=x,qI(x)}function qI(x,S,I){for(var k=(x.mode&1)!==0;Ot!==null;){var X=Ot,oe=X.child;if(X.tag===22&&k){var ke=X.memoizedState!==null||Ev;if(!ke){var Ke=X.alternate,ft=Ke!==null&&Ke.memoizedState!==null||ch;Ke=Ev;var Rt=ch;if(Ev=ke,(ch=ft)&&!Rt)for(Ot=X;Ot!==null;)ke=Ot,ft=ke.child,ke.tag===22&&ke.memoizedState!==null?ZI(X):ft!==null?(ft.return=ke,Ot=ft):ZI(X);for(;oe!==null;)Ot=oe,qI(oe),oe=oe.sibling;Ot=X,Ev=Ke,ch=Rt}YI(x)}else X.subtreeFlags&8772&&oe!==null?(oe.return=X,Ot=oe):YI(x)}}function YI(x){for(;Ot!==null;){var S=Ot;if(S.flags&8772){var I=S.alternate;try{if(S.flags&8772)switch(S.tag){case 0:case 11:case 15:ch||rg(5,S);break;case 1:var k=S.stateNode;if(S.flags&4&&!ch)if(I===null)k.componentDidMount();else{var X=S.elementType===S.type?I.memoizedProps:vs(S.type,I.memoizedProps);k.componentDidUpdate(X,I.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var oe=S.updateQueue;oe!==null&&H3(S,oe,k);break;case 3:var ke=S.updateQueue;if(ke!==null){if(I=null,S.child!==null)switch(S.child.tag){case 5:I=V(S.child.stateNode);break;case 1:I=S.child.stateNode}H3(S,ke,I)}break;case 5:var Ke=S.stateNode;I===null&&S.flags&4&&Ze(Ke,S.type,S.memoizedProps,S);break;case 6:break;case 4:break;case 12:break;case 13:if(fe&&S.memoizedState===null){var ft=S.alternate;if(ft!==null){var Rt=ft.memoizedState;if(Rt!==null){var Ht=Rt.dehydrated;Ht!==null&&Ae(Ht)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}ch||S.flags&512&&F2(S)}catch(an){Vs(S,S.return,an)}}if(S===x){Ot=null;break}if(I=S.sibling,I!==null){I.return=S.return,Ot=I;break}Ot=S.return}}function KI(x){for(;Ot!==null;){var S=Ot;if(S===x){Ot=null;break}var I=S.sibling;if(I!==null){I.return=S.return,Ot=I;break}Ot=S.return}}function ZI(x){for(;Ot!==null;){var S=Ot;try{switch(S.tag){case 0:case 11:case 15:var I=S.return;try{rg(4,S)}catch(ft){Vs(S,I,ft)}break;case 1:var k=S.stateNode;if(typeof k.componentDidMount=="function"){var X=S.return;try{k.componentDidMount()}catch(ft){Vs(S,X,ft)}}var oe=S.return;try{F2(S)}catch(ft){Vs(S,oe,ft)}break;case 5:var ke=S.return;try{F2(S)}catch(ft){Vs(S,ke,ft)}}}catch(ft){Vs(S,S.return,ft)}if(S===x){Ot=null;break}var Ke=S.sibling;if(Ke!==null){Ke.return=S.return,Ot=Ke;break}Ot=S.return}}var Pv=0,Rv=1,Iv=2,Lv=3,Dv=4;if(typeof Symbol=="function"&&Symbol.for){var sg=Symbol.for;Pv=sg("selector.component"),Rv=sg("selector.has_pseudo_class"),Iv=sg("selector.role"),Lv=sg("selector.test_id"),Dv=sg("selector.text")}function B2(x){var S=xe(x);if(S!=null){if(typeof S.memoizedProps["data-testname"]!="string")throw Error(o(364));return S}if(x=de(x),x===null)throw Error(o(362));return x.stateNode.current}function z2(x,S){switch(S.$$typeof){case Pv:if(x.type===S.value)return!0;break;case Rv:e:{S=S.value,x=[x,0];for(var I=0;I<x.length;){var k=x[I++],X=x[I++],oe=S[X];if(k.tag!==5||!K(k)){for(;oe!=null&&z2(k,oe);)X++,oe=S[X];if(X===S.length){S=!0;break e}else for(k=k.child;k!==null;)x.push(k,X),k=k.sibling}}S=!1}return S;case Iv:if(x.tag===5&&be(x.stateNode,S.value))return!0;break;case Dv:if((x.tag===5||x.tag===6)&&(x=ie(x),x!==null&&0<=x.indexOf(S.value)))return!0;break;case Lv:if(x.tag===5&&(x=x.memoizedProps["data-testname"],typeof x=="string"&&x.toLowerCase()===S.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function G2(x){switch(x.$$typeof){case Pv:return"<"+(M(x.value)||"Unknown")+">";case Rv:return":has("+(G2(x)||"")+")";case Iv:return'[role="'+x.value+'"]';case Dv:return'"'+x.value+'"';case Lv:return'[data-testname="'+x.value+'"]';default:throw Error(o(365))}}function QI(x,S){var I=[];x=[x,0];for(var k=0;k<x.length;){var X=x[k++],oe=x[k++],ke=S[oe];if(X.tag!==5||!K(X)){for(;ke!=null&&z2(X,ke);)oe++,ke=S[oe];if(oe===S.length)I.push(X);else for(X=X.child;X!==null;)x.push(X,oe),X=X.sibling}}return I}function V2(x,S){if(!Q)throw Error(o(363));x=B2(x),x=QI(x,S),S=[],x=Array.from(x);for(var I=0;I<x.length;){var k=x[I++];if(k.tag===5)K(k)||S.push(k.stateNode);else for(k=k.child;k!==null;)x.push(k),k=k.sibling}return S}var m$=Math.ceil,Nv=a.ReactCurrentDispatcher,H2=a.ReactCurrentOwner,Wi=a.ReactCurrentBatchConfig,xn=0,tr=null,nr=null,Br=0,go=0,nf=Bt(0),pr=0,og=null,rf=0,Fv=0,$2=0,ag=null,zs=null,W2=0,j2=1/0;function sf(){j2=Si()+500}var kv=!1,X2=null,Fc=null,Uv=!1,kc=null,Ov=0,lg=0,q2=null,Bv=-1,zv=0;function xs(){return xn&6?Si():Bv!==-1?Bv:Bv=Si()}function Uc(x){return x.mode&1?xn&2&&Br!==0?Br&-Br:ih.transition!==null?(zv===0&&(x=ds,ds<<=1,!(ds&4194240)&&(ds=64),zv=x),zv):(x=cn,x!==0?x:ge()):1}function Go(x,S,I){if(50<lg)throw lg=0,q2=null,Error(o(185));var k=Gv(x,S);return k===null?null:(lo(k,S,I),(!(xn&2)||k!==tr)&&(k===tr&&(!(xn&2)&&(Fv|=S),pr===4&&Oc(k,Br)),Gs(k,I),S===1&&xn===0&&!(x.mode&1)&&(sf(),Ka&&Bs())),k)}function Gv(x,S){x.lanes|=S;var I=x.alternate;for(I!==null&&(I.lanes|=S),I=x,x=x.return;x!==null;)x.childLanes|=S,I=x.alternate,I!==null&&(I.childLanes|=S),I=x,x=x.return;return I.tag===3?I.stateNode:null}function Gs(x,S){var I=x.callbackNode;oa(x,S);var k=ao(x,x===tr?Br:0);if(k===0)I!==null&&jd(I),x.callbackNode=null,x.callbackPriority=0;else if(S=k&-k,x.callbackPriority!==S){if(I!=null&&jd(I),S===1)x.tag===0?Wm(eL.bind(null,x)):$m(eL.bind(null,x)),Me?Y(function(){xn===0&&Bs()}):Rl(th,Bs),I=null;else{switch(Pl(k)){case 1:I=th;break;case 4:I=rv;break;case 16:I=ms;break;case 536870912:I=Vm;break;default:I=ms}I=cL(I,JI.bind(null,x))}x.callbackPriority=S,x.callbackNode=I}}function JI(x,S){if(Bv=-1,zv=0,xn&6)throw Error(o(327));var I=x.callbackNode;if(fh()&&x.callbackNode!==I)return null;var k=ao(x,x===tr?Br:0);if(k===0)return null;if(k&30||k&x.expiredLanes||S)S=Vv(x,k);else{S=k;var X=xn;xn|=2;var oe=iL();(tr!==x||Br!==S)&&(sf(),hh(x,S));do try{_$();break}catch(Ke){nL(x,Ke)}while(!0);qd(),Nv.current=oe,xn=X,nr!==null?S=0:(tr=null,Br=0,S=pr)}if(S!==0){if(S===2&&(X=Ar(x),X!==0&&(k=X,S=Y2(x,X))),S===1)throw I=og,hh(x,0),Oc(x,k),Gs(x,Si()),I;if(S===6)Oc(x,k);else{if(X=x.current.alternate,!(k&30)&&!g$(X)&&(S=Vv(x,k),S===2&&(oe=Ar(x),oe!==0&&(k=oe,S=Y2(x,oe))),S===1))throw I=og,hh(x,0),Oc(x,k),Gs(x,Si()),I;switch(x.finishedWork=X,x.finishedLanes=k,S){case 0:case 1:throw Error(o(345));case 2:dh(x,zs);break;case 3:if(Oc(x,k),(k&130023424)===k&&(S=W2+500-Si(),10<S)){if(ao(x,0)!==0)break;if(X=x.suspendedLanes,(X&k)!==k){xs(),x.pingedLanes|=x.suspendedLanes&X;break}x.timeoutHandle=ne(dh.bind(null,x,zs),S);break}dh(x,zs);break;case 4:if(Oc(x,k),(k&4194240)===k)break;for(S=x.eventTimes,X=-1;0<k;){var ke=31-er(k);oe=1<<ke,ke=S[ke],ke>X&&(X=ke),k&=~oe}if(k=X,k=Si()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*m$(k/1960))-k,10<k){x.timeoutHandle=ne(dh.bind(null,x,zs),k);break}dh(x,zs);break;case 5:dh(x,zs);break;default:throw Error(o(329))}}}return Gs(x,Si()),x.callbackNode===I?JI.bind(null,x):null}function Y2(x,S){var I=ag;return x.current.memoizedState.isDehydrated&&(hh(x,S).flags|=256),x=Vv(x,S),x!==2&&(S=zs,zs=I,S!==null&&K2(S)),x}function K2(x){zs===null?zs=x:zs.push.apply(zs,x)}function g$(x){for(var S=x;;){if(S.flags&16384){var I=S.updateQueue;if(I!==null&&(I=I.stores,I!==null))for(var k=0;k<I.length;k++){var X=I[k],oe=X.getSnapshot;X=X.value;try{if(!uo(oe(),X))return!1}catch{return!1}}}if(I=S.child,S.subtreeFlags&16384&&I!==null)I.return=S,S=I;else{if(S===x)break;for(;S.sibling===null;){if(S.return===null||S.return===x)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function Oc(x,S){for(S&=~$2,S&=~Fv,x.suspendedLanes|=S,x.pingedLanes&=~S,x=x.expirationTimes;0<S;){var I=31-er(S),k=1<<I;x[I]=-1,S&=~k}}function eL(x){if(xn&6)throw Error(o(327));fh();var S=ao(x,0);if(!(S&1))return Gs(x,Si()),null;var I=Vv(x,S);if(x.tag!==0&&I===2){var k=Ar(x);k!==0&&(S=k,I=Y2(x,k))}if(I===1)throw I=og,hh(x,0),Oc(x,S),Gs(x,Si()),I;if(I===6)throw Error(o(345));return x.finishedWork=x.current.alternate,x.finishedLanes=S,dh(x,zs),Gs(x,Si()),null}function tL(x){kc!==null&&kc.tag===0&&!(xn&6)&&fh();var S=xn;xn|=1;var I=Wi.transition,k=cn;try{if(Wi.transition=null,cn=1,x)return x()}finally{cn=k,Wi.transition=I,xn=S,!(xn&6)&&Bs()}}function Z2(){go=nf.current,St(nf)}function hh(x,S){x.finishedWork=null,x.finishedLanes=0;var I=x.timeoutHandle;if(I!==le&&(x.timeoutHandle=le,Z(I)),nr!==null)for(I=nr.return;I!==null;){var k=I;switch(p2(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&tn();break;case 3:ef(),St(yn),St(Lt),b2();break;case 5:y2(k);break;case 4:ef();break;case 13:St(wi);break;case 19:St(wi);break;case 10:Tr(k.type._context);break;case 22:case 23:Z2()}I=I.return}if(tr=x,nr=x=Bc(x.current,null),Br=go=S,pr=0,og=null,$2=Fv=rf=0,zs=ag=null,ho!==null){for(S=0;S<ho.length;S++)if(I=ho[S],k=I.interleaved,k!==null){I.interleaved=null;var X=k.next,oe=I.pending;if(oe!==null){var ke=oe.next;oe.next=X,k.next=ke}I.pending=k}ho=null}return x}function nL(x,S){do{var I=nr;try{if(qd(),pv.current=xv,mv){for(var k=Ni.memoizedState;k!==null;){var X=k.queue;X!==null&&(X.pending=null),k=k.next}mv=!1}if(tf=0,Cr=Kr=Ni=null,Zm=!1,Qm=0,H2.current=null,I===null||I.return===null){pr=1,og=S,nr=null;break}e:{var oe=x,ke=I.return,Ke=I,ft=S;if(S=Br,Ke.flags|=32768,ft!==null&&typeof ft=="object"&&typeof ft.then=="function"){var Rt=ft,Ht=Ke,an=Ht.tag;if(!(Ht.mode&1)&&(an===0||an===11||an===15)){var Jt=Ht.alternate;Jt?(Ht.updateQueue=Jt.updateQueue,Ht.memoizedState=Jt.memoizedState,Ht.lanes=Jt.lanes):(Ht.updateQueue=null,Ht.memoizedState=null)}var Jn=wI(ke);if(Jn!==null){Jn.flags&=-257,MI(Jn,ke,Ke,oe,S),Jn.mode&1&&SI(oe,Rt,S),S=Jn,ft=Rt;var qt=S.updateQueue;if(qt===null){var Jr=new Set;Jr.add(ft),S.updateQueue=Jr}else qt.add(ft);break e}else{if(!(S&1)){SI(oe,Rt,S),Q2();break e}ft=Error(o(426))}}else if(pi&&Ke.mode&1){var Ho=wI(ke);if(Ho!==null){!(Ho.flags&65536)&&(Ho.flags|=256),MI(Ho,ke,Ke,oe,S),v2(ft);break e}}oe=ft,pr!==4&&(pr=2),ag===null?ag=[oe]:ag.push(oe),ft=C2(ft,Ke),Ke=ke;do{switch(Ke.tag){case 3:Ke.flags|=65536,S&=-S,Ke.lanes|=S;var ot=xI(Ke,ft,S);V3(Ke,ot);break e;case 1:oe=ft;var Je=Ke.type,ut=Ke.stateNode;if(!(Ke.flags&128)&&(typeof Je.getDerivedStateFromError=="function"||ut!==null&&typeof ut.componentDidCatch=="function"&&(Fc===null||!Fc.has(ut)))){Ke.flags|=65536,S&=-S,Ke.lanes|=S;var zt=bI(Ke,oe,S);V3(Ke,zt);break e}}Ke=Ke.return}while(Ke!==null)}sL(I)}catch(Xt){S=Xt,nr===I&&I!==null&&(nr=I=I.return);continue}break}while(!0)}function iL(){var x=Nv.current;return Nv.current=xv,x===null?xv:x}function Q2(){(pr===0||pr===3||pr===2)&&(pr=4),tr===null||!(rf&268435455)&&!(Fv&268435455)||Oc(tr,Br)}function Vv(x,S){var I=xn;xn|=2;var k=iL();tr===x&&Br===S||hh(x,S);do try{v$();break}catch(X){nL(x,X)}while(!0);if(qd(),xn=I,Nv.current=k,nr!==null)throw Error(o(261));return tr=null,Br=0,pr}function v$(){for(;nr!==null;)rL(nr)}function _$(){for(;nr!==null&&!Gm();)rL(nr)}function rL(x){var S=lL(x.alternate,x,go);x.memoizedProps=x.pendingProps,S===null?sL(x):nr=S,H2.current=null}function sL(x){var S=x;do{var I=S.alternate;if(x=S.return,S.flags&32768){if(I=u$(I,S),I!==null){I.flags&=32767,nr=I;return}if(x!==null)x.flags|=32768,x.subtreeFlags=0,x.deletions=null;else{pr=6,nr=null;return}}else if(I=a$(I,S,go),I!==null){nr=I;return}if(S=S.sibling,S!==null){nr=S;return}nr=S=x}while(S!==null);pr===0&&(pr=5)}function dh(x,S){var I=cn,k=Wi.transition;try{Wi.transition=null,cn=1,y$(x,S,I)}finally{Wi.transition=k,cn=I}return null}function y$(x,S,I){do fh();while(kc!==null);if(xn&6)throw Error(o(327));var k=x.finishedWork,X=x.finishedLanes;if(k===null)return null;if(x.finishedWork=null,x.finishedLanes=0,k===x.current)throw Error(o(177));x.callbackNode=null,x.callbackPriority=0;var oe=k.lanes|k.childLanes;if(fr(x,oe),x===tr&&(nr=tr=null,Br=0),!(k.subtreeFlags&2064)&&!(k.flags&2064)||Uv||(Uv=!0,cL(ms,function(){return fh(),null})),oe=(k.flags&15990)!==0,k.subtreeFlags&15990||oe){oe=Wi.transition,Wi.transition=null;var ke=cn;cn=1;var Ke=xn;xn|=4,H2.current=null,d$(x,k),f$(x,k),O(x.containerInfo),x.current=k,p$(k),iv(),xn=Ke,cn=ke,Wi.transition=oe}else x.current=k;if(Uv&&(Uv=!1,kc=x,Ov=X),oe=x.pendingLanes,oe===0&&(Fc=null),Hm(k.stateNode),Gs(x,Si()),S!==null)for(I=x.onRecoverableError,k=0;k<S.length;k++)I(S[k]);if(kv)throw kv=!1,x=X2,X2=null,x;return Ov&1&&x.tag!==0&&fh(),oe=x.pendingLanes,oe&1?x===q2?lg++:(lg=0,q2=x):lg=0,Bs(),null}function fh(){if(kc!==null){var x=Pl(Ov),S=Wi.transition,I=cn;try{if(Wi.transition=null,cn=16>x?16:x,kc===null)var k=!1;else{if(x=kc,kc=null,Ov=0,xn&6)throw Error(o(331));var X=xn;for(xn|=4,Ot=x.current;Ot!==null;){var oe=Ot,ke=oe.child;if(Ot.flags&16){var Ke=oe.deletions;if(Ke!==null){for(var ft=0;ft<Ke.length;ft++){var Rt=Ke[ft];for(Ot=Rt;Ot!==null;){var Ht=Ot;switch(Ht.tag){case 0:case 11:case 15:uh(8,Ht,oe)}var an=Ht.child;if(an!==null)an.return=Ht,Ot=an;else for(;Ot!==null;){Ht=Ot;var Jt=Ht.sibling,Jn=Ht.return;if(HI(Ht),Ht===Rt){Ot=null;break}if(Jt!==null){Jt.return=Jn,Ot=Jt;break}Ot=Jn}}}var qt=oe.alternate;if(qt!==null){var Jr=qt.child;if(Jr!==null){qt.child=null;do{var Ho=Jr.sibling;Jr.sibling=null,Jr=Ho}while(Jr!==null)}}Ot=oe}}if(oe.subtreeFlags&2064&&ke!==null)ke.return=oe,Ot=ke;else e:for(;Ot!==null;){if(oe=Ot,oe.flags&2048)switch(oe.tag){case 0:case 11:case 15:uh(9,oe,oe.return)}var ot=oe.sibling;if(ot!==null){ot.return=oe.return,Ot=ot;break e}Ot=oe.return}}var Je=x.current;for(Ot=Je;Ot!==null;){ke=Ot;var ut=ke.child;if(ke.subtreeFlags&2064&&ut!==null)ut.return=ke,Ot=ut;else e:for(ke=Je;Ot!==null;){if(Ke=Ot,Ke.flags&2048)try{switch(Ke.tag){case 0:case 11:case 15:rg(9,Ke)}}catch(Xt){Vs(Ke,Ke.return,Xt)}if(Ke===ke){Ot=null;break e}var zt=Ke.sibling;if(zt!==null){zt.return=Ke.return,Ot=zt;break e}Ot=Ke.return}}if(xn=X,Bs(),co&&typeof co.onPostCommitFiberRoot=="function")try{co.onPostCommitFiberRoot(nh,x)}catch{}k=!0}return k}finally{cn=I,Wi.transition=S}}return!1}function oL(x,S,I){S=C2(I,S),S=xI(x,S,1),Nc(x,S),S=xs(),x=Gv(x,1),x!==null&&(lo(x,1,S),Gs(x,S))}function Vs(x,S,I){if(x.tag===3)oL(x,x,I);else for(;S!==null;){if(S.tag===3){oL(S,x,I);break}else if(S.tag===1){var k=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(Fc===null||!Fc.has(k))){x=C2(I,x),x=bI(S,x,1),Nc(S,x),x=xs(),S=Gv(S,1),S!==null&&(lo(S,1,x),Gs(S,x));break}}S=S.return}}function x$(x,S,I){var k=x.pingCache;k!==null&&k.delete(S),S=xs(),x.pingedLanes|=x.suspendedLanes&I,tr===x&&(Br&I)===I&&(pr===4||pr===3&&(Br&130023424)===Br&&500>Si()-W2?hh(x,0):$2|=I),Gs(x,S)}function aL(x,S){S===0&&(x.mode&1?(S=fs,fs<<=1,!(fs&130023424)&&(fs=4194304)):S=1);var I=xs();x=Gv(x,S),x!==null&&(lo(x,S,I),Gs(x,I))}function b$(x){var S=x.memoizedState,I=0;S!==null&&(I=S.retryLane),aL(x,I)}function S$(x,S){var I=0;switch(x.tag){case 13:var k=x.stateNode,X=x.memoizedState;X!==null&&(I=X.retryLane);break;case 19:k=x.stateNode;break;default:throw Error(o(314))}k!==null&&k.delete(S),aL(x,I)}var lL;lL=function(x,S,I){if(x!==null)if(x.memoizedProps!==S.pendingProps||yn.current)mo=!0;else{if(!(x.lanes&I)&&!(S.flags&128))return mo=!1,c$(x,S,I);mo=!!(x.flags&131072)}else mo=!1,pi&&S.flags&1048576&&q3(S,hv,S.index);switch(S.lanes=0,S.tag){case 2:var k=S.type;x!==null&&(x.alternate=null,S.alternate=null,S.flags|=2),x=S.pendingProps;var X=qn(S,Lt.current);Hi(S,I),X=w2(null,S,k,x,X,I);var oe=M2();return S.flags|=1,typeof X=="object"&&X!==null&&typeof X.render=="function"&&X.$$typeof===void 0?(S.tag=1,S.memoizedState=null,S.updateQueue=null,Ln(k)?(oe=!0,dn(S)):oe=!1,S.memoizedState=X.state!==null&&X.state!==void 0?X.state:null,u2(S),X.updater=cv,S.stateNode=X,X._reactInternals=S,d2(S,k,x,I),S=I2(null,S,k,!0,oe,I)):(S.tag=0,pi&&oe&&f2(S),ys(null,S,X,I),S=S.child),S;case 16:k=S.elementType;e:{switch(x!==null&&(x.alternate=null,S.alternate=null,S.flags|=2),x=S.pendingProps,X=k._init,k=X(k._payload),S.type=k,X=S.tag=M$(k),x=vs(k,x),X){case 0:S=R2(null,S,k,x,I);break e;case 1:S=LI(null,S,k,x,I);break e;case 11:S=TI(null,S,k,x,I);break e;case 14:S=CI(null,S,k,vs(k.type,x),I);break e}throw Error(o(306,k,""))}return S;case 0:return k=S.type,X=S.pendingProps,X=S.elementType===k?X:vs(k,X),R2(x,S,k,X,I);case 1:return k=S.type,X=S.pendingProps,X=S.elementType===k?X:vs(k,X),LI(x,S,k,X,I);case 3:e:{if(DI(S),x===null)throw Error(o(387));k=S.pendingProps,oe=S.memoizedState,X=oe.element,G3(x,S),lv(S,k,null,I);var ke=S.memoizedState;if(k=ke.element,fe&&oe.isDehydrated)if(oe={element:k,isDehydrated:!1,cache:ke.cache,transitions:ke.transitions},S.updateQueue.baseState=oe,S.memoizedState=oe,S.flags&256){X=Error(o(423)),S=NI(x,S,k,I,X);break e}else if(k!==X){X=Error(o(424)),S=NI(x,S,k,I,X);break e}else for(fe&&(po=mt(S.stateNode.containerInfo),fo=S,pi=!0,ca=null,jm=!1),I=eI(S,null,k,I),S.child=I;I;)I.flags=I.flags&-3|4096,I=I.sibling;else{if(Zd(),k===X){S=Fl(x,S,I);break e}ys(x,S,k,I)}S=S.child}return S;case 5:return tI(S),x===null&&g2(S),k=S.type,X=S.pendingProps,oe=x!==null?x.memoizedProps:null,ke=X.children,j(k,X)?ke=null:oe!==null&&j(k,oe)&&(S.flags|=32),II(x,S),ys(x,S,ke,I),S.child;case 6:return x===null&&g2(S),null;case 13:return FI(x,S,I);case 4:return _2(S,S.stateNode.containerInfo),k=S.pendingProps,x===null?S.child=Qd(S,null,k,I):ys(x,S,k,I),S.child;case 11:return k=S.type,X=S.pendingProps,X=S.elementType===k?X:vs(k,X),TI(x,S,k,X,I);case 7:return ys(x,S,S.pendingProps,I),S.child;case 8:return ys(x,S,S.pendingProps.children,I),S.child;case 12:return ys(x,S,S.pendingProps.children,I),S.child;case 10:e:{if(k=S.type._context,X=S.pendingProps,oe=S.memoizedProps,ke=X.value,ov(S,k,ke),oe!==null)if(uo(oe.value,ke)){if(oe.children===X.children&&!yn.current){S=Fl(x,S,I);break e}}else for(oe=S.child,oe!==null&&(oe.return=S);oe!==null;){var Ke=oe.dependencies;if(Ke!==null){ke=oe.child;for(var ft=Ke.firstContext;ft!==null;){if(ft.context===k){if(oe.tag===1){ft=Il(-1,I&-I),ft.tag=2;var Rt=oe.updateQueue;if(Rt!==null){Rt=Rt.shared;var Ht=Rt.pending;Ht===null?ft.next=ft:(ft.next=Ht.next,Ht.next=ft),Rt.pending=ft}}oe.lanes|=I,ft=oe.alternate,ft!==null&&(ft.lanes|=I),_s(oe.return,I,S),Ke.lanes|=I;break}ft=ft.next}}else if(oe.tag===10)ke=oe.type===S.type?null:oe.child;else if(oe.tag===18){if(ke=oe.return,ke===null)throw Error(o(341));ke.lanes|=I,Ke=ke.alternate,Ke!==null&&(Ke.lanes|=I),_s(ke,I,S),ke=oe.sibling}else ke=oe.child;if(ke!==null)ke.return=oe;else for(ke=oe;ke!==null;){if(ke===S){ke=null;break}if(oe=ke.sibling,oe!==null){oe.return=ke.return,ke=oe;break}ke=ke.return}oe=ke}ys(x,S,X.children,I),S=S.child}return S;case 9:return X=S.type,k=S.pendingProps.children,Hi(S,I),X=$i(X),k=k(X),S.flags|=1,ys(x,S,k,I),S.child;case 14:return k=S.type,X=vs(k,S.pendingProps),X=vs(k.type,X),CI(x,S,k,X,I);case 15:return PI(x,S,S.type,S.pendingProps,I);case 17:return k=S.type,X=S.pendingProps,X=S.elementType===k?X:vs(k,X),x!==null&&(x.alternate=null,S.alternate=null,S.flags|=2),S.tag=1,Ln(k)?(x=!0,dn(S)):x=!1,Hi(S,I),j3(S,k,X),d2(S,k,X,I),I2(null,S,k,!0,x,I);case 19:return BI(x,S,I);case 22:return RI(x,S,I)}throw Error(o(156,S.tag))};function cL(x,S){return Rl(x,S)}function w$(x,S,I,k){this.tag=x,this.key=I,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vo(x,S,I,k){return new w$(x,S,I,k)}function J2(x){return x=x.prototype,!(!x||!x.isReactComponent)}function M$(x){if(typeof x=="function")return J2(x)?1:0;if(x!=null){if(x=x.$$typeof,x===_)return 11;if(x===b)return 14}return 2}function Bc(x,S){var I=x.alternate;return I===null?(I=Vo(x.tag,S,x.key,x.mode),I.elementType=x.elementType,I.type=x.type,I.stateNode=x.stateNode,I.alternate=x,x.alternate=I):(I.pendingProps=S,I.type=x.type,I.flags=0,I.subtreeFlags=0,I.deletions=null),I.flags=x.flags&14680064,I.childLanes=x.childLanes,I.lanes=x.lanes,I.child=x.child,I.memoizedProps=x.memoizedProps,I.memoizedState=x.memoizedState,I.updateQueue=x.updateQueue,S=x.dependencies,I.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},I.sibling=x.sibling,I.index=x.index,I.ref=x.ref,I}function Hv(x,S,I,k,X,oe){var ke=2;if(k=x,typeof x=="function")J2(x)&&(ke=1);else if(typeof x=="string")ke=5;else e:switch(x){case u:return ph(I.children,X,oe,S);case h:ke=8,X|=8;break;case d:return x=Vo(12,I,S,X|2),x.elementType=d,x.lanes=oe,x;case v:return x=Vo(13,I,S,X),x.elementType=v,x.lanes=oe,x;case g:return x=Vo(19,I,S,X),x.elementType=g,x.lanes=oe,x;case y:return $v(I,X,oe,S);default:if(typeof x=="object"&&x!==null)switch(x.$$typeof){case f:ke=10;break e;case p:ke=9;break e;case _:ke=11;break e;case b:ke=14;break e;case m:ke=16,k=null;break e}throw Error(o(130,x==null?x:typeof x,""))}return S=Vo(ke,I,S,X),S.elementType=x,S.type=k,S.lanes=oe,S}function ph(x,S,I,k){return x=Vo(7,x,k,S),x.lanes=I,x}function $v(x,S,I,k){return x=Vo(22,x,k,S),x.elementType=y,x.lanes=I,x.stateNode={},x}function ew(x,S,I){return x=Vo(6,x,null,S),x.lanes=I,x}function tw(x,S,I){return S=Vo(4,x.children!==null?x.children:[],x.key,S),S.lanes=I,S.stateNode={containerInfo:x.containerInfo,pendingChildren:null,implementation:x.implementation},S}function A$(x,S,I,k,X){this.tag=S,this.containerInfo=x,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=le,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=aa(0),this.expirationTimes=aa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=aa(0),this.identifierPrefix=k,this.onRecoverableError=X,fe&&(this.mutableSourceEagerHydrationData=null)}function uL(x,S,I,k,X,oe,ke,Ke,ft){return x=new A$(x,S,I,Ke,ft),S===1?(S=1,oe===!0&&(S|=8)):S=0,oe=Vo(3,null,null,S),x.current=oe,oe.stateNode=x,oe.memoizedState={element:k,isDehydrated:I,cache:null,transitions:null},u2(oe),x}function hL(x){if(!x)return Wt;x=x._reactInternals;e:{if(E(x)!==x||x.tag!==1)throw Error(o(170));var S=x;do{switch(S.tag){case 3:S=S.stateNode.context;break e;case 1:if(Ln(S.type)){S=S.stateNode.__reactInternalMemoizedMergedChildContext;break e}}S=S.return}while(S!==null);throw Error(o(171))}if(x.tag===1){var I=x.type;if(Ln(I))return Ji(x,I,S)}return S}function dL(x){var S=x._reactInternals;if(S===void 0)throw typeof x.render=="function"?Error(o(188)):(x=Object.keys(x).join(","),Error(o(268,x)));return x=P(S),x===null?null:x.stateNode}function fL(x,S){if(x=x.memoizedState,x!==null&&x.dehydrated!==null){var I=x.retryLane;x.retryLane=I!==0&&I<S?I:S}}function nw(x,S){fL(x,S),(x=x.alternate)&&fL(x,S)}function E$(x){return x=P(x),x===null?null:x.stateNode}function T$(){return null}return t.attemptContinuousHydration=function(x){if(x.tag===13){var S=xs();Go(x,134217728,S),nw(x,134217728)}},t.attemptHydrationAtCurrentPriority=function(x){if(x.tag===13){var S=xs(),I=Uc(x);Go(x,I,S),nw(x,I)}},t.attemptSynchronousHydration=function(x){switch(x.tag){case 3:var S=x.stateNode;if(S.current.memoizedState.isDehydrated){var I=ps(S.pendingLanes);I!==0&&(Yr(S,I|1),Gs(S,Si()),!(xn&6)&&(sf(),Bs()))}break;case 13:var k=xs();tL(function(){return Go(x,1,k)}),nw(x,1)}},t.batchedUpdates=function(x,S){var I=xn;xn|=1;try{return x(S)}finally{xn=I,xn===0&&(sf(),Ka&&Bs())}},t.createComponentSelector=function(x){return{$$typeof:Pv,value:x}},t.createContainer=function(x,S,I,k,X,oe,ke){return uL(x,S,!1,null,I,k,X,oe,ke)},t.createHasPseudoClassSelector=function(x){return{$$typeof:Rv,value:x}},t.createHydrationContainer=function(x,S,I,k,X,oe,ke,Ke,ft){return x=uL(I,k,!0,x,X,oe,ke,Ke,ft),x.context=hL(null),I=x.current,k=xs(),X=Uc(I),oe=Il(k,X),oe.callback=S??null,Nc(I,oe),x.current.lanes=X,lo(x,X,k),Gs(x,k),x},t.createPortal=function(x,S,I){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:k==null?null:""+k,children:x,containerInfo:S,implementation:I}},t.createRoleSelector=function(x){return{$$typeof:Iv,value:x}},t.createTestNameSelector=function(x){return{$$typeof:Lv,value:x}},t.createTextSelector=function(x){return{$$typeof:Dv,value:x}},t.deferredUpdates=function(x){var S=cn,I=Wi.transition;try{return Wi.transition=null,cn=16,x()}finally{cn=S,Wi.transition=I}},t.discreteUpdates=function(x,S,I,k,X){var oe=cn,ke=Wi.transition;try{return Wi.transition=null,cn=1,x(S,I,k,X)}finally{cn=oe,Wi.transition=ke,xn===0&&sf()}},t.findAllNodes=V2,t.findBoundingRects=function(x,S){if(!Q)throw Error(o(363));S=V2(x,S),x=[];for(var I=0;I<S.length;I++)x.push(Le(S[I]));for(S=x.length-1;0<S;S--){I=x[S];for(var k=I.x,X=k+I.width,oe=I.y,ke=oe+I.height,Ke=S-1;0<=Ke;Ke--)if(S!==Ke){var ft=x[Ke],Rt=ft.x,Ht=Rt+ft.width,an=ft.y,Jt=an+ft.height;if(k>=Rt&&oe>=an&&X<=Ht&&ke<=Jt){x.splice(S,1);break}else if(k!==Rt||I.width!==ft.width||Jt<oe||an>ke){if(!(oe!==an||I.height!==ft.height||Ht<k||Rt>X)){Rt>k&&(ft.width+=Rt-k,ft.x=k),Ht<X&&(ft.width=X-Rt),x.splice(S,1);break}}else{an>oe&&(ft.height+=an-oe,ft.y=oe),Jt<ke&&(ft.height=ke-an),x.splice(S,1);break}}}return x},t.findHostInstance=dL,t.findHostInstanceWithNoPortals=function(x){return x=N(x),x=x!==null?R(x):null,x===null?null:x.stateNode},t.findHostInstanceWithWarning=function(x){return dL(x)},t.flushControlled=function(x){var S=xn;xn|=1;var I=Wi.transition,k=cn;try{Wi.transition=null,cn=1,x()}finally{cn=k,Wi.transition=I,xn=S,xn===0&&(sf(),Bs())}},t.flushPassiveEffects=fh,t.flushSync=tL,t.focusWithin=function(x,S){if(!Q)throw Error(o(363));for(x=B2(x),S=QI(x,S),S=Array.from(S),x=0;x<S.length;){var I=S[x++];if(!K(I)){if(I.tag===5&&Ue(I.stateNode))return!0;for(I=I.child;I!==null;)S.push(I),I=I.sibling}}return!1},t.getCurrentUpdatePriority=function(){return cn},t.getFindAllNodesFailureDescription=function(x,S){if(!Q)throw Error(o(363));var I=0,k=[];x=[B2(x),0];for(var X=0;X<x.length;){var oe=x[X++],ke=x[X++],Ke=S[ke];if((oe.tag!==5||!K(oe))&&(z2(oe,Ke)&&(k.push(G2(Ke)),ke++,ke>I&&(I=ke)),ke<S.length))for(oe=oe.child;oe!==null;)x.push(oe,ke),oe=oe.sibling}if(I<S.length){for(x=[];I<S.length;I++)x.push(G2(S[I]));return`findAllNodes was able to match part of the selector:
  `+(k.join(" > ")+`

No matching component was found for:
  `)+x.join(" > ")}return null},t.getPublicRootInstance=function(x){if(x=x.current,!x.child)return null;switch(x.child.tag){case 5:return V(x.child.stateNode);default:return x.child.stateNode}},t.injectIntoDevTools=function(x){if(x={bundleType:x.bundleType,version:x.version,rendererPackageName:x.rendererPackageName,rendererConfig:x.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:E$,findFiberByHostInstance:x.findFiberByHostInstance||T$,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")x=!1;else{var S=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(S.isDisabled||!S.supportsFiber)x=!0;else{try{nh=S.inject(x),co=S}catch{}x=!!S.checkDCE}}return x},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(x,S,I,k){if(!Q)throw Error(o(363));x=V2(x,S);var X=ve(x,I,k).disconnect;return{disconnect:function(){X()}}},t.registerMutableSourceForHydration=function(x,S){var I=S._getVersion;I=I(S._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[S,I]:x.mutableSourceEagerHydrationData.push(S,I)},t.runWithPriority=function(x,S){var I=cn;try{return cn=x,S()}finally{cn=I}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(x,S,I,k){var X=S.current,oe=xs(),ke=Uc(X);return I=hL(I),S.context===null?S.context=I:S.pendingContext=I,S=Il(oe,ke),S.payload={element:x},k=k===void 0?null:k,k!==null&&(S.callback=k),Nc(X,S),x=Go(X,ke,oe),x!==null&&av(x,X,ke),ke},t};W8.exports=ZQ;var QQ=W8.exports;const JQ=o5(QQ),KR={},q8=i=>void Object.assign(KR,i);function eJ(i,e){function t(u,{args:h=[],attach:d,...f},p){let _=`${u[0].toUpperCase()}${u.slice(1)}`,v;if(u==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const g=f.object;v=rp(g,{type:u,root:p,attach:d,primitive:!0})}else{const g=KR[_];if(!g)throw new Error(`R3F: ${_} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");v=rp(new g(...h),{type:u,root:p,attach:d,memoizedProps:{args:h}})}return v.__r3f.attach===void 0&&(v.isBufferGeometry?v.__r3f.attach="geometry":v.isMaterial&&(v.__r3f.attach="material")),_!=="inject"&&pM(v,f),v}function n(u,h){let d=!1;if(h){var f,p;(f=h.__r3f)!=null&&f.attach?fM(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),d=!0),d||(p=u.__r3f)==null||p.objects.push(h),h.__r3f||rp(h,{}),h.__r3f.parent=u,nC(h),sp(h)}}function r(u,h,d){let f=!1;if(h){var p,_;if((p=h.__r3f)!=null&&p.attach)fM(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const v=u.children.filter(b=>b!==h),g=v.indexOf(d);u.children=[...v.slice(0,g),h,...v.slice(g)],f=!0}f||(_=u.__r3f)==null||_.objects.push(h),h.__r3f||rp(h,{}),h.__r3f.parent=u,nC(h),sp(h)}}function s(u,h,d=!1){u&&[...u].forEach(f=>o(h,f,d))}function o(u,h,d){if(h){var f,p,_;if(h.__r3f&&(h.__r3f.parent=null),(f=u.__r3f)!=null&&f.objects&&(u.__r3f.objects=u.__r3f.objects.filter(y=>y!==h)),(p=h.__r3f)!=null&&p.attach)iF(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var v;u.remove(h),(v=h.__r3f)!=null&&v.root&&oJ(Px(h),h)}const b=(_=h.__r3f)==null?void 0:_.primitive,m=!b&&(d===void 0?h.dispose!==null:d);if(!b){var g;s((g=h.__r3f)==null?void 0:g.objects,h,m),s(h.children,h,m)}if(delete h.__r3f,m&&h.dispose&&h.type!=="Scene"){const y=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?eC.unstable_scheduleCallback(eC.unstable_IdlePriority,y):y()}sp(u)}}function a(u,h,d,f){var p;const _=(p=u.__r3f)==null?void 0:p.parent;if(!_)return;const v=t(h,d,u.__r3f.root);if(u.children){for(const g of u.children)g.__r3f&&n(v,g);u.children=u.children.filter(g=>!g.__r3f)}u.__r3f.objects.forEach(g=>n(v,g)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||o(_,u),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),n(_,v),v.raycast&&v.__r3f.eventCount&&Px(v).getState().internal.interaction.push(v),[f,f.alternate].forEach(g=>{g!==null&&(g.stateNode=v,g.ref&&(typeof g.ref=="function"?g.ref(v):g.ref.current=v))})}const l=()=>{};return{reconciler:JQ({createInstance:t,removeChild:o,appendChild:n,appendInitialChild:n,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const d=u.getState().scene;d.__r3f&&(d.__r3f.root=u,n(d,h))},removeChildFromContainer:(u,h)=>{h&&o(u.getState().scene,h)},insertInContainerBefore:(u,h,d)=>{if(!h||!d)return;const f=u.getState().scene;f.__r3f&&r(f,h,d)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,d,f){var p;if(((p=u==null?void 0:u.__r3f)!=null?p:{}).primitive&&f.object&&f.object!==u)return[!0];{const{args:v=[],children:g,...b}=f,{args:m=[],children:y,...A}=d;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((M,T)=>M!==m[T]))return[!0];const w=tG(u,b,A,!0);return w.changes.length?[!1,w]:null}},commitUpdate(u,[h,d],f,p,_,v){h?a(u,f,_,v):pM(u,d)},commitMount(u,h,d,f){var p;const _=(p=u.__r3f)!=null?p:{};u.raycast&&_.handlers&&_.eventCount&&Px(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>rp(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:d,parent:f}=(h=u.__r3f)!=null?h:{};d&&f&&iF(f,u,d),u.isObject3D&&(u.visible=!1),sp(u)},unhideInstance(u,h){var d;const{attach:f,parent:p}=(d=u.__r3f)!=null?d:{};f&&p&&fM(p,u,f),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),sp(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():Mp.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&ci.fun(performance.now)?performance.now:ci.fun(Date.now)?Date.now:()=>0,scheduleTimeout:ci.fun(setTimeout)?setTimeout:void 0,cancelTimeout:ci.fun(clearTimeout)?clearTimeout:void 0}),applyProps:pM}}var JN,eF;const dM=i=>"colorSpace"in i||"outputColorSpace"in i,Y8=()=>{var i;return(i=KR.ColorManagement)!=null?i:null},K8=i=>i&&i.isOrthographicCamera,tJ=i=>i&&i.hasOwnProperty("current"),V1=typeof window<"u"&&((JN=window.document)!=null&&JN.createElement||((eF=window.navigator)==null?void 0:eF.product)==="ReactNative")?Re.useLayoutEffect:Re.useEffect;function Z8(i){const e=Re.useRef(i);return V1(()=>void(e.current=i),[i]),e}function nJ({set:i}){return V1(()=>(i(new Promise(()=>null)),()=>i(!1)),[i]),null}class Q8 extends Re.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}Q8.getDerivedStateFromError=()=>({error:!0});const J8="__default",tF=new Map,iJ=i=>i&&!!i.memoized&&!!i.changes;function eG(i){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(i)?Math.min(Math.max(i[0],t),i[1]):i}const Cg=i=>{var e;return(e=i.__r3f)==null?void 0:e.root.getState()};function Px(i){let e=i.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const ci={obj:i=>i===Object(i)&&!ci.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",boo:i=>typeof i=="boolean",und:i=>i===void 0,arr:i=>Array.isArray(i),equ(i,e,{arrays:t="shallow",objects:n="reference",strict:r=!0}={}){if(typeof i!=typeof e||!!i!=!!e)return!1;if(ci.str(i)||ci.num(i)||ci.boo(i))return i===e;const s=ci.obj(i);if(s&&n==="reference")return i===e;const o=ci.arr(i);if(o&&t==="reference")return i===e;if((o||s)&&i===e)return!0;let a;for(a in i)if(!(a in e))return!1;if(s&&t==="shallow"&&n==="shallow"){for(a in r?e:i)if(!ci.equ(i[a],e[a],{strict:r,objects:"reference"}))return!1}else for(a in r?e:i)if(i[a]!==e[a])return!1;if(ci.und(a)){if(o&&i.length===0&&e.length===0||s&&Object.keys(i).length===0&&Object.keys(e).length===0)return!0;if(i!==e)return!1}return!0}};function rJ(i){i.dispose&&i.type!=="Scene"&&i.dispose();for(const e in i)e.dispose==null||e.dispose(),delete i[e]}function rp(i,e){const t=i;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},i}function tC(i,e){let t=i;if(e.includes("-")){const n=e.split("-"),r=n.pop();return t=n.reduce((s,o)=>s[o],i),{target:t,key:r}}else return{target:t,key:e}}const nF=/-\d+$/;function fM(i,e,t){if(ci.str(t)){if(nF.test(t)){const s=t.replace(nF,""),{target:o,key:a}=tC(i,s);Array.isArray(o[a])||(o[a]=[])}const{target:n,key:r}=tC(i,t);e.__r3f.previousAttach=n[r],n[r]=e}else e.__r3f.previousAttach=t(i,e)}function iF(i,e,t){var n,r;if(ci.str(t)){const{target:s,key:o}=tC(i,t),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(n=e.__r3f)==null||n.previousAttach==null||n.previousAttach(i,e);(r=e.__r3f)==null||delete r.previousAttach}function tG(i,{children:e,key:t,ref:n,...r},{children:s,key:o,ref:a,...l}={},c=!1){const u=i.__r3f,h=Object.entries(r),d=[];if(c){const p=Object.keys(l);for(let _=0;_<p.length;_++)r.hasOwnProperty(p[_])||h.unshift([p[_],J8+"remove"])}h.forEach(([p,_])=>{var v;if((v=i.__r3f)!=null&&v.primitive&&p==="object"||ci.equ(_,l[p]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p))return d.push([p,_,!0,[]]);let g=[];p.includes("-")&&(g=p.split("-")),d.push([p,_,!1,g]);for(const b in r){const m=r[b];b.startsWith(`${p}-`)&&d.push([b,m,!1,b.split("-")])}});const f={...r};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(f.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(f.attach=u.memoizedProps.attach),{memoized:f,changes:d}}function pM(i,e){var t;const n=i.__r3f,r=n==null?void 0:n.root,s=r==null||r.getState==null?void 0:r.getState(),{memoized:o,changes:a}=iJ(e)?e:tG(i,e),l=n==null?void 0:n.eventCount;i.__r3f&&(i.__r3f.memoizedProps=o);for(let d=0;d<a.length;d++){let[f,p,_,v]=a[d];if(dM(i)){const y="srgb",A="srgb-linear";f==="encoding"?(f="colorSpace",p=p===3001?y:A):f==="outputEncoding"&&(f="outputColorSpace",p=p===3001?y:A)}let g=i,b=g[f];if(v.length&&(b=v.reduce((m,y)=>m[y],i),!(b&&b.set))){const[m,...y]=v.reverse();g=y.reverse().reduce((A,w)=>A[w],i),f=m}if(p===J8+"remove")if(g.constructor){let m=tF.get(g.constructor);m||(m=new g.constructor,tF.set(g.constructor,m)),p=m[f]}else p=0;if(_&&n)p?n.handlers[f]=p:delete n.handlers[f],n.eventCount=Object.keys(n.handlers).length;else if(b&&b.set&&(b.copy||b instanceof ad)){if(Array.isArray(p))b.fromArray?b.fromArray(p):b.set(...p);else if(b.copy&&p&&p.constructor&&b.constructor===p.constructor)b.copy(p);else if(p!==void 0){var c;const m=(c=b)==null?void 0:c.isColor;!m&&b.setScalar?b.setScalar(p):b instanceof ad&&p instanceof ad?b.mask=p.mask:b.set(p),!Y8()&&s&&!s.linear&&m&&b.convertSRGBToLinear()}}else{var u;if(g[f]=p,(u=g[f])!=null&&u.isTexture&&g[f].format===Ps&&g[f].type===ml&&s){const m=g[f];dM(m)&&dM(s.gl)?m.colorSpace=s.gl.outputColorSpace:m.encoding=s.gl.outputEncoding}}sp(i)}if(n&&n.parent&&i.raycast&&l!==n.eventCount){const d=Px(i).getState().internal,f=d.interaction.indexOf(i);f>-1&&d.interaction.splice(f,1),n.eventCount&&d.interaction.push(i)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(t=i.__r3f)!=null&&t.parent&&nC(i),i}function sp(i){var e,t;const n=(e=i.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function nC(i){i.onUpdate==null||i.onUpdate(i)}function nG(i,e){i.manual||(K8(i)?(i.left=e.width/-2,i.right=e.width/2,i.top=e.height/2,i.bottom=e.height/-2):i.aspect=e.width/e.height,i.updateProjectionMatrix(),i.updateMatrixWorld())}function ty(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function sJ(){var i;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return Mp.DefaultEventPriority;switch((i=e.event)==null?void 0:i.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Mp.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Mp.ContinuousEventPriority;default:return Mp.DefaultEventPriority}}function iG(i,e,t,n){const r=t.get(e);r&&(t.delete(e),t.size===0&&(i.delete(n),r.target.releasePointerCapture(n)))}function oJ(i,e){const{internal:t}=i.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,r)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((n,r)=>{iG(t.capturedMap,e,n,r)})}function aJ(i){function e(l){const{internal:c}=i.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function t(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function n(l,c){const u=i.getState(),h=new Set,d=[],f=c?c(u.internal.interaction):u.internal.interaction;for(let g=0;g<f.length;g++){const b=Cg(f[g]);b&&(b.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function p(g){const b=Cg(g);if(!b||!b.events.enabled||b.raycaster.camera===null)return[];if(b.raycaster.camera===void 0){var m;b.events.compute==null||b.events.compute(l,b,(m=b.previousRoot)==null?void 0:m.getState()),b.raycaster.camera===void 0&&(b.raycaster.camera=null)}return b.raycaster.camera?b.raycaster.intersectObject(g,!0):[]}let _=f.flatMap(p).sort((g,b)=>{const m=Cg(g.object),y=Cg(b.object);return!m||!y?g.distance-b.distance:y.events.priority-m.events.priority||g.distance-b.distance}).filter(g=>{const b=ty(g);return h.has(b)?!1:(h.add(b),!0)});u.events.filter&&(_=u.events.filter(_,u));for(const g of _){let b=g.object;for(;b;){var v;(v=b.__r3f)!=null&&v.eventCount&&d.push({...g,eventObject:b}),b=b.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let g of u.internal.capturedMap.get(l.pointerId).values())h.has(ty(g.intersection))||d.push(g.intersection);return d}function r(l,c,u,h){const d=i.getState();if(l.length){const f={stopped:!1};for(const p of l){const _=Cg(p.object)||d,{raycaster:v,pointer:g,camera:b,internal:m}=_,y=new Te(g.x,g.y,0).unproject(b),A=C=>{var N,P;return(N=(P=m.capturedMap.get(C))==null?void 0:P.has(p.eventObject))!=null?N:!1},w=C=>{const N={intersection:p,target:c.target};m.capturedMap.has(C)?m.capturedMap.get(C).set(p.eventObject,N):m.capturedMap.set(C,new Map([[p.eventObject,N]])),c.target.setPointerCapture(C)},M=C=>{const N=m.capturedMap.get(C);N&&iG(m.capturedMap,p.eventObject,N,C)};let T={};for(let C in c){let N=c[C];typeof N!="function"&&(T[C]=N)}let E={...p,...T,pointer:g,intersections:l,stopped:f.stopped,delta:u,unprojectedPoint:y,ray:v.ray,camera:b,stopPropagation(){const C="pointerId"in c&&m.capturedMap.get(c.pointerId);if((!C||C.has(p.eventObject))&&(E.stopped=f.stopped=!0,m.hovered.size&&Array.from(m.hovered.values()).find(N=>N.eventObject===p.eventObject))){const N=l.slice(0,l.indexOf(p));s([...N,p])}},target:{hasPointerCapture:A,setPointerCapture:w,releasePointerCapture:M},currentTarget:{hasPointerCapture:A,setPointerCapture:w,releasePointerCapture:M},nativeEvent:c};if(h(E),f.stopped===!0)break}}return l}function s(l){const{internal:c}=i.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f,f=d==null?void 0:d.handlers;if(c.hovered.delete(ty(u)),d!=null&&d.eventCount){const p={...u,intersections:l};f.onPointerOut==null||f.onPointerOut(p),f.onPointerLeave==null||f.onPointerLeave(p)}}}function o(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function a(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=i.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=i.getState();d.lastEvent.current=u;const f=l==="onPointerMove",p=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",v=n(u,f?t:void 0),g=p?e(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=v.map(m=>m.eventObject)),p&&!v.length&&g<=2&&(o(u,d.interaction),h&&h(u)),f&&s(v);function b(m){const y=m.eventObject,A=y.__r3f,w=A==null?void 0:A.handlers;if(A!=null&&A.eventCount)if(f){if(w.onPointerOver||w.onPointerEnter||w.onPointerOut||w.onPointerLeave){const M=ty(m),T=d.hovered.get(M);T?T.stopped&&m.stopPropagation():(d.hovered.set(M,m),w.onPointerOver==null||w.onPointerOver(m),w.onPointerEnter==null||w.onPointerEnter(m))}w.onPointerMove==null||w.onPointerMove(m)}else{const M=w[l];M?(!p||d.initialHits.includes(y))&&(o(u,d.interaction.filter(T=>!d.initialHits.includes(T))),M(m)):p&&d.initialHits.includes(y)&&o(u,d.interaction.filter(T=>!d.initialHits.includes(T)))}}r(v,u,g,b)}}return{handlePointer:a}}const lJ=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],rG=i=>!!(i!=null&&i.render),ZR=Re.createContext(null),cJ=(i,e)=>{const t=$8((a,l)=>{const c=new Te,u=new Te,h=new Te;function d(g=l().camera,b=u,m=l().size){const{width:y,height:A,top:w,left:M}=m,T=y/A;b.isVector3?h.copy(b):h.set(...b);const E=g.getWorldPosition(c).distanceTo(h);if(K8(g))return{width:y/g.zoom,height:A/g.zoom,top:w,left:M,factor:1,distance:E,aspect:T};{const C=g.fov*Math.PI/180,N=2*Math.tan(C/2)*E,P=N*(y/A);return{width:P,height:N,top:w,left:M,factor:y/P,distance:E,aspect:T}}}let f;const p=g=>a(b=>({performance:{...b.performance,current:g}})),_=new yt;return{set:a,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(g=1)=>i(l(),g),advance:(g,b)=>e(g,b,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new jR,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const g=l();f&&clearTimeout(f),g.performance.current!==g.performance.min&&p(g.performance.min),f=setTimeout(()=>p(l().performance.max),g.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:g=>a(b=>({...b,events:{...b.events,...g}})),setSize:(g,b,m,y,A)=>{const w=l().camera,M={width:g,height:b,top:y||0,left:A||0,updateStyle:m};a(T=>({size:M,viewport:{...T.viewport,...d(w,u,M)}}))},setDpr:g=>a(b=>{const m=eG(g);return{viewport:{...b.viewport,dpr:m,initialDpr:b.viewport.initialDpr||m}}}),setFrameloop:(g="always")=>{const b=l().clock;b.stop(),b.elapsedTime=0,g!=="never"&&(b.start(),b.elapsedTime=0),a(()=>({frameloop:g}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:Re.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(g,b,m)=>{const y=l().internal;return y.priority=y.priority+(b>0?1:0),y.subscribers.push({ref:g,priority:b,store:m}),y.subscribers=y.subscribers.sort((A,w)=>A.priority-w.priority),()=>{const A=l().internal;A!=null&&A.subscribers&&(A.priority=A.priority-(b>0?1:0),A.subscribers=A.subscribers.filter(w=>w.ref!==g))}}}}}),n=t.getState();let r=n.size,s=n.viewport.dpr,o=n.camera;return t.subscribe(()=>{const{camera:a,size:l,viewport:c,gl:u,set:h}=t.getState();if(l.width!==r.width||l.height!==r.height||c.dpr!==s){var d;r=l,s=c.dpr,nG(a,l),u.setPixelRatio(c.dpr);const f=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,f)}a!==o&&(o=a,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>i(a)),t};let ny,uJ=new Set,hJ=new Set,dJ=new Set;function mM(i,e){if(i.size)for(const{callback:t}of i.values())t(e)}function Pg(i,e){switch(i){case"before":return mM(uJ,e);case"after":return mM(hJ,e);case"tail":return mM(dJ,e)}}let gM,vM;function _M(i,e,t){let n=e.clock.getDelta();for(e.frameloop==="never"&&typeof i=="number"&&(n=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),gM=e.internal.subscribers,ny=0;ny<gM.length;ny++)vM=gM[ny],vM.ref.current(vM.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function fJ(i){let e=!1,t=!1,n,r,s;function o(c){r=requestAnimationFrame(o),e=!0,n=0,Pg("before",c),t=!0;for(const h of i.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(n+=_M(c,s))}if(t=!1,Pg("after",c),n===0)return Pg("tail",c),e=!1,cancelAnimationFrame(r)}function a(c,u=1){var h;if(!c)return i.forEach(d=>a(d.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):t?c.internal.frames=2:c.internal.frames=1,e||(e=!0,requestAnimationFrame(o)))}function l(c,u=!0,h,d){if(u&&Pg("before",c),h)_M(c,h,d);else for(const f of i.values())_M(c,f.store.getState());u&&Pg("after",c)}return{loop:o,invalidate:a,advance:l}}function QR(){const i=Re.useContext(ZR);if(!i)throw new Error("R3F: Hooks can only be used within the Canvas component!");return i}function Ci(i=t=>t,e){return QR()(i,e)}function no(i,e=0){const t=QR(),n=t.getState().internal.subscribe,r=Z8(i);return V1(()=>n(r,e,t),[e,n,t]),null}const cm=new Map,{invalidate:rF,advance:sF}=fJ(cm),{reconciler:p1,applyProps:Cf}=eJ(cm,sJ),Pf={objects:"shallow",strict:!1},pJ=(i,e)=>{const t=typeof i=="function"?i(e):i;return rG(t)?t:new bR({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...i})};function mJ(i,e){const t=typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement;if(e){const{width:n,height:r,top:s,left:o,updateStyle:a=t}=e;return{width:n,height:r,top:s,left:o,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement&&i.parentElement){const{width:n,height:r,top:s,left:o}=i.parentElement.getBoundingClientRect();return{width:n,height:r,top:s,left:o,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function gJ(i){const e=cm.get(i),t=e==null?void 0:e.fiber,n=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,s=n||cJ(rF,sF),o=t||p1.createContainer(s,Mp.ConcurrentRoot,null,!1,null,"",r,null);e||cm.set(i,{fiber:o,store:s});let a,l=!1,c;return{configure(u={}){let{gl:h,size:d,scene:f,events:p,onCreated:_,shadows:v=!1,linear:g=!1,flat:b=!1,legacy:m=!1,orthographic:y=!1,frameloop:A="always",dpr:w=[1,2],performance:M,raycaster:T,camera:E,onPointerMissed:C}=u,N=s.getState(),P=N.gl;N.gl||N.set({gl:P=pJ(h,i)});let L=N.raycaster;L||N.set({raycaster:L=new YR});const{params:R,...F}=T||{};if(ci.equ(F,L,Pf)||Cf(L,{...F}),ci.equ(R,L.params,Pf)||Cf(L,{params:{...L.params,...R}}),!N.camera||N.camera===c&&!ci.equ(c,E,Pf)){c=E;const O=E instanceof k1,D=O?E:y?new Ku(0,0,0,0,.1,1e3):new Zi(75,0,.1,1e3);O||(D.position.z=5,E&&(Cf(D,E),("aspect"in E||"left"in E||"right"in E||"bottom"in E||"top"in E)&&(D.manual=!0,D.updateProjectionMatrix())),!N.camera&&!(E!=null&&E.rotation)&&D.lookAt(0,0,0)),N.set({camera:D}),L.camera=D}if(!N.scene){let O;f!=null&&f.isScene?O=f:(O=new SR,f&&Cf(O,f)),N.set({scene:rp(O)})}if(!N.xr){var V;const O=(W,q)=>{const j=s.getState();j.frameloop!=="never"&&sF(W,!0,j,q)},D=()=>{const W=s.getState();W.gl.xr.enabled=W.gl.xr.isPresenting,W.gl.xr.setAnimationLoop(W.gl.xr.isPresenting?O:null),W.gl.xr.isPresenting||rF(W)},B={connect(){const W=s.getState().gl;W.xr.addEventListener("sessionstart",D),W.xr.addEventListener("sessionend",D)},disconnect(){const W=s.getState().gl;W.xr.removeEventListener("sessionstart",D),W.xr.removeEventListener("sessionend",D)}};typeof((V=P.xr)==null?void 0:V.addEventListener)=="function"&&B.connect(),N.set({xr:B})}if(P.shadowMap){const O=P.shadowMap.enabled,D=P.shadowMap.type;if(P.shadowMap.enabled=!!v,ci.boo(v))P.shadowMap.type=x0;else if(ci.str(v)){var G;const B={basic:Sz,percentage:fS,soft:x0,variance:wa};P.shadowMap.type=(G=B[v])!=null?G:x0}else ci.obj(v)&&Object.assign(P.shadowMap,v);(O!==P.shadowMap.enabled||D!==P.shadowMap.type)&&(P.shadowMap.needsUpdate=!0)}const U=Y8();U&&("enabled"in U?U.enabled=!m:"legacyMode"in U&&(U.legacyMode=m)),l||Cf(P,{outputEncoding:g?3e3:3001,toneMapping:b?pl:eR}),N.legacy!==m&&N.set(()=>({legacy:m})),N.linear!==g&&N.set(()=>({linear:g})),N.flat!==b&&N.set(()=>({flat:b})),h&&!ci.fun(h)&&!rG(h)&&!ci.equ(h,P,Pf)&&Cf(P,h),p&&!N.events.handlers&&N.set({events:p(s)});const z=mJ(i,d);return ci.equ(z,N.size,Pf)||N.setSize(z.width,z.height,z.updateStyle,z.top,z.left),w&&N.viewport.dpr!==eG(w)&&N.setDpr(w),N.frameloop!==A&&N.setFrameloop(A),N.onPointerMissed||N.set({onPointerMissed:C}),M&&!ci.equ(M,N.performance,Pf)&&N.set(O=>({performance:{...O.performance,...M}})),a=_,l=!0,this},render(u){return l||this.configure(),p1.updateContainer(_e.jsx(vJ,{store:s,children:u,onCreated:a,rootElement:i}),o,null,()=>{}),s},unmount(){sG(i)}}}function vJ({store:i,children:e,onCreated:t,rootElement:n}){return V1(()=>{const r=i.getState();r.set(s=>({internal:{...s.internal,active:!0}})),t&&t(r),i.getState().events.connected||r.events.connect==null||r.events.connect(n)},[]),_e.jsx(ZR.Provider,{value:i,children:e})}function sG(i,e){const t=cm.get(i),n=t==null?void 0:t.fiber;if(n){const r=t==null?void 0:t.store.getState();r&&(r.internal.active=!1),p1.updateContainer(null,n,null,()=>{r&&setTimeout(()=>{try{var s,o,a,l;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=r.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(l=r.gl)!=null&&l.xr&&r.xr.disconnect(),rJ(r),cm.delete(i)}catch{}},500)})}}function oF(i,e,t){return _e.jsx(_J,{children:i,container:e,state:t},e.uuid)}function _J({state:i={},children:e,container:t}){const{events:n,size:r,...s}=i,o=QR(),[a]=Re.useState(()=>new YR),[l]=Re.useState(()=>new yt),c=Re.useCallback((h,d)=>{const f={...h};Object.keys(h).forEach(_=>{(lJ.includes(_)||h[_]!==d[_]&&d[_])&&delete f[_]});let p;if(d&&r){const _=d.camera;p=h.viewport.getCurrentViewport(_,new Te,r),_!==h.camera&&nG(_,r)}return{...f,scene:t,raycaster:a,pointer:l,mouse:l,previousRoot:o,events:{...h.events,...d==null?void 0:d.events,...n},size:{...h.size,...r},viewport:{...h.viewport,...p},...s}},[i]),[u]=Re.useState(()=>{const h=o.getState();return $8((f,p)=>({...h,scene:t,raycaster:a,pointer:l,mouse:l,previousRoot:o,events:{...h.events,...n},size:{...h.size,...r},...s,set:f,get:p,setEvents:_=>f(v=>({...v,events:{...v.events,..._}}))}))});return Re.useEffect(()=>{const h=o.subscribe(d=>u.setState(f=>c(d,f)));return()=>{h()}},[c]),Re.useEffect(()=>{u.setState(h=>c(o.getState(),h))},[c]),Re.useEffect(()=>()=>{u.destroy()},[]),_e.jsx(_e.Fragment,{children:p1.createPortal(_e.jsx(ZR.Provider,{value:u,children:e}),u,null)})}p1.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:Re.version});const yM={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function yJ(i){const{handlePointer:e}=aJ(i);return{priority:1,enabled:!0,compute(t,n,r){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(yM).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:r}=i.getState();(t=r.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:s}=i.getState();s.disconnect==null||s.disconnect(),r(o=>({events:{...o.events,connected:t}})),Object.entries((n=s.handlers)!=null?n:[]).forEach(([o,a])=>{const[l,c]=yM[o];t.addEventListener(l,a,{passive:c})})},disconnect:()=>{const{set:t,events:n}=i.getState();if(n.connected){var r;Object.entries((r=n.handlers)!=null?r:[]).forEach(([s,o])=>{if(n&&n.connected instanceof HTMLElement){const[a]=yM[s];n.connected.removeEventListener(a,o)}}),t(s=>({events:{...s.events,connected:void 0}}))}}}}function aF(i,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>i(...n),e)}}function xJ({debounce:i,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const r=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=Re.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=Re.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=i?typeof i=="number"?i:i.scroll:null,c=i?typeof i=="number"?i:i.resize:null,u=Re.useRef(!1);Re.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,f]=Re.useMemo(()=>{const g=()=>{if(!a.current.element)return;const{left:b,top:m,width:y,height:A,bottom:w,right:M,x:T,y:E}=a.current.element.getBoundingClientRect(),C={left:b,top:m,width:y,height:A,bottom:w,right:M,x:T,y:E};a.current.element instanceof HTMLElement&&n&&(C.height=a.current.element.offsetHeight,C.width=a.current.element.offsetWidth),Object.freeze(C),u.current&&!MJ(a.current.lastBounds,C)&&o(a.current.lastBounds=C)};return[g,c?aF(g,c):g,l?aF(g,l):g]},[o,n,l,c]);function p(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(g=>g.removeEventListener("scroll",f,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function _(){a.current.element&&(a.current.resizeObserver=new r(f),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(g=>g.addEventListener("scroll",f,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const v=g=>{!g||g===a.current.element||(p(),a.current.element=g,a.current.scrollContainers=oG(g),_())};return SJ(f,!!e),bJ(d),Re.useEffect(()=>{p(),_()},[e,f,d]),Re.useEffect(()=>p,[]),[v,s,h]}function bJ(i){Re.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function SJ(i,e){Re.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function oG(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:r}=window.getComputedStyle(i);return[t,n,r].some(s=>s==="auto"||s==="scroll")&&e.push(i),[...e,...oG(i.parentElement)]}const wJ=["x","y","top","bottom","left","right","width","height"],MJ=(i,e)=>wJ.every(t=>i[t]===e[t]);var AJ=Object.defineProperty,EJ=Object.defineProperties,TJ=Object.getOwnPropertyDescriptors,lF=Object.getOwnPropertySymbols,CJ=Object.prototype.hasOwnProperty,PJ=Object.prototype.propertyIsEnumerable,cF=(i,e,t)=>e in i?AJ(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,uF=(i,e)=>{for(var t in e||(e={}))CJ.call(e,t)&&cF(i,t,e[t]);if(lF)for(var t of lF(e))PJ.call(e,t)&&cF(i,t,e[t]);return i},RJ=(i,e)=>EJ(i,TJ(e)),hF,dF;typeof window<"u"&&((hF=window.document)!=null&&hF.createElement||((dF=window.navigator)==null?void 0:dF.product)==="ReactNative")?Re.useLayoutEffect:Re.useEffect;function aG(i,e,t){if(!i)return;if(t(i)===!0)return i;let n=i.child;for(;n;){const r=aG(n,e,t);if(r)return r;n=n.sibling}}function lG(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const fF=console.error;console.error=function(){const i=[...arguments].join("");if(i!=null&&i.startsWith("Warning:")&&i.includes("useContext")){console.error=fF;return}return fF.apply(this,arguments)};const JR=lG(Re.createContext(null));class cG extends Re.Component{render(){return Re.createElement(JR.Provider,{value:this._reactInternals},this.props.children)}}function IJ(){const i=Re.useContext(JR);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Re.useId();return Re.useMemo(()=>{for(const n of[i,i==null?void 0:i.alternate]){if(!n)continue;const r=aG(n,!1,s=>{let o=s.memoizedState;for(;o;){if(o.memoizedState===e)return!0;o=o.next}});if(r)return r}},[i,e])}function LJ(){const i=IJ(),[e]=Re.useState(()=>new Map);e.clear();let t=i;for(;t;){if(t.type&&typeof t.type=="object"){const r=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;r&&r!==JR&&!e.has(r)&&e.set(r,Re.useContext(lG(r)))}t=t.return}return e}function DJ(){const i=LJ();return Re.useMemo(()=>Array.from(i.keys()).reduce((e,t)=>n=>Re.createElement(e,null,Re.createElement(t.Provider,RJ(uF({},n),{value:i.get(t)}))),e=>Re.createElement(cG,uF({},e))),[i])}const NJ=Re.forwardRef(function({children:e,fallback:t,resize:n,style:r,gl:s,events:o=yJ,eventSource:a,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:_,performance:v,raycaster:g,camera:b,scene:m,onPointerMissed:y,onCreated:A,...w},M){Re.useMemo(()=>q8($Q),[]);const T=DJ(),[E,C]=xJ({scroll:!0,debounce:{scroll:50,resize:0},...n}),N=Re.useRef(null),P=Re.useRef(null);Re.useImperativeHandle(M,()=>N.current);const L=Z8(y),[R,F]=Re.useState(!1),[V,G]=Re.useState(!1);if(R)throw R;if(V)throw V;const U=Re.useRef(null);V1(()=>{const O=N.current;C.width>0&&C.height>0&&O&&(U.current||(U.current=gJ(O)),U.current.configure({gl:s,events:o,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:_,performance:v,raycaster:g,camera:b,scene:m,size:C,onPointerMissed:(...D)=>L.current==null?void 0:L.current(...D),onCreated:D=>{D.events.connect==null||D.events.connect(a?tJ(a)?a.current:a:P.current),l&&D.setEvents({compute:(B,W)=>{const q=B[l+"X"],j=B[l+"Y"];W.pointer.set(q/W.size.width*2-1,-(j/W.size.height)*2+1),W.raycaster.setFromCamera(W.pointer,W.camera)}}),A==null||A(D)}}),U.current.render(_e.jsx(T,{children:_e.jsx(Q8,{set:G,children:_e.jsx(Re.Suspense,{fallback:_e.jsx(nJ,{set:F}),children:e??null})})})))}),Re.useEffect(()=>{const O=N.current;if(O)return()=>sG(O)},[]);const z=a?"none":"auto";return _e.jsx("div",{ref:P,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:z,...r},...w,children:_e.jsx("div",{ref:E,style:{width:"100%",height:"100%"},children:_e.jsx("canvas",{ref:N,style:{display:"block"},children:t})})})}),uG=Re.forwardRef(function(e,t){return _e.jsx(cG,{children:_e.jsx(NJ,{...e,ref:t})})});function FJ(i){let e;const t=new Set,n=(c,u)=>{const h=typeof c=="function"?c(e):c;if(h!==e){const d=e;e=u?h:Object.assign({},e,h),t.forEach(f=>f(e,d))}},r=()=>e,s=(c,u=r,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(e);function f(){const p=u(e);if(!h(d,p)){const _=d;c(d=p,_)}}return t.add(f),()=>t.delete(f)},l={setState:n,getState:r,subscribe:(c,u,h)=>u||h?s(c,u,h):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=i(n,r,l),l}const kJ=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),pF=kJ?Re.useEffect:Re.useLayoutEffect;function hG(i){const e=typeof i=="function"?FJ(i):i,t=(n=e.getState,r=Object.is)=>{const[,s]=Re.useReducer(v=>v+1,0),o=e.getState(),a=Re.useRef(o),l=Re.useRef(n),c=Re.useRef(r),u=Re.useRef(!1),h=Re.useRef();h.current===void 0&&(h.current=n(o));let d,f=!1;(a.current!==o||l.current!==n||c.current!==r||u.current)&&(d=n(o),f=!r(h.current,d)),pF(()=>{f&&(h.current=d),a.current=o,l.current=n,c.current=r,u.current=!1});const p=Re.useRef(o);pF(()=>{const v=()=>{try{const b=e.getState(),m=l.current(b);c.current(h.current,m)||(a.current=b,h.current=m,s())}catch{u.current=!0,s()}},g=e.subscribe(v);return e.getState()!==p.current&&v(),g},[]);const _=f?d:h.current;return Re.useDebugValue(_),_};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const r=n.length<=0;return{value:n.shift(),done:r}}}},t}class UJ extends To{constructor(e,t){super(),this.inputSource=null,this.xrControllerModel=null,this.index=e,this.controller=t.xr.getController(e),this.grip=t.xr.getControllerGrip(e),this.hand=t.xr.getHand(e),this.grip.userData.name="grip",this.controller.userData.name="controller",this.hand.userData.name="hand",this.visible=!1,this.add(this.controller,this.grip,this.hand),this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.controller.addEventListener("connected",this._onConnected),this.controller.addEventListener("disconnected",this._onDisconnected)}_onConnected(e){e.fake||e.data&&(this.visible=!0,this.inputSource=e.data,this.dispatchEvent(e))}_onDisconnected(e){e.fake||(this.visible=!1,this.inputSource=null,this.dispatchEvent(e))}dispose(){this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}var mF,gF;const OJ=i=>Array.from(new Set(i)),Ca=typeof window<"u"&&((mF=window.document)!=null&&mF.createElement||((gF=window.navigator)==null?void 0:gF.product)==="ReactNative")?Re.useLayoutEffect:Re.useEffect;function ul(i){const e=Re.useRef(i);return Ca(()=>void(e.current=i),[i]),e}function Rf(i,e,{handedness:t}={}){const n=ul(e),r=Vi(s=>s.controllers);Ca(()=>{const s=r.map(o=>{if(t&&o.inputSource&&o.inputSource.handedness!==t)return;const a=l=>n.current({nativeEvent:l,target:o});return o.controller.addEventListener(i,a),()=>o.controller.removeEventListener(i,a)});return()=>s.forEach(o=>o==null?void 0:o())},[r,t,i])}const vF=new en;function BJ({children:i}){const e=Ci(h=>h.events),t=Ci(h=>h.get),n=Ci(h=>h.raycaster),r=Vi(h=>h.controllers),s=Vi(h=>h.interactions),o=Vi(h=>h.hoverState),a=Vi(h=>h.hasInteraction),l=Vi(h=>h.getInteraction),c=Re.useCallback(h=>{const d=Array.from(s.keys());return vF.identity().extractRotation(h.matrixWorld),n.ray.origin.setFromMatrixPosition(h.matrixWorld),n.ray.direction.set(0,0,-1).applyMatrix4(vF),n.intersectObjects(d,!0)},[s,n]);no(()=>{var h;if(s.size!==0)for(const d of r){if(!((h=d.inputSource)!=null&&h.handedness))return;const f=o[d.inputSource.handedness],p=new Set;let _=c(d.controller);if(e.filter)_=e.filter(_,t());else{const v=_.find(g=>g==null?void 0:g.object);v&&(_=[v])}for(const v of _){let g=v.object;for(;g;){if(a(g,"onHover")&&!f.has(g)){const m=l(g,"onHover");for(const y of m)y({target:d,intersection:v,intersections:_})}const b=l(g,"onMove");b==null||b.forEach(m=>m({target:d,intersection:v,intersections:_})),f.set(g,v),p.add(g.id),g=g.parent}}for(const v of f.keys())if(!p.has(v.id)){f.delete(v);const g=l(v,"onBlur");if(!g)continue;for(const b of g)b({target:d,intersections:_})}}});const u=Re.useCallback(h=>d=>{var f;if(!((f=d.target.inputSource)!=null&&f.handedness))return;const p=o[d.target.inputSource.handedness],_=Array.from(new Set(p.values()));s.forEach((v,g)=>{var b,m,y;if(p.has(g)){if(!v[h])return;for(const A of v[h])(b=A.current)==null||b.call(A,{target:d.target,intersection:p.get(g),intersections:_})}else if(h==="onSelect"&&v.onSelectMissed)for(const A of v.onSelectMissed)(m=A.current)==null||m.call(A,{target:d.target,intersections:_});else if(h==="onSqueeze"&&v.onSqueezeMissed)for(const A of v.onSqueezeMissed)(y=A.current)==null||y.call(A,{target:d.target,intersections:_})})},[o,s]);return Rf("select",u("onSelect")),Rf("selectstart",u("onSelectStart")),Rf("selectend",u("onSelectEnd")),Rf("squeeze",u("onSqueeze")),Rf("squeezeend",u("onSqueezeEnd")),Rf("squeezestart",u("onSqueezeStart")),Re.createElement(Re.Fragment,null,i)}function pa(i,e,t){const n=Vi(o=>o.addInteraction),r=Vi(o=>o.removeInteraction),s=ul(t);Ca(()=>{const o=i.current;if(!(!o||!s.current))return n(o,e,s),()=>r(o,e,s)},[i,e,n,r])}const zJ=Re.forwardRef(function({onHover:e,onBlur:t,onSelectStart:n,onSelectEnd:r,onSelectMissed:s,onSelect:o,onSqueezeStart:a,onSqueezeEnd:l,onSqueezeMissed:c,onSqueeze:u,onMove:h,children:d},f){const p=Re.useRef(null);return Re.useImperativeHandle(f,()=>p.current),pa(p,"onHover",e),pa(p,"onBlur",t),pa(p,"onSelectStart",n),pa(p,"onSelectEnd",r),pa(p,"onSelectMissed",s),pa(p,"onSelect",o),pa(p,"onSqueezeStart",a),pa(p,"onSqueezeEnd",l),pa(p,"onSqueezeMissed",c),pa(p,"onSqueeze",u),pa(p,"onMove",h),Re.createElement("group",{ref:p},d)});Re.forwardRef(function({onSelectStart:e,onSelectEnd:t,children:n,...r},s){const o=Re.useRef(),a=Re.useRef(null),l=Re.useMemo(()=>new en,[]);return Re.useImperativeHandle(s,()=>a.current),no(()=>{const c=o.current,u=a.current;c&&(u.applyMatrix4(l),u.applyMatrix4(c.matrixWorld),u.updateMatrixWorld(),l.copy(c.matrixWorld).invert())}),Re.createElement(zJ,{ref:a,onSelectStart:c=>{o.current=c.target.controller,l.copy(c.target.controller.matrixWorld).invert(),e==null||e(c)},onSelectEnd:c=>{c.target.controller===o.current&&(o.current=void 0),t==null||t(c)},...r},n)});const dG=Re.createContext(null),ud=hG((i,e)=>({set:i,get:e,session:null,referenceSpaceType:null}));function GJ({foveation:i=0,frameRate:e=void 0,referenceSpace:t="local-floor",onSessionStart:n,onSessionEnd:r,onVisibilityChange:s,onInputSourcesChange:o,children:a}){const l=Ci(m=>m.gl),c=Ci(m=>m.camera),u=Vi(m=>m.player),h=Vi(m=>m.get),d=Vi(m=>m.set),f=Vi(m=>m.session),p=Vi(m=>m.controllers),_=ul(n),v=ul(r),g=ul(s),b=ul(o);return Ca(()=>{const m=[0,1].map(y=>{const A=new UJ(y,l),w=()=>d(T=>({controllers:[...T.controllers,A]})),M=()=>d(T=>({controllers:T.controllers.filter(E=>E!==A)}));return A.addEventListener("connected",w),A.addEventListener("disconnected",M),()=>{A.removeEventListener("connected",w),A.removeEventListener("disconnected",M)}});return()=>m.forEach(y=>y())},[l,d]),Ca(()=>ud.subscribe(({session:m})=>d(()=>({session:m}))),[l.xr,d]),Ca(()=>{l.xr.setFoveation(i),d(()=>({foveation:i}))},[l.xr,i,d]),Ca(()=>{var m;try{e&&((m=f==null?void 0:f.updateTargetFrameRate)==null||m.call(f,e))}catch{}d(()=>({frameRate:e}))},[f,e,d]),Ca(()=>{const m=ud.getState();l.xr.setReferenceSpaceType(t),d(()=>({referenceSpace:t})),m.set({referenceSpaceType:t})},[l.xr,t,d]),Ca(()=>{if(!f)return void l.xr.setSession(null);const m=M=>{var T;d(()=>({isPresenting:!0})),(T=_.current)==null||T.call(_,{nativeEvent:{...M,target:f},target:f})},y=M=>{var T;d(()=>({isPresenting:!1,session:null})),ud.setState(()=>({session:null})),(T=v.current)==null||T.call(v,{nativeEvent:{...M,target:f},target:f})},A=M=>{var T;(T=g.current)==null||T.call(g,{nativeEvent:M,target:f})},w=M=>{var T;const E=Object.values(f.inputSources).some(C=>C.hand);d(()=>({isHandTracking:E})),(T=b.current)==null||T.call(b,{nativeEvent:M,target:f})};return l.xr.addEventListener("sessionstart",m),l.xr.addEventListener("sessionend",y),f.addEventListener("visibilitychange",A),f.addEventListener("inputsourceschange",w),l.xr.setSession(f).then(()=>{l.xr.setFoveation(h().foveation)}),()=>{l.xr.removeEventListener("sessionstart",m),l.xr.removeEventListener("sessionend",y),f.removeEventListener("visibilitychange",A),f.removeEventListener("inputsourceschange",w)}},[f,l.xr,d,h]),Re.createElement(BJ,null,Re.createElement("primitive",{object:u},Re.createElement("primitive",{object:c}),p.map(m=>Re.createElement("primitive",{key:m.index,object:m}))),a)}function fG(i){const e=Re.useMemo(()=>hG((t,n)=>({set:t,get:n,controllers:[],isPresenting:!1,isHandTracking:!1,player:new To,session:null,foveation:0,referenceSpace:"local-floor",hoverState:{left:new Map,right:new Map,none:new Map},interactions:new Map,hasInteraction(r,s){var o;return!!((o=n().interactions.get(r))!=null&&o[s].some(a=>a.current))},getInteraction(r,s){var o;return(o=n().interactions.get(r))==null?void 0:o[s].reduce((a,l)=>(l.current&&a.push(l.current),a),[])},addInteraction(r,s,o){const a=n().interactions;a.has(r)||a.set(r,{onHover:[],onBlur:[],onSelect:[],onSelectEnd:[],onSelectStart:[],onSelectMissed:[],onSqueeze:[],onSqueezeEnd:[],onSqueezeStart:[],onSqueezeMissed:[],onMove:[]}),a.get(r)[s].push(o)},removeInteraction(r,s,o){const a=n().interactions.get(r);if(a){const l=a[s].indexOf(o);l!==-1&&a[s].splice(l,1)}}})),[]);return Re.createElement(dG.Provider,{value:e},Re.createElement(GJ,{...i}))}const VJ=(i,e)=>{var t;if(!(!i&&!e))return i&&!e?{optionalFeatures:[i]}:i&&e?{...e,optionalFeatures:OJ([...(t=e.optionalFeatures)!=null?t:[],i])}:e},HJ=async(i,e)=>{const t=ud.getState();if(t.session){console.warn("@react-three/xr: session already started, please stop it first");return}const n=VJ(t.referenceSpaceType,e),r=await navigator.xr.requestSession(i,n);return t.set(()=>({session:r})),r},$J=async()=>{const i=ud.getState();if(!i.session){console.warn("@react-three/xr: no session to stop, please start it first");return}await i.session.end(),i.set({session:null})},WJ=async(i,{sessionInit:e,enterOnly:t,exitOnly:n}={})=>{const r=ud.getState();if(!(r.session&&t)&&!(!r.session&&n))return r.session?await $J():await HJ(i,e)},jJ=(i,e,t)=>{switch(i){case"entered":return`Exit ${e}`;case"exited":return`Enter ${e}`;case"unsupported":default:switch(t){case"https":return"HTTPS needed";case"security":return`${e} blocked`;case"unknown":default:return`${e} unsupported`}}},pG=Re.forwardRef(function({mode:e,sessionInit:t,enterOnly:n=!1,exitOnly:r=!1,onClick:s,onError:o,children:a,...l},c){var u;const[h,d]=Re.useState("exited"),[f,p]=Re.useState("unknown"),_=jJ(h,e,f),v=e==="inline"?e:`immersive-${e.toLowerCase()}`,g=ul(o);Ca(()=>{if(!(navigator!=null&&navigator.xr))return void d("unsupported");navigator.xr.isSessionSupported(v).then(m=>{if(m)d("exited");else{const y=location.protocol==="https:";d("unsupported"),p(y?"unknown":"https")}}).catch(m=>{d("unsupported"),"name"in m&&m.name==="SecurityError"?p("security"):p("unknown")})},[v]),Ca(()=>ud.subscribe(m=>{m.session?d("entered"):h!=="unsupported"&&d("exited")}),[h]);const b=Re.useCallback(async m=>{s==null||s(m);try{WJ(v,{sessionInit:t,enterOnly:n,exitOnly:r})}catch(y){const A=g.current;if(A&&y instanceof Error)A(y);else throw y}},[s,v,t,n,r,g]);return Re.createElement("button",{...l,ref:c,onClick:h==="unsupported"?s:b},(u=typeof a=="function"?a(h):a)!=null?u:_)}),mG={position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",border:"1px solid white",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",zIndex:99999,cursor:"pointer"};Re.forwardRef(({style:i=mG,sessionInit:e={domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]},children:t,...n},r)=>Re.createElement(pG,{...n,ref:r,mode:"AR",style:i,sessionInit:e},t));const gG=Re.forwardRef(({style:i=mG,sessionInit:e={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]},children:t,...n},r)=>Re.createElement(pG,{...n,ref:r,mode:"VR",style:i,sessionInit:e},t));function Vi(i=t=>t,e){const t=Re.useContext(dG);if(!t)throw new Error("useXR must be used within an <XR /> component!");return t(i,e)}function _F(i){const e=Vi(n=>n.controllers);return Re.useMemo(()=>e.find(({inputSource:n})=>(n==null?void 0:n.handedness)&&n.handedness===i),[i,e])}const XJ=parseInt(I1.replace(/\D+/g,""));function yF(i,e){if(e===h6)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===yb||e===cR){let t=i.getIndex();if(t===null){const o=[],a=i.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);i.setIndex(o),t=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,r=[];if(t)if(e===yb)for(let o=1;o<=n;o++)r.push(t.getX(0)),r.push(t.getX(o)),r.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(r.push(t.getX(o)),r.push(t.getX(o+1)),r.push(t.getX(o+2))):(r.push(t.getX(o+2)),r.push(t.getX(o+1)),r.push(t.getX(o)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=i.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}var qJ=Object.defineProperty,YJ=(i,e,t)=>e in i?qJ(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,KJ=(i,e,t)=>(YJ(i,e+"",t),t);let ZJ=class{constructor(){KJ(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};var QJ=Object.defineProperty,JJ=(i,e,t)=>e in i?QJ(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,mr=(i,e,t)=>(JJ(i,typeof e!="symbol"?e+"":e,t),t);const If=new N1(0,0,0,"YXZ"),Lf=new Te,eee={type:"change"},tee={type:"lock"},nee={type:"unlock"},xF=.002,bF=Math.PI/2;let iee=class extends ZJ{constructor(e,t){super(),mr(this,"camera"),mr(this,"domElement"),mr(this,"isLocked"),mr(this,"minPolarAngle"),mr(this,"maxPolarAngle"),mr(this,"pointerSpeed"),mr(this,"onMouseMove",n=>{!this.domElement||this.isLocked===!1||(If.setFromQuaternion(this.camera.quaternion),If.y-=n.movementX*xF*this.pointerSpeed,If.x-=n.movementY*xF*this.pointerSpeed,If.x=Math.max(bF-this.maxPolarAngle,Math.min(bF-this.minPolarAngle,If.x)),this.camera.quaternion.setFromEuler(If),this.dispatchEvent(eee))}),mr(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(tee),this.isLocked=!0):(this.dispatchEvent(nee),this.isLocked=!1))}),mr(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),mr(this,"connect",n=>{this.domElement=n||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),mr(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),mr(this,"dispose",()=>{this.disconnect()}),mr(this,"getObject",()=>this.camera),mr(this,"direction",new Te(0,0,-1)),mr(this,"getDirection",n=>n.copy(this.direction).applyQuaternion(this.camera.quaternion)),mr(this,"moveForward",n=>{Lf.setFromMatrixColumn(this.camera.matrix,0),Lf.crossVectors(this.camera.up,Lf),this.camera.position.addScaledVector(Lf,n)}),mr(this,"moveRight",n=>{Lf.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(Lf,n)}),mr(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),mr(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}};function wb(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let e="";for(let t=0,n=i.length;t<n;t++)e+=String.fromCharCode(i[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const nd="srgb",fc="srgb-linear",SF=3001,ree=3e3;class see extends Us{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new uee(t)}),this.register(function(t){return new hee(t)}),this.register(function(t){return new xee(t)}),this.register(function(t){return new bee(t)}),this.register(function(t){return new See(t)}),this.register(function(t){return new fee(t)}),this.register(function(t){return new pee(t)}),this.register(function(t){return new mee(t)}),this.register(function(t){return new gee(t)}),this.register(function(t){return new cee(t)}),this.register(function(t){return new vee(t)}),this.register(function(t){return new dee(t)}),this.register(function(t){return new yee(t)}),this.register(function(t){return new _ee(t)}),this.register(function(t){return new aee(t)}),this.register(function(t){return new wee(t)}),this.register(function(t){return new Mee(t)})}load(e,t,n,r){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=Ru.extractUrlBase(e);o=Ru.resolveURL(c,this.path)}else o=Ru.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){r?r(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new Ha(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,o,function(u){t(u),s.manager.itemEnd(e)},a)}catch(u){a(u)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let s;const o={},a={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(wb(new Uint8Array(e.slice(0,4)))===vG){try{o[Mn.KHR_BINARY_GLTF]=new Aee(e)}catch(u){r&&r(u);return}s=JSON.parse(o[Mn.KHR_BINARY_GLTF].content)}else s=JSON.parse(wb(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Oee(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const u=s.extensionsUsed[c],h=s.extensionsRequired||[];switch(u){case Mn.KHR_MATERIALS_UNLIT:o[u]=new lee;break;case Mn.KHR_DRACO_MESH_COMPRESSION:o[u]=new Eee(s,this.dracoLoader);break;case Mn.KHR_TEXTURE_TRANSFORM:o[u]=new Tee;break;case Mn.KHR_MESH_QUANTIZATION:o[u]=new Cee;break;default:h.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,s){n.parse(e,t,r,s)})}}function oee(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const Mn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class aee{constructor(e){this.parser=e,this.name=Mn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new It(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],fc);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new US(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new VR(u),c.distance=h;break;case"spot":c=new GR(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,ec(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),r=Promise.resolve(c),t.cache.add(n,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return n._getNodeRef(t.cache,a,l)})}}class lee{constructor(){this.name=Mn.KHR_MATERIALS_UNLIT}getMaterialType(){return fi}extendParams(e,t,n){const r=[];e.color=new It(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],fc),e.opacity=o[3]}s.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",s.baseColorTexture,nd))}return Promise.all(r)}}class cee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class uee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new yt(a,a)}return Promise.all(s)}}class hee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class dee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class fee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new It(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],fc)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,nd)),o.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class pee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class mee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new It().setRGB(a[0],a[1],a[2],fc),Promise.all(s)}}class gee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class vee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new It().setRGB(a[0],a[1],a[2],fc),o.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,nd)),Promise.all(s)}}class _ee{constructor(e){this.parser=e,this.name=Mn.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class yee{constructor(e){this.parser=e,this.name=Mn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:so}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],o=r.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class xee{constructor(e){this.parser=e,this.name=Mn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class bee{constructor(e){this.parser=e,this.name=Mn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=n.textureLoader;if(a.uri){const c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class See{constructor(e){this.parser=e,this.name=Mn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=r.images[o.source];let l=n.textureLoader;if(a.uri){const c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o.source,l);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class wee{constructor(e){this.name=Mn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=r.byteOffset||0,c=r.byteLength||0,u=r.count,h=r.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,h,d,r.mode,r.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(u*h);return o.decodeGltfBuffer(new Uint8Array(f),u,h,d,r.mode,r.filter),f})})}else return null}}class Mee{constructor(e){this.name=Mn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=t.meshes[n.mesh];for(const c of r.primitives)if(c.mode!==Ko.TRIANGLES&&c.mode!==Ko.TRIANGLE_STRIP&&c.mode!==Ko.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),h=u.isGroup?u.children:[u],d=c[0].count,f=[];for(const p of h){const _=new en,v=new Te,g=new jr,b=new Te(1,1,1),m=new AR(p.geometry,p.material,d);for(let y=0;y<d;y++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,y),l.ROTATION&&g.fromBufferAttribute(l.ROTATION,y),l.SCALE&&b.fromBufferAttribute(l.SCALE,y),m.setMatrixAt(y,_.compose(v,g,b));for(const y in l)if(y==="_COLOR_0"){const A=l[y];m.instanceColor=new Gu(A.array,A.itemSize,A.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&p.geometry.setAttribute(y,l[y]);Gn.prototype.copy.call(m,p),this.parser.assignFinalMaterial(m),f.push(m)}return u.isGroup?(u.clear(),u.add(...f),u):f[0]}))}}const vG="glTF",Rg=12,wF={JSON:1313821514,BIN:5130562};class Aee{constructor(e){this.name=Mn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Rg);if(this.header={magic:wb(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==vG)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Rg,r=new DataView(e,Rg);let s=0;for(;s<n;){const o=r.getUint32(s,!0);s+=4;const a=r.getUint32(s,!0);if(s+=4,a===wF.JSON){const l=new Uint8Array(e,Rg+s,o);this.content=wb(l)}else if(a===wF.BIN){const l=Rg+s;this.body=e.slice(l,l+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Eee{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Mn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const h=iC[u]||u.toLowerCase();a[h]=o[u]}for(const u in e.attributes){const h=iC[u]||u.toLowerCase();if(o[u]!==void 0){const d=n.accessors[e.attributes[u]],f=zp[d.componentType];c[h]=f.name,l[h]=d.normalized===!0}}return t.getDependency("bufferView",s).then(function(u){return new Promise(function(h,d){r.decodeDracoFile(u,function(f){for(const p in f.attributes){const _=f.attributes[p],v=l[p];v!==void 0&&(_.normalized=v)}h(f)},a,c,fc,d)})})}}class Tee{constructor(){this.name=Mn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Cee{constructor(){this.name=Mn.KHR_MESH_QUANTIZATION}}class _G extends Pm{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let o=0;o!==r;o++)t[o]=n[s+o];return t}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=r-t,h=(n-t)/u,d=h*h,f=d*h,p=e*c,_=p-c,v=-2*f+3*d,g=f-d,b=1-v,m=g-d+h;for(let y=0;y!==a;y++){const A=o[_+y+a],w=o[_+y+l]*u,M=o[p+y+a],T=o[p+y]*u;s[y]=b*A+m*w+v*M+g*T}return s}}const Pee=new jr;class Ree extends _G{interpolate_(e,t,n,r){const s=super.interpolate_(e,t,n,r);return Pee.fromArray(s).normalize().toArray(s),s}}const Ko={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},zp={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},MF={9728:zi,9729:hi,9984:n1,9985:mS,9986:Op,9987:wl},AF={33071:$r,33648:tm,10497:Bu},xM={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iC={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...XJ>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Yc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Iee={CUBICSPLINE:void 0,LINEAR:Md,STEP:im},bM={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Lee(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new Td({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Sl})),i.DefaultMaterial}function Ah(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function ec(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Dee(i,e,t){let n=!1,r=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const h=e[c];if(h.POSITION!==void 0&&(n=!0),h.NORMAL!==void 0&&(r=!0),h.COLOR_0!==void 0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(i);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const h=e[c];if(n){const d=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):i.attributes.position;o.push(d)}if(r){const d=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):i.attributes.normal;a.push(d)}if(s){const d=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):i.attributes.color;l.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],d=c[2];return n&&(i.morphAttributes.position=u),r&&(i.morphAttributes.normal=h),s&&(i.morphAttributes.color=d),i.morphTargetsRelative=!0,i})}function Nee(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Fee(i){let e;const t=i.extensions&&i.extensions[Mn.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+SM(t.attributes):e=i.indices+":"+SM(i.attributes)+":"+i.mode,i.targets!==void 0)for(let n=0,r=i.targets.length;n<r;n++)e+=":"+SM(i.targets[n]);return e}function SM(i){let e="";const t=Object.keys(i).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+i[t[n]]+";";return e}function rC(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function kee(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Uee=new en;class Oee{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new oee,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&s<98?this.textureLoader=new I8(this.options.manager):this.textureLoader=new U8(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ha(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const a={scene:o[0][r.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:r.asset,parser:n,userData:{}};return Ah(s,a,r),ec(a,r),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const o=t[r].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const o=e[r];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),s=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())s(u,a.children[c])};return s(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Mn.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,o){n.load(Ru.resolveURL(t.uri,r.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const o=xM[r.type],a=zp[r.componentType],l=r.normalized===!0,c=new a(r.count*o);return Promise.resolve(new An(c,o,l))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],l=xM[r.type],c=zp[r.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,d=r.byteOffset||0,f=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,p=r.normalized===!0;let _,v;if(f&&f!==h){const g=Math.floor(d/f),b="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+g+":"+r.count;let m=t.cache.get(b);m||(_=new c(a,g*f,r.count*f/u),m=new B1(_,f/u),t.cache.add(b,m)),v=new zu(m,l,d%f/u,p)}else a===null?_=new c(r.count*l):_=new c(a,d,r.count*l),v=new An(_,l,p);if(r.sparse!==void 0){const g=xM.SCALAR,b=zp[r.sparse.indices.componentType],m=r.sparse.indices.byteOffset||0,y=r.sparse.values.byteOffset||0,A=new b(o[1],m,r.sparse.count*g),w=new c(o[2],y,r.sparse.count*l);a!==null&&(v=new An(v.array.slice(),v.itemSize,v.normalized));for(let M=0,T=A.length;M<T;M++){const E=A[M];if(v.setX(E,w[M*l]),l>=2&&v.setY(E,w[M*l+1]),l>=3&&v.setZ(E,w[M*l+2]),l>=4&&v.setW(E,w[M*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const l=n.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,n){const r=this,s=this.json,o=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,n).then(function(u){u.flipY=!1,u.name=o.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const d=(s.samplers||{})[o.sampler]||{};return u.magFilter=MF[d.magFilter]||hi,u.minFilter=MF[d.minFilter]||wl,u.wrapS=AF[d.wrapS]||Bu,u.wrapT=AF[d.wrapT]||Bu,r.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const n=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const o=r.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=n.getDependency("bufferView",o.bufferView).then(function(h){c=!0;const d=new Blob([h],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(d,f){let p=d;t.isImageBitmapLoader===!0&&(p=function(_){const v=new dr(_);v.needsUpdate=!0,d(v)}),t.load(Ru.resolveURL(h,s.path),p,void 0,f)})}).then(function(h){return c===!0&&a.revokeObjectURL(l),ec(h,o),h.userData.mimeType=o.mimeType||kee(o.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[e]=u,u}assignTexture(e,t,n,r){const s=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),s.extensions[Mn.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[Mn.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(o);o=s.extensions[Mn.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,l)}}return r!==void 0&&(typeof r=="number"&&(r=r===SF?nd:fc),"colorSpace"in o?o.colorSpace=r:o.encoding=r===nd?SF:ree),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new AS,ur.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(a,l)),n=l}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new hs,ur.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(a,l)),n=l}if(r||s||o){let a="ClonedMaterial:"+n.uuid+":";r&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=n.clone(),s&&(l.vertexColors=!0),o&&(l.flatShading=!0),r&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return Td}loadMaterial(e){const t=this,n=this.json,r=this.extensions,s=n.materials[e];let o;const a={},l=s.extensions||{},c=[];if(l[Mn.KHR_MATERIALS_UNLIT]){const h=r[Mn.KHR_MATERIALS_UNLIT];o=h.getMaterialType(),c.push(h.extendParams(a,s,t))}else{const h=s.pbrMetallicRoughness||{};if(a.color=new It(1,1,1),a.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],fc),a.opacity=d[3]}h.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",h.baseColorTexture,nd)),a.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,a.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",h.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",h.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=cr);const u=s.alphaMode||bM.OPAQUE;if(u===bM.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===bM.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==fi&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new yt(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;a.normalScale.set(h,h)}if(s.occlusionTexture!==void 0&&o!==fi&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==fi){const h=s.emissiveFactor;a.emissive=new It().setRGB(h[0],h[1],h[2],fc)}return s.emissiveTexture!==void 0&&o!==fi&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,nd)),Promise.all(c).then(function(){const h=new o(a);return s.name&&(h.name=s.name),ec(h,s),t.associations.set(h,{materials:e}),s.extensions&&Ah(r,h,s),h})}createUniqueName(e){const t=Pn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function s(a){return n[Mn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return EF(l,a,t)})}const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=Fee(c),h=r[u];if(h)o.push(h.promise);else{let d;c.extensions&&c.extensions[Mn.KHR_DRACO_MESH_COMPRESSION]?d=s(c):d=EF(new mn,c,t),r[u]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,r=this.extensions,s=n.meshes[e],o=s.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?Lee(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let f=0,p=u.length;f<p;f++){const _=u[f],v=o[f];let g;const b=c[f];if(v.mode===Ko.TRIANGLES||v.mode===Ko.TRIANGLE_STRIP||v.mode===Ko.TRIANGLE_FAN||v.mode===void 0)g=s.isSkinnedMesh===!0?new MR(_,b):new Tn(_,b),g.isSkinnedMesh===!0&&g.normalizeSkinWeights(),v.mode===Ko.TRIANGLE_STRIP?g.geometry=yF(g.geometry,cR):v.mode===Ko.TRIANGLE_FAN&&(g.geometry=yF(g.geometry,yb));else if(v.mode===Ko.LINES)g=new $a(_,b);else if(v.mode===Ko.LINE_STRIP)g=new bc(_,b);else if(v.mode===Ko.LINE_LOOP)g=new ER(_,b);else if(v.mode===Ko.POINTS)g=new TR(_,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(g.geometry.morphAttributes).length>0&&Nee(g,s),g.name=t.createUniqueName(s.name||"mesh_"+e),ec(g,s),v.extensions&&Ah(r,g,v),t.assignFinalMaterial(g),h.push(g)}for(let f=0,p=h.length;f<p;f++)t.associations.set(h[f],{meshes:e,primitives:f});if(h.length===1)return s.extensions&&Ah(r,h[0],s),h[0];const d=new To;s.extensions&&Ah(r,d,s),t.associations.set(d,{meshes:e});for(let f=0,p=h.length;f<p;f++)d.add(h[f]);return d})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Zi(au.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new Ku(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),ec(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,s=t.joints.length;r<s;r++)n.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const s=r.pop(),o=r,a=[],l=[];for(let c=0,u=o.length;c<u;c++){const h=o[c];if(h){a.push(h);const d=new en;s!==null&&d.fromArray(s.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new z1(a,l)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,o=[],a=[],l=[],c=[],u=[];for(let h=0,d=r.channels.length;h<d;h++){const f=r.channels[h],p=r.samplers[f.sampler],_=f.target,v=_.node,g=r.parameters!==void 0?r.parameters[p.input]:p.input,b=r.parameters!==void 0?r.parameters[p.output]:p.output;_.node!==void 0&&(o.push(this.getDependency("node",v)),a.push(this.getDependency("accessor",g)),l.push(this.getDependency("accessor",b)),c.push(p),u.push(_))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(h){const d=h[0],f=h[1],p=h[2],_=h[3],v=h[4],g=[];for(let b=0,m=d.length;b<m;b++){const y=d[b],A=f[b],w=p[b],M=_[b],T=v[b];if(y===void 0)continue;y.updateMatrix&&y.updateMatrix();const E=n._createAnimationTracks(y,A,w,M,T);if(E)for(let C=0;C<E.length;C++)g.push(E[C])}return new lm(s,void 0,g)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(s){const o=n._getNodeRef(n.meshCache,r.mesh,s);return r.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=r.weights.length;l<c;l++)a.morphTargetInfluences[l]=r.weights[l]}),o})}loadNode(e){const t=this.json,n=this,r=t.nodes[e],s=n._loadNodeShallow(e),o=[],a=r.children||[];for(let c=0,u=a.length;c<u;c++)o.push(n.getDependency("node",a[c]));const l=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([s,Promise.all(o),l]).then(function(c){const u=c[0],h=c[1],d=c[2];d!==null&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(d,Uee)});for(let f=0,p=h.length;f<p;f++)u.add(h[f]);return u})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?r.createUniqueName(s.name):"",a=[],l=r._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(r.getDependency("camera",s.camera).then(function(c){return r._getNodeRef(r.cameraCache,s.camera,c)})),r._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let u;if(s.isBone===!0?u=new MS:c.length>1?u=new To:c.length===1?u=c[0]:u=new Gn,u!==c[0])for(let h=0,d=c.length;h<d;h++)u.add(c[h]);if(s.name&&(u.userData.name=s.name,u.name=o),ec(u,s),s.extensions&&Ah(n,u,s),s.matrix!==void 0){const h=new en;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,s=new To;n.name&&(s.name=r.createUniqueName(n.name)),ec(s,n),n.extensions&&Ah(t,s,n);const o=n.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(r.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let u=0,h=l.length;u<h;u++)s.add(l[u]);const c=u=>{const h=new Map;for(const[d,f]of r.associations)(d instanceof ur||d instanceof dr)&&h.set(d,f);return u.traverse(d=>{const f=r.associations.get(d);f!=null&&h.set(d,f)}),h};return r.associations=c(s),s})}_createAnimationTracks(e,t,n,r,s){const o=[],a=e.name?e.name:e.uuid,l=[];Yc[s.path]===Yc.weights?e.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(a);let c;switch(Yc[s.path]){case Yc.weights:c=Cd;break;case Yc.rotation:c=Vu;break;case Yc.position:case Yc.scale:c=Pd;break;default:switch(n.itemSize){case 1:c=Cd;break;case 2:case 3:default:c=Pd;break}break}const u=r.interpolation!==void 0?Iee[r.interpolation]:Md,h=this._getArrayFromAccessor(n);for(let d=0,f=l.length;d<f;d++){const p=new c(l[d]+"."+Yc[s.path],t.array,h,u);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),o.push(p)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=rC(t.constructor),r=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)r[s]=t[s]*n;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof Vu?Ree:_G;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Bee(i,e,t){const n=e.attributes,r=new kr;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(r.set(new Te(l[0],l[1],l[2]),new Te(c[0],c[1],c[2])),a.normalized){const u=rC(zp[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new Te,l=new Te;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const d=t.json.accessors[h.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const _=rC(zp[d.componentType]);l.multiplyScalar(_)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(a)}i.boundingBox=r;const o=new Ur;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,i.boundingSphere=o}function EF(i,e,t){const n=e.attributes,r=[];function s(o,a){return t.getDependency("accessor",o).then(function(l){i.setAttribute(a,l)})}for(const o in n){const a=iC[o]||o.toLowerCase();a in i.attributes||r.push(s(n[o],a))}if(e.indices!==void 0&&!i.index){const o=t.getDependency("accessor",e.indices).then(function(a){i.setIndex(a)});r.push(o)}return ec(i,e),Bee(i,e,t),Promise.all(r).then(function(){return e.targets!==void 0?Dee(i,e.targets,t):i})}var zee=Object.defineProperty,Gee=(i,e,t)=>e in i?zee(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ai=(i,e,t)=>(Gee(i,typeof e!="symbol"?e+"":e,t),t);const Oi={ComponentState:{DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"},ComponentProperty:{BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"},ComponentType:{TOUCHPAD:"touchpad"},ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:{TRANSFORM:"transform",VISIBILITY:"visibility"}};async function yG(i){const e=await fetch(i);if(e.ok)return e.json();throw new Error(e.statusText)}async function Vee(i){if(!i)throw new Error("No basePath supplied");return await yG(`${i}/profilesList.json`)}async function Hee(i,e,t=null,n=!0){if(!i)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await Vee(e);let s;if(i.profiles.some(l=>{const c=r[l];return c&&(s={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!s}),!s){if(!t)throw new Error("No matching profile name found");const l=r[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);s={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const o=await yG(s.profilePath);let a;if(n){let l;if(i.handedness==="any"?l=o.layouts[Object.keys(o.layouts)[0]]:l=o.layouts[i.handedness],!l)throw new Error(`No matching handedness, ${i.handedness}, in profile ${s.profileId}`);l.assetPath&&(a=s.profilePath.replace("profile.json",l.assetPath))}return{profile:o,assetPath:a}}const $ee={xAxis:0,yAxis:0,button:0,state:Oi.ComponentState.DEFAULT};function Wee(i=0,e=0){let t=i,n=e;if(Math.sqrt(i*i+e*e)>1){const o=Math.atan2(e,i);t=Math.cos(o),n=Math.sin(o)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:n*.5+.5}}class jee{constructor(e){Ai(this,"value"),Ai(this,"componentProperty"),Ai(this,"states"),Ai(this,"valueNodeName"),Ai(this,"valueNodeProperty"),Ai(this,"minNodeName"),Ai(this,"maxNodeName"),Ai(this,"valueNode"),Ai(this,"minNode"),Ai(this,"maxNode"),this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Oi.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent($ee)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:r}){const{normalizedXAxis:s,normalizedYAxis:o}=Wee(e,t);switch(this.componentProperty){case Oi.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?s:.5;break;case Oi.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?o:.5;break;case Oi.ComponentProperty.BUTTON:this.value=this.states.includes(r)&&n?n:0;break;case Oi.ComponentProperty.STATE:this.valueNodeProperty===Oi.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Xee{constructor(e,t){if(Ai(this,"id"),Ai(this,"values"),Ai(this,"type"),Ai(this,"gamepadIndices"),Ai(this,"rootNodeName"),Ai(this,"visualResponses"),Ai(this,"touchPointNodeName"),Ai(this,"touchPointNode"),!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(n=>{const r=new jee(t.visualResponses[n]);this.visualResponses[n]=r}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Oi.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Oi.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Oi.ComponentState.PRESSED:(t.touched||this.values.button>Oi.ButtonTouchThreshold)&&(this.values.state=Oi.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Oi.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Oi.AxisTouchThreshold&&(this.values.state=Oi.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Oi.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Oi.AxisTouchThreshold&&(this.values.state=Oi.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class qee{constructor(e,t,n){if(Ai(this,"xrInputSource"),Ai(this,"assetUrl"),Ai(this,"layoutDescription"),Ai(this,"id"),Ai(this,"components"),!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");if(!t.layouts[e.handedness])throw new Error("No layout for "+e.handedness+" handedness");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(r=>{const s=this.layoutDescription.components[r];this.components[r]=new Xee(r,s)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const Yee="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Kee="generic-trigger";class Zee{constructor(e=null,t=Yee){this.gltfLoader=e??new see,this.path=t,this._assetCache={}}initializeControllerModel(e,t){return t.targetRayMode!=="tracked-pointer"||!t.gamepad?Promise.resolve():Hee(t,this.path,Kee).then(({profile:n,assetPath:r})=>{if(!r)throw new Error("no asset path");const s=new qee(t,n,r);e.connectMotionController(s);const o=s.assetUrl,a=this._assetCache[o];if(a){const l=a.scene.clone();e.connectModel(l)}else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(o,l=>{if(!e.motionController){console.warn("motionController gone while gltf load, bailing...");return}this._assetCache[o]=l;const c=l.scene.clone();e.connectModel(c)},void 0,()=>{throw new Error(`Asset ${o} missing or malformed.`)})}}).catch(n=>{console.warn(n)})}}const TF=i=>"envMap"in i,CF=(i,e)=>{i.envMap=e,i.needsUpdate=!0},xG=(i,e)=>{e instanceof Tn&&(Array.isArray(e.material)?e.material.forEach(t=>TF(t)?CF(t,i):void 0):TF(e.material)&&CF(e.material,i))},PF=i=>"envMapIntensity"in i,RF=(i,e)=>{i.envMapIntensity=e,i.needsUpdate=!0},sC=(i,e)=>{e instanceof Tn&&(Array.isArray(e.material)?e.material.forEach(t=>PF(t)?RF(t,i):void 0):PF(e.material)&&RF(e.material,i))};function Qee(i,e){Object.values(i.components).forEach(t=>{const{type:n,touchPointNodeName:r,visualResponses:s}=t;if(n===Oi.ComponentType.TOUCHPAD&&r)if(t.touchPointNode=e.getObjectByName(r),t.touchPointNode){const o=new Od(.001),a=new fi({color:255}),l=new Tn(o,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(s).forEach(o=>{const{valueNodeName:a,minNodeName:l,maxNodeName:c,valueNodeProperty:u}=o;if(u===Oi.VisualResponseProperty.TRANSFORM&&l&&c){if(o.minNode=e.getObjectByName(l),o.maxNode=e.getObjectByName(c),!o.minNode){console.warn(`Could not find ${l} in the model`);return}if(!o.maxNode){console.warn(`Could not find ${c} in the model`);return}}o.valueNode=e.getObjectByName(a),o.valueNode||console.warn(`Could not find ${a} in the model`)})})}function Jee(i,e){Qee(i.motionController,e),(i.envMap||i.envMapIntensity!=null)&&e.traverse(t=>{i.envMap&&xG(i.envMap,t),i.envMapIntensity!=null&&sC(i.envMapIntensity,t)}),i.add(e)}class ete extends To{constructor(){super(),this.motionController=null,this.envMap=null,this.envMapIntensity=1,this.scene=null}setEnvironmentMap(e,t=1){var n;return this.envMap===e&&this.envMapIntensity===t?this:(this.envMap=e,this.envMapIntensity=t,(n=this.scene)==null||n.traverse(r=>{xG(e,r),sC(t,r)}),this)}setEnvironmentMapIntensity(e){var t;return this.envMapIntensity===e?this:(this.envMapIntensity=e,(t=this.scene)==null||t.traverse(n=>sC(e,n)),this)}connectModel(e){if(!this.motionController){console.warn("scene tried to add, but no motion controller");return}this.scene=e,Jee(this,e),this.dispatchEvent({type:"modelconnected",data:e})}connectMotionController(e){this.motionController=e,this.dispatchEvent({type:"motionconnected",data:e})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(n=>{const{valueNode:r,minNode:s,maxNode:o,value:a,valueNodeProperty:l}=n;r&&(l===Oi.VisualResponseProperty.VISIBILITY&&typeof a=="boolean"?r.visible=a:l===Oi.VisualResponseProperty.TRANSFORM&&s&&o&&typeof a=="number"&&(r.quaternion.slerpQuaternions(s.quaternion,o.quaternion,a),r.position.lerpVectors(s.position,o.position,a)))})}))}disconnect(){this.dispatchEvent({type:"motiondisconnected",data:this.motionController}),this.dispatchEvent({type:"modeldisconnected",data:this.scene}),this.motionController=null,this.scene&&this.remove(this.scene),this.scene=null}dispose(){this.disconnect()}}const tte=Re.forwardRef(function({target:e,hideOnBlur:t=!1,...n},r){const s=Vi(l=>l.hoverState),o=Re.useRef(null),a=Re.useMemo(()=>new mn().setFromPoints([new Te(0,0,0),new Te(0,0,-1)]),[]);return Re.useImperativeHandle(r,()=>o.current),no(()=>{if(!e.inputSource)return;let l=1;const c=s[e.inputSource.handedness].values().next().value;c&&e.inputSource.handedness!=="none"?(l=c.distance,t&&(o.current.visible=!1)):t&&(o.current.visible=!0);const u=-.01;o.current.scale.z=l+u}),Re.createElement("line",{ref:o,geometry:a,"material-opacity":.8,"material-transparent":!0,...n})}),nte=new Zee,ite=({target:i,envMap:e,envMapIntensity:t})=>{const n=Re.useRef(null),r=ul(l=>{e!=null&&l.setEnvironmentMap(e)}),s=ul(l=>l.setEnvironmentMap(null)),o=ul(l=>{t!=null&&l.setEnvironmentMapIntensity(t)}),a=Re.useCallback(l=>{var c,u,h;if(n.current=l,l){if(i.xrControllerModel=l,(c=i.inputSource)!=null&&c.hand)return;r.current(l),o.current(l),i.inputSource?nte.initializeControllerModel(l,i.inputSource):console.warn("no input source on XRController when handleControllerModel")}else{if((u=i.inputSource)!=null&&u.hand)return;(h=i.xrControllerModel)==null||h.disconnect(),i.xrControllerModel=null}},[i,o,r]);return Re.useLayoutEffect(()=>{n.current&&(e?r.current(n.current):s.current(n.current))},[e,r,s]),Re.useLayoutEffect(()=>{n.current&&o.current(n.current)},[t,o]),Re.createElement("xRControllerModel",{ref:a})};function rte({rayMaterial:i={},hideRaysOnBlur:e=!1,envMap:t,envMapIntensity:n}){const r=Vi(a=>a.controllers),s=Vi(a=>a.isHandTracking),o=Re.useMemo(()=>Object.entries(i).reduce((a,[l,c])=>({...a,[`material-${l}`]:c}),{}),[JSON.stringify(i)]);return Re.useMemo(()=>q8({XRControllerModel:ete}),[]),Re.createElement(Re.Fragment,null,r.map((a,l)=>Re.createElement(Re.Fragment,{key:l},oF(Re.createElement(ite,{target:a,envMap:t,envMapIntensity:n}),a.grip),oF(Re.createElement(tte,{visible:!s,hideOnBlur:e,target:a,...o}),a.controller))))}const ste=i=>_e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[_e.jsx("path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v0A2.5 2.5 0 0 1 9.5 7v0A2.5 2.5 0 0 1 7 4.5v0A2.5 2.5 0 0 1 9.5 2"}),_e.jsx("path",{d:"M14.5 2A2.5 2.5 0 0 1 17 4.5v0A2.5 2.5 0 0 1 14.5 7v0A2.5 2.5 0 0 1 12 4.5v0A2.5 2.5 0 0 1 14.5 2"}),_e.jsx("path",{d:"M12 12a2.5 2.5 0 0 0-2.5 2.5v0A2.5 2.5 0 0 0 12 17v0a2.5 2.5 0 0 0 2.5-2.5v0A2.5 2.5 0 0 0 12 12"}),_e.jsx("path",{d:"M4.5 10A2.5 2.5 0 0 1 7 12.5v0A2.5 2.5 0 0 1 4.5 15v0A2.5 2.5 0 0 1 2 12.5v0A2.5 2.5 0 0 1 4.5 10"}),_e.jsx("path",{d:"M19.5 10A2.5 2.5 0 0 1 22 12.5v0A2.5 2.5 0 0 1 19.5 15v0A2.5 2.5 0 0 1 17 12.5v0A2.5 2.5 0 0 1 19.5 10"}),_e.jsx("path",{d:"M12 7v5"}),_e.jsx("path",{d:"M7 7.5v7"}),_e.jsx("path",{d:"M17 7.5v7"}),_e.jsx("path",{d:"M7 4.5C5.5 6 4 7 4 8.5"}),_e.jsx("path",{d:"M17 4.5c1.5 1.5 3 2.5 3 4"}),_e.jsx("path",{d:"M2 12.5c0 1.5 1 3 2.5 4"}),_e.jsx("path",{d:"M22 12.5c0 1.5-1 3-2.5 4"}),_e.jsx("path",{d:"M12 17c-1.5 1.5-2.5 2.5-2.5 4"}),_e.jsx("path",{d:"M12 17c1.5 1.5 2.5 2.5 2.5 4"})]}),ote=i=>_e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[_e.jsx("rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1"}),_e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"})]}),ate=i=>_e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[_e.jsx("circle",{cx:"12",cy:"12",r:"10"}),_e.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),_e.jsx("path",{d:"M12 17h.01"})]}),lte=i=>_e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[_e.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2.73l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2.73l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),_e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),cte=i=>_e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[_e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),_e.jsx("circle",{cx:"9",cy:"7",r:"4"}),_e.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),_e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),ute=i=>_e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[_e.jsx("circle",{cx:"11",cy:"11",r:"8"}),_e.jsx("path",{d:"m21 21-4.3-4.3"})]}),zh=[{id:"visualise",title:"Visualise",menuLabel:"Visualise",Icon:ste},{id:"host-join",title:"Host/Join Session",menuLabel:"Host/Join",Icon:cte},{id:"assessments",title:"Assessments",menuLabel:"Assessments",Icon:ote},{id:"settings",title:"Settings",menuLabel:"Settings",Icon:lte},{id:"help",title:"Help",menuLabel:"Help",Icon:ate}],iy=5,hte=1.6,Yi=30,ma=10,rr=4;function dte(){Re.useRef(null);const{floorTiles:i,ceilingTiles:e}=Re.useMemo(()=>{const t=[],n=[],r=new Td({color:"#ffffff",roughness:.7,metalness:.1}),s=new Td({color:"#f0f0f0",roughness:.9,metalness:0});for(let o=-Yi/2;o<Yi/2;o+=rr)for(let a=-Yi/2;a<Yi/2;a+=rr)t.push(_e.jsxs("mesh",{position:[o+rr/2,-.01,a+rr/2],rotation:[-Math.PI/2,0,0],children:[_e.jsx("planeGeometry",{args:[rr-.05,rr-.05]}),_e.jsx("primitive",{object:r,attach:"material"})]},`floor-${o}-${a}`)),t.push(_e.jsxs("mesh",{position:[o+rr/2,-.02,a+rr/2],rotation:[-Math.PI/2,0,0],children:[_e.jsx("planeGeometry",{args:[rr,rr]}),_e.jsx("primitive",{object:s,attach:"material"})]},`floor-border-${o}-${a}`));for(let o=-Yi/2;o<Yi/2;o+=rr)for(let a=-Yi/2;a<Yi/2;a+=rr)n.push(_e.jsxs("mesh",{position:[o+rr/2,ma+.01,a+rr/2],rotation:[Math.PI/2,0,0],children:[_e.jsx("planeGeometry",{args:[rr-.05,rr-.05]}),_e.jsx("primitive",{object:r,attach:"material"})]},`ceiling-${o}-${a}`)),n.push(_e.jsxs("mesh",{position:[o+rr/2,ma+.02,a+rr/2],rotation:[Math.PI/2,0,0],children:[_e.jsx("planeGeometry",{args:[rr,rr]}),_e.jsx("primitive",{object:s,attach:"material"})]},`ceiling-border-${o}-${a}`));return{floorTiles:t,ceilingTiles:n}},[]);return _e.jsxs("group",{children:[i,e,_e.jsxs("mesh",{position:[0,ma/2,-Yi/2],children:[_e.jsx("boxGeometry",{args:[Yi,ma,.2]}),_e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.6})]}),_e.jsxs("mesh",{position:[0,ma/2,Yi/2],children:[_e.jsx("boxGeometry",{args:[Yi,ma,.2]}),_e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.6})]}),_e.jsxs("mesh",{position:[-Yi/2,ma/2,0],rotation:[0,Math.PI/2,0],children:[_e.jsx("boxGeometry",{args:[Yi,ma,.2]}),_e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.6})]}),_e.jsxs("mesh",{position:[Yi/2,ma/2,0],rotation:[0,Math.PI/2,0],children:[_e.jsx("boxGeometry",{args:[Yi,ma,.2]}),_e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.6})]}),_e.jsx("ambientLight",{intensity:.7,color:"#ffffff"}),[...Array(9)].map((t,n)=>{const r=n%3*10-10,s=Math.floor(n/3)*10-10;return _e.jsx("pointLight",{position:[r,ma-.3,s],intensity:400,distance:12,decay:1.8,color:"#ffffff",castShadow:!1},`ceiling-light-${n}`)}),[...Array(4)].map((t,n)=>{const r=n%2===0?-10:10,s=n<2?-10:10;return _e.jsx("pointLight",{position:[r,1,s],intensity:200,distance:15,decay:2,color:"#fffaf0",castShadow:!1},`floor-light-${n}`)})]})}const fte=()=>_e.jsxs(_e.Fragment,{children:[_e.jsx("ambientLight",{intensity:.3}),_e.jsx(dte,{})]});function um(){return um=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},um.apply(null,arguments)}function pte(){var i=Object.create(null);function e(r,s){var o=r.id,a=r.name,l=r.dependencies;l===void 0&&(l=[]);var c=r.init;c===void 0&&(c=function(){});var u=r.getTransferables;if(u===void 0&&(u=null),!i[o])try{l=l.map(function(d){return d&&d.isWorkerModule&&(e(d,function(f){if(f instanceof Error)throw f}),d=i[d.id].value),d}),c=n("<"+a+">.init",c),u&&(u=n("<"+a+">.getTransferables",u));var h=null;typeof c=="function"?h=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),i[o]={id:o,value:h,getTransferables:u},s(h)}catch(d){d&&d.noLog||console.error(d),s(d)}}function t(r,s){var o,a=r.id,l=r.args;(!i[a]||typeof i[a].value!="function")&&s(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var c=(o=i[a]).value.apply(o,l);c&&typeof c.then=="function"?c.then(u,function(h){return s(h instanceof Error?h:new Error(""+h))}):u(c)}catch(h){s(h)}function u(h){try{var d=i[a].getTransferables&&i[a].getTransferables(h);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),s(h,d)}catch(f){console.error(f),s(f)}}}function n(r,s){var o=void 0;self.troikaDefine=function(l){return o=l};var a=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(a)}catch(l){console.error(l)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(r){var s=r.data,o=s.messageId,a=s.action,l=s.data;try{a==="registerModule"&&e(l,function(c){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof c=="function"}})}),a==="callModule"&&t(l,function(c,u){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:c},u||void 0)})}catch(c){postMessage({messageId:o,success:!1,error:c.stack})}})}function mte(i){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=i.dependencies,n=i.init;t=Array.isArray(t)?t.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var r=Promise.all(t).then(function(s){return n.apply(null,s)});return e._getInitResult=function(){return r},r},e}var bG=function(){var i=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),i=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return bG=function(){return i},i},gte=0,vte=0,wM=!1,A0=Object.create(null),E0=Object.create(null),oC=Object.create(null);function Rm(i){if((!i||typeof i.init!="function")&&!wM)throw new Error("requires `options.init` function");var e=i.dependencies,t=i.init,n=i.getTransferables,r=i.workerId,s=mte(i);r==null&&(r="#default");var o="workerModule"+ ++gte,a=i.name||o,l=null;e=e&&e.map(function(u){return typeof u=="function"&&!u.workerModuleData&&(wM=!0,u=Rm({workerId:r,name:"<"+a+"> function dependency: "+u.name,init:`function(){return (
`+Rx(u)+`
)}`}),wM=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function c(){for(var u=[],h=arguments.length;h--;)u[h]=arguments[h];if(!bG())return s.apply(void 0,u);if(!l){l=IF(r,"registerModule",c.workerModuleData);var d=function(){l=null,E0[r].delete(d)};(E0[r]||(E0[r]=new Set)).add(d)}return l.then(function(f){var p=f.isCallable;if(p)return IF(r,"callModule",{id:o,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:o,name:a,dependencies:e,init:Rx(t),getTransferables:n&&Rx(n)},c.onMainThread=s,c}function _te(i){E0[i]&&E0[i].forEach(function(e){e()}),A0[i]&&(A0[i].terminate(),delete A0[i])}function Rx(i){var e=i.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function yte(i){var e=A0[i];if(!e){var t=Rx(pte);e=A0[i]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+i.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(n){var r=n.data,s=r.messageId,o=oC[s];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete oC[s],o(r)}}return e}function IF(i,e,t){return new Promise(function(n,r){var s=++vte;oC[s]=function(o){o.success?n(o.result):r(new Error("Error in worker "+e+" call: "+o.error))},yte(i).postMessage({messageId:s,action:e,data:t})})}function SG(){var i=function(e){function t(z,O,D,B,W,q,j,te){var ne=1-j;te.x=ne*ne*z+2*ne*j*D+j*j*W,te.y=ne*ne*O+2*ne*j*B+j*j*q}function n(z,O,D,B,W,q,j,te,ne,Z){var le=1-ne;Z.x=le*le*le*z+3*le*le*ne*D+3*le*ne*ne*W+ne*ne*ne*j,Z.y=le*le*le*O+3*le*le*ne*B+3*le*ne*ne*q+ne*ne*ne*te}function r(z,O){for(var D=/([MLQCZ])([^MLQCZ]*)/g,B,W,q,j,te;B=D.exec(z);){var ne=B[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(Z){return parseFloat(Z)});switch(B[1]){case"M":j=W=ne[0],te=q=ne[1];break;case"L":(ne[0]!==j||ne[1]!==te)&&O("L",j,te,j=ne[0],te=ne[1]);break;case"Q":{O("Q",j,te,j=ne[2],te=ne[3],ne[0],ne[1]);break}case"C":{O("C",j,te,j=ne[4],te=ne[5],ne[0],ne[1],ne[2],ne[3]);break}case"Z":(j!==W||te!==q)&&O("L",j,te,W,q);break}}}function s(z,O,D){D===void 0&&(D=16);var B={x:0,y:0};r(z,function(W,q,j,te,ne,Z,le,re,se){switch(W){case"L":O(q,j,te,ne);break;case"Q":{for(var $=q,fe=j,xe=1;xe<D;xe++)t(q,j,Z,le,te,ne,xe/(D-1),B),O($,fe,B.x,B.y),$=B.x,fe=B.y;break}case"C":{for(var Ie=q,ge=j,Oe=1;Oe<D;Oe++)n(q,j,Z,le,re,se,te,ne,Oe/(D-1),B),O(Ie,ge,B.x,B.y),Ie=B.x,ge=B.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(z,O){var D=z.getContext?z.getContext("webgl",c):z,B=l.get(D);if(!B){let Ie=function(de){var Le=q[de];if(!Le&&(Le=q[de]=D.getExtension(de),!Le))throw new Error(de+" not supported");return Le},ge=function(de,Le){var ie=D.createShader(Le);return D.shaderSource(ie,de),D.compileShader(ie),ie},Oe=function(de,Le,ie,K){if(!j[de]){var be={},Ue={},ve=D.createProgram();D.attachShader(ve,ge(Le,D.VERTEX_SHADER)),D.attachShader(ve,ge(ie,D.FRAGMENT_SHADER)),D.linkProgram(ve),j[de]={program:ve,transaction:function($e){D.useProgram(ve),$e({setUniform:function(Ze,nt){for(var rt=[],Be=arguments.length-2;Be-- >0;)rt[Be]=arguments[Be+2];var qe=Ue[nt]||(Ue[nt]=D.getUniformLocation(ve,nt));D["uniform"+Ze].apply(D,[qe].concat(rt))},setAttribute:function(Ze,nt,rt,Be,qe){var it=be[Ze];it||(it=be[Ze]={buf:D.createBuffer(),loc:D.getAttribLocation(ve,Ze),data:null}),D.bindBuffer(D.ARRAY_BUFFER,it.buf),D.vertexAttribPointer(it.loc,nt,D.FLOAT,!1,0,0),D.enableVertexAttribArray(it.loc),W?D.vertexAttribDivisor(it.loc,Be):Ie("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(it.loc,Be),qe!==it.data&&(D.bufferData(D.ARRAY_BUFFER,qe,rt),it.data=qe)}})}}}j[de].transaction(K)},Me=function(de,Le){ne++;try{D.activeTexture(D.TEXTURE0+ne);var ie=te[de];ie||(ie=te[de]=D.createTexture(),D.bindTexture(D.TEXTURE_2D,ie),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.NEAREST)),D.bindTexture(D.TEXTURE_2D,ie),Le(ie,ne)}finally{ne--}},Y=function(de,Le,ie){var K=D.createFramebuffer();Z.push(K),D.bindFramebuffer(D.FRAMEBUFFER,K),D.activeTexture(D.TEXTURE0+Le),D.bindTexture(D.TEXTURE_2D,de),D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,de,0);try{ie(K)}finally{D.deleteFramebuffer(K),D.bindFramebuffer(D.FRAMEBUFFER,Z[--Z.length-1]||null)}},Q=function(){q={},j={},te={},ne=-1,Z.length=0};var le=Ie,re=ge,se=Oe,$=Me,fe=Y,xe=Q,W=typeof WebGL2RenderingContext<"u"&&D instanceof WebGL2RenderingContext,q={},j={},te={},ne=-1,Z=[];D.canvas.addEventListener("webglcontextlost",function(de){Q(),de.preventDefault()},!1),l.set(D,B={gl:D,isWebGL2:W,getExtension:Ie,withProgram:Oe,withTexture:Me,withTextureFramebuffer:Y,handleContextLoss:Q})}O(B)}function h(z,O,D,B,W,q,j,te){j===void 0&&(j=15),te===void 0&&(te=null),u(z,function(ne){var Z=ne.gl,le=ne.withProgram,re=ne.withTexture;re("copy",function(se,$){Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,W,q,0,Z.RGBA,Z.UNSIGNED_BYTE,O),le("copy",o,a,function(fe){var xe=fe.setUniform,Ie=fe.setAttribute;Ie("aUV",2,Z.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),xe("1i","image",$),Z.bindFramebuffer(Z.FRAMEBUFFER,te||null),Z.disable(Z.BLEND),Z.colorMask(j&8,j&4,j&2,j&1),Z.viewport(D,B,W,q),Z.scissor(D,B,W,q),Z.drawArrays(Z.TRIANGLES,0,3)})})})}function d(z,O,D){var B=z.width,W=z.height;u(z,function(q){var j=q.gl,te=new Uint8Array(B*W*4);j.readPixels(0,0,B,W,j.RGBA,j.UNSIGNED_BYTE,te),z.width=O,z.height=D,h(j,te,0,0,B,W)})}var f=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:h,resizeWebGLCanvasWithoutClearing:d});function p(z,O,D,B,W,q){q===void 0&&(q=1);var j=new Uint8Array(z*O),te=B[2]-B[0],ne=B[3]-B[1],Z=[];s(D,function(Ie,ge,Oe,Me){Z.push({x1:Ie,y1:ge,x2:Oe,y2:Me,minX:Math.min(Ie,Oe),minY:Math.min(ge,Me),maxX:Math.max(Ie,Oe),maxY:Math.max(ge,Me)})}),Z.sort(function(Ie,ge){return Ie.maxX-ge.maxX});for(var le=0;le<z;le++)for(var re=0;re<O;re++){var se=fe(B[0]+te*(le+.5)/z,B[1]+ne*(re+.5)/O),$=Math.pow(1-Math.abs(se)/W,q)/2;se<0&&($=1-$),$=Math.max(0,Math.min(255,Math.round($*255))),j[re*z+le]=$}return j;function fe(Ie,ge){for(var Oe=1/0,Me=1/0,Y=Z.length;Y--;){var Q=Z[Y];if(Q.maxX+Me<=Ie)break;if(Ie+Me>Q.minX&&ge-Me<Q.maxY&&ge+Me>Q.minY){var de=g(Ie,ge,Q.x1,Q.y1,Q.x2,Q.y2);de<Oe&&(Oe=de,Me=Math.sqrt(Oe))}}return xe(Ie,ge)&&(Me=-Me),Me}function xe(Ie,ge){for(var Oe=0,Me=Z.length;Me--;){var Y=Z[Me];if(Y.maxX<=Ie)break;var Q=Y.y1>ge!=Y.y2>ge&&Ie<(Y.x2-Y.x1)*(ge-Y.y1)/(Y.y2-Y.y1)+Y.x1;Q&&(Oe+=Y.y1<Y.y2?1:-1)}return Oe!==0}}function _(z,O,D,B,W,q,j,te,ne,Z){q===void 0&&(q=1),te===void 0&&(te=0),ne===void 0&&(ne=0),Z===void 0&&(Z=0),v(z,O,D,B,W,q,j,null,te,ne,Z)}function v(z,O,D,B,W,q,j,te,ne,Z,le){q===void 0&&(q=1),ne===void 0&&(ne=0),Z===void 0&&(Z=0),le===void 0&&(le=0);for(var re=p(z,O,D,B,W,q),se=new Uint8Array(re.length*4),$=0;$<re.length;$++)se[$*4+le]=re[$];h(j,se,ne,Z,z,O,1<<3-le,te)}function g(z,O,D,B,W,q){var j=W-D,te=q-B,ne=j*j+te*te,Z=ne?Math.max(0,Math.min(1,((z-D)*j+(O-B)*te)/ne)):0,le=z-(D+Z*j),re=O-(B+Z*te);return le*le+re*re}var b=Object.freeze({__proto__:null,generate:p,generateIntoCanvas:_,generateIntoFramebuffer:v}),m="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",y="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",A="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",w=new Float32Array([0,0,2,0,0,2]),M=null,T=!1,E={},C=new WeakMap;function N(z){if(!T&&!F(z))throw new Error("WebGL generation not supported")}function P(z,O,D,B,W,q,j){if(q===void 0&&(q=1),j===void 0&&(j=null),!j&&(j=M,!j)){var te=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!te)throw new Error("OffscreenCanvas or DOM canvas not supported");j=M=te.getContext("webgl",{depth:!1})}N(j);var ne=new Uint8Array(z*O*4);u(j,function(se){var $=se.gl,fe=se.withTexture,xe=se.withTextureFramebuffer;fe("readable",function(Ie,ge){$.texImage2D($.TEXTURE_2D,0,$.RGBA,z,O,0,$.RGBA,$.UNSIGNED_BYTE,null),xe(Ie,ge,function(Oe){R(z,O,D,B,W,q,$,Oe,0,0,0),$.readPixels(0,0,z,O,$.RGBA,$.UNSIGNED_BYTE,ne)})})});for(var Z=new Uint8Array(z*O),le=0,re=0;le<ne.length;le+=4)Z[re++]=ne[le];return Z}function L(z,O,D,B,W,q,j,te,ne,Z){q===void 0&&(q=1),te===void 0&&(te=0),ne===void 0&&(ne=0),Z===void 0&&(Z=0),R(z,O,D,B,W,q,j,null,te,ne,Z)}function R(z,O,D,B,W,q,j,te,ne,Z,le){q===void 0&&(q=1),ne===void 0&&(ne=0),Z===void 0&&(Z=0),le===void 0&&(le=0),N(j);var re=[];s(D,function(se,$,fe,xe){re.push(se,$,fe,xe)}),re=new Float32Array(re),u(j,function(se){var $=se.gl,fe=se.isWebGL2,xe=se.getExtension,Ie=se.withProgram,ge=se.withTexture,Oe=se.withTextureFramebuffer,Me=se.handleContextLoss;if(ge("rawDistances",function(Y,Q){(z!==Y._lastWidth||O!==Y._lastHeight)&&$.texImage2D($.TEXTURE_2D,0,$.RGBA,Y._lastWidth=z,Y._lastHeight=O,0,$.RGBA,$.UNSIGNED_BYTE,null),Ie("main",m,y,function(de){var Le=de.setAttribute,ie=de.setUniform,K=!fe&&xe("ANGLE_instanced_arrays"),be=!fe&&xe("EXT_blend_minmax");Le("aUV",2,$.STATIC_DRAW,0,w),Le("aLineSegment",4,$.DYNAMIC_DRAW,1,re),ie.apply(void 0,["4f","uGlyphBounds"].concat(B)),ie("1f","uMaxDistance",W),ie("1f","uExponent",q),Oe(Y,Q,function(Ue){$.enable($.BLEND),$.colorMask(!0,!0,!0,!0),$.viewport(0,0,z,O),$.scissor(0,0,z,O),$.blendFunc($.ONE,$.ONE),$.blendEquationSeparate($.FUNC_ADD,fe?$.MAX:be.MAX_EXT),$.clear($.COLOR_BUFFER_BIT),fe?$.drawArraysInstanced($.TRIANGLES,0,3,re.length/4):K.drawArraysInstancedANGLE($.TRIANGLES,0,3,re.length/4)})}),Ie("post",o,A,function(de){de.setAttribute("aUV",2,$.STATIC_DRAW,0,w),de.setUniform("1i","tex",Q),$.bindFramebuffer($.FRAMEBUFFER,te),$.disable($.BLEND),$.colorMask(le===0,le===1,le===2,le===3),$.viewport(ne,Z,z,O),$.scissor(ne,Z,z,O),$.drawArrays($.TRIANGLES,0,3)})}),$.isContextLost())throw Me(),new Error("webgl context lost")})}function F(z){var O=!z||z===M?E:z.canvas||z,D=C.get(O);if(D===void 0){T=!0;var B=null;try{var W=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],q=P(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,z);D=q&&W.length===q.length&&q.every(function(j,te){return j===W[te]}),D||(B="bad trial run results",console.info(W,q))}catch(j){D=!1,B=j.message}B&&console.warn("WebGL SDF generation not supported:",B),T=!1,C.set(O,D)}return D}var V=Object.freeze({__proto__:null,generate:P,generateIntoCanvas:L,generateIntoFramebuffer:R,isSupported:F});function G(z,O,D,B,W,q){W===void 0&&(W=Math.max(B[2]-B[0],B[3]-B[1])/2),q===void 0&&(q=1);try{return P.apply(V,arguments)}catch(j){return console.info("WebGL SDF generation failed, falling back to JS",j),p.apply(b,arguments)}}function U(z,O,D,B,W,q,j,te,ne,Z){W===void 0&&(W=Math.max(B[2]-B[0],B[3]-B[1])/2),q===void 0&&(q=1),te===void 0&&(te=0),ne===void 0&&(ne=0),Z===void 0&&(Z=0);try{return L.apply(V,arguments)}catch(le){return console.info("WebGL SDF generation failed, falling back to JS",le),_.apply(b,arguments)}}return e.forEachPathCommand=r,e.generate=G,e.generateIntoCanvas=U,e.javascript=b,e.pathToLineSegments=s,e.webgl=V,e.webglUtils=f,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}function xte(){var i=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(t).forEach(function(Me,Y){n[Me]=1<<Y+1,r[n[Me]]=Me}),Object.freeze(n);var s=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,a=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,l=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,c=n.S|n.WS|n.B|s|n.PDI|l,u=null;function h(){if(!u){u=new Map;var Me=function(Q){if(t.hasOwnProperty(Q)){var de=0;t[Q].split(",").forEach(function(Le){var ie=Le.split("+"),K=ie[0],be=ie[1];K=parseInt(K,36),be=be?parseInt(be,36):0,u.set(de+=K,n[Q]);for(var Ue=0;Ue<be;Ue++)u.set(++de,n[Q])})}};for(var Y in t)Me(Y)}}function d(Me){return h(),u.get(Me.codePointAt(0))||n.L}function f(Me){return r[d(Me)]}var p={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function _(Me,Y){var Q=36,de=0,Le=new Map,ie=Y&&new Map,K;return Me.split(",").forEach(function be(Ue){if(Ue.indexOf("+")!==-1)for(var ve=+Ue;ve--;)be(K);else{K=Ue;var Ne=Ue.split(">"),$e=Ne[0],Ee=Ne[1];$e=String.fromCodePoint(de+=parseInt($e,Q)),Ee=String.fromCodePoint(de+=parseInt(Ee,Q)),Le.set($e,Ee),Y&&ie.set(Ee,$e)}}),{map:Le,reverseMap:ie}}var v,g,b;function m(){if(!v){var Me=_(p.pairs,!0),Y=Me.map,Q=Me.reverseMap;v=Y,g=Q,b=_(p.canonical,!1).map}}function y(Me){return m(),v.get(Me)||null}function A(Me){return m(),g.get(Me)||null}function w(Me){return m(),b.get(Me)||null}var M=n.L,T=n.R,E=n.EN,C=n.ES,N=n.ET,P=n.AN,L=n.CS,R=n.B,F=n.S,V=n.ON,G=n.BN,U=n.NSM,z=n.AL,O=n.LRO,D=n.RLO,B=n.LRE,W=n.RLE,q=n.PDF,j=n.LRI,te=n.RLI,ne=n.FSI,Z=n.PDI;function le(Me,Y){for(var Q=125,de=new Uint32Array(Me.length),Le=0;Le<Me.length;Le++)de[Le]=d(Me[Le]);var ie=new Map;function K(Tr,_s){var Hi=de[Tr];de[Tr]=_s,ie.set(Hi,ie.get(Hi)-1),Hi&a&&ie.set(a,ie.get(a)-1),ie.set(_s,(ie.get(_s)||0)+1),_s&a&&ie.set(a,(ie.get(a)||0)+1)}for(var be=new Uint8Array(Me.length),Ue=new Map,ve=[],Ne=null,$e=0;$e<Me.length;$e++)Ne||ve.push(Ne={start:$e,end:Me.length-1,level:Y==="rtl"?1:Y==="ltr"?0:qd($e,!1)}),de[$e]&R&&(Ne.end=$e,Ne=null);for(var Ee=W|B|D|O|s|Z|q|R,Ze=function(Tr){return Tr+(Tr&1?1:2)},nt=function(Tr){return Tr+(Tr&1?2:1)},rt=0;rt<ve.length;rt++){Ne=ve[rt];var Be=[{_level:Ne.level,_override:0,_isolate:0}],qe=void 0,it=0,at=0,ht=0;ie.clear();for(var Qe=Ne.start;Qe<=Ne.end;Qe++){var je=de[Qe];if(qe=Be[Be.length-1],ie.set(je,(ie.get(je)||0)+1),je&a&&ie.set(a,(ie.get(a)||0)+1),je&Ee)if(je&(W|B)){be[Qe]=qe._level;var ee=(je===W?nt:Ze)(qe._level);ee<=Q&&!it&&!at?Be.push({_level:ee,_override:0,_isolate:0}):it||at++}else if(je&(D|O)){be[Qe]=qe._level;var Ge=(je===D?nt:Ze)(qe._level);Ge<=Q&&!it&&!at?Be.push({_level:Ge,_override:je&D?T:M,_isolate:0}):it||at++}else if(je&s){je&ne&&(je=qd(Qe+1,!0)===1?te:j),be[Qe]=qe._level,qe._override&&K(Qe,qe._override);var Ce=(je===te?nt:Ze)(qe._level);Ce<=Q&&it===0&&at===0?(ht++,Be.push({_level:Ce,_override:0,_isolate:1,_isolInitIndex:Qe})):it++}else if(je&Z){if(it>0)it--;else if(ht>0){for(at=0;!Be[Be.length-1]._isolate;)Be.pop();var De=Be[Be.length-1]._isolInitIndex;De!=null&&(Ue.set(De,Qe),Ue.set(Qe,De)),Be.pop(),ht--}qe=Be[Be.length-1],be[Qe]=qe._level,qe._override&&K(Qe,qe._override)}else je&q?(it===0&&(at>0?at--:!qe._isolate&&Be.length>1&&(Be.pop(),qe=Be[Be.length-1])),be[Qe]=qe._level):je&R&&(be[Qe]=Ne.level);else be[Qe]=qe._level,qe._override&&je!==G&&K(Qe,qe._override)}for(var Xe=[],gt=null,_t=Ne.start;_t<=Ne.end;_t++){var Mt=de[_t];if(!(Mt&l)){var J=be[_t],ae=Mt&s,ue=Mt===Z;gt&&J===gt._level?(gt._end=_t,gt._endsWithIsolInit=ae):Xe.push(gt={_start:_t,_end:_t,_level:J,_startsWithPDI:ue,_endsWithIsolInit:ae})}}for(var ye=[],Se=0;Se<Xe.length;Se++){var Fe=Xe[Se];if(!Fe._startsWithPDI||Fe._startsWithPDI&&!Ue.has(Fe._start)){for(var ze=[gt=Fe],He=void 0;gt&&gt._endsWithIsolInit&&(He=Ue.get(gt._end))!=null;)for(var lt=Se+1;lt<Xe.length;lt++)if(Xe[lt]._start===He){ze.push(gt=Xe[lt]);break}for(var mt=[],wt=0;wt<ze.length;wt++)for(var Gt=ze[wt],Tt=Gt._start;Tt<=Gt._end;Tt++)mt.push(Tt);for(var bt=be[mt[0]],H=Ne.level,pe=mt[0]-1;pe>=0;pe--)if(!(de[pe]&l)){H=be[pe];break}var Ae=mt[mt.length-1],we=be[Ae],Pe=Ne.level;if(!(de[Ae]&s)){for(var et=Ae+1;et<=Ne.end;et++)if(!(de[et]&l)){Pe=be[et];break}}ye.push({_seqIndices:mt,_sosType:Math.max(H,bt)%2?T:M,_eosType:Math.max(Pe,we)%2?T:M})}}for(var dt=0;dt<ye.length;dt++){var xt=ye[dt],Ye=xt._seqIndices,We=xt._sosType,st=xt._eosType,ct=be[Ye[0]]&1?T:M;if(ie.get(U))for(var Nt=0;Nt<Ye.length;Nt++){var Ft=Ye[Nt];if(de[Ft]&U){for(var Dt=We,Bt=Nt-1;Bt>=0;Bt--)if(!(de[Ye[Bt]]&l)){Dt=de[Ye[Bt]];break}K(Ft,Dt&(s|Z)?V:Dt)}}if(ie.get(E))for(var St=0;St<Ye.length;St++){var vt=Ye[St];if(de[vt]&E)for(var Wt=St-1;Wt>=-1;Wt--){var Lt=Wt===-1?We:de[Ye[Wt]];if(Lt&o){Lt===z&&K(vt,P);break}}}if(ie.get(z))for(var yn=0;yn<Ye.length;yn++){var bi=Ye[yn];de[bi]&z&&K(bi,T)}if(ie.get(C)||ie.get(L))for(var qn=1;qn<Ye.length-1;qn++){var Ln=Ye[qn];if(de[Ln]&(C|L)){for(var tn=0,Yn=0,Ji=qn-1;Ji>=0&&(tn=de[Ye[Ji]],!!(tn&l));Ji--);for(var dn=qn+1;dn<Ye.length&&(Yn=de[Ye[dn]],!!(Yn&l));dn++);tn===Yn&&(de[Ln]===C?tn===E:tn&(E|P))&&K(Ln,tn)}}if(ie.get(E))for(var Qn=0;Qn<Ye.length;Qn++){var er=Ye[Qn];if(de[er]&E){for(var Mr=Qn-1;Mr>=0&&de[Ye[Mr]]&(N|l);Mr--)K(Ye[Mr],E);for(Qn++;Qn<Ye.length&&de[Ye[Qn]]&(N|l|E);Qn++)de[Ye[Qn]]!==E&&K(Ye[Qn],E)}}if(ie.get(N)||ie.get(C)||ie.get(L))for(var oo=0;oo<Ye.length;oo++){var qa=Ye[oo];if(de[qa]&(N|C|L)){K(qa,V);for(var ds=oo-1;ds>=0&&de[Ye[ds]]&l;ds--)K(Ye[ds],V);for(var fs=oo+1;fs<Ye.length&&de[Ye[fs]]&l;fs++)K(Ye[fs],V)}}if(ie.get(E))for(var ps=0,ao=We;ps<Ye.length;ps++){var Ya=Ye[ps],oa=de[Ya];oa&E?ao===M&&K(Ya,M):oa&o&&(ao=oa)}if(ie.get(a)){var Ar=T|E|P,aa=Ar|M,lo=[];{for(var fr=[],Yr=0;Yr<Ye.length;Yr++)if(de[Ye[Yr]]&a){var cn=Me[Ye[Yr]],Pl=void 0;if(y(cn)!==null)if(fr.length<63)fr.push({char:cn,seqIndex:Yr});else break;else if((Pl=A(cn))!==null)for(var Rl=fr.length-1;Rl>=0;Rl--){var jd=fr[Rl].char;if(jd===Pl||jd===A(w(cn))||y(w(jd))===cn){lo.push([fr[Rl].seqIndex,Yr]),fr.length=Rl;break}}}lo.sort(function(Tr,_s){return Tr[0]-_s[0]})}for(var Gm=0;Gm<lo.length;Gm++){for(var iv=lo[Gm],Si=iv[0],th=iv[1],rv=!1,ms=0,Vm=Si+1;Vm<th;Vm++){var nh=Ye[Vm];if(de[nh]&aa){rv=!0;var co=de[nh]&Ar?T:M;if(co===ct){ms=co;break}}}if(rv&&!ms){ms=We;for(var Hm=Si-1;Hm>=0;Hm--){var sv=Ye[Hm];if(de[sv]&aa){var uo=de[sv]&Ar?T:M;uo!==ct?ms=uo:ms=ct;break}}}if(ms){if(de[Ye[Si]]=de[Ye[th]]=ms,ms!==ct){for(var gs=Si+1;gs<Ye.length;gs++)if(!(de[Ye[gs]]&l)){d(Me[Ye[gs]])&U&&(de[Ye[gs]]=ms);break}}if(ms!==ct){for(var Ka=th+1;Ka<Ye.length;Ka++)if(!(de[Ye[Ka]]&l)){d(Me[Ye[Ka]])&U&&(de[Ye[Ka]]=ms);break}}}}for(var ko=0;ko<Ye.length;ko++)if(de[Ye[ko]]&a){for(var $m=ko,Wm=ko,Bs=We,ih=ko-1;ih>=0;ih--)if(de[Ye[ih]]&l)$m=ih;else{Bs=de[Ye[ih]]&Ar?T:M;break}for(var rh=st,sh=ko+1;sh<Ye.length;sh++)if(de[Ye[sh]]&(a|l))Wm=sh;else{rh=de[Ye[sh]]&Ar?T:M;break}for(var vs=$m;vs<=Wm;vs++)de[Ye[vs]]=Bs===rh?Bs:ct;ko=Wm}}}for(var Er=Ne.start;Er<=Ne.end;Er++){var Xd=be[Er],la=de[Er];if(Xd&1?la&(M|E|P)&&be[Er]++:la&T?be[Er]++:la&(P|E)&&(be[Er]+=2),la&l&&(be[Er]=Er===0?Ne.level:be[Er-1]),Er===Ne.end||d(Me[Er])&(F|R))for(var Lc=Er;Lc>=0&&d(Me[Lc])&c;Lc--)be[Lc]=Ne.level}}return{levels:be,paragraphs:ve};function qd(Tr,_s){for(var Hi=Tr;Hi<Me.length;Hi++){var $i=de[Hi];if($i&(T|z))return 1;if($i&(R|M)||_s&&$i===Z)return 0;if($i&s){var ho=ov(Hi);Hi=ho===-1?Me.length:ho}}return 0}function ov(Tr){for(var _s=1,Hi=Tr+1;Hi<Me.length;Hi++){var $i=de[Hi];if($i&R)break;if($i&Z){if(--_s===0)return Hi}else $i&s&&_s++}return-1}}var re="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",se;function $(){if(!se){var Me=_(re,!0),Y=Me.map,Q=Me.reverseMap;Q.forEach(function(de,Le){Y.set(Le,de)}),se=Y}}function fe(Me){return $(),se.get(Me)||null}function xe(Me,Y,Q,de){var Le=Me.length;Q=Math.max(0,Q==null?0:+Q),de=Math.min(Le-1,de==null?Le-1:+de);for(var ie=new Map,K=Q;K<=de;K++)if(Y[K]&1){var be=fe(Me[K]);be!==null&&ie.set(K,be)}return ie}function Ie(Me,Y,Q,de){var Le=Me.length;Q=Math.max(0,Q==null?0:+Q),de=Math.min(Le-1,de==null?Le-1:+de);var ie=[];return Y.paragraphs.forEach(function(K){var be=Math.max(Q,K.start),Ue=Math.min(de,K.end);if(be<Ue){for(var ve=Y.levels.slice(be,Ue+1),Ne=Ue;Ne>=be&&d(Me[Ne])&c;Ne--)ve[Ne]=K.level;for(var $e=K.level,Ee=1/0,Ze=0;Ze<ve.length;Ze++){var nt=ve[Ze];nt>$e&&($e=nt),nt<Ee&&(Ee=nt|1)}for(var rt=$e;rt>=Ee;rt--)for(var Be=0;Be<ve.length;Be++)if(ve[Be]>=rt){for(var qe=Be;Be+1<ve.length&&ve[Be+1]>=rt;)Be++;Be>qe&&ie.push([qe+be,Be+be])}}}),ie}function ge(Me,Y,Q,de){var Le=Oe(Me,Y,Q,de),ie=[].concat(Me);return Le.forEach(function(K,be){ie[be]=(Y.levels[K]&1?fe(Me[K]):null)||Me[K]}),ie.join("")}function Oe(Me,Y,Q,de){for(var Le=Ie(Me,Y,Q,de),ie=[],K=0;K<Me.length;K++)ie[K]=K;return Le.forEach(function(be){for(var Ue=be[0],ve=be[1],Ne=ie.slice(Ue,ve+1),$e=Ne.length;$e--;)ie[ve-$e]=Ne[$e]}),ie}return e.closingToOpeningBracket=A,e.getBidiCharType=d,e.getBidiCharTypeName=f,e.getCanonicalBracket=w,e.getEmbeddingLevels=le,e.getMirroredCharacter=fe,e.getMirroredCharactersMap=xe,e.getReorderSegments=Ie,e.getReorderedIndices=Oe,e.getReorderedString=ge,e.openingToClosingBracket=y,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}const wG=/\bvoid\s+main\s*\(\s*\)\s*{/g;function aC(i){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(n,r){let s=un[r];return s?aC(s):n}return i.replace(e,t)}const Gr=[];for(let i=0;i<256;i++)Gr[i]=(i<16?"0":"")+i.toString(16);function bte(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Gr[i&255]+Gr[i>>8&255]+Gr[i>>16&255]+Gr[i>>24&255]+"-"+Gr[e&255]+Gr[e>>8&255]+"-"+Gr[e>>16&15|64]+Gr[e>>24&255]+"-"+Gr[t&63|128]+Gr[t>>8&255]+"-"+Gr[t>>16&255]+Gr[t>>24&255]+Gr[n&255]+Gr[n>>8&255]+Gr[n>>16&255]+Gr[n>>24&255]).toUpperCase()}const Eh=Object.assign||function(){let i=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let n=arguments[e];if(n)for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i},Ste=Date.now(),LF=new WeakMap,DF=new Map;let wte=1e10;function lC(i,e){const t=Tte(e);let n=LF.get(i);if(n||LF.set(i,n=Object.create(null)),n[t])return new n[t];const r=`_onBeforeCompile${t}`,s=function(c,u){i.onBeforeCompile.call(this,c,u);const h=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let d=DF[h];if(!d){const f=Mte(this,c,e,t);d=DF[h]=f}c.vertexShader=d.vertexShader,c.fragmentShader=d.fragmentShader,Eh(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-Ste}}),this[r]&&this[r](c)},o=function(){return a(e.chained?i:i.clone())},a=function(c){const u=Object.create(c,l);return Object.defineProperty(u,"baseMaterial",{value:i}),Object.defineProperty(u,"id",{value:wte++}),u.uuid=bte(),u.uniforms=Eh({},c.uniforms,e.uniforms),u.defines=Eh({},c.defines,e.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",u.extensions=Eh({},c.extensions,e.extensions),u._listeners=void 0,u},l={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>i.type,set:c=>{i.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const u=this.baseMaterial;return c===u||u.isDerivedMaterial&&u.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return i.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return s},set(c){this[r]=c}},copy:{writable:!0,configurable:!0,value:function(c){return i.copy.call(this,c),!i.isShaderMaterial&&!i.isDerivedMaterial&&(Eh(this.extensions,c.extensions),Eh(this.defines,c.defines),Eh(this.uniforms,_R.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new i.constructor;return a(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=lC(i.isDerivedMaterial?i.getDepthMaterial():new bS({depthPacking:hR}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=lC(i.isDerivedMaterial?i.getDistanceMaterial():new SS,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:u}=this;c&&c.dispose(),u&&u.dispose(),i.dispose.call(this)}}};return n[t]=o,new o}function Mte(i,{vertexShader:e,fragmentShader:t},n,r){let{vertexDefs:s,vertexMainIntro:o,vertexMainOutro:a,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:h,fragmentColorTransform:d,customRewriter:f,timeUniform:p}=n;if(s=s||"",o=o||"",a=a||"",c=c||"",u=u||"",h=h||"",(l||f)&&(e=aC(e)),(d||f)&&(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),t=aC(t)),f){let _=f({vertexShader:e,fragmentShader:t});e=_.vertexShader,t=_.fragmentShader}if(d){let _=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,v=>(_.push(v),"")),h=`${d}
${_.join(`
`)}
${h}`}if(p){const _=`
uniform float ${p};
`;s=_+s,c=_+c}return l&&(e=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${e}
`,s=`${s}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,o=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${o}
`,e=e.replace(/\b(position|normal|uv)\b/g,(_,v,g,b)=>/\battribute\s+vec[23]\s+$/.test(b.substr(0,g))?v:`troika_${v}_${r}`),i.map&&i.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),e=NF(e,r,s,o,a),t=NF(t,r,c,u,h),{vertexShader:e,fragmentShader:t}}function NF(i,e,t,n,r){return(n||r||t)&&(i=i.replace(wG,`
${t}
void troikaOrigMain${e}() {`),i+=`
void main() {
  ${n}
  troikaOrigMain${e}();
  ${r}
}`),i}function Ate(i,e){return i==="uniforms"?void 0:typeof e=="function"?e.toString():e}let Ete=0;const FF=new Map;function Tte(i){const e=JSON.stringify(i,Ate);let t=FF.get(e);return t==null&&FF.set(e,t=++Ete),t}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Cte(){return typeof window>"u"&&(self.window=self),function(i){var e={parse:function(r){var s=e._bin,o=new Uint8Array(r);if(s.readASCII(o,0,4)=="ttcf"){var a=4;s.readUshort(o,a),a+=2,s.readUshort(o,a),a+=2;var l=s.readUint(o,a);a+=4;for(var c=[],u=0;u<l;u++){var h=s.readUint(o,a);a+=4,c.push(e._readFont(o,h))}return c}return[e._readFont(o,0)]},_readFont:function(r,s){var o=e._bin,a=s;o.readFixed(r,s),s+=4;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:r,_offset:a},h={},d=0;d<l;d++){var f=o.readASCII(r,s,4);s+=4,o.readUint(r,s),s+=4;var p=o.readUint(r,s);s+=4;var _=o.readUint(r,s);s+=4,h[f]={offset:p,length:_}}for(d=0;d<c.length;d++){var v=c[d];h[v]&&(u[v.trim()]=e[v.trim()].parse(r,h[v].offset,h[v].length,u))}return u},_tabOffset:function(r,s,o){for(var a=e._bin,l=a.readUshort(r,o+4),c=o+12,u=0;u<l;u++){var h=a.readASCII(r,c,4);c+=4,a.readUint(r,c),c+=4;var d=a.readUint(r,c);if(c+=4,a.readUint(r,c),c+=4,h==s)return d}return 0}};e._bin={readFixed:function(r,s){return(r[s]<<8|r[s+1])+(r[s+2]<<8|r[s+3])/65540},readF2dot14:function(r,s){return e._bin.readShort(r,s)/16384},readInt:function(r,s){return e._bin._view(r).getInt32(s)},readInt8:function(r,s){return e._bin._view(r).getInt8(s)},readShort:function(r,s){return e._bin._view(r).getInt16(s)},readUshort:function(r,s){return e._bin._view(r).getUint16(s)},readUshorts:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(e._bin.readUshort(r,s+2*l));return a},readUint:function(r,s){return e._bin._view(r).getUint32(s)},readUint64:function(r,s){return 4294967296*e._bin.readUint(r,s)+e._bin.readUint(r,s+4)},readASCII:function(r,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(r[s+l]);return a},readUnicode:function(r,s,o){for(var a="",l=0;l<o;l++){var c=r[s++]<<8|r[s++];a+=String.fromCharCode(c)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,s,o){var a=e._bin._tdec;return a&&s==0&&o==r.length?a.decode(r):e._bin.readASCII(r,s,o)},readBytes:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(r[s+l]);return a},readASCIIArray:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(String.fromCharCode(r[s+l]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},e._lctf={},e._lctf.parse=function(r,s,o,a,l){var c=e._bin,u={},h=s;c.readFixed(r,s),s+=4;var d=c.readUshort(r,s);s+=2;var f=c.readUshort(r,s);s+=2;var p=c.readUshort(r,s);return s+=2,u.scriptList=e._lctf.readScriptList(r,h+d),u.featureList=e._lctf.readFeatureList(r,h+f),u.lookupList=e._lctf.readLookupList(r,h+p,l),u},e._lctf.readLookupList=function(r,s,o){var a=e._bin,l=s,c=[],u=a.readUshort(r,s);s+=2;for(var h=0;h<u;h++){var d=a.readUshort(r,s);s+=2;var f=e._lctf.readLookupTable(r,l+d,o);c.push(f)}return c},e._lctf.readLookupTable=function(r,s,o){var a=e._bin,l=s,c={tabs:[]};c.ltype=a.readUshort(r,s),s+=2,c.flag=a.readUshort(r,s),s+=2;var u=a.readUshort(r,s);s+=2;for(var h=c.ltype,d=0;d<u;d++){var f=a.readUshort(r,s);s+=2;var p=o(r,h,l+f,c);c.tabs.push(p)}return c},e._lctf.numOfOnes=function(r){for(var s=0,o=0;o<32;o++)r>>>o&1&&s++;return s},e._lctf.readClassDef=function(r,s){var o=e._bin,a=[],l=o.readUshort(r,s);if(s+=2,l==1){var c=o.readUshort(r,s);s+=2;var u=o.readUshort(r,s);s+=2;for(var h=0;h<u;h++)a.push(c+h),a.push(c+h),a.push(o.readUshort(r,s)),s+=2}if(l==2){var d=o.readUshort(r,s);for(s+=2,h=0;h<d;h++)a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2}return a},e._lctf.getInterval=function(r,s){for(var o=0;o<r.length;o+=3){var a=r[o],l=r[o+1];if(r[o+2],a<=s&&s<=l)return o}return-1},e._lctf.readCoverage=function(r,s){var o=e._bin,a={};a.fmt=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.fmt==1&&(a.tab=o.readUshorts(r,s,l)),a.fmt==2&&(a.tab=o.readUshorts(r,s,3*l)),a},e._lctf.coverageIndex=function(r,s){var o=r.tab;if(r.fmt==1)return o.indexOf(s);if(r.fmt==2){var a=e._lctf.getInterval(o,s);if(a!=-1)return o[a+2]+(s-o[a])}return-1},e._lctf.readFeatureList=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readASCII(r,s,4);s+=4;var d=o.readUshort(r,s);s+=2;var f=e._lctf.readFeatureTable(r,a+d);f.tag=h.trim(),l.push(f)}return l},e._lctf.readFeatureTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.featureParams=a+c);var u=o.readUshort(r,s);s+=2,l.tab=[];for(var h=0;h<u;h++)l.tab.push(o.readUshort(r,s+2*h));return l},e._lctf.readScriptList=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readASCII(r,s,4);s+=4;var d=o.readUshort(r,s);s+=2,l[h.trim()]=e._lctf.readScriptTable(r,a+d)}return l},e._lctf.readScriptTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.default=e._lctf.readLangSysTable(r,a+c));var u=o.readUshort(r,s);s+=2;for(var h=0;h<u;h++){var d=o.readASCII(r,s,4);s+=4;var f=o.readUshort(r,s);s+=2,l[d.trim()]=e._lctf.readLangSysTable(r,a+f)}return l},e._lctf.readLangSysTable=function(r,s){var o=e._bin,a={};o.readUshort(r,s),s+=2,a.reqFeature=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.features=o.readUshorts(r,s,l),a},e.CFF={},e.CFF.parse=function(r,s,o){var a=e._bin;(r=new Uint8Array(r.buffer,s,o))[s=0],r[++s],r[++s],r[++s],s++;var l=[];s=e.CFF.readIndex(r,s,l);for(var c=[],u=0;u<l.length-1;u++)c.push(a.readASCII(r,s+l[u],l[u+1]-l[u]));s+=l[l.length-1];var h=[];s=e.CFF.readIndex(r,s,h);var d=[];for(u=0;u<h.length-1;u++)d.push(e.CFF.readDict(r,s+h[u],s+h[u+1]));s+=h[h.length-1];var f=d[0],p=[];s=e.CFF.readIndex(r,s,p);var _=[];for(u=0;u<p.length-1;u++)_.push(a.readASCII(r,s+p[u],p[u+1]-p[u]));if(s+=p[p.length-1],e.CFF.readSubrs(r,s,f),f.CharStrings){s=f.CharStrings,p=[],s=e.CFF.readIndex(r,s,p);var v=[];for(u=0;u<p.length-1;u++)v.push(a.readBytes(r,s+p[u],p[u+1]-p[u]));f.CharStrings=v}if(f.ROS){s=f.FDArray;var g=[];for(s=e.CFF.readIndex(r,s,g),f.FDArray=[],u=0;u<g.length-1;u++){var b=e.CFF.readDict(r,s+g[u],s+g[u+1]);e.CFF._readFDict(r,b,_),f.FDArray.push(b)}s+=g[g.length-1],s=f.FDSelect,f.FDSelect=[];var m=r[s];if(s++,m!=3)throw m;var y=a.readUshort(r,s);for(s+=2,u=0;u<y+1;u++)f.FDSelect.push(a.readUshort(r,s),r[s+2]),s+=3}return f.Encoding&&(f.Encoding=e.CFF.readEncoding(r,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=e.CFF.readCharset(r,f.charset,f.CharStrings.length)),e.CFF._readFDict(r,f,_),f},e.CFF._readFDict=function(r,s,o){var a;for(var l in s.Private&&(a=s.Private[1],s.Private=e.CFF.readDict(r,a,a+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(r,a+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(s[l]=o[s[l]-426+35])},e.CFF.readSubrs=function(r,s,o){var a=e._bin,l=[];s=e.CFF.readIndex(r,s,l);var c,u=l.length;c=u<1240?107:u<33900?1131:32768,o.Bias=c,o.Subrs=[];for(var h=0;h<l.length-1;h++)o.Subrs.push(a.readBytes(r,s+l[h],l[h+1]-l[h]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(r,s){for(var o=0;o<r.charset.length;o++)if(r.charset[o]==s)return o;return-1},e.CFF.glyphBySE=function(r,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(r,e.CFF.tableSE[s])},e.CFF.readEncoding=function(r,s,o){e._bin;var a=[".notdef"],l=r[s];if(s++,l!=0)throw"error: unknown encoding format: "+l;var c=r[s];s++;for(var u=0;u<c;u++)a.push(r[s+u]);return a},e.CFF.readCharset=function(r,s,o){var a=e._bin,l=[".notdef"],c=r[s];if(s++,c==0)for(var u=0;u<o;u++){var h=a.readUshort(r,s);s+=2,l.push(h)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<o;){h=a.readUshort(r,s),s+=2;var d=0;for(c==1?(d=r[s],s++):(d=a.readUshort(r,s),s+=2),u=0;u<=d;u++)l.push(h),h++}}return l},e.CFF.readIndex=function(r,s,o){var a=e._bin,l=a.readUshort(r,s)+1,c=r[s+=2];if(s++,c==1)for(var u=0;u<l;u++)o.push(r[s+u]);else if(c==2)for(u=0;u<l;u++)o.push(a.readUshort(r,s+2*u));else if(c==3)for(u=0;u<l;u++)o.push(16777215&a.readUint(r,s+3*u-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(s+=l*c)-1},e.CFF.getCharString=function(r,s,o){var a=e._bin,l=r[s],c=r[s+1];r[s+2],r[s+3],r[s+4];var u=1,h=null,d=null;l<=20&&(h=l,u=1),l==12&&(h=100*l+c,u=2),21<=l&&l<=27&&(h=l,u=1),l==28&&(d=a.readShort(r,s+1),u=3),29<=l&&l<=31&&(h=l,u=1),32<=l&&l<=246&&(d=l-139,u=1),247<=l&&l<=250&&(d=256*(l-247)+c+108,u=2),251<=l&&l<=254&&(d=256*-(l-251)-c-108,u=2),l==255&&(d=a.readInt(r,s+1)/65535,u=5),o.val=d??"o"+h,o.size=u},e.CFF.readCharString=function(r,s,o){for(var a=s+o,l=e._bin,c=[];s<a;){var u=r[s],h=r[s+1];r[s+2],r[s+3],r[s+4];var d=1,f=null,p=null;u<=20&&(f=u,d=1),u==12&&(f=100*u+h,d=2),u!=19&&u!=20||(f=u,d=2),21<=u&&u<=27&&(f=u,d=1),u==28&&(p=l.readShort(r,s+1),d=3),29<=u&&u<=31&&(f=u,d=1),32<=u&&u<=246&&(p=u-139,d=1),247<=u&&u<=250&&(p=256*(u-247)+h+108,d=2),251<=u&&u<=254&&(p=256*-(u-251)-h-108,d=2),u==255&&(p=l.readInt(r,s+1)/65535,d=5),c.push(p??"o"+f),s+=d}return c},e.CFF.readDict=function(r,s,o){for(var a=e._bin,l={},c=[];s<o;){var u=r[s],h=r[s+1];r[s+2],r[s+3],r[s+4];var d=1,f=null,p=null;if(u==28&&(p=a.readShort(r,s+1),d=3),u==29&&(p=a.readInt(r,s+1),d=5),32<=u&&u<=246&&(p=u-139,d=1),247<=u&&u<=250&&(p=256*(u-247)+h+108,d=2),251<=u&&u<=254&&(p=256*-(u-251)-h-108,d=2),u==255)throw p=a.readInt(r,s+1)/65535,d=5,"unknown number";if(u==30){var _=[];for(d=1;;){var v=r[s+d];d++;var g=v>>4,b=15&v;if(g!=15&&_.push(g),b!=15&&_.push(b),b==15)break}for(var m="",y=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],A=0;A<_.length;A++)m+=y[_[A]];p=parseFloat(m)}u<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],d=1,u==12&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],d=2)),f!=null?(l[f]=c.length==1?c[0]:c,c=[]):c.push(p),s+=d}return l},e.cmap={},e.cmap.parse=function(r,s,o){r=new Uint8Array(r.buffer,s,o),s=0;var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2;var u=[];l.tables=[];for(var h=0;h<c;h++){var d=a.readUshort(r,s);s+=2;var f=a.readUshort(r,s);s+=2;var p=a.readUint(r,s);s+=4;var _="p"+d+"e"+f,v=u.indexOf(p);if(v==-1){var g;v=l.tables.length,u.push(p);var b=a.readUshort(r,p);b==0?g=e.cmap.parse0(r,p):b==4?g=e.cmap.parse4(r,p):b==6?g=e.cmap.parse6(r,p):b==12?g=e.cmap.parse12(r,p):console.debug("unknown format: "+b,d,f,p),l.tables.push(g)}if(l[_]!=null)throw"multiple tables for one platform+encoding";l[_]=v}return l},e.cmap.parse0=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,a.map=[];for(var c=0;c<l-6;c++)a.map.push(r[s+c]);return a},e.cmap.parse4=function(r,s){var o=e._bin,a=s,l={};l.format=o.readUshort(r,s),s+=2;var c=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2;var u=o.readUshort(r,s);s+=2;var h=u/2;l.searchRange=o.readUshort(r,s),s+=2,l.entrySelector=o.readUshort(r,s),s+=2,l.rangeShift=o.readUshort(r,s),s+=2,l.endCount=o.readUshorts(r,s,h),s+=2*h,s+=2,l.startCount=o.readUshorts(r,s,h),s+=2*h,l.idDelta=[];for(var d=0;d<h;d++)l.idDelta.push(o.readShort(r,s)),s+=2;for(l.idRangeOffset=o.readUshorts(r,s,h),s+=2*h,l.glyphIdArray=[];s<a+c;)l.glyphIdArray.push(o.readUshort(r,s)),s+=2;return l},e.cmap.parse6=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,a.firstCode=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,a.glyphIdArray=[];for(var c=0;c<l;c++)a.glyphIdArray.push(o.readUshort(r,s)),s+=2;return a},e.cmap.parse12=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,s+=2,o.readUint(r,s),s+=4,o.readUint(r,s),s+=4;var l=o.readUint(r,s);s+=4,a.groups=[];for(var c=0;c<l;c++){var u=s+12*c,h=o.readUint(r,u+0),d=o.readUint(r,u+4),f=o.readUint(r,u+8);a.groups.push([h,d,f])}return a},e.glyf={},e.glyf.parse=function(r,s,o,a){for(var l=[],c=0;c<a.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(r,s){var o=e._bin,a=r._data,l=e._tabOffset(a,"glyf",r._offset)+r.loca[s];if(r.loca[s]==r.loca[s+1])return null;var c={};if(c.noc=o.readShort(a,l),l+=2,c.xMin=o.readShort(a,l),l+=2,c.yMin=o.readShort(a,l),l+=2,c.xMax=o.readShort(a,l),l+=2,c.yMax=o.readShort(a,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var u=0;u<c.noc;u++)c.endPts.push(o.readUshort(a,l)),l+=2;var h=o.readUshort(a,l);if(l+=2,a.length-l<h)return null;c.instructions=o.readBytes(a,l,h),l+=h;var d=c.endPts[c.noc-1]+1;for(c.flags=[],u=0;u<d;u++){var f=a[l];if(l++,c.flags.push(f),(8&f)!=0){var p=a[l];l++;for(var _=0;_<p;_++)c.flags.push(f),u++}}for(c.xs=[],u=0;u<d;u++){var v=(2&c.flags[u])!=0,g=(16&c.flags[u])!=0;v?(c.xs.push(g?a[l]:-a[l]),l++):g?c.xs.push(0):(c.xs.push(o.readShort(a,l)),l+=2)}for(c.ys=[],u=0;u<d;u++)v=(4&c.flags[u])!=0,g=(32&c.flags[u])!=0,v?(c.ys.push(g?a[l]:-a[l]),l++):g?c.ys.push(0):(c.ys.push(o.readShort(a,l)),l+=2);var b=0,m=0;for(u=0;u<d;u++)b+=c.xs[u],m+=c.ys[u],c.xs[u]=b,c.ys[u]=m}else{var y;c.parts=[];do{y=o.readUshort(a,l),l+=2;var A={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(A),A.glyphIndex=o.readUshort(a,l),l+=2,1&y){var w=o.readShort(a,l);l+=2;var M=o.readShort(a,l);l+=2}else w=o.readInt8(a,l),l++,M=o.readInt8(a,l),l++;2&y?(A.m.tx=w,A.m.ty=M):(A.p1=w,A.p2=M),8&y?(A.m.a=A.m.d=o.readF2dot14(a,l),l+=2):64&y?(A.m.a=o.readF2dot14(a,l),l+=2,A.m.d=o.readF2dot14(a,l),l+=2):128&y&&(A.m.a=o.readF2dot14(a,l),l+=2,A.m.b=o.readF2dot14(a,l),l+=2,A.m.c=o.readF2dot14(a,l),l+=2,A.m.d=o.readF2dot14(a,l),l+=2)}while(32&y);if(256&y){var T=o.readUshort(a,l);for(l+=2,c.instr=[],u=0;u<T;u++)c.instr.push(a[l]),l++}}return c},e.GDEF={},e.GDEF.parse=function(r,s,o,a){var l=s;s+=4;var c=e._bin.readUshort(r,s);return{glyphClassDef:c===0?null:e._lctf.readClassDef(r,l+c)}},e.GPOS={},e.GPOS.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GPOS.subt)},e.GPOS.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,s==1||s==2||s==3||s==7||s==8&&u.fmt<=2){var h=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,h+c)}if(s==1&&u.fmt==1){var d=l.readUshort(r,o);o+=2,d!=0&&(u.pos=e.GPOS.readValueRecord(r,o,d))}else if(s==2&&u.fmt>=1&&u.fmt<=2){d=l.readUshort(r,o),o+=2;var f=l.readUshort(r,o);o+=2;var p=e._lctf.numOfOnes(d),_=e._lctf.numOfOnes(f);if(u.fmt==1){u.pairsets=[];var v=l.readUshort(r,o);o+=2;for(var g=0;g<v;g++){var b=c+l.readUshort(r,o);o+=2;var m=l.readUshort(r,b);b+=2;for(var y=[],A=0;A<m;A++){var w=l.readUshort(r,b);b+=2,d!=0&&(P=e.GPOS.readValueRecord(r,b,d),b+=2*p),f!=0&&(L=e.GPOS.readValueRecord(r,b,f),b+=2*_),y.push({gid2:w,val1:P,val2:L})}u.pairsets.push(y)}}if(u.fmt==2){var M=l.readUshort(r,o);o+=2;var T=l.readUshort(r,o);o+=2;var E=l.readUshort(r,o);o+=2;var C=l.readUshort(r,o);for(o+=2,u.classDef1=e._lctf.readClassDef(r,c+M),u.classDef2=e._lctf.readClassDef(r,c+T),u.matrix=[],g=0;g<E;g++){var N=[];for(A=0;A<C;A++){var P=null,L=null;d!=0&&(P=e.GPOS.readValueRecord(r,o,d),o+=2*p),f!=0&&(L=e.GPOS.readValueRecord(r,o,f),o+=2*_),N.push({val1:P,val2:L})}u.matrix.push(N)}}}else if(s==4&&u.fmt==1)u.markCoverage=e._lctf.readCoverage(r,l.readUshort(r,o)+c),u.baseCoverage=e._lctf.readCoverage(r,l.readUshort(r,o+2)+c),u.markClassCount=l.readUshort(r,o+4),u.markArray=e.GPOS.readMarkArray(r,l.readUshort(r,o+6)+c),u.baseArray=e.GPOS.readBaseArray(r,l.readUshort(r,o+8)+c,u.markClassCount);else if(s==6&&u.fmt==1)u.mark1Coverage=e._lctf.readCoverage(r,l.readUshort(r,o)+c),u.mark2Coverage=e._lctf.readCoverage(r,l.readUshort(r,o+2)+c),u.markClassCount=l.readUshort(r,o+4),u.mark1Array=e.GPOS.readMarkArray(r,l.readUshort(r,o+6)+c),u.mark2Array=e.GPOS.readBaseArray(r,l.readUshort(r,o+8)+c,u.markClassCount);else{if(s==9&&u.fmt==1){var R=l.readUshort(r,o);o+=2;var F=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=R;else if(a.ltype!=R)throw"invalid extension substitution";return e.GPOS.subt(r,a.ltype,c+F)}console.debug("unsupported GPOS table LookupType",s,"format",u.fmt)}return u},e.GPOS.readValueRecord=function(r,s,o){var a=e._bin,l=[];return l.push(1&o?a.readShort(r,s):0),s+=1&o?2:0,l.push(2&o?a.readShort(r,s):0),s+=2&o?2:0,l.push(4&o?a.readShort(r,s):0),s+=4&o?2:0,l.push(8&o?a.readShort(r,s):0),s+=8&o?2:0,l},e.GPOS.readBaseArray=function(r,s,o){var a=e._bin,l=[],c=s,u=a.readUshort(r,s);s+=2;for(var h=0;h<u;h++){for(var d=[],f=0;f<o;f++)d.push(e.GPOS.readAnchorRecord(r,c+a.readUshort(r,s))),s+=2;l.push(d)}return l},e.GPOS.readMarkArray=function(r,s){var o=e._bin,a=[],l=s,c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=e.GPOS.readAnchorRecord(r,o.readUshort(r,s+2)+l);h.markClass=o.readUshort(r,s),a.push(h),s+=4}return a},e.GPOS.readAnchorRecord=function(r,s){var o=e._bin,a={};return a.fmt=o.readUshort(r,s),a.x=o.readShort(r,s+2),a.y=o.readShort(r,s+4),a},e.GSUB={},e.GSUB.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GSUB.subt)},e.GSUB.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&u.fmt<=2||s==6&&u.fmt<=2){var h=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,c+h)}if(s==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=l.readShort(r,o),o+=2;else if(u.fmt==2){var d=l.readUshort(r,o);o+=2,u.newg=l.readUshorts(r,o,d),o+=2*u.newg.length}}else if(s==2&&u.fmt==1){d=l.readUshort(r,o),o+=2,u.seqs=[];for(var f=0;f<d;f++){var p=l.readUshort(r,o)+c;o+=2;var _=l.readUshort(r,p);u.seqs.push(l.readUshorts(r,p+2,_))}}else if(s==4)for(u.vals=[],d=l.readUshort(r,o),o+=2,f=0;f<d;f++){var v=l.readUshort(r,o);o+=2,u.vals.push(e.GSUB.readLigatureSet(r,c+v))}else if(s==5&&u.fmt==2){if(u.fmt==2){var g=l.readUshort(r,o);o+=2,u.cDef=e._lctf.readClassDef(r,c+g),u.scset=[];var b=l.readUshort(r,o);for(o+=2,f=0;f<b;f++){var m=l.readUshort(r,o);o+=2,u.scset.push(m==0?null:e.GSUB.readSubClassSet(r,c+m))}}}else if(s==6&&u.fmt==3){if(u.fmt==3){for(f=0;f<3;f++){d=l.readUshort(r,o),o+=2;for(var y=[],A=0;A<d;A++)y.push(e._lctf.readCoverage(r,c+l.readUshort(r,o+2*A)));o+=2*d,f==0&&(u.backCvg=y),f==1&&(u.inptCvg=y),f==2&&(u.ahedCvg=y)}d=l.readUshort(r,o),o+=2,u.lookupRec=e.GSUB.readSubstLookupRecords(r,o,d)}}else{if(s==7&&u.fmt==1){var w=l.readUshort(r,o);o+=2;var M=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=w;else if(a.ltype!=w)throw"invalid extension substitution";return e.GSUB.subt(r,a.ltype,c+M)}console.debug("unsupported GSUB table LookupType",s,"format",u.fmt)}return u},e.GSUB.readSubClassSet=function(r,s){var o=e._bin.readUshort,a=s,l=[],c=o(r,s);s+=2;for(var u=0;u<c;u++){var h=o(r,s);s+=2,l.push(e.GSUB.readSubClassRule(r,a+h))}return l},e.GSUB.readSubClassRule=function(r,s){var o=e._bin.readUshort,a={},l=o(r,s),c=o(r,s+=2);s+=2,a.input=[];for(var u=0;u<l-1;u++)a.input.push(o(r,s)),s+=2;return a.substLookupRecords=e.GSUB.readSubstLookupRecords(r,s,c),a},e.GSUB.readSubstLookupRecords=function(r,s,o){for(var a=e._bin.readUshort,l=[],c=0;c<o;c++)l.push(a(r,s),a(r,s+2)),s+=4;return l},e.GSUB.readChainSubClassSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readUshort(r,s);s+=2,l.push(e.GSUB.readChainSubClassRule(r,a+h))}return l},e.GSUB.readChainSubClassRule=function(r,s){for(var o=e._bin,a={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var u=o.readUshort(r,s);s+=2,c==1&&u--,a[l[c]]=o.readUshorts(r,s,u),s+=2*a[l[c]].length}return u=o.readUshort(r,s),s+=2,a.subst=o.readUshorts(r,s,2*u),s+=2*a.subst.length,a},e.GSUB.readLigatureSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readUshort(r,s);s+=2,l.push(e.GSUB.readLigature(r,a+h))}return l},e.GSUB.readLigature=function(r,s){var o=e._bin,a={chain:[]};a.nglyph=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2;for(var c=0;c<l-1;c++)a.chain.push(o.readUshort(r,s)),s+=2;return a},e.head={},e.head.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.fontRevision=a.readFixed(r,s),s+=4,a.readUint(r,s),s+=4,a.readUint(r,s),s+=4,l.flags=a.readUshort(r,s),s+=2,l.unitsPerEm=a.readUshort(r,s),s+=2,l.created=a.readUint64(r,s),s+=8,l.modified=a.readUint64(r,s),s+=8,l.xMin=a.readShort(r,s),s+=2,l.yMin=a.readShort(r,s),s+=2,l.xMax=a.readShort(r,s),s+=2,l.yMax=a.readShort(r,s),s+=2,l.macStyle=a.readUshort(r,s),s+=2,l.lowestRecPPEM=a.readUshort(r,s),s+=2,l.fontDirectionHint=a.readShort(r,s),s+=2,l.indexToLocFormat=a.readShort(r,s),s+=2,l.glyphDataFormat=a.readShort(r,s),s+=2,l},e.hhea={},e.hhea.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.ascender=a.readShort(r,s),s+=2,l.descender=a.readShort(r,s),s+=2,l.lineGap=a.readShort(r,s),s+=2,l.advanceWidthMax=a.readUshort(r,s),s+=2,l.minLeftSideBearing=a.readShort(r,s),s+=2,l.minRightSideBearing=a.readShort(r,s),s+=2,l.xMaxExtent=a.readShort(r,s),s+=2,l.caretSlopeRise=a.readShort(r,s),s+=2,l.caretSlopeRun=a.readShort(r,s),s+=2,l.caretOffset=a.readShort(r,s),s+=2,s+=8,l.metricDataFormat=a.readShort(r,s),s+=2,l.numberOfHMetrics=a.readUshort(r,s),s+=2,l},e.hmtx={},e.hmtx.parse=function(r,s,o,a){for(var l=e._bin,c={aWidth:[],lsBearing:[]},u=0,h=0,d=0;d<a.maxp.numGlyphs;d++)d<a.hhea.numberOfHMetrics&&(u=l.readUshort(r,s),s+=2,h=l.readShort(r,s),s+=2),c.aWidth.push(u),c.lsBearing.push(h);return c},e.kern={},e.kern.parse=function(r,s,o,a){var l=e._bin,c=l.readUshort(r,s);if(s+=2,c==1)return e.kern.parseV1(r,s-2,o,a);var u=l.readUshort(r,s);s+=2;for(var h={glyph1:[],rval:[]},d=0;d<u;d++){s+=2,o=l.readUshort(r,s),s+=2;var f=l.readUshort(r,s);s+=2;var p=f>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;s=e.kern.readFormat0(r,s,h)}return h},e.kern.parseV1=function(r,s,o,a){var l=e._bin;l.readFixed(r,s),s+=4;var c=l.readUint(r,s);s+=4;for(var u={glyph1:[],rval:[]},h=0;h<c;h++){l.readUint(r,s),s+=4;var d=l.readUshort(r,s);s+=2,l.readUshort(r,s),s+=2;var f=d>>>8;if((f&=15)!=0)throw"unknown kern table format: "+f;s=e.kern.readFormat0(r,s,u)}return u},e.kern.readFormat0=function(r,s,o){var a=e._bin,l=-1,c=a.readUshort(r,s);s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2;for(var u=0;u<c;u++){var h=a.readUshort(r,s);s+=2;var d=a.readUshort(r,s);s+=2;var f=a.readShort(r,s);s+=2,h!=l&&(o.glyph1.push(h),o.rval.push({glyph2:[],vals:[]}));var p=o.rval[o.rval.length-1];p.glyph2.push(d),p.vals.push(f),l=h}return s},e.loca={},e.loca.parse=function(r,s,o,a){var l=e._bin,c=[],u=a.head.indexToLocFormat,h=a.maxp.numGlyphs+1;if(u==0)for(var d=0;d<h;d++)c.push(l.readUshort(r,s+(d<<1))<<1);if(u==1)for(d=0;d<h;d++)c.push(l.readUint(r,s+(d<<2)));return c},e.maxp={},e.maxp.parse=function(r,s,o){var a=e._bin,l={},c=a.readUint(r,s);return s+=4,l.numGlyphs=a.readUshort(r,s),s+=2,c==65536&&(l.maxPoints=a.readUshort(r,s),s+=2,l.maxContours=a.readUshort(r,s),s+=2,l.maxCompositePoints=a.readUshort(r,s),s+=2,l.maxCompositeContours=a.readUshort(r,s),s+=2,l.maxZones=a.readUshort(r,s),s+=2,l.maxTwilightPoints=a.readUshort(r,s),s+=2,l.maxStorage=a.readUshort(r,s),s+=2,l.maxFunctionDefs=a.readUshort(r,s),s+=2,l.maxInstructionDefs=a.readUshort(r,s),s+=2,l.maxStackElements=a.readUshort(r,s),s+=2,l.maxSizeOfInstructions=a.readUshort(r,s),s+=2,l.maxComponentElements=a.readUshort(r,s),s+=2,l.maxComponentDepth=a.readUshort(r,s),s+=2),l},e.name={},e.name.parse=function(r,s,o){var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2,a.readUshort(r,s);for(var u,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=s+=2,f=0;f<c;f++){var p=a.readUshort(r,s);s+=2;var _=a.readUshort(r,s);s+=2;var v=a.readUshort(r,s);s+=2;var g=a.readUshort(r,s);s+=2;var b=a.readUshort(r,s);s+=2;var m=a.readUshort(r,s);s+=2;var y,A=h[g],w=d+12*c+m;if(p==0)y=a.readUnicode(r,w,b/2);else if(p==3&&_==0)y=a.readUnicode(r,w,b/2);else if(_==0)y=a.readASCII(r,w,b);else if(_==1)y=a.readUnicode(r,w,b/2);else if(_==3)y=a.readUnicode(r,w,b/2);else{if(p!=1)throw"unknown encoding "+_+", platformID: "+p;y=a.readASCII(r,w,b),console.debug("reading unknown MAC encoding "+_+" as ASCII")}var M="p"+p+","+v.toString(16);l[M]==null&&(l[M]={}),l[M][A!==void 0?A:g]=y,l[M]._lang=v}for(var T in l)if(l[T].postScriptName!=null&&l[T]._lang==1033)return l[T];for(var T in l)if(l[T].postScriptName!=null&&l[T]._lang==0)return l[T];for(var T in l)if(l[T].postScriptName!=null&&l[T]._lang==3084)return l[T];for(var T in l)if(l[T].postScriptName!=null)return l[T];for(var T in l){u=T;break}return console.debug("returning name table with languageID "+l[u]._lang),l[u]},e["OS/2"]={},e["OS/2"].parse=function(r,s,o){var a=e._bin.readUshort(r,s);s+=2;var l={};if(a==0)e["OS/2"].version0(r,s,l);else if(a==1)e["OS/2"].version1(r,s,l);else if(a==2||a==3||a==4)e["OS/2"].version2(r,s,l);else{if(a!=5)throw"unknown OS/2 table version: "+a;e["OS/2"].version5(r,s,l)}return l},e["OS/2"].version0=function(r,s,o){var a=e._bin;return o.xAvgCharWidth=a.readShort(r,s),s+=2,o.usWeightClass=a.readUshort(r,s),s+=2,o.usWidthClass=a.readUshort(r,s),s+=2,o.fsType=a.readUshort(r,s),s+=2,o.ySubscriptXSize=a.readShort(r,s),s+=2,o.ySubscriptYSize=a.readShort(r,s),s+=2,o.ySubscriptXOffset=a.readShort(r,s),s+=2,o.ySubscriptYOffset=a.readShort(r,s),s+=2,o.ySuperscriptXSize=a.readShort(r,s),s+=2,o.ySuperscriptYSize=a.readShort(r,s),s+=2,o.ySuperscriptXOffset=a.readShort(r,s),s+=2,o.ySuperscriptYOffset=a.readShort(r,s),s+=2,o.yStrikeoutSize=a.readShort(r,s),s+=2,o.yStrikeoutPosition=a.readShort(r,s),s+=2,o.sFamilyClass=a.readShort(r,s),s+=2,o.panose=a.readBytes(r,s,10),s+=10,o.ulUnicodeRange1=a.readUint(r,s),s+=4,o.ulUnicodeRange2=a.readUint(r,s),s+=4,o.ulUnicodeRange3=a.readUint(r,s),s+=4,o.ulUnicodeRange4=a.readUint(r,s),s+=4,o.achVendID=[a.readInt8(r,s),a.readInt8(r,s+1),a.readInt8(r,s+2),a.readInt8(r,s+3)],s+=4,o.fsSelection=a.readUshort(r,s),s+=2,o.usFirstCharIndex=a.readUshort(r,s),s+=2,o.usLastCharIndex=a.readUshort(r,s),s+=2,o.sTypoAscender=a.readShort(r,s),s+=2,o.sTypoDescender=a.readShort(r,s),s+=2,o.sTypoLineGap=a.readShort(r,s),s+=2,o.usWinAscent=a.readUshort(r,s),s+=2,o.usWinDescent=a.readUshort(r,s),s+=2},e["OS/2"].version1=function(r,s,o){var a=e._bin;return s=e["OS/2"].version0(r,s,o),o.ulCodePageRange1=a.readUint(r,s),s+=4,o.ulCodePageRange2=a.readUint(r,s),s+=4},e["OS/2"].version2=function(r,s,o){var a=e._bin;return s=e["OS/2"].version1(r,s,o),o.sxHeight=a.readShort(r,s),s+=2,o.sCapHeight=a.readShort(r,s),s+=2,o.usDefault=a.readUshort(r,s),s+=2,o.usBreak=a.readUshort(r,s),s+=2,o.usMaxContext=a.readUshort(r,s),s+=2},e["OS/2"].version5=function(r,s,o){var a=e._bin;return s=e["OS/2"].version2(r,s,o),o.usLowerOpticalPointSize=a.readUshort(r,s),s+=2,o.usUpperOpticalPointSize=a.readUshort(r,s),s+=2},e.post={},e.post.parse=function(r,s,o){var a=e._bin,l={};return l.version=a.readFixed(r,s),s+=4,l.italicAngle=a.readFixed(r,s),s+=4,l.underlinePosition=a.readShort(r,s),s+=2,l.underlineThickness=a.readShort(r,s),s+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(r,s){var o=r.cmap,a=-1;if(o.p0e4!=null?a=o.p0e4:o.p3e1!=null?a=o.p3e1:o.p1e0!=null?a=o.p1e0:o.p0e3!=null&&(a=o.p0e3),a==-1)throw"no familiar platform and encoding!";var l=o.tables[a];if(l.format==0)return s>=l.map.length?0:l.map[s];if(l.format==4){for(var c=-1,u=0;u<l.endCount.length;u++)if(s<=l.endCount[u]){c=u;break}return c==-1||l.startCount[c]>s?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[s-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:s+l.idDelta[c])}if(l.format==12){if(s>l.groups[l.groups.length-1][1])return 0;for(u=0;u<l.groups.length;u++){var h=l.groups[u];if(h[0]<=s&&s<=h[1])return h[2]+(s-h[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(r,s){var o={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[s]){var a=r.SVG.entries[s];return a==null?o:(typeof a=="string"&&(a=e.SVG.toPath(a),r.SVG.entries[s]=a),a)}if(r.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},c=r.CFF,u=r.CFF.Private;if(c.ROS){for(var h=0;c.FDSelect[h+2]<=s;)h+=2;u=c.FDArray[c.FDSelect[h+1]].Private}e.U._drawCFF(r.CFF.CharStrings[s],l,c,u,o)}else r.glyf&&e.U._drawGlyf(s,r,o);return o},e.U._drawGlyf=function(r,s,o){var a=s.glyf[r];a==null&&(a=s.glyf[r]=e.glyf._parseGlyf(s,r)),a!=null&&(a.noc>-1?e.U._simpleGlyph(a,o):e.U._compoGlyph(a,s,o))},e.U._simpleGlyph=function(r,s){for(var o=0;o<r.noc;o++){for(var a=o==0?0:r.endPts[o-1]+1,l=r.endPts[o],c=a;c<=l;c++){var u=c==a?l:c-1,h=c==l?a:c+1,d=1&r.flags[c],f=1&r.flags[u],p=1&r.flags[h],_=r.xs[c],v=r.ys[c];if(c==a)if(d){if(!f){e.U.P.moveTo(s,_,v);continue}e.U.P.moveTo(s,r.xs[u],r.ys[u])}else f?e.U.P.moveTo(s,r.xs[u],r.ys[u]):e.U.P.moveTo(s,(r.xs[u]+_)/2,(r.ys[u]+v)/2);d?f&&e.U.P.lineTo(s,_,v):p?e.U.P.qcurveTo(s,_,v,r.xs[h],r.ys[h]):e.U.P.qcurveTo(s,_,v,(_+r.xs[h])/2,(v+r.ys[h])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(r,s,o){for(var a=0;a<r.parts.length;a++){var l={cmds:[],crds:[]},c=r.parts[a];e.U._drawGlyf(c.glyphIndex,s,l);for(var u=c.m,h=0;h<l.crds.length;h+=2){var d=l.crds[h],f=l.crds[h+1];o.crds.push(d*u.a+f*u.b+u.tx),o.crds.push(d*u.c+f*u.d+u.ty)}for(h=0;h<l.cmds.length;h++)o.cmds.push(l.cmds[h])}},e.U._getGlyphClass=function(r,s){var o=e._lctf.getInterval(s,r);return o==-1?0:s[o+2]},e.U._applySubs=function(r,s,o,a){for(var l=r.length-s-1,c=0;c<o.tabs.length;c++)if(o.tabs[c]!=null){var u,h=o.tabs[c];if(!h.coverage||(u=e._lctf.coverageIndex(h.coverage,r[s]))!=-1){if(o.ltype==1)r[s],h.fmt==1?r[s]=r[s]+h.delta:r[s]=h.newg[u];else if(o.ltype==4)for(var d=h.vals[u],f=0;f<d.length;f++){var p=d[f],_=p.chain.length;if(!(_>l)){for(var v=!0,g=0,b=0;b<_;b++){for(;r[s+g+(1+b)]==-1;)g++;p.chain[b]!=r[s+g+(1+b)]&&(v=!1)}if(v){for(r[s]=p.nglyph,b=0;b<_+g;b++)r[s+b+1]=-1;break}}}else if(o.ltype==5&&h.fmt==2)for(var m=e._lctf.getInterval(h.cDef,r[s]),y=h.cDef[m+2],A=h.scset[y],w=0;w<A.length;w++){var M=A[w],T=M.input;if(!(T.length>l)){for(v=!0,b=0;b<T.length;b++){var E=e._lctf.getInterval(h.cDef,r[s+1+b]);if(m==-1&&h.cDef[E+2]!=T[b]){v=!1;break}}if(v){var C=M.substLookupRecords;for(f=0;f<C.length;f+=2)C[f],C[f+1]}}}else if(o.ltype==6&&h.fmt==3){if(!e.U._glsCovered(r,h.backCvg,s-h.backCvg.length)||!e.U._glsCovered(r,h.inptCvg,s)||!e.U._glsCovered(r,h.ahedCvg,s+h.inptCvg.length))continue;var N=h.lookupRec;for(w=0;w<N.length;w+=2){m=N[w];var P=a[N[w+1]];e.U._applySubs(r,s+m,P,a)}}}}},e.U._glsCovered=function(r,s,o){for(var a=0;a<s.length;a++)if(e._lctf.coverageIndex(s[a],r[o+a])==-1)return!1;return!0},e.U.glyphsToPath=function(r,s,o){for(var a={cmds:[],crds:[]},l=0,c=0;c<s.length;c++){var u=s[c];if(u!=-1){for(var h=c<s.length-1&&s[c+1]!=-1?s[c+1]:0,d=e.U.glyphToPath(r,u),f=0;f<d.crds.length;f+=2)a.crds.push(d.crds[f]+l),a.crds.push(d.crds[f+1]);for(o&&a.cmds.push(o),f=0;f<d.cmds.length;f++)a.cmds.push(d.cmds[f]);o&&a.cmds.push("X"),l+=r.hmtx.aWidth[u],c<s.length-1&&(l+=e.U.getPairAdjustment(r,u,h))}}return a},e.U.P={},e.U.P.moveTo=function(r,s,o){r.cmds.push("M"),r.crds.push(s,o)},e.U.P.lineTo=function(r,s,o){r.cmds.push("L"),r.crds.push(s,o)},e.U.P.curveTo=function(r,s,o,a,l,c,u){r.cmds.push("C"),r.crds.push(s,o,a,l,c,u)},e.U.P.qcurveTo=function(r,s,o,a,l){r.cmds.push("Q"),r.crds.push(s,o,a,l)},e.U.P.closePath=function(r){r.cmds.push("Z")},e.U._drawCFF=function(r,s,o,a,l){for(var c=s.stack,u=s.nStems,h=s.haveWidth,d=s.width,f=s.open,p=0,_=s.x,v=s.y,g=0,b=0,m=0,y=0,A=0,w=0,M=0,T=0,E=0,C=0,N={val:0,size:0};p<r.length;){e.CFF.getCharString(r,p,N);var P=N.val;if(p+=N.size,P=="o1"||P=="o18")c.length%2!=0&&!h&&(d=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(P=="o3"||P=="o23")c.length%2!=0&&!h&&(d=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(P=="o4")c.length>1&&!h&&(d=c.shift()+a.nominalWidthX,h=!0),f&&e.U.P.closePath(l),v+=c.pop(),e.U.P.moveTo(l,_,v),f=!0;else if(P=="o5")for(;c.length>0;)_+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,_,v);else if(P=="o6"||P=="o7")for(var L=c.length,R=P=="o6",F=0;F<L;F++){var V=c.shift();R?_+=V:v+=V,R=!R,e.U.P.lineTo(l,_,v)}else if(P=="o8"||P=="o24"){L=c.length;for(var G=0;G+6<=L;)g=_+c.shift(),b=v+c.shift(),m=g+c.shift(),y=b+c.shift(),_=m+c.shift(),v=y+c.shift(),e.U.P.curveTo(l,g,b,m,y,_,v),G+=6;P=="o24"&&(_+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,_,v))}else{if(P=="o11")break;if(P=="o1234"||P=="o1235"||P=="o1236"||P=="o1237")P=="o1234"&&(b=v,m=(g=_+c.shift())+c.shift(),C=y=b+c.shift(),w=y,T=v,_=(M=(A=(E=m+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,g,b,m,y,E,C),e.U.P.curveTo(l,A,w,M,T,_,v)),P=="o1235"&&(g=_+c.shift(),b=v+c.shift(),m=g+c.shift(),y=b+c.shift(),E=m+c.shift(),C=y+c.shift(),A=E+c.shift(),w=C+c.shift(),M=A+c.shift(),T=w+c.shift(),_=M+c.shift(),v=T+c.shift(),c.shift(),e.U.P.curveTo(l,g,b,m,y,E,C),e.U.P.curveTo(l,A,w,M,T,_,v)),P=="o1236"&&(g=_+c.shift(),b=v+c.shift(),m=g+c.shift(),C=y=b+c.shift(),w=y,M=(A=(E=m+c.shift())+c.shift())+c.shift(),T=w+c.shift(),_=M+c.shift(),e.U.P.curveTo(l,g,b,m,y,E,C),e.U.P.curveTo(l,A,w,M,T,_,v)),P=="o1237"&&(g=_+c.shift(),b=v+c.shift(),m=g+c.shift(),y=b+c.shift(),E=m+c.shift(),C=y+c.shift(),A=E+c.shift(),w=C+c.shift(),M=A+c.shift(),T=w+c.shift(),Math.abs(M-_)>Math.abs(T-v)?_=M+c.shift():v=T+c.shift(),e.U.P.curveTo(l,g,b,m,y,E,C),e.U.P.curveTo(l,A,w,M,T,_,v));else if(P=="o14"){if(c.length>0&&!h&&(d=c.shift()+o.nominalWidthX,h=!0),c.length==4){var U=c.shift(),z=c.shift(),O=c.shift(),D=c.shift(),B=e.CFF.glyphBySE(o,O),W=e.CFF.glyphBySE(o,D);e.U._drawCFF(o.CharStrings[B],s,o,a,l),s.x=U,s.y=z,e.U._drawCFF(o.CharStrings[W],s,o,a,l)}f&&(e.U.P.closePath(l),f=!1)}else if(P=="o19"||P=="o20")c.length%2!=0&&!h&&(d=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0,p+=u+7>>3;else if(P=="o21")c.length>2&&!h&&(d=c.shift()+a.nominalWidthX,h=!0),v+=c.pop(),_+=c.pop(),f&&e.U.P.closePath(l),e.U.P.moveTo(l,_,v),f=!0;else if(P=="o22")c.length>1&&!h&&(d=c.shift()+a.nominalWidthX,h=!0),_+=c.pop(),f&&e.U.P.closePath(l),e.U.P.moveTo(l,_,v),f=!0;else if(P=="o25"){for(;c.length>6;)_+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,_,v);g=_+c.shift(),b=v+c.shift(),m=g+c.shift(),y=b+c.shift(),_=m+c.shift(),v=y+c.shift(),e.U.P.curveTo(l,g,b,m,y,_,v)}else if(P=="o26")for(c.length%2&&(_+=c.shift());c.length>0;)g=_,b=v+c.shift(),_=m=g+c.shift(),v=(y=b+c.shift())+c.shift(),e.U.P.curveTo(l,g,b,m,y,_,v);else if(P=="o27")for(c.length%2&&(v+=c.shift());c.length>0;)b=v,m=(g=_+c.shift())+c.shift(),y=b+c.shift(),_=m+c.shift(),v=y,e.U.P.curveTo(l,g,b,m,y,_,v);else if(P=="o10"||P=="o29"){var q=P=="o10"?a:o;if(c.length==0)console.debug("error: empty stack");else{var j=c.pop(),te=q.Subrs[j+q.Bias];s.x=_,s.y=v,s.nStems=u,s.haveWidth=h,s.width=d,s.open=f,e.U._drawCFF(te,s,o,a,l),_=s.x,v=s.y,u=s.nStems,h=s.haveWidth,d=s.width,f=s.open}}else if(P=="o30"||P=="o31"){var ne=c.length,Z=(G=0,P=="o31");for(G+=ne-(L=-3&ne);G<L;)Z?(b=v,m=(g=_+c.shift())+c.shift(),v=(y=b+c.shift())+c.shift(),L-G==5?(_=m+c.shift(),G++):_=m,Z=!1):(g=_,b=v+c.shift(),m=g+c.shift(),y=b+c.shift(),_=m+c.shift(),L-G==5?(v=y+c.shift(),G++):v=y,Z=!0),e.U.P.curveTo(l,g,b,m,y,_,v),G+=4}else{if((P+"").charAt(0)=="o")throw console.debug("Unknown operation: "+P,r),P;c.push(P)}}}s.x=_,s.y=v,s.nStems=u,s.haveWidth=h,s.width=d,s.open=f};var t=e,n={Typr:t};return i.Typr=t,i.default=n,Object.defineProperty(i,"__esModule",{value:!0}),i}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Pte(){return function(i){var e=Uint8Array,t=Uint16Array,n=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(P,L){for(var R=new t(31),F=0;F<31;++F)R[F]=L+=1<<P[F-1];var V=new n(R[30]);for(F=1;F<30;++F)for(var G=R[F];G<R[F+1];++G)V[G]=G-R[F]<<5|F;return[R,V]},l=a(r,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=a(s,0)[0],d=new t(32768),f=0;f<32768;++f){var p=(43690&f)>>>1|(21845&f)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,d[f]=((65280&p)>>>8|(255&p)<<8)>>>1}var _=function(P,L,R){for(var F=P.length,V=0,G=new t(L);V<F;++V)++G[P[V]-1];var U,z=new t(L);for(V=0;V<L;++V)z[V]=z[V-1]+G[V-1]<<1;{U=new t(1<<L);var O=15-L;for(V=0;V<F;++V)if(P[V])for(var D=V<<4|P[V],B=L-P[V],W=z[P[V]-1]++<<B,q=W|(1<<B)-1;W<=q;++W)U[d[W]>>>O]=D}return U},v=new e(288);for(f=0;f<144;++f)v[f]=8;for(f=144;f<256;++f)v[f]=9;for(f=256;f<280;++f)v[f]=7;for(f=280;f<288;++f)v[f]=8;var g=new e(32);for(f=0;f<32;++f)g[f]=5;var b=_(v,9),m=_(g,5),y=function(P){for(var L=P[0],R=1;R<P.length;++R)P[R]>L&&(L=P[R]);return L},A=function(P,L,R){var F=L/8|0;return(P[F]|P[F+1]<<8)>>(7&L)&R},w=function(P,L){var R=L/8|0;return(P[R]|P[R+1]<<8|P[R+2]<<16)>>(7&L)},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(P,L,R){var F=new Error(L||M[P]);if(F.code=P,Error.captureStackTrace&&Error.captureStackTrace(F,T),!R)throw F;return F},E=function(P,L,R){var F=P.length;if(!F||R&&!R.l&&F<5)return L||new e(0);var V=!L||R,G=!R||R.i;R||(R={}),L||(L=new e(3*F));var U,z=function(qe){var it=L.length;if(qe>it){var at=new e(Math.max(2*it,qe));at.set(L),L=at}},O=R.f||0,D=R.p||0,B=R.b||0,W=R.l,q=R.d,j=R.m,te=R.n,ne=8*F;do{if(!W){R.f=O=A(P,D,1);var Z=A(P,D+1,3);if(D+=3,!Z){var le=P[(Q=((U=D)/8|0)+(7&U&&1)+4)-4]|P[Q-3]<<8,re=Q+le;if(re>F){G&&T(0);break}V&&z(B+le),L.set(P.subarray(Q,re),B),R.b=B+=le,R.p=D=8*re;continue}if(Z==1)W=b,q=m,j=9,te=5;else if(Z==2){var se=A(P,D,31)+257,$=A(P,D+10,15)+4,fe=se+A(P,D+5,31)+1;D+=14;for(var xe=new e(fe),Ie=new e(19),ge=0;ge<$;++ge)Ie[o[ge]]=A(P,D+3*ge,7);D+=3*$;var Oe=y(Ie),Me=(1<<Oe)-1,Y=_(Ie,Oe);for(ge=0;ge<fe;){var Q,de=Y[A(P,D,Me)];if(D+=15&de,(Q=de>>>4)<16)xe[ge++]=Q;else{var Le=0,ie=0;for(Q==16?(ie=3+A(P,D,3),D+=2,Le=xe[ge-1]):Q==17?(ie=3+A(P,D,7),D+=3):Q==18&&(ie=11+A(P,D,127),D+=7);ie--;)xe[ge++]=Le}}var K=xe.subarray(0,se),be=xe.subarray(se);j=y(K),te=y(be),W=_(K,j),q=_(be,te)}else T(1);if(D>ne){G&&T(0);break}}V&&z(B+131072);for(var Ue=(1<<j)-1,ve=(1<<te)-1,Ne=D;;Ne=D){var $e=(Le=W[w(P,D)&Ue])>>>4;if((D+=15&Le)>ne){G&&T(0);break}if(Le||T(2),$e<256)L[B++]=$e;else{if($e==256){Ne=D,W=null;break}var Ee=$e-254;if($e>264){var Ze=r[ge=$e-257];Ee=A(P,D,(1<<Ze)-1)+c[ge],D+=Ze}var nt=q[w(P,D)&ve],rt=nt>>>4;if(nt||T(3),D+=15&nt,be=h[rt],rt>3&&(Ze=s[rt],be+=w(P,D)&(1<<Ze)-1,D+=Ze),D>ne){G&&T(0);break}V&&z(B+131072);for(var Be=B+Ee;B<Be;B+=4)L[B]=L[B-be],L[B+1]=L[B+1-be],L[B+2]=L[B+2-be],L[B+3]=L[B+3-be];B=Be}}R.l=W,R.p=Ne,R.b=B,W&&(O=1,R.m=j,R.d=q,R.n=te)}while(!O);return B==L.length?L:function(qe,it,at){(at==null||at>qe.length)&&(at=qe.length);var ht=new(qe instanceof t?t:qe instanceof n?n:e)(at-it);return ht.set(qe.subarray(it,at)),ht}(L,0,B)},C=new e(0),N=typeof TextDecoder<"u"&&new TextDecoder;try{N.decode(C,{stream:!0})}catch{}return i.convert_streams=function(P){var L=new DataView(P),R=0;function F(){var se=L.getUint16(R);return R+=2,se}function V(){var se=L.getUint32(R);return R+=4,se}function G(se){le.setUint16(re,se),re+=2}function U(se){le.setUint32(re,se),re+=4}for(var z={signature:V(),flavor:V(),length:V(),numTables:F(),reserved:F(),totalSfntSize:V(),majorVersion:F(),minorVersion:F(),metaOffset:V(),metaLength:V(),metaOrigLength:V(),privOffset:V(),privLength:V()},O=0;Math.pow(2,O)<=z.numTables;)O++;O--;for(var D=16*Math.pow(2,O),B=16*z.numTables-D,W=12,q=[],j=0;j<z.numTables;j++)q.push({tag:V(),offset:V(),compLength:V(),origLength:V(),origChecksum:V()}),W+=16;var te,ne=new Uint8Array(12+16*q.length+q.reduce(function(se,$){return se+$.origLength+4},0)),Z=ne.buffer,le=new DataView(Z),re=0;return U(z.flavor),G(z.numTables),G(D),G(O),G(B),q.forEach(function(se){U(se.tag),U(se.origChecksum),U(W),U(se.origLength),se.outOffset=W,(W+=se.origLength)%4!=0&&(W+=4-W%4)}),q.forEach(function(se){var $,fe=P.slice(se.offset,se.offset+se.compLength);if(se.compLength!=se.origLength){var xe=new Uint8Array(se.origLength);$=new Uint8Array(fe,2),E($,xe)}else xe=new Uint8Array(fe);ne.set(xe,se.outOffset);var Ie=0;(W=se.outOffset+se.origLength)%4!=0&&(Ie=4-W%4),ne.set(new Uint8Array(Ie).buffer,se.outOffset+se.origLength),te=W+Ie}),Z.slice(0,te)},Object.defineProperty(i,"__esModule",{value:!0}),i}({}).convert_streams}function Rte(i,e){const t={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,s=2,o=4,a=8,l=16,c=32;let u;function h(M){if(!u){const T={R:s,L:r,D:o,C:l,U:c,T:a};u=new Map;for(let E in n){let C=0;n[E].split(",").forEach(N=>{let[P,L]=N.split("+");P=parseInt(P,36),L=L?parseInt(L,36):0,u.set(C+=P,T[E]);for(let R=L;R--;)u.set(++C,T[E])})}}return u.get(M)||c}const d=1,f=2,p=3,_=4,v=[null,"isol","init","fina","medi"];function g(M){const T=new Uint8Array(M.length);let E=c,C=d,N=-1;for(let P=0;P<M.length;P++){const L=M.codePointAt(P);let R=h(L)|0,F=d;R&a||(E&(r|o|l)?R&(s|o|l)?(F=p,(C===d||C===p)&&T[N]++):R&(r|c)&&(C===f||C===_)&&T[N]--:E&(s|c)&&(C===f||C===_)&&T[N]--,C=T[P]=F,E=R,N=P,L>65535&&P++)}return T}function b(M,T){const E=[];for(let N=0;N<T.length;N++){const P=T.codePointAt(N);P>65535&&N++,E.push(i.U.codeToGlyph(M,P))}const C=M.GSUB;if(C){const{lookupList:N,featureList:P}=C;let L;const R=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,F=[];P.forEach(V=>{if(R.test(V.tag))for(let G=0;G<V.tab.length;G++){if(F[V.tab[G]])continue;F[V.tab[G]]=!0;const U=N[V.tab[G]],z=/^(isol|init|fina|medi)$/.test(V.tag);z&&!L&&(L=g(T));for(let O=0;O<E.length;O++)(!L||!z||v[L[O]]===V.tag)&&i.U._applySubs(E,O,U,N)}})}return E}function m(M,T){const E=new Int16Array(T.length*3);let C=0;for(;C<T.length;C++){const R=T[C];if(R===-1)continue;E[C*3+2]=M.hmtx.aWidth[R];const F=M.GPOS;if(F){const V=F.lookupList;for(let G=0;G<V.length;G++){const U=V[G];for(let z=0;z<U.tabs.length;z++){const O=U.tabs[z];if(U.ltype===1){if(i._lctf.coverageIndex(O.coverage,R)!==-1&&O.pos){L(O.pos,C);break}}else if(U.ltype===2){let D=null,B=N();if(B!==-1){const W=i._lctf.coverageIndex(O.coverage,T[B]);if(W!==-1){if(O.fmt===1){const q=O.pairsets[W];for(let j=0;j<q.length;j++)q[j].gid2===R&&(D=q[j])}else if(O.fmt===2){const q=i.U._getGlyphClass(T[B],O.classDef1),j=i.U._getGlyphClass(R,O.classDef2);D=O.matrix[q][j]}if(D){D.val1&&L(D.val1,B),D.val2&&L(D.val2,C);break}}}}else if(U.ltype===4){const D=i._lctf.coverageIndex(O.markCoverage,R);if(D!==-1){const B=N(P),W=B===-1?-1:i._lctf.coverageIndex(O.baseCoverage,T[B]);if(W!==-1){const q=O.markArray[D],j=O.baseArray[W][q.markClass];E[C*3]=j.x-q.x+E[B*3]-E[B*3+2],E[C*3+1]=j.y-q.y+E[B*3+1];break}}}else if(U.ltype===6){const D=i._lctf.coverageIndex(O.mark1Coverage,R);if(D!==-1){const B=N();if(B!==-1){const W=T[B];if(y(M,W)===3){const q=i._lctf.coverageIndex(O.mark2Coverage,W);if(q!==-1){const j=O.mark1Array[D],te=O.mark2Array[q][j.markClass];E[C*3]=te.x-j.x+E[B*3]-E[B*3+2],E[C*3+1]=te.y-j.y+E[B*3+1];break}}}}}}}}else if(M.kern&&!M.cff){const V=N();if(V!==-1){const G=M.kern.glyph1.indexOf(T[V]);if(G!==-1){const U=M.kern.rval[G].glyph2.indexOf(R);U!==-1&&(E[V*3+2]+=M.kern.rval[G].vals[U])}}}}return E;function N(R){for(let F=C-1;F>=0;F--)if(T[F]!==-1&&(!R||R(T[F])))return F;return-1}function P(R){return y(M,R)===1}function L(R,F){for(let V=0;V<3;V++)E[F*3+V]+=R[V]||0}}function y(M,T){const E=M.GDEF&&M.GDEF.glyphClassDef;return E?i.U._getGlyphClass(T,E):0}function A(...M){for(let T=0;T<M.length;T++)if(typeof M[T]=="number")return M[T]}function w(M){const T=Object.create(null),E=M["OS/2"],C=M.hhea,N=M.head.unitsPerEm,P=A(E&&E.sTypoAscender,C&&C.ascender,N),L={unitsPerEm:N,ascender:P,descender:A(E&&E.sTypoDescender,C&&C.descender,0),capHeight:A(E&&E.sCapHeight,P),xHeight:A(E&&E.sxHeight,P),lineGap:A(E&&E.sTypoLineGap,C&&C.lineGap),supportsCodePoint(R){return i.U.codeToGlyph(M,R)>0},forEachGlyph(R,F,V,G){let U=0;const z=1/L.unitsPerEm*F,O=b(M,R);let D=0;const B=m(M,O);return O.forEach((W,q)=>{if(W!==-1){let j=T[W];if(!j){const{cmds:te,crds:ne}=i.U.glyphToPath(M,W);let Z="",le=0;for(let xe=0,Ie=te.length;xe<Ie;xe++){const ge=t[te[xe]];Z+=te[xe];for(let Oe=1;Oe<=ge;Oe++)Z+=(Oe>1?",":"")+ne[le++]}let re,se,$,fe;if(ne.length){re=se=1/0,$=fe=-1/0;for(let xe=0,Ie=ne.length;xe<Ie;xe+=2){let ge=ne[xe],Oe=ne[xe+1];ge<re&&(re=ge),Oe<se&&(se=Oe),ge>$&&($=ge),Oe>fe&&(fe=Oe)}}else re=$=se=fe=0;j=T[W]={index:W,advanceWidth:M.hmtx.aWidth[W],xMin:re,yMin:se,xMax:$,yMax:fe,path:Z}}G.call(null,j,U+B[q*3]*z,B[q*3+1]*z,D),U+=B[q*3+2]*z,V&&(U+=V*F)}D+=R.codePointAt(D)>65535?2:1}),U}};return L}return function(T){const E=new Uint8Array(T,0,4),C=i._bin.readASCII(E,0,4);if(C==="wOFF")T=e(T);else if(C==="wOF2")throw new Error("woff2 fonts not supported");return w(i.parse(T)[0])}}const Ite=Rm({name:"Typr Font Parser",dependencies:[Cte,Pte,Rte],init(i,e,t){const n=i(),r=e();return t(n,r)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function Lte(){return function(i){var e=function(){this.buckets=new Map};e.prototype.add=function(m){var y=m>>5;this.buckets.set(y,(this.buckets.get(y)||0)|1<<(31&m))},e.prototype.has=function(m){var y=this.buckets.get(m>>5);return y!==void 0&&(y&1<<(31&m))!=0},e.prototype.serialize=function(){var m=[];return this.buckets.forEach(function(y,A){m.push((+A).toString(36)+":"+y.toString(36))}),m.join(",")},e.prototype.deserialize=function(m){var y=this;this.buckets.clear(),m.split(",").forEach(function(A){var w=A.split(":");y.buckets.set(parseInt(w[0],36),parseInt(w[1],36))})};var t=Math.pow(2,8),n=t-1,r=~n;function s(m){var y=function(w){return w&r}(m).toString(16),A=function(w){return(w&r)+t-1}(m).toString(16);return"codepoint-index/plane"+(m>>16)+"/"+y+"-"+A+".json"}function o(m,y){var A=m&n,w=y.codePointAt(A/6|0);return((w=(w||48)-48)&1<<A%6)!=0}function a(m,y){var A;(A=m,A.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(w){return w.split("-").map(function(M){return parseInt(M.trim(),16)})})).forEach(function(w){var M=w[0],T=w[1];T===void 0&&(T=M),y(M,T)})}function l(m,y){a(m,function(A,w){for(var M=A;M<=w;M++)y(M)})}var c={},u={},h=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function f(m){var y=h.get(m);return y||(y=new e,l(m.ranges,function(A){return y.add(A)}),h.set(m,y)),y}var p,_=new Map;function v(m,y,A){return m[y]?y:m[A]?A:function(w){for(var M in w)return M}(m)}function g(m,y){var A=y;if(!m.includes(A)){A=1/0;for(var w=0;w<m.length;w++)Math.abs(m[w]-y)<Math.abs(A-y)&&(A=m[w])}return A}function b(m){return p||(p=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(y){p.add(y)})),p.has(m)}return i.CodePointSet=e,i.clearCache=function(){c={},u={}},i.getFontsForString=function(m,y){y===void 0&&(y={});var A,w=y.lang;w===void 0&&(w=new RegExp("\\p{Script=Hangul}","u").test(A=m)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(A)?"ja":"en");var M=y.category;M===void 0&&(M="sans-serif");var T=y.style;T===void 0&&(T="normal");var E=y.weight;E===void 0&&(E=400);var C=(y.dataUrl||d).replace(/\/$/g,""),N=new Map,P=new Uint8Array(m.length),L={},R={},F=new Array(m.length),V=new Map,G=!1;function U(D){var B=_.get(D);return B||(B=fetch(C+"/"+D).then(function(W){if(!W.ok)throw new Error(W.statusText);return W.json().then(function(q){if(!Array.isArray(q)||q[0]!==1)throw new Error("Incorrect schema version; need 1, got "+q[0]);return q[1]})}).catch(function(W){if(C!==d)return G||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+C+'", trying default CDN. '+W.message),G=!0),C=d,_.delete(D),U(D);throw W}),_.set(D,B)),B}for(var z=function(D){var B=m.codePointAt(D),W=s(B);F[D]=W,c[W]||V.has(W)||V.set(W,U(W).then(function(q){c[W]=q})),B>65535&&(D++,O=D)},O=0;O<m.length;O++)z(O);return Promise.all(V.values()).then(function(){V.clear();for(var D=function(W){var q=m.codePointAt(W),j=null,te=c[F[W]],ne=void 0;for(var Z in te){var le=R[Z];if(le===void 0&&(le=R[Z]=new RegExp(Z).test(w||"en")),le){for(var re in ne=Z,te[Z])if(o(q,te[Z][re])){j=re;break}break}}if(!j){e:for(var se in te)if(se!==ne){for(var $ in te[se])if(o(q,te[se][$])){j=$;break e}}}j||(console.debug("No font coverage for U+"+q.toString(16)),j="latin"),F[W]=j,u[j]||V.has(j)||V.set(j,U("font-meta/"+j+".json").then(function(fe){u[j]=fe})),q>65535&&(W++,B=W)},B=0;B<m.length;B++)D(B);return Promise.all(V.values())}).then(function(){for(var D,B=null,W=0;W<m.length;W++){var q=m.codePointAt(W);if(B&&(b(q)||f(B).has(q)))P[W]=P[W-1];else{B=u[F[W]];var j=L[B.id];if(!j){var te=B.typeforms,ne=v(te,M,"sans-serif"),Z=v(te[ne],T,"normal"),le=g((D=te[ne])===null||D===void 0?void 0:D[Z],E);j=L[B.id]=C+"/font-files/"+B.id+"/"+ne+"."+Z+"."+le+".woff"}var re=N.get(j);re==null&&(re=N.size,N.set(j,re)),P[W]=re}q>65535&&(W++,P[W]=P[W-1])}return{fontUrls:Array.from(N.keys()),chars:P}})},Object.defineProperty(i,"__esModule",{value:!0}),i}({})}function Dte(i,e){const t=Object.create(null),n=Object.create(null);function r(o,a){const l=c=>{console.error(`Failure loading font ${o}`,c)};try{const c=new XMLHttpRequest;c.open("get",o,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)l(new Error(c.statusText));else if(c.status>0)try{const u=i(c.response);u.src=o,a(u)}catch(u){l(u)}},c.onerror=l,c.send()}catch(c){l(c)}}function s(o,a){let l=t[o];l?a(l):n[o]?n[o].push(a):(n[o]=[a],r(o,c=>{c.src=o,t[o]=c,n[o].forEach(u=>u(c)),delete n[o]}))}return function(o,a,{lang:l,fonts:c=[],style:u="normal",weight:h="normal",unicodeFontsURL:d}={}){const f=new Uint8Array(o.length),p=[];o.length||b();const _=new Map,v=[];if(u!=="italic"&&(u="normal"),typeof h!="number"&&(h=h==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(y=>!y.lang||y.lang.test(l)).reverse(),c.length){let M=0;(function T(E=0){for(let C=E,N=o.length;C<N;C++){const P=o.codePointAt(C);if(M===1&&p[f[C-1]].supportsCodePoint(P)||C>0&&/\s/.test(o[C]))f[C]=f[C-1],M===2&&(v[v.length-1][1]=C);else for(let L=f[C],R=c.length;L<=R;L++)if(L===R){const F=M===2?v[v.length-1]:v[v.length]=[C,C];F[1]=C,M=2}else{f[C]=L;const{src:F,unicodeRange:V}=c[L];if(!V||m(P,V)){const G=t[F];if(!G){s(F,()=>{T(C)});return}if(G.supportsCodePoint(P)){let U=_.get(G);typeof U!="number"&&(U=p.length,p.push(G),_.set(G,U)),f[C]=U,M=1;break}}}P>65535&&C+1<N&&(f[C+1]=f[C],C++,M===2&&(v[v.length-1][1]=C))}g()})()}else v.push([0,o.length-1]),g();function g(){if(v.length){const y=v.map(A=>o.substring(A[0],A[1]+1)).join(`
`);e.getFontsForString(y,{lang:l||void 0,style:u,weight:h,dataUrl:d}).then(({fontUrls:A,chars:w})=>{const M=p.length;let T=0;v.forEach(C=>{for(let N=0,P=C[1]-C[0];N<=P;N++)f[C[0]+N]=w[T++]+M;T++});let E=0;A.forEach((C,N)=>{s(C,P=>{p[N+M]=P,++E===A.length&&b()})})})}else b()}function b(){a({chars:f,fonts:p})}function m(y,A){for(let w=0;w<A.length;w++){const[M,T=M]=A[w];if(M<=y&&y<=T)return!0}return!1}}}const Nte=Rm({name:"FontResolver",dependencies:[Dte,Ite,Lte],init(i,e,t){return i(e,t())}});function Fte(i,e){const n=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",s=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:p,lang:_,fonts:v,style:g,weight:b,preResolvedFonts:m,unicodeFontsURL:y},A){const w=({chars:M,fonts:T})=>{let E,C;const N=[];for(let P=0;P<M.length;P++)M[P]!==C?(C=M[P],N.push(E={start:P,end:P,fontObj:T[M[P]]})):E.end=P;A(N)};m?w(m):i(p,w,{lang:_,fonts:v,style:g,weight:b,unicodeFontsURL:y})}function a({text:p="",font:_,lang:v,sdfGlyphSize:g=64,fontSize:b=400,fontWeight:m=1,fontStyle:y="normal",letterSpacing:A=0,lineHeight:w="normal",maxWidth:M=1/0,direction:T,textAlign:E="left",textIndent:C=0,whiteSpace:N="normal",overflowWrap:P="normal",anchorX:L=0,anchorY:R=0,metricsOnly:F=!1,unicodeFontsURL:V,preResolvedFonts:G=null,includeCaretPositions:U=!1,chunkedBoundsSize:z=8192,colorRanges:O=null},D){const B=h(),W={fontLoad:0,typesetting:0};p.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),p=p.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),b=+b,A=+A,M=+M,w=w||"normal",C=+C,o({text:p,lang:v,style:y,weight:m,fonts:typeof _=="string"?[{src:_}]:_,unicodeFontsURL:V,preResolvedFonts:G},q=>{W.fontLoad=h()-B;const j=isFinite(M);let te=null,ne=null,Z=null,le=null,re=null,se=null,$=null,fe=null,xe=0,Ie=0,ge=N!=="nowrap";const Oe=new Map,Me=h();let Y=C,Q=0,de=new d;const Le=[de];q.forEach(ve=>{const{fontObj:Ne}=ve,{ascender:$e,descender:Ee,unitsPerEm:Ze,lineGap:nt,capHeight:rt,xHeight:Be}=Ne;let qe=Oe.get(Ne);if(!qe){const je=b/Ze,ee=w==="normal"?($e-Ee+nt)*je:w*b,Ge=(ee-($e-Ee)*je)/2,Ce=Math.min(ee,($e-Ee)*je),De=($e+Ee)/2*je+Ce/2;qe={index:Oe.size,src:Ne.src,fontObj:Ne,fontSizeMult:je,unitsPerEm:Ze,ascender:$e*je,descender:Ee*je,capHeight:rt*je,xHeight:Be*je,lineHeight:ee,baseline:-Ge-$e*je,caretTop:De,caretBottom:De-Ce},Oe.set(Ne,qe)}const{fontSizeMult:it}=qe,at=p.slice(ve.start,ve.end+1);let ht,Qe;Ne.forEachGlyph(at,b,A,(je,ee,Ge,Ce)=>{ee+=Q,Ce+=ve.start,ht=ee,Qe=je;const De=p.charAt(Ce),Xe=je.advanceWidth*it,gt=de.count;let _t;if("isEmpty"in je||(je.isWhitespace=!!De&&new RegExp(r).test(De),je.canBreakAfter=!!De&&s.test(De),je.isEmpty=je.xMin===je.xMax||je.yMin===je.yMax||n.test(De)),!je.isWhitespace&&!je.isEmpty&&Ie++,ge&&j&&!je.isWhitespace&&ee+Xe+Y>M&&gt){if(de.glyphAt(gt-1).glyphObj.canBreakAfter)_t=new d,Y=-ee;else for(let J=gt;J--;)if(J===0&&P==="break-word"){_t=new d,Y=-ee;break}else if(de.glyphAt(J).glyphObj.canBreakAfter){_t=de.splitAt(J+1);const ae=_t.glyphAt(0).x;Y-=ae;for(let ue=_t.count;ue--;)_t.glyphAt(ue).x-=ae;break}_t&&(de.isSoftWrapped=!0,de=_t,Le.push(de),xe=M)}let Mt=de.glyphAt(de.count);Mt.glyphObj=je,Mt.x=ee+Y,Mt.y=Ge,Mt.width=Xe,Mt.charIndex=Ce,Mt.fontData=qe,De===`
`&&(de=new d,Le.push(de),Y=-(ee+Xe+A*b)+C)}),Q=ht+Qe.advanceWidth*it+A*b});let ie=0;Le.forEach(ve=>{let Ne=!0;for(let $e=ve.count;$e--;){const Ee=ve.glyphAt($e);Ne&&!Ee.glyphObj.isWhitespace&&(ve.width=Ee.x+Ee.width,ve.width>xe&&(xe=ve.width),Ne=!1);let{lineHeight:Ze,capHeight:nt,xHeight:rt,baseline:Be}=Ee.fontData;Ze>ve.lineHeight&&(ve.lineHeight=Ze);const qe=Be-ve.baseline;qe<0&&(ve.baseline+=qe,ve.cap+=qe,ve.ex+=qe),ve.cap=Math.max(ve.cap,ve.baseline+nt),ve.ex=Math.max(ve.ex,ve.baseline+rt)}ve.baseline-=ie,ve.cap-=ie,ve.ex-=ie,ie+=ve.lineHeight});let K=0,be=0;if(L&&(typeof L=="number"?K=-L:typeof L=="string"&&(K=-xe*(L==="left"?0:L==="center"?.5:L==="right"?1:c(L)))),R&&(typeof R=="number"?be=-R:typeof R=="string"&&(be=R==="top"?0:R==="top-baseline"?-Le[0].baseline:R==="top-cap"?-Le[0].cap:R==="top-ex"?-Le[0].ex:R==="middle"?ie/2:R==="bottom"?ie:R==="bottom-baseline"?-Le[Le.length-1].baseline:c(R)*ie)),!F){const ve=e.getEmbeddingLevels(p,T);te=new Uint16Array(Ie),ne=new Uint8Array(Ie),Z=new Float32Array(Ie*2),le={},$=[1/0,1/0,-1/0,-1/0],fe=[],U&&(se=new Float32Array(p.length*4)),O&&(re=new Uint8Array(Ie*3));let Ne=0,$e=-1,Ee=-1,Ze,nt;if(Le.forEach((rt,Be)=>{let{count:qe,width:it}=rt;if(qe>0){let at=0;for(let Ce=qe;Ce--&&rt.glyphAt(Ce).glyphObj.isWhitespace;)at++;let ht=0,Qe=0;if(E==="center")ht=(xe-it)/2;else if(E==="right")ht=xe-it;else if(E==="justify"&&rt.isSoftWrapped){let Ce=0;for(let De=qe-at;De--;)rt.glyphAt(De).glyphObj.isWhitespace&&Ce++;Qe=(xe-it)/Ce}if(Qe||ht){let Ce=0;for(let De=0;De<qe;De++){let Xe=rt.glyphAt(De);const gt=Xe.glyphObj;Xe.x+=ht+Ce,Qe!==0&&gt.isWhitespace&&De<qe-at&&(Ce+=Qe,Xe.width+=Qe)}}const je=e.getReorderSegments(p,ve,rt.glyphAt(0).charIndex,rt.glyphAt(rt.count-1).charIndex);for(let Ce=0;Ce<je.length;Ce++){const[De,Xe]=je[Ce];let gt=1/0,_t=-1/0;for(let Mt=0;Mt<qe;Mt++)if(rt.glyphAt(Mt).charIndex>=De){let J=Mt,ae=Mt;for(;ae<qe;ae++){let ue=rt.glyphAt(ae);if(ue.charIndex>Xe)break;ae<qe-at&&(gt=Math.min(gt,ue.x),_t=Math.max(_t,ue.x+ue.width))}for(let ue=J;ue<ae;ue++){const ye=rt.glyphAt(ue);ye.x=_t-(ye.x+ye.width-gt)}break}}let ee;const Ge=Ce=>ee=Ce;for(let Ce=0;Ce<qe;Ce++){const De=rt.glyphAt(Ce);ee=De.glyphObj;const Xe=ee.index,gt=ve.levels[De.charIndex]&1;if(gt){const _t=e.getMirroredCharacter(p[De.charIndex]);_t&&De.fontData.fontObj.forEachGlyph(_t,0,0,Ge)}if(U){const{charIndex:_t,fontData:Mt}=De,J=De.x+K,ae=De.x+De.width+K;se[_t*4]=gt?ae:J,se[_t*4+1]=gt?J:ae,se[_t*4+2]=rt.baseline+Mt.caretBottom+be,se[_t*4+3]=rt.baseline+Mt.caretTop+be;const ue=_t-$e;ue>1&&u(se,$e,ue),$e=_t}if(O){const{charIndex:_t}=De;for(;_t>Ee;)Ee++,O.hasOwnProperty(Ee)&&(nt=O[Ee])}if(!ee.isWhitespace&&!ee.isEmpty){const _t=Ne++,{fontSizeMult:Mt,src:J,index:ae}=De.fontData,ue=le[J]||(le[J]={});ue[Xe]||(ue[Xe]={path:ee.path,pathBounds:[ee.xMin,ee.yMin,ee.xMax,ee.yMax]});const ye=De.x+K,Se=De.y+rt.baseline+be;Z[_t*2]=ye,Z[_t*2+1]=Se;const Fe=ye+ee.xMin*Mt,ze=Se+ee.yMin*Mt,He=ye+ee.xMax*Mt,lt=Se+ee.yMax*Mt;Fe<$[0]&&($[0]=Fe),ze<$[1]&&($[1]=ze),He>$[2]&&($[2]=He),lt>$[3]&&($[3]=lt),_t%z===0&&(Ze={start:_t,end:_t,rect:[1/0,1/0,-1/0,-1/0]},fe.push(Ze)),Ze.end++;const mt=Ze.rect;if(Fe<mt[0]&&(mt[0]=Fe),ze<mt[1]&&(mt[1]=ze),He>mt[2]&&(mt[2]=He),lt>mt[3]&&(mt[3]=lt),te[_t]=Xe,ne[_t]=ae,O){const wt=_t*3;re[wt]=nt>>16&255,re[wt+1]=nt>>8&255,re[wt+2]=nt&255}}}}}),se){const rt=p.length-$e;rt>1&&u(se,$e,rt)}}const Ue=[];Oe.forEach(({index:ve,src:Ne,unitsPerEm:$e,ascender:Ee,descender:Ze,lineHeight:nt,capHeight:rt,xHeight:Be})=>{Ue[ve]={src:Ne,unitsPerEm:$e,ascender:Ee,descender:Ze,lineHeight:nt,capHeight:rt,xHeight:Be}}),W.typesetting=h()-Me,D({glyphIds:te,glyphFontIndices:ne,glyphPositions:Z,glyphData:le,fontData:Ue,caretPositions:se,glyphColors:re,chunkedBounds:fe,fontSize:b,topBaseline:be+Le[0].baseline,blockBounds:[K,be-ie,K+xe,be],visibleBounds:$,timings:W})})}function l(p,_){a({...p,metricsOnly:!0},v=>{const[g,b,m,y]=v.blockBounds;_({width:m-g,height:y-b})})}function c(p){let _=p.match(/^([\d.]+)%$/),v=_?parseFloat(_[1]):NaN;return isNaN(v)?0:v/100}function u(p,_,v){const g=p[_*4],b=p[_*4+1],m=p[_*4+2],y=p[_*4+3],A=(b-g)/v;for(let w=0;w<v;w++){const M=(_+w)*4;p[M]=g+A*w,p[M+1]=g+A*(w+1),p[M+2]=m,p[M+3]=y}}function h(){return(self.performance||Date).now()}function d(){this.data=[]}const f=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/f.length)},glyphAt(p){let _=d.flyweight;return _.data=this.data,_.index=p,_},splitAt(p){let _=new d;return _.data=this.data.splice(p*f.length),_}},d.flyweight=f.reduce((p,_,v,g)=>(Object.defineProperty(p,_,{get(){return this.data[this.index*f.length+v]},set(b){this.data[this.index*f.length+v]=b}}),p),{data:null,index:0}),{typeset:a,measure:l}}const hd=()=>(self.performance||Date).now(),BS=SG();let kF;function kte(i,e,t,n,r,s,o,a,l,c,u=!0){return u?Ote(i,e,t,n,r,s,o,a,l,c).then(null,h=>(kF||(console.warn("WebGL SDF generation failed, falling back to JS",h),kF=!0),OF(i,e,t,n,r,s,o,a,l,c))):OF(i,e,t,n,r,s,o,a,l,c)}const Ix=[],Ute=5;let cC=0;function MG(){const i=hd();for(;Ix.length&&hd()-i<Ute;)Ix.shift()();cC=Ix.length?setTimeout(MG,0):0}const Ote=(...i)=>new Promise((e,t)=>{Ix.push(()=>{const n=hd();try{BS.webgl.generateIntoCanvas(...i),e({timing:hd()-n})}catch(r){t(r)}}),cC||(cC=setTimeout(MG,0))}),Bte=4,zte=2e3,UF={};let Gte=0;function OF(i,e,t,n,r,s,o,a,l,c){const u="TroikaTextSDFGenerator_JS_"+Gte++%Bte;let h=UF[u];return h||(h=UF[u]={workerModule:Rm({name:u,workerId:u,dependencies:[SG,hd],init(d,f){const p=d().javascript.generate;return function(..._){const v=f();return{textureData:p(..._),timing:f()-v}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(i,e,t,n,r,s).then(({textureData:d,timing:f})=>{const p=hd(),_=new Uint8Array(d.length*4);for(let v=0;v<d.length;v++)_[v*4+c]=d[v];return BS.webglUtils.renderImageData(o,_,a,l,i,e,1<<3-c),f+=hd()-p,--h.requests===0&&(h.idleTimer=setTimeout(()=>{_te(u)},zte)),{timing:f}})}function Vte(i){i._warm||(BS.webgl.isSupported(i),i._warm=!0)}const Hte=BS.webglUtils.resizeWebGLCanvasWithoutClearing,e0={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},$te=new It;function Df(){return(self.performance||Date).now()}const BF=Object.create(null);function AG(i,e){i=Xte({},i);const t=Df(),n=[];if(i.font&&n.push({label:"user",src:qte(i.font)}),i.font=n,i.text=""+i.text,i.sdfGlyphSize=i.sdfGlyphSize||e0.sdfGlyphSize,i.unicodeFontsURL=i.unicodeFontsURL||e0.unicodeFontsURL,i.colorRanges!=null){let d={};for(let f in i.colorRanges)if(i.colorRanges.hasOwnProperty(f)){let p=i.colorRanges[f];typeof p!="number"&&(p=$te.set(p).getHex()),d[f]=p}i.colorRanges=d}Object.freeze(i);const{textureWidth:r,sdfExponent:s}=e0,{sdfGlyphSize:o}=i,a=r/o*4;let l=BF[o];if(!l){const d=document.createElement("canvas");d.width=r,d.height=o*256/a,l=BF[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:d,sdfTexture:new dr(d,void 0,void 0,void 0,hi,hi),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,Wte(l)}const{sdfTexture:c,sdfCanvas:u}=l;CG(i).then(d=>{const{glyphIds:f,glyphFontIndices:p,fontData:_,glyphPositions:v,fontSize:g,timings:b}=d,m=[],y=new Float32Array(f.length*4);let A=0,w=0;const M=Df(),T=_.map(L=>{let R=l.glyphsByFont.get(L.src);return R||l.glyphsByFont.set(L.src,R=new Map),R});f.forEach((L,R)=>{const F=p[R],{src:V,unitsPerEm:G}=_[F];let U=T[F].get(L);if(!U){const{path:W,pathBounds:q}=d.glyphData[V][L],j=Math.max(q[2]-q[0],q[3]-q[1])/o*(e0.sdfMargin*o+.5),te=l.glyphCount++,ne=[q[0]-j,q[1]-j,q[2]+j,q[3]+j];T[F].set(L,U={path:W,atlasIndex:te,sdfViewBox:ne}),m.push(U)}const{sdfViewBox:z}=U,O=v[w++],D=v[w++],B=g/G;y[A++]=O+z[0]*B,y[A++]=D+z[1]*B,y[A++]=O+z[2]*B,y[A++]=D+z[3]*B,f[R]=U.atlasIndex}),b.quads=(b.quads||0)+(Df()-M);const E=Df();b.sdf={};const C=u.height,N=Math.ceil(l.glyphCount/a),P=Math.pow(2,Math.ceil(Math.log2(N*o)));P>C&&(console.info(`Increasing SDF texture size ${C}->${P}`),Hte(u,r,P),c.dispose()),Promise.all(m.map(L=>EG(L,l,i.gpuAccelerateSDF).then(({timing:R})=>{b.sdf[L.atlasIndex]=R}))).then(()=>{m.length&&!l.contextLost&&(TG(l),c.needsUpdate=!0),b.sdfTotal=Df()-E,b.total=Df()-t,e(Object.freeze({parameters:i,sdfTexture:c,sdfGlyphSize:o,sdfExponent:s,glyphBounds:y,glyphAtlasIndices:f,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{l.contextLost||Vte(u)})}function EG({path:i,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:n,sdfCanvas:r,contextLost:s},o){if(s)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:l}=e0,c=Math.max(t[2]-t[0],t[3]-t[1]),u=Math.floor(e/4),h=u%(a/n)*n,d=Math.floor(u/(a/n))*n,f=e%4;return kte(n,n,i,t,c,l,r,h,d,f,o)}function Wte(i){const e=i.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),i.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),i.contextLost=!1;const n=[];i.glyphsByFont.forEach(r=>{r.forEach(s=>{n.push(EG(s,i,!0))})}),Promise.all(n).then(()=>{TG(i),i.sdfTexture.needsUpdate=!0})})}function jte({font:i,characters:e,sdfGlyphSize:t},n){let r=Array.isArray(e)?e.join(`
`):""+e;AG({font:i,sdfGlyphSize:t,text:r},n)}function Xte(i,e){for(let t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}let ry;function qte(i){return ry||(ry=typeof document>"u"?{}:document.createElement("a")),ry.href=i,ry.href}function TG(i){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=i,{width:n,height:r}=e,s=i.sdfCanvas.getContext("webgl");let o=t.image.data;(!o||o.length!==n*r*4)&&(o=new Uint8Array(n*r*4),t.image={width:n,height:r,data:o},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,n,r,s.RGBA,s.UNSIGNED_BYTE,o)}}const Yte=Rm({name:"Typesetter",dependencies:[Fte,Nte,xte],init(i,e,t){return i(e,t())}}),CG=Rm({name:"Typesetter",dependencies:[Yte],init(i){return function(e){return new Promise(t=>{i.typeset(e,t)})}},getTransferables(i){const e=[];for(let t in i)i[t]&&i[t].buffer&&e.push(i[t].buffer);return e}});CG.onMainThread;const zF={};function Kte(i){let e=zF[i];return e||(e=zF[i]=new Va(1,1,i,i).translate(.5,.5,0)),e}const Zte="aTroikaGlyphBounds",GF="aTroikaGlyphIndex",Qte="aTroikaGlyphColor";class Jte extends $R{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ur,this.boundingBox=new kr}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=Kte(e);["position","normal","uv"].forEach(n=>{this.attributes[n]=t.attributes[n].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,n,r,s){this.updateAttributeData(Zte,e,4),this.updateAttributeData(GF,t,1),this.updateAttributeData(Qte,s,3),this._blockBounds=n,this._chunkedBounds=r,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:n}=this;if(t){const{PI:r,floor:s,min:o,max:a,sin:l,cos:c}=Math,u=r/2,h=r*2,d=Math.abs(t),f=e[0]/d,p=e[2]/d,_=s((f+u)/h)!==s((p+u)/h)?-d:o(l(f)*d,l(p)*d),v=s((f-u)/h)!==s((p-u)/h)?d:a(l(f)*d,l(p)*d),g=s((f+r)/h)!==s((p+r)/h)?d*2:a(d-c(f)*d,d-c(p)*d);n.min.set(_,e[1],t<0?-g:0),n.max.set(v,e[3],t<0?0:g)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(GF).count,n=this._chunkedBounds;if(n)for(let r=n.length;r--;){t=n[r].end;let s=n[r].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,n){const r=this.getAttribute(e);t?r&&r.array.length===t.length?(r.array.set(t),r.needsUpdate=!0):(this.setAttribute(e,new Gu(t,n)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(e)}}const ene=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,tne=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,nne=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,ine=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function rne(i){const e=lC(i,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new yt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Wn(0,0,0,0)},uTroikaClipRect:{value:new Wn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new yt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new It},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new bn},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:ene,vertexTransform:tne,fragmentDefs:nne,fragmentColorTransform:ine,customRewriter({vertexShader:t,fragmentShader:n}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(n)&&(n=n.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(t)||(t=t.replace(wG,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:n}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const e3=new fi({color:16777215,side:cr,transparent:!0}),VF=8421504,HF=new en,sy=new Te,MM=new Te,Ig=[],sne=new Te,AM="+x+y";function $F(i){return Array.isArray(i)?i[0]:i}let PG=()=>{const i=new Tn(new Va(1,1),e3);return PG=()=>i,i},RG=()=>{const i=new Tn(new Va(1,1,32,1),e3);return RG=()=>i,i};const one={type:"syncstart"},ane={type:"synccomplete"},IG=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],lne=IG.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let LG=class extends Tn{constructor(){const e=new Jte;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=VF,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=AM,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(one),AG({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(r=>r&&r())})),this.dispatchEvent(ane),e&&e()})))}onBeforeRender(e,t,n,r,s,o){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return rne(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=e3.clone());if((!e||!e.isDerivedFrom(t))&&(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),this.hasOutline()){let n=e._outlineMtl;return n||(n=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),n.isTextOutlineMaterial=!0,n.depthWrite=!1,n.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),n.dispose()})),[n,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return $F(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return $F(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,n=e.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:a,blockBounds:l}=r;n.uTroikaSDFTexture.value=a,n.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),n.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,n.uTroikaSDFExponent.value=r.sdfExponent,n.uTroikaTotalBounds.value.fromArray(l),n.uTroikaUseGlyphColors.value=!t&&!!r.glyphColors;let c=0,u=0,h=0,d,f,p,_=0,v=0;if(t){let{outlineWidth:b,outlineOffsetX:m,outlineOffsetY:y,outlineBlur:A,outlineOpacity:w}=this;c=this._parsePercent(b)||0,u=Math.max(0,this._parsePercent(A)||0),d=w,_=this._parsePercent(m)||0,v=this._parsePercent(y)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(p=this.strokeColor,n.uTroikaStrokeColor.value.set(p??VF),f=this.strokeOpacity,f==null&&(f=1)),d=this.fillOpacity;n.uTroikaEdgeOffset.value=c,n.uTroikaPositionOffset.value.set(_,v),n.uTroikaBlurRadius.value=u,n.uTroikaStrokeWidth.value=h,n.uTroikaStrokeOpacity.value=f,n.uTroikaFillOpacity.value=d??1,n.uTroikaCurveRadius.value=this.curveRadius||0;let g=this.clipRect;if(g&&Array.isArray(g)&&g.length===4)n.uTroikaClipRect.value.fromArray(g);else{const b=(this.fontSize||.1)*100;n.uTroikaClipRect.value.set(l[0]-b,l[1]-b,l[2]+b,l[3]+b)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const a=e.hasOwnProperty("color")?e.color:e.color=new It;(s!==a._input||typeof s=="object")&&a.set(a._input=s)}let o=this.orientation||AM;if(o!==e._orientation){let a=n.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let l=o!==AM&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,u,h,d]=l;sy.set(0,0,0)[u]=c==="-"?1:-1,MM.set(0,0,0)[d]=h==="-"?-1:1,HF.lookAt(sne,sy.cross(MM),MM),a.setFromMatrix4(HF)}else a.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new yt){t.copy(e);const n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}worldPositionToTextCoords(e,t=new yt){return sy.copy(e),this.localPositionToTextCoords(this.worldToLocal(sy),t)}raycast(e,t){const{textRenderInfo:n,curveRadius:r}=this;if(n){const s=n.blockBounds,o=r?RG():PG(),a=o.geometry,{position:l,uv:c}=a.attributes;for(let u=0;u<c.count;u++){let h=s[0]+c.getX(u)*(s[2]-s[0]);const d=s[1]+c.getY(u)*(s[3]-s[1]);let f=0;r&&(f=r-Math.cos(h/r)*r,h=Math.sin(h/r)*r),l.setXYZ(u,h,d,f)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,Ig.length=0,o.raycast(e,Ig);for(let u=0;u<Ig.length;u++)Ig[u].object=this,t.push(Ig[u])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,lne.forEach(n=>{this[n]=e[n]}),this}clone(){return new this.constructor().copy(this)}};IG.forEach(i=>{const e="_private_"+i;Object.defineProperty(LG.prototype,i,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});new kr;new It;const cne=Re.forwardRef(({sdfGlyphSize:i=64,anchorX:e="center",anchorY:t="middle",font:n,fontSize:r=1,children:s,characters:o,onSync:a,...l},c)=>{const u=Ci(({invalidate:p})=>p),[h]=Re.useState(()=>new LG),[d,f]=Re.useMemo(()=>{const p=[];let _="";return Re.Children.forEach(s,v=>{typeof v=="string"||typeof v=="number"?_+=v:p.push(v)}),[p,_]},[s]);return KQ(()=>new Promise(p=>jte({font:n,characters:o},p)),["troika-text",n,o]),Re.useLayoutEffect(()=>void h.sync(()=>{u(),a&&a(h)})),Re.useEffect(()=>()=>h.dispose(),[h]),Re.createElement("primitive",um({object:h,ref:c,font:n,text:f,anchorX:e,anchorY:t,fontSize:r,sdfGlyphSize:i},l),d)}),une=Re.forwardRef(({domElement:i,selector:e,onChange:t,onLock:n,onUnlock:r,enabled:s=!0,makeDefault:o,...a},l)=>{const{camera:c,...u}=a,h=Ci(A=>A.setEvents),d=Ci(A=>A.gl),f=Ci(A=>A.camera),p=Ci(A=>A.invalidate),_=Ci(A=>A.events),v=Ci(A=>A.get),g=Ci(A=>A.set),b=c||f,m=i||_.connected||d.domElement,y=Re.useMemo(()=>new iee(b),[b]);return Re.useEffect(()=>{if(s){y.connect(m);const A=v().events.compute;return h({compute(w,M){const T=M.size.width/2,E=M.size.height/2;M.pointer.set(T/M.size.width*2-1,-(E/M.size.height)*2+1),M.raycaster.setFromCamera(M.pointer,M.camera)}}),()=>{y.disconnect(),h({compute:A})}}},[s,y]),Re.useEffect(()=>{const A=T=>{p(),t&&t(T)};y.addEventListener("change",A),n&&y.addEventListener("lock",n),r&&y.addEventListener("unlock",r);const w=()=>y.lock(),M=e?Array.from(document.querySelectorAll(e)):[document];return M.forEach(T=>T&&T.addEventListener("click",w)),()=>{y.removeEventListener("change",A),n&&y.removeEventListener("lock",n),r&&y.removeEventListener("unlock",r),M.forEach(T=>T?T.removeEventListener("click",w):void 0)}},[t,n,r,e,y,p]),Re.useEffect(()=>{if(o){const A=v().controls;return g({controls:y}),()=>g({controls:A})}},[o,y]),Re.createElement("primitive",um({ref:l,object:y},u))});function hne(i,e){const t=i+"Geometry";return Re.forwardRef(({args:n,children:r,...s},o)=>{const a=Re.useRef(null);return Re.useImperativeHandle(o,()=>a.current),Re.useLayoutEffect(()=>void(e==null?void 0:e(a.current))),Re.createElement("mesh",um({ref:a},s),Re.createElement(t,{attach:"geometry",args:n}),r)})}const dne=hne("box"),fne=()=>{const[i,e]=Re.useState({forward:!1,backward:!1,left:!1,right:!1,jump:!1});return Re.useEffect(()=>{const t=r=>{switch(r.key.toLowerCase()){case"w":case"arrowup":e(s=>({...s,forward:!0}));break;case"s":case"arrowdown":e(s=>({...s,backward:!0}));break;case"a":case"arrowleft":e(s=>({...s,left:!0}));break;case"d":case"arrowright":e(s=>({...s,right:!0}));break;case" ":e(s=>({...s,jump:!0}));break}},n=r=>{switch(r.key.toLowerCase()){case"w":case"arrowup":e(s=>({...s,forward:!1}));break;case"s":case"arrowdown":e(s=>({...s,backward:!1}));break;case"a":case"arrowleft":e(s=>({...s,left:!1}));break;case"d":case"arrowright":e(s=>({...s,right:!1}));break;case" ":e(s=>({...s,jump:!1}));break}};return document.addEventListener("keydown",t),document.addEventListener("keyup",n),()=>{document.removeEventListener("keydown",t),document.removeEventListener("keyup",n)}},[]),i};var Mi=(i=>(i[i.START=0]="START",i[i.EXPLORING=1]="EXPLORING",i[i.MENU=2]="MENU",i[i.PAGE_VIEW=3]="PAGE_VIEW",i))(Mi||{});class Ap{constructor(){this.logs=[],this.maxLogs=20,this.listeners=[],this.controllerInfo={left:{connected:!1,buttons:[],axes:[],lastUpdate:0,source:"none"},right:{connected:!1,buttons:[],axes:[],lastUpdate:0,source:"none"}}}static getInstance(){return Ap.instance||(Ap.instance=new Ap),Ap.instance}log(e){const t=new Date().toLocaleTimeString();this.logs.unshift(`${t}: ${e}`),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs)),this.listeners.forEach(n=>n([...this.logs])),console.log(`[VRConsole] ${e}`)}updateControllerInfo(e,t,n,r,s){this.controllerInfo[e]={connected:t,buttons:n||[],axes:r||[],lastUpdate:Date.now(),source:s||(t?"react-xr":"none")},this.listeners.forEach(o=>o([...this.logs]))}getControllerInfo(){return{...this.controllerInfo}}getLogs(){return[...this.logs]}setMaxLogs(e){this.maxLogs=e,this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(0,this.maxLogs),this.listeners.forEach(t=>t([...this.logs])))}addListener(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}clear(){this.logs=[],this.listeners.forEach(e=>e([]))}}const Et=Ap.getInstance(),pne=({maxLines:i=20})=>{const{scene:e}=Ci(),{isPresenting:t,controllers:n}=Vi(),[r,s]=Re.useState([]),o=Re.useRef(),a=Re.useRef(),[l,c]=Re.useState(!0);Re.useEffect(()=>{const d=f=>{(f.key==="v"||f.key==="V")&&(c(p=>!p),Et.log(`Console visibility ${l?"disabled":"enabled"}`))};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[l]),Re.useEffect(()=>{if(t&&l){const d=document.createElement("canvas");d.width=512,d.height=512;const f=new Ad(d),p=new fi({map:f,transparent:!0,opacity:.9,side:cr}),_=new Va(1,1),v=new Tn(_,p);return v.position.set(1.5,1.5,-1.5),v.rotation.y=-Math.PI/8,e.add(v),a.current=v,h(),()=>{e.remove(v)}}},[t,e]),Re.useEffect(()=>{if(t&&l){Et.setMaxLogs(i);const d=document.createElement("canvas");d.width=1024,d.height=512;const f=new Ad(d),p=new fi({map:f,transparent:!0,opacity:.9,side:cr}),_=new Va(2,1),v=new Tn(_,p);v.position.set(0,2,-2),e.add(v),o.current=v,Et.log("VR Console initialized"),Et.log("Move with left thumbstick"),Et.log("Press buttons to see events"),Et.log("Look down to move forward (fallback)");const g=Et.addListener(b=>{s(b),u(b),h()});return()=>{g(),e.remove(v)}}},[t,i,e]);const u=d=>{if(!o.current)return;const p=o.current.material.map,_=p.image,v=_.getContext("2d");v&&(v.fillStyle="rgba(0, 0, 0, 0.8)",v.fillRect(0,0,_.width,_.height),v.strokeStyle="#ffffff",v.lineWidth=4,v.strokeRect(4,4,_.width-8,_.height-8),v.fillStyle="#00ff00",v.font="bold 28px monospace",v.fillText("VR Debug Console",20,35),v.strokeStyle="#444444",v.beginPath(),v.moveTo(10,45),v.lineTo(_.width-10,45),v.stroke(),v.fillStyle="#ffffff",v.font="20px monospace",d.forEach((g,b)=>{g.includes("controller")||g.includes("Controller")?v.fillStyle="#ffff00":g.includes("error")||g.includes("Error")?v.fillStyle="#ff6666":g.includes("connected")||g.includes("Connected")?v.fillStyle="#66ff66":g.includes("movement")||g.includes("Moving")?v.fillStyle="#66ffff":v.fillStyle="#ffffff",v.fillText(g,20,75+b*24)}),p.needsUpdate=!0)},h=()=>{if(!a.current)return;const f=a.current.material.map,p=f.image,_=p.getContext("2d");if(_){_.fillStyle="rgba(0, 0, 0, 0.8)",_.fillRect(0,0,p.width,p.height),_.strokeStyle="#ffffff",_.lineWidth=4,_.strokeRect(4,4,p.width-8,p.height-8),_.fillStyle="#00ffff",_.font="bold 24px monospace",_.fillText("Controller Status",20,35),_.strokeStyle="#444444",_.beginPath(),_.moveTo(10,45),_.lineTo(p.width-10,45),_.stroke();const v=Et.getControllerInfo();if(_.fillStyle="#ff6666",_.font="bold 20px monospace",_.fillText("Left Controller:",20,80),_.font="18px monospace",_.fillStyle=v.left.connected?"#66ff66":"#ff6666",_.fillText(`Status: ${v.left.connected?"CONNECTED":"DISCONNECTED"}`,40,110),v.left.connected){let g="#ffffff";v.left.source==="webxr"&&(g="#ffaa00"),v.left.source==="react-xr"&&(g="#00aaff"),v.left.source==="both"&&(g="#aaffaa"),_.fillStyle=g,_.fillText(`Source: ${v.left.source.toUpperCase()}`,200,110)}if(v.left.connected){_.fillStyle="#ffffff",_.fillText(`Buttons: ${v.left.buttons.length}`,40,140),_.fillText(`Axes: ${v.left.axes.length}`,40,170);const g=v.left.buttons.map((m,y)=>m>.5?y:-1).filter(m=>m!==-1);_.fillStyle=g.length>0?"#ffff00":"#aaaaaa",_.fillText(`Pressed: ${g.length>0?g.join(", "):"None"}`,40,200);const b=v.left.axes.map((m,y)=>Math.abs(m)>.1?`${y}:${m.toFixed(2)}`:null).filter(Boolean);_.fillStyle=b.length>0?"#ffff00":"#aaaaaa",_.fillText(`Active axes: ${b.length>0?b.join(", "):"None"}`,40,230)}if(_.fillStyle="#6666ff",_.font="bold 20px monospace",_.fillText("Right Controller:",20,270),_.font="18px monospace",_.fillStyle=v.right.connected?"#66ff66":"#ff6666",_.fillText(`Status: ${v.right.connected?"CONNECTED":"DISCONNECTED"}`,40,300),v.right.connected){let g="#ffffff";v.right.source==="webxr"&&(g="#ffaa00"),v.right.source==="react-xr"&&(g="#00aaff"),v.right.source==="both"&&(g="#aaffaa"),_.fillStyle=g,_.fillText(`Source: ${v.right.source.toUpperCase()}`,200,300)}if(v.right.connected){_.fillStyle="#ffffff",_.fillText(`Buttons: ${v.right.buttons.length}`,40,330),_.fillText(`Axes: ${v.right.axes.length}`,40,360);const g=v.right.buttons.map((m,y)=>m>.5?y:-1).filter(m=>m!==-1);_.fillStyle=g.length>0?"#ffff00":"#aaaaaa",_.fillText(`Pressed: ${g.length>0?g.join(", "):"None"}`,40,390);const b=v.right.axes.map((m,y)=>Math.abs(m)>.1?`${y}:${m.toFixed(2)}`:null).filter(Boolean);_.fillStyle=b.length>0?"#ffff00":"#aaaaaa",_.fillText(`Active axes: ${b.length>0?b.join(", "):"None"}`,40,420)}_.fillStyle="#aaaaaa",_.font="16px monospace",_.fillText("Press any button to test controllers",20,450),_.fillText("Updates every frame when connected",20,470),_.fillStyle="#00aaff",_.fillText("REACT-XR: Using react-three/xr API",20,490),_.fillStyle="#ffaa00",_.fillText("WEBXR: Using direct WebXR API",260,490),_.fillStyle="#aaffaa",_.fillText("BOTH: Detected by both APIs",20,510),f.needsUpdate=!0}};return null},mne=()=>{const{controllers:i,player:e}=Vi(),t=Re.useRef([]);return Re.useEffect(()=>(i.length>0&&(Et.log(`Found ${i.length} controllers`),i.forEach((n,r)=>{const s=n.handedness||"unknown";Et.log(`Controller ${r}: ${s} hand`),(s==="left"||s==="right")&&Et.updateControllerInfo(s,!0);const o=()=>{Et.log(`${s} controller: select start`)},a=()=>{Et.log(`${s} controller: select end`)},l=()=>{Et.log(`${s} controller: squeeze start`)},c=()=>{Et.log(`${s} controller: squeeze end`)};n.removeEventListener("selectstart",o),n.removeEventListener("selectend",a),n.removeEventListener("squeezestart",l),n.removeEventListener("squeezeend",c),n.addEventListener("selectstart",o),n.addEventListener("selectend",a),n.addEventListener("squeezestart",l),n.addEventListener("squeezeend",c),n._eventListeners=n._eventListeners||{},n._eventListeners.selectstart=o,n._eventListeners.selectend=a,n._eventListeners.squeezestart=l,n._eventListeners.squeezeend=c})),()=>{i.forEach(n=>{n&&n._eventListeners&&(n.removeEventListener("selectstart",n._eventListeners.selectstart),n.removeEventListener("selectend",n._eventListeners.selectend),n.removeEventListener("squeezestart",n._eventListeners.squeezestart),n.removeEventListener("squeezeend",n._eventListeners.squeezeend))})}),[i]),no(()=>{if(e!=null&&e.session){const n=e.session.inputSources;t.current=Array.from(n||[]),t.current.forEach(r=>{const s=r.handedness;if(s==="left"||s==="right")if(r.gamepad){const o=u.gamepad,a=o.buttons.map(h=>(h==null?void 0:h.value)||0),l=o.axes||[],u=i.some(h=>h.handedness===s)?"both":"webxr";Et.updateControllerInfo(s,!0,a,l,u)}else{const a=i.some(l=>l.handedness===s)?"both":"webxr";Et.updateControllerInfo(s,!0,[],[],a)}})}i.forEach(n=>{var s;const r=n.handedness;if((r==="left"||r==="right")&&!t.current.some(a=>a.handedness===r))if((s=n.inputSource)!=null&&s.gamepad){const a=n.inputSource.gamepad,l=a.buttons.map(u=>(u==null?void 0:u.value)||0),c=a.axes||[];Et.updateControllerInfo(r,!0,l,c,"react-xr")}else Et.updateControllerInfo(r,!0,[],[],"react-xr")}),["left","right"].forEach(n=>{const r=Et.getControllerInfo(),s=t.current.some(a=>a.handedness===n),o=i.some(a=>a.handedness===n);r[n].connected&&!s&&!o&&(Et.updateControllerInfo(n,!1,[],[],"none"),Et.log(`${n} controller disconnected`))})}),null},gne=({gameState:i,isLocked:e,onPointerLockChange:t})=>{const{camera:n,scene:r}=Ci(),s=Re.useRef(null),o=fne(),a=Re.useRef(new Te),l=new Te,[c,u]=Re.useState(""),h=Re.useRef(),{player:d,controllers:f,isPresenting:p}=Vi();Re.useEffect(()=>{var C,N;if(p){e&&((C=s.current)==null||C.unlock()),Et.log("VR Player initialized"),Et.log(`Room size: ${Yi}x${Yi} meters`),Et.log("Move with left thumbstick"),Et.log("Fallback controls: Look down to move forward");const P=document.createElement("canvas");P.width=512,P.height=256;const L=P.getContext("2d");L&&(L.fillStyle="black",L.fillRect(0,0,P.width,P.height),L.fillStyle="white",L.font="24px Arial",L.fillText("Movement Debug: Use left thumbstick",20,40),L.fillStyle="#FFFF00",L.font="18px Arial",L.fillText("Fallback: Look down to move forward",20,70));const R=new Ad(P),F=new fi({map:R,transparent:!0}),V=new Va(1,.5),G=new Tn(V,F);return G.position.set(0,1.2,-1.5),r.add(G),h.current=G,()=>{r.remove(G)}}(i===Mi.PAGE_VIEW||i===Mi.START)&&e&&((N=s.current)==null||N.unlock());const E=P=>{var L,R;P.key.toLowerCase()==="t"&&(i===Mi.EXPLORING||i===Mi.MENU)&&(e?(L=s.current)==null||L.unlock():(R=s.current)==null||R.lock())};return window.addEventListener("keydown",E),()=>{window.removeEventListener("keydown",E)}},[i,e,p]);const _=Re.useCallback(()=>{p||t(!0)},[t,p]),v=Re.useCallback(()=>{p||t(!1)},[t,p]),g=E=>{if(u(E),h.current){const N=h.current.material.map,P=N.image,L=P.getContext("2d");L&&(L.fillStyle="black",L.fillRect(0,0,P.width,P.height),L.fillStyle="white",L.font="24px Arial",L.fillText("Movement Debug:",20,40),E.split(`
`).forEach((F,V)=>{L.fillText(F,20,80+V*30)})),N.needsUpdate=!0}},[b,m]=Re.useState(!1),y=Re.useRef(0),A=Re.useRef(new Te),w=Re.useRef(new Te),M=Re.useRef([]),T=Re.useRef({x:0,y:0});return Re.useEffect(()=>{const E=N=>{N.detail&&(T.current={x:N.detail.x,y:N.detail.y},Et.log(`Received movement event: X:${N.detail.x.toFixed(2)}, Y:${N.detail.y.toFixed(2)}`))};window.addEventListener("vr-movement",E);const C=setInterval(()=>{typeof window<"u"&&window.vrMovement&&(T.current={x:window.vrMovement.x,y:window.vrMovement.y})},50);return()=>{window.removeEventListener("vr-movement",E),clearInterval(C)}},[]),no((E,C)=>{var P,L,R,F,V,G,U,z,O,D,B;if(!(i===Mi.EXPLORING||i===Mi.MENU)){a.current.set(0,0,0);return}if(p&&performance.now()-y.current>1e3){if(y.current=performance.now(),d!=null&&d.session){const le=d.session.inputSources;M.current=Array.from(le||[])}const W=f.some(le=>le.handedness==="left"),q=f.some(le=>le.handedness==="right"),j=M.current.some(le=>le.handedness==="left"),te=M.current.some(le=>le.handedness==="right"),ne=typeof window<"u"&&window.vrMovement!==void 0,Z=W||q||j||te||ne;Z!==b&&(Et.log(`Controller status changed: ${Z?"Available":"Not available"}`),Z&&Et.log(`Left: ${W||j?"Yes":"No"}, Right: ${q||te?"Yes":"No"}, GlobalMovement: ${ne?"Yes":"No"}`)),m(Z)}if(p&&d){if(!b){const W=new Te;E.camera.getWorldPosition(W),A.current.length()>0&&(w.current.subVectors(W,A.current),w.current.divideScalar(C),w.current.length()>1&&Et.log(`Head velocity: ${w.current.length().toFixed(2)}`)),A.current.copy(W)}if(f.length>0||M.current.length>0){const W=f.find(Me=>Me.handedness==="left"),q=f.find(Me=>Me.handedness==="right"),j=M.current.find(Me=>Me.handedness==="left"),te=M.current.find(Me=>Me.handedness==="right");let ne="";const Z=W||j,le=q||te;ne+=`Left: ${Z?"Connected":"Not connected"}
`,ne+=`Right: ${le?"Connected":"Not connected"}
`,Z&&(ne+=`Left source: ${W?"react-xr":""}${W&&j?"+":""}${j?"WebXR":""}
`),le&&(ne+=`Right source: ${q?"react-xr":""}${q&&te?"+":""}${te?"WebXR":""}
`);let re=0,se=0,$="none";if(j!=null&&j.gamepad){const Me=j.gamepad.axes;Me&&Me.length>0&&(ne+=`WebXR Axes: [${Me.map(Y=>(Y==null?void 0:Y.toFixed(2))||"N/A").join(", ")}]
`,Math.abs(Me[0])>.1||Math.abs(Me[1])>.1?(re=Me[0],se=Me[1],$="webxr-0,1"):Math.abs(Me[2])>.1||Math.abs(Me[3])>.1?(re=Me[2],se=Me[3],$="webxr-2,3"):Me.length>4&&(Math.abs(Me[4])>.1||Math.abs(Me[5])>.1)&&(re=Me[4],se=Me[5],$="webxr-4,5"))}if($==="none"&&((P=W==null?void 0:W.inputSource)!=null&&P.gamepad)){const Me=W.inputSource.gamepad.axes;Me&&Me.length>0&&(ne+=`R3F Axes: [${Me.map(Y=>(Y==null?void 0:Y.toFixed(2))||"N/A").join(", ")}]
`,Math.abs(Me[0])>.1||Math.abs(Me[1])>.1?(re=Me[0],se=Me[1],$="r3f-0,1"):Math.abs(Me[2])>.1||Math.abs(Me[3])>.1?(re=Me[2],se=Me[3],$="r3f-2,3"):Me.length>4&&(Math.abs(Me[4])>.1||Math.abs(Me[5])>.1)&&(re=Me[4],se=Me[5],$="r3f-4,5"))}if($==="none"&&W){const Me=new Te;W.getWorldPosition(Me);const Y=new Te(0,0,-1);Y.applyQuaternion(W.quaternion),Y.y=0,Y.normalize();const Q=.3;(Math.abs(Y.z)>Q||Math.abs(Y.x)>Q)&&(re=-Y.x,se=-Y.z,$="controller-tilt")}if($==="none"&&(j!=null&&j.gamepad)){const Me=j.gamepad.buttons,Y={forward:4,backward:5,left:6,right:7};Me&&Me.length>Math.max(...Object.values(Y))&&((L=Me[Y.forward])!=null&&L.pressed&&(se=-1),(R=Me[Y.backward])!=null&&R.pressed&&(se=1),(F=Me[Y.left])!=null&&F.pressed&&(re=-1),(V=Me[Y.right])!=null&&V.pressed&&(re=1),(re!==0||se!==0)&&($="webxr-button-map"))}if($==="none"&&((G=W==null?void 0:W.inputSource)!=null&&G.gamepad)){const Me=W.inputSource.gamepad.buttons,Y={forward:4,backward:5,left:6,right:7};Me&&Me.length>Math.max(...Object.values(Y))&&((U=Me[Y.forward])!=null&&U.pressed&&(se=-1),(z=Me[Y.backward])!=null&&z.pressed&&(se=1),(O=Me[Y.left])!=null&&O.pressed&&(re=-1),(D=Me[Y.right])!=null&&D.pressed&&(re=1),(re!==0||se!==0)&&($="r3f-button-map"))}ne+=`Using method: ${$}
`,ne+=`Movement: X:${re.toFixed(2)}, Y:${se.toFixed(2)}
`;const fe=Math.abs(T.current.x)>.1||Math.abs(T.current.y)>.1,xe=fe?T.current.x:re,Ie=fe?T.current.y:se;if(Math.abs(xe)>.1||Math.abs(Ie)>.1){const Me=new jr;E.camera.getWorldQuaternion(Me);const Y=new N1().setFromQuaternion(Me,"YXZ");Y.x=0,Y.z=0;const Q=new Te(xe,0,Ie);Q.applyEuler(Y).normalize();const de=iy*C*3;d.position.add(Q.multiplyScalar(de)),ne+=`Moving: ${Q.x.toFixed(2)}, ${Q.z.toFixed(2)}
`,ne+=`Position: ${d.position.x.toFixed(1)}, ${d.position.z.toFixed(1)}
`,ne+=fe?`Source: GlobalVRInput
`:`Source: ${$}
`,Q.length()>.5&&Et.log(`Moving: ${Q.x.toFixed(1)}, ${Q.z.toFixed(1)}`)}g(ne);const ge=Yi/2,Oe=.5;if(d.position.x=au.clamp(d.position.x,-ge+Oe,ge-Oe),d.position.z=au.clamp(d.position.z,-ge+Oe,ge-Oe),d.position.y=0,!d.children.length){const Me=new Tn(new am(.3,.3,.05,16),new fi({color:65280,transparent:!0,opacity:.7}));Me.position.y=-.8,d.add(Me);const Y=new fi({color:255}),Q=.4,de=new Tn(new NR(.08,.2,8),Y);de.position.set(0,-.8,-Q/2-.1),de.rotation.x=Math.PI/2,d.add(de);const Le=new Tn(new am(.02,.02,Q,8),Y);Le.position.set(0,-.8,-Q/4),Le.rotation.x=Math.PI/2,d.add(Le),Et.log("Player position indicator created")}}else if(!b){let W=`Using fallback head movement controls
`;const q=new Te(0,0,-1);q.applyQuaternion(E.camera.quaternion),q.y=0,q.normalize();const j=new Te;E.camera.getWorldDirection(j);let te=new Te;if(j.y<-.3){const se=Math.min(1,Math.abs(j.y)*2);te.add(q.clone().multiplyScalar(se)),W+=`Forward tilt: ${j.y.toFixed(2)}, strength: ${se.toFixed(2)}
`}const Z=.5;if(w.current.length()>Z){const $=new Te(w.current.x,0,w.current.z).dot(q);if(Math.abs($)>Z){const fe=Math.min(1,Math.abs($)*.5);te.add(q.clone().multiplyScalar($>0?fe:-fe)),W+=`Head velocity: ${$.toFixed(2)}, strength: ${fe.toFixed(2)}
`}}if(te.length()>.1){te.normalize();const se=iy*C*2;d.position.add(te.multiplyScalar(se)),W+=`Moving: ${te.x.toFixed(2)}, ${te.z.toFixed(2)}
`,W+=`Position: ${d.position.x.toFixed(1)}, ${d.position.z.toFixed(1)}
`,Et.log(`Fallback movement: ${te.x.toFixed(1)}, ${te.z.toFixed(1)}`)}else W+=`No movement detected
`;g(W);const le=Yi/2,re=.5;d.position.x=au.clamp(d.position.x,-le+re,le-re),d.position.z=au.clamp(d.position.z,-le+re,le-re),d.position.y=0}}else{if(a.current.x-=a.current.x*10*C,a.current.z-=a.current.z*10*C,l.z=Number(o.forward)-Number(o.backward),l.x=Number(o.right)-Number(o.left),l.normalize(),(o.forward||o.backward)&&(a.current.z-=l.z*iy*10*C),(o.left||o.right)&&(a.current.x-=l.x*iy*10*C),(B=s.current)!=null&&B.isLocked){s.current.moveRight(-a.current.x*C),s.current.moveForward(-a.current.z*C);const W=Yi/2,q=.5;n.position.x=au.clamp(n.position.x,-W+q,W-q),n.position.z=au.clamp(n.position.z,-W+q,W-q)}n.position.y=hte}}),p?_e.jsx("group",{}):_e.jsx(une,{ref:s,onLock:_,onUnlock:v})},H1=new Te,t3=new Te,vne=new Te,WF=new yt;function _ne(i,e,t){const n=H1.setFromMatrixPosition(i.matrixWorld);n.project(e);const r=t.width/2,s=t.height/2;return[n.x*r+r,-(n.y*s)+s]}function yne(i,e){const t=H1.setFromMatrixPosition(i.matrixWorld),n=t3.setFromMatrixPosition(e.matrixWorld),r=t.sub(n),s=e.getWorldDirection(vne);return r.angleTo(s)>Math.PI/2}function xne(i,e,t,n){const r=H1.setFromMatrixPosition(i.matrixWorld),s=r.clone();s.project(e),WF.set(s.x,s.y),t.setFromCamera(WF,e);const o=t.intersectObjects(n,!0);if(o.length){const a=o[0].distance;return r.distanceTo(t.ray.origin)<a}return!0}function bne(i,e){if(e instanceof Ku)return e.zoom;if(e instanceof Zi){const t=H1.setFromMatrixPosition(i.matrixWorld),n=t3.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=t.distanceTo(n);return 1/(2*Math.tan(r/2)*s)}else return 1}function Sne(i,e,t){if(e instanceof Zi||e instanceof Ku){const n=H1.setFromMatrixPosition(i.matrixWorld),r=t3.setFromMatrixPosition(e.matrixWorld),s=n.distanceTo(r),o=(t[1]-t[0])/(e.far-e.near),a=t[1]-o*e.far;return Math.round(o*s+a)}}const uC=i=>Math.abs(i)<1e-10?0:i;function DG(i,e,t=""){let n="matrix3d(";for(let r=0;r!==16;r++)n+=uC(e[r]*i.elements[r])+(r!==15?",":")");return t+n}const wne=(i=>e=>DG(e,i))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Mne=(i=>(e,t)=>DG(e,i(t),"translate(-50%,-50%)"))(i=>[1/i,1/i,1/i,1,-1/i,-1/i,-1/i,-1,1/i,1/i,1/i,1,1,1,1,1]);function Ane(i){return i&&typeof i=="object"&&"current"in i}const cu=Re.forwardRef(({children:i,eps:e=.001,style:t,className:n,prepend:r,center:s,fullscreen:o,portal:a,distanceFactor:l,sprite:c=!1,transform:u=!1,occlude:h,onOcclude:d,castShadow:f,receiveShadow:p,material:_,geometry:v,zIndexRange:g=[16777271,0],calculatePosition:b=_ne,as:m="div",wrapperClass:y,pointerEvents:A="auto",...w},M)=>{const{gl:T,camera:E,scene:C,size:N,raycaster:P,events:L,viewport:R}=Ci(),[F]=Re.useState(()=>document.createElement(m)),V=Re.useRef(),G=Re.useRef(null),U=Re.useRef(0),z=Re.useRef([0,0]),O=Re.useRef(null),D=Re.useRef(null),B=(a==null?void 0:a.current)||L.connected||T.domElement.parentNode,W=Re.useRef(null),q=Re.useRef(!1),j=Re.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&Ane(h[0]),[h]);Re.useLayoutEffect(()=>{const re=T.domElement;h&&h==="blending"?(re.style.zIndex=`${Math.floor(g[0]/2)}`,re.style.position="absolute",re.style.pointerEvents="none"):(re.style.zIndex=null,re.style.position=null,re.style.pointerEvents=null)},[h]),Re.useLayoutEffect(()=>{if(G.current){const re=V.current=yz(F);if(C.updateMatrixWorld(),u)F.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const se=b(G.current,E,N);F.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${se[0]}px,${se[1]}px,0);transform-origin:0 0;`}return B&&(r?B.prepend(F):B.appendChild(F)),()=>{B&&B.removeChild(F),re.unmount()}}},[B,u]),Re.useLayoutEffect(()=>{y&&(F.className=y)},[y]);const te=Re.useMemo(()=>u?{position:"absolute",top:0,left:0,width:N.width,height:N.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...o&&{top:-N.height/2,left:-N.width/2,width:N.width,height:N.height},...t},[t,s,o,N,u]),ne=Re.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);Re.useLayoutEffect(()=>{if(q.current=!1,u){var re;(re=V.current)==null||re.render(Re.createElement("div",{ref:O,style:te},Re.createElement("div",{ref:D,style:ne},Re.createElement("div",{ref:M,className:n,style:t,children:i}))))}else{var se;(se=V.current)==null||se.render(Re.createElement("div",{ref:M,style:te,className:n,children:i}))}});const Z=Re.useRef(!0);no(re=>{if(G.current){E.updateMatrixWorld(),G.current.updateWorldMatrix(!0,!1);const se=u?z.current:b(G.current,E,N);if(u||Math.abs(U.current-E.zoom)>e||Math.abs(z.current[0]-se[0])>e||Math.abs(z.current[1]-se[1])>e){const $=yne(G.current,E);let fe=!1;j&&(Array.isArray(h)?fe=h.map(Oe=>Oe.current):h!=="blending"&&(fe=[C]));const xe=Z.current;if(fe){const Oe=xne(G.current,E,P,fe);Z.current=Oe&&!$}else Z.current=!$;xe!==Z.current&&(d?d(!Z.current):F.style.display=Z.current?"block":"none");const Ie=Math.floor(g[0]/2),ge=h?j?[g[0],Ie]:[Ie-1,0]:g;if(F.style.zIndex=`${Sne(G.current,E,ge)}`,u){const[Oe,Me]=[N.width/2,N.height/2],Y=E.projectionMatrix.elements[5]*Me,{isOrthographicCamera:Q,top:de,left:Le,bottom:ie,right:K}=E,be=wne(E.matrixWorldInverse),Ue=Q?`scale(${Y})translate(${uC(-(K+Le)/2)}px,${uC((de+ie)/2)}px)`:`translateZ(${Y}px)`;let ve=G.current.matrixWorld;c&&(ve=E.matrixWorldInverse.clone().transpose().copyPosition(ve).scale(G.current.scale),ve.elements[3]=ve.elements[7]=ve.elements[11]=0,ve.elements[15]=1),F.style.width=N.width+"px",F.style.height=N.height+"px",F.style.perspective=Q?"":`${Y}px`,O.current&&D.current&&(O.current.style.transform=`${Ue}${be}translate(${Oe}px,${Me}px)`,D.current.style.transform=Mne(ve,1/((l||10)/400)))}else{const Oe=l===void 0?1:bne(G.current,E)*l;F.style.transform=`translate3d(${se[0]}px,${se[1]}px,0) scale(${Oe})`}z.current=se,U.current=E.zoom}}if(!j&&W.current&&!q.current)if(u){if(O.current){const se=O.current.children[0];if(se!=null&&se.clientWidth&&se!=null&&se.clientHeight){const{isOrthographicCamera:$}=E;if($||v)w.scale&&(Array.isArray(w.scale)?w.scale instanceof Te?W.current.scale.copy(w.scale.clone().divideScalar(1)):W.current.scale.set(1/w.scale[0],1/w.scale[1],1/w.scale[2]):W.current.scale.setScalar(1/w.scale));else{const fe=(l||10)/400,xe=se.clientWidth*fe,Ie=se.clientHeight*fe;W.current.scale.set(xe,Ie,1)}q.current=!0}}}else{const se=F.children[0];if(se!=null&&se.clientWidth&&se!=null&&se.clientHeight){const $=1/R.factor,fe=se.clientWidth*$,xe=se.clientHeight*$;W.current.scale.set(fe,xe,1),q.current=!0}W.current.lookAt(re.camera.position)}});const le=Re.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return Re.createElement("group",um({},w,{ref:G}),h&&!j&&Re.createElement("mesh",{castShadow:f,receiveShadow:p,ref:W},v||Re.createElement("planeGeometry",null),_||Re.createElement("shaderMaterial",{side:cr,vertexShader:le.vertexShader,fragmentShader:le.fragmentShader})))}),Ene=({page:i,position:e,isSelected:t,onSelect:n,onHover:r})=>{const s=Re.useRef(null),[o,a]=Re.useState(!1),l=o||t;no(()=>{if(s.current){s.current.scale.lerp(new Te(1,1,1).multiplyScalar(l?1.2:1),.1);const u=s.current.material;u.color.lerp(l?new It("#38bdf8"):new It("#0ea5e9"),.1),u.emissive.lerp(l?new It("#38bdf8"):new It("#0ea5e9"),.1)}});const c=i.Icon;return _e.jsxs("group",{position:e,children:[_e.jsxs("mesh",{ref:s,rotation:[Math.PI/2,0,0],onClick:u=>{u.stopPropagation(),n()},onPointerOver:u=>{u.stopPropagation(),a(!0),r()},onPointerOut:()=>a(!1),children:[_e.jsx("cylinderGeometry",{args:[.3,.3,.1,32]}),_e.jsx("meshStandardMaterial",{color:"#0ea5e9",emissive:"#0ea5e9",emissiveIntensity:l?.8:.4,toneMapped:!1})]}),_e.jsx(cu,{center:!0,position:[0,0,.06],children:_e.jsx("div",{className:"w-8 h-8 pointer-events-none",children:_e.jsx(c,{className:"w-full h-full text-white"})})}),_e.jsx(cne,{position:[0,-.45,0],fontSize:.15,color:"white",anchorX:"center",anchorY:"middle",children:i.menuLabel})]})},Tne=({onSelectPage:i,pageYOffset:e})=>{const{camera:t}=Ci(),n=Re.useRef(null),[r,s]=Re.useState(0),[o,a]=Re.useState(!1);Re.useEffect(()=>{a(!0)},[]);const l=Re.useCallback(h=>{h.preventDefault(),h.key.toLowerCase()==="e"||h.key==="ArrowRight"?s(d=>(d+1)%zh.length):h.key.toLowerCase()==="q"||h.key==="ArrowLeft"?s(d=>(d-1+zh.length)%zh.length):(h.key==="Enter"||h.key===" ")&&i(zh[r])},[i,r]);Re.useEffect(()=>(window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}),[l]);const c=1.2,u=Math.PI*2/zh.length;return no(()=>{if(n.current){const h=t.position.clone().add(t.getWorldDirection(new Te).multiplyScalar(3)),d=c+.5,f=Math.max(h.y,d);h.y=f+e,n.current.position.lerp(h,.1),n.current.quaternion.slerp(t.quaternion,.1);const p=o?1:0;n.current.scale.lerp(new Te(p,p,p),.1)}}),_e.jsxs("group",{ref:n,children:[_e.jsxs("mesh",{position:[0,0,-.1],children:[_e.jsx("ringGeometry",{args:[c*.9,c*.95,64]}),_e.jsx("meshBasicMaterial",{color:"#38bdf8",toneMapped:!1,transparent:!0,opacity:.5})]}),_e.jsxs("mesh",{position:[0,0,-.1],children:[_e.jsx("circleGeometry",{args:[c*1.4,64]}),_e.jsx("meshBasicMaterial",{color:"black",transparent:!0,opacity:.3})]}),zh.map((h,d)=>{const f=u*d-Math.PI/2,p=Math.cos(f)*c,_=Math.sin(f)*c;return _e.jsx(Ene,{page:h,position:[p,_,0],isSelected:d===r,onSelect:()=>i(h),onHover:()=>s(d)},h.id)})]})},hm=({title:i,breadcrumbs:e,children:t,onClose:n})=>_e.jsxs("div",{className:"relative w-full h-full bg-slate-900 bg-opacity-80 backdrop-blur-sm p-8 flex flex-col rounded-2xl border-4 border-sky-500/50 shadow-2xl shadow-sky-500/20",children:[n&&_e.jsx("button",{onClick:n,className:"absolute top-3 right-3 text-white bg-red-600 hover:bg-red-700 rounded-full p-1 transition-colors z-10","aria-label":"Close",children:_e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:_e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),_e.jsxs("div",{className:"flex-shrink-0 mb-4",children:[_e.jsx("div",{className:"text-sky-300 text-sm mb-2",children:e.map((r,s)=>_e.jsxs("span",{children:[r," ",s<e.length-1&&_e.jsx("span",{className:"mx-2",children:"/"})]},s))}),_e.jsx("h1",{className:"text-3xl font-bold text-white tracking-wider",children:i})]}),_e.jsx("div",{className:"flex-grow flex flex-col items-center justify-center relative",children:t})]}),Cne=({title:i,message:e,onClose:t})=>_e.jsx(hm,{title:i,breadcrumbs:["Home",i],onClose:t,children:_e.jsx("div",{className:"text-center",children:_e.jsx("p",{className:"text-2xl text-slate-300",children:e})})}),Pa=({children:i,className:e,variant:t="primary",size:n="md",...r})=>{const s="font-semibold rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900",o={primary:"bg-sky-500 hover:bg-sky-600 text-white focus:ring-sky-500",secondary:"bg-slate-600 hover:bg-slate-700 text-slate-100 focus:ring-slate-500"},a={md:"px-6 py-2 text-lg",sm:"px-3 py-1 text-base"},l=[s,o[t],a[n],e].join(" ");return _e.jsx("button",{className:l,...r,children:i})},hC=({className:i,...e})=>{const n=["bg-slate-700 border border-slate-600 text-white placeholder-slate-400 text-lg rounded-md focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5",i].join(" ");return _e.jsx("input",{className:n,...e})},Pne=[{id:"1",name:"James' Session"},{id:"2",name:"Class B8' Session"},{id:"3",name:"Class C4' Session"},{id:"4",name:"Class D9' Session"}],Rne=({onClose:i})=>{const[e,t]=Re.useState("main"),[n,r]=Re.useState(10),s=()=>r(c=>c+1),o=()=>r(c=>Math.max(1,c-1)),a=()=>{switch(e){case"create":return _e.jsxs("div",{className:"w-full max-w-sm flex flex-col items-center space-y-4",children:[_e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Create Session"}),_e.jsx(hC,{placeholder:"Name"}),_e.jsxs("div",{className:"w-full text-center",children:[_e.jsx("label",{className:"text-slate-300",children:"Number of Participants"}),_e.jsxs("div",{className:"flex items-center justify-center space-x-4 mt-2",children:[_e.jsx("button",{onClick:o,className:"px-4 py-2 bg-sky-600 hover:bg-sky-700 rounded-md text-xl font-bold",children:"-"}),_e.jsx("span",{className:"text-2xl font-bold w-16 text-center",children:n}),_e.jsx("button",{onClick:s,className:"px-4 py-2 bg-sky-600 hover:bg-sky-700 rounded-md text-xl font-bold",children:"+"})]})]}),_e.jsxs("div",{className:"flex space-x-4 pt-4",children:[_e.jsx(Pa,{onClick:()=>alert("Session Created!"),children:"Finish"}),_e.jsx(Pa,{onClick:()=>t("main"),variant:"secondary",children:"Cancel"})]})]});case"join":return _e.jsxs("div",{className:"w-full max-w-md flex flex-col items-center",children:[_e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Join Session"}),_e.jsx("div",{className:"w-full space-y-2 bg-slate-800/50 p-4 rounded-lg",children:Pne.map(c=>_e.jsxs("div",{className:"flex justify-between items-center p-2 rounded-md hover:bg-sky-900/50",children:[_e.jsx("span",{className:"text-lg",children:c.name}),_e.jsx(Pa,{onClick:()=>alert(`Joining ${c.name}`),size:"sm",children:"Enter"})]},c.id))}),_e.jsx("div",{className:"mt-6",children:_e.jsx(Pa,{onClick:()=>t("main"),variant:"secondary",children:"Cancel"})})]});case"main":default:return _e.jsxs("div",{className:"flex flex-col space-y-6 items-center",children:[_e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Multi-User Session"}),_e.jsxs("div",{className:"flex space-x-6",children:[_e.jsx(Pa,{onClick:()=>t("create"),children:"Create"}),_e.jsx(Pa,{onClick:()=>t("join"),children:"Join"})]})]})}},l=()=>{const c=["Home","Host/Join"];return e==="create"?[...c,"Create"]:e==="join"?[...c,"Join"]:c};return _e.jsx(hm,{title:"Host/Join Session",breadcrumbs:l(),onClose:i,children:a()})};/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const n3="158",Ine=0,jF=1,Lne=2,NG=1,Dne=2,Ql=3,Sc=0,Ls=1,ll=2,pc=0,mc=1,dC=2,XF=3,qF=4,Nne=5,Wh=100,Fne=101,kne=102,YF=103,KF=104,Une=200,One=201,Bne=202,zne=203,fC=204,pC=205,Gne=206,Vne=207,Hne=208,$ne=209,Wne=210,jne=211,Xne=212,qne=213,Yne=214,Kne=0,Zne=1,Qne=2,Mb=3,Jne=4,eie=5,tie=6,nie=7,FG=0,iie=1,rie=2,Iu=0,sie=1,oie=2,aie=3,lie=4,cie=5,kG=300,dm=301,fm=302,mC=303,gC=304,zS=306,vC=1e3,La=1001,_C=1002,ei=1003,ZF=1004,EM=1005,cs=1006,uie=1007,m1=1008,Ba=1009,hie=1010,die=1011,i3=1012,UG=1013,vu=1014,ka=1015,Rd=1016,OG=1017,BG=1018,dd=1020,fie=1021,Zs=1023,pie=1024,mie=1025,fd=1026,pm=1027,gie=1028,zG=1029,vie=1030,GG=1031,VG=1033,TM=33776,CM=33777,PM=33778,RM=33779,QF=35840,JF=35841,ek=35842,tk=35843,_ie=36196,nk=37492,ik=37496,rk=37808,sk=37809,ok=37810,ak=37811,lk=37812,ck=37813,uk=37814,hk=37815,dk=37816,fk=37817,pk=37818,mk=37819,gk=37820,vk=37821,IM=36492,_k=36494,yk=36495,yie=36283,xk=36284,bk=36285,Sk=36286,HG=3e3,pd=3001,xie=3200,bie=3201,Sie=0,wie=1,ea="",Hr="srgb",wc="srgb-linear",r3="display-p3",GS="display-p3-linear",Ab="linear",ai="srgb",Eb="rec709",Tb="p3",Nf=7680,wk=519,Mie=512,Aie=513,Eie=514,Tie=515,Cie=516,Pie=517,Rie=518,Iie=519,uu=35044,Ff=35048,Mk="300 es",yC=1035,uc=2e3,Cb=2001;class Im{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const ss=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Lx=Math.PI/180,xC=180/Math.PI;function $1(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ss[i&255]+ss[i>>8&255]+ss[i>>16&255]+ss[i>>24&255]+"-"+ss[e&255]+ss[e>>8&255]+"-"+ss[e>>16&15|64]+ss[e>>24&255]+"-"+ss[t&63|128]+ss[t>>8&255]+"-"+ss[t>>16&255]+ss[t>>24&255]+ss[n&255]+ss[n>>8&255]+ss[n>>16&255]+ss[n>>24&255]).toLowerCase()}function qs(i,e,t){return Math.max(e,Math.min(t,i))}function Lie(i,e){return(i%e+e)%e}function LM(i,e,t){return(1-t)*i+t*e}function Ak(i){return(i&i-1)===0&&i!==0}function bC(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function Lg(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Hs(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}class on{constructor(e=0,t=0){on.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(qs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class vn{constructor(e,t,n,r,s,o,a,l,c){vn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c)}set(e,t,n,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],u=n[4],h=n[7],d=n[2],f=n[5],p=n[8],_=r[0],v=r[3],g=r[6],b=r[1],m=r[4],y=r[7],A=r[2],w=r[5],M=r[8];return s[0]=o*_+a*b+l*A,s[3]=o*v+a*m+l*w,s[6]=o*g+a*y+l*M,s[1]=c*_+u*b+h*A,s[4]=c*v+u*m+h*w,s[7]=c*g+u*y+h*M,s[2]=d*_+f*b+p*A,s[5]=d*v+f*m+p*w,s[8]=d*g+f*y+p*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-n*s*u+n*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,d=a*l-u*s,f=c*s-o*l,p=t*h+n*d+r*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/p;return e[0]=h*_,e[1]=(r*c-u*n)*_,e[2]=(a*n-r*o)*_,e[3]=d*_,e[4]=(u*t-r*l)*_,e[5]=(r*s-a*t)*_,e[6]=f*_,e[7]=(n*l-c*t)*_,e[8]=(o*t-n*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(DM.makeScale(e,t)),this}rotate(e){return this.premultiply(DM.makeRotation(-e)),this}translate(e,t){return this.premultiply(DM.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const DM=new vn;function $G(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function Pb(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function Die(){const i=Pb("canvas");return i.style.display="block",i}const Ek={};function T0(i){i in Ek||(Ek[i]=!0,console.warn(i))}const Tk=new vn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Ck=new vn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),oy={[wc]:{transfer:Ab,primaries:Eb,toReference:i=>i,fromReference:i=>i},[Hr]:{transfer:ai,primaries:Eb,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[GS]:{transfer:Ab,primaries:Tb,toReference:i=>i.applyMatrix3(Ck),fromReference:i=>i.applyMatrix3(Tk)},[r3]:{transfer:ai,primaries:Tb,toReference:i=>i.convertSRGBToLinear().applyMatrix3(Ck),fromReference:i=>i.applyMatrix3(Tk).convertLinearToSRGB()}},Nie=new Set([wc,GS]),Kn={enabled:!0,_workingColorSpace:wc,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(i){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!i},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!Nie.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const n=oy[e].toReference,r=oy[t].fromReference;return r(n(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this._workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this._workingColorSpace)},getPrimaries:function(i){return oy[i].primaries},getTransfer:function(i){return i===ea?Ab:oy[i].transfer}};function Gp(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function NM(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let kf;class WG{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{kf===void 0&&(kf=Pb("canvas")),kf.width=e.width,kf.height=e.height;const n=kf.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=kf}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Pb("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Gp(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Gp(t[n]/255)*255):t[n]=Gp(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Fie=0;class jG{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Fie++}),this.uuid=$1(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(FM(r[o].image)):s.push(FM(r[o]))}else s=FM(r);n.url=s}return t||(e.images[this.uuid]=n),n}}function FM(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?WG.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let kie=0;class Ds extends Im{constructor(e=Ds.DEFAULT_IMAGE,t=Ds.DEFAULT_MAPPING,n=La,r=La,s=cs,o=m1,a=Zs,l=Ba,c=Ds.DEFAULT_ANISOTROPY,u=ea){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kie++}),this.uuid=$1(),this.name="",this.source=new jG(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new on(0,0),this.repeat=new on(1,1),this.center=new on(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new vn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(T0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===pd?Hr:ea),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==kG)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case vC:e.x=e.x-Math.floor(e.x);break;case La:e.x=e.x<0?0:1;break;case _C:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case vC:e.y=e.y-Math.floor(e.y);break;case La:e.y=e.y<0?0:1;break;case _C:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return T0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Hr?pd:HG}set encoding(e){T0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===pd?Hr:ea}}Ds.DEFAULT_IMAGE=null;Ds.DEFAULT_MAPPING=kG;Ds.DEFAULT_ANISOTROPY=1;class Nr{constructor(e=0,t=0,n=0,r=1){Nr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],f=l[5],p=l[9],_=l[2],v=l[6],g=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-_)<.01&&Math.abs(p-v)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+_)<.1&&Math.abs(p+v)<.1&&Math.abs(c+f+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const m=(c+1)/2,y=(f+1)/2,A=(g+1)/2,w=(u+d)/4,M=(h+_)/4,T=(p+v)/4;return m>y&&m>A?m<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(m),r=w/n,s=M/n):y>A?y<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(y),n=w/r,s=T/r):A<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(A),n=M/s,r=T/s),this.set(n,r,s,t),this}let b=Math.sqrt((v-p)*(v-p)+(h-_)*(h-_)+(d-u)*(d-u));return Math.abs(b)<.001&&(b=1),this.x=(v-p)/b,this.y=(h-_)/b,this.z=(d-u)/b,this.w=Math.acos((c+f+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Uie extends Im{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Nr(0,0,e,t),this.scissorTest=!1,this.viewport=new Nr(0,0,e,t);const r={width:e,height:t,depth:1};n.encoding!==void 0&&(T0("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===pd?Hr:ea),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:cs,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Ds(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new jG(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class vl extends Uie{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class XG extends Ds{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=ei,this.minFilter=ei,this.wrapR=La,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Oie extends Ds{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=ei,this.minFilter=ei,this.wrapR=La,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ns{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,a){let l=n[r+0],c=n[r+1],u=n[r+2],h=n[r+3];const d=s[o+0],f=s[o+1],p=s[o+2],_=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=d,e[t+1]=f,e[t+2]=p,e[t+3]=_;return}if(h!==_||l!==d||c!==f||u!==p){let v=1-a;const g=l*d+c*f+u*p+h*_,b=g>=0?1:-1,m=1-g*g;if(m>Number.EPSILON){const A=Math.sqrt(m),w=Math.atan2(A,g*b);v=Math.sin(v*w)/A,a=Math.sin(a*w)/A}const y=a*b;if(l=l*v+d*y,c=c*v+f*y,u=u*v+p*y,h=h*v+_*y,v===1-a){const A=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=A,c*=A,u*=A,h*=A}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],l=n[r+1],c=n[r+2],u=n[r+3],h=s[o],d=s[o+1],f=s[o+2],p=s[o+3];return e[t]=a*p+u*h+l*f-c*d,e[t+1]=l*p+u*d+c*h-a*f,e[t+2]=c*p+u*f+a*d-l*h,e[t+3]=u*p-a*h-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(r/2),h=a(s/2),d=l(n/2),f=l(r/2),p=l(s/2);switch(o){case"XYZ":this._x=d*u*h+c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h-d*f*p;break;case"YXZ":this._x=d*u*h+c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h+d*f*p;break;case"ZXY":this._x=d*u*h-c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h-d*f*p;break;case"ZYX":this._x=d*u*h-c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h+d*f*p;break;case"YZX":this._x=d*u*h+c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h-d*f*p;break;case"XZY":this._x=d*u*h-c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],d=n+a+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(o-r)*f}else if(n>a&&n>h){const f=2*Math.sqrt(1+n-a-h);this._w=(u-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+c)/f}else if(a>h){const f=2*Math.sqrt(1+a-n-h);this._w=(s-c)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-n-a);this._w=(o-r)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(qs(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-n*c,this._z=s*u+o*c+n*l-r*a,this._w=o*u-n*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*n+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=o*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(s),n*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class me{constructor(e=0,t=0,n=0){me.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Pk.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Pk.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*n),u=2*(a*t-s*r),h=2*(s*n-o*t);return this.x=t+l*c+o*h-a*u,this.y=n+l*u+a*c-s*h,this.z=r+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return kM.copy(this).projectOnVector(e),this.sub(kM)}reflect(e){return this.sub(kM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(qs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const kM=new me,Pk=new Ns;class Li{constructor(e=new me(1/0,1/0,1/0),t=new me(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(ga.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(ga.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ga.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,ga):ga.fromBufferAttribute(s,o),ga.applyMatrix4(e.matrixWorld),this.expandByPoint(ga);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),ay.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),ay.copy(n.boundingBox)),ay.applyMatrix4(e.matrixWorld),this.union(ay)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ga),ga.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Dg),ly.subVectors(this.max,Dg),Uf.subVectors(e.a,Dg),Of.subVectors(e.b,Dg),Bf.subVectors(e.c,Dg),Kc.subVectors(Of,Uf),Zc.subVectors(Bf,Of),Th.subVectors(Uf,Bf);let t=[0,-Kc.z,Kc.y,0,-Zc.z,Zc.y,0,-Th.z,Th.y,Kc.z,0,-Kc.x,Zc.z,0,-Zc.x,Th.z,0,-Th.x,-Kc.y,Kc.x,0,-Zc.y,Zc.x,0,-Th.y,Th.x,0];return!UM(t,Uf,Of,Bf,ly)||(t=[1,0,0,0,1,0,0,0,1],!UM(t,Uf,Of,Bf,ly))?!1:(cy.crossVectors(Kc,Zc),t=[cy.x,cy.y,cy.z],UM(t,Uf,Of,Bf,ly))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ga).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ga).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Vl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Vl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Vl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Vl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Vl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Vl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Vl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Vl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Vl),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Vl=[new me,new me,new me,new me,new me,new me,new me,new me],ga=new me,ay=new Li,Uf=new me,Of=new me,Bf=new me,Kc=new me,Zc=new me,Th=new me,Dg=new me,ly=new me,cy=new me,Ch=new me;function UM(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){Ch.fromArray(i,s);const a=r.x*Math.abs(Ch.x)+r.y*Math.abs(Ch.y)+r.z*Math.abs(Ch.z),l=e.dot(Ch),c=t.dot(Ch),u=n.dot(Ch);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const Bie=new Li,Ng=new me,OM=new me;class W1{constructor(e=new me,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):Bie.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ng.subVectors(e,this.center);const t=Ng.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(Ng,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(OM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ng.copy(e.center).add(OM)),this.expandByPoint(Ng.copy(e.center).sub(OM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Hl=new me,BM=new me,uy=new me,Qc=new me,zM=new me,hy=new me,GM=new me;class s3{constructor(e=new me,t=new me(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Hl)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Hl.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Hl.copy(this.origin).addScaledVector(this.direction,t),Hl.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){BM.copy(e).add(t).multiplyScalar(.5),uy.copy(t).sub(e).normalize(),Qc.copy(this.origin).sub(BM);const s=e.distanceTo(t)*.5,o=-this.direction.dot(uy),a=Qc.dot(this.direction),l=-Qc.dot(uy),c=Qc.lengthSq(),u=Math.abs(1-o*o);let h,d,f,p;if(u>0)if(h=o*l-a,d=o*a-l,p=s*u,h>=0)if(d>=-p)if(d<=p){const _=1/u;h*=_,d*=_,f=h*(h+o*d+2*a)+d*(o*h+d+2*l)+c}else d=s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d<=-p?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c):d<=p?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(BM).addScaledVector(uy,d),f}intersectSphere(e,t){Hl.subVectors(e.center,this.origin);const n=Hl.dot(this.direction),r=Hl.dot(Hl)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(n=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(n=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),u>=0?(s=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,Hl)!==null}intersectTriangle(e,t,n,r,s){zM.subVectors(t,e),hy.subVectors(n,e),GM.crossVectors(zM,hy);let o=this.direction.dot(GM),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Qc.subVectors(this.origin,e);const l=a*this.direction.dot(hy.crossVectors(Qc,hy));if(l<0)return null;const c=a*this.direction.dot(zM.cross(Qc));if(c<0||l+c>o)return null;const u=-a*Qc.dot(GM);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ct{constructor(e,t,n,r,s,o,a,l,c,u,h,d,f,p,_,v){Ct.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c,u,h,d,f,p,_,v)}set(e,t,n,r,s,o,a,l,c,u,h,d,f,p,_,v){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=s,g[5]=o,g[9]=a,g[13]=l,g[2]=c,g[6]=u,g[10]=h,g[14]=d,g[3]=f,g[7]=p,g[11]=_,g[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ct().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/zf.setFromMatrixColumn(e,0).length(),s=1/zf.setFromMatrixColumn(e,1).length(),o=1/zf.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*u,f=o*h,p=a*u,_=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=f+p*c,t[5]=d-_*c,t[9]=-a*l,t[2]=_-d*c,t[6]=p+f*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*u,f=l*h,p=c*u,_=c*h;t[0]=d+_*a,t[4]=p*a-f,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=f*a-p,t[6]=_+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*u,f=l*h,p=c*u,_=c*h;t[0]=d-_*a,t[4]=-o*h,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*u,t[9]=_-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*u,f=o*h,p=a*u,_=a*h;t[0]=l*u,t[4]=p*c-f,t[8]=d*c+_,t[1]=l*h,t[5]=_*c+d,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,f=o*c,p=a*l,_=a*c;t[0]=l*u,t[4]=_-d*h,t[8]=p*h+f,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*h+p,t[10]=d-_*h}else if(e.order==="XZY"){const d=o*l,f=o*c,p=a*l,_=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=d*h+_,t[5]=o*u,t[9]=f*h-p,t[2]=p*h-f,t[6]=a*u,t[10]=_*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(zie,e,Gie)}lookAt(e,t,n){const r=this.elements;return yo.subVectors(e,t),yo.lengthSq()===0&&(yo.z=1),yo.normalize(),Jc.crossVectors(n,yo),Jc.lengthSq()===0&&(Math.abs(n.z)===1?yo.x+=1e-4:yo.z+=1e-4,yo.normalize(),Jc.crossVectors(n,yo)),Jc.normalize(),dy.crossVectors(yo,Jc),r[0]=Jc.x,r[4]=dy.x,r[8]=yo.x,r[1]=Jc.y,r[5]=dy.y,r[9]=yo.y,r[2]=Jc.z,r[6]=dy.z,r[10]=yo.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],u=n[1],h=n[5],d=n[9],f=n[13],p=n[2],_=n[6],v=n[10],g=n[14],b=n[3],m=n[7],y=n[11],A=n[15],w=r[0],M=r[4],T=r[8],E=r[12],C=r[1],N=r[5],P=r[9],L=r[13],R=r[2],F=r[6],V=r[10],G=r[14],U=r[3],z=r[7],O=r[11],D=r[15];return s[0]=o*w+a*C+l*R+c*U,s[4]=o*M+a*N+l*F+c*z,s[8]=o*T+a*P+l*V+c*O,s[12]=o*E+a*L+l*G+c*D,s[1]=u*w+h*C+d*R+f*U,s[5]=u*M+h*N+d*F+f*z,s[9]=u*T+h*P+d*V+f*O,s[13]=u*E+h*L+d*G+f*D,s[2]=p*w+_*C+v*R+g*U,s[6]=p*M+_*N+v*F+g*z,s[10]=p*T+_*P+v*V+g*O,s[14]=p*E+_*L+v*G+g*D,s[3]=b*w+m*C+y*R+A*U,s[7]=b*M+m*N+y*F+A*z,s[11]=b*T+m*P+y*V+A*O,s[15]=b*E+m*L+y*G+A*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],f=e[14],p=e[3],_=e[7],v=e[11],g=e[15];return p*(+s*l*h-r*c*h-s*a*d+n*c*d+r*a*f-n*l*f)+_*(+t*l*f-t*c*d+s*o*d-r*o*f+r*c*u-s*l*u)+v*(+t*c*h-t*a*f-s*o*h+n*o*f+s*a*u-n*c*u)+g*(-r*a*u-t*l*h+t*a*d+r*o*h-n*o*d+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],_=e[13],v=e[14],g=e[15],b=h*v*c-_*d*c+_*l*f-a*v*f-h*l*g+a*d*g,m=p*d*c-u*v*c-p*l*f+o*v*f+u*l*g-o*d*g,y=u*_*c-p*h*c+p*a*f-o*_*f-u*a*g+o*h*g,A=p*h*l-u*_*l-p*a*d+o*_*d+u*a*v-o*h*v,w=t*b+n*m+r*y+s*A;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/w;return e[0]=b*M,e[1]=(_*d*s-h*v*s-_*r*f+n*v*f+h*r*g-n*d*g)*M,e[2]=(a*v*s-_*l*s+_*r*c-n*v*c-a*r*g+n*l*g)*M,e[3]=(h*l*s-a*d*s-h*r*c+n*d*c+a*r*f-n*l*f)*M,e[4]=m*M,e[5]=(u*v*s-p*d*s+p*r*f-t*v*f-u*r*g+t*d*g)*M,e[6]=(p*l*s-o*v*s-p*r*c+t*v*c+o*r*g-t*l*g)*M,e[7]=(o*d*s-u*l*s+u*r*c-t*d*c-o*r*f+t*l*f)*M,e[8]=y*M,e[9]=(p*h*s-u*_*s-p*n*f+t*_*f+u*n*g-t*h*g)*M,e[10]=(o*_*s-p*a*s+p*n*c-t*_*c-o*n*g+t*a*g)*M,e[11]=(u*a*s-o*h*s-u*n*c+t*h*c+o*n*f-t*a*f)*M,e[12]=A*M,e[13]=(u*_*r-p*h*r+p*n*d-t*_*d-u*n*v+t*h*v)*M,e[14]=(p*a*r-o*_*r-p*n*l+t*_*l+o*n*v-t*a*v)*M,e[15]=(o*h*r-u*a*r+u*n*l-t*h*l-o*n*d+t*a*d)*M,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+n,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+n,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,h=a+a,d=s*c,f=s*u,p=s*h,_=o*u,v=o*h,g=a*h,b=l*c,m=l*u,y=l*h,A=n.x,w=n.y,M=n.z;return r[0]=(1-(_+g))*A,r[1]=(f+y)*A,r[2]=(p-m)*A,r[3]=0,r[4]=(f-y)*w,r[5]=(1-(d+g))*w,r[6]=(v+b)*w,r[7]=0,r[8]=(p+m)*M,r[9]=(v-b)*M,r[10]=(1-(d+_))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=zf.set(r[0],r[1],r[2]).length();const o=zf.set(r[4],r[5],r[6]).length(),a=zf.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],va.copy(this);const c=1/s,u=1/o,h=1/a;return va.elements[0]*=c,va.elements[1]*=c,va.elements[2]*=c,va.elements[4]*=u,va.elements[5]*=u,va.elements[6]*=u,va.elements[8]*=h,va.elements[9]*=h,va.elements[10]*=h,t.setFromRotationMatrix(va),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o,a=uc){const l=this.elements,c=2*s/(t-e),u=2*s/(n-r),h=(t+e)/(t-e),d=(n+r)/(n-r);let f,p;if(a===uc)f=-(o+s)/(o-s),p=-2*o*s/(o-s);else if(a===Cb)f=-o/(o-s),p=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,s,o,a=uc){const l=this.elements,c=1/(t-e),u=1/(n-r),h=1/(o-s),d=(t+e)*c,f=(n+r)*u;let p,_;if(a===uc)p=(o+s)*h,_=-2*h;else if(a===Cb)p=s*h,_=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=_,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const zf=new me,va=new Ct,zie=new me(0,0,0),Gie=new me(1,1,1),Jc=new me,dy=new me,yo=new me,Rk=new Ct,Ik=new Ns;class mm{constructor(e=0,t=0,n=0,r=mm.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(qs(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-qs(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(qs(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-qs(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(qs(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-qs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Rk.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Rk,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ik.setFromEuler(this),this.setFromQuaternion(Ik,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}mm.DEFAULT_ORDER="XYZ";class qG{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Vie=0;const Lk=new me,Gf=new Ns,$l=new Ct,fy=new me,Fg=new me,Hie=new me,$ie=new Ns,Dk=new me(1,0,0),Nk=new me(0,1,0),Fk=new me(0,0,1),Wie={type:"added"},jie={type:"removed"};class Or extends Im{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Vie++}),this.uuid=$1(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Or.DEFAULT_UP.clone();const e=new me,t=new mm,n=new Ns,r=new me(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ct},normalMatrix:{value:new vn}}),this.matrix=new Ct,this.matrixWorld=new Ct,this.matrixAutoUpdate=Or.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Or.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new qG,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Gf.setFromAxisAngle(e,t),this.quaternion.multiply(Gf),this}rotateOnWorldAxis(e,t){return Gf.setFromAxisAngle(e,t),this.quaternion.premultiply(Gf),this}rotateX(e){return this.rotateOnAxis(Dk,e)}rotateY(e){return this.rotateOnAxis(Nk,e)}rotateZ(e){return this.rotateOnAxis(Fk,e)}translateOnAxis(e,t){return Lk.copy(e).applyQuaternion(this.quaternion),this.position.add(Lk.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Dk,e)}translateY(e){return this.translateOnAxis(Nk,e)}translateZ(e){return this.translateOnAxis(Fk,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4($l.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?fy.copy(e):fy.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Fg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$l.lookAt(Fg,fy,this.up):$l.lookAt(fy,Fg,this.up),this.quaternion.setFromRotationMatrix($l),r&&($l.extractRotation(r.matrixWorld),Gf.setFromRotationMatrix($l),this.quaternion.premultiply(Gf.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Wie)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(jie)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),$l.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),$l.multiply(e.parent.matrixWorld)),e.applyMatrix4($l),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r].getObjectsByProperty(e,t);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fg,e,Hie),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fg,$ie,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const s=t[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),d=o(e.skeletons),f=o(e.animations),p=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),h.length>0&&(n.shapes=h),d.length>0&&(n.skeletons=d),f.length>0&&(n.animations=f),p.length>0&&(n.nodes=p)}return n.object=r,n;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}Or.DEFAULT_UP=new me(0,1,0);Or.DEFAULT_MATRIX_AUTO_UPDATE=!0;Or.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _a=new me,Wl=new me,VM=new me,jl=new me,Vf=new me,Hf=new me,kk=new me,HM=new me,$M=new me,WM=new me;let py=!1;class Ra{constructor(e=new me,t=new me,n=new me){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),_a.subVectors(e,t),r.cross(_a);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){_a.subVectors(r,t),Wl.subVectors(n,t),VM.subVectors(e,t);const o=_a.dot(_a),a=_a.dot(Wl),l=_a.dot(VM),c=Wl.dot(Wl),u=Wl.dot(VM),h=o*c-a*a;if(h===0)return s.set(-2,-1,-1);const d=1/h,f=(c*l-a*u)*d,p=(o*u-a*l)*d;return s.set(1-f-p,p,f)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,jl),jl.x>=0&&jl.y>=0&&jl.x+jl.y<=1}static getUV(e,t,n,r,s,o,a,l){return py===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),py=!0),this.getInterpolation(e,t,n,r,s,o,a,l)}static getInterpolation(e,t,n,r,s,o,a,l){return this.getBarycoord(e,t,n,r,jl),l.setScalar(0),l.addScaledVector(s,jl.x),l.addScaledVector(o,jl.y),l.addScaledVector(a,jl.z),l}static isFrontFacing(e,t,n,r){return _a.subVectors(n,t),Wl.subVectors(e,t),_a.cross(Wl).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _a.subVectors(this.c,this.b),Wl.subVectors(this.a,this.b),_a.cross(Wl).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ra.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ra.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,s){return py===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),py=!0),Ra.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}getInterpolation(e,t,n,r,s){return Ra.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return Ra.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ra.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;Vf.subVectors(r,n),Hf.subVectors(s,n),HM.subVectors(e,n);const l=Vf.dot(HM),c=Hf.dot(HM);if(l<=0&&c<=0)return t.copy(n);$M.subVectors(e,r);const u=Vf.dot($M),h=Hf.dot($M);if(u>=0&&h<=u)return t.copy(r);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(Vf,o);WM.subVectors(e,s);const f=Vf.dot(WM),p=Hf.dot(WM);if(p>=0&&f<=p)return t.copy(s);const _=f*c-l*p;if(_<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(n).addScaledVector(Hf,a);const v=u*p-f*h;if(v<=0&&h-u>=0&&f-p>=0)return kk.subVectors(s,r),a=(h-u)/(h-u+(f-p)),t.copy(r).addScaledVector(kk,a);const g=1/(v+_+d);return o=_*g,a=d*g,t.copy(n).addScaledVector(Vf,o).addScaledVector(Hf,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const YG={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},eu={h:0,s:0,l:0},my={h:0,s:0,l:0};function jM(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class $t{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Hr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Kn.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=Kn.workingColorSpace){return this.r=e,this.g=t,this.b=n,Kn.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=Kn.workingColorSpace){if(e=Lie(e,1),t=qs(t,0,1),n=qs(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=jM(o,s,e+1/3),this.g=jM(o,s,e),this.b=jM(o,s,e-1/3)}return Kn.toWorkingColorSpace(this,r),this}setStyle(e,t=Hr){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Hr){const n=YG[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Gp(e.r),this.g=Gp(e.g),this.b=Gp(e.b),this}copyLinearToSRGB(e){return this.r=NM(e.r),this.g=NM(e.g),this.b=NM(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Hr){return Kn.fromWorkingColorSpace(os.copy(this),e),Math.round(qs(os.r*255,0,255))*65536+Math.round(qs(os.g*255,0,255))*256+Math.round(qs(os.b*255,0,255))}getHexString(e=Hr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Kn.workingColorSpace){Kn.fromWorkingColorSpace(os.copy(this),t);const n=os.r,r=os.g,s=os.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case n:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-n)/h+2;break;case s:l=(n-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Kn.workingColorSpace){return Kn.fromWorkingColorSpace(os.copy(this),t),e.r=os.r,e.g=os.g,e.b=os.b,e}getStyle(e=Hr){Kn.fromWorkingColorSpace(os.copy(this),e);const t=os.r,n=os.g,r=os.b;return e!==Hr?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(eu),this.setHSL(eu.h+e,eu.s+t,eu.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(eu),e.getHSL(my);const n=LM(eu.h,my.h,t),r=LM(eu.s,my.s,t),s=LM(eu.l,my.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const os=new $t;$t.NAMES=YG;let Xie=0;class Lm extends Im{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Xie++}),this.uuid=$1(),this.name="",this.type="Material",this.blending=mc,this.side=Sc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=fC,this.blendDst=pC,this.blendEquation=Wh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new $t(0,0,0),this.blendAlpha=0,this.depthFunc=Mb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=wk,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Nf,this.stencilZFail=Nf,this.stencilZPass=Nf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==mc&&(n.blending=this.blending),this.side!==Sc&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==fC&&(n.blendSrc=this.blendSrc),this.blendDst!==pC&&(n.blendDst=this.blendDst),this.blendEquation!==Wh&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Mb&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==wk&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Nf&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Nf&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Nf&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class KG extends Lm{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new $t(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=FG,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const sr=new me,gy=new on;class Qi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=uu,this.updateRange={offset:0,count:-1},this.gpuType=ka,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)gy.fromBufferAttribute(this,t),gy.applyMatrix3(e),this.setXY(t,gy.x,gy.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)sr.fromBufferAttribute(this,t),sr.applyMatrix3(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)sr.fromBufferAttribute(this,t),sr.applyMatrix4(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)sr.fromBufferAttribute(this,t),sr.applyNormalMatrix(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)sr.fromBufferAttribute(this,t),sr.transformDirection(e),this.setXYZ(t,sr.x,sr.y,sr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Lg(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Hs(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Lg(t,this.array)),t}setX(e,t){return this.normalized&&(t=Hs(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Lg(t,this.array)),t}setY(e,t){return this.normalized&&(t=Hs(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Lg(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Hs(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Lg(t,this.array)),t}setW(e,t){return this.normalized&&(t=Hs(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Hs(t,this.array),n=Hs(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Hs(t,this.array),n=Hs(n,this.array),r=Hs(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Hs(t,this.array),n=Hs(n,this.array),r=Hs(r,this.array),s=Hs(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==uu&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class ZG extends Qi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class QG extends Qi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class ui extends Qi{constructor(e,t,n){super(new Float32Array(e),t,n)}}let qie=0;const Wo=new Ct,XM=new Or,$f=new me,xo=new Li,kg=new Li,Ir=new me;class hr extends Im{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:qie++}),this.uuid=$1(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new($G(e)?QG:ZG)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new vn().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Wo.makeRotationFromQuaternion(e),this.applyMatrix4(Wo),this}rotateX(e){return Wo.makeRotationX(e),this.applyMatrix4(Wo),this}rotateY(e){return Wo.makeRotationY(e),this.applyMatrix4(Wo),this}rotateZ(e){return Wo.makeRotationZ(e),this.applyMatrix4(Wo),this}translate(e,t,n){return Wo.makeTranslation(e,t,n),this.applyMatrix4(Wo),this}scale(e,t,n){return Wo.makeScale(e,t,n),this.applyMatrix4(Wo),this}lookAt(e){return XM.lookAt(e),XM.updateMatrix(),this.applyMatrix4(XM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter($f).negate(),this.translate($f.x,$f.y,$f.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ui(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Li);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new me(-1/0,-1/0,-1/0),new me(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];xo.setFromBufferAttribute(s),this.morphTargetsRelative?(Ir.addVectors(this.boundingBox.min,xo.min),this.boundingBox.expandByPoint(Ir),Ir.addVectors(this.boundingBox.max,xo.max),this.boundingBox.expandByPoint(Ir)):(this.boundingBox.expandByPoint(xo.min),this.boundingBox.expandByPoint(xo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new W1);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new me,1/0);return}if(e){const n=this.boundingSphere.center;if(xo.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];kg.setFromBufferAttribute(a),this.morphTargetsRelative?(Ir.addVectors(xo.min,kg.min),xo.expandByPoint(Ir),Ir.addVectors(xo.max,kg.max),xo.expandByPoint(Ir)):(xo.expandByPoint(kg.min),xo.expandByPoint(kg.max))}xo.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)Ir.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(Ir));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Ir.fromBufferAttribute(a,c),l&&($f.fromBufferAttribute(e,c),Ir.add($f)),r=Math.max(r,n.distanceToSquared(Ir))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Qi(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let C=0;C<a;C++)c[C]=new me,u[C]=new me;const h=new me,d=new me,f=new me,p=new on,_=new on,v=new on,g=new me,b=new me;function m(C,N,P){h.fromArray(r,C*3),d.fromArray(r,N*3),f.fromArray(r,P*3),p.fromArray(o,C*2),_.fromArray(o,N*2),v.fromArray(o,P*2),d.sub(h),f.sub(h),_.sub(p),v.sub(p);const L=1/(_.x*v.y-v.x*_.y);isFinite(L)&&(g.copy(d).multiplyScalar(v.y).addScaledVector(f,-_.y).multiplyScalar(L),b.copy(f).multiplyScalar(_.x).addScaledVector(d,-v.x).multiplyScalar(L),c[C].add(g),c[N].add(g),c[P].add(g),u[C].add(b),u[N].add(b),u[P].add(b))}let y=this.groups;y.length===0&&(y=[{start:0,count:n.length}]);for(let C=0,N=y.length;C<N;++C){const P=y[C],L=P.start,R=P.count;for(let F=L,V=L+R;F<V;F+=3)m(n[F+0],n[F+1],n[F+2])}const A=new me,w=new me,M=new me,T=new me;function E(C){M.fromArray(s,C*3),T.copy(M);const N=c[C];A.copy(N),A.sub(M.multiplyScalar(M.dot(N))).normalize(),w.crossVectors(T,N);const L=w.dot(u[C])<0?-1:1;l[C*4]=A.x,l[C*4+1]=A.y,l[C*4+2]=A.z,l[C*4+3]=L}for(let C=0,N=y.length;C<N;++C){const P=y[C],L=P.start,R=P.count;for(let F=L,V=L+R;F<V;F+=3)E(n[F+0]),E(n[F+1]),E(n[F+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Qi(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let d=0,f=n.count;d<f;d++)n.setXYZ(d,0,0,0);const r=new me,s=new me,o=new me,a=new me,l=new me,c=new me,u=new me,h=new me;if(e)for(let d=0,f=e.count;d<f;d+=3){const p=e.getX(d+0),_=e.getX(d+1),v=e.getX(d+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,v),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,_),c.fromBufferAttribute(n,v),a.add(u),l.add(u),c.add(u),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(_,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let d=0,f=t.count;d<f;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),n.setXYZ(d+0,u.x,u.y,u.z),n.setXYZ(d+1,u.x,u.y,u.z),n.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ir.fromBufferAttribute(e,t),Ir.normalize(),e.setXYZ(t,Ir.x,Ir.y,Ir.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,d=new c.constructor(l.length*u);let f=0,p=0;for(let _=0,v=l.length;_<v;_++){a.isInterleavedBufferAttribute?f=l[_]*a.data.stride+a.offset:f=l[_]*u;for(let g=0;g<u;g++)d[p++]=c[f++]}return new Qi(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new hr,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,n);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const d=c[u],f=e(d,n);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h];u.push(f.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Uk=new Ct,Ph=new s3,vy=new W1,Ok=new me,Wf=new me,jf=new me,Xf=new me,qM=new me,_y=new me,yy=new on,xy=new on,by=new on,Bk=new me,zk=new me,Gk=new me,Sy=new me,wy=new me;class hl extends Or{constructor(e=new hr,t=new KG){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){_y.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],h=s[l];u!==0&&(qM.fromBufferAttribute(h,e),o?_y.addScaledVector(qM,u):_y.addScaledVector(qM.sub(t),u))}t.add(_y)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),vy.copy(n.boundingSphere),vy.applyMatrix4(s),Ph.copy(e.ray).recast(e.near),!(vy.containsPoint(Ph.origin)===!1&&(Ph.intersectSphere(vy,Ok)===null||Ph.origin.distanceToSquared(Ok)>(e.far-e.near)**2))&&(Uk.copy(s).invert(),Ph.copy(e.ray).applyMatrix4(Uk),!(n.boundingBox!==null&&Ph.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Ph)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,_=d.length;p<_;p++){const v=d[p],g=o[v.materialIndex],b=Math.max(v.start,f.start),m=Math.min(a.count,Math.min(v.start+v.count,f.start+f.count));for(let y=b,A=m;y<A;y+=3){const w=a.getX(y),M=a.getX(y+1),T=a.getX(y+2);r=My(this,g,e,n,c,u,h,w,M,T),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=v.materialIndex,t.push(r))}}else{const p=Math.max(0,f.start),_=Math.min(a.count,f.start+f.count);for(let v=p,g=_;v<g;v+=3){const b=a.getX(v),m=a.getX(v+1),y=a.getX(v+2);r=My(this,o,e,n,c,u,h,b,m,y),r&&(r.faceIndex=Math.floor(v/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let p=0,_=d.length;p<_;p++){const v=d[p],g=o[v.materialIndex],b=Math.max(v.start,f.start),m=Math.min(l.count,Math.min(v.start+v.count,f.start+f.count));for(let y=b,A=m;y<A;y+=3){const w=y,M=y+1,T=y+2;r=My(this,g,e,n,c,u,h,w,M,T),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=v.materialIndex,t.push(r))}}else{const p=Math.max(0,f.start),_=Math.min(l.count,f.start+f.count);for(let v=p,g=_;v<g;v+=3){const b=v,m=v+1,y=v+2;r=My(this,o,e,n,c,u,h,b,m,y),r&&(r.faceIndex=Math.floor(v/3),t.push(r))}}}}function Yie(i,e,t,n,r,s,o,a){let l;if(e.side===Ls?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,e.side===Sc,a),l===null)return null;wy.copy(a),wy.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(wy);return c<t.near||c>t.far?null:{distance:c,point:wy.clone(),object:i}}function My(i,e,t,n,r,s,o,a,l,c){i.getVertexPosition(a,Wf),i.getVertexPosition(l,jf),i.getVertexPosition(c,Xf);const u=Yie(i,e,t,n,Wf,jf,Xf,Sy);if(u){r&&(yy.fromBufferAttribute(r,a),xy.fromBufferAttribute(r,l),by.fromBufferAttribute(r,c),u.uv=Ra.getInterpolation(Sy,Wf,jf,Xf,yy,xy,by,new on)),s&&(yy.fromBufferAttribute(s,a),xy.fromBufferAttribute(s,l),by.fromBufferAttribute(s,c),u.uv1=Ra.getInterpolation(Sy,Wf,jf,Xf,yy,xy,by,new on),u.uv2=u.uv1),o&&(Bk.fromBufferAttribute(o,a),zk.fromBufferAttribute(o,l),Gk.fromBufferAttribute(o,c),u.normal=Ra.getInterpolation(Sy,Wf,jf,Xf,Bk,zk,Gk,new me),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:l,c,normal:new me,materialIndex:0};Ra.getNormal(Wf,jf,Xf,h.normal),u.face=h}return u}class Dm extends hr{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],h=[];let d=0,f=0;p("z","y","x",-1,-1,n,t,e,o,s,0),p("z","y","x",1,-1,n,t,-e,o,s,1),p("x","z","y",1,1,e,n,t,r,o,2),p("x","z","y",1,-1,e,n,-t,r,o,3),p("x","y","z",1,-1,e,t,n,r,s,4),p("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new ui(c,3)),this.setAttribute("normal",new ui(u,3)),this.setAttribute("uv",new ui(h,2));function p(_,v,g,b,m,y,A,w,M,T,E){const C=y/M,N=A/T,P=y/2,L=A/2,R=w/2,F=M+1,V=T+1;let G=0,U=0;const z=new me;for(let O=0;O<V;O++){const D=O*N-L;for(let B=0;B<F;B++){const W=B*C-P;z[_]=W*b,z[v]=D*m,z[g]=R,c.push(z.x,z.y,z.z),z[_]=0,z[v]=0,z[g]=w>0?1:-1,u.push(z.x,z.y,z.z),h.push(B/M),h.push(1-O/T),G+=1}}for(let O=0;O<T;O++)for(let D=0;D<M;D++){const B=d+D+F*O,W=d+D+F*(O+1),q=d+(D+1)+F*(O+1),j=d+(D+1)+F*O;l.push(B,W,j),l.push(W,q,j),U+=6}a.addGroup(f,U,E),f+=U,d+=G}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Dm(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function gm(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function As(i){const e={};for(let t=0;t<i.length;t++){const n=gm(i[t]);for(const r in n)e[r]=n[r]}return e}function Kie(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function JG(i){return i.getRenderTarget()===null?i.outputColorSpace:Kn.workingColorSpace}const Dx={clone:gm,merge:As};var Zie=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Qie=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ia extends Lm{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Zie,this.fragmentShader=Qie,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=gm(e.uniforms),this.uniformsGroups=Kie(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class eV extends Or{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ct,this.projectionMatrix=new Ct,this.projectionMatrixInverse=new Ct,this.coordinateSystem=uc}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Ys extends eV{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=xC*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Lx*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return xC*2*Math.atan(Math.tan(Lx*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Lx*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*n/c,r*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const qf=-90,Yf=1;class Jie extends Or{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ys(qf,Yf,e,t);r.layers=this.layers,this.add(r);const s=new Ys(qf,Yf,e,t);s.layers=this.layers,this.add(s);const o=new Ys(qf,Yf,e,t);o.layers=this.layers,this.add(o);const a=new Ys(qf,Yf,e,t);a.layers=this.layers,this.add(a);const l=new Ys(qf,Yf,e,t);l.layers=this.layers,this.add(l);const c=new Ys(qf,Yf,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===uc)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Cb)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const _=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,l),e.setRenderTarget(n,4,r),e.render(t,c),n.texture.generateMipmaps=_,e.setRenderTarget(n,5,r),e.render(t,u),e.setRenderTarget(h,d,f),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class tV extends Ds{constructor(e,t,n,r,s,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:dm,super(e,t,n,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class ere extends vl{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];t.encoding!==void 0&&(T0("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===pd?Hr:ea),this.texture=new tV(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:cs}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Dm(5,5,5),s=new ia({name:"CubemapFromEquirect",uniforms:gm(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ls,blending:pc});s.uniforms.tEquirect.value=t;const o=new hl(r,s),a=t.minFilter;return t.minFilter===m1&&(t.minFilter=cs),new Jie(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}}const YM=new me,tre=new me,nre=new vn;class Gh{constructor(e=new me(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=YM.subVectors(n,t).cross(tre.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(YM),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||nre.getNormalMatrix(e),r=this.coplanarPoint(YM).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Rh=new W1,Ay=new me;class o3{constructor(e=new Gh,t=new Gh,n=new Gh,r=new Gh,s=new Gh,o=new Gh){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=uc){const n=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],h=r[6],d=r[7],f=r[8],p=r[9],_=r[10],v=r[11],g=r[12],b=r[13],m=r[14],y=r[15];if(n[0].setComponents(l-s,d-c,v-f,y-g).normalize(),n[1].setComponents(l+s,d+c,v+f,y+g).normalize(),n[2].setComponents(l+o,d+u,v+p,y+b).normalize(),n[3].setComponents(l-o,d-u,v-p,y-b).normalize(),n[4].setComponents(l-a,d-h,v-_,y-m).normalize(),t===uc)n[5].setComponents(l+a,d+h,v+_,y+m).normalize();else if(t===Cb)n[5].setComponents(a,h,_,m).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Rh.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Rh.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Rh)}intersectsSprite(e){return Rh.center.set(0,0,0),Rh.radius=.7071067811865476,Rh.applyMatrix4(e.matrixWorld),this.intersectsSphere(Rh)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Ay.x=r.normal.x>0?e.max.x:e.min.x,Ay.y=r.normal.y>0?e.max.y:e.min.y,Ay.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Ay)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function nV(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function ire(i,e){const t=e.isWebGL2,n=new WeakMap;function r(c,u){const h=c.array,d=c.usage,f=i.createBuffer();i.bindBuffer(u,f),i.bufferData(u,h,d),c.onUploadCallback();let p;if(h instanceof Float32Array)p=i.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)p=i.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=i.UNSIGNED_SHORT;else if(h instanceof Int16Array)p=i.SHORT;else if(h instanceof Uint32Array)p=i.UNSIGNED_INT;else if(h instanceof Int32Array)p=i.INT;else if(h instanceof Int8Array)p=i.BYTE;else if(h instanceof Uint8Array)p=i.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)p=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:f,type:p,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){const d=u.array,f=u.updateRange;i.bindBuffer(h,c),f.count===-1?i.bufferSubData(h,0,d):(t?i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=n.get(c);u&&(i.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const d=n.get(c);(!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=n.get(c);h===void 0?n.set(c,r(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:o,remove:a,update:l}}class VS extends hr{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(r),c=a+1,u=l+1,h=e/a,d=t/l,f=[],p=[],_=[],v=[];for(let g=0;g<u;g++){const b=g*d-o;for(let m=0;m<c;m++){const y=m*h-s;p.push(y,-b,0),_.push(0,0,1),v.push(m/a),v.push(1-g/l)}}for(let g=0;g<l;g++)for(let b=0;b<a;b++){const m=b+c*g,y=b+c*(g+1),A=b+1+c*(g+1),w=b+1+c*g;f.push(m,y,w),f.push(y,A,w)}this.setIndex(f),this.setAttribute("position",new ui(p,3)),this.setAttribute("normal",new ui(_,3)),this.setAttribute("uv",new ui(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new VS(e.width,e.height,e.widthSegments,e.heightSegments)}}var rre=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,sre=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,ore=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,are=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,lre=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,cre=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ure=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,hre=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,dre=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,fre=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,pre=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,mre=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,gre=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,vre=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,_re=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,yre=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,xre=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,bre=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Sre=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,wre=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Mre=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Are=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Ere=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Tre=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Cre=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Pre=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Rre=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Ire=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Lre="gl_FragColor = linearToOutputTexel( gl_FragColor );",Dre=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Nre=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Fre=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,kre=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Ure=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Ore=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Bre=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,zre=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Gre=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Vre=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Hre=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,$re=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Wre=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,jre=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Xre=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,qre=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Yre=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Kre=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Zre=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Qre=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Jre=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,ese=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,tse=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,nse=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,ise=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,rse=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,sse=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,ose=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ase=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,lse=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,cse=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,use=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,hse=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,dse=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,fse=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,pse=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,mse=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,gse=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,vse=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,_se=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,yse=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,xse=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,bse=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Sse=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,wse=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Mse=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Ase=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Ese=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Tse=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Cse=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Pse=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Rse=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Ise=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Lse=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Dse=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Nse=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Fse=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,kse=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Use=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Ose=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Bse=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,zse=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Gse=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Vse=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Hse=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,$se=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Wse=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,jse=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Xse=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,qse=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Yse=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Kse=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Zse=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Qse=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Jse=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,eoe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const toe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,noe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ioe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,roe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,soe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ooe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,aoe=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,loe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,coe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,uoe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,hoe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,doe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,foe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,poe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,moe=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,goe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,voe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_oe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yoe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,xoe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,boe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Soe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,woe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Moe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Aoe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Eoe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Toe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Coe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Poe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Roe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Ioe=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Loe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Doe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Noe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,fn={alphahash_fragment:rre,alphahash_pars_fragment:sre,alphamap_fragment:ore,alphamap_pars_fragment:are,alphatest_fragment:lre,alphatest_pars_fragment:cre,aomap_fragment:ure,aomap_pars_fragment:hre,begin_vertex:dre,beginnormal_vertex:fre,bsdfs:pre,iridescence_fragment:mre,bumpmap_pars_fragment:gre,clipping_planes_fragment:vre,clipping_planes_pars_fragment:_re,clipping_planes_pars_vertex:yre,clipping_planes_vertex:xre,color_fragment:bre,color_pars_fragment:Sre,color_pars_vertex:wre,color_vertex:Mre,common:Are,cube_uv_reflection_fragment:Ere,defaultnormal_vertex:Tre,displacementmap_pars_vertex:Cre,displacementmap_vertex:Pre,emissivemap_fragment:Rre,emissivemap_pars_fragment:Ire,colorspace_fragment:Lre,colorspace_pars_fragment:Dre,envmap_fragment:Nre,envmap_common_pars_fragment:Fre,envmap_pars_fragment:kre,envmap_pars_vertex:Ure,envmap_physical_pars_fragment:Yre,envmap_vertex:Ore,fog_vertex:Bre,fog_pars_vertex:zre,fog_fragment:Gre,fog_pars_fragment:Vre,gradientmap_pars_fragment:Hre,lightmap_fragment:$re,lightmap_pars_fragment:Wre,lights_lambert_fragment:jre,lights_lambert_pars_fragment:Xre,lights_pars_begin:qre,lights_toon_fragment:Kre,lights_toon_pars_fragment:Zre,lights_phong_fragment:Qre,lights_phong_pars_fragment:Jre,lights_physical_fragment:ese,lights_physical_pars_fragment:tse,lights_fragment_begin:nse,lights_fragment_maps:ise,lights_fragment_end:rse,logdepthbuf_fragment:sse,logdepthbuf_pars_fragment:ose,logdepthbuf_pars_vertex:ase,logdepthbuf_vertex:lse,map_fragment:cse,map_pars_fragment:use,map_particle_fragment:hse,map_particle_pars_fragment:dse,metalnessmap_fragment:fse,metalnessmap_pars_fragment:pse,morphcolor_vertex:mse,morphnormal_vertex:gse,morphtarget_pars_vertex:vse,morphtarget_vertex:_se,normal_fragment_begin:yse,normal_fragment_maps:xse,normal_pars_fragment:bse,normal_pars_vertex:Sse,normal_vertex:wse,normalmap_pars_fragment:Mse,clearcoat_normal_fragment_begin:Ase,clearcoat_normal_fragment_maps:Ese,clearcoat_pars_fragment:Tse,iridescence_pars_fragment:Cse,opaque_fragment:Pse,packing:Rse,premultiplied_alpha_fragment:Ise,project_vertex:Lse,dithering_fragment:Dse,dithering_pars_fragment:Nse,roughnessmap_fragment:Fse,roughnessmap_pars_fragment:kse,shadowmap_pars_fragment:Use,shadowmap_pars_vertex:Ose,shadowmap_vertex:Bse,shadowmask_pars_fragment:zse,skinbase_vertex:Gse,skinning_pars_vertex:Vse,skinning_vertex:Hse,skinnormal_vertex:$se,specularmap_fragment:Wse,specularmap_pars_fragment:jse,tonemapping_fragment:Xse,tonemapping_pars_fragment:qse,transmission_fragment:Yse,transmission_pars_fragment:Kse,uv_pars_fragment:Zse,uv_pars_vertex:Qse,uv_vertex:Jse,worldpos_vertex:eoe,background_vert:toe,background_frag:noe,backgroundCube_vert:ioe,backgroundCube_frag:roe,cube_vert:soe,cube_frag:ooe,depth_vert:aoe,depth_frag:loe,distanceRGBA_vert:coe,distanceRGBA_frag:uoe,equirect_vert:hoe,equirect_frag:doe,linedashed_vert:foe,linedashed_frag:poe,meshbasic_vert:moe,meshbasic_frag:goe,meshlambert_vert:voe,meshlambert_frag:_oe,meshmatcap_vert:yoe,meshmatcap_frag:xoe,meshnormal_vert:boe,meshnormal_frag:Soe,meshphong_vert:woe,meshphong_frag:Moe,meshphysical_vert:Aoe,meshphysical_frag:Eoe,meshtoon_vert:Toe,meshtoon_frag:Coe,points_vert:Poe,points_frag:Roe,shadow_vert:Ioe,shadow_frag:Loe,sprite_vert:Doe,sprite_frag:Noe},Ut={common:{diffuse:{value:new $t(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new vn},alphaMap:{value:null},alphaMapTransform:{value:new vn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new vn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new vn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new vn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new vn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new vn},normalScale:{value:new on(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new vn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new vn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new vn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new vn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new $t(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new $t(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new vn},alphaTest:{value:0},uvTransform:{value:new vn}},sprite:{diffuse:{value:new $t(16777215)},opacity:{value:1},center:{value:new on(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new vn},alphaMap:{value:null},alphaMapTransform:{value:new vn},alphaTest:{value:0}}},ol={basic:{uniforms:As([Ut.common,Ut.specularmap,Ut.envmap,Ut.aomap,Ut.lightmap,Ut.fog]),vertexShader:fn.meshbasic_vert,fragmentShader:fn.meshbasic_frag},lambert:{uniforms:As([Ut.common,Ut.specularmap,Ut.envmap,Ut.aomap,Ut.lightmap,Ut.emissivemap,Ut.bumpmap,Ut.normalmap,Ut.displacementmap,Ut.fog,Ut.lights,{emissive:{value:new $t(0)}}]),vertexShader:fn.meshlambert_vert,fragmentShader:fn.meshlambert_frag},phong:{uniforms:As([Ut.common,Ut.specularmap,Ut.envmap,Ut.aomap,Ut.lightmap,Ut.emissivemap,Ut.bumpmap,Ut.normalmap,Ut.displacementmap,Ut.fog,Ut.lights,{emissive:{value:new $t(0)},specular:{value:new $t(1118481)},shininess:{value:30}}]),vertexShader:fn.meshphong_vert,fragmentShader:fn.meshphong_frag},standard:{uniforms:As([Ut.common,Ut.envmap,Ut.aomap,Ut.lightmap,Ut.emissivemap,Ut.bumpmap,Ut.normalmap,Ut.displacementmap,Ut.roughnessmap,Ut.metalnessmap,Ut.fog,Ut.lights,{emissive:{value:new $t(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:fn.meshphysical_vert,fragmentShader:fn.meshphysical_frag},toon:{uniforms:As([Ut.common,Ut.aomap,Ut.lightmap,Ut.emissivemap,Ut.bumpmap,Ut.normalmap,Ut.displacementmap,Ut.gradientmap,Ut.fog,Ut.lights,{emissive:{value:new $t(0)}}]),vertexShader:fn.meshtoon_vert,fragmentShader:fn.meshtoon_frag},matcap:{uniforms:As([Ut.common,Ut.bumpmap,Ut.normalmap,Ut.displacementmap,Ut.fog,{matcap:{value:null}}]),vertexShader:fn.meshmatcap_vert,fragmentShader:fn.meshmatcap_frag},points:{uniforms:As([Ut.points,Ut.fog]),vertexShader:fn.points_vert,fragmentShader:fn.points_frag},dashed:{uniforms:As([Ut.common,Ut.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:fn.linedashed_vert,fragmentShader:fn.linedashed_frag},depth:{uniforms:As([Ut.common,Ut.displacementmap]),vertexShader:fn.depth_vert,fragmentShader:fn.depth_frag},normal:{uniforms:As([Ut.common,Ut.bumpmap,Ut.normalmap,Ut.displacementmap,{opacity:{value:1}}]),vertexShader:fn.meshnormal_vert,fragmentShader:fn.meshnormal_frag},sprite:{uniforms:As([Ut.sprite,Ut.fog]),vertexShader:fn.sprite_vert,fragmentShader:fn.sprite_frag},background:{uniforms:{uvTransform:{value:new vn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:fn.background_vert,fragmentShader:fn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:fn.backgroundCube_vert,fragmentShader:fn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:fn.cube_vert,fragmentShader:fn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:fn.equirect_vert,fragmentShader:fn.equirect_frag},distanceRGBA:{uniforms:As([Ut.common,Ut.displacementmap,{referencePosition:{value:new me},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:fn.distanceRGBA_vert,fragmentShader:fn.distanceRGBA_frag},shadow:{uniforms:As([Ut.lights,Ut.fog,{color:{value:new $t(0)},opacity:{value:1}}]),vertexShader:fn.shadow_vert,fragmentShader:fn.shadow_frag}};ol.physical={uniforms:As([ol.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new vn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new vn},clearcoatNormalScale:{value:new on(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new vn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new vn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new vn},sheen:{value:0},sheenColor:{value:new $t(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new vn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new vn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new vn},transmissionSamplerSize:{value:new on},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new vn},attenuationDistance:{value:0},attenuationColor:{value:new $t(0)},specularColor:{value:new $t(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new vn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new vn},anisotropyVector:{value:new on},anisotropyMap:{value:null},anisotropyMapTransform:{value:new vn}}]),vertexShader:fn.meshphysical_vert,fragmentShader:fn.meshphysical_frag};const Ey={r:0,b:0,g:0};function Foe(i,e,t,n,r,s,o){const a=new $t(0);let l=s===!0?0:1,c,u,h=null,d=0,f=null;function p(v,g){let b=!1,m=g.isScene===!0?g.background:null;m&&m.isTexture&&(m=(g.backgroundBlurriness>0?t:e).get(m)),m===null?_(a,l):m&&m.isColor&&(_(m,1),b=!0);const y=i.xr.getEnvironmentBlendMode();y==="additive"?n.buffers.color.setClear(0,0,0,1,o):y==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||b)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),m&&(m.isCubeTexture||m.mapping===zS)?(u===void 0&&(u=new hl(new Dm(1,1,1),new ia({name:"BackgroundCubeMaterial",uniforms:gm(ol.backgroundCube.uniforms),vertexShader:ol.backgroundCube.vertexShader,fragmentShader:ol.backgroundCube.fragmentShader,side:Ls,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(A,w,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=m,u.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=Kn.getTransfer(m.colorSpace)!==ai,(h!==m||d!==m.version||f!==i.toneMapping)&&(u.material.needsUpdate=!0,h=m,d=m.version,f=i.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):m&&m.isTexture&&(c===void 0&&(c=new hl(new VS(2,2),new ia({name:"BackgroundMaterial",uniforms:gm(ol.background.uniforms),vertexShader:ol.background.vertexShader,fragmentShader:ol.background.fragmentShader,side:Sc,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=m,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=Kn.getTransfer(m.colorSpace)!==ai,m.matrixAutoUpdate===!0&&m.updateMatrix(),c.material.uniforms.uvTransform.value.copy(m.matrix),(h!==m||d!==m.version||f!==i.toneMapping)&&(c.material.needsUpdate=!0,h=m,d=m.version,f=i.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}function _(v,g){v.getRGB(Ey,JG(i)),n.buffers.color.setClear(Ey.r,Ey.g,Ey.b,g,o)}return{getClearColor:function(){return a},setClearColor:function(v,g=1){a.set(v),l=g,_(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,_(a,l)},render:p}}function koe(i,e,t,n){const r=i.getParameter(i.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=v(null);let c=l,u=!1;function h(R,F,V,G,U){let z=!1;if(o){const O=_(G,V,F);c!==O&&(c=O,f(c.object)),z=g(R,G,V,U),z&&b(R,G,V,U)}else{const O=F.wireframe===!0;(c.geometry!==G.id||c.program!==V.id||c.wireframe!==O)&&(c.geometry=G.id,c.program=V.id,c.wireframe=O,z=!0)}U!==null&&t.update(U,i.ELEMENT_ARRAY_BUFFER),(z||u)&&(u=!1,T(R,F,V,G),U!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.get(U).buffer))}function d(){return n.isWebGL2?i.createVertexArray():s.createVertexArrayOES()}function f(R){return n.isWebGL2?i.bindVertexArray(R):s.bindVertexArrayOES(R)}function p(R){return n.isWebGL2?i.deleteVertexArray(R):s.deleteVertexArrayOES(R)}function _(R,F,V){const G=V.wireframe===!0;let U=a[R.id];U===void 0&&(U={},a[R.id]=U);let z=U[F.id];z===void 0&&(z={},U[F.id]=z);let O=z[G];return O===void 0&&(O=v(d()),z[G]=O),O}function v(R){const F=[],V=[],G=[];for(let U=0;U<r;U++)F[U]=0,V[U]=0,G[U]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:V,attributeDivisors:G,object:R,attributes:{},index:null}}function g(R,F,V,G){const U=c.attributes,z=F.attributes;let O=0;const D=V.getAttributes();for(const B in D)if(D[B].location>=0){const q=U[B];let j=z[B];if(j===void 0&&(B==="instanceMatrix"&&R.instanceMatrix&&(j=R.instanceMatrix),B==="instanceColor"&&R.instanceColor&&(j=R.instanceColor)),q===void 0||q.attribute!==j||j&&q.data!==j.data)return!0;O++}return c.attributesNum!==O||c.index!==G}function b(R,F,V,G){const U={},z=F.attributes;let O=0;const D=V.getAttributes();for(const B in D)if(D[B].location>=0){let q=z[B];q===void 0&&(B==="instanceMatrix"&&R.instanceMatrix&&(q=R.instanceMatrix),B==="instanceColor"&&R.instanceColor&&(q=R.instanceColor));const j={};j.attribute=q,q&&q.data&&(j.data=q.data),U[B]=j,O++}c.attributes=U,c.attributesNum=O,c.index=G}function m(){const R=c.newAttributes;for(let F=0,V=R.length;F<V;F++)R[F]=0}function y(R){A(R,0)}function A(R,F){const V=c.newAttributes,G=c.enabledAttributes,U=c.attributeDivisors;V[R]=1,G[R]===0&&(i.enableVertexAttribArray(R),G[R]=1),U[R]!==F&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,F),U[R]=F)}function w(){const R=c.newAttributes,F=c.enabledAttributes;for(let V=0,G=F.length;V<G;V++)F[V]!==R[V]&&(i.disableVertexAttribArray(V),F[V]=0)}function M(R,F,V,G,U,z,O){O===!0?i.vertexAttribIPointer(R,F,V,U,z):i.vertexAttribPointer(R,F,V,G,U,z)}function T(R,F,V,G){if(n.isWebGL2===!1&&(R.isInstancedMesh||G.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;m();const U=G.attributes,z=V.getAttributes(),O=F.defaultAttributeValues;for(const D in z){const B=z[D];if(B.location>=0){let W=U[D];if(W===void 0&&(D==="instanceMatrix"&&R.instanceMatrix&&(W=R.instanceMatrix),D==="instanceColor"&&R.instanceColor&&(W=R.instanceColor)),W!==void 0){const q=W.normalized,j=W.itemSize,te=t.get(W);if(te===void 0)continue;const ne=te.buffer,Z=te.type,le=te.bytesPerElement,re=n.isWebGL2===!0&&(Z===i.INT||Z===i.UNSIGNED_INT||W.gpuType===UG);if(W.isInterleavedBufferAttribute){const se=W.data,$=se.stride,fe=W.offset;if(se.isInstancedInterleavedBuffer){for(let xe=0;xe<B.locationSize;xe++)A(B.location+xe,se.meshPerAttribute);R.isInstancedMesh!==!0&&G._maxInstanceCount===void 0&&(G._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let xe=0;xe<B.locationSize;xe++)y(B.location+xe);i.bindBuffer(i.ARRAY_BUFFER,ne);for(let xe=0;xe<B.locationSize;xe++)M(B.location+xe,j/B.locationSize,Z,q,$*le,(fe+j/B.locationSize*xe)*le,re)}else{if(W.isInstancedBufferAttribute){for(let se=0;se<B.locationSize;se++)A(B.location+se,W.meshPerAttribute);R.isInstancedMesh!==!0&&G._maxInstanceCount===void 0&&(G._maxInstanceCount=W.meshPerAttribute*W.count)}else for(let se=0;se<B.locationSize;se++)y(B.location+se);i.bindBuffer(i.ARRAY_BUFFER,ne);for(let se=0;se<B.locationSize;se++)M(B.location+se,j/B.locationSize,Z,q,j*le,j/B.locationSize*se*le,re)}}else if(O!==void 0){const q=O[D];if(q!==void 0)switch(q.length){case 2:i.vertexAttrib2fv(B.location,q);break;case 3:i.vertexAttrib3fv(B.location,q);break;case 4:i.vertexAttrib4fv(B.location,q);break;default:i.vertexAttrib1fv(B.location,q)}}}}w()}function E(){P();for(const R in a){const F=a[R];for(const V in F){const G=F[V];for(const U in G)p(G[U].object),delete G[U];delete F[V]}delete a[R]}}function C(R){if(a[R.id]===void 0)return;const F=a[R.id];for(const V in F){const G=F[V];for(const U in G)p(G[U].object),delete G[U];delete F[V]}delete a[R.id]}function N(R){for(const F in a){const V=a[F];if(V[R.id]===void 0)continue;const G=V[R.id];for(const U in G)p(G[U].object),delete G[U];delete V[R.id]}}function P(){L(),u=!0,c!==l&&(c=l,f(c.object))}function L(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:P,resetDefaultState:L,dispose:E,releaseStatesOfGeometry:C,releaseStatesOfProgram:N,initAttributes:m,enableAttribute:y,disableUnusedAttributes:w}}function Uoe(i,e,t,n){const r=n.isWebGL2;let s;function o(c){s=c}function a(c,u){i.drawArrays(s,c,u),t.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,f;if(r)d=i,f="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](s,c,u,h),t.update(u,s,h)}this.setMode=o,this.render=a,this.renderInstances=l}function Ooe(i,e,t){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(M){if(M==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&i.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),d=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=i.getParameter(i.MAX_TEXTURE_SIZE),p=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),_=i.getParameter(i.MAX_VERTEX_ATTRIBS),v=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),g=i.getParameter(i.MAX_VARYING_VECTORS),b=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),m=d>0,y=o||e.has("OES_texture_float"),A=m&&y,w=o?i.getParameter(i.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:_,maxVertexUniforms:v,maxVaryings:g,maxFragmentUniforms:b,vertexTextures:m,floatFragmentTextures:y,floatVertexTextures:A,maxSamples:w}}function Boe(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new Gh,a=new vn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||n!==0||r;return r=d,n=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=u(h,d,0)},this.setState=function(h,d,f){const p=h.clippingPlanes,_=h.clipIntersection,v=h.clipShadows,g=i.get(h);if(!r||p===null||p.length===0||s&&!v)s?u(null):c();else{const b=s?0:n,m=b*4;let y=g.clippingState||null;l.value=y,y=u(p,d,m,f);for(let A=0;A!==m;++A)y[A]=t[A];g.clippingState=y,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,d,f,p){const _=h!==null?h.length:0;let v=null;if(_!==0){if(v=l.value,p!==!0||v===null){const g=f+_*4,b=d.matrixWorldInverse;a.getNormalMatrix(b),(v===null||v.length<g)&&(v=new Float32Array(g));for(let m=0,y=f;m!==_;++m,y+=4)o.copy(h[m]).applyMatrix4(b,a),o.normal.toArray(v,y),v[y+3]=o.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,v}}function zoe(i){let e=new WeakMap;function t(o,a){return a===mC?o.mapping=dm:a===gC&&(o.mapping=fm),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===mC||a===gC)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new ere(l.height/2);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}class g1 extends eV{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Ep=4,Vk=[.125,.215,.35,.446,.526,.582],jh=20,KM=new g1,Hk=new $t;let ZM=null,QM=0,JM=0;const Vh=(1+Math.sqrt(5))/2,Kf=1/Vh,$k=[new me(1,1,1),new me(-1,1,1),new me(1,1,-1),new me(-1,1,-1),new me(0,Vh,Kf),new me(0,Vh,-Kf),new me(Kf,0,Vh),new me(-Kf,0,Vh),new me(Vh,Kf,0),new me(-Vh,Kf,0)];class Wk{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){ZM=this._renderer.getRenderTarget(),QM=this._renderer.getActiveCubeFace(),JM=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=qk(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Xk(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ZM,QM,JM),e.scissorTest=!1,Ty(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===dm||e.mapping===fm?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ZM=this._renderer.getRenderTarget(),QM=this._renderer.getActiveCubeFace(),JM=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:cs,minFilter:cs,generateMipmaps:!1,type:Rd,format:Zs,colorSpace:wc,depthBuffer:!1},r=jk(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=jk(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Goe(s)),this._blurMaterial=Voe(s,e,t)}return r}_compileMaterial(e){const t=new hl(this._lodPlanes[0],e);this._renderer.compile(t,KM)}_sceneToCubeUV(e,t,n,r){const a=new Ys(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(Hk),u.toneMapping=Iu,u.autoClear=!1;const f=new KG({name:"PMREM.Background",side:Ls,depthWrite:!1,depthTest:!1}),p=new hl(new Dm,f);let _=!1;const v=e.background;v?v.isColor&&(f.color.copy(v),e.background=null,_=!0):(f.color.copy(Hk),_=!0);for(let g=0;g<6;g++){const b=g%3;b===0?(a.up.set(0,l[g],0),a.lookAt(c[g],0,0)):b===1?(a.up.set(0,0,l[g]),a.lookAt(0,c[g],0)):(a.up.set(0,l[g],0),a.lookAt(0,0,c[g]));const m=this._cubeSize;Ty(r,b*m,g>2?m:0,m,m),u.setRenderTarget(r),_&&u.render(p,a),u.render(e,a)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=d,u.autoClear=h,e.background=v}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===dm||e.mapping===fm;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=qk()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Xk());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new hl(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Ty(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,KM)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=$k[(r-1)%$k.length];this._blur(e,r-1,r,s,o)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new hl(this._lodPlanes[r],c),d=c.uniforms,f=this._sizeLods[n]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*jh-1),_=s/p,v=isFinite(s)?1+Math.floor(u*_):jh;v>jh&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${jh}`);const g=[];let b=0;for(let M=0;M<jh;++M){const T=M/_,E=Math.exp(-T*T/2);g.push(E),M===0?b+=E:M<v&&(b+=2*E)}for(let M=0;M<g.length;M++)g[M]=g[M]/b;d.envMap.value=e.texture,d.samples.value=v,d.weights.value=g,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:m}=this;d.dTheta.value=p,d.mipInt.value=m-n;const y=this._sizeLods[r],A=3*y*(r>m-Ep?r-m+Ep:0),w=4*(this._cubeSize-y);Ty(t,A,w,3*y,2*y),l.setRenderTarget(t),l.render(h,KM)}}function Goe(i){const e=[],t=[],n=[];let r=i;const s=i-Ep+1+Vk.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>i-Ep?l=Vk[o-i+Ep-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,p=6,_=3,v=2,g=1,b=new Float32Array(_*p*f),m=new Float32Array(v*p*f),y=new Float32Array(g*p*f);for(let w=0;w<f;w++){const M=w%3*2/3-1,T=w>2?0:-1,E=[M,T,0,M+2/3,T,0,M+2/3,T+1,0,M,T,0,M+2/3,T+1,0,M,T+1,0];b.set(E,_*p*w),m.set(d,v*p*w);const C=[w,w,w,w,w,w];y.set(C,g*p*w)}const A=new hr;A.setAttribute("position",new Qi(b,_)),A.setAttribute("uv",new Qi(m,v)),A.setAttribute("faceIndex",new Qi(y,g)),e.push(A),r>Ep&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function jk(i,e,t){const n=new vl(i,e,t);return n.texture.mapping=zS,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Ty(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function Voe(i,e,t){const n=new Float32Array(jh),r=new me(0,1,0);return new ia({name:"SphericalGaussianBlur",defines:{n:jh,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:a3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:pc,depthTest:!1,depthWrite:!1})}function Xk(){return new ia({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:a3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:pc,depthTest:!1,depthWrite:!1})}function qk(){return new ia({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:a3(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:pc,depthTest:!1,depthWrite:!1})}function a3(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Hoe(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===mC||l===gC,u=l===dm||l===fm;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new Wk(i)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{const h=a.image;if(c&&h&&h.height>0||u&&h&&r(h)){t===null&&(t=new Wk(i));const d=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",s),d.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function $oe(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const r=t(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function Woe(i,e,t,n){const r={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);for(const p in d.morphAttributes){const _=d.morphAttributes[p];for(let v=0,g=_.length;v<g;v++)e.remove(_[v])}d.removeEventListener("dispose",o),delete r[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const p in d)e.update(d[p],i.ARRAY_BUFFER);const f=h.morphAttributes;for(const p in f){const _=f[p];for(let v=0,g=_.length;v<g;v++)e.update(_[v],i.ARRAY_BUFFER)}}function c(h){const d=[],f=h.index,p=h.attributes.position;let _=0;if(f!==null){const b=f.array;_=f.version;for(let m=0,y=b.length;m<y;m+=3){const A=b[m+0],w=b[m+1],M=b[m+2];d.push(A,w,w,M,M,A)}}else if(p!==void 0){const b=p.array;_=p.version;for(let m=0,y=b.length/3-1;m<y;m+=3){const A=m+0,w=m+1,M=m+2;d.push(A,w,w,M,M,A)}}else return;const v=new($G(d)?QG:ZG)(d,1);v.version=_;const g=s.get(h);g&&e.remove(g),s.set(h,v)}function u(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function joe(i,e,t,n){const r=n.isWebGL2;let s;function o(d){s=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function u(d,f){i.drawElements(s,f,a,d*l),t.update(f,s,1)}function h(d,f,p){if(p===0)return;let _,v;if(r)_=i,v="drawElementsInstanced";else if(_=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",_===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}_[v](s,f,a,d*l,p),t.update(f,s,p)}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h}function Xoe(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=a*(s/3);break;case i.LINES:t.lines+=a*(s/2);break;case i.LINE_STRIP:t.lines+=a*(s-1);break;case i.LINE_LOOP:t.lines+=a*s;break;case i.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function qoe(i,e){return i[0]-e[0]}function Yoe(i,e){return Math.abs(e[1])-Math.abs(i[1])}function Koe(i,e,t){const n={},r=new Float32Array(8),s=new WeakMap,o=new Nr,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,h){const d=c.morphTargetInfluences;if(e.isWebGL2===!0){const p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,_=p!==void 0?p.length:0;let v=s.get(u);if(v===void 0||v.count!==_){let F=function(){L.dispose(),s.delete(u),u.removeEventListener("dispose",F)};var f=F;v!==void 0&&v.texture.dispose();const m=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,A=u.morphAttributes.color!==void 0,w=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],T=u.morphAttributes.color||[];let E=0;m===!0&&(E=1),y===!0&&(E=2),A===!0&&(E=3);let C=u.attributes.position.count*E,N=1;C>e.maxTextureSize&&(N=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const P=new Float32Array(C*N*4*_),L=new XG(P,C,N,_);L.type=ka,L.needsUpdate=!0;const R=E*4;for(let V=0;V<_;V++){const G=w[V],U=M[V],z=T[V],O=C*N*4*V;for(let D=0;D<G.count;D++){const B=D*R;m===!0&&(o.fromBufferAttribute(G,D),P[O+B+0]=o.x,P[O+B+1]=o.y,P[O+B+2]=o.z,P[O+B+3]=0),y===!0&&(o.fromBufferAttribute(U,D),P[O+B+4]=o.x,P[O+B+5]=o.y,P[O+B+6]=o.z,P[O+B+7]=0),A===!0&&(o.fromBufferAttribute(z,D),P[O+B+8]=o.x,P[O+B+9]=o.y,P[O+B+10]=o.z,P[O+B+11]=z.itemSize===4?o.w:1)}}v={count:_,texture:L,size:new on(C,N)},s.set(u,v),u.addEventListener("dispose",F)}let g=0;for(let m=0;m<d.length;m++)g+=d[m];const b=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(i,"morphTargetBaseInfluence",b),h.getUniforms().setValue(i,"morphTargetInfluences",d),h.getUniforms().setValue(i,"morphTargetsTexture",v.texture,t),h.getUniforms().setValue(i,"morphTargetsTextureSize",v.size)}else{const p=d===void 0?0:d.length;let _=n[u.id];if(_===void 0||_.length!==p){_=[];for(let y=0;y<p;y++)_[y]=[y,0];n[u.id]=_}for(let y=0;y<p;y++){const A=_[y];A[0]=y,A[1]=d[y]}_.sort(Yoe);for(let y=0;y<8;y++)y<p&&_[y][1]?(a[y][0]=_[y][0],a[y][1]=_[y][1]):(a[y][0]=Number.MAX_SAFE_INTEGER,a[y][1]=0);a.sort(qoe);const v=u.morphAttributes.position,g=u.morphAttributes.normal;let b=0;for(let y=0;y<8;y++){const A=a[y],w=A[0],M=A[1];w!==Number.MAX_SAFE_INTEGER&&M?(v&&u.getAttribute("morphTarget"+y)!==v[w]&&u.setAttribute("morphTarget"+y,v[w]),g&&u.getAttribute("morphNormal"+y)!==g[w]&&u.setAttribute("morphNormal"+y,g[w]),r[y]=M,b+=M):(v&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),g&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),r[y]=0)}const m=u.morphTargetsRelative?1:1-b;h.getUniforms().setValue(i,"morphTargetBaseInfluence",m),h.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function Zoe(i,e,t,n){let r=new WeakMap;function s(l){const c=n.render.frame,u=l.geometry,h=e.get(l,u);if(r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==c&&(d.update(),r.set(d,c))}return h}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}const iV=new Ds,rV=new XG,sV=new Oie,oV=new tV,Yk=[],Kk=[],Zk=new Float32Array(16),Qk=new Float32Array(9),Jk=new Float32Array(4);function Nm(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=Yk[r];if(s===void 0&&(s=new Float32Array(r),Yk[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(s,a)}return s}function Sr(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function wr(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function HS(i,e){let t=Kk[e];t===void 0&&(t=new Int32Array(e),Kk[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function Qoe(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function Joe(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;i.uniform2fv(this.addr,e),wr(t,e)}}function eae(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Sr(t,e))return;i.uniform3fv(this.addr,e),wr(t,e)}}function tae(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;i.uniform4fv(this.addr,e),wr(t,e)}}function nae(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Sr(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),wr(t,e)}else{if(Sr(t,n))return;Jk.set(n),i.uniformMatrix2fv(this.addr,!1,Jk),wr(t,n)}}function iae(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Sr(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),wr(t,e)}else{if(Sr(t,n))return;Qk.set(n),i.uniformMatrix3fv(this.addr,!1,Qk),wr(t,n)}}function rae(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Sr(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),wr(t,e)}else{if(Sr(t,n))return;Zk.set(n),i.uniformMatrix4fv(this.addr,!1,Zk),wr(t,n)}}function sae(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function oae(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;i.uniform2iv(this.addr,e),wr(t,e)}}function aae(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Sr(t,e))return;i.uniform3iv(this.addr,e),wr(t,e)}}function lae(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;i.uniform4iv(this.addr,e),wr(t,e)}}function cae(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function uae(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;i.uniform2uiv(this.addr,e),wr(t,e)}}function hae(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Sr(t,e))return;i.uniform3uiv(this.addr,e),wr(t,e)}}function dae(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;i.uniform4uiv(this.addr,e),wr(t,e)}}function fae(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2D(e||iV,r)}function pae(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||sV,r)}function mae(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||oV,r)}function gae(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||rV,r)}function vae(i){switch(i){case 5126:return Qoe;case 35664:return Joe;case 35665:return eae;case 35666:return tae;case 35674:return nae;case 35675:return iae;case 35676:return rae;case 5124:case 35670:return sae;case 35667:case 35671:return oae;case 35668:case 35672:return aae;case 35669:case 35673:return lae;case 5125:return cae;case 36294:return uae;case 36295:return hae;case 36296:return dae;case 35678:case 36198:case 36298:case 36306:case 35682:return fae;case 35679:case 36299:case 36307:return pae;case 35680:case 36300:case 36308:case 36293:return mae;case 36289:case 36303:case 36311:case 36292:return gae}}function _ae(i,e){i.uniform1fv(this.addr,e)}function yae(i,e){const t=Nm(e,this.size,2);i.uniform2fv(this.addr,t)}function xae(i,e){const t=Nm(e,this.size,3);i.uniform3fv(this.addr,t)}function bae(i,e){const t=Nm(e,this.size,4);i.uniform4fv(this.addr,t)}function Sae(i,e){const t=Nm(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function wae(i,e){const t=Nm(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function Mae(i,e){const t=Nm(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function Aae(i,e){i.uniform1iv(this.addr,e)}function Eae(i,e){i.uniform2iv(this.addr,e)}function Tae(i,e){i.uniform3iv(this.addr,e)}function Cae(i,e){i.uniform4iv(this.addr,e)}function Pae(i,e){i.uniform1uiv(this.addr,e)}function Rae(i,e){i.uniform2uiv(this.addr,e)}function Iae(i,e){i.uniform3uiv(this.addr,e)}function Lae(i,e){i.uniform4uiv(this.addr,e)}function Dae(i,e,t){const n=this.cache,r=e.length,s=HS(t,r);Sr(n,s)||(i.uniform1iv(this.addr,s),wr(n,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||iV,s[o])}function Nae(i,e,t){const n=this.cache,r=e.length,s=HS(t,r);Sr(n,s)||(i.uniform1iv(this.addr,s),wr(n,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||sV,s[o])}function Fae(i,e,t){const n=this.cache,r=e.length,s=HS(t,r);Sr(n,s)||(i.uniform1iv(this.addr,s),wr(n,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||oV,s[o])}function kae(i,e,t){const n=this.cache,r=e.length,s=HS(t,r);Sr(n,s)||(i.uniform1iv(this.addr,s),wr(n,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||rV,s[o])}function Uae(i){switch(i){case 5126:return _ae;case 35664:return yae;case 35665:return xae;case 35666:return bae;case 35674:return Sae;case 35675:return wae;case 35676:return Mae;case 5124:case 35670:return Aae;case 35667:case 35671:return Eae;case 35668:case 35672:return Tae;case 35669:case 35673:return Cae;case 5125:return Pae;case 36294:return Rae;case 36295:return Iae;case 36296:return Lae;case 35678:case 36198:case 36298:case 36306:case 35682:return Dae;case 35679:case 36299:case 36307:return Nae;case 35680:case 36300:case 36308:case 36293:return Fae;case 36289:case 36303:case 36311:case 36292:return kae}}class Oae{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=vae(t.type)}}class Bae{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=Uae(t.type)}}class zae{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],n)}}}const eA=/(\w+)(\])?(\[|\.)?/g;function eU(i,e){i.seq.push(e),i.map[e.id]=e}function Gae(i,e,t){const n=i.name,r=n.length;for(eA.lastIndex=0;;){const s=eA.exec(n),o=eA.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){eU(t,c===void 0?new Oae(a,i,e):new Bae(a,i,e));break}else{let h=t.map[a];h===void 0&&(h=new zae(a),eU(t,h)),t=h}}}class Nx{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);Gae(s,o,this)}}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&n.push(o)}return n}}function tU(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const Vae=37297;let Hae=0;function $ae(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}function Wae(i){const e=Kn.getPrimaries(Kn.workingColorSpace),t=Kn.getPrimaries(i);let n;switch(e===t?n="":e===Tb&&t===Eb?n="LinearDisplayP3ToLinearSRGB":e===Eb&&t===Tb&&(n="LinearSRGBToLinearDisplayP3"),i){case wc:case GS:return[n,"LinearTransferOETF"];case Hr:case r3:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",i),[n,"LinearTransferOETF"]}}function nU(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+$ae(i.getShaderSource(e),o)}else return r}function jae(i,e){const t=Wae(e);return`vec4 ${i}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function Xae(i,e){let t;switch(e){case sie:t="Linear";break;case oie:t="Reinhard";break;case aie:t="OptimizedCineon";break;case lie:t="ACESFilmic";break;case cie:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function qae(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(t0).join(`
`)}function Yae(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Kae(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let a=1;s.type===i.FLOAT_MAT2&&(a=2),s.type===i.FLOAT_MAT3&&(a=3),s.type===i.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function t0(i){return i!==""}function iU(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function rU(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Zae=/^[ \t]*#include +<([\w\d./]+)>/gm;function SC(i){return i.replace(Zae,Jae)}const Qae=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Jae(i,e){let t=fn[e];if(t===void 0){const n=Qae.get(e);if(n!==void 0)t=fn[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return SC(t)}const ele=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function sU(i){return i.replace(ele,tle)}function tle(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function oU(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function nle(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===NG?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===Dne?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Ql&&(e="SHADOWMAP_TYPE_VSM"),e}function ile(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case dm:case fm:e="ENVMAP_TYPE_CUBE";break;case zS:e="ENVMAP_TYPE_CUBE_UV";break}return e}function rle(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case fm:e="ENVMAP_MODE_REFRACTION";break}return e}function sle(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case FG:e="ENVMAP_BLENDING_MULTIPLY";break;case iie:e="ENVMAP_BLENDING_MIX";break;case rie:e="ENVMAP_BLENDING_ADD";break}return e}function ole(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function ale(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=nle(t),c=ile(t),u=rle(t),h=sle(t),d=ole(t),f=t.isWebGL2?"":qae(t),p=Yae(s),_=r.createProgram();let v,g,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(t0).join(`
`),v.length>0&&(v+=`
`),g=[f,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(t0).join(`
`),g.length>0&&(g+=`
`)):(v=[oU(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(t0).join(`
`),g=[f,oU(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Iu?"#define TONE_MAPPING":"",t.toneMapping!==Iu?fn.tonemapping_pars_fragment:"",t.toneMapping!==Iu?Xae("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",fn.colorspace_pars_fragment,jae("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(t0).join(`
`)),o=SC(o),o=iU(o,t),o=rU(o,t),a=SC(a),a=iU(a,t),a=rU(a,t),o=sU(o),a=sU(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,g=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===Mk?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Mk?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);const m=b+v+o,y=b+g+a,A=tU(r,r.VERTEX_SHADER,m),w=tU(r,r.FRAGMENT_SHADER,y);r.attachShader(_,A),r.attachShader(_,w),t.index0AttributeName!==void 0?r.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_);function M(N){if(i.debug.checkShaderErrors){const P=r.getProgramInfoLog(_).trim(),L=r.getShaderInfoLog(A).trim(),R=r.getShaderInfoLog(w).trim();let F=!0,V=!0;if(r.getProgramParameter(_,r.LINK_STATUS)===!1)if(F=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,_,A,w);else{const G=nU(r,A,"vertex"),U=nU(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+`

Program Info Log: `+P+`
`+G+`
`+U)}else P!==""?console.warn("THREE.WebGLProgram: Program Info Log:",P):(L===""||R==="")&&(V=!1);V&&(N.diagnostics={runnable:F,programLog:P,vertexShader:{log:L,prefix:v},fragmentShader:{log:R,prefix:g}})}r.deleteShader(A),r.deleteShader(w),T=new Nx(r,_),E=Kae(r,_)}let T;this.getUniforms=function(){return T===void 0&&M(this),T};let E;this.getAttributes=function(){return E===void 0&&M(this),E};let C=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return C===!1&&(C=r.getProgramParameter(_,Vae)),C},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Hae++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=A,this.fragmentShader=w,this}let lle=0;class cle{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new ule(e),t.set(e,n)),n}}class ule{constructor(e){this.id=lle++,this.code=e,this.usedTimes=0}}function hle(i,e,t,n,r,s,o){const a=new qG,l=new cle,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures;let f=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(E){return E===0?"uv":`uv${E}`}function v(E,C,N,P,L){const R=P.fog,F=L.geometry,V=E.isMeshStandardMaterial?P.environment:null,G=(E.isMeshStandardMaterial?t:e).get(E.envMap||V),U=G&&G.mapping===zS?G.image.height:null,z=p[E.type];E.precision!==null&&(f=r.getMaxPrecision(E.precision),f!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",f,"instead."));const O=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,D=O!==void 0?O.length:0;let B=0;F.morphAttributes.position!==void 0&&(B=1),F.morphAttributes.normal!==void 0&&(B=2),F.morphAttributes.color!==void 0&&(B=3);let W,q,j,te;if(z){const Mt=ol[z];W=Mt.vertexShader,q=Mt.fragmentShader}else W=E.vertexShader,q=E.fragmentShader,l.update(E),j=l.getVertexShaderID(E),te=l.getFragmentShaderID(E);const ne=i.getRenderTarget(),Z=L.isInstancedMesh===!0,le=!!E.map,re=!!E.matcap,se=!!G,$=!!E.aoMap,fe=!!E.lightMap,xe=!!E.bumpMap,Ie=!!E.normalMap,ge=!!E.displacementMap,Oe=!!E.emissiveMap,Me=!!E.metalnessMap,Y=!!E.roughnessMap,Q=E.anisotropy>0,de=E.clearcoat>0,Le=E.iridescence>0,ie=E.sheen>0,K=E.transmission>0,be=Q&&!!E.anisotropyMap,Ue=de&&!!E.clearcoatMap,ve=de&&!!E.clearcoatNormalMap,Ne=de&&!!E.clearcoatRoughnessMap,$e=Le&&!!E.iridescenceMap,Ee=Le&&!!E.iridescenceThicknessMap,Ze=ie&&!!E.sheenColorMap,nt=ie&&!!E.sheenRoughnessMap,rt=!!E.specularMap,Be=!!E.specularColorMap,qe=!!E.specularIntensityMap,it=K&&!!E.transmissionMap,at=K&&!!E.thicknessMap,ht=!!E.gradientMap,Qe=!!E.alphaMap,je=E.alphaTest>0,ee=!!E.alphaHash,Ge=!!E.extensions,Ce=!!F.attributes.uv1,De=!!F.attributes.uv2,Xe=!!F.attributes.uv3;let gt=Iu;return E.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(gt=i.toneMapping),{isWebGL2:u,shaderID:z,shaderType:E.type,shaderName:E.name,vertexShader:W,fragmentShader:q,defines:E.defines,customVertexShaderID:j,customFragmentShaderID:te,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:f,instancing:Z,instancingColor:Z&&L.instanceColor!==null,supportsVertexTextures:d,outputColorSpace:ne===null?i.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:wc,map:le,matcap:re,envMap:se,envMapMode:se&&G.mapping,envMapCubeUVHeight:U,aoMap:$,lightMap:fe,bumpMap:xe,normalMap:Ie,displacementMap:d&&ge,emissiveMap:Oe,normalMapObjectSpace:Ie&&E.normalMapType===wie,normalMapTangentSpace:Ie&&E.normalMapType===Sie,metalnessMap:Me,roughnessMap:Y,anisotropy:Q,anisotropyMap:be,clearcoat:de,clearcoatMap:Ue,clearcoatNormalMap:ve,clearcoatRoughnessMap:Ne,iridescence:Le,iridescenceMap:$e,iridescenceThicknessMap:Ee,sheen:ie,sheenColorMap:Ze,sheenRoughnessMap:nt,specularMap:rt,specularColorMap:Be,specularIntensityMap:qe,transmission:K,transmissionMap:it,thicknessMap:at,gradientMap:ht,opaque:E.transparent===!1&&E.blending===mc,alphaMap:Qe,alphaTest:je,alphaHash:ee,combine:E.combine,mapUv:le&&_(E.map.channel),aoMapUv:$&&_(E.aoMap.channel),lightMapUv:fe&&_(E.lightMap.channel),bumpMapUv:xe&&_(E.bumpMap.channel),normalMapUv:Ie&&_(E.normalMap.channel),displacementMapUv:ge&&_(E.displacementMap.channel),emissiveMapUv:Oe&&_(E.emissiveMap.channel),metalnessMapUv:Me&&_(E.metalnessMap.channel),roughnessMapUv:Y&&_(E.roughnessMap.channel),anisotropyMapUv:be&&_(E.anisotropyMap.channel),clearcoatMapUv:Ue&&_(E.clearcoatMap.channel),clearcoatNormalMapUv:ve&&_(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ne&&_(E.clearcoatRoughnessMap.channel),iridescenceMapUv:$e&&_(E.iridescenceMap.channel),iridescenceThicknessMapUv:Ee&&_(E.iridescenceThicknessMap.channel),sheenColorMapUv:Ze&&_(E.sheenColorMap.channel),sheenRoughnessMapUv:nt&&_(E.sheenRoughnessMap.channel),specularMapUv:rt&&_(E.specularMap.channel),specularColorMapUv:Be&&_(E.specularColorMap.channel),specularIntensityMapUv:qe&&_(E.specularIntensityMap.channel),transmissionMapUv:it&&_(E.transmissionMap.channel),thicknessMapUv:at&&_(E.thicknessMap.channel),alphaMapUv:Qe&&_(E.alphaMap.channel),vertexTangents:!!F.attributes.tangent&&(Ie||Q),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,vertexUv1s:Ce,vertexUv2s:De,vertexUv3s:Xe,pointsUvs:L.isPoints===!0&&!!F.attributes.uv&&(le||Qe),fog:!!R,useFog:E.fog===!0,fogExp2:R&&R.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:L.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:D,morphTextureStride:B,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numSpotLightMaps:C.spotLightMap.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numSpotLightShadowsWithMaps:C.numSpotLightShadowsWithMaps,numLightProbes:C.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:E.dithering,shadowMapEnabled:i.shadowMap.enabled&&N.length>0,shadowMapType:i.shadowMap.type,toneMapping:gt,useLegacyLights:i._useLegacyLights,decodeVideoTexture:le&&E.map.isVideoTexture===!0&&Kn.getTransfer(E.map.colorSpace)===ai,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===ll,flipSided:E.side===Ls,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:Ge&&E.extensions.derivatives===!0,extensionFragDepth:Ge&&E.extensions.fragDepth===!0,extensionDrawBuffers:Ge&&E.extensions.drawBuffers===!0,extensionShaderTextureLOD:Ge&&E.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()}}function g(E){const C=[];if(E.shaderID?C.push(E.shaderID):(C.push(E.customVertexShaderID),C.push(E.customFragmentShaderID)),E.defines!==void 0)for(const N in E.defines)C.push(N),C.push(E.defines[N]);return E.isRawShaderMaterial===!1&&(b(C,E),m(C,E),C.push(i.outputColorSpace)),C.push(E.customProgramCacheKey),C.join()}function b(E,C){E.push(C.precision),E.push(C.outputColorSpace),E.push(C.envMapMode),E.push(C.envMapCubeUVHeight),E.push(C.mapUv),E.push(C.alphaMapUv),E.push(C.lightMapUv),E.push(C.aoMapUv),E.push(C.bumpMapUv),E.push(C.normalMapUv),E.push(C.displacementMapUv),E.push(C.emissiveMapUv),E.push(C.metalnessMapUv),E.push(C.roughnessMapUv),E.push(C.anisotropyMapUv),E.push(C.clearcoatMapUv),E.push(C.clearcoatNormalMapUv),E.push(C.clearcoatRoughnessMapUv),E.push(C.iridescenceMapUv),E.push(C.iridescenceThicknessMapUv),E.push(C.sheenColorMapUv),E.push(C.sheenRoughnessMapUv),E.push(C.specularMapUv),E.push(C.specularColorMapUv),E.push(C.specularIntensityMapUv),E.push(C.transmissionMapUv),E.push(C.thicknessMapUv),E.push(C.combine),E.push(C.fogExp2),E.push(C.sizeAttenuation),E.push(C.morphTargetsCount),E.push(C.morphAttributeCount),E.push(C.numDirLights),E.push(C.numPointLights),E.push(C.numSpotLights),E.push(C.numSpotLightMaps),E.push(C.numHemiLights),E.push(C.numRectAreaLights),E.push(C.numDirLightShadows),E.push(C.numPointLightShadows),E.push(C.numSpotLightShadows),E.push(C.numSpotLightShadowsWithMaps),E.push(C.numLightProbes),E.push(C.shadowMapType),E.push(C.toneMapping),E.push(C.numClippingPlanes),E.push(C.numClipIntersection),E.push(C.depthPacking)}function m(E,C){a.disableAll(),C.isWebGL2&&a.enable(0),C.supportsVertexTextures&&a.enable(1),C.instancing&&a.enable(2),C.instancingColor&&a.enable(3),C.matcap&&a.enable(4),C.envMap&&a.enable(5),C.normalMapObjectSpace&&a.enable(6),C.normalMapTangentSpace&&a.enable(7),C.clearcoat&&a.enable(8),C.iridescence&&a.enable(9),C.alphaTest&&a.enable(10),C.vertexColors&&a.enable(11),C.vertexAlphas&&a.enable(12),C.vertexUv1s&&a.enable(13),C.vertexUv2s&&a.enable(14),C.vertexUv3s&&a.enable(15),C.vertexTangents&&a.enable(16),C.anisotropy&&a.enable(17),C.alphaHash&&a.enable(18),E.push(a.mask),a.disableAll(),C.fog&&a.enable(0),C.useFog&&a.enable(1),C.flatShading&&a.enable(2),C.logarithmicDepthBuffer&&a.enable(3),C.skinning&&a.enable(4),C.morphTargets&&a.enable(5),C.morphNormals&&a.enable(6),C.morphColors&&a.enable(7),C.premultipliedAlpha&&a.enable(8),C.shadowMapEnabled&&a.enable(9),C.useLegacyLights&&a.enable(10),C.doubleSided&&a.enable(11),C.flipSided&&a.enable(12),C.useDepthPacking&&a.enable(13),C.dithering&&a.enable(14),C.transmission&&a.enable(15),C.sheen&&a.enable(16),C.opaque&&a.enable(17),C.pointsUvs&&a.enable(18),C.decodeVideoTexture&&a.enable(19),E.push(a.mask)}function y(E){const C=p[E.type];let N;if(C){const P=ol[C];N=Dx.clone(P.uniforms)}else N=E.uniforms;return N}function A(E,C){let N;for(let P=0,L=c.length;P<L;P++){const R=c[P];if(R.cacheKey===C){N=R,++N.usedTimes;break}}return N===void 0&&(N=new ale(i,C,E,s),c.push(N)),N}function w(E){if(--E.usedTimes===0){const C=c.indexOf(E);c[C]=c[c.length-1],c.pop(),E.destroy()}}function M(E){l.remove(E)}function T(){l.dispose()}return{getParameters:v,getProgramCacheKey:g,getUniforms:y,acquireProgram:A,releaseProgram:w,releaseShaderCache:M,programs:c,dispose:T}}function dle(){let i=new WeakMap;function e(s){let o=i.get(s);return o===void 0&&(o={},i.set(s,o)),o}function t(s){i.delete(s)}function n(s,o,a){i.get(s)[o]=a}function r(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:r}}function fle(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function aU(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function lU(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(h,d,f,p,_,v){let g=i[e];return g===void 0?(g={id:h.id,object:h,geometry:d,material:f,groupOrder:p,renderOrder:h.renderOrder,z:_,group:v},i[e]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=f,g.groupOrder=p,g.renderOrder=h.renderOrder,g.z=_,g.group=v),e++,g}function a(h,d,f,p,_,v){const g=o(h,d,f,p,_,v);f.transmission>0?n.push(g):f.transparent===!0?r.push(g):t.push(g)}function l(h,d,f,p,_,v){const g=o(h,d,f,p,_,v);f.transmission>0?n.unshift(g):f.transparent===!0?r.unshift(g):t.unshift(g)}function c(h,d){t.length>1&&t.sort(h||fle),n.length>1&&n.sort(d||aU),r.length>1&&r.sort(d||aU)}function u(){for(let h=e,d=i.length;h<d;h++){const f=i[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function ple(){let i=new WeakMap;function e(n,r){const s=i.get(n);let o;return s===void 0?(o=new lU,i.set(n,[o])):r>=s.length?(o=new lU,s.push(o)):o=s[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function mle(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new me,color:new $t};break;case"SpotLight":t={position:new me,direction:new me,color:new $t,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new me,color:new $t,distance:0,decay:0};break;case"HemisphereLight":t={direction:new me,skyColor:new $t,groundColor:new $t};break;case"RectAreaLight":t={color:new $t,position:new me,halfWidth:new me,halfHeight:new me};break}return i[e.id]=t,t}}}function gle(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new on};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new on};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new on,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let vle=0;function _le(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function yle(i,e){const t=new mle,n=gle(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new me);const s=new me,o=new Ct,a=new Ct;function l(u,h){let d=0,f=0,p=0;for(let P=0;P<9;P++)r.probe[P].set(0,0,0);let _=0,v=0,g=0,b=0,m=0,y=0,A=0,w=0,M=0,T=0,E=0;u.sort(_le);const C=h===!0?Math.PI:1;for(let P=0,L=u.length;P<L;P++){const R=u[P],F=R.color,V=R.intensity,G=R.distance,U=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)d+=F.r*V*C,f+=F.g*V*C,p+=F.b*V*C;else if(R.isLightProbe){for(let z=0;z<9;z++)r.probe[z].addScaledVector(R.sh.coefficients[z],V);E++}else if(R.isDirectionalLight){const z=t.get(R);if(z.color.copy(R.color).multiplyScalar(R.intensity*C),R.castShadow){const O=R.shadow,D=n.get(R);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,r.directionalShadow[_]=D,r.directionalShadowMap[_]=U,r.directionalShadowMatrix[_]=R.shadow.matrix,y++}r.directional[_]=z,_++}else if(R.isSpotLight){const z=t.get(R);z.position.setFromMatrixPosition(R.matrixWorld),z.color.copy(F).multiplyScalar(V*C),z.distance=G,z.coneCos=Math.cos(R.angle),z.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),z.decay=R.decay,r.spot[g]=z;const O=R.shadow;if(R.map&&(r.spotLightMap[M]=R.map,M++,O.updateMatrices(R),R.castShadow&&T++),r.spotLightMatrix[g]=O.matrix,R.castShadow){const D=n.get(R);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,r.spotShadow[g]=D,r.spotShadowMap[g]=U,w++}g++}else if(R.isRectAreaLight){const z=t.get(R);z.color.copy(F).multiplyScalar(V),z.halfWidth.set(R.width*.5,0,0),z.halfHeight.set(0,R.height*.5,0),r.rectArea[b]=z,b++}else if(R.isPointLight){const z=t.get(R);if(z.color.copy(R.color).multiplyScalar(R.intensity*C),z.distance=R.distance,z.decay=R.decay,R.castShadow){const O=R.shadow,D=n.get(R);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,D.shadowCameraNear=O.camera.near,D.shadowCameraFar=O.camera.far,r.pointShadow[v]=D,r.pointShadowMap[v]=U,r.pointShadowMatrix[v]=R.shadow.matrix,A++}r.point[v]=z,v++}else if(R.isHemisphereLight){const z=t.get(R);z.skyColor.copy(R.color).multiplyScalar(V*C),z.groundColor.copy(R.groundColor).multiplyScalar(V*C),r.hemi[m]=z,m++}}b>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ut.LTC_FLOAT_1,r.rectAreaLTC2=Ut.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=Ut.LTC_HALF_1,r.rectAreaLTC2=Ut.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=d,r.ambient[1]=f,r.ambient[2]=p;const N=r.hash;(N.directionalLength!==_||N.pointLength!==v||N.spotLength!==g||N.rectAreaLength!==b||N.hemiLength!==m||N.numDirectionalShadows!==y||N.numPointShadows!==A||N.numSpotShadows!==w||N.numSpotMaps!==M||N.numLightProbes!==E)&&(r.directional.length=_,r.spot.length=g,r.rectArea.length=b,r.point.length=v,r.hemi.length=m,r.directionalShadow.length=y,r.directionalShadowMap.length=y,r.pointShadow.length=A,r.pointShadowMap.length=A,r.spotShadow.length=w,r.spotShadowMap.length=w,r.directionalShadowMatrix.length=y,r.pointShadowMatrix.length=A,r.spotLightMatrix.length=w+M-T,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=T,r.numLightProbes=E,N.directionalLength=_,N.pointLength=v,N.spotLength=g,N.rectAreaLength=b,N.hemiLength=m,N.numDirectionalShadows=y,N.numPointShadows=A,N.numSpotShadows=w,N.numSpotMaps=M,N.numLightProbes=E,r.version=vle++)}function c(u,h){let d=0,f=0,p=0,_=0,v=0;const g=h.matrixWorldInverse;for(let b=0,m=u.length;b<m;b++){const y=u[b];if(y.isDirectionalLight){const A=r.directional[d];A.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(g),d++}else if(y.isSpotLight){const A=r.spot[p];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),A.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(g),p++}else if(y.isRectAreaLight){const A=r.rectArea[_];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),a.identity(),o.copy(y.matrixWorld),o.premultiply(g),a.extractRotation(o),A.halfWidth.set(y.width*.5,0,0),A.halfHeight.set(0,y.height*.5,0),A.halfWidth.applyMatrix4(a),A.halfHeight.applyMatrix4(a),_++}else if(y.isPointLight){const A=r.point[f];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),f++}else if(y.isHemisphereLight){const A=r.hemi[v];A.direction.setFromMatrixPosition(y.matrixWorld),A.direction.transformDirection(g),v++}}}return{setup:l,setupView:c,state:r}}function cU(i,e){const t=new yle(i,e),n=[],r=[];function s(){n.length=0,r.length=0}function o(h){n.push(h)}function a(h){r.push(h)}function l(h){t.setup(n,h)}function c(h){t.setupView(n,h)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function xle(i,e){let t=new WeakMap;function n(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new cU(i,e),t.set(s,[l])):o>=a.length?(l=new cU(i,e),a.push(l)):l=a[o],l}function r(){t=new WeakMap}return{get:n,dispose:r}}class ble extends Lm{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=xie,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Sle extends Lm{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const wle=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Mle=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Ale(i,e,t){let n=new o3;const r=new on,s=new on,o=new Nr,a=new ble({depthPacking:bie}),l=new Sle,c={},u=t.maxTextureSize,h={[Sc]:Ls,[Ls]:Sc,[ll]:ll},d=new ia({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new on},radius:{value:4}},vertexShader:wle,fragmentShader:Mle}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new hr;p.setAttribute("position",new Qi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new hl(p,d),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=NG;let g=this.type;this.render=function(A,w,M){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||A.length===0)return;const T=i.getRenderTarget(),E=i.getActiveCubeFace(),C=i.getActiveMipmapLevel(),N=i.state;N.setBlending(pc),N.buffers.color.setClear(1,1,1,1),N.buffers.depth.setTest(!0),N.setScissorTest(!1);const P=g!==Ql&&this.type===Ql,L=g===Ql&&this.type!==Ql;for(let R=0,F=A.length;R<F;R++){const V=A[R],G=V.shadow;if(G===void 0){console.warn("THREE.WebGLShadowMap:",V,"has no shadow.");continue}if(G.autoUpdate===!1&&G.needsUpdate===!1)continue;r.copy(G.mapSize);const U=G.getFrameExtents();if(r.multiply(U),s.copy(G.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/U.x),r.x=s.x*U.x,G.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/U.y),r.y=s.y*U.y,G.mapSize.y=s.y)),G.map===null||P===!0||L===!0){const O=this.type!==Ql?{minFilter:ei,magFilter:ei}:{};G.map!==null&&G.map.dispose(),G.map=new vl(r.x,r.y,O),G.map.texture.name=V.name+".shadowMap",G.camera.updateProjectionMatrix()}i.setRenderTarget(G.map),i.clear();const z=G.getViewportCount();for(let O=0;O<z;O++){const D=G.getViewport(O);o.set(s.x*D.x,s.y*D.y,s.x*D.z,s.y*D.w),N.viewport(o),G.updateMatrices(V,O),n=G.getFrustum(),y(w,M,G.camera,V,this.type)}G.isPointLightShadow!==!0&&this.type===Ql&&b(G,M),G.needsUpdate=!1}g=this.type,v.needsUpdate=!1,i.setRenderTarget(T,E,C)};function b(A,w){const M=e.update(_);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,f.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new vl(r.x,r.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,i.setRenderTarget(A.mapPass),i.clear(),i.renderBufferDirect(w,null,M,d,_,null),f.uniforms.shadow_pass.value=A.mapPass.texture,f.uniforms.resolution.value=A.mapSize,f.uniforms.radius.value=A.radius,i.setRenderTarget(A.map),i.clear(),i.renderBufferDirect(w,null,M,f,_,null)}function m(A,w,M,T){let E=null;const C=M.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(C!==void 0)E=C;else if(E=M.isPointLight===!0?l:a,i.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){const N=E.uuid,P=w.uuid;let L=c[N];L===void 0&&(L={},c[N]=L);let R=L[P];R===void 0&&(R=E.clone(),L[P]=R),E=R}if(E.visible=w.visible,E.wireframe=w.wireframe,T===Ql?E.side=w.shadowSide!==null?w.shadowSide:w.side:E.side=w.shadowSide!==null?w.shadowSide:h[w.side],E.alphaMap=w.alphaMap,E.alphaTest=w.alphaTest,E.map=w.map,E.clipShadows=w.clipShadows,E.clippingPlanes=w.clippingPlanes,E.clipIntersection=w.clipIntersection,E.displacementMap=w.displacementMap,E.displacementScale=w.displacementScale,E.displacementBias=w.displacementBias,E.wireframeLinewidth=w.wireframeLinewidth,E.linewidth=w.linewidth,M.isPointLight===!0&&E.isMeshDistanceMaterial===!0){const N=i.properties.get(E);N.light=M}return E}function y(A,w,M,T,E){if(A.visible===!1)return;if(A.layers.test(w.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&E===Ql)&&(!A.frustumCulled||n.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,A.matrixWorld);const P=e.update(A),L=A.material;if(Array.isArray(L)){const R=P.groups;for(let F=0,V=R.length;F<V;F++){const G=R[F],U=L[G.materialIndex];if(U&&U.visible){const z=m(A,U,T,E);i.renderBufferDirect(M,null,P,z,A,G)}}}else if(L.visible){const R=m(A,L,T,E);i.renderBufferDirect(M,null,P,R,A,null)}}const N=A.children;for(let P=0,L=N.length;P<L;P++)y(N[P],w,M,T,E)}}function Ele(i,e,t){const n=t.isWebGL2;function r(){let ee=!1;const Ge=new Nr;let Ce=null;const De=new Nr(0,0,0,0);return{setMask:function(Xe){Ce!==Xe&&!ee&&(i.colorMask(Xe,Xe,Xe,Xe),Ce=Xe)},setLocked:function(Xe){ee=Xe},setClear:function(Xe,gt,_t,Mt,J){J===!0&&(Xe*=Mt,gt*=Mt,_t*=Mt),Ge.set(Xe,gt,_t,Mt),De.equals(Ge)===!1&&(i.clearColor(Xe,gt,_t,Mt),De.copy(Ge))},reset:function(){ee=!1,Ce=null,De.set(-1,0,0,0)}}}function s(){let ee=!1,Ge=null,Ce=null,De=null;return{setTest:function(Xe){Xe?le(i.DEPTH_TEST):re(i.DEPTH_TEST)},setMask:function(Xe){Ge!==Xe&&!ee&&(i.depthMask(Xe),Ge=Xe)},setFunc:function(Xe){if(Ce!==Xe){switch(Xe){case Kne:i.depthFunc(i.NEVER);break;case Zne:i.depthFunc(i.ALWAYS);break;case Qne:i.depthFunc(i.LESS);break;case Mb:i.depthFunc(i.LEQUAL);break;case Jne:i.depthFunc(i.EQUAL);break;case eie:i.depthFunc(i.GEQUAL);break;case tie:i.depthFunc(i.GREATER);break;case nie:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Ce=Xe}},setLocked:function(Xe){ee=Xe},setClear:function(Xe){De!==Xe&&(i.clearDepth(Xe),De=Xe)},reset:function(){ee=!1,Ge=null,Ce=null,De=null}}}function o(){let ee=!1,Ge=null,Ce=null,De=null,Xe=null,gt=null,_t=null,Mt=null,J=null;return{setTest:function(ae){ee||(ae?le(i.STENCIL_TEST):re(i.STENCIL_TEST))},setMask:function(ae){Ge!==ae&&!ee&&(i.stencilMask(ae),Ge=ae)},setFunc:function(ae,ue,ye){(Ce!==ae||De!==ue||Xe!==ye)&&(i.stencilFunc(ae,ue,ye),Ce=ae,De=ue,Xe=ye)},setOp:function(ae,ue,ye){(gt!==ae||_t!==ue||Mt!==ye)&&(i.stencilOp(ae,ue,ye),gt=ae,_t=ue,Mt=ye)},setLocked:function(ae){ee=ae},setClear:function(ae){J!==ae&&(i.clearStencil(ae),J=ae)},reset:function(){ee=!1,Ge=null,Ce=null,De=null,Xe=null,gt=null,_t=null,Mt=null,J=null}}}const a=new r,l=new s,c=new o,u=new WeakMap,h=new WeakMap;let d={},f={},p=new WeakMap,_=[],v=null,g=!1,b=null,m=null,y=null,A=null,w=null,M=null,T=null,E=new $t(0,0,0),C=0,N=!1,P=null,L=null,R=null,F=null,V=null;const G=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let U=!1,z=0;const O=i.getParameter(i.VERSION);O.indexOf("WebGL")!==-1?(z=parseFloat(/^WebGL (\d)/.exec(O)[1]),U=z>=1):O.indexOf("OpenGL ES")!==-1&&(z=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),U=z>=2);let D=null,B={};const W=i.getParameter(i.SCISSOR_BOX),q=i.getParameter(i.VIEWPORT),j=new Nr().fromArray(W),te=new Nr().fromArray(q);function ne(ee,Ge,Ce,De){const Xe=new Uint8Array(4),gt=i.createTexture();i.bindTexture(ee,gt),i.texParameteri(ee,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(ee,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let _t=0;_t<Ce;_t++)n&&(ee===i.TEXTURE_3D||ee===i.TEXTURE_2D_ARRAY)?i.texImage3D(Ge,0,i.RGBA,1,1,De,0,i.RGBA,i.UNSIGNED_BYTE,Xe):i.texImage2D(Ge+_t,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Xe);return gt}const Z={};Z[i.TEXTURE_2D]=ne(i.TEXTURE_2D,i.TEXTURE_2D,1),Z[i.TEXTURE_CUBE_MAP]=ne(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Z[i.TEXTURE_2D_ARRAY]=ne(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),Z[i.TEXTURE_3D]=ne(i.TEXTURE_3D,i.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),le(i.DEPTH_TEST),l.setFunc(Mb),Me(!1),Y(jF),le(i.CULL_FACE),ge(pc);function le(ee){d[ee]!==!0&&(i.enable(ee),d[ee]=!0)}function re(ee){d[ee]!==!1&&(i.disable(ee),d[ee]=!1)}function se(ee,Ge){return f[ee]!==Ge?(i.bindFramebuffer(ee,Ge),f[ee]=Ge,n&&(ee===i.DRAW_FRAMEBUFFER&&(f[i.FRAMEBUFFER]=Ge),ee===i.FRAMEBUFFER&&(f[i.DRAW_FRAMEBUFFER]=Ge)),!0):!1}function $(ee,Ge){let Ce=_,De=!1;if(ee)if(Ce=p.get(Ge),Ce===void 0&&(Ce=[],p.set(Ge,Ce)),ee.isWebGLMultipleRenderTargets){const Xe=ee.texture;if(Ce.length!==Xe.length||Ce[0]!==i.COLOR_ATTACHMENT0){for(let gt=0,_t=Xe.length;gt<_t;gt++)Ce[gt]=i.COLOR_ATTACHMENT0+gt;Ce.length=Xe.length,De=!0}}else Ce[0]!==i.COLOR_ATTACHMENT0&&(Ce[0]=i.COLOR_ATTACHMENT0,De=!0);else Ce[0]!==i.BACK&&(Ce[0]=i.BACK,De=!0);De&&(t.isWebGL2?i.drawBuffers(Ce):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ce))}function fe(ee){return v!==ee?(i.useProgram(ee),v=ee,!0):!1}const xe={[Wh]:i.FUNC_ADD,[Fne]:i.FUNC_SUBTRACT,[kne]:i.FUNC_REVERSE_SUBTRACT};if(n)xe[YF]=i.MIN,xe[KF]=i.MAX;else{const ee=e.get("EXT_blend_minmax");ee!==null&&(xe[YF]=ee.MIN_EXT,xe[KF]=ee.MAX_EXT)}const Ie={[Une]:i.ZERO,[One]:i.ONE,[Bne]:i.SRC_COLOR,[fC]:i.SRC_ALPHA,[Wne]:i.SRC_ALPHA_SATURATE,[Hne]:i.DST_COLOR,[Gne]:i.DST_ALPHA,[zne]:i.ONE_MINUS_SRC_COLOR,[pC]:i.ONE_MINUS_SRC_ALPHA,[$ne]:i.ONE_MINUS_DST_COLOR,[Vne]:i.ONE_MINUS_DST_ALPHA,[jne]:i.CONSTANT_COLOR,[Xne]:i.ONE_MINUS_CONSTANT_COLOR,[qne]:i.CONSTANT_ALPHA,[Yne]:i.ONE_MINUS_CONSTANT_ALPHA};function ge(ee,Ge,Ce,De,Xe,gt,_t,Mt,J,ae){if(ee===pc){g===!0&&(re(i.BLEND),g=!1);return}if(g===!1&&(le(i.BLEND),g=!0),ee!==Nne){if(ee!==b||ae!==N){if((m!==Wh||w!==Wh)&&(i.blendEquation(i.FUNC_ADD),m=Wh,w=Wh),ae)switch(ee){case mc:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case dC:i.blendFunc(i.ONE,i.ONE);break;case XF:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case qF:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}else switch(ee){case mc:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case dC:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case XF:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case qF:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}y=null,A=null,M=null,T=null,E.set(0,0,0),C=0,b=ee,N=ae}return}Xe=Xe||Ge,gt=gt||Ce,_t=_t||De,(Ge!==m||Xe!==w)&&(i.blendEquationSeparate(xe[Ge],xe[Xe]),m=Ge,w=Xe),(Ce!==y||De!==A||gt!==M||_t!==T)&&(i.blendFuncSeparate(Ie[Ce],Ie[De],Ie[gt],Ie[_t]),y=Ce,A=De,M=gt,T=_t),(Mt.equals(E)===!1||J!==C)&&(i.blendColor(Mt.r,Mt.g,Mt.b,J),E.copy(Mt),C=J),b=ee,N=!1}function Oe(ee,Ge){ee.side===ll?re(i.CULL_FACE):le(i.CULL_FACE);let Ce=ee.side===Ls;Ge&&(Ce=!Ce),Me(Ce),ee.blending===mc&&ee.transparent===!1?ge(pc):ge(ee.blending,ee.blendEquation,ee.blendSrc,ee.blendDst,ee.blendEquationAlpha,ee.blendSrcAlpha,ee.blendDstAlpha,ee.blendColor,ee.blendAlpha,ee.premultipliedAlpha),l.setFunc(ee.depthFunc),l.setTest(ee.depthTest),l.setMask(ee.depthWrite),a.setMask(ee.colorWrite);const De=ee.stencilWrite;c.setTest(De),De&&(c.setMask(ee.stencilWriteMask),c.setFunc(ee.stencilFunc,ee.stencilRef,ee.stencilFuncMask),c.setOp(ee.stencilFail,ee.stencilZFail,ee.stencilZPass)),de(ee.polygonOffset,ee.polygonOffsetFactor,ee.polygonOffsetUnits),ee.alphaToCoverage===!0?le(i.SAMPLE_ALPHA_TO_COVERAGE):re(i.SAMPLE_ALPHA_TO_COVERAGE)}function Me(ee){P!==ee&&(ee?i.frontFace(i.CW):i.frontFace(i.CCW),P=ee)}function Y(ee){ee!==Ine?(le(i.CULL_FACE),ee!==L&&(ee===jF?i.cullFace(i.BACK):ee===Lne?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):re(i.CULL_FACE),L=ee}function Q(ee){ee!==R&&(U&&i.lineWidth(ee),R=ee)}function de(ee,Ge,Ce){ee?(le(i.POLYGON_OFFSET_FILL),(F!==Ge||V!==Ce)&&(i.polygonOffset(Ge,Ce),F=Ge,V=Ce)):re(i.POLYGON_OFFSET_FILL)}function Le(ee){ee?le(i.SCISSOR_TEST):re(i.SCISSOR_TEST)}function ie(ee){ee===void 0&&(ee=i.TEXTURE0+G-1),D!==ee&&(i.activeTexture(ee),D=ee)}function K(ee,Ge,Ce){Ce===void 0&&(D===null?Ce=i.TEXTURE0+G-1:Ce=D);let De=B[Ce];De===void 0&&(De={type:void 0,texture:void 0},B[Ce]=De),(De.type!==ee||De.texture!==Ge)&&(D!==Ce&&(i.activeTexture(Ce),D=Ce),i.bindTexture(ee,Ge||Z[ee]),De.type=ee,De.texture=Ge)}function be(){const ee=B[D];ee!==void 0&&ee.type!==void 0&&(i.bindTexture(ee.type,null),ee.type=void 0,ee.texture=void 0)}function Ue(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ve(){try{i.compressedTexImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ne(){try{i.texSubImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function $e(){try{i.texSubImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ee(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ze(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function nt(){try{i.texStorage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function rt(){try{i.texStorage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Be(){try{i.texImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function qe(){try{i.texImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function it(ee){j.equals(ee)===!1&&(i.scissor(ee.x,ee.y,ee.z,ee.w),j.copy(ee))}function at(ee){te.equals(ee)===!1&&(i.viewport(ee.x,ee.y,ee.z,ee.w),te.copy(ee))}function ht(ee,Ge){let Ce=h.get(Ge);Ce===void 0&&(Ce=new WeakMap,h.set(Ge,Ce));let De=Ce.get(ee);De===void 0&&(De=i.getUniformBlockIndex(Ge,ee.name),Ce.set(ee,De))}function Qe(ee,Ge){const De=h.get(Ge).get(ee);u.get(Ge)!==De&&(i.uniformBlockBinding(Ge,De,ee.__bindingPointIndex),u.set(Ge,De))}function je(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),n===!0&&(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),d={},D=null,B={},f={},p=new WeakMap,_=[],v=null,g=!1,b=null,m=null,y=null,A=null,w=null,M=null,T=null,E=new $t(0,0,0),C=0,N=!1,P=null,L=null,R=null,F=null,V=null,j.set(0,0,i.canvas.width,i.canvas.height),te.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:le,disable:re,bindFramebuffer:se,drawBuffers:$,useProgram:fe,setBlending:ge,setMaterial:Oe,setFlipSided:Me,setCullFace:Y,setLineWidth:Q,setPolygonOffset:de,setScissorTest:Le,activeTexture:ie,bindTexture:K,unbindTexture:be,compressedTexImage2D:Ue,compressedTexImage3D:ve,texImage2D:Be,texImage3D:qe,updateUBOMapping:ht,uniformBlockBinding:Qe,texStorage2D:nt,texStorage3D:rt,texSubImage2D:Ne,texSubImage3D:$e,compressedTexSubImage2D:Ee,compressedTexSubImage3D:Ze,scissor:it,viewport:at,reset:je}}function Tle(i,e,t,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let _;const v=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(ie,K){return g?new OffscreenCanvas(ie,K):Pb("canvas")}function m(ie,K,be,Ue){let ve=1;if((ie.width>Ue||ie.height>Ue)&&(ve=Ue/Math.max(ie.width,ie.height)),ve<1||K===!0)if(typeof HTMLImageElement<"u"&&ie instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ie instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ie instanceof ImageBitmap){const Ne=K?bC:Math.floor,$e=Ne(ve*ie.width),Ee=Ne(ve*ie.height);_===void 0&&(_=b($e,Ee));const Ze=be?b($e,Ee):_;return Ze.width=$e,Ze.height=Ee,Ze.getContext("2d").drawImage(ie,0,0,$e,Ee),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ie.width+"x"+ie.height+") to ("+$e+"x"+Ee+")."),Ze}else return"data"in ie&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ie.width+"x"+ie.height+")."),ie;return ie}function y(ie){return Ak(ie.width)&&Ak(ie.height)}function A(ie){return a?!1:ie.wrapS!==La||ie.wrapT!==La||ie.minFilter!==ei&&ie.minFilter!==cs}function w(ie,K){return ie.generateMipmaps&&K&&ie.minFilter!==ei&&ie.minFilter!==cs}function M(ie){i.generateMipmap(ie)}function T(ie,K,be,Ue,ve=!1){if(a===!1)return K;if(ie!==null){if(i[ie]!==void 0)return i[ie];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ie+"'")}let Ne=K;if(K===i.RED&&(be===i.FLOAT&&(Ne=i.R32F),be===i.HALF_FLOAT&&(Ne=i.R16F),be===i.UNSIGNED_BYTE&&(Ne=i.R8)),K===i.RED_INTEGER&&(be===i.UNSIGNED_BYTE&&(Ne=i.R8UI),be===i.UNSIGNED_SHORT&&(Ne=i.R16UI),be===i.UNSIGNED_INT&&(Ne=i.R32UI),be===i.BYTE&&(Ne=i.R8I),be===i.SHORT&&(Ne=i.R16I),be===i.INT&&(Ne=i.R32I)),K===i.RG&&(be===i.FLOAT&&(Ne=i.RG32F),be===i.HALF_FLOAT&&(Ne=i.RG16F),be===i.UNSIGNED_BYTE&&(Ne=i.RG8)),K===i.RGBA){const $e=ve?Ab:Kn.getTransfer(Ue);be===i.FLOAT&&(Ne=i.RGBA32F),be===i.HALF_FLOAT&&(Ne=i.RGBA16F),be===i.UNSIGNED_BYTE&&(Ne=$e===ai?i.SRGB8_ALPHA8:i.RGBA8),be===i.UNSIGNED_SHORT_4_4_4_4&&(Ne=i.RGBA4),be===i.UNSIGNED_SHORT_5_5_5_1&&(Ne=i.RGB5_A1)}return(Ne===i.R16F||Ne===i.R32F||Ne===i.RG16F||Ne===i.RG32F||Ne===i.RGBA16F||Ne===i.RGBA32F)&&e.get("EXT_color_buffer_float"),Ne}function E(ie,K,be){return w(ie,be)===!0||ie.isFramebufferTexture&&ie.minFilter!==ei&&ie.minFilter!==cs?Math.log2(Math.max(K.width,K.height))+1:ie.mipmaps!==void 0&&ie.mipmaps.length>0?ie.mipmaps.length:ie.isCompressedTexture&&Array.isArray(ie.image)?K.mipmaps.length:1}function C(ie){return ie===ei||ie===ZF||ie===EM?i.NEAREST:i.LINEAR}function N(ie){const K=ie.target;K.removeEventListener("dispose",N),L(K),K.isVideoTexture&&p.delete(K)}function P(ie){const K=ie.target;K.removeEventListener("dispose",P),F(K)}function L(ie){const K=n.get(ie);if(K.__webglInit===void 0)return;const be=ie.source,Ue=v.get(be);if(Ue){const ve=Ue[K.__cacheKey];ve.usedTimes--,ve.usedTimes===0&&R(ie),Object.keys(Ue).length===0&&v.delete(be)}n.remove(ie)}function R(ie){const K=n.get(ie);i.deleteTexture(K.__webglTexture);const be=ie.source,Ue=v.get(be);delete Ue[K.__cacheKey],o.memory.textures--}function F(ie){const K=ie.texture,be=n.get(ie),Ue=n.get(K);if(Ue.__webglTexture!==void 0&&(i.deleteTexture(Ue.__webglTexture),o.memory.textures--),ie.depthTexture&&ie.depthTexture.dispose(),ie.isWebGLCubeRenderTarget)for(let ve=0;ve<6;ve++){if(Array.isArray(be.__webglFramebuffer[ve]))for(let Ne=0;Ne<be.__webglFramebuffer[ve].length;Ne++)i.deleteFramebuffer(be.__webglFramebuffer[ve][Ne]);else i.deleteFramebuffer(be.__webglFramebuffer[ve]);be.__webglDepthbuffer&&i.deleteRenderbuffer(be.__webglDepthbuffer[ve])}else{if(Array.isArray(be.__webglFramebuffer))for(let ve=0;ve<be.__webglFramebuffer.length;ve++)i.deleteFramebuffer(be.__webglFramebuffer[ve]);else i.deleteFramebuffer(be.__webglFramebuffer);if(be.__webglDepthbuffer&&i.deleteRenderbuffer(be.__webglDepthbuffer),be.__webglMultisampledFramebuffer&&i.deleteFramebuffer(be.__webglMultisampledFramebuffer),be.__webglColorRenderbuffer)for(let ve=0;ve<be.__webglColorRenderbuffer.length;ve++)be.__webglColorRenderbuffer[ve]&&i.deleteRenderbuffer(be.__webglColorRenderbuffer[ve]);be.__webglDepthRenderbuffer&&i.deleteRenderbuffer(be.__webglDepthRenderbuffer)}if(ie.isWebGLMultipleRenderTargets)for(let ve=0,Ne=K.length;ve<Ne;ve++){const $e=n.get(K[ve]);$e.__webglTexture&&(i.deleteTexture($e.__webglTexture),o.memory.textures--),n.remove(K[ve])}n.remove(K),n.remove(ie)}let V=0;function G(){V=0}function U(){const ie=V;return ie>=l&&console.warn("THREE.WebGLTextures: Trying to use "+ie+" texture units while this GPU supports only "+l),V+=1,ie}function z(ie){const K=[];return K.push(ie.wrapS),K.push(ie.wrapT),K.push(ie.wrapR||0),K.push(ie.magFilter),K.push(ie.minFilter),K.push(ie.anisotropy),K.push(ie.internalFormat),K.push(ie.format),K.push(ie.type),K.push(ie.generateMipmaps),K.push(ie.premultiplyAlpha),K.push(ie.flipY),K.push(ie.unpackAlignment),K.push(ie.colorSpace),K.join()}function O(ie,K){const be=n.get(ie);if(ie.isVideoTexture&&de(ie),ie.isRenderTargetTexture===!1&&ie.version>0&&be.__version!==ie.version){const Ue=ie.image;if(Ue===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ue.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{le(be,ie,K);return}}t.bindTexture(i.TEXTURE_2D,be.__webglTexture,i.TEXTURE0+K)}function D(ie,K){const be=n.get(ie);if(ie.version>0&&be.__version!==ie.version){le(be,ie,K);return}t.bindTexture(i.TEXTURE_2D_ARRAY,be.__webglTexture,i.TEXTURE0+K)}function B(ie,K){const be=n.get(ie);if(ie.version>0&&be.__version!==ie.version){le(be,ie,K);return}t.bindTexture(i.TEXTURE_3D,be.__webglTexture,i.TEXTURE0+K)}function W(ie,K){const be=n.get(ie);if(ie.version>0&&be.__version!==ie.version){re(be,ie,K);return}t.bindTexture(i.TEXTURE_CUBE_MAP,be.__webglTexture,i.TEXTURE0+K)}const q={[vC]:i.REPEAT,[La]:i.CLAMP_TO_EDGE,[_C]:i.MIRRORED_REPEAT},j={[ei]:i.NEAREST,[ZF]:i.NEAREST_MIPMAP_NEAREST,[EM]:i.NEAREST_MIPMAP_LINEAR,[cs]:i.LINEAR,[uie]:i.LINEAR_MIPMAP_NEAREST,[m1]:i.LINEAR_MIPMAP_LINEAR},te={[Mie]:i.NEVER,[Iie]:i.ALWAYS,[Aie]:i.LESS,[Tie]:i.LEQUAL,[Eie]:i.EQUAL,[Rie]:i.GEQUAL,[Cie]:i.GREATER,[Pie]:i.NOTEQUAL};function ne(ie,K,be){if(be?(i.texParameteri(ie,i.TEXTURE_WRAP_S,q[K.wrapS]),i.texParameteri(ie,i.TEXTURE_WRAP_T,q[K.wrapT]),(ie===i.TEXTURE_3D||ie===i.TEXTURE_2D_ARRAY)&&i.texParameteri(ie,i.TEXTURE_WRAP_R,q[K.wrapR]),i.texParameteri(ie,i.TEXTURE_MAG_FILTER,j[K.magFilter]),i.texParameteri(ie,i.TEXTURE_MIN_FILTER,j[K.minFilter])):(i.texParameteri(ie,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(ie,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(ie===i.TEXTURE_3D||ie===i.TEXTURE_2D_ARRAY)&&i.texParameteri(ie,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),(K.wrapS!==La||K.wrapT!==La)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(ie,i.TEXTURE_MAG_FILTER,C(K.magFilter)),i.texParameteri(ie,i.TEXTURE_MIN_FILTER,C(K.minFilter)),K.minFilter!==ei&&K.minFilter!==cs&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),K.compareFunction&&(i.texParameteri(ie,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(ie,i.TEXTURE_COMPARE_FUNC,te[K.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Ue=e.get("EXT_texture_filter_anisotropic");if(K.magFilter===ei||K.minFilter!==EM&&K.minFilter!==m1||K.type===ka&&e.has("OES_texture_float_linear")===!1||a===!1&&K.type===Rd&&e.has("OES_texture_half_float_linear")===!1)return;(K.anisotropy>1||n.get(K).__currentAnisotropy)&&(i.texParameterf(ie,Ue.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(K.anisotropy,r.getMaxAnisotropy())),n.get(K).__currentAnisotropy=K.anisotropy)}}function Z(ie,K){let be=!1;ie.__webglInit===void 0&&(ie.__webglInit=!0,K.addEventListener("dispose",N));const Ue=K.source;let ve=v.get(Ue);ve===void 0&&(ve={},v.set(Ue,ve));const Ne=z(K);if(Ne!==ie.__cacheKey){ve[Ne]===void 0&&(ve[Ne]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,be=!0),ve[Ne].usedTimes++;const $e=ve[ie.__cacheKey];$e!==void 0&&(ve[ie.__cacheKey].usedTimes--,$e.usedTimes===0&&R(K)),ie.__cacheKey=Ne,ie.__webglTexture=ve[Ne].texture}return be}function le(ie,K,be){let Ue=i.TEXTURE_2D;(K.isDataArrayTexture||K.isCompressedArrayTexture)&&(Ue=i.TEXTURE_2D_ARRAY),K.isData3DTexture&&(Ue=i.TEXTURE_3D);const ve=Z(ie,K),Ne=K.source;t.bindTexture(Ue,ie.__webglTexture,i.TEXTURE0+be);const $e=n.get(Ne);if(Ne.version!==$e.__version||ve===!0){t.activeTexture(i.TEXTURE0+be);const Ee=Kn.getPrimaries(Kn.workingColorSpace),Ze=K.colorSpace===ea?null:Kn.getPrimaries(K.colorSpace),nt=K.colorSpace===ea||Ee===Ze?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,K.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,K.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,nt);const rt=A(K)&&y(K.image)===!1;let Be=m(K.image,rt,!1,u);Be=Le(K,Be);const qe=y(Be)||a,it=s.convert(K.format,K.colorSpace);let at=s.convert(K.type),ht=T(K.internalFormat,it,at,K.colorSpace,K.isVideoTexture);ne(Ue,K,qe);let Qe;const je=K.mipmaps,ee=a&&K.isVideoTexture!==!0,Ge=$e.__version===void 0||ve===!0,Ce=E(K,Be,qe);if(K.isDepthTexture)ht=i.DEPTH_COMPONENT,a?K.type===ka?ht=i.DEPTH_COMPONENT32F:K.type===vu?ht=i.DEPTH_COMPONENT24:K.type===dd?ht=i.DEPTH24_STENCIL8:ht=i.DEPTH_COMPONENT16:K.type===ka&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),K.format===fd&&ht===i.DEPTH_COMPONENT&&K.type!==i3&&K.type!==vu&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),K.type=vu,at=s.convert(K.type)),K.format===pm&&ht===i.DEPTH_COMPONENT&&(ht=i.DEPTH_STENCIL,K.type!==dd&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),K.type=dd,at=s.convert(K.type))),Ge&&(ee?t.texStorage2D(i.TEXTURE_2D,1,ht,Be.width,Be.height):t.texImage2D(i.TEXTURE_2D,0,ht,Be.width,Be.height,0,it,at,null));else if(K.isDataTexture)if(je.length>0&&qe){ee&&Ge&&t.texStorage2D(i.TEXTURE_2D,Ce,ht,je[0].width,je[0].height);for(let De=0,Xe=je.length;De<Xe;De++)Qe=je[De],ee?t.texSubImage2D(i.TEXTURE_2D,De,0,0,Qe.width,Qe.height,it,at,Qe.data):t.texImage2D(i.TEXTURE_2D,De,ht,Qe.width,Qe.height,0,it,at,Qe.data);K.generateMipmaps=!1}else ee?(Ge&&t.texStorage2D(i.TEXTURE_2D,Ce,ht,Be.width,Be.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,Be.width,Be.height,it,at,Be.data)):t.texImage2D(i.TEXTURE_2D,0,ht,Be.width,Be.height,0,it,at,Be.data);else if(K.isCompressedTexture)if(K.isCompressedArrayTexture){ee&&Ge&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Ce,ht,je[0].width,je[0].height,Be.depth);for(let De=0,Xe=je.length;De<Xe;De++)Qe=je[De],K.format!==Zs?it!==null?ee?t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,De,0,0,0,Qe.width,Qe.height,Be.depth,it,Qe.data,0,0):t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,De,ht,Qe.width,Qe.height,Be.depth,0,Qe.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ee?t.texSubImage3D(i.TEXTURE_2D_ARRAY,De,0,0,0,Qe.width,Qe.height,Be.depth,it,at,Qe.data):t.texImage3D(i.TEXTURE_2D_ARRAY,De,ht,Qe.width,Qe.height,Be.depth,0,it,at,Qe.data)}else{ee&&Ge&&t.texStorage2D(i.TEXTURE_2D,Ce,ht,je[0].width,je[0].height);for(let De=0,Xe=je.length;De<Xe;De++)Qe=je[De],K.format!==Zs?it!==null?ee?t.compressedTexSubImage2D(i.TEXTURE_2D,De,0,0,Qe.width,Qe.height,it,Qe.data):t.compressedTexImage2D(i.TEXTURE_2D,De,ht,Qe.width,Qe.height,0,Qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ee?t.texSubImage2D(i.TEXTURE_2D,De,0,0,Qe.width,Qe.height,it,at,Qe.data):t.texImage2D(i.TEXTURE_2D,De,ht,Qe.width,Qe.height,0,it,at,Qe.data)}else if(K.isDataArrayTexture)ee?(Ge&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Ce,ht,Be.width,Be.height,Be.depth),t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Be.width,Be.height,Be.depth,it,at,Be.data)):t.texImage3D(i.TEXTURE_2D_ARRAY,0,ht,Be.width,Be.height,Be.depth,0,it,at,Be.data);else if(K.isData3DTexture)ee?(Ge&&t.texStorage3D(i.TEXTURE_3D,Ce,ht,Be.width,Be.height,Be.depth),t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Be.width,Be.height,Be.depth,it,at,Be.data)):t.texImage3D(i.TEXTURE_3D,0,ht,Be.width,Be.height,Be.depth,0,it,at,Be.data);else if(K.isFramebufferTexture){if(Ge)if(ee)t.texStorage2D(i.TEXTURE_2D,Ce,ht,Be.width,Be.height);else{let De=Be.width,Xe=Be.height;for(let gt=0;gt<Ce;gt++)t.texImage2D(i.TEXTURE_2D,gt,ht,De,Xe,0,it,at,null),De>>=1,Xe>>=1}}else if(je.length>0&&qe){ee&&Ge&&t.texStorage2D(i.TEXTURE_2D,Ce,ht,je[0].width,je[0].height);for(let De=0,Xe=je.length;De<Xe;De++)Qe=je[De],ee?t.texSubImage2D(i.TEXTURE_2D,De,0,0,it,at,Qe):t.texImage2D(i.TEXTURE_2D,De,ht,it,at,Qe);K.generateMipmaps=!1}else ee?(Ge&&t.texStorage2D(i.TEXTURE_2D,Ce,ht,Be.width,Be.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,it,at,Be)):t.texImage2D(i.TEXTURE_2D,0,ht,it,at,Be);w(K,qe)&&M(Ue),$e.__version=Ne.version,K.onUpdate&&K.onUpdate(K)}ie.__version=K.version}function re(ie,K,be){if(K.image.length!==6)return;const Ue=Z(ie,K),ve=K.source;t.bindTexture(i.TEXTURE_CUBE_MAP,ie.__webglTexture,i.TEXTURE0+be);const Ne=n.get(ve);if(ve.version!==Ne.__version||Ue===!0){t.activeTexture(i.TEXTURE0+be);const $e=Kn.getPrimaries(Kn.workingColorSpace),Ee=K.colorSpace===ea?null:Kn.getPrimaries(K.colorSpace),Ze=K.colorSpace===ea||$e===Ee?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,K.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,K.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ze);const nt=K.isCompressedTexture||K.image[0].isCompressedTexture,rt=K.image[0]&&K.image[0].isDataTexture,Be=[];for(let De=0;De<6;De++)!nt&&!rt?Be[De]=m(K.image[De],!1,!0,c):Be[De]=rt?K.image[De].image:K.image[De],Be[De]=Le(K,Be[De]);const qe=Be[0],it=y(qe)||a,at=s.convert(K.format,K.colorSpace),ht=s.convert(K.type),Qe=T(K.internalFormat,at,ht,K.colorSpace),je=a&&K.isVideoTexture!==!0,ee=Ne.__version===void 0||Ue===!0;let Ge=E(K,qe,it);ne(i.TEXTURE_CUBE_MAP,K,it);let Ce;if(nt){je&&ee&&t.texStorage2D(i.TEXTURE_CUBE_MAP,Ge,Qe,qe.width,qe.height);for(let De=0;De<6;De++){Ce=Be[De].mipmaps;for(let Xe=0;Xe<Ce.length;Xe++){const gt=Ce[Xe];K.format!==Zs?at!==null?je?t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Xe,0,0,gt.width,gt.height,at,gt.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Xe,Qe,gt.width,gt.height,0,gt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Xe,0,0,gt.width,gt.height,at,ht,gt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Xe,Qe,gt.width,gt.height,0,at,ht,gt.data)}}}else{Ce=K.mipmaps,je&&ee&&(Ce.length>0&&Ge++,t.texStorage2D(i.TEXTURE_CUBE_MAP,Ge,Qe,Be[0].width,Be[0].height));for(let De=0;De<6;De++)if(rt){je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,0,0,Be[De].width,Be[De].height,at,ht,Be[De].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,Qe,Be[De].width,Be[De].height,0,at,ht,Be[De].data);for(let Xe=0;Xe<Ce.length;Xe++){const _t=Ce[Xe].image[De].image;je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Xe+1,0,0,_t.width,_t.height,at,ht,_t.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Xe+1,Qe,_t.width,_t.height,0,at,ht,_t.data)}}else{je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,0,0,at,ht,Be[De]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,Qe,at,ht,Be[De]);for(let Xe=0;Xe<Ce.length;Xe++){const gt=Ce[Xe];je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Xe+1,0,0,at,ht,gt.image[De]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+De,Xe+1,Qe,at,ht,gt.image[De])}}}w(K,it)&&M(i.TEXTURE_CUBE_MAP),Ne.__version=ve.version,K.onUpdate&&K.onUpdate(K)}ie.__version=K.version}function se(ie,K,be,Ue,ve,Ne){const $e=s.convert(be.format,be.colorSpace),Ee=s.convert(be.type),Ze=T(be.internalFormat,$e,Ee,be.colorSpace);if(!n.get(K).__hasExternalTextures){const rt=Math.max(1,K.width>>Ne),Be=Math.max(1,K.height>>Ne);ve===i.TEXTURE_3D||ve===i.TEXTURE_2D_ARRAY?t.texImage3D(ve,Ne,Ze,rt,Be,K.depth,0,$e,Ee,null):t.texImage2D(ve,Ne,Ze,rt,Be,0,$e,Ee,null)}t.bindFramebuffer(i.FRAMEBUFFER,ie),Q(K)?d.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Ue,ve,n.get(be).__webglTexture,0,Y(K)):(ve===i.TEXTURE_2D||ve>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&ve<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Ue,ve,n.get(be).__webglTexture,Ne),t.bindFramebuffer(i.FRAMEBUFFER,null)}function $(ie,K,be){if(i.bindRenderbuffer(i.RENDERBUFFER,ie),K.depthBuffer&&!K.stencilBuffer){let Ue=a===!0?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT16;if(be||Q(K)){const ve=K.depthTexture;ve&&ve.isDepthTexture&&(ve.type===ka?Ue=i.DEPTH_COMPONENT32F:ve.type===vu&&(Ue=i.DEPTH_COMPONENT24));const Ne=Y(K);Q(K)?d.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Ne,Ue,K.width,K.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,Ne,Ue,K.width,K.height)}else i.renderbufferStorage(i.RENDERBUFFER,Ue,K.width,K.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,ie)}else if(K.depthBuffer&&K.stencilBuffer){const Ue=Y(K);be&&Q(K)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Ue,i.DEPTH24_STENCIL8,K.width,K.height):Q(K)?d.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Ue,i.DEPTH24_STENCIL8,K.width,K.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,K.width,K.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,ie)}else{const Ue=K.isWebGLMultipleRenderTargets===!0?K.texture:[K.texture];for(let ve=0;ve<Ue.length;ve++){const Ne=Ue[ve],$e=s.convert(Ne.format,Ne.colorSpace),Ee=s.convert(Ne.type),Ze=T(Ne.internalFormat,$e,Ee,Ne.colorSpace),nt=Y(K);be&&Q(K)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,nt,Ze,K.width,K.height):Q(K)?d.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,nt,Ze,K.width,K.height):i.renderbufferStorage(i.RENDERBUFFER,Ze,K.width,K.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function fe(ie,K){if(K&&K.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,ie),!(K.depthTexture&&K.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(K.depthTexture).__webglTexture||K.depthTexture.image.width!==K.width||K.depthTexture.image.height!==K.height)&&(K.depthTexture.image.width=K.width,K.depthTexture.image.height=K.height,K.depthTexture.needsUpdate=!0),O(K.depthTexture,0);const Ue=n.get(K.depthTexture).__webglTexture,ve=Y(K);if(K.depthTexture.format===fd)Q(K)?d.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Ue,0,ve):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Ue,0);else if(K.depthTexture.format===pm)Q(K)?d.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Ue,0,ve):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Ue,0);else throw new Error("Unknown depthTexture format")}function xe(ie){const K=n.get(ie),be=ie.isWebGLCubeRenderTarget===!0;if(ie.depthTexture&&!K.__autoAllocateDepthBuffer){if(be)throw new Error("target.depthTexture not supported in Cube render targets");fe(K.__webglFramebuffer,ie)}else if(be){K.__webglDepthbuffer=[];for(let Ue=0;Ue<6;Ue++)t.bindFramebuffer(i.FRAMEBUFFER,K.__webglFramebuffer[Ue]),K.__webglDepthbuffer[Ue]=i.createRenderbuffer(),$(K.__webglDepthbuffer[Ue],ie,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,K.__webglFramebuffer),K.__webglDepthbuffer=i.createRenderbuffer(),$(K.__webglDepthbuffer,ie,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}function Ie(ie,K,be){const Ue=n.get(ie);K!==void 0&&se(Ue.__webglFramebuffer,ie,ie.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),be!==void 0&&xe(ie)}function ge(ie){const K=ie.texture,be=n.get(ie),Ue=n.get(K);ie.addEventListener("dispose",P),ie.isWebGLMultipleRenderTargets!==!0&&(Ue.__webglTexture===void 0&&(Ue.__webglTexture=i.createTexture()),Ue.__version=K.version,o.memory.textures++);const ve=ie.isWebGLCubeRenderTarget===!0,Ne=ie.isWebGLMultipleRenderTargets===!0,$e=y(ie)||a;if(ve){be.__webglFramebuffer=[];for(let Ee=0;Ee<6;Ee++)if(a&&K.mipmaps&&K.mipmaps.length>0){be.__webglFramebuffer[Ee]=[];for(let Ze=0;Ze<K.mipmaps.length;Ze++)be.__webglFramebuffer[Ee][Ze]=i.createFramebuffer()}else be.__webglFramebuffer[Ee]=i.createFramebuffer()}else{if(a&&K.mipmaps&&K.mipmaps.length>0){be.__webglFramebuffer=[];for(let Ee=0;Ee<K.mipmaps.length;Ee++)be.__webglFramebuffer[Ee]=i.createFramebuffer()}else be.__webglFramebuffer=i.createFramebuffer();if(Ne)if(r.drawBuffers){const Ee=ie.texture;for(let Ze=0,nt=Ee.length;Ze<nt;Ze++){const rt=n.get(Ee[Ze]);rt.__webglTexture===void 0&&(rt.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&ie.samples>0&&Q(ie)===!1){const Ee=Ne?K:[K];be.__webglMultisampledFramebuffer=i.createFramebuffer(),be.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,be.__webglMultisampledFramebuffer);for(let Ze=0;Ze<Ee.length;Ze++){const nt=Ee[Ze];be.__webglColorRenderbuffer[Ze]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,be.__webglColorRenderbuffer[Ze]);const rt=s.convert(nt.format,nt.colorSpace),Be=s.convert(nt.type),qe=T(nt.internalFormat,rt,Be,nt.colorSpace,ie.isXRRenderTarget===!0),it=Y(ie);i.renderbufferStorageMultisample(i.RENDERBUFFER,it,qe,ie.width,ie.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ze,i.RENDERBUFFER,be.__webglColorRenderbuffer[Ze])}i.bindRenderbuffer(i.RENDERBUFFER,null),ie.depthBuffer&&(be.__webglDepthRenderbuffer=i.createRenderbuffer(),$(be.__webglDepthRenderbuffer,ie,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(ve){t.bindTexture(i.TEXTURE_CUBE_MAP,Ue.__webglTexture),ne(i.TEXTURE_CUBE_MAP,K,$e);for(let Ee=0;Ee<6;Ee++)if(a&&K.mipmaps&&K.mipmaps.length>0)for(let Ze=0;Ze<K.mipmaps.length;Ze++)se(be.__webglFramebuffer[Ee][Ze],ie,K,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Ze);else se(be.__webglFramebuffer[Ee],ie,K,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0);w(K,$e)&&M(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ne){const Ee=ie.texture;for(let Ze=0,nt=Ee.length;Ze<nt;Ze++){const rt=Ee[Ze],Be=n.get(rt);t.bindTexture(i.TEXTURE_2D,Be.__webglTexture),ne(i.TEXTURE_2D,rt,$e),se(be.__webglFramebuffer,ie,rt,i.COLOR_ATTACHMENT0+Ze,i.TEXTURE_2D,0),w(rt,$e)&&M(i.TEXTURE_2D)}t.unbindTexture()}else{let Ee=i.TEXTURE_2D;if((ie.isWebGL3DRenderTarget||ie.isWebGLArrayRenderTarget)&&(a?Ee=ie.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Ee,Ue.__webglTexture),ne(Ee,K,$e),a&&K.mipmaps&&K.mipmaps.length>0)for(let Ze=0;Ze<K.mipmaps.length;Ze++)se(be.__webglFramebuffer[Ze],ie,K,i.COLOR_ATTACHMENT0,Ee,Ze);else se(be.__webglFramebuffer,ie,K,i.COLOR_ATTACHMENT0,Ee,0);w(K,$e)&&M(Ee),t.unbindTexture()}ie.depthBuffer&&xe(ie)}function Oe(ie){const K=y(ie)||a,be=ie.isWebGLMultipleRenderTargets===!0?ie.texture:[ie.texture];for(let Ue=0,ve=be.length;Ue<ve;Ue++){const Ne=be[Ue];if(w(Ne,K)){const $e=ie.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,Ee=n.get(Ne).__webglTexture;t.bindTexture($e,Ee),M($e),t.unbindTexture()}}}function Me(ie){if(a&&ie.samples>0&&Q(ie)===!1){const K=ie.isWebGLMultipleRenderTargets?ie.texture:[ie.texture],be=ie.width,Ue=ie.height;let ve=i.COLOR_BUFFER_BIT;const Ne=[],$e=ie.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Ee=n.get(ie),Ze=ie.isWebGLMultipleRenderTargets===!0;if(Ze)for(let nt=0;nt<K.length;nt++)t.bindFramebuffer(i.FRAMEBUFFER,Ee.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+nt,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Ee.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+nt,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Ee.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ee.__webglFramebuffer);for(let nt=0;nt<K.length;nt++){Ne.push(i.COLOR_ATTACHMENT0+nt),ie.depthBuffer&&Ne.push($e);const rt=Ee.__ignoreDepthValues!==void 0?Ee.__ignoreDepthValues:!1;if(rt===!1&&(ie.depthBuffer&&(ve|=i.DEPTH_BUFFER_BIT),ie.stencilBuffer&&(ve|=i.STENCIL_BUFFER_BIT)),Ze&&i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Ee.__webglColorRenderbuffer[nt]),rt===!0&&(i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[$e]),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[$e])),Ze){const Be=n.get(K[nt]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Be,0)}i.blitFramebuffer(0,0,be,Ue,0,0,be,Ue,ve,i.NEAREST),f&&i.invalidateFramebuffer(i.READ_FRAMEBUFFER,Ne)}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),Ze)for(let nt=0;nt<K.length;nt++){t.bindFramebuffer(i.FRAMEBUFFER,Ee.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+nt,i.RENDERBUFFER,Ee.__webglColorRenderbuffer[nt]);const rt=n.get(K[nt]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Ee.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+nt,i.TEXTURE_2D,rt,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ee.__webglMultisampledFramebuffer)}}function Y(ie){return Math.min(h,ie.samples)}function Q(ie){const K=n.get(ie);return a&&ie.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&K.__useRenderToTexture!==!1}function de(ie){const K=o.render.frame;p.get(ie)!==K&&(p.set(ie,K),ie.update())}function Le(ie,K){const be=ie.colorSpace,Ue=ie.format,ve=ie.type;return ie.isCompressedTexture===!0||ie.isVideoTexture===!0||ie.format===yC||be!==wc&&be!==ea&&(Kn.getTransfer(be)===ai?a===!1?e.has("EXT_sRGB")===!0&&Ue===Zs?(ie.format=yC,ie.minFilter=cs,ie.generateMipmaps=!1):K=WG.sRGBToLinear(K):(Ue!==Zs||ve!==Ba)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",be)),K}this.allocateTextureUnit=U,this.resetTextureUnits=G,this.setTexture2D=O,this.setTexture2DArray=D,this.setTexture3D=B,this.setTextureCube=W,this.rebindTextures=Ie,this.setupRenderTarget=ge,this.updateRenderTargetMipmap=Oe,this.updateMultisampleRenderTarget=Me,this.setupDepthRenderbuffer=xe,this.setupFrameBufferTexture=se,this.useMultisampledRTT=Q}function Cle(i,e,t){const n=t.isWebGL2;function r(s,o=ea){let a;const l=Kn.getTransfer(o);if(s===Ba)return i.UNSIGNED_BYTE;if(s===OG)return i.UNSIGNED_SHORT_4_4_4_4;if(s===BG)return i.UNSIGNED_SHORT_5_5_5_1;if(s===hie)return i.BYTE;if(s===die)return i.SHORT;if(s===i3)return i.UNSIGNED_SHORT;if(s===UG)return i.INT;if(s===vu)return i.UNSIGNED_INT;if(s===ka)return i.FLOAT;if(s===Rd)return n?i.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===fie)return i.ALPHA;if(s===Zs)return i.RGBA;if(s===pie)return i.LUMINANCE;if(s===mie)return i.LUMINANCE_ALPHA;if(s===fd)return i.DEPTH_COMPONENT;if(s===pm)return i.DEPTH_STENCIL;if(s===yC)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===gie)return i.RED;if(s===zG)return i.RED_INTEGER;if(s===vie)return i.RG;if(s===GG)return i.RG_INTEGER;if(s===VG)return i.RGBA_INTEGER;if(s===TM||s===CM||s===PM||s===RM)if(l===ai)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===TM)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===CM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===PM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===RM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===TM)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===CM)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===PM)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===RM)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===QF||s===JF||s===ek||s===tk)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===QF)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===JF)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===ek)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===tk)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===_ie)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===nk||s===ik)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===nk)return l===ai?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===ik)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===rk||s===sk||s===ok||s===ak||s===lk||s===ck||s===uk||s===hk||s===dk||s===fk||s===pk||s===mk||s===gk||s===vk)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===rk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===sk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===ok)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===ak)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===lk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===ck)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===uk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===hk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===dk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===fk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===pk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===mk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===gk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===vk)return l===ai?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===IM||s===_k||s===yk)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===IM)return l===ai?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===_k)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===yk)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===yie||s===xk||s===bk||s===Sk)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===IM)return a.COMPRESSED_RED_RGTC1_EXT;if(s===xk)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===bk)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===Sk)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===dd?n?i.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[s]!==void 0?i[s]:null}return{convert:r}}class Ple extends Ys{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Zn extends Or{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Rle={type:"move"};class tA{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Zn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Zn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new me,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new me),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Zn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new me,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new me),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const _ of e.hand.values()){const v=t.getJointPose(_,n),g=this._getHandJoint(c,_);v!==null&&(g.matrix.fromArray(v.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=v.radius),g.visible=v!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),f=.02,p=.005;c.inputState.pinching&&d>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Rle)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Zn;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Ile extends Ds{constructor(e,t,n,r,s,o,a,l,c,u){if(u=u!==void 0?u:fd,u!==fd&&u!==pm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===fd&&(n=vu),n===void 0&&u===pm&&(n=dd),super(null,r,s,o,a,l,u,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:ei,this.minFilter=l!==void 0?l:ei,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class Lle extends Im{constructor(e,t){super();const n=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,h=null,d=null,f=null,p=null;const _=t.getContextAttributes();let v=null,g=null;const b=[],m=[],y=new Ys;y.layers.enable(1),y.viewport=new Nr;const A=new Ys;A.layers.enable(2),A.viewport=new Nr;const w=[y,A],M=new Ple;M.layers.enable(1),M.layers.enable(2);let T=null,E=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(D){let B=b[D];return B===void 0&&(B=new tA,b[D]=B),B.getTargetRaySpace()},this.getControllerGrip=function(D){let B=b[D];return B===void 0&&(B=new tA,b[D]=B),B.getGripSpace()},this.getHand=function(D){let B=b[D];return B===void 0&&(B=new tA,b[D]=B),B.getHandSpace()};function C(D){const B=m.indexOf(D.inputSource);if(B===-1)return;const W=b[B];W!==void 0&&(W.update(D.inputSource,D.frame,c||o),W.dispatchEvent({type:D.type,data:D.inputSource}))}function N(){r.removeEventListener("select",C),r.removeEventListener("selectstart",C),r.removeEventListener("selectend",C),r.removeEventListener("squeeze",C),r.removeEventListener("squeezestart",C),r.removeEventListener("squeezeend",C),r.removeEventListener("end",N),r.removeEventListener("inputsourceschange",P);for(let D=0;D<b.length;D++){const B=m[D];B!==null&&(m[D]=null,b[D].disconnect(B))}T=null,E=null,e.setRenderTarget(v),f=null,d=null,h=null,r=null,g=null,O.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(D){s=D,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(D){a=D,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(D){c=D},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(D){if(r=D,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",C),r.addEventListener("selectstart",C),r.addEventListener("selectend",C),r.addEventListener("squeeze",C),r.addEventListener("squeezestart",C),r.addEventListener("squeezeend",C),r.addEventListener("end",N),r.addEventListener("inputsourceschange",P),_.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const B={antialias:r.renderState.layers===void 0?_.antialias:!0,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(r,t,B),r.updateRenderState({baseLayer:f}),g=new vl(f.framebufferWidth,f.framebufferHeight,{format:Zs,type:Ba,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil})}else{let B=null,W=null,q=null;_.depth&&(q=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,B=_.stencil?pm:fd,W=_.stencil?dd:vu);const j={colorFormat:t.RGBA8,depthFormat:q,scaleFactor:s};h=new XRWebGLBinding(r,t),d=h.createProjectionLayer(j),r.updateRenderState({layers:[d]}),g=new vl(d.textureWidth,d.textureHeight,{format:Zs,type:Ba,depthTexture:new Ile(d.textureWidth,d.textureHeight,W,void 0,void 0,void 0,void 0,void 0,void 0,B),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0});const te=e.properties.get(g);te.__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),O.setContext(r),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function P(D){for(let B=0;B<D.removed.length;B++){const W=D.removed[B],q=m.indexOf(W);q>=0&&(m[q]=null,b[q].disconnect(W))}for(let B=0;B<D.added.length;B++){const W=D.added[B];let q=m.indexOf(W);if(q===-1){for(let te=0;te<b.length;te++)if(te>=m.length){m.push(W),q=te;break}else if(m[te]===null){m[te]=W,q=te;break}if(q===-1)break}const j=b[q];j&&j.connect(W)}}const L=new me,R=new me;function F(D,B,W){L.setFromMatrixPosition(B.matrixWorld),R.setFromMatrixPosition(W.matrixWorld);const q=L.distanceTo(R),j=B.projectionMatrix.elements,te=W.projectionMatrix.elements,ne=j[14]/(j[10]-1),Z=j[14]/(j[10]+1),le=(j[9]+1)/j[5],re=(j[9]-1)/j[5],se=(j[8]-1)/j[0],$=(te[8]+1)/te[0],fe=ne*se,xe=ne*$,Ie=q/(-se+$),ge=Ie*-se;B.matrixWorld.decompose(D.position,D.quaternion,D.scale),D.translateX(ge),D.translateZ(Ie),D.matrixWorld.compose(D.position,D.quaternion,D.scale),D.matrixWorldInverse.copy(D.matrixWorld).invert();const Oe=ne+Ie,Me=Z+Ie,Y=fe-ge,Q=xe+(q-ge),de=le*Z/Me*Oe,Le=re*Z/Me*Oe;D.projectionMatrix.makePerspective(Y,Q,de,Le,Oe,Me),D.projectionMatrixInverse.copy(D.projectionMatrix).invert()}function V(D,B){B===null?D.matrixWorld.copy(D.matrix):D.matrixWorld.multiplyMatrices(B.matrixWorld,D.matrix),D.matrixWorldInverse.copy(D.matrixWorld).invert()}this.updateCamera=function(D){if(r===null)return;M.near=A.near=y.near=D.near,M.far=A.far=y.far=D.far,(T!==M.near||E!==M.far)&&(r.updateRenderState({depthNear:M.near,depthFar:M.far}),T=M.near,E=M.far);const B=D.parent,W=M.cameras;V(M,B);for(let q=0;q<W.length;q++)V(W[q],B);W.length===2?F(M,y,A):M.projectionMatrix.copy(y.projectionMatrix),G(D,M,B)};function G(D,B,W){W===null?D.matrix.copy(B.matrixWorld):(D.matrix.copy(W.matrixWorld),D.matrix.invert(),D.matrix.multiply(B.matrixWorld)),D.matrix.decompose(D.position,D.quaternion,D.scale),D.updateMatrixWorld(!0),D.projectionMatrix.copy(B.projectionMatrix),D.projectionMatrixInverse.copy(B.projectionMatrixInverse),D.isPerspectiveCamera&&(D.fov=xC*2*Math.atan(1/D.projectionMatrix.elements[5]),D.zoom=1)}this.getCamera=function(){return M},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(D){l=D,d!==null&&(d.fixedFoveation=D),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=D)};let U=null;function z(D,B){if(u=B.getViewerPose(c||o),p=B,u!==null){const W=u.views;f!==null&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let q=!1;W.length!==M.cameras.length&&(M.cameras.length=0,q=!0);for(let j=0;j<W.length;j++){const te=W[j];let ne=null;if(f!==null)ne=f.getViewport(te);else{const le=h.getViewSubImage(d,te);ne=le.viewport,j===0&&(e.setRenderTargetTextures(g,le.colorTexture,d.ignoreDepthValues?void 0:le.depthStencilTexture),e.setRenderTarget(g))}let Z=w[j];Z===void 0&&(Z=new Ys,Z.layers.enable(j),Z.viewport=new Nr,w[j]=Z),Z.matrix.fromArray(te.transform.matrix),Z.matrix.decompose(Z.position,Z.quaternion,Z.scale),Z.projectionMatrix.fromArray(te.projectionMatrix),Z.projectionMatrixInverse.copy(Z.projectionMatrix).invert(),Z.viewport.set(ne.x,ne.y,ne.width,ne.height),j===0&&(M.matrix.copy(Z.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),q===!0&&M.cameras.push(Z)}}for(let W=0;W<b.length;W++){const q=m[W],j=b[W];q!==null&&j!==void 0&&j.update(q,B,c||o)}U&&U(D,B),B.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:B}),p=null}const O=new nV;O.setAnimationLoop(z),this.setAnimationLoop=function(D){U=D},this.dispose=function(){}}}function Dle(i,e){function t(v,g){v.matrixAutoUpdate===!0&&v.updateMatrix(),g.value.copy(v.matrix)}function n(v,g){g.color.getRGB(v.fogColor.value,JG(i)),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function r(v,g,b,m,y){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(v,g):g.isMeshToonMaterial?(s(v,g),h(v,g)):g.isMeshPhongMaterial?(s(v,g),u(v,g)):g.isMeshStandardMaterial?(s(v,g),d(v,g),g.isMeshPhysicalMaterial&&f(v,g,y)):g.isMeshMatcapMaterial?(s(v,g),p(v,g)):g.isMeshDepthMaterial?s(v,g):g.isMeshDistanceMaterial?(s(v,g),_(v,g)):g.isMeshNormalMaterial?s(v,g):g.isLineBasicMaterial?(o(v,g),g.isLineDashedMaterial&&a(v,g)):g.isPointsMaterial?l(v,g,b,m):g.isSpriteMaterial?c(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function s(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.bumpMap&&(v.bumpMap.value=g.bumpMap,t(g.bumpMap,v.bumpMapTransform),v.bumpScale.value=g.bumpScale,g.side===Ls&&(v.bumpScale.value*=-1)),g.normalMap&&(v.normalMap.value=g.normalMap,t(g.normalMap,v.normalMapTransform),v.normalScale.value.copy(g.normalScale),g.side===Ls&&v.normalScale.value.negate()),g.displacementMap&&(v.displacementMap.value=g.displacementMap,t(g.displacementMap,v.displacementMapTransform),v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,v.emissiveMapTransform)),g.specularMap&&(v.specularMap.value=g.specularMap,t(g.specularMap,v.specularMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);const b=e.get(g).envMap;if(b&&(v.envMap.value=b,v.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap){v.lightMap.value=g.lightMap;const m=i._useLegacyLights===!0?Math.PI:1;v.lightMapIntensity.value=g.lightMapIntensity*m,t(g.lightMap,v.lightMapTransform)}g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,v.aoMapTransform))}function o(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform))}function a(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function l(v,g,b,m){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*b,v.scale.value=m*.5,g.map&&(v.map.value=g.map,t(g.map,v.uvTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function c(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function u(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function h(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function d(v,g){v.metalness.value=g.metalness,g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,v.metalnessMapTransform)),v.roughness.value=g.roughness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,v.roughnessMapTransform)),e.get(g).envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function f(v,g,b){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,v.sheenColorMapTransform)),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,v.sheenRoughnessMapTransform))),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,v.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(v.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===Ls&&v.clearcoatNormalScale.value.negate())),g.iridescence>0&&(v.iridescence.value=g.iridescence,v.iridescenceIOR.value=g.iridescenceIOR,v.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(v.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,v.iridescenceMapTransform)),g.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=b.texture,v.transmissionSamplerSize.value.set(b.width,b.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,v.transmissionMapTransform)),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(v.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(v.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,v.specularColorMapTransform)),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,v.specularIntensityMapTransform))}function p(v,g){g.matcap&&(v.matcap.value=g.matcap)}function _(v,g){const b=e.get(g).light;v.referencePosition.value.setFromMatrixPosition(b.matrixWorld),v.nearDistance.value=b.shadow.camera.near,v.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function Nle(i,e,t,n){let r={},s={},o=[];const a=t.isWebGL2?i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(b,m){const y=m.program;n.uniformBlockBinding(b,y)}function c(b,m){let y=r[b.id];y===void 0&&(p(b),y=u(b),r[b.id]=y,b.addEventListener("dispose",v));const A=m.program;n.updateUBOMapping(b,A);const w=e.render.frame;s[b.id]!==w&&(d(b),s[b.id]=w)}function u(b){const m=h();b.__bindingPointIndex=m;const y=i.createBuffer(),A=b.__size,w=b.usage;return i.bindBuffer(i.UNIFORM_BUFFER,y),i.bufferData(i.UNIFORM_BUFFER,A,w),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,m,y),y}function h(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(b){const m=r[b.id],y=b.uniforms,A=b.__cache;i.bindBuffer(i.UNIFORM_BUFFER,m);for(let w=0,M=y.length;w<M;w++){const T=y[w];if(f(T,w,A)===!0){const E=T.__offset,C=Array.isArray(T.value)?T.value:[T.value];let N=0;for(let P=0;P<C.length;P++){const L=C[P],R=_(L);typeof L=="number"?(T.__data[0]=L,i.bufferSubData(i.UNIFORM_BUFFER,E+N,T.__data)):L.isMatrix3?(T.__data[0]=L.elements[0],T.__data[1]=L.elements[1],T.__data[2]=L.elements[2],T.__data[3]=L.elements[0],T.__data[4]=L.elements[3],T.__data[5]=L.elements[4],T.__data[6]=L.elements[5],T.__data[7]=L.elements[0],T.__data[8]=L.elements[6],T.__data[9]=L.elements[7],T.__data[10]=L.elements[8],T.__data[11]=L.elements[0]):(L.toArray(T.__data,N),N+=R.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,E,T.__data)}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function f(b,m,y){const A=b.value;if(y[m]===void 0){if(typeof A=="number")y[m]=A;else{const w=Array.isArray(A)?A:[A],M=[];for(let T=0;T<w.length;T++)M.push(w[T].clone());y[m]=M}return!0}else if(typeof A=="number"){if(y[m]!==A)return y[m]=A,!0}else{const w=Array.isArray(y[m])?y[m]:[y[m]],M=Array.isArray(A)?A:[A];for(let T=0;T<w.length;T++){const E=w[T];if(E.equals(M[T])===!1)return E.copy(M[T]),!0}}return!1}function p(b){const m=b.uniforms;let y=0;const A=16;let w=0;for(let M=0,T=m.length;M<T;M++){const E=m[M],C={boundary:0,storage:0},N=Array.isArray(E.value)?E.value:[E.value];for(let P=0,L=N.length;P<L;P++){const R=N[P],F=_(R);C.boundary+=F.boundary,C.storage+=F.storage}if(E.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),E.__offset=y,M>0){w=y%A;const P=A-w;w!==0&&P-C.boundary<0&&(y+=A-w,E.__offset=y)}y+=C.storage}return w=y%A,w>0&&(y+=A-w),b.__size=y,b.__cache={},this}function _(b){const m={boundary:0,storage:0};return typeof b=="number"?(m.boundary=4,m.storage=4):b.isVector2?(m.boundary=8,m.storage=8):b.isVector3||b.isColor?(m.boundary=16,m.storage=12):b.isVector4?(m.boundary=16,m.storage=16):b.isMatrix3?(m.boundary=48,m.storage=48):b.isMatrix4?(m.boundary=64,m.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),m}function v(b){const m=b.target;m.removeEventListener("dispose",v);const y=o.indexOf(m.__bindingPointIndex);o.splice(y,1),i.deleteBuffer(r[m.id]),delete r[m.id],delete s[m.id]}function g(){for(const b in r)i.deleteBuffer(r[b]);o=[],r={},s={}}return{bind:l,update:c,dispose:g}}class aV{constructor(e={}){const{canvas:t=Die(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let d;n!==null?d=n.getContextAttributes().alpha:d=o;const f=new Uint32Array(4),p=new Int32Array(4);let _=null,v=null;const g=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Hr,this._useLegacyLights=!1,this.toneMapping=Iu,this.toneMappingExposure=1;const m=this;let y=!1,A=0,w=0,M=null,T=-1,E=null;const C=new Nr,N=new Nr;let P=null;const L=new $t(0);let R=0,F=t.width,V=t.height,G=1,U=null,z=null;const O=new Nr(0,0,F,V),D=new Nr(0,0,F,V);let B=!1;const W=new o3;let q=!1,j=!1,te=null;const ne=new Ct,Z=new on,le=new me,re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function se(){return M===null?G:1}let $=n;function fe(H,pe){for(let Ae=0;Ae<H.length;Ae++){const we=H[Ae],Pe=t.getContext(we,pe);if(Pe!==null)return Pe}return null}try{const H={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${n3}`),t.addEventListener("webglcontextlost",je,!1),t.addEventListener("webglcontextrestored",ee,!1),t.addEventListener("webglcontextcreationerror",Ge,!1),$===null){const pe=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&pe.shift(),$=fe(pe,H),$===null)throw fe(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&$ instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),$.getShaderPrecisionFormat===void 0&&($.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H}let xe,Ie,ge,Oe,Me,Y,Q,de,Le,ie,K,be,Ue,ve,Ne,$e,Ee,Ze,nt,rt,Be,qe,it,at;function ht(){xe=new $oe($),Ie=new Ooe($,xe,e),xe.init(Ie),qe=new Cle($,xe,Ie),ge=new Ele($,xe,Ie),Oe=new Xoe($),Me=new dle,Y=new Tle($,xe,ge,Me,Ie,qe,Oe),Q=new zoe(m),de=new Hoe(m),Le=new ire($,Ie),it=new koe($,xe,Le,Ie),ie=new Woe($,Le,Oe,it),K=new Zoe($,ie,Le,Oe),nt=new Koe($,Ie,Y),$e=new Boe(Me),be=new hle(m,Q,de,xe,Ie,it,$e),Ue=new Dle(m,Me),ve=new ple,Ne=new xle(xe,Ie),Ze=new Foe(m,Q,de,ge,K,d,l),Ee=new Ale(m,K,Ie),at=new Nle($,Oe,Ie,ge),rt=new Uoe($,xe,Oe,Ie),Be=new joe($,xe,Oe,Ie),Oe.programs=be.programs,m.capabilities=Ie,m.extensions=xe,m.properties=Me,m.renderLists=ve,m.shadowMap=Ee,m.state=ge,m.info=Oe}ht();const Qe=new Lle(m,$);this.xr=Qe,this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.forceContextLoss=function(){const H=xe.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){const H=xe.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return G},this.setPixelRatio=function(H){H!==void 0&&(G=H,this.setSize(F,V,!1))},this.getSize=function(H){return H.set(F,V)},this.setSize=function(H,pe,Ae=!0){if(Qe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}F=H,V=pe,t.width=Math.floor(H*G),t.height=Math.floor(pe*G),Ae===!0&&(t.style.width=H+"px",t.style.height=pe+"px"),this.setViewport(0,0,H,pe)},this.getDrawingBufferSize=function(H){return H.set(F*G,V*G).floor()},this.setDrawingBufferSize=function(H,pe,Ae){F=H,V=pe,G=Ae,t.width=Math.floor(H*Ae),t.height=Math.floor(pe*Ae),this.setViewport(0,0,H,pe)},this.getCurrentViewport=function(H){return H.copy(C)},this.getViewport=function(H){return H.copy(O)},this.setViewport=function(H,pe,Ae,we){H.isVector4?O.set(H.x,H.y,H.z,H.w):O.set(H,pe,Ae,we),ge.viewport(C.copy(O).multiplyScalar(G).floor())},this.getScissor=function(H){return H.copy(D)},this.setScissor=function(H,pe,Ae,we){H.isVector4?D.set(H.x,H.y,H.z,H.w):D.set(H,pe,Ae,we),ge.scissor(N.copy(D).multiplyScalar(G).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(H){ge.setScissorTest(B=H)},this.setOpaqueSort=function(H){U=H},this.setTransparentSort=function(H){z=H},this.getClearColor=function(H){return H.copy(Ze.getClearColor())},this.setClearColor=function(){Ze.setClearColor.apply(Ze,arguments)},this.getClearAlpha=function(){return Ze.getClearAlpha()},this.setClearAlpha=function(){Ze.setClearAlpha.apply(Ze,arguments)},this.clear=function(H=!0,pe=!0,Ae=!0){let we=0;if(H){let Pe=!1;if(M!==null){const et=M.texture.format;Pe=et===VG||et===GG||et===zG}if(Pe){const et=M.texture.type,dt=et===Ba||et===vu||et===i3||et===dd||et===OG||et===BG,xt=Ze.getClearColor(),Ye=Ze.getClearAlpha(),We=xt.r,st=xt.g,ct=xt.b;dt?(f[0]=We,f[1]=st,f[2]=ct,f[3]=Ye,$.clearBufferuiv($.COLOR,0,f)):(p[0]=We,p[1]=st,p[2]=ct,p[3]=Ye,$.clearBufferiv($.COLOR,0,p))}else we|=$.COLOR_BUFFER_BIT}pe&&(we|=$.DEPTH_BUFFER_BIT),Ae&&(we|=$.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),$.clear(we)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",je,!1),t.removeEventListener("webglcontextrestored",ee,!1),t.removeEventListener("webglcontextcreationerror",Ge,!1),ve.dispose(),Ne.dispose(),Me.dispose(),Q.dispose(),de.dispose(),K.dispose(),it.dispose(),at.dispose(),be.dispose(),Qe.dispose(),Qe.removeEventListener("sessionstart",J),Qe.removeEventListener("sessionend",ae),te&&(te.dispose(),te=null),ue.stop()};function je(H){H.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function ee(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const H=Oe.autoReset,pe=Ee.enabled,Ae=Ee.autoUpdate,we=Ee.needsUpdate,Pe=Ee.type;ht(),Oe.autoReset=H,Ee.enabled=pe,Ee.autoUpdate=Ae,Ee.needsUpdate=we,Ee.type=Pe}function Ge(H){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",H.statusMessage)}function Ce(H){const pe=H.target;pe.removeEventListener("dispose",Ce),De(pe)}function De(H){Xe(H),Me.remove(H)}function Xe(H){const pe=Me.get(H).programs;pe!==void 0&&(pe.forEach(function(Ae){be.releaseProgram(Ae)}),H.isShaderMaterial&&be.releaseShaderCache(H))}this.renderBufferDirect=function(H,pe,Ae,we,Pe,et){pe===null&&(pe=re);const dt=Pe.isMesh&&Pe.matrixWorld.determinant()<0,xt=Gt(H,pe,Ae,we,Pe);ge.setMaterial(we,dt);let Ye=Ae.index,We=1;if(we.wireframe===!0){if(Ye=ie.getWireframeAttribute(Ae),Ye===void 0)return;We=2}const st=Ae.drawRange,ct=Ae.attributes.position;let Nt=st.start*We,Ft=(st.start+st.count)*We;et!==null&&(Nt=Math.max(Nt,et.start*We),Ft=Math.min(Ft,(et.start+et.count)*We)),Ye!==null?(Nt=Math.max(Nt,0),Ft=Math.min(Ft,Ye.count)):ct!=null&&(Nt=Math.max(Nt,0),Ft=Math.min(Ft,ct.count));const Dt=Ft-Nt;if(Dt<0||Dt===1/0)return;it.setup(Pe,we,xt,Ae,Ye);let Bt,St=rt;if(Ye!==null&&(Bt=Le.get(Ye),St=Be,St.setIndex(Bt)),Pe.isMesh)we.wireframe===!0?(ge.setLineWidth(we.wireframeLinewidth*se()),St.setMode($.LINES)):St.setMode($.TRIANGLES);else if(Pe.isLine){let vt=we.linewidth;vt===void 0&&(vt=1),ge.setLineWidth(vt*se()),Pe.isLineSegments?St.setMode($.LINES):Pe.isLineLoop?St.setMode($.LINE_LOOP):St.setMode($.LINE_STRIP)}else Pe.isPoints?St.setMode($.POINTS):Pe.isSprite&&St.setMode($.TRIANGLES);if(Pe.isInstancedMesh)St.renderInstances(Nt,Dt,Pe.count);else if(Ae.isInstancedBufferGeometry){const vt=Ae._maxInstanceCount!==void 0?Ae._maxInstanceCount:1/0,Wt=Math.min(Ae.instanceCount,vt);St.renderInstances(Nt,Dt,Wt)}else St.render(Nt,Dt)};function gt(H,pe,Ae){H.transparent===!0&&H.side===ll&&H.forceSinglePass===!1?(H.side=Ls,H.needsUpdate=!0,lt(H,pe,Ae),H.side=Sc,H.needsUpdate=!0,lt(H,pe,Ae),H.side=ll):lt(H,pe,Ae)}this.compile=function(H,pe,Ae=null){Ae===null&&(Ae=H),v=Ne.get(Ae),v.init(),b.push(v),Ae.traverseVisible(function(Pe){Pe.isLight&&Pe.layers.test(pe.layers)&&(v.pushLight(Pe),Pe.castShadow&&v.pushShadow(Pe))}),H!==Ae&&H.traverseVisible(function(Pe){Pe.isLight&&Pe.layers.test(pe.layers)&&(v.pushLight(Pe),Pe.castShadow&&v.pushShadow(Pe))}),v.setupLights(m._useLegacyLights);const we=new Set;return H.traverse(function(Pe){const et=Pe.material;if(et)if(Array.isArray(et))for(let dt=0;dt<et.length;dt++){const xt=et[dt];gt(xt,Ae,Pe),we.add(xt)}else gt(et,Ae,Pe),we.add(et)}),b.pop(),v=null,we},this.compileAsync=function(H,pe,Ae=null){const we=this.compile(H,pe,Ae);return new Promise(Pe=>{function et(){if(we.forEach(function(dt){Me.get(dt).currentProgram.isReady()&&we.delete(dt)}),we.size===0){Pe(H);return}setTimeout(et,10)}xe.get("KHR_parallel_shader_compile")!==null?et():setTimeout(et,10)})};let _t=null;function Mt(H){_t&&_t(H)}function J(){ue.stop()}function ae(){ue.start()}const ue=new nV;ue.setAnimationLoop(Mt),typeof self<"u"&&ue.setContext(self),this.setAnimationLoop=function(H){_t=H,Qe.setAnimationLoop(H),H===null?ue.stop():ue.start()},Qe.addEventListener("sessionstart",J),Qe.addEventListener("sessionend",ae),this.render=function(H,pe){if(pe!==void 0&&pe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),pe.parent===null&&pe.matrixWorldAutoUpdate===!0&&pe.updateMatrixWorld(),Qe.enabled===!0&&Qe.isPresenting===!0&&(Qe.cameraAutoUpdate===!0&&Qe.updateCamera(pe),pe=Qe.getCamera()),H.isScene===!0&&H.onBeforeRender(m,H,pe,M),v=Ne.get(H,b.length),v.init(),b.push(v),ne.multiplyMatrices(pe.projectionMatrix,pe.matrixWorldInverse),W.setFromProjectionMatrix(ne),j=this.localClippingEnabled,q=$e.init(this.clippingPlanes,j),_=ve.get(H,g.length),_.init(),g.push(_),ye(H,pe,0,m.sortObjects),_.finish(),m.sortObjects===!0&&_.sort(U,z),this.info.render.frame++,q===!0&&$e.beginShadows();const Ae=v.state.shadowsArray;if(Ee.render(Ae,H,pe),q===!0&&$e.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ze.render(_,H),v.setupLights(m._useLegacyLights),pe.isArrayCamera){const we=pe.cameras;for(let Pe=0,et=we.length;Pe<et;Pe++){const dt=we[Pe];Se(_,H,dt,dt.viewport)}}else Se(_,H,pe);M!==null&&(Y.updateMultisampleRenderTarget(M),Y.updateRenderTargetMipmap(M)),H.isScene===!0&&H.onAfterRender(m,H,pe),it.resetDefaultState(),T=-1,E=null,b.pop(),b.length>0?v=b[b.length-1]:v=null,g.pop(),g.length>0?_=g[g.length-1]:_=null};function ye(H,pe,Ae,we){if(H.visible===!1)return;if(H.layers.test(pe.layers)){if(H.isGroup)Ae=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(pe);else if(H.isLight)v.pushLight(H),H.castShadow&&v.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||W.intersectsSprite(H)){we&&le.setFromMatrixPosition(H.matrixWorld).applyMatrix4(ne);const dt=K.update(H),xt=H.material;xt.visible&&_.push(H,dt,xt,Ae,le.z,null)}}else if((H.isMesh||H.isLine||H.isPoints)&&(!H.frustumCulled||W.intersectsObject(H))){const dt=K.update(H),xt=H.material;if(we&&(H.boundingSphere!==void 0?(H.boundingSphere===null&&H.computeBoundingSphere(),le.copy(H.boundingSphere.center)):(dt.boundingSphere===null&&dt.computeBoundingSphere(),le.copy(dt.boundingSphere.center)),le.applyMatrix4(H.matrixWorld).applyMatrix4(ne)),Array.isArray(xt)){const Ye=dt.groups;for(let We=0,st=Ye.length;We<st;We++){const ct=Ye[We],Nt=xt[ct.materialIndex];Nt&&Nt.visible&&_.push(H,dt,Nt,Ae,le.z,ct)}}else xt.visible&&_.push(H,dt,xt,Ae,le.z,null)}}const et=H.children;for(let dt=0,xt=et.length;dt<xt;dt++)ye(et[dt],pe,Ae,we)}function Se(H,pe,Ae,we){const Pe=H.opaque,et=H.transmissive,dt=H.transparent;v.setupLightsView(Ae),q===!0&&$e.setGlobalState(m.clippingPlanes,Ae),et.length>0&&Fe(Pe,et,pe,Ae),we&&ge.viewport(C.copy(we)),Pe.length>0&&ze(Pe,pe,Ae),et.length>0&&ze(et,pe,Ae),dt.length>0&&ze(dt,pe,Ae),ge.buffers.depth.setTest(!0),ge.buffers.depth.setMask(!0),ge.buffers.color.setMask(!0),ge.setPolygonOffset(!1)}function Fe(H,pe,Ae,we){if((Ae.isScene===!0?Ae.overrideMaterial:null)!==null)return;const et=Ie.isWebGL2;te===null&&(te=new vl(1,1,{generateMipmaps:!0,type:xe.has("EXT_color_buffer_half_float")?Rd:Ba,minFilter:m1,samples:et?4:0})),m.getDrawingBufferSize(Z),et?te.setSize(Z.x,Z.y):te.setSize(bC(Z.x),bC(Z.y));const dt=m.getRenderTarget();m.setRenderTarget(te),m.getClearColor(L),R=m.getClearAlpha(),R<1&&m.setClearColor(16777215,.5),m.clear();const xt=m.toneMapping;m.toneMapping=Iu,ze(H,Ae,we),Y.updateMultisampleRenderTarget(te),Y.updateRenderTargetMipmap(te);let Ye=!1;for(let We=0,st=pe.length;We<st;We++){const ct=pe[We],Nt=ct.object,Ft=ct.geometry,Dt=ct.material,Bt=ct.group;if(Dt.side===ll&&Nt.layers.test(we.layers)){const St=Dt.side;Dt.side=Ls,Dt.needsUpdate=!0,He(Nt,Ae,we,Ft,Dt,Bt),Dt.side=St,Dt.needsUpdate=!0,Ye=!0}}Ye===!0&&(Y.updateMultisampleRenderTarget(te),Y.updateRenderTargetMipmap(te)),m.setRenderTarget(dt),m.setClearColor(L,R),m.toneMapping=xt}function ze(H,pe,Ae){const we=pe.isScene===!0?pe.overrideMaterial:null;for(let Pe=0,et=H.length;Pe<et;Pe++){const dt=H[Pe],xt=dt.object,Ye=dt.geometry,We=we===null?dt.material:we,st=dt.group;xt.layers.test(Ae.layers)&&He(xt,pe,Ae,Ye,We,st)}}function He(H,pe,Ae,we,Pe,et){H.onBeforeRender(m,pe,Ae,we,Pe,et),H.modelViewMatrix.multiplyMatrices(Ae.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),Pe.onBeforeRender(m,pe,Ae,we,H,et),Pe.transparent===!0&&Pe.side===ll&&Pe.forceSinglePass===!1?(Pe.side=Ls,Pe.needsUpdate=!0,m.renderBufferDirect(Ae,pe,we,Pe,H,et),Pe.side=Sc,Pe.needsUpdate=!0,m.renderBufferDirect(Ae,pe,we,Pe,H,et),Pe.side=ll):m.renderBufferDirect(Ae,pe,we,Pe,H,et),H.onAfterRender(m,pe,Ae,we,Pe,et)}function lt(H,pe,Ae){pe.isScene!==!0&&(pe=re);const we=Me.get(H),Pe=v.state.lights,et=v.state.shadowsArray,dt=Pe.state.version,xt=be.getParameters(H,Pe.state,et,pe,Ae),Ye=be.getProgramCacheKey(xt);let We=we.programs;we.environment=H.isMeshStandardMaterial?pe.environment:null,we.fog=pe.fog,we.envMap=(H.isMeshStandardMaterial?de:Q).get(H.envMap||we.environment),We===void 0&&(H.addEventListener("dispose",Ce),We=new Map,we.programs=We);let st=We.get(Ye);if(st!==void 0){if(we.currentProgram===st&&we.lightsStateVersion===dt)return wt(H,xt),st}else xt.uniforms=be.getUniforms(H),H.onBuild(Ae,xt,m),H.onBeforeCompile(xt,m),st=be.acquireProgram(xt,Ye),We.set(Ye,st),we.uniforms=xt.uniforms;const ct=we.uniforms;return(!H.isShaderMaterial&&!H.isRawShaderMaterial||H.clipping===!0)&&(ct.clippingPlanes=$e.uniform),wt(H,xt),we.needsLights=bt(H),we.lightsStateVersion=dt,we.needsLights&&(ct.ambientLightColor.value=Pe.state.ambient,ct.lightProbe.value=Pe.state.probe,ct.directionalLights.value=Pe.state.directional,ct.directionalLightShadows.value=Pe.state.directionalShadow,ct.spotLights.value=Pe.state.spot,ct.spotLightShadows.value=Pe.state.spotShadow,ct.rectAreaLights.value=Pe.state.rectArea,ct.ltc_1.value=Pe.state.rectAreaLTC1,ct.ltc_2.value=Pe.state.rectAreaLTC2,ct.pointLights.value=Pe.state.point,ct.pointLightShadows.value=Pe.state.pointShadow,ct.hemisphereLights.value=Pe.state.hemi,ct.directionalShadowMap.value=Pe.state.directionalShadowMap,ct.directionalShadowMatrix.value=Pe.state.directionalShadowMatrix,ct.spotShadowMap.value=Pe.state.spotShadowMap,ct.spotLightMatrix.value=Pe.state.spotLightMatrix,ct.spotLightMap.value=Pe.state.spotLightMap,ct.pointShadowMap.value=Pe.state.pointShadowMap,ct.pointShadowMatrix.value=Pe.state.pointShadowMatrix),we.currentProgram=st,we.uniformsList=null,st}function mt(H){if(H.uniformsList===null){const pe=H.currentProgram.getUniforms();H.uniformsList=Nx.seqWithValue(pe.seq,H.uniforms)}return H.uniformsList}function wt(H,pe){const Ae=Me.get(H);Ae.outputColorSpace=pe.outputColorSpace,Ae.instancing=pe.instancing,Ae.instancingColor=pe.instancingColor,Ae.skinning=pe.skinning,Ae.morphTargets=pe.morphTargets,Ae.morphNormals=pe.morphNormals,Ae.morphColors=pe.morphColors,Ae.morphTargetsCount=pe.morphTargetsCount,Ae.numClippingPlanes=pe.numClippingPlanes,Ae.numIntersection=pe.numClipIntersection,Ae.vertexAlphas=pe.vertexAlphas,Ae.vertexTangents=pe.vertexTangents,Ae.toneMapping=pe.toneMapping}function Gt(H,pe,Ae,we,Pe){pe.isScene!==!0&&(pe=re),Y.resetTextureUnits();const et=pe.fog,dt=we.isMeshStandardMaterial?pe.environment:null,xt=M===null?m.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:wc,Ye=(we.isMeshStandardMaterial?de:Q).get(we.envMap||dt),We=we.vertexColors===!0&&!!Ae.attributes.color&&Ae.attributes.color.itemSize===4,st=!!Ae.attributes.tangent&&(!!we.normalMap||we.anisotropy>0),ct=!!Ae.morphAttributes.position,Nt=!!Ae.morphAttributes.normal,Ft=!!Ae.morphAttributes.color;let Dt=Iu;we.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(Dt=m.toneMapping);const Bt=Ae.morphAttributes.position||Ae.morphAttributes.normal||Ae.morphAttributes.color,St=Bt!==void 0?Bt.length:0,vt=Me.get(we),Wt=v.state.lights;if(q===!0&&(j===!0||H!==E)){const dn=H===E&&we.id===T;$e.setState(we,H,dn)}let Lt=!1;we.version===vt.__version?(vt.needsLights&&vt.lightsStateVersion!==Wt.state.version||vt.outputColorSpace!==xt||Pe.isInstancedMesh&&vt.instancing===!1||!Pe.isInstancedMesh&&vt.instancing===!0||Pe.isSkinnedMesh&&vt.skinning===!1||!Pe.isSkinnedMesh&&vt.skinning===!0||Pe.isInstancedMesh&&vt.instancingColor===!0&&Pe.instanceColor===null||Pe.isInstancedMesh&&vt.instancingColor===!1&&Pe.instanceColor!==null||vt.envMap!==Ye||we.fog===!0&&vt.fog!==et||vt.numClippingPlanes!==void 0&&(vt.numClippingPlanes!==$e.numPlanes||vt.numIntersection!==$e.numIntersection)||vt.vertexAlphas!==We||vt.vertexTangents!==st||vt.morphTargets!==ct||vt.morphNormals!==Nt||vt.morphColors!==Ft||vt.toneMapping!==Dt||Ie.isWebGL2===!0&&vt.morphTargetsCount!==St)&&(Lt=!0):(Lt=!0,vt.__version=we.version);let yn=vt.currentProgram;Lt===!0&&(yn=lt(we,pe,Pe));let bi=!1,qn=!1,Ln=!1;const tn=yn.getUniforms(),Yn=vt.uniforms;if(ge.useProgram(yn.program)&&(bi=!0,qn=!0,Ln=!0),we.id!==T&&(T=we.id,qn=!0),bi||E!==H){tn.setValue($,"projectionMatrix",H.projectionMatrix),tn.setValue($,"viewMatrix",H.matrixWorldInverse);const dn=tn.map.cameraPosition;dn!==void 0&&dn.setValue($,le.setFromMatrixPosition(H.matrixWorld)),Ie.logarithmicDepthBuffer&&tn.setValue($,"logDepthBufFC",2/(Math.log(H.far+1)/Math.LN2)),(we.isMeshPhongMaterial||we.isMeshToonMaterial||we.isMeshLambertMaterial||we.isMeshBasicMaterial||we.isMeshStandardMaterial||we.isShaderMaterial)&&tn.setValue($,"isOrthographic",H.isOrthographicCamera===!0),E!==H&&(E=H,qn=!0,Ln=!0)}if(Pe.isSkinnedMesh){tn.setOptional($,Pe,"bindMatrix"),tn.setOptional($,Pe,"bindMatrixInverse");const dn=Pe.skeleton;dn&&(Ie.floatVertexTextures?(dn.boneTexture===null&&dn.computeBoneTexture(),tn.setValue($,"boneTexture",dn.boneTexture,Y),tn.setValue($,"boneTextureSize",dn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Ji=Ae.morphAttributes;if((Ji.position!==void 0||Ji.normal!==void 0||Ji.color!==void 0&&Ie.isWebGL2===!0)&&nt.update(Pe,Ae,yn),(qn||vt.receiveShadow!==Pe.receiveShadow)&&(vt.receiveShadow=Pe.receiveShadow,tn.setValue($,"receiveShadow",Pe.receiveShadow)),we.isMeshGouraudMaterial&&we.envMap!==null&&(Yn.envMap.value=Ye,Yn.flipEnvMap.value=Ye.isCubeTexture&&Ye.isRenderTargetTexture===!1?-1:1),qn&&(tn.setValue($,"toneMappingExposure",m.toneMappingExposure),vt.needsLights&&Tt(Yn,Ln),et&&we.fog===!0&&Ue.refreshFogUniforms(Yn,et),Ue.refreshMaterialUniforms(Yn,we,G,V,te),Nx.upload($,mt(vt),Yn,Y)),we.isShaderMaterial&&we.uniformsNeedUpdate===!0&&(Nx.upload($,mt(vt),Yn,Y),we.uniformsNeedUpdate=!1),we.isSpriteMaterial&&tn.setValue($,"center",Pe.center),tn.setValue($,"modelViewMatrix",Pe.modelViewMatrix),tn.setValue($,"normalMatrix",Pe.normalMatrix),tn.setValue($,"modelMatrix",Pe.matrixWorld),we.isShaderMaterial||we.isRawShaderMaterial){const dn=we.uniformsGroups;for(let Qn=0,er=dn.length;Qn<er;Qn++)if(Ie.isWebGL2){const Mr=dn[Qn];at.update(Mr,yn),at.bind(Mr,yn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return yn}function Tt(H,pe){H.ambientLightColor.needsUpdate=pe,H.lightProbe.needsUpdate=pe,H.directionalLights.needsUpdate=pe,H.directionalLightShadows.needsUpdate=pe,H.pointLights.needsUpdate=pe,H.pointLightShadows.needsUpdate=pe,H.spotLights.needsUpdate=pe,H.spotLightShadows.needsUpdate=pe,H.rectAreaLights.needsUpdate=pe,H.hemisphereLights.needsUpdate=pe}function bt(H){return H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&H.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(H,pe,Ae){Me.get(H.texture).__webglTexture=pe,Me.get(H.depthTexture).__webglTexture=Ae;const we=Me.get(H);we.__hasExternalTextures=!0,we.__hasExternalTextures&&(we.__autoAllocateDepthBuffer=Ae===void 0,we.__autoAllocateDepthBuffer||xe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),we.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(H,pe){const Ae=Me.get(H);Ae.__webglFramebuffer=pe,Ae.__useDefaultFramebuffer=pe===void 0},this.setRenderTarget=function(H,pe=0,Ae=0){M=H,A=pe,w=Ae;let we=!0,Pe=null,et=!1,dt=!1;if(H){const Ye=Me.get(H);Ye.__useDefaultFramebuffer!==void 0?(ge.bindFramebuffer($.FRAMEBUFFER,null),we=!1):Ye.__webglFramebuffer===void 0?Y.setupRenderTarget(H):Ye.__hasExternalTextures&&Y.rebindTextures(H,Me.get(H.texture).__webglTexture,Me.get(H.depthTexture).__webglTexture);const We=H.texture;(We.isData3DTexture||We.isDataArrayTexture||We.isCompressedArrayTexture)&&(dt=!0);const st=Me.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(Array.isArray(st[pe])?Pe=st[pe][Ae]:Pe=st[pe],et=!0):Ie.isWebGL2&&H.samples>0&&Y.useMultisampledRTT(H)===!1?Pe=Me.get(H).__webglMultisampledFramebuffer:Array.isArray(st)?Pe=st[Ae]:Pe=st,C.copy(H.viewport),N.copy(H.scissor),P=H.scissorTest}else C.copy(O).multiplyScalar(G).floor(),N.copy(D).multiplyScalar(G).floor(),P=B;if(ge.bindFramebuffer($.FRAMEBUFFER,Pe)&&Ie.drawBuffers&&we&&ge.drawBuffers(H,Pe),ge.viewport(C),ge.scissor(N),ge.setScissorTest(P),et){const Ye=Me.get(H.texture);$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_CUBE_MAP_POSITIVE_X+pe,Ye.__webglTexture,Ae)}else if(dt){const Ye=Me.get(H.texture),We=pe||0;$.framebufferTextureLayer($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,Ye.__webglTexture,Ae||0,We)}T=-1},this.readRenderTargetPixels=function(H,pe,Ae,we,Pe,et,dt){if(!(H&&H.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let xt=Me.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&dt!==void 0&&(xt=xt[dt]),xt){ge.bindFramebuffer($.FRAMEBUFFER,xt);try{const Ye=H.texture,We=Ye.format,st=Ye.type;if(We!==Zs&&qe.convert(We)!==$.getParameter($.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ct=st===Rd&&(xe.has("EXT_color_buffer_half_float")||Ie.isWebGL2&&xe.has("EXT_color_buffer_float"));if(st!==Ba&&qe.convert(st)!==$.getParameter($.IMPLEMENTATION_COLOR_READ_TYPE)&&!(st===ka&&(Ie.isWebGL2||xe.has("OES_texture_float")||xe.has("WEBGL_color_buffer_float")))&&!ct){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}pe>=0&&pe<=H.width-we&&Ae>=0&&Ae<=H.height-Pe&&$.readPixels(pe,Ae,we,Pe,qe.convert(We),qe.convert(st),et)}finally{const Ye=M!==null?Me.get(M).__webglFramebuffer:null;ge.bindFramebuffer($.FRAMEBUFFER,Ye)}}},this.copyFramebufferToTexture=function(H,pe,Ae=0){const we=Math.pow(2,-Ae),Pe=Math.floor(pe.image.width*we),et=Math.floor(pe.image.height*we);Y.setTexture2D(pe,0),$.copyTexSubImage2D($.TEXTURE_2D,Ae,0,0,H.x,H.y,Pe,et),ge.unbindTexture()},this.copyTextureToTexture=function(H,pe,Ae,we=0){const Pe=pe.image.width,et=pe.image.height,dt=qe.convert(Ae.format),xt=qe.convert(Ae.type);Y.setTexture2D(Ae,0),$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,Ae.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ae.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,Ae.unpackAlignment),pe.isDataTexture?$.texSubImage2D($.TEXTURE_2D,we,H.x,H.y,Pe,et,dt,xt,pe.image.data):pe.isCompressedTexture?$.compressedTexSubImage2D($.TEXTURE_2D,we,H.x,H.y,pe.mipmaps[0].width,pe.mipmaps[0].height,dt,pe.mipmaps[0].data):$.texSubImage2D($.TEXTURE_2D,we,H.x,H.y,dt,xt,pe.image),we===0&&Ae.generateMipmaps&&$.generateMipmap($.TEXTURE_2D),ge.unbindTexture()},this.copyTextureToTexture3D=function(H,pe,Ae,we,Pe=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const et=H.max.x-H.min.x+1,dt=H.max.y-H.min.y+1,xt=H.max.z-H.min.z+1,Ye=qe.convert(we.format),We=qe.convert(we.type);let st;if(we.isData3DTexture)Y.setTexture3D(we,0),st=$.TEXTURE_3D;else if(we.isDataArrayTexture)Y.setTexture2DArray(we,0),st=$.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,we.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,we.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,we.unpackAlignment);const ct=$.getParameter($.UNPACK_ROW_LENGTH),Nt=$.getParameter($.UNPACK_IMAGE_HEIGHT),Ft=$.getParameter($.UNPACK_SKIP_PIXELS),Dt=$.getParameter($.UNPACK_SKIP_ROWS),Bt=$.getParameter($.UNPACK_SKIP_IMAGES),St=Ae.isCompressedTexture?Ae.mipmaps[0]:Ae.image;$.pixelStorei($.UNPACK_ROW_LENGTH,St.width),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,St.height),$.pixelStorei($.UNPACK_SKIP_PIXELS,H.min.x),$.pixelStorei($.UNPACK_SKIP_ROWS,H.min.y),$.pixelStorei($.UNPACK_SKIP_IMAGES,H.min.z),Ae.isDataTexture||Ae.isData3DTexture?$.texSubImage3D(st,Pe,pe.x,pe.y,pe.z,et,dt,xt,Ye,We,St.data):Ae.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),$.compressedTexSubImage3D(st,Pe,pe.x,pe.y,pe.z,et,dt,xt,Ye,St.data)):$.texSubImage3D(st,Pe,pe.x,pe.y,pe.z,et,dt,xt,Ye,We,St),$.pixelStorei($.UNPACK_ROW_LENGTH,ct),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,Nt),$.pixelStorei($.UNPACK_SKIP_PIXELS,Ft),$.pixelStorei($.UNPACK_SKIP_ROWS,Dt),$.pixelStorei($.UNPACK_SKIP_IMAGES,Bt),Pe===0&&we.generateMipmaps&&$.generateMipmap(st),ge.unbindTexture()},this.initTexture=function(H){H.isCubeTexture?Y.setTextureCube(H,0):H.isData3DTexture?Y.setTexture3D(H,0):H.isDataArrayTexture||H.isCompressedArrayTexture?Y.setTexture2DArray(H,0):Y.setTexture2D(H,0),ge.unbindTexture()},this.resetState=function(){A=0,w=0,M=null,ge.reset(),it.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return uc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===r3?"display-p3":"srgb",t.unpackColorSpace=Kn.workingColorSpace===GS?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Hr?pd:HG}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===pd?Hr:wc}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class Fle extends aV{}Fle.prototype.isWebGL1Renderer=!0;class l3{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new $t(e),this.near=t,this.far=n}clone(){return new l3(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class uU extends Or{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class wC extends Ds{constructor(e=null,t=1,n=1,r,s,o,a,l,c=ei,u=ei,h,d){super(null,o,a,l,c,u,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class kle extends Lm{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new $t(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const hU=new me,dU=new me,fU=new Ct,nA=new s3,Cy=new W1;class Ule extends Or{constructor(e=new hr,t=new kle){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)hU.fromBufferAttribute(t,r-1),dU.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=hU.distanceTo(dU);e.setAttribute("lineDistance",new ui(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Cy.copy(n.boundingSphere),Cy.applyMatrix4(r),Cy.radius+=s,e.ray.intersectsSphere(Cy)===!1)return;fU.copy(r).invert(),nA.copy(e.ray).applyMatrix4(fU);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new me,u=new me,h=new me,d=new me,f=this.isLineSegments?2:1,p=n.index,v=n.attributes.position;if(p!==null){const g=Math.max(0,o.start),b=Math.min(p.count,o.start+o.count);for(let m=g,y=b-1;m<y;m+=f){const A=p.getX(m),w=p.getX(m+1);if(c.fromBufferAttribute(v,A),u.fromBufferAttribute(v,w),nA.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const T=e.ray.origin.distanceTo(d);T<e.near||T>e.far||t.push({distance:T,point:h.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else{const g=Math.max(0,o.start),b=Math.min(v.count,o.start+o.count);for(let m=g,y=b-1;m<y;m+=f){if(c.fromBufferAttribute(v,m),u.fromBufferAttribute(v,m+1),nA.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const w=e.ray.origin.distanceTo(d);w<e.near||w>e.far||t.push({distance:w,point:h.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const pU=new me,mU=new me;class MC extends Ule{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,s=t.count;r<s;r+=2)pU.fromBufferAttribute(t,r),mU.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+pU.distanceTo(mU);e.setAttribute("lineDistance",new ui(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Ole extends Lm{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new $t(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const gU=new Ct,AC=new s3,Py=new W1,Ry=new me;class lV extends Or{constructor(e=new hr,t=new Ole){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Py.copy(n.boundingSphere),Py.applyMatrix4(r),Py.radius+=s,e.ray.intersectsSphere(Py)===!1)return;gU.copy(r).invert(),AC.copy(e.ray).applyMatrix4(gU);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=n.index,h=n.attributes.position;if(c!==null){const d=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let p=d,_=f;p<_;p++){const v=c.getX(p);Ry.fromBufferAttribute(h,v),vU(Ry,v,l,r,e,t,this)}}else{const d=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let p=d,_=f;p<_;p++)Ry.fromBufferAttribute(h,p),vU(Ry,p,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function vU(i,e,t,n,r,s,o){const a=AC.distanceSqToPoint(i);if(a<t){const l=new me;AC.closestPointToPoint(i,l),l.applyMatrix4(n);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class Ble extends Ds{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class $S extends hr{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],h=[],d=[],f=[];let p=0;const _=[],v=n/2;let g=0;b(),o===!1&&(e>0&&m(!0),t>0&&m(!1)),this.setIndex(u),this.setAttribute("position",new ui(h,3)),this.setAttribute("normal",new ui(d,3)),this.setAttribute("uv",new ui(f,2));function b(){const y=new me,A=new me;let w=0;const M=(t-e)/n;for(let T=0;T<=s;T++){const E=[],C=T/s,N=C*(t-e)+e;for(let P=0;P<=r;P++){const L=P/r,R=L*l+a,F=Math.sin(R),V=Math.cos(R);A.x=N*F,A.y=-C*n+v,A.z=N*V,h.push(A.x,A.y,A.z),y.set(F,M,V).normalize(),d.push(y.x,y.y,y.z),f.push(L,1-C),E.push(p++)}_.push(E)}for(let T=0;T<r;T++)for(let E=0;E<s;E++){const C=_[E][T],N=_[E+1][T],P=_[E+1][T+1],L=_[E][T+1];u.push(C,N,L),u.push(N,P,L),w+=6}c.addGroup(g,w,0),g+=w}function m(y){const A=p,w=new on,M=new me;let T=0;const E=y===!0?e:t,C=y===!0?1:-1;for(let P=1;P<=r;P++)h.push(0,v*C,0),d.push(0,C,0),f.push(.5,.5),p++;const N=p;for(let P=0;P<=r;P++){const R=P/r*l+a,F=Math.cos(R),V=Math.sin(R);M.x=E*V,M.y=v*C,M.z=E*F,h.push(M.x,M.y,M.z),d.push(0,C,0),w.x=F*.5+.5,w.y=V*.5*C+.5,f.push(w.x,w.y),p++}for(let P=0;P<r;P++){const L=A+P,R=N+P;y===!0?u.push(R,R+1,L):u.push(R+1,R,L),T+=3}c.addGroup(g,T,y===!0?1:2),g+=T}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $S(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class c3 extends $S{constructor(e=1,t=1,n=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,n,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new c3(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class j1 extends hr{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const s=[],o=[];a(r),c(n),u(),this.setAttribute("position",new ui(s,3)),this.setAttribute("normal",new ui(s.slice(),3)),this.setAttribute("uv",new ui(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const m=new me,y=new me,A=new me;for(let w=0;w<t.length;w+=3)f(t[w+0],m),f(t[w+1],y),f(t[w+2],A),l(m,y,A,b)}function l(b,m,y,A){const w=A+1,M=[];for(let T=0;T<=w;T++){M[T]=[];const E=b.clone().lerp(y,T/w),C=m.clone().lerp(y,T/w),N=w-T;for(let P=0;P<=N;P++)P===0&&T===w?M[T][P]=E:M[T][P]=E.clone().lerp(C,P/N)}for(let T=0;T<w;T++)for(let E=0;E<2*(w-T)-1;E++){const C=Math.floor(E/2);E%2===0?(d(M[T][C+1]),d(M[T+1][C]),d(M[T][C])):(d(M[T][C+1]),d(M[T+1][C+1]),d(M[T+1][C]))}}function c(b){const m=new me;for(let y=0;y<s.length;y+=3)m.x=s[y+0],m.y=s[y+1],m.z=s[y+2],m.normalize().multiplyScalar(b),s[y+0]=m.x,s[y+1]=m.y,s[y+2]=m.z}function u(){const b=new me;for(let m=0;m<s.length;m+=3){b.x=s[m+0],b.y=s[m+1],b.z=s[m+2];const y=v(b)/2/Math.PI+.5,A=g(b)/Math.PI+.5;o.push(y,1-A)}p(),h()}function h(){for(let b=0;b<o.length;b+=6){const m=o[b+0],y=o[b+2],A=o[b+4],w=Math.max(m,y,A),M=Math.min(m,y,A);w>.9&&M<.1&&(m<.2&&(o[b+0]+=1),y<.2&&(o[b+2]+=1),A<.2&&(o[b+4]+=1))}}function d(b){s.push(b.x,b.y,b.z)}function f(b,m){const y=b*3;m.x=e[y+0],m.y=e[y+1],m.z=e[y+2]}function p(){const b=new me,m=new me,y=new me,A=new me,w=new on,M=new on,T=new on;for(let E=0,C=0;E<s.length;E+=9,C+=6){b.set(s[E+0],s[E+1],s[E+2]),m.set(s[E+3],s[E+4],s[E+5]),y.set(s[E+6],s[E+7],s[E+8]),w.set(o[C+0],o[C+1]),M.set(o[C+2],o[C+3]),T.set(o[C+4],o[C+5]),A.copy(b).add(m).add(y).divideScalar(3);const N=v(A);_(w,C+0,b,N),_(M,C+2,m,N),_(T,C+4,y,N)}}function _(b,m,y,A){A<0&&b.x===1&&(o[m]=b.x-1),y.x===0&&y.z===0&&(o[m]=A/2/Math.PI+.5)}function v(b){return Math.atan2(b.z,-b.x)}function g(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new j1(e.vertices,e.indices,e.radius,e.details)}}class WS extends j1{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new WS(e.radius,e.detail)}}class u3 extends j1{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new u3(e.radius,e.detail)}}class h3 extends j1{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new h3(e.radius,e.detail)}}class d3 extends hr{constructor(e=1,t=.4,n=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new me,h=new me,d=new me;for(let f=0;f<=n;f++)for(let p=0;p<=r;p++){const _=p/r*s,v=f/n*Math.PI*2;h.x=(e+t*Math.cos(v))*Math.cos(_),h.y=(e+t*Math.cos(v))*Math.sin(_),h.z=t*Math.sin(v),a.push(h.x,h.y,h.z),u.x=e*Math.cos(_),u.y=e*Math.sin(_),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(p/r),c.push(f/n)}for(let f=1;f<=n;f++)for(let p=1;p<=r;p++){const _=(r+1)*f+p-1,v=(r+1)*(f-1)+p-1,g=(r+1)*(f-1)+p,b=(r+1)*f+p;o.push(_,v,b),o.push(v,g,b)}this.setIndex(o),this.setAttribute("position",new ui(a,3)),this.setAttribute("normal",new ui(l,3)),this.setAttribute("uv",new ui(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new d3(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class cV extends Or{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new $t(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const iA=new Ct,_U=new me,yU=new me;class zle{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new on(512,512),this.map=null,this.mapPass=null,this.matrix=new Ct,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new o3,this._frameExtents=new on(1,1),this._viewportCount=1,this._viewports=[new Nr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;_U.setFromMatrixPosition(e.matrixWorld),t.position.copy(_U),yU.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(yU),t.updateMatrixWorld(),iA.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(iA),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(iA)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Gle extends zle{constructor(){super(new g1(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Vle extends cV{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Or.DEFAULT_UP),this.updateMatrix(),this.target=new Or,this.shadow=new Gle}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Hle extends cV{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}const xU=new Ct,bU=new Ct,Ih=new Ct;class $le{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ys,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ys,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Ih.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(Lx*t.fov*.5)/t.zoom;let a,l;bU.elements[12]=-r,xU.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,Ih.elements[0]=2*t.near/(l-a),Ih.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Ih),a=-o*t.aspect-s,l=o*t.aspect-s,Ih.elements[0]=2*t.near/(l-a),Ih.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Ih)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(bU),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(xU)}}class Rb{constructor(e){this.value=e}clone(){return new Rb(this.value.clone===void 0?this.value:this.value.clone())}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n3}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n3);var EC={exports:{}};(function(i,e){/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */(function(){var t,n,r,s,o,a,l,c,u,h,d,f,p,_,v,g,b,m,y,A,w,M,T,E,C,N,P,L,R,F,V,G,U,z,O,D,B,W,q,j,te,ne,Z,le,re,se,$,fe,xe,Ie,ge,Oe,Me,Y,Q,de,Le,ie,K,be,Ue,ve,Ne,$e,Ee,Ze,nt,rt,Be,qe,it,at,ht,Qe,je,ee,Ge,Ce,De,Xe,gt,_t,Mt=[].slice;Ce=function(){var J,ae,ue,ye,Se;for(J={},Se="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),ye=0,ae=Se.length;ye<ae;ye++)ue=Se[ye],J["[object "+ue+"]"]=ue.toLowerCase();return function(Fe){var ze;return ze=Object.prototype.toString.call(Fe),J[ze]||"object"}}(),$=function(J,ae,ue){return ae==null&&(ae=0),ue==null&&(ue=1),J<ae&&(J=ae),J>ue&&(J=ue),J},De=function(J){return J.length>=3?Array.prototype.slice.call(J):J[0]},w=function(J){var ae,ue;for(J._clipped=!1,J._unclipped=J.slice(0),ae=ue=0;ue<3;ae=++ue)ae<3?((J[ae]<0||J[ae]>255)&&(J._clipped=!0),J[ae]<0&&(J[ae]=0),J[ae]>255&&(J[ae]=255)):ae===3&&(J[ae]<0&&(J[ae]=0),J[ae]>1&&(J[ae]=1));return J._clipped||delete J._unclipped,J},s=Math.PI,ht=Math.round,T=Math.cos,L=Math.floor,de=Math.pow,fe=Math.log,je=Math.sin,ee=Math.sqrt,_=Math.atan2,ge=Math.max,p=Math.abs,l=s*2,o=s/3,n=s/180,a=180/s,A=function(){return arguments[0]instanceof t?arguments[0]:function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,arguments,function(){})},A.default=A,f=[],i!==null&&i.exports!=null&&(i.exports=A),at=e!==null?e:this,at.chroma=A,A.version="1.4.1",d={},u=[],h=!1,t=function(){function J(){var ae,ue,ye,Se,Fe,ze,He,lt,mt;for(ze=this,ue=[],lt=0,Se=arguments.length;lt<Se;lt++)ae=arguments[lt],ae!=null&&ue.push(ae);if(ue.length>1&&(He=ue[ue.length-1]),d[He]!=null)ze._rgb=w(d[He](De(ue.slice(0,-1))));else{for(h||(u=u.sort(function(wt,Gt){return Gt.p-wt.p}),h=!0),mt=0,Fe=u.length;mt<Fe&&(ye=u[mt],He=ye.test.apply(ye,ue),!He);mt++);He&&(ze._rgb=w(d[He].apply(d,ue)))}ze._rgb==null&&console.warn("unknown format: "+ue),ze._rgb==null&&(ze._rgb=[0,0,0]),ze._rgb.length===3&&ze._rgb.push(1)}return J.prototype.toString=function(){return this.hex()},J}(),A._input=d;/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */A.brewer=m={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var J,ae;ae=[];for(J in m)ae.push(m[J.toLowerCase()]=m[J]);return ae}(),Xe={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},A.colors=Xe,ne=function(){var J,ae,ue,ye,Se,Fe,ze,He,lt;return ae=De(arguments),Se=ae[0],J=ae[1],ue=ae[2],He=(Se+16)/116,ze=isNaN(J)?He:He+J/500,lt=isNaN(ue)?He:He-ue/200,He=r.Yn*Z(He),ze=r.Xn*Z(ze),lt=r.Zn*Z(lt),Fe=_t(3.2404542*ze-1.5371385*He-.4985314*lt),ye=_t(-.969266*ze+1.8760108*He+.041556*lt),ue=_t(.0556434*ze-.2040259*He+1.0572252*lt),[Fe,ye,ue,ae.length>3?ae[3]:1]},_t=function(J){return 255*(J<=.00304?12.92*J:1.055*de(J,1/2.4)-.055)},Z=function(J){return J>r.t1?J*J*J:r.t2*(J-r.t0)},r={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},$e=function(){var J,ae,ue,ye,Se,Fe,ze,He;return ye=De(arguments),ue=ye[0],ae=ye[1],J=ye[2],Se=Be(ue,ae,J),Fe=Se[0],ze=Se[1],He=Se[2],[116*ze-16,500*(Fe-ze),200*(ze-He)]},qe=function(J){return(J/=255)<=.04045?J/12.92:de((J+.055)/1.055,2.4)},gt=function(J){return J>r.t3?de(J,1/3):J/r.t2+r.t0},Be=function(){var J,ae,ue,ye,Se,Fe,ze;return ye=De(arguments),ue=ye[0],ae=ye[1],J=ye[2],ue=qe(ue),ae=qe(ae),J=qe(J),Se=gt((.4124564*ue+.3575761*ae+.1804375*J)/r.Xn),Fe=gt((.2126729*ue+.7151522*ae+.072175*J)/r.Yn),ze=gt((.0193339*ue+.119192*ae+.9503041*J)/r.Zn),[Se,Fe,ze]},A.lab=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["lab"]),function(){})},d.lab=ne,t.prototype.lab=function(){return $e(this._rgb)},v=function(J){var ae,ue,ye,Se,Fe,ze,He,lt,mt,wt,Gt;return J=function(){var Tt,bt,H;for(H=[],bt=0,Tt=J.length;bt<Tt;bt++)Se=J[bt],H.push(A(Se));return H}(),J.length===2?(mt=function(){var Tt,bt,H;for(H=[],bt=0,Tt=J.length;bt<Tt;bt++)Se=J[bt],H.push(Se.lab());return H}(),Fe=mt[0],ze=mt[1],ae=function(Tt){var bt,H;return H=function(){var pe,Ae;for(Ae=[],bt=pe=0;pe<=2;bt=++pe)Ae.push(Fe[bt]+Tt*(ze[bt]-Fe[bt]));return Ae}(),A.lab.apply(A,H)}):J.length===3?(wt=function(){var Tt,bt,H;for(H=[],bt=0,Tt=J.length;bt<Tt;bt++)Se=J[bt],H.push(Se.lab());return H}(),Fe=wt[0],ze=wt[1],He=wt[2],ae=function(Tt){var bt,H;return H=function(){var pe,Ae;for(Ae=[],bt=pe=0;pe<=2;bt=++pe)Ae.push((1-Tt)*(1-Tt)*Fe[bt]+2*(1-Tt)*Tt*ze[bt]+Tt*Tt*He[bt]);return Ae}(),A.lab.apply(A,H)}):J.length===4?(Gt=function(){var Tt,bt,H;for(H=[],bt=0,Tt=J.length;bt<Tt;bt++)Se=J[bt],H.push(Se.lab());return H}(),Fe=Gt[0],ze=Gt[1],He=Gt[2],lt=Gt[3],ae=function(Tt){var bt,H;return H=function(){var pe,Ae;for(Ae=[],bt=pe=0;pe<=2;bt=++pe)Ae.push((1-Tt)*(1-Tt)*(1-Tt)*Fe[bt]+3*(1-Tt)*(1-Tt)*Tt*ze[bt]+3*(1-Tt)*Tt*Tt*He[bt]+Tt*Tt*Tt*lt[bt]);return Ae}(),A.lab.apply(A,H)}):J.length===5&&(ue=v(J.slice(0,3)),ye=v(J.slice(2,5)),ae=function(Tt){return Tt<.5?ue(Tt*2):ye((Tt-.5)*2)}),ae},A.bezier=function(J){var ae;return ae=v(J),ae.scale=function(){return A.scale(ae)},ae},A.cubehelix=function(J,ae,ue,ye,Se){var Fe,ze,He;return J==null&&(J=300),ae==null&&(ae=-1.5),ue==null&&(ue=1),ye==null&&(ye=1),Se==null&&(Se=[0,1]),Fe=0,Ce(Se)==="array"?ze=Se[1]-Se[0]:(ze=0,Se=[Se,Se]),He=function(lt){var mt,wt,Gt,Tt,bt,H,pe,Ae,we;return mt=l*((J+120)/360+ae*lt),pe=de(Se[0]+ze*lt,ye),H=Fe!==0?ue[0]+lt*Fe:ue,wt=H*pe*(1-pe)/2,Tt=T(mt),we=je(mt),Ae=pe+wt*(-.14861*Tt+1.78277*we),bt=pe+wt*(-.29227*Tt-.90649*we),Gt=pe+wt*(1.97294*Tt),A(w([Ae*255,bt*255,Gt*255,1]))},He.start=function(lt){return lt==null?J:(J=lt,He)},He.rotations=function(lt){return lt==null?ae:(ae=lt,He)},He.gamma=function(lt){return lt==null?ye:(ye=lt,He)},He.hue=function(lt){return lt==null?ue:(ue=lt,Ce(ue)==="array"?(Fe=ue[1]-ue[0],Fe===0&&(ue=ue[1])):Fe=0,He)},He.lightness=function(lt){return lt==null?Se:(Ce(lt)==="array"?(Se=lt,ze=lt[1]-lt[0]):(Se=[lt,lt],ze=0),He)},He.scale=function(){return A.scale(He)},He.hue(ue),He},A.random=function(){var J,ae,ue;for(ae="0123456789abcdef",J="#",ue=0;ue<6;++ue)J+=ae.charAt(L(Math.random()*16));return new t(J)},f=[],O=function(J,ae,ue,ye){var Se,Fe,ze,He;for(ue==null&&(ue=.5),ye==null&&(ye="rgb"),Ce(J)!=="object"&&(J=A(J)),Ce(ae)!=="object"&&(ae=A(ae)),ze=0,Fe=f.length;ze<Fe;ze++)if(Se=f[ze],ye===Se[0]){He=Se[1](J,ae,ue,ye);break}if(He==null)throw"color mode "+ye+" is not supported";return He.alpha(J.alpha()+ue*(ae.alpha()-J.alpha()))},A.interpolate=O,t.prototype.interpolate=function(J,ae,ue){return O(this,J,ae,ue)},A.mix=O,t.prototype.mix=t.prototype.interpolate,d.rgb=function(){var J,ae,ue,ye;ae=De(arguments),ue=[];for(J in ae)ye=ae[J],ue.push(ye);return ue},A.rgb=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["rgb"]),function(){})},t.prototype.rgb=function(J){return J==null&&(J=!0),J?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},t.prototype.rgba=function(J){return J==null&&(J=!0),J?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},u.push({p:3,test:function(J){var ae;if(ae=De(arguments),Ce(ae)==="array"&&ae.length===3||ae.length===4&&Ce(ae[3])==="number"&&ae[3]>=0&&ae[3]<=1)return"rgb"}}),d.lrgb=d.rgb,W=function(J,ae,ue,ye){var Se,Fe;return Se=J._rgb,Fe=ae._rgb,new t(ee(de(Se[0],2)*(1-ue)+de(Fe[0],2)*ue),ee(de(Se[1],2)*(1-ue)+de(Fe[1],2)*ue),ee(de(Se[2],2)*(1-ue)+de(Fe[2],2)*ue),ye)},c=function(J){var ae,ue,ye,Se,Fe,ze;for(ue=1/J.length,ze=[0,0,0,0],Se=0,ye=J.length;Se<ye;Se++)ae=J[Se],Fe=ae._rgb,ze[0]+=de(Fe[0],2)*ue,ze[1]+=de(Fe[1],2)*ue,ze[2]+=de(Fe[2],2)*ue,ze[3]+=Fe[3]*ue;return ze[0]=ee(ze[0]),ze[1]=ee(ze[1]),ze[2]=ee(ze[2]),ze[3]>1&&(ze[3]=1),new t(w(ze))},f.push(["lrgb",W]),A.average=function(J,ae){var ue,ye,Se,Fe,ze,He,lt,mt,wt,Gt,Tt,bt,H;if(ae==null&&(ae="rgb"),wt=J.length,J=J.map(function(pe){return A(pe)}),lt=J.splice(0,1)[0],ae==="lrgb")return c(J);bt=lt.get(ae),Fe=[],ze=0,He=0;for(mt in bt)bt[mt]=bt[mt]||0,Fe.push(isNaN(bt[mt])?0:1),ae.charAt(mt)==="h"&&!isNaN(bt[mt])&&(ue=bt[mt]/180*s,ze+=T(ue),He+=je(ue));for(ye=lt.alpha(),Tt=0,Gt=J.length;Tt<Gt;Tt++){Se=J[Tt],H=Se.get(ae),ye+=Se.alpha();for(mt in bt)isNaN(H[mt])||(Fe[mt]+=1,ae.charAt(mt)==="h"?(ue=H[mt]/180*s,ze+=T(ue),He+=je(ue)):bt[mt]+=H[mt])}for(mt in bt)if(ae.charAt(mt)==="h"){for(ue=_(He/Fe[mt],ze/Fe[mt])/s*180;ue<0;)ue+=360;for(;ue>=360;)ue-=360;bt[mt]=ue}else bt[mt]=bt[mt]/Fe[mt];return A(bt,ae).alpha(ye/wt)},F=function(J){var ae,ue,ye,Se,Fe,ze;if(J.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(J.length===4||J.length===7)&&(J=J.substr(1)),J.length===3&&(J=J.split(""),J=J[0]+J[0]+J[1]+J[1]+J[2]+J[2]),ze=parseInt(J,16),Se=ze>>16,ye=ze>>8&255,ue=ze&255,[Se,ye,ue,1];if(J.match(/^#?([A-Fa-f0-9]{8})$/))return J.length===9&&(J=J.substr(1)),ze=parseInt(J,16),Se=ze>>24&255,ye=ze>>16&255,ue=ze>>8&255,ae=ht((ze&255)/255*100)/100,[Se,ye,ue,ae];if(d.css!=null&&(Fe=d.css(J)))return Fe;throw"unknown color: "+J},be=function(J,ae){var ue,ye,Se,Fe,ze,He,lt;return ae==null&&(ae="auto"),ze=J[0],Se=J[1],ye=J[2],ue=J[3],ae==="auto"&&(ae=ue<1?"rgba":"rgb"),ze=Math.round(ze),Se=Math.round(Se),ye=Math.round(ye),lt=ze<<16|Se<<8|ye,He="000000"+lt.toString(16),He=He.substr(He.length-6),Fe="0"+ht(ue*255).toString(16),Fe=Fe.substr(Fe.length-2),"#"+function(){switch(ae.toLowerCase()){case"rgba":return He+Fe;case"argb":return Fe+He;default:return He}}()},d.hex=function(J){return F(J)},A.hex=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["hex"]),function(){})},t.prototype.hex=function(J){return J==null&&(J="auto"),be(this._rgb,J)},u.push({p:4,test:function(J){if(arguments.length===1&&Ce(J)==="string")return"hex"}}),U=function(){var J,ae,ue,ye,Se,Fe,ze,He,lt,mt,wt,Gt,Tt,bt;if(J=De(arguments),Se=J[0],wt=J[1],ze=J[2],wt===0)lt=ye=ae=ze*255;else{for(bt=[0,0,0],ue=[0,0,0],Tt=ze<.5?ze*(1+wt):ze+wt-ze*wt,Gt=2*ze-Tt,Se/=360,bt[0]=Se+1/3,bt[1]=Se,bt[2]=Se-1/3,Fe=He=0;He<=2;Fe=++He)bt[Fe]<0&&(bt[Fe]+=1),bt[Fe]>1&&(bt[Fe]-=1),6*bt[Fe]<1?ue[Fe]=Gt+(Tt-Gt)*6*bt[Fe]:2*bt[Fe]<1?ue[Fe]=Tt:3*bt[Fe]<2?ue[Fe]=Gt+(Tt-Gt)*(2/3-bt[Fe])*6:ue[Fe]=Gt;mt=[ht(ue[0]*255),ht(ue[1]*255),ht(ue[2]*255)],lt=mt[0],ye=mt[1],ae=mt[2]}return J.length>3?[lt,ye,ae,J[3]]:[lt,ye,ae]},ve=function(J,ae,ue){var ye,Se,Fe,ze,He;return J!==void 0&&J.length>=3&&(ze=J,J=ze[0],ae=ze[1],ue=ze[2]),J/=255,ae/=255,ue/=255,Fe=Math.min(J,ae,ue),ge=Math.max(J,ae,ue),Se=(ge+Fe)/2,ge===Fe?(He=0,ye=Number.NaN):He=Se<.5?(ge-Fe)/(ge+Fe):(ge-Fe)/(2-ge-Fe),J===ge?ye=(ae-ue)/(ge-Fe):ae===ge?ye=2+(ue-J)/(ge-Fe):ue===ge&&(ye=4+(J-ae)/(ge-Fe)),ye*=60,ye<0&&(ye+=360),[ye,He,Se]},A.hsl=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["hsl"]),function(){})},d.hsl=U,t.prototype.hsl=function(){return ve(this._rgb)},z=function(){var J,ae,ue,ye,Se,Fe,ze,He,lt,mt,wt,Gt,Tt,bt,H,pe,Ae,we;if(J=De(arguments),Se=J[0],pe=J[1],we=J[2],we*=255,pe===0)lt=ye=ae=we;else switch(Se===360&&(Se=0),Se>360&&(Se-=360),Se<0&&(Se+=360),Se/=60,Fe=L(Se),ue=Se-Fe,ze=we*(1-pe),He=we*(1-pe*ue),Ae=we*(1-pe*(1-ue)),Fe){case 0:mt=[we,Ae,ze],lt=mt[0],ye=mt[1],ae=mt[2];break;case 1:wt=[He,we,ze],lt=wt[0],ye=wt[1],ae=wt[2];break;case 2:Gt=[ze,we,Ae],lt=Gt[0],ye=Gt[1],ae=Gt[2];break;case 3:Tt=[ze,He,we],lt=Tt[0],ye=Tt[1],ae=Tt[2];break;case 4:bt=[Ae,ze,we],lt=bt[0],ye=bt[1],ae=bt[2];break;case 5:H=[we,ze,He],lt=H[0],ye=H[1],ae=H[2]}return[lt,ye,ae,J.length>3?J[3]:1]},Ne=function(){var J,ae,ue,ye,Se,Fe,ze,He,lt;return ze=De(arguments),Fe=ze[0],ue=ze[1],J=ze[2],Se=Math.min(Fe,ue,J),ge=Math.max(Fe,ue,J),ae=ge-Se,lt=ge/255,ge===0?(ye=Number.NaN,He=0):(He=ae/ge,Fe===ge&&(ye=(ue-J)/ae),ue===ge&&(ye=2+(J-Fe)/ae),J===ge&&(ye=4+(Fe-ue)/ae),ye*=60,ye<0&&(ye+=360)),[ye,He,lt]},A.hsv=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["hsv"]),function(){})},d.hsv=z,t.prototype.hsv=function(){return Ne(this._rgb)},Y=function(J){var ae,ue,ye;return Ce(J)==="number"&&J>=0&&J<=16777215?(ye=J>>16,ue=J>>8&255,ae=J&255,[ye,ue,ae,1]):(console.warn("unknown num color: "+J),[0,0,0,1])},nt=function(){var J,ae,ue,ye;return ye=De(arguments),ue=ye[0],ae=ye[1],J=ye[2],(ue<<16)+(ae<<8)+J},A.num=function(J){return new t(J,"num")},t.prototype.num=function(J){return J==null&&(J="rgb"),nt(this._rgb,J)},d.num=Y,u.push({p:1,test:function(J){if(arguments.length===1&&Ce(J)==="number"&&J>=0&&J<=16777215)return"num"}}),R=function(){var J,ae,ue,ye,Se,Fe,ze,He,lt,mt,wt,Gt,Tt,bt,H,pe,Ae,we,Pe,et;if(ue=De(arguments),He=ue[0],Se=ue[1],ae=ue[2],Se=Se/100,ze=ze/100*255,J=Se*255,Se===0)Gt=ze=ye=ae;else switch(He===360&&(He=0),He>360&&(He-=360),He<0&&(He+=360),He/=60,lt=L(He),Fe=He-lt,mt=ae*(1-Se),wt=mt+J*(1-Fe),Pe=mt+J*Fe,et=mt+J,lt){case 0:Tt=[et,Pe,mt],Gt=Tt[0],ze=Tt[1],ye=Tt[2];break;case 1:bt=[wt,et,mt],Gt=bt[0],ze=bt[1],ye=bt[2];break;case 2:H=[mt,et,Pe],Gt=H[0],ze=H[1],ye=H[2];break;case 3:pe=[mt,wt,et],Gt=pe[0],ze=pe[1],ye=pe[2];break;case 4:Ae=[Pe,mt,et],Gt=Ae[0],ze=Ae[1],ye=Ae[2];break;case 5:we=[et,mt,wt],Gt=we[0],ze=we[1],ye=we[2]}return[Gt,ze,ye,ue.length>3?ue[3]:1]},K=function(){var J,ae,ue,ye,Se,Fe,ze,He,lt;return lt=De(arguments),He=lt[0],Se=lt[1],ae=lt[2],ze=Math.min(He,Se,ae),ge=Math.max(He,Se,ae),ye=ge-ze,ue=ye*100/255,J=ze/(255-ye)*100,ye===0?Fe=Number.NaN:(He===ge&&(Fe=(Se-ae)/ye),Se===ge&&(Fe=2+(ae-He)/ye),ae===ge&&(Fe=4+(He-Se)/ye),Fe*=60,Fe<0&&(Fe+=360)),[Fe,ue,J]},A.hcg=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["hcg"]),function(){})},d.hcg=R,t.prototype.hcg=function(){return K(this._rgb)},E=function(J){var ae,ue,ye,Se,Fe,ze,He,lt;if(J=J.toLowerCase(),A.colors!=null&&A.colors[J])return F(A.colors[J]);if(Fe=J.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(He=Fe.slice(1,4),Se=ze=0;ze<=2;Se=++ze)He[Se]=+He[Se];He[3]=1}else if(Fe=J.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(He=Fe.slice(1,5),Se=lt=0;lt<=3;Se=++lt)He[Se]=+He[Se];else if(Fe=J.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(He=Fe.slice(1,4),Se=ae=0;ae<=2;Se=++ae)He[Se]=ht(He[Se]*2.55);He[3]=1}else if(Fe=J.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(He=Fe.slice(1,5),Se=ue=0;ue<=2;Se=++ue)He[Se]=ht(He[Se]*2.55);He[3]=+He[3]}else(Fe=J.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(ye=Fe.slice(1,4),ye[1]*=.01,ye[2]*=.01,He=U(ye),He[3]=1):(Fe=J.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(ye=Fe.slice(1,4),ye[1]*=.01,ye[2]*=.01,He=U(ye),He[3]=+Fe[4]);return He},ie=function(J){var ae;if(ae=J[3]<1?"rgba":"rgb",ae==="rgb")return ae+"("+J.slice(0,3).map(ht).join(",")+")";if(ae==="rgba")return ae+"("+J.slice(0,3).map(ht).join(",")+","+J[3]+")"},it=function(J){return ht(J*100)/100},G=function(J,ae){var ue;return ue=ae<1?"hsla":"hsl",J[0]=it(J[0]||0),J[1]=it(J[1]*100)+"%",J[2]=it(J[2]*100)+"%",ue==="hsla"&&(J[3]=ae),ue+"("+J.join(",")+")"},d.css=function(J){return E(J)},A.css=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["css"]),function(){})},t.prototype.css=function(J){if(J==null&&(J="rgb"),J.slice(0,3)==="rgb")return ie(this._rgb);if(J.slice(0,3)==="hsl")return G(this.hsl(),this.alpha())},d.named=function(J){return F(Xe[J])},u.push({p:5,test:function(J){if(arguments.length===1&&Xe[J]!=null)return"named"}}),t.prototype.name=function(J){var ae,ue;arguments.length&&(Xe[J]&&(this._rgb=F(Xe[J])),this._rgb[3]=1),ae=this.hex("rgb");for(ue in Xe)if(ae===Xe[ue])return ue;return ae},le=function(){var J,ae,ue,ye;return ye=De(arguments),ue=ye[0],J=ye[1],ae=ye[2],ae=ae*n,[ue,T(ae)*J,je(ae)*J]},re=function(){var J,ae,ue,ye,Se,Fe,ze,He,lt,mt,wt;return ue=De(arguments),He=ue[0],Se=ue[1],ze=ue[2],mt=le(He,Se,ze),J=mt[0],ae=mt[1],ye=mt[2],wt=ne(J,ae,ye),lt=wt[0],Fe=wt[1],ye=wt[2],[lt,Fe,ye,ue.length>3?ue[3]:1]},te=function(){var J,ae,ue,ye,Se,Fe;return Fe=De(arguments),Se=Fe[0],J=Fe[1],ae=Fe[2],ue=ee(J*J+ae*ae),ye=(_(ae,J)*a+360)%360,ht(ue*1e4)===0&&(ye=Number.NaN),[Se,ue,ye]},Ee=function(){var J,ae,ue,ye,Se,Fe,ze;return Fe=De(arguments),Se=Fe[0],ue=Fe[1],ae=Fe[2],ze=$e(Se,ue,ae),ye=ze[0],J=ze[1],ae=ze[2],te(ye,J,ae)},A.lch=function(){var J;return J=De(arguments),new t(J,"lch")},A.hcl=function(){var J;return J=De(arguments),new t(J,"hcl")},d.lch=re,d.hcl=function(){var J,ae,ue,ye;return ye=De(arguments),ae=ye[0],J=ye[1],ue=ye[2],re([ue,J,ae])},t.prototype.lch=function(){return Ee(this._rgb)},t.prototype.hcl=function(){return Ee(this._rgb).reverse()},Le=function(J){var ae,ue,ye,Se,Fe,ze,He,lt,mt;return J==null&&(J="rgb"),lt=De(arguments),He=lt[0],Se=lt[1],ae=lt[2],He=He/255,Se=Se/255,ae=ae/255,Fe=1-Math.max(He,Math.max(Se,ae)),ye=Fe<1?1/(1-Fe):0,ue=(1-He-Fe)*ye,ze=(1-Se-Fe)*ye,mt=(1-ae-Fe)*ye,[ue,ze,mt,Fe]},M=function(){var J,ae,ue,ye,Se,Fe,ze,He,lt;return ae=De(arguments),ye=ae[0],ze=ae[1],lt=ae[2],Fe=ae[3],J=ae.length>4?ae[4]:1,Fe===1?[0,0,0,J]:(He=ye>=1?0:255*(1-ye)*(1-Fe),Se=ze>=1?0:255*(1-ze)*(1-Fe),ue=lt>=1?0:255*(1-lt)*(1-Fe),[He,Se,ue,J])},d.cmyk=function(){return M(De(arguments))},A.cmyk=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["cmyk"]),function(){})},t.prototype.cmyk=function(){return Le(this._rgb)},d.gl=function(){var J,ae,ue,ye,Se;for(ye=(function(){var Fe,ze;Fe=De(arguments),ze=[];for(ae in Fe)Se=Fe[ae],ze.push(Se);return ze}).apply(this,arguments),J=ue=0;ue<=2;J=++ue)ye[J]*=255;return ye},A.gl=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["gl"]),function(){})},t.prototype.gl=function(){var J;return J=this._rgb,[J[0]/255,J[1]/255,J[2]/255,J[3]]},Ze=function(J,ae,ue){var ye;return ye=De(arguments),J=ye[0],ae=ye[1],ue=ye[2],J=xe(J),ae=xe(ae),ue=xe(ue),.2126*J+.7152*ae+.0722*ue},xe=function(J){return J/=255,J<=.03928?J/12.92:de((J+.055)/1.055,2.4)},j=function(J,ae,ue,ye){var Se,Fe;return Se=J._rgb,Fe=ae._rgb,new t(Se[0]+ue*(Fe[0]-Se[0]),Se[1]+ue*(Fe[1]-Se[1]),Se[2]+ue*(Fe[2]-Se[2]),ye)},f.push(["rgb",j]),t.prototype.luminance=function(J,ae){var ue,ye,Se,Fe,ze;return ae==null&&(ae="rgb"),arguments.length?(Fe=this._rgb,J===0?Fe=[0,0,0,this._rgb[3]]:J===1?Fe=[255,255,255,this[3]]:(ue=Ze(this._rgb),ye=1e-7,Se=20,ze=function(He,lt){var mt,wt;return wt=He.interpolate(lt,.5,ae),mt=wt.luminance(),Math.abs(J-mt)<ye||!Se--?wt:mt>J?ze(He,wt):ze(wt,lt)},ue>J?Fe=ze(A("black"),this).rgba():Fe=ze(this,A("white")).rgba()),A(Fe).alpha(this.alpha())):Ze(this._rgb)},Ge=function(J){var ae,ue,ye,Se;return Se=J/100,Se<66?(ye=255,ue=-155.25485562709179-.44596950469579133*(ue=Se-2)+104.49216199393888*fe(ue),ae=Se<20?0:-254.76935184120902+.8274096064007395*(ae=Se-10)+115.67994401066147*fe(ae)):(ye=351.97690566805693+.114206453784165*(ye=Se-55)-40.25366309332127*fe(ye),ue=325.4494125711974+.07943456536662342*(ue=Se-50)-28.0852963507957*fe(ue),ae=255),[ye,ue,ae]},rt=function(){var J,ae,ue,ye,Se,Fe,ze,He;for(Fe=De(arguments),Se=Fe[0],Fe[1],J=Fe[2],ye=1e3,ue=4e4,ae=.4;ue-ye>ae;)He=(ue+ye)*.5,ze=Ge(He),ze[2]/ze[0]>=J/Se?ue=He:ye=He;return ht(He)},A.temperature=A.kelvin=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["temperature"]),function(){})},d.temperature=d.kelvin=d.K=Ge,t.prototype.temperature=function(){return rt(this._rgb)},t.prototype.kelvin=t.prototype.temperature,A.contrast=function(J,ae){var ue,ye,Se,Fe;return((Se=Ce(J))==="string"||Se==="number")&&(J=new t(J)),((Fe=Ce(ae))==="string"||Fe==="number")&&(ae=new t(ae)),ue=J.luminance(),ye=ae.luminance(),ue>ye?(ue+.05)/(ye+.05):(ye+.05)/(ue+.05)},A.distance=function(J,ae,ue){var ye,Se,Fe,ze,He,lt,mt;ue==null&&(ue="lab"),((He=Ce(J))==="string"||He==="number")&&(J=new t(J)),((lt=Ce(ae))==="string"||lt==="number")&&(ae=new t(ae)),Fe=J.get(ue),ze=ae.get(ue),mt=0;for(Se in Fe)ye=(Fe[Se]||0)-(ze[Se]||0),mt+=ye*ye;return Math.sqrt(mt)},A.deltaE=function(J,ae,ue,ye){var Se,Fe,ze,He,lt,mt,wt,Gt,Tt,bt,H,pe,Ae,we,Pe,et,dt,xt,Ye,We,st,ct,Nt,Ft,Dt,Bt,St;for(ue==null&&(ue=1),ye==null&&(ye=1),((dt=Ce(J))==="string"||dt==="number")&&(J=new t(J)),((xt=Ce(ae))==="string"||xt==="number")&&(ae=new t(ae)),Ye=J.lab(),Se=Ye[0],ze=Ye[1],lt=Ye[2],We=ae.lab(),Fe=We[0],He=We[1],mt=We[2],wt=ee(ze*ze+lt*lt),Gt=ee(He*He+mt*mt),Nt=Se<16?.511:.040975*Se/(1+.01765*Se),st=.0638*wt/(1+.0131*wt)+.638,et=wt<1e-6?0:_(lt,ze)*180/s;et<0;)et+=360;for(;et>=360;)et-=360;return Ft=et>=164&&et<=345?.56+p(.2*T(s*(et+168)/180)):.36+p(.4*T(s*(et+35)/180)),Tt=wt*wt*wt*wt,Pe=ee(Tt/(Tt+1900)),ct=st*(Pe*Ft+1-Pe),we=Se-Fe,Ae=wt-Gt,H=ze-He,pe=lt-mt,bt=H*H+pe*pe-Ae*Ae,Dt=we/(ue*Nt),Bt=Ae/(ye*st),St=ct,ee(Dt*Dt+Bt*Bt+bt/(St*St))},t.prototype.get=function(J){var ae,ue,ye,Se,Fe,ze;return ye=this,Fe=J.split("."),Se=Fe[0],ae=Fe[1],ze=ye[Se](),ae?(ue=Se.indexOf(ae),ue>-1?ze[ue]:console.warn("unknown channel "+ae+" in mode "+Se)):ze},t.prototype.set=function(J,ae){var ue,ye,Se,Fe,ze,He;if(Se=this,ze=J.split("."),Fe=ze[0],ue=ze[1],ue)if(He=Se[Fe](),ye=Fe.indexOf(ue),ye>-1)if(Ce(ae)==="string")switch(ae.charAt(0)){case"+":He[ye]+=+ae;break;case"-":He[ye]+=+ae;break;case"*":He[ye]*=+ae.substr(1);break;case"/":He[ye]/=+ae.substr(1);break;default:He[ye]=+ae}else He[ye]=ae;else console.warn("unknown channel "+ue+" in mode "+Fe);else He=ae;return A(He,Fe).alpha(Se.alpha())},t.prototype.clipped=function(){return this._rgb._clipped||!1},t.prototype.alpha=function(J){return arguments.length?A.rgb([this._rgb[0],this._rgb[1],this._rgb[2],J]):this._rgb[3]},t.prototype.darken=function(J){var ae,ue;return J==null&&(J=1),ue=this,ae=ue.lab(),ae[0]-=r.Kn*J,A.lab(ae).alpha(ue.alpha())},t.prototype.brighten=function(J){return J==null&&(J=1),this.darken(-J)},t.prototype.darker=t.prototype.darken,t.prototype.brighter=t.prototype.brighten,t.prototype.saturate=function(J){var ae,ue;return J==null&&(J=1),ue=this,ae=ue.lch(),ae[1]+=J*r.Kn,ae[1]<0&&(ae[1]=0),A.lch(ae).alpha(ue.alpha())},t.prototype.desaturate=function(J){return J==null&&(J=1),this.saturate(-J)},t.prototype.premultiply=function(){var J,ae;return ae=this.rgb(),J=this.alpha(),A(ae[0]*J,ae[1]*J,ae[2]*J,J)},g=function(J,ae,ue){if(!g[ue])throw"unknown blend mode "+ue;return g[ue](J,ae)},b=function(J){return function(ae,ue){var ye,Se;return ye=A(ue).rgb(),Se=A(ae).rgb(),A(J(ye,Se),"rgb")}},P=function(J){return function(ae,ue){var ye,Se,Fe;for(Fe=[],ye=Se=0;Se<=3;ye=++Se)Fe[ye]=J(ae[ye],ue[ye]);return Fe}},Me=function(J,ae){return J},Oe=function(J,ae){return J*ae/255},C=function(J,ae){return J>ae?ae:J},se=function(J,ae){return J>ae?J:ae},Qe=function(J,ae){return 255*(1-(1-J/255)*(1-ae/255))},Q=function(J,ae){return ae<128?2*J*ae/255:255*(1-2*(1-J/255)*(1-ae/255))},y=function(J,ae){return 255*(1-(1-ae/255)/(J/255))},N=function(J,ae){return J===255||(J=255*(ae/255)/(1-J/255),J>255)?255:J},g.normal=b(P(Me)),g.multiply=b(P(Oe)),g.screen=b(P(Qe)),g.overlay=b(P(Q)),g.darken=b(P(C)),g.lighten=b(P(se)),g.dodge=b(P(N)),g.burn=b(P(y)),A.blend=g,A.analyze=function(J){var ae,ue,ye,Se;for(ye={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},ue=0,ae=J.length;ue<ae;ue++)Se=J[ue],Se!=null&&!isNaN(Se)&&(ye.values.push(Se),ye.sum+=Se,Se<ye.min&&(ye.min=Se),Se>ye.max&&(ye.max=Se),ye.count+=1);return ye.domain=[ye.min,ye.max],ye.limits=function(Fe,ze){return A.limits(ye,Fe,ze)},ye},A.scale=function(J,ae){var ue,ye,Se,Fe,ze,He,lt,mt,wt,Gt,Tt,bt,H,pe,Ae,we,Pe,et,dt,xt,Ye;return wt="rgb",Gt=A("#ccc"),pe=0,ze=[0,1],H=[],bt=[0,0],ue=!1,Se=[],Tt=!1,mt=0,lt=1,Fe=!1,ye={},Ae=!0,He=1,xt=function(We){var st,ct,Nt,Ft,Dt,Bt;if(We==null&&(We=["#fff","#000"]),We!=null&&Ce(We)==="string"&&A.brewer!=null&&(We=A.brewer[We]||A.brewer[We.toLowerCase()]||We),Ce(We)==="array"){for(We.length===1&&(We=[We[0],We[0]]),We=We.slice(0),st=Nt=0,Ft=We.length-1;0<=Ft?Nt<=Ft:Nt>=Ft;st=0<=Ft?++Nt:--Nt)ct=We[st],Ce(ct)==="string"&&(We[st]=A(ct));for(H.length=0,st=Bt=0,Dt=We.length-1;0<=Dt?Bt<=Dt:Bt>=Dt;st=0<=Dt?++Bt:--Bt)H.push(st/(We.length-1))}return dt(),Se=We},Pe=function(We){var st,ct;if(ue!=null){for(ct=ue.length-1,st=0;st<ct&&We>=ue[st];)st++;return st-1}return 0},Ye=function(We){return We},et=function(We,st){var ct,Nt,Ft,Dt,Bt,St,vt,Wt;if(st==null&&(st=!1),isNaN(We)||We===null)return Gt;if(st?Wt=We:ue&&ue.length>2?(ct=Pe(We),Wt=ct/(ue.length-2)):lt!==mt?Wt=(We-mt)/(lt-mt):Wt=1,st||(Wt=Ye(Wt)),He!==1&&(Wt=de(Wt,He)),Wt=bt[0]+Wt*(1-bt[0]-bt[1]),Wt=Math.min(1,Math.max(0,Wt)),Dt=Math.floor(Wt*1e4),Ae&&ye[Dt])Nt=ye[Dt];else{if(Ce(Se)==="array")for(Ft=Bt=0,vt=H.length-1;0<=vt?Bt<=vt:Bt>=vt;Ft=0<=vt?++Bt:--Bt){if(St=H[Ft],Wt<=St){Nt=Se[Ft];break}if(Wt>=St&&Ft===H.length-1){Nt=Se[Ft];break}if(Wt>St&&Wt<H[Ft+1]){Wt=(Wt-St)/(H[Ft+1]-St),Nt=A.interpolate(Se[Ft],Se[Ft+1],Wt,wt);break}}else Ce(Se)==="function"&&(Nt=Se(Wt));Ae&&(ye[Dt]=Nt)}return Nt},dt=function(){return ye={}},xt(J),we=function(We){var st;return st=A(et(We)),Tt&&st[Tt]?st[Tt]():st},we.classes=function(We){var st;return We!=null?(Ce(We)==="array"?(ue=We,ze=[We[0],We[We.length-1]]):(st=A.analyze(ze),We===0?ue=[st.min,st.max]:ue=A.limits(st,"e",We)),we):ue},we.domain=function(We){var st,ct,Nt,Ft,Dt,Bt,St;if(!arguments.length)return ze;if(mt=We[0],lt=We[We.length-1],H=[],Nt=Se.length,We.length===Nt&&mt!==lt)for(Dt=0,Ft=We.length;Dt<Ft;Dt++)ct=We[Dt],H.push((ct-mt)/(lt-mt));else for(st=St=0,Bt=Nt-1;0<=Bt?St<=Bt:St>=Bt;st=0<=Bt?++St:--St)H.push(st/(Nt-1));return ze=[mt,lt],we},we.mode=function(We){return arguments.length?(wt=We,dt(),we):wt},we.range=function(We,st){return xt(We,st),we},we.out=function(We){return Tt=We,we},we.spread=function(We){return arguments.length?(pe=We,we):pe},we.correctLightness=function(We){return We==null&&(We=!0),Fe=We,dt(),Fe?Ye=function(st){var ct,Nt,Ft,Dt,Bt,St,vt,Wt,Lt;for(ct=et(0,!0).lab()[0],Nt=et(1,!0).lab()[0],vt=ct>Nt,Ft=et(st,!0).lab()[0],Bt=ct+(Nt-ct)*st,Dt=Ft-Bt,Wt=0,Lt=1,St=20;Math.abs(Dt)>.01&&St-- >0;)(function(){return vt&&(Dt*=-1),Dt<0?(Wt=st,st+=(Lt-st)*.5):(Lt=st,st+=(Wt-st)*.5),Ft=et(st,!0).lab()[0],Dt=Ft-Bt})();return st}:Ye=function(st){return st},we},we.padding=function(We){return We!=null?(Ce(We)==="number"&&(We=[We,We]),bt=We,we):bt},we.colors=function(We,st){var ct,Nt,Ft,Dt,Bt,St,vt,Wt;if(arguments.length<2&&(st="hex"),Bt=[],arguments.length===0)Bt=Se.slice(0);else if(We===1)Bt=[we(.5)];else if(We>1)Nt=ze[0],ct=ze[1]-Nt,Bt=(function(){St=[];for(var Lt=0;0<=We?Lt<We:Lt>We;0<=We?Lt++:Lt--)St.push(Lt);return St}).apply(this).map(function(Lt){return we(Nt+Lt/(We-1)*ct)});else{if(J=[],vt=[],ue&&ue.length>2)for(Ft=Wt=1,Dt=ue.length;1<=Dt?Wt<Dt:Wt>Dt;Ft=1<=Dt?++Wt:--Wt)vt.push((ue[Ft-1]+ue[Ft])*.5);else vt=ze;Bt=vt.map(function(Lt){return we(Lt)})}return A[st]&&(Bt=Bt.map(function(Lt){return Lt[st]()})),Bt},we.cache=function(We){return We!=null?(Ae=We,we):Ae},we.gamma=function(We){return We!=null?(He=We,we):He},we.nodata=function(We){return We!=null?(Gt=A(We),we):Gt},we},A.scales==null&&(A.scales={}),A.scales.cool=function(){return A.scale([A.hsl(180,1,.9),A.hsl(250,.7,.4)])},A.scales.hot=function(){return A.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},A.analyze=function(J,ae,ue){var ye,Se,Fe,ze,He,lt,mt;if(He={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},ue==null&&(ue=function(){return!0}),ye=function(wt){wt!=null&&!isNaN(wt)&&(He.values.push(wt),He.sum+=wt,wt<He.min&&(He.min=wt),wt>He.max&&(He.max=wt),He.count+=1)},mt=function(wt,Gt){if(ue(wt,Gt))return ae!=null&&Ce(ae)==="function"?ye(ae(wt)):ae!=null&&Ce(ae)==="string"||Ce(ae)==="number"?ye(wt[ae]):ye(wt)},Ce(J)==="array")for(ze=0,Fe=J.length;ze<Fe;ze++)lt=J[ze],mt(lt);else for(Se in J)lt=J[Se],mt(lt,Se);return He.domain=[He.min,He.max],He.limits=function(wt,Gt){return A.limits(He,wt,Gt)},He},A.limits=function(J,ae,ue){var ye,Se,Fe,ze,He,lt,mt,wt,Gt,Tt,bt,H,pe,Ae,we,Pe,et,dt,xt,Ye,We,st,ct,Nt,Ft,Dt,Bt,St,vt,Wt,Lt,yn,bi,qn,Ln,tn,Yn,Ji,dn,Qn,er,Mr,oo,qa,ds,fs,ps,ao,Ya,oa,Ar,aa,lo,fr,Yr;if(ae==null&&(ae="equal"),ue==null&&(ue=7),Ce(J)==="array"&&(J=A.analyze(J)),Ft=J.min,ge=J.max,J.sum,fr=J.values.sort(function(cn,Pl){return cn-Pl}),ue===1)return[Ft,ge];if(ct=[],ae.substr(0,1)==="c"&&(ct.push(Ft),ct.push(ge)),ae.substr(0,1)==="e"){for(ct.push(Ft),Ye=Lt=1,Ln=ue-1;1<=Ln?Lt<=Ln:Lt>=Ln;Ye=1<=Ln?++Lt:--Lt)ct.push(Ft+Ye/ue*(ge-Ft));ct.push(ge)}else if(ae.substr(0,1)==="l"){if(Ft<=0)throw"Logarithmic scales are only possible for values > 0";for(Dt=Math.LOG10E*fe(Ft),Nt=Math.LOG10E*fe(ge),ct.push(Ft),Ye=Yr=1,tn=ue-1;1<=tn?Yr<=tn:Yr>=tn;Ye=1<=tn?++Yr:--Yr)ct.push(de(10,Dt+Ye/ue*(Nt-Dt)));ct.push(ge)}else if(ae.substr(0,1)==="q"){for(ct.push(Ft),Ye=ye=1,Mr=ue-1;1<=Mr?ye<=Mr:ye>=Mr;Ye=1<=Mr?++ye:--ye)yn=(fr.length-1)*Ye/ue,bi=L(yn),bi===yn?ct.push(fr[bi]):(qn=yn-bi,ct.push(fr[bi]*(1-qn)+fr[bi+1]*qn));ct.push(ge)}else if(ae.substr(0,1)==="k"){for(St=fr.length,Ae=new Array(St),dt=new Array(ue),oa=!0,vt=0,Pe=null,Pe=[],Pe.push(Ft),Ye=Se=1,oo=ue-1;1<=oo?Se<=oo:Se>=oo;Ye=1<=oo?++Se:--Se)Pe.push(Ft+Ye/ue*(ge-Ft));for(Pe.push(ge);oa;){for(We=Fe=0,qa=ue-1;0<=qa?Fe<=qa:Fe>=qa;We=0<=qa?++Fe:--Fe)dt[We]=0;for(Ye=ze=0,ds=St-1;0<=ds?ze<=ds:ze>=ds;Ye=0<=ds?++ze:--ze){for(lo=fr[Ye],Bt=Number.MAX_VALUE,We=He=0,fs=ue-1;0<=fs?He<=fs:He>=fs;We=0<=fs?++He:--He)xt=p(Pe[We]-lo),xt<Bt&&(Bt=xt,we=We);dt[we]++,Ae[Ye]=we}for(Wt=new Array(ue),We=lt=0,ps=ue-1;0<=ps?lt<=ps:lt>=ps;We=0<=ps?++lt:--lt)Wt[We]=null;for(Ye=mt=0,ao=St-1;0<=ao?mt<=ao:mt>=ao;Ye=0<=ao?++mt:--mt)et=Ae[Ye],Wt[et]===null?Wt[et]=fr[Ye]:Wt[et]+=fr[Ye];for(We=wt=0,Ya=ue-1;0<=Ya?wt<=Ya:wt>=Ya;We=0<=Ya?++wt:--wt)Wt[We]*=1/dt[We];for(oa=!1,We=Gt=0,Yn=ue-1;0<=Yn?Gt<=Yn:Gt>=Yn;We=0<=Yn?++Gt:--Gt)if(Wt[We]!==Pe[Ye]){oa=!0;break}Pe=Wt,vt++,vt>200&&(oa=!1)}for(st={},We=Tt=0,Ji=ue-1;0<=Ji?Tt<=Ji:Tt>=Ji;We=0<=Ji?++Tt:--Tt)st[We]=[];for(Ye=bt=0,dn=St-1;0<=dn?bt<=dn:bt>=dn;Ye=0<=dn?++bt:--bt)et=Ae[Ye],st[et].push(fr[Ye]);for(Ar=[],We=H=0,Qn=ue-1;0<=Qn?H<=Qn:H>=Qn;We=0<=Qn?++H:--H)Ar.push(st[We][0]),Ar.push(st[We][st[We].length-1]);for(Ar=Ar.sort(function(cn,Pl){return cn-Pl}),ct.push(Ar[0]),Ye=pe=1,er=Ar.length-1;pe<=er;Ye=pe+=2)aa=Ar[Ye],!isNaN(aa)&&ct.indexOf(aa)===-1&&ct.push(aa)}return ct},V=function(J,ae,ue){var ye,Se,Fe,ze;return ye=De(arguments),J=ye[0],ae=ye[1],ue=ye[2],isNaN(J)&&(J=0),J/=360,J<1/3?(Se=(1-ae)/3,ze=(1+ae*T(l*J)/T(o-l*J))/3,Fe=1-(Se+ze)):J<2/3?(J-=1/3,ze=(1-ae)/3,Fe=(1+ae*T(l*J)/T(o-l*J))/3,Se=1-(ze+Fe)):(J-=2/3,Fe=(1-ae)/3,Se=(1+ae*T(l*J)/T(o-l*J))/3,ze=1-(Fe+Se)),ze=$(ue*ze*3),Fe=$(ue*Fe*3),Se=$(ue*Se*3),[ze*255,Fe*255,Se*255,ye.length>3?ye[3]:1]},Ue=function(){var J,ae,ue,ye,Se,Fe,ze,He;return ze=De(arguments),Fe=ze[0],ae=ze[1],J=ze[2],l=Math.PI*2,Fe/=255,ae/=255,J/=255,Se=Math.min(Fe,ae,J),ye=(Fe+ae+J)/3,He=1-Se/ye,He===0?ue=0:(ue=(Fe-ae+(Fe-J))/2,ue/=Math.sqrt((Fe-ae)*(Fe-ae)+(Fe-J)*(ae-J)),ue=Math.acos(ue),J>ae&&(ue=l-ue),ue/=l),[ue*360,He,ye]},A.hsi=function(){return function(J,ae,ue){ue.prototype=J.prototype;var ye=new ue,Se=J.apply(ye,ae);return Object(Se)===Se?Se:ye}(t,Mt.call(arguments).concat(["hsi"]),function(){})},d.hsi=V,t.prototype.hsi=function(){return Ue(this._rgb)},D=function(J,ae,ue,ye){var Se,Fe,ze,He,lt,mt,wt,Gt,Tt,bt,H,pe;return ye==="hsl"?(H=J.hsl(),pe=ae.hsl()):ye==="hsv"?(H=J.hsv(),pe=ae.hsv()):ye==="hcg"?(H=J.hcg(),pe=ae.hcg()):ye==="hsi"?(H=J.hsi(),pe=ae.hsi()):(ye==="lch"||ye==="hcl")&&(ye="hcl",H=J.hcl(),pe=ae.hcl()),ye.substr(0,1)==="h"&&(ze=H[0],Tt=H[1],mt=H[2],He=pe[0],bt=pe[1],wt=pe[2]),!isNaN(ze)&&!isNaN(He)?(He>ze&&He-ze>180?Se=He-(ze+360):He<ze&&ze-He>180?Se=He+360-ze:Se=He-ze,Fe=ze+ue*Se):isNaN(ze)?isNaN(He)?Fe=Number.NaN:(Fe=He,(mt===1||mt===0)&&ye!=="hsv"&&(Gt=bt)):(Fe=ze,(wt===1||wt===0)&&ye!=="hsv"&&(Gt=Tt)),Gt==null&&(Gt=Tt+ue*(bt-Tt)),lt=mt+ue*(wt-mt),A[ye](Fe,Gt,lt)},f=f.concat(function(){var J,ae,ue,ye;for(ue=["hsv","hsl","hsi","hcl","lch","hcg"],ye=[],ae=0,J=ue.length;ae<J;ae++)Ie=ue[ae],ye.push([Ie,D]);return ye}()),q=function(J,ae,ue,ye){var Se,Fe;return Se=J.num(),Fe=ae.num(),A.num(Se+(Fe-Se)*ue,"num")},f.push(["num",q]),B=function(J,ae,ue,ye){var Se,Fe;return Se=J.lab(),Fe=ae.lab(),new t(Se[0]+ue*(Fe[0]-Se[0]),Se[1]+ue*(Fe[1]-Se[1]),Se[2]+ue*(Fe[2]-Se[2]),ye)},f.push(["lab",B])}).call(s5)})(EC,EC.exports);var Wle=EC.exports,uV={exports:{}};(function(i){/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */(function(e){function t(o,a,l,c,u){this._listener=a,this._isOnce=l,this.context=c,this._signal=o,this._priority=u||0}t.prototype={active:!0,params:null,execute:function(o){var a,l;return this.active&&this._listener&&(l=this.params?this.params.concat(o):o,a=this._listener.apply(this.context,l),this._isOnce&&this.detach()),a},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function n(o,a){if(typeof o!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",a))}function r(){this._bindings=[],this._prevParams=null;var o=this;this.dispatch=function(){r.prototype.dispatch.apply(o,arguments)}}r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(o,a,l,c){var u=this._indexOfListener(o,l),h;if(u!==-1){if(h=this._bindings[u],h.isOnce()!==a)throw new Error("You cannot add"+(a?"":"Once")+"() then add"+(a?"Once":"")+"() the same listener without removing the relationship first.")}else h=new t(this,o,a,l,c),this._addBinding(h);return this.memorize&&this._prevParams&&h.execute(this._prevParams),h},_addBinding:function(o){var a=this._bindings.length;do--a;while(this._bindings[a]&&o._priority<=this._bindings[a]._priority);this._bindings.splice(a+1,0,o)},_indexOfListener:function(o,a){for(var l=this._bindings.length,c;l--;)if(c=this._bindings[l],c._listener===o&&c.context===a)return l;return-1},has:function(o,a){return this._indexOfListener(o,a)!==-1},add:function(o,a,l){return n(o,"add"),this._registerListener(o,!1,a,l)},addOnce:function(o,a,l){return n(o,"addOnce"),this._registerListener(o,!0,a,l)},remove:function(o,a){n(o,"remove");var l=this._indexOfListener(o,a);return l!==-1&&(this._bindings[l]._destroy(),this._bindings.splice(l,1)),o},removeAll:function(){for(var o=this._bindings.length;o--;)this._bindings[o]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(o){if(this.active){var a=Array.prototype.slice.call(arguments),l=this._bindings.length,c;if(this.memorize&&(this._prevParams=a),!!l){c=this._bindings.slice(),this._shouldPropagate=!0;do l--;while(c[l]&&this._shouldPropagate&&c[l].execute(a)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var s=r;s.Signal=r,i.exports?i.exports=s:e.signals=s})(s5)})(uV);var rn=uV.exports,hV={};(function(i){(function(){var e={not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function t(a){return r(o(a),arguments)}function n(a,l){return t.apply(null,[a].concat(l||[]))}function r(a,l){var c=1,u=a.length,h,d="",f,p,_,v,g,b,m,y;for(f=0;f<u;f++)if(typeof a[f]=="string")d+=a[f];else if(typeof a[f]=="object"){if(_=a[f],_.keys)for(h=l[c],p=0;p<_.keys.length;p++){if(h==null)throw new Error(t('[sprintf] Cannot access property "%s" of undefined value "%s"',_.keys[p],_.keys[p-1]));h=h[_.keys[p]]}else _.param_no?h=l[_.param_no]:h=l[c++];if(e.not_type.test(_.type)&&e.not_primitive.test(_.type)&&h instanceof Function&&(h=h()),e.numeric_arg.test(_.type)&&typeof h!="number"&&isNaN(h))throw new TypeError(t("[sprintf] expecting number but found %T",h));switch(e.number.test(_.type)&&(m=h>=0),_.type){case"b":h=parseInt(h,10).toString(2);break;case"c":h=String.fromCharCode(parseInt(h,10));break;case"d":case"i":h=parseInt(h,10);break;case"j":h=JSON.stringify(h,null,_.width?parseInt(_.width):0);break;case"e":h=_.precision?parseFloat(h).toExponential(_.precision):parseFloat(h).toExponential();break;case"f":h=_.precision?parseFloat(h).toFixed(_.precision):parseFloat(h);break;case"g":h=_.precision?String(Number(h.toPrecision(_.precision))):parseFloat(h);break;case"o":h=(parseInt(h,10)>>>0).toString(8);break;case"s":h=String(h),h=_.precision?h.substring(0,_.precision):h;break;case"t":h=String(!!h),h=_.precision?h.substring(0,_.precision):h;break;case"T":h=Object.prototype.toString.call(h).slice(8,-1).toLowerCase(),h=_.precision?h.substring(0,_.precision):h;break;case"u":h=parseInt(h,10)>>>0;break;case"v":h=h.valueOf(),h=_.precision?h.substring(0,_.precision):h;break;case"x":h=(parseInt(h,10)>>>0).toString(16);break;case"X":h=(parseInt(h,10)>>>0).toString(16).toUpperCase();break}e.json.test(_.type)?d+=h:(e.number.test(_.type)&&(!m||_.sign)?(y=m?"+":"-",h=h.toString().replace(e.sign,"")):y="",g=_.pad_char?_.pad_char==="0"?"0":_.pad_char.charAt(1):" ",b=_.width-(y+h).length,v=_.width&&b>0?g.repeat(b):"",d+=_.align?y+h+v:g==="0"?y+v+h:v+y+h)}return d}var s=Object.create(null);function o(a){if(s[a])return s[a];for(var l=a,c,u=[],h=0;l;){if((c=e.text.exec(l))!==null)u.push(c[0]);else if((c=e.modulo.exec(l))!==null)u.push("%");else if((c=e.placeholder.exec(l))!==null){if(c[2]){h|=1;var d=[],f=c[2],p=[];if((p=e.key.exec(f))!==null)for(d.push(p[1]);(f=f.substring(p[0].length))!=="";)if((p=e.key_access.exec(f))!==null)d.push(p[1]);else if((p=e.index_access.exec(f))!==null)d.push(p[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");c[2]=d}else h|=2;if(h===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");u.push({placeholder:c[0],param_no:c[1],keys:c[2],sign:c[3],pad_char:c[4],align:c[5],width:c[6],precision:c[7],type:c[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");l=l.substring(c[0].length)}return s[a]=u}i.sprintf=t,i.vsprintf=n,typeof window<"u"&&(window.sprintf=t,window.vsprintf=n)})()})(hV);var jle={};function Xle(i){if(typeof window>"u")return;const e=new RegExp(`${i}=([^&#=]*)`).exec(window.location.search);return e?decodeURIComponent(e[1]):void 0}function he(i,e){return i!==void 0?i:e}function Io(i,e){const t=Object.assign({},i);for(const n in e)i[n]===void 0&&(t[n]=e[n]);return t}function dV(i,e){for(const t in e){const n=e[t];n!==void 0&&(i[t]=n)}return i}function qle(){if(typeof window>"u")return!1;const i=window.navigator.userAgent;return/Opera|OPR/.test(i)?"Opera":/Chrome/i.test(i)?"Chrome":/Firefox/i.test(i)?"Firefox":/Mobile(\/.*)? Safari/i.test(i)?"Mobile Safari":/MSIE/i.test(i)?"Internet Explorer":!!/Safari/i.test(i)&&"Safari"}function Yle(i,e){return i<e?-1:i>e?1:0}function Hh(i,e,t=Yle){let n=0,r=i.length-1;for(;n<=r;){const s=n+r>>1,o=t(e,i[s]);if(o>0)n=s+1;else{if(!(o<0))return s;r=s-1}}return-n-1}function f3(i,e,t){const n=function(s,o){let a=s.length-1;if(s[a]<o)return-1;let l=0;for(;l<=a;){const c=l+a>>1;s[c]>=o?a=c-1:l=c+1}return a+1}(i,e),r=function(s,o){if(s[0]>o)return-1;let a=0,l=s.length-1;for(;a<=l;){const c=a+l>>1;s[c]>o?l=c-1:a=c+1}return a-1}(i,t);return n===-1||r===-1||n>r?0:r-n+1}function p3(i){return i.sort().filter(function(e,t,n){return t===0||e!==n[t-1]})}function v1(i){if(i.length>28672){const t=[];for(let n=0;n<i.length;n+=28672)t.push(String.fromCharCode.apply(null,i.subarray(n,n+28672)));return t.join("")}return String.fromCharCode.apply(null,i)}function fV(i,e){switch(i){case"int8":return new Int8Array(e);case"int16":return new Int16Array(e);case"int32":return new Int32Array(e);case"uint8":return new Uint8Array(e);case"uint16":return new Uint16Array(e);case"uint32":return new Uint32Array(e);case"float32":return new Float32Array(e);default:throw new Error("arrayType unknown: "+i)}}function El(i,e){return new(e>65535?Uint32Array:Uint16Array)(i)}function Fm(i){return i.buffer&&i.buffer instanceof ArrayBuffer?i.buffer:i}function jS(i,e){return i===void 0?i=new e:Array.isArray(i)&&(i=new e().fromArray(i)),i}function md(i){return jS(i,me)}function n0(i){return jS(i,Ct)}function TC(i){return jS(i,Ns)}function rA(i){return e=i,t=Float32Array,e instanceof t?e:new t(e);var e,t}function SU(i){return he(i,"").toString().toLowerCase()}class Qu{constructor(e){this.name=e,this._dict={}}add(e,t){this._dict[SU(e)]=t}get(e){return this._dict[SU(e)]}get names(){return Object.keys(this._dict)}}function Pi(i){return .01745*i}const Kle="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Iy=new Array(36);function m3(){let i,e=0;for(let t=0;t<36;t++)t===8||t===13||t===18||t===23?Iy[t]="-":t===14?Iy[t]="4":(e<=2&&(e=33554432+16777216*Math.random()|0),i=15&e,e>>=4,Iy[t]=Kle[t===19?3&i|8:i]);return Iy.join("")}function CC(i,e,t){return Math.max(e,Math.min(t,i))}function Zo(i,e,t){return i+(e-i)*t}function rc(i,e,t,n,r,s){const o=(t-i)*s,a=(n-e)*s,l=r*r;return(2*e-2*t+o+a)*(r*l)+(-3*e+3*t-2*o-a)*l+o*r+e}function X1(i,e,t){var n;return n=function(r,s,o){return(r-s)/(o-s)}(t,i,e),(t=CC(n,0,1))*t*(3-2*t)}var pV="sRGB";const Zle={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},Fx=new $t;function Bn(i,e,t){const n=t.value;return t.value=function(r,s){let o=n.bind(this,r,s)();return pV=="linear"?(Fx.set(o),Fx.convertSRGBToLinear(),Fx.getHex()):o},t}class Xn{constructor(e={}){this.parameters=Io(e,Zle),typeof this.parameters.value=="string"&&(this.parameters.value=Fx.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())}getScale(e={}){const t=Io(e,this.parameters);return t.scale==="rainbow"?t.scale=["red","orange","yellow","green","blue"]:t.scale==="rwb"&&(t.scale=["red","white","blue"]),t.reverse&&(t.domain=t.domain.slice().reverse()),Wle.scale(t.scale).mode(t.mode).domain(t.domain).out("num")}colorToArray(e,t=[],n=0){return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t}atomColorToArray(e,t,n){return this.colorToArray(this.atomColor?this.atomColor(e):0,t,n)}bondColor(e,t){return this.atomProxy&&this.atomColor?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):0}bondColorToArray(e,t,n,r){return this.colorToArray(this.bondColor(e,t),n,r)}volumeColorToArray(e,t,n){return this.colorToArray(this.volumeColor?this.volumeColor(e):0,t,n)}positionColorToArray(e,t,n){return this.colorToArray(this.positionColor?this.positionColor(e):0,t,n)}}var Kt;(function(i){i[i.PROTEIN=1]="PROTEIN",i[i.NUCLEIC=2]="NUCLEIC",i[i.RNA=3]="RNA",i[i.DNA=4]="DNA",i[i.POLYMER=5]="POLYMER",i[i.WATER=6]="WATER",i[i.HELIX=7]="HELIX",i[i.SHEET=8]="SHEET",i[i.TURN=9]="TURN",i[i.BACKBONE=10]="BACKBONE",i[i.SIDECHAIN=11]="SIDECHAIN",i[i.ALL=12]="ALL",i[i.HETERO=13]="HETERO",i[i.ION=14]="ION",i[i.SACCHARIDE=15]="SACCHARIDE",i[i.SUGAR=15]="SUGAR",i[i.BONDED=16]="BONDED",i[i.RING=17]="RING",i[i.AROMATICRING=18]="AROMATICRING",i[i.METAL=19]="METAL",i[i.POLARH=20]="POLARH",i[i.NONE=21]="NONE"})(Kt||(Kt={}));const wU=["*","","ALL"],Qle=["NONE"],g3=[Kt.BACKBONE,Kt.SIDECHAIN,Kt.BONDED,Kt.RING,Kt.AROMATICRING,Kt.METAL,Kt.POLARH],mV=[Kt.POLYMER,Kt.WATER],Jle=["ALA","GLY","SER"],ece=["CYS","SER","THR"],tce=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],nce=["PHE","TRP","TYR","HIS"],ice=["ASN","GLN"],rce=["ASP","GLU"],sce=["ARG","HIS","LYS"],oce=["ARG","ASP","GLU","HIS","LYS"],ace=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],lce=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],cce=["HIS","PHE","PRO","TRP","TYR"],uce=["ALA","GLY","ILE","LEU","VAL"];function hce(i,e){if(e.atomname===void 0&&e.element===void 0&&e.altloc===void 0&&e.atomindex===void 0&&e.keyword===void 0&&e.inscode===void 0&&e.resname===void 0&&e.sstruc===void 0&&e.resno===void 0&&e.chainname===void 0&&e.model===void 0)return-1;if(e.keyword!==void 0&&(e.keyword===Kt.BACKBONE&&!i.isBackbone()||e.keyword===Kt.SIDECHAIN&&!i.isSidechain()||e.keyword===Kt.BONDED&&!i.isBonded()||e.keyword===Kt.RING&&!i.isRing()||e.keyword===Kt.AROMATICRING&&!i.isAromatic()||e.keyword===Kt.HETERO&&!i.isHetero()||e.keyword===Kt.PROTEIN&&!i.isProtein()||e.keyword===Kt.NUCLEIC&&!i.isNucleic()||e.keyword===Kt.RNA&&!i.isRna()||e.keyword===Kt.DNA&&!i.isDna()||e.keyword===Kt.POLYMER&&!i.isPolymer()||e.keyword===Kt.WATER&&!i.isWater()||e.keyword===Kt.HELIX&&!i.isHelix()||e.keyword===Kt.SHEET&&!i.isSheet()||e.keyword===Kt.TURN&&!i.isTurn()||e.keyword===Kt.ION&&!i.isIon()||e.keyword===Kt.SACCHARIDE&&!i.isSaccharide()||e.keyword===Kt.METAL&&!i.isMetal()||e.keyword===Kt.POLARH&&!i.isPolarHydrogen())||e.atomname!==void 0&&e.atomname!==i.atomname||e.element!==void 0&&e.element!==i.element||e.altloc!==void 0&&e.altloc!==i.altloc||e.atomindex!==void 0&&Hh(e.atomindex,i.index)<0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(i.resname))return!1}else if(e.resname!==i.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==i.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>i.resno||e.resno[1]<i.resno)return!1}else if(e.resno!==i.resno)return!1}return(e.inscode===void 0||e.inscode===i.inscode)&&(e.chainname===void 0||e.chainname===i.chainname)&&(e.model===void 0||e.model===i.modelIndex)}function dce(i,e){if(e.resname===void 0&&e.resno===void 0&&e.inscode===void 0&&e.sstruc===void 0&&e.model===void 0&&e.chainname===void 0&&e.atomindex===void 0&&(e.keyword===void 0||g3.includes(e.keyword)))return-1;if(e.keyword!==void 0&&(e.keyword===Kt.HETERO&&!i.isHetero()||e.keyword===Kt.PROTEIN&&!i.isProtein()||e.keyword===Kt.NUCLEIC&&!i.isNucleic()||e.keyword===Kt.RNA&&!i.isRna()||e.keyword===Kt.DNA&&!i.isDna()||e.keyword===Kt.POLYMER&&!i.isPolymer()||e.keyword===Kt.WATER&&!i.isWater()||e.keyword===Kt.HELIX&&!i.isHelix()||e.keyword===Kt.SHEET&&!i.isSheet()||e.keyword===Kt.TURN&&!i.isTurn()||e.keyword===Kt.ION&&!i.isIon()||e.keyword===Kt.SACCHARIDE&&!i.isSaccharide())||e.atomindex!==void 0&&f3(e.atomindex,i.atomOffset,i.atomEnd)===0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(i.resname))return!1}else if(e.resname!==i.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==i.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>i.resno||e.resno[1]<i.resno)return!1}else if(e.resno!==i.resno)return!1}return(e.inscode===void 0||e.inscode===i.inscode)&&(e.chainname===void 0||e.chainname===i.chainname)&&(e.model===void 0||e.model===i.modelIndex)}function fce(i,e){return e.chainname!==void 0||e.model!==void 0||e.atomindex!==void 0||e.keyword!==void 0&&mV.includes(e.keyword)&&i.entity?e.keyword!==void 0&&(e.keyword===Kt.POLYMER&&!i.entity.isPolymer()||e.keyword===Kt.WATER&&!i.entity.isWater())?!1:(e.atomindex===void 0||f3(e.atomindex,i.atomOffset,i.atomEnd)!==0)&&(e.chainname===void 0||e.chainname===i.chainname)&&(e.model===void 0||e.model===i.modelIndex):-1}function pce(i,e){return e.model===void 0&&e.atomindex===void 0?-1:(e.atomindex===void 0||f3(e.atomindex,i.atomOffset,i.atomEnd)!==0)&&(e.model===void 0||e.model===i.index)}function q1(i,e){if(i===null||i.error||!i.rules||i.rules.length===0)return!1;const t=i.rules.length,n=!i.negate,r=!!i.negate,s=[];for(let o=0;o<t;++o){const a=i.rules[o];a.hasOwnProperty("operator")&&(s[o]=q1(a,e))}return function(o){const a=i.operator==="AND";let l=!1;for(let c=0;c<t;++c){const u=i.rules[c];let h;if(u.hasOwnProperty("operator")){const d=s[c];if(h=d!==!1?d(o):-1,h===-1){l=!0;continue}if(h===!0){if(a)continue;return n}if(a)return r}else{if(u.keyword===Kt.ALL){if(a)continue;return n}if(u.keyword===Kt.NONE){if(a)continue;return r}if(h=e(o,u),h!==-1){if(h===!0){if(a)continue;return n}if(a)return r}else l=!0}}return l?-1:a?n:r}}function Y1(i,e){if(i.error||!i.rules||i.rules.length===0)return i;const t=i.rules.length,n={operator:i.operator,rules:[]};i.hasOwnProperty("negate")&&(n.negate=i.negate);for(let r=0;r<t;++r){const s=i.rules[r];if(s.hasOwnProperty("operator")){const o=Y1(s,e);o!==null&&n.rules.push(o)}else e(s)||n.rules.push(s)}return n.rules.length>0?i:null}function MU(i,e=!1){let t=i;return e&&(t=Y1(i,function(n){return n.keyword!==void 0&&!g3.includes(n.keyword)||n.model!==void 0||n.chainname!==void 0||n.resname!==void 0||n.resno!==void 0||n.sstruc!==void 0})),q1(t,hce)}function AU(i,e=!1){let t=i;return e&&(t=Y1(i,function(n){return!(n.keyword===void 0||!g3.includes(n.keyword))||n.model!==void 0||n.chainname!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0})),q1(t,dce)}function EU(i,e=!1){let t=i;return e&&(t=Y1(i,function(n){return n.keyword!==void 0&&!mV.includes(n.keyword)||n.resname!==void 0||n.resno!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0||n.sstruc!==void 0||n.inscode!==void 0})),q1(t,fce)}function TU(i,e=!1){let t=i;return e&&(t=Y1(i,function(n){return n.keyword!==void 0||n.chainname!==void 0||n.resname!==void 0||n.resno!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0||n.sstruc!==void 0||n.inscode!==void 0})),q1(t,pce)}class ii{constructor(e){this.signals={stringChanged:new rn.Signal},this.setString(e)}get type(){return"selection"}setString(e,t){if(e===void 0&&(e=this.string||""),e===this.string)return;try{this.selection=function(r){let s={operator:void 0,rules:[]};if(!r)return s;let o,a,l=s;const c=[];(r=r.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)==="("&&r.substr(-1)===")"&&(r=r.slice(1,-1).trim());const u=r.split(/\s+/),h=_=>{o={operator:_,rules:[]},l===void 0?(l=o,s=o):(l.rules.push(o),c.push(l),l=o)},d=function(_){a=l,l=c.pop(),l===void 0&&(h(_),f(a))},f=function(_){l.rules.push(_)};let p=!1;for(let _=0;_<u.length;++_){const v=u[_],g=v.toUpperCase();if(v==="("){p=!1,h();continue}if(v===")"){d(),l.negate&&d();continue}if(p>0)if(g==="NOT")p=1;else if(p===1)p=2;else{if(p!==2)throw new Error("something went wrong with 'not'");p=!1,d()}if(g==="AND"){if(l.operator==="OR"){const T=l.rules.pop();h("AND"),f(T)}else l.operator="AND";continue}if(g==="OR"){l.operator==="AND"?d("OR"):l.operator="OR";continue}if(v.toUpperCase()==="NOT"){p=1,h(),l.negate=!0;continue}if(+g!=+g){const T=Kt[g];if(T!==void 0){f({keyword:T});continue}}if(g==="HYDROGEN"){f({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if(g==="SMALL"){f({resname:Jle});continue}if(g==="NUCLEOPHILIC"){f({resname:ece});continue}if(g==="HYDROPHOBIC"){f({resname:tce});continue}if(g==="AROMATIC"){f({resname:nce});continue}if(g==="AMIDE"){f({resname:ice});continue}if(g==="ACIDIC"){f({resname:rce});continue}if(g==="BASIC"){f({resname:sce});continue}if(g==="CHARGED"){f({resname:oce});continue}if(g==="POLAR"){f({resname:ace});continue}if(g==="NONPOLAR"){f({resname:lce});continue}if(g==="CYCLIC"){f({resname:cce});continue}if(g==="ALIPHATIC"){f({resname:uce});continue}if(g==="SIDECHAINATTACHED"){f({operator:"OR",rules:[{keyword:Kt.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:Kt.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:Kt.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});continue}if(g==="APOLARH"){f({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:Kt.POLARH}]}]});continue}if(g==="LIGAND"){f({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:Kt.HETERO},{negate:!0,operator:void 0,rules:[{keyword:Kt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:Kt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:Kt.WATER},{keyword:Kt.ION}]}]}]});continue}if(wU.indexOf(g)!==-1){f({keyword:Kt.ALL});continue}if(v.charAt(0)==="@"){const T=v.substr(1).split(",").map(E=>parseInt(E));T.sort(function(E,C){return E-C}),f({atomindex:T});continue}if(v.charAt(0)==="#"){console.error("# for element selection deprecated, use _"),f({element:g.substr(1)});continue}if(v.charAt(0)==="_"){f({element:g.substr(1)});continue}if(v[0]==="["&&v[v.length-1]==="]"){const T=g.substr(1,v.length-2).split(","),E=T.length>1?T:T[0];f({resname:E});continue}if(v.length>=1&&v.length<=4&&v[0]!=="^"&&v[0]!==":"&&v[0]!=="."&&v[0]!=="%"&&v[0]!=="/"&&isNaN(parseInt(v))){f({resname:g});continue}const b={operator:"AND",rules:[]},m=v.split("/");if(m.length>1&&m[1]){if(isNaN(parseInt(m[1])))throw new Error("model must be an integer");b.rules.push({model:parseInt(m[1])})}const y=m[0].split("%");y.length>1&&b.rules.push({altloc:y[1]});const A=y[0].split(".");if(A.length>1&&A[1]){if(A[1].length>4)throw new Error("atomname must be one to four characters");b.rules.push({atomname:A[1].substring(0,4).toUpperCase()})}const w=A[0].split(":");w.length>1&&w[1]&&b.rules.push({chainname:w[1]});const M=w[0].split("^");if(M.length>1&&b.rules.push({inscode:M[1]}),M[0]){let T,E;M[0][0]==="-"&&(M[0]=M[0].substr(1),T=!0),M[0].includes("--")&&(M[0]=M[0].replace("--","-"),E=!0);let C=M[0].split("-");if(C.length===1){let N=parseInt(C[0]);if(isNaN(N))throw new Error("resi must be an integer");T&&(N*=-1),b.rules.push({resno:N})}else{if(C.length!==2)throw new Error("resi range must contain one '-'");{const N=C.map(P=>parseInt(P));T&&(N[0]*=-1),E&&(N[1]*=-1),b.rules.push({resno:[N[0],N[1]]})}}}if(b.rules.length===1)f(b.rules[0]);else{if(!(b.rules.length>1))throw new Error("empty selection chunk");f(b)}}return s.operator===void 0&&s.rules.length===1&&s.rules[0].hasOwnProperty("operator")&&(s=s.rules[0]),s}(e)}catch(r){this.selection={error:r.message}}const n=this.selection;this.string=e,this.test=MU(n),this.residueTest=AU(n),this.chainTest=EU(n),this.modelTest=TU(n),this.atomOnlyTest=MU(n,!0),this.residueOnlyTest=AU(n,!0),this.chainOnlyTest=EU(n,!0),this.modelOnlyTest=TU(n,!0),t||this.signals.stringChanged.dispatch(this.string)}isAllSelection(){return wU.includes(this.string.toUpperCase())}isNoneSelection(){return Qle.includes(this.string.toUpperCase())}}class mce extends Xn{constructor(e){super(e),this.colormakerList=[],this.selectionList=[],(e.dataList||[]).forEach(t=>{const[n,r,s={}]=t;_n.hasScheme(n)?Object.assign(s,{scheme:n,structure:this.parameters.structure}):Object.assign(s,{scheme:"uniform",value:new $t(n).getHex()}),this.colormakerList.push(_n.getScheme(s)),this.selectionList.push(new ii(r))})}atomColor(e){for(let t=0,n=this.selectionList.length;t<n;++t){const r=this.selectionList[t].test;if(r&&r(e))return this.colormakerList[t].atomColor(e)}return 16777215}}const gce={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},vce={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"};function gV(i){const e=i;return i.forEach(function(t){t.__deps&&Array.prototype.push.apply(e,gV(t.__deps))}),e}function _ce(i){return p3(gV(i)).map(function(e){return e.toString()}).join(`


`)}function yce(i){const e=i.data.__name,t=i.data.__postId;if(e===void 0)console.error("message __name undefined");else if(self.func===void 0)console.error("worker func undefined",e);else{const n=function(r,s){r=r||{},t!==void 0&&(r.__postId=t);try{self.postMessage(r,s)}catch(o){console.error("self.postMessage:",o),self.postMessage(r)}};self.func(i,n)}}function xce(i,e){let t=`'use strict';

`+_ce(e);return t+=`


self.func = `+i.toString()+";",t+=`


self.onmessage = `+yce.toString()+";",new Blob([t],{type:"application/javascript"})}const vV=qle();let _V=!1;try{const i=Object.defineProperty({},"passive",{get:function(){_V=!0}});window.addEventListener("test",e=>{},i)}catch{}const yV=typeof window<"u"&&window.orientation!==void 0;let sl=!1;function CU(i){sl=i}let _l=!1;function PU(i){_l=i}const tt={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)};let Ug={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1},pt=!!(sA=Xle("debug"))&&(typeof sA!="string"||/^1|true|t|yes|y$/i.test(sA));var sA;const bce=["ngl","js"],C0=new class{constructor(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}}add(i,e,t){this._funcDict[i]=e,this._depsDict[i]=t}get(i){return this._blobDict[i]||(this._blobDict[i]=xce(this._funcDict[i],this._depsDict[i])),this._blobDict[i]}},_n=new class{constructor(){this.schemes={},this.userSchemes={}}getScheme(i){const e=((i||{}).scheme||"").toLowerCase();let t;return t=e in this.schemes?this.schemes[e]:e in this.userSchemes?this.userSchemes[e]:Xn,new t(i)}getSchemes(){const i={};return Object.keys(this.schemes).forEach(function(e){i[e]=e}),Object.keys(this.userSchemes).forEach(function(e){i[e]=e.split("|")[1]}),i}getScales(){return gce}getModes(){return vce}add(i,e){i=i.toLowerCase(),this.schemes[i]=e}addScheme(i,e){return function(t){return t instanceof Xn}(i)||(i=this._createScheme(i)),this._addUserScheme(i,e)}_addUserScheme(i,e){e=e||"";const t=`${m3()}|${e}`.toLowerCase();return this.userSchemes[t]=i,t}removeScheme(i){i=i.toLowerCase(),delete this.userSchemes[i]}_createScheme(i){return class extends Xn{constructor(e){super(e),i.call(this,e)}}}addSelectionScheme(i,e){return this._addUserScheme(class extends mce{constructor(t){super(Object.assign({dataList:i},t))}},e)}hasScheme(i){return(i=i.toLowerCase())in this.schemes||i in this.userSchemes}},Lu=new Qu("datasource"),ri=new Qu("representatation"),Qt=new class extends Qu{constructor(){super("parser")}__hasObjName(i,e){const t=this.get(i);return t&&t.prototype.__objName===e}isTrajectory(i){return this.__hasObjName(i,"frames")}isStructure(i){return this.__hasObjName(i,"structure")}isVolume(i){return this.__hasObjName(i,"volume")}isSurface(i){return this.__hasObjName(i,"surface")}isBinary(i){const e=this.get(i);return e&&e.prototype.isBinary}isXml(i){const e=this.get(i);return e&&e.prototype.isXml}isJson(i){const e=this.get(i);return e&&e.prototype.isJson}getTrajectoryExtensions(){return this.names.filter(i=>this.isTrajectory(i))}getStructureExtensions(){return this.names.filter(i=>this.isStructure(i))}getVolumeExtensions(){return this.names.filter(i=>this.isVolume(i))}getSurfaceExtensions(){return this.names.filter(i=>this.isSurface(i))}},Rn=new Qu("shader"),v3=new Qu("decompressor"),vm=new Qu("component"),Fo=new Qu("buffer"),qo=new Qu("picker");let oA;class xV{constructor(e,t={}){this.chunkSize=10485760,this.newline=`
`,this.__pointer=0,this.__partialLine="",this.compressed=he(t.compressed,!1),this.binary=he(t.binary,!1),this.json=he(t.json,!1),this.xml=he(t.xml,!1),this.src=e}isBinary(){return this.binary||this.compressed}read(){return this._read().then(e=>{const t=this.compressed?v3.get(this.compressed):void 0;return this.compressed&&t?this.data=t(e):((this.binary||this.compressed)&&e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.data=e),this.data})}_chunk(e,t){return t=Math.min(this.data.length,t),e===0&&this.data.length===t?this.data:this.isBinary()?this.data.subarray(e,t):this.data.substring(e,t)}chunk(e){const t=e+this.chunkSize;return this._chunk(e,t)}peekLines(e){const t=this.data,n=t.length,r=this.isBinary()?this.newline.charCodeAt(0):this.newline;let s,o=0;for(s=0;s<n&&(t[s]===r&&++o,o!==e);++s);const a=this._chunk(0,s+1);return this.chunkToLines(a,"",s>n).lines}chunkCount(){return Math.floor(this.data.length/this.chunkSize)+1}asText(){return this.isBinary()?v1(this.data):this.data}chunkToLines(e,t,n){const r=this.newline;if(!this.isBinary()&&e.length===this.data.length)return{lines:e.split(r),partialLine:""};let s=[];const o=this.isBinary()?v1(e):e,a=o.lastIndexOf(r);if(a===-1)t+=o;else{const l=t+o.substr(0,a);s=s.concat(l.split(r)),t=a===o.length-r.length?"":o.substr(a+r.length)}return n&&t!==""&&s.push(t),{lines:s,partialLine:t}}nextChunk(){const e=this.__pointer;if(!(e>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(e)}nextChunkOfLines(){const e=this.nextChunk();if(e===void 0)return;const t=this.__pointer>this.data.length,n=this.chunkToLines(e,this.__partialLine,t);return this.__partialLine=n.partialLine,n.lines}eachChunk(e){const t=this.chunkSize,n=this.data.length,r=this.chunkCount();for(let s=0;s<n;s+=t)e(this.chunk(s),Math.round(s/t),r)}eachChunkOfLines(e){this.eachChunk((t,n,r)=>{const s=n===r+1,o=this.chunkToLines(t,this.__partialLine,s);this.__partialLine=o.partialLine,e(o.lines,n,r)})}dispose(){delete this.src}}class Sce extends xV{_read(){return new Promise((e,t)=>{const n=this.src,r=new FileReader;r.onload=s=>{s.target&&e(s.target.result)},r.onerror=s=>t(s),this.binary||this.compressed?r.readAsArrayBuffer(n):r.readAsText(n)})}}class wce extends xV{_read(){return new Promise((e,t)=>{const n=this.src,r=new XMLHttpRequest;r.open("GET",n,!0),r.addEventListener("load",()=>{if(r.status===200||r.status===304||r.status===0)try{e(r.response)}catch(s){t(s)}else t(r.statusText)},!1),r.addEventListener("error",s=>t("network error"),!1),this.isBinary()?r.responseType="arraybuffer":this.json?r.responseType="json":this.xml?r.responseType="document":r.responseType="text",r.send()})}}class bV{constructor(e,t={}){this.parameters=Io(t,{ext:"",compressed:!1,binary:Qt.isBinary(t.ext||""),name:"",dir:"",path:"",protocol:""});const n={compressed:this.parameters.compressed,binary:this.parameters.binary,json:Qt.isJson(this.parameters.ext),xml:Qt.isXml(this.parameters.ext)};typeof File<"u"&&e instanceof File||typeof Blob<"u"&&e instanceof Blob?this.streamer=new Sce(e,n):this.streamer=new wce(e,n)}}class Mce extends bV{constructor(e,t={}){super(e,t),this.parserParams={voxelSize:t.voxelSize,firstModelOnly:t.firstModelOnly,asTrajectory:t.asTrajectory,cAlphaOnly:t.cAlphaOnly,delimiter:t.delimiter,comment:t.comment,columnNames:t.columnNames,inferBonds:t.inferBonds,name:this.parameters.name,path:this.parameters.path}}load(){return new(Qt.get(this.parameters.ext))(this.streamer,this.parserParams).parse()}}class Ace{constructor(e,t,n){this.name=t,this.path=n,this.signals={elementAdded:new rn.Signal,elementRemoved:new rn.Signal,nameChanged:new rn.Signal},this.type="Script",this.dir=n.substring(0,n.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",e)}catch(r){tt.error("Script compilation failed",r),this.fn=function(){}}}run(e){return new Promise((t,n)=>{try{this.fn.apply(null,[e,this.name,this.path,this.dir]),t()}catch(r){tt.error("Script.fn",r),n(r)}})}}class Ece extends bV{load(){return this.streamer.read().then(()=>new Ace(this.streamer.asText(),this.parameters.name,this.parameters.path))}}function io(i){const e=v3.names;let t,n,r="";t=i instanceof File?i.name:i instanceof Blob?"":i;const s=t.lastIndexOf("?"),o=s!==-1?t.substring(s):"";t=t.substring(0,s===-1?t.length:s);const a=t.replace(/^.*[\\/]/,"");let l=a.substring(0,a.lastIndexOf("."));const c=a.split(".");let u=c.length>1?(c.pop()||"").toLowerCase():"";const h=t.match(/^(.+):\/\/(.+)$/);h&&(r=h[1].toLowerCase(),t=h[2]||"");const d=t.substring(0,t.lastIndexOf("/")+1);if(e.includes(u)){n=u;const f=t.length-u.length-1;u=(t.substr(0,f).split(".").pop()||"").toLowerCase();const p=l.length-u.length-1;l=l.substr(0,p)}else n=!1;return{path:t,name:a,ext:u,base:l,dir:d,compressed:n,protocol:r,query:o,src:i}}function Tce(i){let e=io(i);const t=Lu.get(e.protocol);return t&&(e=io(t.getUrl(e.src)),!e.ext&&t.getExt&&(e.ext=t.getExt(i))),e}function RU(i,e={}){const t=Object.assign(Tce(i),e);let n;return Qt.names.includes(t.ext)?n=new Mce(t.src,t):bce.includes(t.ext)&&(n=new Ece(t.src,t)),n?n.load():Promise.reject(new Error(`autoLoad: ext '${t.ext}' unknown`))}const aA=[];class Cce{constructor(e,t={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;e===void 0&&(e=8192),typeof e=="number"?e=new ArrayBuffer(e):n=!0;const r=t.offset?t.offset>>>0:0;let s=e.byteLength-r,o=r;e instanceof ArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+r),e=e.buffer),this._lastWrittenByte=n?s:0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=o,this._data=new DataView(this.buffer,o,s)}available(e){return e===void 0&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return e===void 0&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){aA.length=e;for(var t=0;t<e;t++)aA[t]=this.readChar();return aA.join("")}writeBoolean(e=!1){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}class SV{constructor(){this.count=0,this.signals={countChanged:new rn.Signal}}clear(){this.change(-this.count)}change(e){this.count+=e,this.signals.countChanged.dispatch(e,this.count),this.count<0&&tt.warn("Counter.count below zero",this.count)}increment(){this.change(1)}decrement(){this.change(-1)}listen(e){this.change(e.count),e.signals.countChanged.add(this.change,this)}unlisten(e){const t=e.signals.countChanged;t.has(this.change,this)&&t.remove(this.change,this)}onZeroOnce(e,t){if(this.count===0)e.call(t);else{const n=()=>{this.count===0&&(this.signals.countChanged.remove(n,this),e.call(t))};this.signals.countChanged.add(n,this)}}dispose(){this.clear(),this.signals.countChanged.dispose()}}Rn.add("shader/BasicLine.vert",`void main(){
#include begin_vertex
#include project_vertex
}`),Rn.add("shader/BasicLine.frag",`uniform vec3 uColor;
#include common
#include fog_pars_fragment
void main(){
gl_FragColor = vec4( uColor, 1.0 );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`),Rn.add("shader/Quad.vert",`varying vec2 vUv;
void main() {
vUv = uv;
gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`),Rn.add("shader/Quad.frag",`varying vec2 vUv;
uniform sampler2D tForeground;
uniform float scale;
void main() {
vec4 foreground = texture2D( tForeground, vUv );
gl_FragColor = foreground * scale;
}`);class Pce{constructor(){this.signals={updated:new rn.Signal},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()}update(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()}begin(){this.startTime=window.performance.now(),this.lastFrames=this.frames}end(){const e=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=e-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,e>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=e,this.frames=0),e}}Rn.add("shader/chunk/fog_fragment.glsl",`#ifdef USE_FOG
float depth = length( vViewPosition );
#ifdef FOG_EXP2
float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
#else
float fogFactor = smoothstep( fogNear, fogFar, depth );
#endif
gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`),Rn.add("shader/chunk/interior_fragment.glsl",`if( gl_FrontFacing == false ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}`),Rn.add("shader/chunk/matrix_scale.glsl",`float matrixScale( in mat4 m ){
vec4 r = m[ 0 ];
return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );
}`),Rn.add("shader/chunk/nearclip_vertex.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear - 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),Rn.add("shader/chunk/nearclip_fragment.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear )
discard;
#endif`),Rn.add("shader/chunk/opaque_back_fragment.glsl",`#ifdef OPAQUE_BACK
#ifdef FLIP_SIDED
if( gl_FrontFacing == true ){
gl_FragColor.a = 1.0;
}
#else
if( gl_FrontFacing == false ){
gl_FragColor.a = 1.0;
}
#endif
#endif`),Rn.add("shader/chunk/radiusclip_vertex.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),Rn.add("shader/chunk/radiusclip_fragment.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius )
discard;
#endif`),Rn.add("shader/chunk/unpack_color.glsl",`vec3 unpackColor(float f) {
vec3 color;
color.r = floor(f / 256.0 / 256.0);
color.g = floor((f - color.r * 256.0 * 256.0) / 256.0);
color.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);
return color / 255.0;
}`);const Rce=/^(?!\/\/)\s*#include\s+(\S+)/gim,lA={};function i0(i,e={}){let t=i+"|";for(const n in e)t+=n+":"+e[n];if(!lA[t]){const n=function(s){if(s===void 0)return"";const o=[];for(const a in s){const l=s[a];l&&o.push(`#define ${a} ${l}`)}return o.join(`
`)+`
`}(e);let r=Rn.get(`shader/${i}`);if(!r)throw new Error(`empty shader, '${i}'`);r=r.replace(Rce,function(s,o){const a=`shader/chunk/${o}.glsl`,l=Rn.get(a)||fn[o];if(!l)throw new Error(`empty chunk, '${o}'`);return l}),lA[t]=n+r}return lA[t]}if(typeof WebGLRenderingContext<"u"){const i=WebGLRenderingContext.prototype,e=i.getShaderParameter;i.getShaderParameter=function(){return!pt||e.apply(this,arguments)};const t=i.getShaderInfoLog;i.getShaderInfoLog=function(){return pt?t.apply(this,arguments):""};const n=i.getProgramParameter;i.getProgramParameter=function(s,o){return!pt&&o===i.LINK_STATUS||n.apply(this,arguments)};const r=i.getProgramInfoLog;i.getProgramInfoLog=function(){return pt?r.apply(this,arguments):""}}const wV=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];wV.forEach(i=>{i.forEach(e=>{e[0]*=.0625,e[1]*=.0625})});class Ice{constructor(e,t,n,r){this.canvas=document.createElement("canvas"),this._viewer=n,this._factor=he(r.factor,2),this._antialias=he(r.antialias,!1),this._onProgress=r.onProgress,this._onFinish=r.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=n.sampleLevel,this._viewer.setSampling(-1)}_renderTile(e){const t=this._viewer,n=this._width,r=this._height,s=this._factor,o=e%s*n,a=Math.floor(e/s)*r;if(t.camera.setViewOffset(n*s,r*s,o,a,n,r),t.render(),this._antialias){const l=Math.round((o+n)/2)-Math.round(o/2),c=Math.round((a+r)/2)-Math.round(a/2);this._ctx.drawImage(t.renderer.domElement,Math.round(o/2),Math.round(a/2),l,c)}else this._ctx.drawImage(t.renderer.domElement,Math.floor(o),Math.floor(a),Math.ceil(n),Math.ceil(r));typeof this._onProgress=="function"&&this._onProgress(e+1,this._n,!1)}_finalize(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,typeof this._onFinish=="function"&&this._onFinish(this._n+1,this._n,!1)}render(){for(let e=0;e<=this._n;++e)e===this._n?this._finalize():this._renderTile(e)}renderAsync(){let e=0;const t=this._n,n=()=>{e===t?this._finalize():this._renderTile(e),e+=1};for(let r=0;r<=t;++r)setTimeout(n,0)}}const cA=2*Math.PI,MV=180/Math.PI;function uA(i,e,t=1,n=0,r){const s=r?r.length:i.length/t;let o=0,a=0;if(r)for(let l=0;l<s;++l){const c=(i[r[l]*t+n]+e)%e/e*cA-Math.PI;o+=Math.cos(c),a+=Math.sin(c)}else for(let l=n;l<s;l+=t){const c=(i[l]+e)%e/e*cA-Math.PI;o+=Math.cos(c),a+=Math.sin(c)}return o/=s,a/=s,(Math.atan2(a,o)+Math.PI)/cA*e}function yl(i,e,t,n=0){const r=i.length,s=t||new Float32Array(r);for(let o=0;o<r;o+=3)s[n+o+0]=(i[o+0]+e[o+0])/2,s[n+o+1]=(i[o+1]+e[o+1])/2,s[n+o+2]=(i[o+2]+e[o+2])/2;return s}function XS(i,e){const t=i.length,n=new Float32Array(t);for(let r=0;r<t;r+=3)n[r+0]=e[r+0]-i[r+0],n[r+1]=e[r+1]-i[r+1],n[r+2]=e[r+2]-i[r+2];return n}function Lo(i,e,t){const n=t||new Float32Array(i);for(let r=0;r<i;++r)n[r]=e;return n}function Hn(i,e,t,n,r){const s=r||new Float32Array(3*i);for(let o=0;o<i;++o){const a=3*o;s[a+0]=e,s[a+1]=t,s[a+2]=n}return s}function km(i){const e=new Float32Array(i);for(let t=0;t<i;++t)e[t]=t;return e}function PC(i,e,t=0,n){const r=n||new Float32Array(i*e);for(let s=0;s<i;++s){const o=t+s*e;for(let a=0;a<e;++a)r[o+a]=s}return r}function hA(i,e){const t=i.length,n=new Float32Array(t*e);for(let r=0;r<t;++r){const s=r*e,o=i[r];for(let a=0;a<e;++a)n[s+a]=o}return n}function ar(i,e,t,n,r){for(let s=0;s<r;++s)e[n+s]=i[t+s]}function IU(i,e,t,n){ar(i,i,e,t,n)}function kx(i){let e=-1/0;for(let t=0,n=i.length;t<n;++t)i[t]>e&&(e=i[t]);return e}function Ux(i){let e=1/0;for(let t=0,n=i.length;t<n;++t)i[t]<e&&(e=i[t]);return e}function _3(i,e=1,t=0){const n=i.length;let r=0;for(let s=t;s<n;s+=e)r+=i[s];return r}function Ox(i,e=1,t=0){return _3(i,e,t)/(i.length/e)}const Lce={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0};function Dce(i,e={}){const{trim:t,factor:n,antialias:r,transparent:s}=Io(e,Lce),o=i.renderer,a=i.camera,l=o.getClearAlpha(),c=o.getClearColor(new $t);function u(f=!1){let p=n;r&&(p*=2),f&&(p=1/p),i.scene.traverse(function(_){const v=_.material;v&&v.linewidth&&(v.linewidth*=p),v&&v.uniforms&&v.uniforms.size&&v.uniforms.size.__seen===void 0&&(v.uniforms.size.value*=p,v.uniforms.size.__seen=!0),v&&v.uniforms&&v.uniforms.linewidth&&v.uniforms.linewidth.__seen===void 0&&(v.uniforms.linewidth.value*=p,v.uniforms.linewidth.__seen=!0)}),i.scene.traverse(function(_){const v=_.material;v&&v.uniforms&&v.uniforms.size&&delete v.uniforms.size.__seen,v&&v.uniforms&&v.uniforms.linewidth&&delete v.uniforms.linewidth.__seen})}function h(f){if(t){const p=c;return function(_,v,g,b,m){const y=_.height,A=_.width,w=_.getContext("2d").getImageData(0,0,A,y).data;let M,T,E,C;for(E=!1,T=0;T<y;T++){for(M=0;M<A;M++)if(C=4*(T*A+M),w[C]!==v||w[C+1]!==g||w[C+2]!==b||w[C+3]!==m){E=!0;break}if(E)break}const N=T;for(E=!1,M=0;M<A;M++){for(T=0;T<y;T++)if(C=4*(T*A+M),w[C]!==v||w[C+1]!==g||w[C+2]!==b||w[C+3]!==m){E=!0;break}if(E)break}const P=M;for(E=!1,T=y-1;T>=0;T--){for(M=A-1;M>=0;M--)if(C=4*(T*A+M),w[C]!==v||w[C+1]!==g||w[C+2]!==b||w[C+3]!==m){E=!0;break}if(E)break}const L=T;for(E=!1,M=A-1;M>=0;M--){for(T=y-1;T>=0;T--)if(C=4*(T*A+M),w[C]!==v||w[C+1]!==g||w[C+2]!==b||w[C+3]!==m){E=!0;break}if(E)break}const R=M,F=document.createElement("canvas");return F.width=R-P,F.height=L-N,F.getContext("2d").drawImage(_,P,N,F.width,F.height,0,0,F.width,F.height),F}(f,s?0:255*p.r,s?0:255*p.g,s?0:255*p.b,s?0:255)}return f}function d(f,p,_){typeof e.onProgress=="function"&&e.onProgress(f,p,_)}return new Promise(function(f,p){const _=new Ice(o,a,i,{factor:n,antialias:r,onProgress:d,onFinish:function(v,g){h(_.canvas).toBlob(function(b){o.setClearAlpha(l),u(!0),i.requestRender(),d(g,g,!0),b?f(b):p("error creating image")},"image/png")}});o.setClearAlpha(s?0:1),u(),_.renderAsync()})}const dA=new me,LU=new Ct,DU=new Ct,NU=new on,Ib=new Ct,Lb=new Ct;function fA(i,e){Ib.copy(e.projectionMatrix).invert(),Lb.copy(e.projectionMatrix).transpose(),i.traverse(function(t){const n=t.material;if(!n)return;const r=n.uniforms;r&&(r.projectionMatrixInverse&&r.projectionMatrixInverse.value.copy(Ib),r.projectionMatrixTranspose&&r.projectionMatrixTranspose.value.copy(Lb))})}function FU(i,e,t){const n=i.createShader(t);return n?(i.shaderSource(n,e),i.compileShader(n),i.getShaderParameter(n,i.COMPILE_STATUS)?n:(console.log(`error compiling shader ${n}: ${i.getShaderInfoLog(n)}`),i.deleteShader(n),null)):void console.log(`error creating WebGL shader ${t}`)}function pA(i,e){const t=i.getExtension(e);return t||console.log(`extension '${e}' not available`),t}const Nce=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function Ly(i){const e=document.createElement("canvas");e.width=16,e.height=16,e.style.width="16px",e.style.height="16px";const t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return console.log(`error creating webgl context for ${i}`),!1;if(!(t instanceof WebGLRenderingContext))return console.log("Got unexpected type for WebGL rendering context"),!1;pA(t,"OES_texture_float"),pA(t,"OES_texture_half_float"),pA(t,"WEBGL_color_buffer_float");const n=FU(t,`
attribute vec4 a_position;

void main() {
  gl_Position = a_position;
}`,t.VERTEX_SHADER),r=FU(t,`
precision mediump float;
uniform vec4 u_color;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;
}`,t.FRAGMENT_SHADER);if(!n||!r)return!1;const s=function(p,_,v,g){const b=p.createProgram();return b?(_.forEach(m=>p.attachShader(b,m)),p.linkProgram(b),p.getProgramParameter(b,p.LINK_STATUS)?b:(console.log(`error linking program: ${p.getProgramInfoLog(b)}`),p.deleteProgram(b),null)):void console.log("error creating WebGL program")}(t,[n,r]);if(!s)return console.log("error creating WebGL program"),!1;t.useProgram(s);const o=t.getAttribLocation(s,"a_position"),a=t.getUniformLocation(s,"u_color");if(!a)return console.log("error getting 'u_color' uniform location"),!1;const l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,Nce,t.STATIC_DRAW),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0);const c=t.createTexture(),u=new Uint8Array([255,255,255,255]);t.bindTexture(t.TEXTURE_2D,c),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,u);const h=t.createTexture();t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,i,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const d=t.createFramebuffer();if(t.bindFramebuffer(t.FRAMEBUFFER,d),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,h,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)return console.log(`error creating framebuffer for ${i}`),!1;t.bindTexture(t.TEXTURE_2D,c),t.uniform4fv(a,[0,10,20,1]),t.drawArrays(t.TRIANGLES,0,6),t.bindTexture(t.TEXTURE_2D,h),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(1,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.uniform4fv(a,[0,.1,.05,1]),t.drawArrays(t.TRIANGLES,0,6);const f=new Uint8Array(4);if(t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,f),f[0]!==0||f[1]<248||f[2]<248||f[3]<254)return console.log(`not able to actually render to ${i} texture`),!1;if(i===t.FLOAT){t.bindFramebuffer(t.FRAMEBUFFER,d);const p=new Float32Array(4);t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,p);const _=t.getError();if(_)return console.log(`error reading pixels as float: '${function(v,g){switch(g){case v.NO_ERROR:return"no error";case v.INVALID_ENUM:return"invalid enum";case v.INVALID_VALUE:return"invalid value";case v.INVALID_OPERATION:return"invalid operation";case v.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case v.OUT_OF_MEMORY:return"out of memory";case v.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}(t,_)}'`),!1}return!0}const Fce=new Float32Array(100),kce=new Uint8Array(100),kU=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],Dy=new Ct;function Uce(i,e,t,n,r){const s=r.uniforms,o=[];if(s&&(s.objectId&&(s.objectId.value=sl?this.id:this.id/255,o.push("objectId")),(s.modelViewMatrixInverse||s.modelViewMatrixInverseTranspose||s.modelViewProjectionMatrix||s.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,this.matrixWorld),s.modelViewMatrixInverse&&(s.modelViewMatrixInverse.value.copy(this.modelViewMatrix).invert(),o.push("modelViewMatrixInverse")),s.modelViewMatrixInverseTranspose&&(s.modelViewMatrixInverse?s.modelViewMatrixInverseTranspose.value.copy(s.modelViewMatrixInverse.value).transpose():s.modelViewMatrixInverseTranspose.value.copy(this.modelViewMatrix).invert().transpose(),o.push("modelViewMatrixInverseTranspose")),s.modelViewProjectionMatrix&&(s.modelViewProjectionMatrix.value.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),o.push("modelViewProjectionMatrix")),s.modelViewProjectionMatrixInverse&&(s.modelViewProjectionMatrix?(Dy.copy(s.modelViewProjectionMatrix.value),s.modelViewProjectionMatrixInverse.value.copy(Dy.invert())):(Dy.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),s.modelViewProjectionMatrixInverse.value.copy(Dy.invert())),o.push("modelViewProjectionMatrixInverse")),o.length)){const a=i.properties.get(r);if(a.program){const l=i.getContext(),c=a.program;l.useProgram(c.program);const u=c.getUniforms();o.forEach(function(h){u.setValue(l,h,s[h].value)})}}}class Oce{constructor(e){if(this.boundingBox=new Li,this.boundingBoxSize=new me,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new me,this.signals={ticked:new rn.Signal,rendered:new rn.Signal},typeof e=="string"){const t=document.getElementById(e);this.container=t===null?document.createElement("div"):t}else e instanceof HTMLElement?this.container=e:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{const t=this.container.getBoundingClientRect();this.width=t.width||1,this.height=t.height||1,this.container.style.overflow="hidden"}this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),this._initRenderer()!==!1?(this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)):tt.error("Viewer: could not initialize renderer")}_initParams(){this.parameters={fogColor:new $t(0),fogNear:50,fogFar:100,backgroundColor:new $t(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new $t(14540253),lightIntensity:1.2,ambientColor:new $t(14540253),ambientIntensity:.3,sampleLevel:0,outputColorSpace:"srgb-linear"}}_initCamera(){const e=new me(0,0,0),{width:t,height:n}=this;this.perspectiveCamera=new Ys(this.parameters.cameraFov,t/n),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(e),this.orthographicCamera=new g1(t/-2,t/2,n/2,n/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(e),this.stereoCamera=new $le,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;const r=this.parameters.cameraType;if(r==="orthographic")this.camera=this.orthographicCamera;else{if(r!=="perspective"&&r!=="stereo")throw new Error(`Unknown cameraType '${r}'`);this.camera=this.perspectiveCamera}this.camera.updateProjectionMatrix()}_initStats(){this.stats=new Pce}_initScene(){this.scene||(this.scene=new uU,this.scene.name="scene"),this.rotationGroup=new Zn,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new Zn,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new Zn,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new Zn,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new Zn,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new Zn,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new l3(this.parameters.fogColor.getHex()),this.directionalLight=new Vle(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.directionalLight),this.ambientLight=new Hle(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)}_initRenderer(){const e=window.devicePixelRatio,{width:t,height:n}=this;try{this.renderer=new aV({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch{return this.wrapper.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',!1}this.renderer.setPixelRatio(e),this.renderer.setSize(t,n),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.outputColorSpace=this.parameters.outputColorSpace,this.renderer.useLegacyLights=!0;const r=this.renderer.getContext();this.renderer.capabilities.isWebGL2?(PU(!0),CU(this.renderer.extensions.get("EXT_color_buffer_float")),this.supportsHalfFloat=!0):(PU(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),CU(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&Ly(r.FLOAT)),this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&Ly(36193)),this.wrapper.appendChild(this.renderer.domElement);const s=t*e,o=n*e;pt&&console.log(JSON.stringify({Browser:vV,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":Ly(r.FLOAT),"testTextureSupport HalfFloat":Ly(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:sl},null,2)),this.pickingTarget=new vl(s,o,{minFilter:ei,magFilter:ei,stencilBuffer:!1,format:Zs,type:sl?ka:Ba}),this.pickingTarget.texture.generateMipmaps=!1,this.pickingTarget.texture.colorSpace=this.parameters.outputColorSpace,this.renderer.setRenderTarget(this.pickingTarget),this.renderer.clear(),this.renderer.setRenderTarget(null),this.sampleTarget=new vl(s,o,{minFilter:cs,magFilter:cs,format:Zs,type:this.supportsHalfFloat?Rd:sl?ka:Ba}),this.sampleTarget.texture.colorSpace=this.parameters.outputColorSpace,this.holdTarget=new vl(s,o,{minFilter:ei,magFilter:ei,format:Zs,type:this.supportsHalfFloat?Rd:sl?ka:Ba}),this.holdTarget.texture.colorSpace=this.parameters.outputColorSpace,this.compositeUniforms={tForeground:new Rb(this.sampleTarget.texture),scale:new Rb(1)},this.compositeMaterial=new ia({uniforms:this.compositeUniforms,vertexShader:i0("Quad.vert"),fragmentShader:i0("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:dC,depthTest:!1,depthWrite:!1}),this.compositeCamera=new g1(-1,1,1,-1,0,1),this.compositeScene=new uU,this.compositeScene.name="compositeScene",this.compositeScene.add(new hl(new VS(2,2),this.compositeMaterial))}_initHelper(){const e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),t=new Float32Array(24),n=new hr;n.setIndex(new Qi(e,1)),n.setAttribute("position",new Qi(t,3));const r=new ia({uniforms:{uColor:{value:new $t("skyblue")}},vertexShader:i0("BasicLine.vert"),fragmentShader:i0("BasicLine.frag")});this.boundingBoxMesh=new MC(n,r),this.helperGroup.add(this.boundingBoxMesh)}updateHelper(){const e=this.boundingBoxMesh.geometry.attributes.position,t=e.array,{min:n,max:r}=this.boundingBox;t[0]=r.x,t[1]=r.y,t[2]=r.z,t[3]=n.x,t[4]=r.y,t[5]=r.z,t[6]=n.x,t[7]=n.y,t[8]=r.z,t[9]=r.x,t[10]=n.y,t[11]=r.z,t[12]=r.x,t[13]=r.y,t[14]=n.z,t[15]=n.x,t[16]=r.y,t[17]=n.z,t[18]=n.x,t[19]=n.y,t[20]=n.z,t[21]=r.x,t[22]=n.y,t[23]=n.z,e.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()}get cameraDistance(){return Math.abs(this.camera.position.z)}set cameraDistance(e){this.camera.position.z=-e}add(e,t){t?t.forEach(n=>this.addBuffer(e,n)):this.addBuffer(e),e.group.name="meshGroup",e.wireframeGroup.name="wireframeGroup",e.parameters.background?(this.backgroundGroup.add(e.group),this.backgroundGroup.add(e.wireframeGroup)):(this.modelGroup.add(e.group),this.modelGroup.add(e.wireframeGroup)),e.pickable&&this.pickingGroup.add(e.pickingGroup),pt&&this.updateHelper()}addBuffer(e,t){function n(o){o instanceof Zn?o.children.forEach(n):(o.userData.buffer=e,o.userData.instance=t,o.onBeforeRender=Uce)}const r=e.getMesh();t&&r.applyMatrix4(t.matrix),n(r),e.group.add(r);const s=e.getWireframeMesh();if(t&&(s.matrix.copy(r.matrix),s.position.copy(r.position),s.quaternion.copy(r.quaternion),s.scale.copy(r.scale)),n(s),e.wireframeGroup.add(s),e.pickable){const o=e.getPickingMesh();t&&(o.matrix.copy(r.matrix),o.position.copy(r.position),o.quaternion.copy(r.quaternion),o.scale.copy(r.scale)),n(o),e.pickingGroup.add(o)}t?this._updateBoundingBox(e.geometry,e.matrix,t.matrix):this._updateBoundingBox(e.geometry,e.matrix)}remove(e){this.translationGroup.children.forEach(function(t){t.remove(e.group),t.remove(e.wireframeGroup)}),e.pickable&&this.pickingGroup.remove(e.pickingGroup),this.updateBoundingBox(),pt&&this.updateHelper()}_updateBoundingBox(e,t,n){const r=this.boundingBox;function s(a,l,c){a.boundingBox==null&&a.computeBoundingBox();const u=a.boundingBox.clone();l&&u.applyMatrix4(l),c&&u.applyMatrix4(c),u.min.equals(u.max)&&u.expandByScalar(5),r.union(u)}function o(a){if(a.geometry!==void 0){let l,c;a.userData.buffer&&(l=a.userData.buffer.matrix),a.userData.instance&&(c=a.userData.instance.matrix),s(a.geometry,l,c)}}e?s(e,t,n):(r.makeEmpty(),this.modelGroup.traverse(o),this.backgroundGroup.traverse(o)),r.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()}updateBoundingBox(){this._updateBoundingBox(),pt&&this.updateHelper()}getPickingPixels(){const{width:e,height:t}=this,n=e*t*4,r=sl?new Float32Array(n):new Uint8Array(n);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,e,t,r),r}getImage(e){return new Promise(t=>{if(e){const{width:n,height:r}=this,s=n*r*4;let o=this.getPickingPixels();if(sl){const u=new Uint8Array(s);for(let h=0;h<s;++h)u[h]=Math.round(255*o[h]);o=u}const a=document.createElement("canvas");a.width=n,a.height=r;const l=a.getContext("2d"),c=l.getImageData(0,0,n,r);c.data.set(o),l.putImageData(c,0,0),a.toBlob(t,"image/png")}else this.renderer.domElement.toBlob(t,"image/png")})}makeImage(e={}){return Dce(this,e)}setLight(e,t,n,r){const s=this.parameters;e!==void 0&&s.lightColor.set(e),t!==void 0&&(s.lightIntensity=t),n!==void 0&&s.ambientColor.set(n),r!==void 0&&(s.ambientIntensity=r),this.requestRender()}setFog(e,t,n){const r=this.parameters;e!==void 0&&r.fogColor.set(e),t!==void 0&&(r.fogNear=t),n!==void 0&&(r.fogFar=n),this.requestRender()}setBackground(e){const t=this.parameters;e&&t.backgroundColor.set(e),this.setFog(t.backgroundColor),this.renderer.setClearColor(t.backgroundColor,0),this.renderer.domElement.style.backgroundColor=t.backgroundColor.getStyle(),this.requestRender()}setSampling(e){e!==void 0&&(this.parameters.sampleLevel=e,this.sampleLevel=e),this.requestRender()}setOutputEncoding(e){this.parameters.outputColorSpace=e,this.renderer.outputColorSpace=e,this.pickingTarget.texture.colorSpace=e,this.sampleTarget.texture.colorSpace=e,this.holdTarget.texture.colorSpace=e}setColorWorkflow(e){if(e!="srgb-linear"&&e!="srgb")throw new Error(`setColorWorkflow: invalid color workflow ${e}`);pV=e=="srgb-linear"?"linear":"sRGB",this.setOutputEncoding(e=="srgb-linear"?"srgb":"srgb-linear"),this.requestRender()}setCamera(e,t,n){const r=this.parameters;if(e&&(r.cameraType=e),t&&(r.cameraFov=t),n&&(r.cameraEyeSep=n),r.cameraType==="orthographic")this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else{if(r.cameraType!=="perspective"&&r.cameraType!=="stereo")throw new Error(`Unknown cameraType '${r.cameraType}'`);this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up))}this.perspectiveCamera.fov=r.cameraFov,this.stereoCamera.eyeSep=r.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()}setClip(e,t,n,r,s){const o=this.parameters;e!==void 0&&(o.clipNear=e),t!==void 0&&(o.clipFar=t),n!==void 0&&(o.clipDist=n),r!==void 0&&(o.clipMode=r),s!==void 0&&(o.clipScale=s),this.requestRender()}setSize(e,t){this.width=e||1,this.height=t||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();const n=window.devicePixelRatio;this.renderer.setPixelRatio(n),this.renderer.setSize(e,t);const r=this.width*n,s=this.height*n;this.pickingTarget.setSize(r,s),this.sampleTarget.setSize(r,s),this.holdTarget.setSize(r,s),this.requestRender()}handleResize(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{const e=this.container.getBoundingClientRect();this.setSize(e.width,e.height)}}updateInfo(e){const{memory:t,render:n}=this.info;if(e)t.programs=0,t.geometries=0,t.textures=0,n.calls=0,n.vertices=0,n.points=0;else{const r=this.renderer.info,s=r.memory,o=r.render;t.geometries=s.geometries,t.textures=s.textures,n.calls+=o.calls,n.faces+=o.triangles,n.points+=o.points}}animate(){if(this.signals.ticked.dispatch(this.stats),window.performance.now()-this.stats.startTime>500&&!this.isStill&&this.sampleLevel<3&&this.sampleLevel!==-1){const e=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=e,pt&&tt.log("rendered still frame")}this.frameRequest=window.requestAnimationFrame(this.animate)}pick(e,t){if(this.parameters.cameraType==="stereo")return{pid:0,instance:void 0,picker:void 0};e*=window.devicePixelRatio,t*=window.devicePixelRatio,e=Math.max(e-2,0),t=Math.max(t-2,0);let n,r,s=0;const o=sl?Fce:kce;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,e,t,5,5,o);for(let a=0;a<kU.length;a++){const l=4*kU[a],c=Math.round(o[l+3]),u=this.pickingGroup.getObjectById(c);u&&(n=u.userData.instance,r=u.userData.buffer.picking,s=sl?Math.round(255*o[l])<<16&16711680|Math.round(255*o[l+1])<<8&65280|255&Math.round(255*o[l+2]):o[l]<<16|o[l+1]<<8|o[l+2])}return{pid:s,instance:n,picker:r}}requestRender(){this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame(()=>{this.render(),this.stats.update()}))}updateZoom(){const e=Pi(this.perspectiveCamera.fov),t=2*Math.tan(e/2)*this.cameraDistance;this.orthographicCamera.zoom=this.height/t}absoluteToRelative(e){return 50*(1-e/this.bRadius)}relativeToAbsolute(e){return this.bRadius*(1-e/50)}__updateClipping(){const e=this.parameters;this.bRadius=Math.max(10,.5*this.boundingBoxLength),isFinite(this.bRadius)||(this.bRadius=50),this.camera.getWorldPosition(this.distVector),this.cDist=this.distVector.length(),this.cDist||(this.cameraDistance=Math.abs(e.cameraZ),this.cDist=Math.abs(e.cameraZ));const t=this.scene.fog;if(t.color.set(e.fogColor),e.clipMode==="camera")this.camera.near=e.clipNear,this.camera.far=e.clipFar,t.near=e.fogNear,t.far=e.fogFar;else if(e.clipScale==="absolute")this.camera.near=this.cDist-e.clipNear,this.camera.far=this.cDist+e.clipFar,t.near=this.cDist-e.fogNear,t.far=this.cDist+e.fogFar;else{const n=(50-e.clipNear)/50,r=-(50-e.clipFar)/50;this.camera.near=this.cDist-this.bRadius*n,this.camera.far=this.cDist+this.bRadius*r;const s=(50-e.fogNear)/50,o=-(50-e.fogFar)/50;t.near=this.cDist-this.bRadius*s,t.far=this.cDist+this.bRadius*o}e.clipMode!=="camera"&&(this.camera.type==="PerspectiveCamera"?(this.camera.near=Math.max(.1,e.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),t.near=Math.max(.1,t.near),t.far=Math.max(1,t.far)):this.camera.type==="OrthographicCamera"&&e.clipDist>0&&(this.camera.near=Math.max(e.clipDist,this.camera.near)))}__updateCamera(){const e=this.camera;e.updateMatrix(),e.updateMatrixWorld(!0),e.updateProjectionMatrix(),function(t,n,r,s,o){let a=new on;r.getSize(a);const l=a.height,c=r.getPixelRatio(),u=n.type==="OrthographicCamera";NU.set(a.width,a.height),Ib.copy(n.projectionMatrix).invert(),Lb.copy(n.projectionMatrix).transpose(),t.traverse(function(h){const d=h.material;if(!d)return;const f=d.uniforms;if(f){if(d.clipNear){const p=(50-d.clipNear)/50,_=s-o*p;f.clipNear.value=_}f.canvasHeight&&(f.canvasHeight.value=l),f.resolution&&f.resolution.value.copy(NU),f.pixelRatio&&(f.pixelRatio.value=c),f.projectionMatrixInverse&&f.projectionMatrixInverse.value.copy(Ib),f.projectionMatrixTranspose&&f.projectionMatrixTranspose.value.copy(Lb),f.ortho&&(f.ortho.value=u)}})}(this.scene,e,this.renderer,this.cDist,this.bRadius),function(t,n){t.traverseVisible(function(r){if(!(r instanceof lV&&r.userData.buffer.parameters.sortParticles))return;const s=r.geometry.attributes,o=s.position.count;if(o===0)return;let a,l,c,u,h,d,f,p;LU.multiplyMatrices(n.matrixWorldInverse,r.matrixWorld),DU.multiplyMatrices(n.projectionMatrix,LU),r.userData.sortData?(a=r.userData.sortData,c=a.__zArray,l=a.__sortArray,u=a.__cmpFn):(c=new Float32Array(o),l=new Uint32Array(o),u=function(_,v){const g=c[_],b=c[v];return g>b?1:g<b?-1:0},a={__zArray:c,__sortArray:l,__cmpFn:u},r.userData.sortData=a);for(let _=0;_<o;++_)dA.fromArray(s.position.array,3*_),dA.applyMatrix4(DU),c[_]=-dA.z,l[_]=_;(function(_,v,g=0,b){v=v||function(N,P){return N>P?1:N<P?-1:0};const m=[];let y,A,w,M=-1,T=g,E=b=(b||_.length)-1;function C(N,P){const L=_[N];_[N]=_[P],_[P]=L}for(;;)if(E-T<=25){for(let N=T+1;N<=E;++N){for(y=_[N],A=N-1;A>=T&&v(_[A],y)>0;)_[A+1]=_[A],--A;_[A+1]=y}if(M===-1)break;E=m[M--],T=m[M--]}else{for(A=T+1,w=E,C(T+E>>1,A),v(_[T],_[E])>0&&C(T,E),v(_[A],_[E])>0&&C(A,E),v(_[T],_[A])>0&&C(T,A),y=_[A];;){do A++;while(v(_[A],y)<0);do w--;while(v(_[w],y)>0);if(w<A)break;C(A,w)}_[T+1]=_[w],_[w]=y,E-A+1>=w-T?(m[++M]=A,m[++M]=E,E=w-1):(m[++M]=T,m[++M]=w-1,T=A)}})(l,u);for(let _ in s){const v=s[_],g=v.array,b=v.itemSize;a[_]||(a[_]=new Float32Array(b*o)),p=a[_],a[_]=g;for(let m=0;m<o;++m){h=l[m];for(let y=0;y<b;++y)d=h*b+y,f=m*b+y,p[f]=g[d]}s[_].array=p,s[_].needsUpdate=!0}})}(this.scene,e)}__setVisibility(e,t,n,r){this.modelGroup.visible=e,this.pickingGroup.visible=t,this.backgroundGroup.visible=n,this.helperGroup.visible=r}__updateLights(){this.directionalLight.color.set(this.parameters.lightColor),this.directionalLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(100*this.boundingBoxLength),this.directionalLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity}__renderPickingGroup(e){this.renderer.setRenderTarget(this.pickingTarget||null),this.renderer.clear(),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderModelGroup(e,t){this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,e),this.renderer.clear(!1,!0,!0),this.updateInfo(),this.__setVisibility(!0,!1,!1,pt),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderSuperSample(e,t){const n=wV[Math.max(0,Math.min(this.sampleLevel,5))],r=1/n.length;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;let s=this.sampleTarget.width;const o=this.sampleTarget.height;this.parameters.cameraType==="stereo"&&(s/=2);for(let a=0;a<n.length;++a){const l=n[a];e.setViewOffset(s,o,l[0],l[1],s,o),e.updateProjectionMatrix(),fA(this.scene,e);let c=r;c+=.03125*((a+.5)/n.length-.5),this.compositeUniforms.scale.value=c,this.__renderModelGroup(e,this.sampleTarget),this.renderer.setRenderTarget(this.holdTarget),a===0&&this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,e.clearViewOffset(),this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}__renderStereo(e=!1,t){const n=this.stereoCamera;n.update(this.perspectiveCamera);const r=this.renderer;let s=new on;r.getSize(s),r.setScissorTest(!0),r.setScissor(0,0,s.width/2,s.height),r.setViewport(0,0,s.width/2,s.height),fA(this.scene,n.cameraL),this.__render(e,n.cameraL),r.setScissor(s.width/2,0,s.width/2,s.height),r.setViewport(s.width/2,0,s.width/2,s.height),fA(this.scene,n.cameraR),this.__render(e,n.cameraR),r.setScissorTest(!1),r.setViewport(0,0,s.width,s.height)}__render(e=!1,t,n){e?this.lastRenderedPicking||this.__renderPickingGroup(t):this.sampleLevel>0&&this.parameters.cameraType!=="stereo"?this.__renderSuperSample(t,n):this.__renderModelGroup(t,n)}render(e=!1,t){if(this.rendering)tt.warn("'tried to call 'render' from within 'render'");else{this.rendering=!0;try{this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),this.parameters.cameraType==="stereo"?this.__renderStereo(e,t):this.__render(e,this.camera,t),this.lastRenderedPicking=e}finally{this.rendering=!1,this.renderPending=!1}this.signals.rendered.dispatch()}}clear(){tt.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()}dispose(){this.renderer.dispose(),window.cancelAnimationFrame(this.frameRequest)}}function UU(i){const e=i.touches[0].pageX-i.touches[1].pageX,t=i.touches[0].pageY-i.touches[1].pageY;return Math.sqrt(e*e+t*t)}class Bce{constructor(e,t={}){this.domElement=e,this.signals={moved:new rn.Signal,scrolled:new rn.Signal,dragged:new rn.Signal,dropped:new rn.Signal,clicked:new rn.Signal,hovered:new rn.Signal,doubleClicked:new rn.Signal},this.position=new on,this.prevPosition=new on,this.down=new on,this.canvasPosition=new on,this.prevClickCP=new on,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=he(t.hoverTimeout,50),this.handleScroll=he(t.handleScroll,!0),this.doubleClickSpeed=he(t.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();const n={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,n),document.addEventListener("wheel",this._onMousewheel,n),document.addEventListener("MozMousePixelScroll",this._onMousewheel,n),document.addEventListener("mousemove",this._onMousemove,n),document.addEventListener("mousedown",this._onMousedown,n),document.addEventListener("mouseup",this._onMouseup,n),document.addEventListener("contextmenu",this._onContextmenu,n),document.addEventListener("touchstart",this._onTouchstart,n),document.addEventListener("touchend",this._onTouchend,n),document.addEventListener("touchmove",this._onTouchmove,n)}get key(){let e=0;return this.altKey&&(e+=1),this.ctrlKey&&(e+=2),this.metaKey&&(e+=4),this.shiftKey&&(e+=8),e}setParameters(e={}){this.hoverTimeout=he(e.hoverTimeout,this.hoverTimeout)}_listen(){const e=window.performance.now(),t=this.canvasPosition;this.doubleClickPending&&e-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),e-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,this.hoverTimeout!==-1&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(t.x,t.y))),this.frameRequest=window.requestAnimationFrame(this._listen)}_onMousewheel(e){if(e.target!==this.domElement||!this.handleScroll)return;e.preventDefault(),this._setKeys(e);let t=0;"deltaY"in e&&"deltaMode"in e&&e.deltaY!==void 0&&e.deltaMode!==void 0?t=e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?.025*-e.deltaY:e.deltaMode===WheelEvent.DOM_DELTA_LINE?-e.deltaY*(2.5/3):2.5*-e.deltaY:"deltaY"in e&&!("detail"in e)?t=.025*-e.deltaY:e.wheelDelta!==void 0?t=.025*-e.wheelDelta:e.wheelDeltaY!==void 0?t=.025*-e.wheelDeltaY:e.detail!==void 0&&(t=-e.detail/3),this.signals.scrolled.dispatch(t),setTimeout(()=>{this.scrolled=!0},this.hoverTimeout)}_onMousemove(e){e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(e),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.clientX,e.clientY),this._setCanvasPosition(e);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n)}_onMousedown(e){e.target===this.domElement&&(e.preventDefault(),this._setKeys(e),this.moving=!1,this.hovering=!1,this.down.set(e.clientX,e.clientY),this.position.set(e.clientX,e.clientY),this.which=e.which,this.buttons=function(t){if(typeof t=="object"){if("buttons"in t)return t.buttons;if("which"in t){const n=t.which;if(n===2)return 4;if(n===3)return 2;if(n>0)return 1<<n-1}else if("button"in t){const n=t.button;if(n===1)return 4;if(n===2)return 2;if(n>=0)return 1<<n}}return 0}(e),this.pressed=!0,this._setCanvasPosition(e))}_onMouseup(e){e.target===this.domElement&&e.preventDefault(),this._setKeys(e);const t=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(t)<4&&(this.signals.doubleClicked.dispatch(t.x,t.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(t.x,t.y),this.doubleClickPending=!0,this.prevClickCP.copy(t)),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onContextmenu(e){e.target===this.domElement&&e.preventDefault()}_onTouchstart(e){if(e.target===this.domElement)switch(e.preventDefault(),this.pressed=!0,e.touches.length){case 1:this.moving=!1,this.hovering=!1,this.down.set(e.touches[0].pageX,e.touches[0].pageY),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);break;case 2:this.down.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.lastTouchDistance=UU(e)}}_onTouchend(e){e.target===this.domElement&&e.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onTouchmove(e){switch(e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,e.touches.length){case 1:{this._setKeys(e),this.which=1,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n);break}case 2:{const t=UU(e),n=t-this.lastTouchDistance;if(this.lastTouchDistance=t,this.prevPosition.copy(this.position),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),Math.abs(n)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(n/2);else{this.which=3,this.buttons=2;const r=this.prevPosition.x-this.position.x,s=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(r,s),this.pressed&&this.signals.dragged.dispatch(r,s)}}}}_distance(){return this.position.distanceTo(this.down)}_setCanvasPosition(e){const t=this.domElement.getBoundingClientRect();let n,r;"clientX"in e&&"clientY"in e?(n=e.clientX-t.left,r=e.clientY-t.top):(n=e.offsetX,r=e.offsetY),this.canvasPosition.set(n,t.height-r)}_setKeys(e){this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.metaKey=e.metaKey,this.shiftKey=e.shiftKey}dispose(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove),window.cancelAnimationFrame(this.frameRequest)}}const mA=new Ct,gA=new Ct,OU=new Ct,bo=new Ct,BU=new Ct,jo=new me,Og=new Ns,zU=new Ns,tu=new Ct,Lh=new me,Ny=new me;class zce{constructor(e,t={}){this.stage=e,this.rotateSpeed=he(t.rotateSpeed,2),this.zoomSpeed=he(t.zoomSpeed,1.2),this.panSpeed=he(t.panSpeed,1),this.viewer=e.viewer,this.mouse=e.mouseObserver,this.controls=e.viewerControls}get component(){return this.stage.transformComponent}get atom(){return this.stage.transformAtom}_setPanVector(e,t,n=0){const r=this.controls.getCanvasScaleFactor(n);Lh.set(e,t,0),Lh.multiplyScalar(this.panSpeed*r)}_getRotateXY(e,t){return[this.rotateSpeed*-e*.01,this.rotateSpeed*t*.01]}_getCameraRotation(e){return e.extractRotation(this.viewer.camera.matrixWorld),e.multiply(gA.makeRotationY(Math.PI)),e}_transformPanVector(){this.component&&(tu.extractRotation(this.component.transform),tu.premultiply(this.viewer.rotationGroup.matrix),tu.invert(),tu.multiply(this._getCameraRotation(bo)),Lh.applyMatrix4(tu))}zoom(e){this.controls.zoom(this.zoomSpeed*e*.02)}pan(e,t){this._setPanVector(e,t),tu.copy(this.viewer.rotationGroup.matrix).invert(),tu.multiply(this._getCameraRotation(bo)),Lh.applyMatrix4(tu),this.controls.translate(Lh)}panComponent(e,t){this.component&&(this._setPanVector(e,t),this._transformPanVector(),this.component.position.add(Lh),this.component.updateMatrix())}panAtom(e,t){this.atom&&this.component&&(this.atom.positionToVector3(Ny),Ny.add(this.viewer.translationGroup.position),Ny.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(e,t,Ny.z),this._transformPanVector(),this.atom.positionAdd(Lh),this.component.updateRepresentations({position:!0}))}rotate(e,t){const[n,r]=this._getRotateXY(e,t);this._getCameraRotation(bo),jo.set(1,0,0),jo.applyMatrix4(bo),Og.setFromAxisAngle(jo,r),jo.set(0,1,0),jo.applyMatrix4(bo),zU.setFromAxisAngle(jo,n),Og.multiply(zU),bo.makeRotationFromQuaternion(Og),this.controls.applyMatrix(bo)}zRotate(e,t){const n=this.rotateSpeed*((-e+t)/-2)*.01;OU.makeRotationZ(n),this.controls.applyMatrix(OU)}rotateComponent(e,t){if(!this.component)return;const[n,r]=this._getRotateXY(e,t);this._getCameraRotation(BU),bo.extractRotation(this.component.transform),bo.premultiply(this.viewer.rotationGroup.matrix),bo.invert(),bo.premultiply(BU),jo.set(1,0,0),jo.applyMatrix4(bo),mA.makeRotationAxis(jo,r),jo.set(0,1,0),jo.applyMatrix4(bo),gA.makeRotationAxis(jo,n),mA.multiply(gA),Og.setFromRotationMatrix(mA),this.component.quaternion.premultiply(Og),this.component.quaternion.normalize(),this.component.updateMatrix()}}const Zf=new me;class Gce{constructor(e,t){this.stage=t,this.pid=e.pid,this.picker=e.picker,this.instance=e.instance,this.stage=t,this.controls=t.viewerControls,this.mouse=t.mouseObserver}get type(){return this.picker.type}get altKey(){return this.mouse.altKey}get ctrlKey(){return this.mouse.ctrlKey}get metaKey(){return this.mouse.metaKey}get shiftKey(){return this.mouse.shiftKey}get canvasPosition(){return this.mouse.canvasPosition}get component(){return this.stage.getComponentsByObject(this.picker.data).list[0]}get object(){return this.picker.getObject(this.pid)}get position(){return this.picker.getPosition(this.pid,this.instance,this.component)}get closestBondAtom(){if(this.type!=="bond"||!this.bond)return;const e=this.bond,t=this.controls,n=this.canvasPosition,r=e.atom1.positionToVector3(),s=e.atom2.positionToVector3();r.applyMatrix4(this.component.matrix),s.applyMatrix4(this.component.matrix);const o=t.getPositionOnCanvas(r),a=t.getPositionOnCanvas(s);return c=o,u=a,(l=n).distanceTo(c)<l.distanceTo(u)?e.atom1:e.atom2;var l,c,u}get closeAtom(){const e=this.canvasPosition,t=this.closestBondAtom;if(!t)return;const n=t.positionToVector3().applyMatrix4(this.component.matrix),r=this.controls.getPositionOnCanvas(n);t.positionToVector3(Zf),this.instance&&Zf.applyMatrix4(this.instance.matrix),Zf.applyMatrix4(this.component.matrix);const s=this.controls.viewer;Zf.add(s.translationGroup.position),Zf.applyMatrix4(s.rotationGroup.matrix);const o=this.controls.getCanvasScaleFactor(Zf.z),a=this.component.getMaxRepresentationRadius(t.index);return e.distanceTo(r)<=a/o?t:void 0}get arrow(){return this._objectIfType("arrow")}get atom(){return this._objectIfType("atom")}get axes(){return this._objectIfType("axes")}get bond(){return this._objectIfType("bond")}get box(){return this._objectIfType("box")}get cone(){return this._objectIfType("cone")}get clash(){return this._objectIfType("clash")}get contact(){return this._objectIfType("contact")}get cylinder(){return this._objectIfType("cylinder")}get distance(){return this._objectIfType("distance")}get ellipsoid(){return this._objectIfType("ellipsoid")}get octahedron(){return this._objectIfType("octahedron")}get point(){return this._objectIfType("point")}get mesh(){return this._objectIfType("mesh")}get slice(){return this._objectIfType("slice")}get sphere(){return this._objectIfType("sphere")}get tetrahedron(){return this._objectIfType("tetrahedron")}get torus(){return this._objectIfType("torus")}get surface(){return this._objectIfType("surface")}get unitcell(){return this._objectIfType("unitcell")}get unknown(){return this._objectIfType("unknown")}get volume(){return this._objectIfType("volume")}get wideline(){return this._objectIfType("wideline")}_objectIfType(e){return this.type===e?this.object:void 0}getLabel(){const e=this.atom||this.closeAtom;let t="nothing";return this.arrow?t=this.arrow.name:e?t=`atom: ${e.qualifiedName()} (${e.structure.name})`:this.axes?t="axes":this.bond?t=`bond: ${this.bond.atom1.qualifiedName()} - ${this.bond.atom2.qualifiedName()} (${this.bond.structure.name})`:this.box?t=this.box.name:this.cone?t=this.cone.name:this.clash?t=`clash: ${this.clash.clash.sele1} - ${this.clash.clash.sele2}`:this.contact?t=`${this.contact.type}: ${this.contact.atom1.qualifiedName()} - ${this.contact.atom2.qualifiedName()} (${this.contact.atom1.structure.name})`:this.cylinder?t=this.cylinder.name:this.distance?t=`distance: ${this.distance.atom1.qualifiedName()} - ${this.distance.atom2.qualifiedName()} (${this.distance.structure.name})`:this.ellipsoid?t=this.ellipsoid.name:this.octahedron?t=this.octahedron.name:this.point?t=this.point.name:this.mesh?t=`mesh: ${this.mesh.name||this.mesh.serial} (${this.mesh.shape.name})`:this.slice?t=`slice: ${this.slice.value.toPrecision(3)} (${this.slice.volume.name})`:this.sphere?t=this.sphere.name:this.surface?t=`surface: ${this.surface.surface.name}`:this.tetrahedron?t=this.tetrahedron.name:this.torus?t=this.torus.name:this.unitcell?t=`unitcell: ${this.unitcell.unitcell.spacegroup} (${this.unitcell.structure.name})`:this.unknown?t="unknown":this.volume?t=`volume: ${this.volume.value.toPrecision(3)} (${this.volume.volume.name})`:this.wideline&&(t=this.wideline.name),t}}class Vce{constructor(e){this.stage=e,this.viewer=e.viewer}pick(e,t){const n=this.viewer.pick(e,t);if(n.picker&&n.picker.type!=="ignore"&&n.pid!==void 0){const r=n.picker.array;if(!(r&&n.pid>=r.length))return new Gce(n,this.stage);console.error("pid >= picker.array.length")}}}const GU=new Ns,VU=new me,HU=new me,vA=new me,Hce=new me,$U=new Ct,WU=new me,jU=new Ct;class $ce{constructor(e){this.stage=e,this.signals={changed:new rn.Signal},this.viewer=e.viewer}get position(){return this.viewer.translationGroup.position}get rotation(){return this.viewer.rotationGroup.quaternion}changed(){this.viewer.requestRender(),this.signals.changed.dispatch()}getPositionOnCanvas(e,t){const n=jS(t,on),r=this.viewer;return vA.copy(e).add(r.translationGroup.position).applyMatrix4(r.rotationGroup.matrix).project(r.camera),n.set((vA.x+1)*r.width/2,(vA.y+1)*r.height/2)}getCanvasScaleFactor(e=0){const t=this.viewer.camera;if(t instanceof g1)return 1/t.zoom;{e=Math.abs(e),e+=this.getCameraDistance();const n=Pi(t.fov);return 2*e*Math.tan(n/2)/this.viewer.height}}getOrientation(e){const t=n0(e);t.copy(this.viewer.rotationGroup.matrix);const n=this.getCameraDistance();return t.scale(Hce.set(n,n,n)),t.setPosition(this.viewer.translationGroup.position),t}orient(e){n0(e).decompose(VU,GU,HU);const t=this.viewer;t.rotationGroup.setRotationFromQuaternion(GU),t.translationGroup.position.copy(VU),t.cameraDistance=HU.z,t.updateZoom(),this.changed()}translate(e){this.viewer.translationGroup.position.add(md(e)),this.changed()}center(e){this.viewer.translationGroup.position.copy(md(e)).negate(),this.changed()}zoom(e){this.distance(this.getCameraDistance()*(1-e))}getCameraDistance(){return this.viewer.cameraDistance}distance(e){this.viewer.cameraDistance=Math.max(Math.abs(e),.2),this.viewer.updateZoom(),this.changed()}spin(e,t){$U.copy(this.viewer.rotationGroup.matrix).invert(),WU.copy(md(e)).applyMatrix4($U),this.viewer.rotationGroup.rotateOnAxis(WU,t),this.changed()}rotate(e){this.viewer.rotationGroup.setRotationFromQuaternion(TC(e)),this.changed()}align(e){jU.copy(n0(e)).invert(),this.viewer.rotationGroup.setRotationFromMatrix(jU),this.changed()}applyMatrix(e){this.viewer.rotationGroup.applyMatrix4(n0(e)),this.changed()}}class Vd{constructor(e,t,...n){this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=he(e,1e3),this.controls=t,this.startTime=window.performance.now(),this._init(...n)}get done(){return this.alpha===1}get paused(){return this._paused}tick(e){if(!this._paused)return this.elapsedDuration=e.currentTime-this.startTime-this.pausedDuration,this.duration===0?this.alpha=1:this.alpha=X1(0,1,this.elapsedDuration/this.duration),this._tick(e),this.done&&this._resolveList.forEach(t=>t()),this.done}pause(e){e&&(this._hold=!0),this.pausedTime===-1&&(this.pausedTime=window.performance.now()),this._paused=!0}resume(e){!e&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)}toggle(){this._paused?this.resume():this.pause()}then(e){let t;return t=this.done?Promise.resolve():new Promise(n=>this._resolveList.push(n)),t.then(e)}}class XU extends Vd{constructor(e,t,...n){super(he(e,1/0),t,...n)}_init(e,t){Array.isArray(e)?this.axis=new me().fromArray(e):this.axis=he(e,new me(0,1,0)),this.angle=he(t,.01)}_tick(e){this.axis&&this.angle&&this.controls.spin(this.axis,this.angle*e.lastDuration/16)}}class qU extends Vd{constructor(e,t,...n){super(he(e,1/0),t,...n),this.angleSum=0,this.direction=1}_init(e,t,n){Array.isArray(e)?this.axis=new me().fromArray(e):this.axis=he(e,new me(0,1,0)),this.angleStep=he(t,.01),this.angleEnd=he(n,.2)}_tick(e){if(!this.axis||!this.angleStep||!this.angleEnd)return;const t=X1(0,1,Math.abs(this.angleSum)/this.angleEnd),n=this.angleStep*this.direction*(1.1-t);this.controls.spin(this.axis,n*e.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}}class YU extends Vd{_init(e,t){this.moveFrom=md(he(e,new me)),this.moveTo=md(he(t,new me))}_tick(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()}}class Wce extends Vd{_init(e,t){this.zoomFrom=e,this.zoomTo=t}_tick(){this.controls.distance(Zo(this.zoomFrom,this.zoomTo,this.alpha))}}class jce extends Vd{constructor(){super(...arguments),this._currentRotation=new Ns}_init(e,t){this.rotateFrom=TC(e),this.rotateTo=TC(t),this._currentRotation=new Ns}_tick(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)}}class Xce extends Vd{_init(e,t,n){this.valueFrom=e,this.valueTo=t,this.callback=n}_tick(){this.callback(Zo(this.valueFrom,this.valueTo,this.alpha))}}class qce extends Vd{_init(e){this.callback=e}_tick(){this.alpha===1&&this.callback()}}class KU{constructor(e=[]){this._resolveList=[],this._list=e}get done(){return this._list.every(e=>e.done)}then(e){let t;return t=this.done?Promise.resolve():new Promise(n=>{this._resolveList.push(n),this._list.forEach(r=>{r.then(()=>{this._resolveList.forEach(s=>{s()}),this._resolveList.length=0})})}),t.then(e)}}class Yce{constructor(e){this.stage=e,this.animationList=[],this.finishedList=[],this.viewer=e.viewer,this.controls=e.viewerControls}get paused(){return this.animationList.every(e=>e.paused)}add(e){return e.duration===0?e.tick(this.viewer.stats):this.animationList.push(e),e}remove(e){const t=this.animationList,n=t.indexOf(e);n>-1&&t.splice(n,1)}run(e){const t=this.finishedList,n=this.animationList,r=n.length;for(let o=0;o<r;++o){const a=n[o];a.tick(e)&&t.push(a)}const s=t.length;if(s){for(let o=0;o<s;++o)this.remove(t[o]);t.length=0}}spin(e,t,n){return this.add(new XU(n,this.controls,e,t))}rock(e,t,n,r){return this.add(new qU(r,this.controls,e,t,n))}rotate(e,t){const n=this.viewer.rotationGroup.quaternion.clone();return this.add(new jce(t,this.controls,n,e))}move(e,t){const n=this.controls.position.clone().negate();return this.add(new YU(t,this.controls,n,e))}zoom(e,t){const n=this.viewer.camera.position.z;return this.add(new Wce(t,this.controls,n,e))}zoomMove(e,t,n){return new KU([this.move(e,n),this.zoom(t,n)])}orient(e,t){const n=new me,r=new Ns,s=new me;return n0(e).decompose(n,r,s),new KU([this.move(n.negate(),t),this.rotate(r,t),this.zoom(-s.x,t)])}value(e,t,n,r){return this.add(new Xce(r,this.controls,e,t,n))}timeout(e,t){return this.add(new qce(t,this.controls,e))}spinComponent(e,t,n,r){return this.add(new XU(r,e.controls,t,n))}rockComponent(e,t,n,r,s){return this.add(new qU(s,e.controls,t,n,r))}moveComponent(e,t,n){const r=e.controls.position.clone().negate();return this.add(new YU(n,e.controls,r,t))}pause(){this.animationList.forEach(e=>e.pause())}resume(){this.animationList.forEach(e=>e.resume())}toggle(){this.paused?this.resume():this.pause()}clear(){this.animationList.length=0}dispose(){this.clear()}}class Kce{constructor(e,t){if(this.fn=e,this.queue=[],this.pending=!1,this.next=this.next.bind(this),t){for(let n=0,r=t.length;n<r;++n)this.queue.push(t[n]);this.next()}}run(e){this.fn(e,this.next)}next(){const e=this.queue.shift();e!==void 0?(this.pending=!0,setTimeout(()=>this.run(e))):this.pending=!1}push(e){this.queue.push(e),this.pending||this.next()}kill(){this.queue.length=0}length(){return this.queue.length}}class K1{constructor(e,t,n){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:_n.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:_n.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=t,this.tasks=new SV,this.queue=new Kce(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=_n.getSchemes()),this.toBePrepared=!1}init(e){const t=e||{};this.clipNear=he(t.clipNear,0),this.clipRadius=he(t.clipRadius,0),this.clipCenter=he(t.clipCenter,new me),this.flatShaded=he(t.flatShaded,!1),this.side=he(t.side,"double"),this.opacity=he(t.opacity,1),this.depthWrite=he(t.depthWrite,!0),this.wireframe=he(t.wireframe,!1),this.setColor(t.color,t),this.colorData=he(t.colorData,void 0),this.colorScheme=he(t.colorScheme,"uniform"),this.colorScale=he(t.colorScale,""),this.colorReverse=he(t.colorReverse,!1),this.colorValue=he(t.colorValue,9474192),this.colorDomain=he(t.colorDomain,void 0),this.colorMode=he(t.colorMode,"hcl"),this.visible=he(t.visible,!0),this.quality=he(t.quality,void 0),this.roughness=he(t.roughness,.4),this.metalness=he(t.metalness,0),this.diffuse=he(t.diffuse,16777215),this.diffuseInterior=he(t.diffuseInterior,!1),this.useInteriorColor=he(t.useInteriorColor,!1),this.interiorColor=he(t.interiorColor,2236962),this.interiorDarkening=he(t.interiorDarkening,0),this.lazy=he(t.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=he(t.matrix,new Ct),this.disablePicking=he(t.disablePicking,!1);const n=this.parameters;n.sphereDetail===!0&&(n.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),n.radialSegments===!0&&(n.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),n.openEnded===!0&&(n.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),n.disableImpostor===!0&&(n.disableImpostor={type:"boolean",rebuild:!0}),t.quality==="low"?(n.sphereDetail&&(this.sphereDetail=0),n.radialSegments&&(this.radialSegments=5)):t.quality==="medium"?(n.sphereDetail&&(this.sphereDetail=1),n.radialSegments&&(this.radialSegments=10)):t.quality==="high"?(n.sphereDetail&&(this.sphereDetail=2),n.radialSegments&&(this.radialSegments=20)):(n.sphereDetail&&(this.sphereDetail=he(t.sphereDetail,1)),n.radialSegments&&(this.radialSegments=he(t.radialSegments,10))),n.openEnded&&(this.openEnded=he(t.openEnded,!0)),n.disableImpostor&&(this.disableImpostor=he(t.disableImpostor,!1))}getColorParams(e){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},e)}getBufferParams(e={}){return Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},e)}setColor(e,t){const n=Object.keys(_n.getSchemes());if(typeof e=="string"&&n.includes(e.toLowerCase()))t?t.colorScheme=e:this.setParameters({colorScheme:e});else if(e!==void 0){let r=new $t(e).getHex();t?(t.colorScheme="uniform",t.colorValue=r):this.setParameters({colorScheme:"uniform",colorValue:r})}return this}prepare(e){}create(){}update(e){this.build()}build(e){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(e||!1)}else this.lazyProps.build=!0}make(e,t){pt&&tt.time("Representation.make "+this.type);const n=()=>{e?(this.update(e),this.viewer.requestRender(),this.tasks.decrement(),t&&t()):(this.clear(),this.create(),this.manualAttach||this.disposed||(pt&&tt.time("Representation.attach "+this.type),this.attach(()=>{pt&&tt.timeEnd("Representation.attach "+this.type),this.tasks.decrement(),t&&t()}))),pt&&tt.timeEnd("Representation.make "+this.type)};this.toBePrepared?this.prepare(n):n()}attach(e){this.setVisibility(this.visible),e()}setVisibility(e,t){if(this.visible=e,this.visible&&this.opacity){const n=this.lazyProps,r=n.bufferParams,s=n.what;if(n.build)return n.build=!1,this.build(),this;(Object.keys(r).length||Object.keys(s).length)&&(n.bufferParams={},n.what={},this.updateParameters(r,s))}return this.bufferList.forEach(function(n){n.setVisibility(e)}),t||this.viewer.requestRender(),this}setParameters(e,t={},n=!1){const r=e||{},s=this.parameters,o={};this.opacity||r.opacity===void 0||(this.lazyProps.build?(this.lazyProps.build=!1,n=!0):(Object.assign(o,this.lazyProps.bufferParams),Object.assign(t,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(r.color,r);for(let a in r)r[a]!==void 0&&s[a]!=null&&(s[a].int&&(r[a]=parseInt(r[a])),s[a].float&&(r[a]=parseFloat(r[a])),r[a]!==this[a]||r[a].equals&&!r[a].equals(this[a]))&&(this[a]&&this[a].copy&&r[a].copy?this[a].copy(r[a]):this[a]&&this[a].set?this[a].set(r[a]):this[a]=r[a],s[a].buffer&&(s[a].buffer===!0?o[a]=r[a]:o[s[a].buffer]=r[a]),s[a].update&&(t[s[a].update]=!0),!s[a].rebuild||s[a].rebuild==="impostor"&&_l&&!this.disableImpostor||(n=!0));return n?this.build():this.updateParameters(o,t),this}updateParameters(e={},t){if(this.lazy&&(!this.visible||!this.opacity)&&e.hasOwnProperty("opacity")===!1)return Object.assign(this.lazyProps.bufferParams,e),void Object.assign(this.lazyProps.what,t);this.bufferList.forEach(function(n){n.setParameters(e)}),Object.keys(t).length&&this.update(t),this.viewer.requestRender()}getParameters(){const e={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach(t=>{this.parameters[t]!==null&&(e[t]=this[t])}),e}clear(){this.bufferList.forEach(e=>{this.viewer.remove(e),e.dispose()}),this.bufferList.length=0,this.viewer.requestRender()}dispose(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()}}class AV{constructor(e){this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=e,this.blobUrl=window.URL.createObjectURL(C0.get(e)),this.worker=new Worker(this.blobUrl),C0.activeWorkerCount+=1,this.worker.onmessage=t=>{this.pending-=1;const n=t.data.__postId;pt&&tt.timeEnd("Worker.postMessage "+e+" #"+n);const r=this.onmessageDict[n];r&&r.call(this.worker,t),delete this.onmessageDict[n],delete this.onerrorDict[n]},this.worker.onerror=t=>{if(this.pending-=1,t.data){const n=t.data.__postId,r=this.onerrorDict[n];r?r.call(this.worker,t):tt.error("Worker.onerror",n,e,t),delete this.onmessageDict[n],delete this.onerrorDict[n]}else tt.error("Worker.onerror",e,t)}}post(e={},t,n,r){this.onmessageDict[this.postCount]=n,this.onerrorDict[this.postCount]=r,e.__name=this.name,e.__postId=this.postCount,e.__debug=pt,pt&&tt.time(`Worker.postMessage ${this.name} #${this.postCount}`);try{this.worker.postMessage(e,t)}catch(s){tt.error("worker.post:",s),this.worker.postMessage(e)}return this.pending+=1,this.postCount+=1,this}terminate(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),C0.activeWorkerCount-=1):tt.log("no worker to terminate")}}class RC{constructor(e,t=2){this.pool=[],this.count=0,this.maxCount=Math.min(8,t),this.name=e}post(e={},t,n,r){const s=this.getNextWorker();return s?s.post(e,t,n,r):console.error("unable to get worker from pool"),this}terminate(){this.pool.forEach(function(e){e.terminate()})}getNextWorker(){let e,t=1/0;for(let n=0;n<this.maxCount;++n){if(n>=this.count){e=new AV(this.name),this.pool.push(e),this.count+=1;break}const r=this.pool[n];if(r.pending===0){e=r;break}r.pending<t&&(t=r.pending,e=r)}return e}}function IC(i){const e=i.length,t=e/3;let n=0,r=0,s=0;for(let o=0;o<e;o+=3)n+=i[o+0],r+=i[o+1],s+=i[o+2];return new me(n/t,r/t,s/t)}function gd(i,e,t){return t?i.sub(t).projectOnVector(e).add(t):i.projectOnVector(e),i}function _1(i){let e=1/0,t=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=i.length;a<l;a+=3){const c=i[a],u=i[a+1],h=i[a+2];c<e&&(e=c),u<t&&(t=u),h<n&&(n=h),c>r&&(r=c),u>s&&(s=u),h>o&&(o=h)}return[nn([e,t,n]),nn([r,s,o])]}function qS(i,e){for(let t=0,n=e.length;t<n;t+=3){const r=e[t],s=e[t+1],o=e[t+2];e[t]=i[0]*r+i[4]*s+i[8]*o+i[12],e[t+1]=i[1]*r+i[5]*s+i[9]*o+i[13],e[t+2]=i[2]*r+i[6]*s+i[10]*o+i[14]}}function y3(i,e){for(let t=0,n=e.length;t<n;t+=3){const r=e[t],s=e[t+1],o=e[t+2];e[t]=i[0]*r+i[3]*s+i[6]*o,e[t+1]=i[1]*r+i[4]*s+i[7]*o,e[t+2]=i[2]*r+i[5]*s+i[8]*o}}function EV(i){for(let e=0,t=i.length;e<t;e+=3){const n=i[e],r=i[e+1],s=i[e+2],o=n*n+r*r+s*s;if(o>0){const a=1/Math.sqrt(o);i[e]=n*a,i[e+1]=r*a,i[e+2]=s*a}}}function nn(i){return new Float32Array(i||3)}function ro(i,e,t){const n=e[0],r=e[1],s=e[2],o=t[0],a=t[1],l=t[2];i[0]=r*l-s*a,i[1]=s*o-n*l,i[2]=n*a-r*o}function Ws(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function _i(i,e,t){i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2]}function Ia(i,e,t){i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2]}function Cs(i,e,t=0){i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2]}function sn(i,e,t=0){e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2]}function TV(i){return i[0]*i[0]+i[1]*i[1]+i[2]*i[2]}function Du(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2])}function Tp(i,e,t){$n(i,e,1/t)}function $n(i,e,t){i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t}function Ti(i,e){const t=TV(e);t==0?(i[0]=e[0],i[1]=e[1],i[2]=e[2]):$n(i,e,1/Math.sqrt(t))}function CV(i,e,t){i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t}function Bx(i,e,t){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function LC(i,e){i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2])}function r0(i,e){i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2])}function YS(i,e){i[0]=-e[0],i[1]=-e[1],i[2]=-e[2]}function Zce(i,e){const t=i[0],n=i[1],r=i[2],s=e[0],o=e[1],a=e[2],l=n*a-r*o,c=r*s-t*a,u=t*o-n*s,h=Math.sqrt(l*l+c*c+u*u),d=t*s+n*o+r*a;return Math.atan2(h,d)}function Qce(i,e=9){const t=Math.floor(e/2),n=i.position1.length/3,r=3*(t*n),s=1/e,o=XS(i.position1,i.position2),a=new Float32Array(r),l=new Float32Array(r),c=new me;for(let f=0;f<n;++f){const p=3*f;c.set(o[p],o[p+1],o[p+2]);const _=i.position1[p],v=i.position1[p+1],g=i.position1[p+2];for(let b=0;b<t;++b){const m=t*p+3*b,y=s*(2*b+1),A=s*(2*b+2);a[m]=_+c.x*y,a[m+1]=v+c.y*y,a[m+2]=g+c.z*y,l[m]=_+c.x*A,l[m+1]=v+c.y*A,l[m+2]=g+c.z*A}}const u=yl(a,l),h=function(f,p){const _=f.length/3,v=new Float32Array(_*p*3);for(let g=0;g<_;++g){const b=3*g,m=g*p*3,y=f[b+0],A=f[b+1],w=f[b+2];for(let M=0;M<p;++M){const T=m+3*M;v[T+0]=y,v[T+1]=A,v[T+2]=w}}return v}(i.color,t),d={position:u,position1:a,position2:l,color:h,color2:h};return i.radius&&(d.radius=hA(i.radius,t)),i.picking&&i.picking.array&&(i.picking.array=hA(i.picking.array,t),d.picking=i.picking),i.primitiveId&&(d.primitiveId=hA(i.primitiveId,t)),d}function PV(i,e=.1){const t=XS(i.position1,i.position2),n=[],r=[],s=[],o=i.radius?[]:void 0,a=i.picking?[]:void 0,l=i.primitiveId?[]:void 0,c=new me,u=i.position1.length/3;let h=0;for(let g=0;g<u;++g){const b=3*g;c.set(t[b],t[b+1],t[b+2]);const m=c.length()/e,y=Math.floor(m/2),A=1/m,w=i.position1[b],M=i.position1[b+1],T=i.position1[b+2];for(let E=0;E<y;++E){const C=3*h+3*E,N=A*(2*E+1),P=A*(2*E+2);n[C]=w+c.x*N,n[C+1]=M+c.y*N,n[C+2]=T+c.z*N,r[C]=w+c.x*P,r[C+1]=M+c.y*P,r[C+2]=T+c.z*P,i.color&&(s[C]=i.color[b],s[C+1]=i.color[b+1],s[C+2]=i.color[b+2]),o&&(o[h+E]=i.radius[g]),a&&(i.picking.array?a[h+E]=i.picking.array[g]:a[h+E]=g),l&&(l[h+E]=i.primitiveId[g])}h+=y}const d=new Float32Array(n),f=new Float32Array(r),p=yl(d,f),_=new Float32Array(s),v={position:p,position1:d,position2:f,color:_,color2:_};return o&&(v.radius=new Float32Array(o)),a&&i.picking&&(i.picking.array=new Float32Array(a),v.picking=i.picking),l&&(v.primitiveId=new Float32Array(l)),v}function DC(i,e=.1){const t=XS(i.position1,i.position2),n=[],r=[],s=[],o=i.radius?[]:void 0,a=i.picking?[]:void 0,l=i.primitiveId?[]:void 0,c=new me,u=i.position1.length/3;let h=e,d=!0,f=0,p=0,_=0;for(let A=0;A<u;++A){const w=3*A,M=i.position1[w],T=i.position1[w+1],E=i.position1[w+2];c.set(t[w],t[w+1],t[w+2]);const C=c.length();d&&(n[p]=M,n[p+1]=T,n[p+2]=E);let N=h;const P=1/C;for(;N<C;){const L=d?r:n;L[p]=M+c.x*N*P,L[p+1]=T+c.y*N*P,L[p+2]=E+c.z*N*P,d&&(f++,p=3*f),d=!d,h=e,N+=e}d&&(r[p]=i.position2[w],r[p+1]=i.position2[w+1],r[p+2]=i.position2[w+2],f++,p=3*f),h=N-C;for(let L=_;L<f;L++){if(i.color){const R=3*L;s[R]=i.color[w],s[R+1]=i.color[w+1],s[R+2]=i.color[w+2]}o&&(o[L]=i.radius[A]),a&&(i.picking.array?a[L]=i.picking.array[A]:a[L]=A),l&&(l[L]=i.primitiveId[A])}_=f}if(!d&&u>0){const A=3*f;r[A]=i.position2[3*u-3],r[A+1]=i.position2[3*u-2],r[A+1]=i.position2[3*u-1]}const v=new Float32Array(n),g=new Float32Array(r),b=yl(v,g),m=new Float32Array(s),y={position:b,position1:v,position2:g,color:m,color2:m};return o&&(y.radius=new Float32Array(o)),a&&i.picking&&(i.picking.array=new Float32Array(a),y.picking=i.picking),l&&(y.primitiveId=new Float32Array(l)),y}RC.prototype.constructor=RC,_1.__deps=[nn],Tp.__deps=[$n],Ti.__deps=[$n,TV];const Hu=new me;class $u{static get Picker(){return qo.get(this.type)}static get Buffer(){return Fo.get(this.type)}static getShapeKey(e){return this.type+e[0].toUpperCase()+e.substr(1)}static expandBoundingBox(e,t){}static valueToShape(e,t,n){const r=e._primitiveData[this.getShapeKey(t)];switch(this.fields[t]){case"v3":case"c":(function(s,o){s.toArray!==void 0?s=s.toArray():s.x!==void 0?s=[s.x,s.y,s.z]:s.r!==void 0&&(s=[s.r,s.g,s.b]),o.push.apply(o,s)})(n,r);break;default:r.push(n)}}static objectToShape(e,t){Object.keys(this.fields).forEach(n=>{this.valueToShape(e,n,t[n])}),this.valueToShape(e,"name",t.name),this.expandBoundingBox(e.boundingBox,t)}static valueFromShape(e,t,n){const r=e._primitiveData[this.getShapeKey(n)];switch(this.fields[n]){case"v3":return new me().fromArray(r,3*t);case"c":return new $t().fromArray(r,3*t);default:return r[t]}}static objectFromShape(e,t){let n=this.valueFromShape(e,t,"name");n===void 0&&(n=`${this.type}: ${t} (${e.name})`);const r={shape:e,name:n};return Object.keys(this.fields).forEach(s=>{r[s]=this.valueFromShape(e,t,s)}),r}static arrayFromShape(e,t){const n=e._primitiveData[this.getShapeKey(t)];return this.fields[t]==="s"?n:new Float32Array(n)}static dataFromShape(e){const t={};return this.Picker&&(t.picking=new this.Picker(e)),Object.keys(this.fields).forEach(n=>{t[n]=this.arrayFromShape(e,n)}),t}static bufferFromShape(e,t){return new this.Buffer(this.dataFromShape(e),t)}}$u.type="",$u.fields={};class _m extends $u{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Hu.fromArray(t.position))}}_m.type="sphere",_m.fields={position:"v3",color:"c",radius:"f"};class Id extends $u{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Hu.fromArray(t.position))}}Id.type="box",Id.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};class KS extends Id{}KS.type="octahedron";class ZS extends Id{}ZS.type="tetrahedron";class Ld extends $u{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),r=this.valueFromShape(e,t,"position2");return n.add(r).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Hu.fromArray(t.position1)),e.expandByPoint(Hu.fromArray(t.position2))}static bufferFromShape(e,t={}){let n=this.dataFromShape(e);return this.type==="cylinder"&&t.dashedCylinder&&(n=PV(n)),new this.Buffer(n,t)}}Ld.type="cylinder",Ld.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};class QS extends Ld{}QS.type="arrow";class JS extends Ld{}JS.type="cone";class ym extends _m{}ym.type="ellipsoid",ym.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};class e2 extends ym{}e2.type="torus";class Db extends $u{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Hu.fromArray(t.position))}}Db.type="text",Db.fields={position:"v3",color:"c",size:"f",text:"s"};class y1 extends $u{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Hu.fromArray(t.position))}}y1.type="point",y1.fields={position:"v3",color:"c"};class x1 extends $u{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),r=this.valueFromShape(e,t,"position2");return n.add(r).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Hu.fromArray(t.position1)),e.expandByPoint(Hu.fromArray(t.position2))}}x1.type="wideline",x1.fields={position1:"v3",position2:"v3",color:"c"};class b1{constructor(e,t){this.exp=3;const n=t||function(v){const{x:g,y:b,z:m}=v,y=new Li,A=g.length,{min:w,max:M}=y;for(let T=0;T<A;T++)w.x=Math.min(g[T],w.x),w.y=Math.min(b[T],w.y),w.z=Math.min(m[T],w.z),M.x=Math.max(g[T],M.x),M.y=Math.max(b[T],M.y),M.z=Math.max(m[T],M.z);return y}(e);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=1+(n.max.x-this.minX>>this.exp),this.boundY=1+(n.max.y-this.minY>>this.exp),this.boundZ=1+(n.max.z-this.minZ>>this.exp);const r=this.boundX*this.boundY*this.boundZ,s=e.count!==void 0?e.count:e.x.length,o=e.x,a=e.y,l=e.z;let c=0;const u=new Uint32Array(r),h=new Int32Array(s);for(let v=0;v<s;++v){const g=o[v]-this.minX>>this.exp,b=a[v]-this.minY>>this.exp,m=l[v]-this.minZ>>this.exp,y=(g*this.boundY+b)*this.boundZ+m;(u[y]+=1)===1&&(c+=1),h[v]=y}const d=new Uint16Array(c);for(let v=0,g=0;v<r;++v){const b=u[v];b>0&&(u[v]=g+1,d[g]=b,g+=1)}const f=new Uint32Array(c);for(let v=1;v<c;++v)f[v]+=f[v-1]+d[v-1];const p=new Uint16Array(c),_=new Int32Array(s);for(let v=0;v<s;++v){const g=u[h[v]];if(g>0){const b=g-1;_[f[b]+p[b]]=v,p[b]+=1}}this.grid=u,this.bucketCount=d,this.bucketOffset=f,this.bucketArray=_,this.xArray=o,this.yArray=a,this.zArray=l}within(e,t,n,r){const s=[];return this.eachWithin(e,t,n,r,o=>s.push(o)),s}eachWithin(e,t,n,r,s){const o=r*r,a=Math.max(0,e-r-this.minX>>this.exp),l=Math.max(0,t-r-this.minY>>this.exp),c=Math.max(0,n-r-this.minZ>>this.exp),u=Math.min(this.boundX,1+(e+r-this.minX>>this.exp)),h=Math.min(this.boundY,1+(t+r-this.minY>>this.exp)),d=Math.min(this.boundZ,1+(n+r-this.minZ>>this.exp));for(let f=a;f<u;++f)for(let p=l;p<h;++p)for(let _=c;_<d;++_){const v=(f*this.boundY+p)*this.boundZ+_,g=this.grid[v];if(g>0){const b=g-1,m=this.bucketOffset[b],y=m+this.bucketCount[b];for(let A=m;A<y;++A){const w=this.bucketArray[A],M=this.xArray[w]-e,T=this.yArray[w]-t,E=this.zArray[w]-n,C=M*M+T*T+E*E;C<=o&&s(w,C)}}}}}class Um{constructor(e=0){this._fields=this._defaultFields,this._init(0)}get _defaultFields(){return[]}_init(e){this.length=e,this.count=0;for(let t=0,n=this._fields.length;t<n;++t){const[r,s,o]=this._fields[t];this._initField(r,s,o)}}_initField(e,t,n){this[e]=fV(n,this.length*t)}addField(e,t,n){this._fields.push([e,t,n]),this._initField(e,t,n)}resize(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(let t=0,n=this._fields.length;t<n;++t){const r=this._fields[t][0],s=this._fields[t][1],o=this.length*s,a=new this[r].constructor(o);this[r].length>o?a.set(this[r].subarray(0,o)):a.set(this[r]),this[r]=a}}growIfFull(){if(this.count>=this.length){const e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}copyFrom(e,t,n,r){for(let s=0,o=this._fields.length;s<o;++s){const a=this._fields[s][0],l=this._fields[s][1],c=this[a],u=e[a];for(let h=0;h<r;++h){const d=l*(t+h),f=l*(n+h);for(let p=0;p<l;++p)c[d+p]=u[f+p]}}}copyWithin(e,t,n){for(let r=0,s=this._fields.length;r<s;++r){const o=this._fields[r][0],a=this._fields[r][1],l=this[o];for(let c=0;c<n;++c){const u=a*(e+c),h=a*(t+c);for(let d=0;d<a;++d)l[u+d]=l[h+d]}}}sort(e){tt.time("Store.sort");const t=this,n=new this.constructor(1);(function r(s,o){if(s<o){let c=Math.floor((s+o)/2),u=s,h=o;do{for(;e(u,c)<0;)u+=1;for(;e(h,c)>0;)h-=1;u<=h&&(u===c?c=h:h===c&&(c=u),(a=u)!==(l=h)&&(n.copyFrom(t,0,a,1),t.copyWithin(a,l,1),t.copyFrom(n,l,0,1)),u+=1,h-=1)}while(u<=h);r(s,h),r(u,o)}var a,l})(0,this.count-1),tt.timeEnd("Store.sort")}clear(){this.count=0}dispose(){for(let e=0,t=this._fields.length;e<t;++e)delete this[this._fields[e][0]]}}class Jce extends Um{get _defaultFields(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]}addContact(e,t,n){this.growIfFull();const r=this.count;e<t?(this.index1[r]=e,this.index2[r]=t):(this.index2[r]=e,this.index1[r]=t),n&&(this.type[r]=n),this.count+=1}}function Fy(i){return 16843009*((i=(858993459&(i-=i>>>1&1431655765))+(i>>>2&858993459))+(i>>>4)&252645135)>>>24}class gr{constructor(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),t===!0&&this.setAll()}get(e){return!!(this._words[e>>>5]&1<<e)}set(e){this._words[e>>>5]|=1<<e}clear(e){this._words[e>>>5]&=~(1<<e)}flip(e){this._words[e>>>5]^=1<<e}_assignRange(e,t,n){if(t<e)return;const r=this._words,s=n===!0?4294967295:0,o=e>>>5,a=t>>>5;for(let u=o+1;u<a;++u)r[u]=s;const l=o<<5,c=a<<5;if(n===!0)if(t-e<32)for(let u=e,h=t+1;u<h;++u)r[u>>>5]|=1<<u;else{for(let u=e,h=l+32;u<h;++u)r[u>>>5]|=1<<u;for(let u=c,h=t+1;u<h;++u)r[u>>>5]|=1<<u}else if(t-e<32)for(let u=e,h=t+1;u<h;++u)r[u>>>5]&=~(1<<u);else{for(let u=e,h=l+32;u<h;++u)r[u>>>5]&=~(1<<u);for(let u=c,h=t+1;u<h;++u)r[u>>>5]&=~(1<<u)}return this}setRange(e,t){return this._assignRange(e,t,!0)}clearRange(e,t){return this._assignRange(e,t,!1)}setBits(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const s=e[r];t[s>>>5]|=1<<s}return this}clearBits(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const s=e[r];t[s>>>5]&=~(1<<s)}return this}setAll(){return this._assignRange(0,this.length-1,!0)}clearAll(){return this._assignRange(0,this.length-1,!1)}flipAll(){const e=this._words.length,t=this._words,n=32-this.length%32;for(let r=0;r<e-1;++r)t[r]=~t[r];return t[e-1]=~(t[e-1]<<n)>>>n,this}_isRangeValue(e,t,n){if(t<e)return;const r=this._words,s=n===!0?4294967295:0,o=e>>>5,a=t>>>5;for(let l=o+1;l<a;++l)if(r[l]!==s)return!1;if(t-e<32){for(let l=e,c=t+1;l<c;++l)if(!!(r[l>>>5]&1<<l)!==n)return!1}else{const l=a<<5;for(let c=e,u=(o<<5)+32;c<u;++c)if(!!(r[c>>>5]&1<<c)!==n)return!1;for(let c=l,u=t+1;c<u;++c)if(!!(r[c>>>5]&1<<c)!==n)return!1}return!0}isRangeSet(e,t){return this._isRangeValue(e,t,!0)}isRangeClear(e,t){return this._isRangeValue(e,t,!1)}isAllSet(){return this._isRangeValue(0,this.length-1,!0)}isAllClear(){return this._isRangeValue(0,this.length-1,!1)}isSet(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const s=e[r];if(!(t[s>>>5]&1<<s))return!1}return!0}isClear(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const s=e[r];if(t[s>>>5]&1<<s)return!1}return!0}isEqualTo(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)if(t[s]!==n[s])return!1;return!0}getSize(){const e=this._words.length,t=this._words;let n=0;for(let r=0;r<e;++r)n+=Fy(t[r]);return n}difference(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)t[s]=t[s]&~n[s];for(let s=t.length;s<r;++s)t[s]=0;return this}union(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)t[s]|=n[s];for(let s=t.length;s<r;++s)t[s]=0;return this}intersection(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)t[s]&=n[s];for(let s=t.length;s<r;++s)t[s]=0;return this}intersects(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)if(t[s]&n[s])return!0;return!1}getIntersectionSize(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);let s=0;for(let o=0;o<r;++o)s+=Fy(t[o]&n[o]);return s}makeIntersection(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length),s=new Uint32Array(r),o=Object.create(gr.prototype);o._words=s,o.length=Math.min(this.length,e.length);for(let a=0;a<r;++a)s[a]=t[a]&n[a];return o}forEach(e){const t=this._words.length,n=this._words;let r=0;for(let s=0;s<t;++s){let o=n[s];for(;o!==0;){const a=o&-o;e((s<<5)+Fy(a-1),r),o^=a,++r}}}toArray(){const e=this._words,t=new Array(this.getSize()),n=this._words.length;let r=0;for(let s=0;s<n;++s){let o=e[s];for(;o!==0;){const a=o&-o;t[r++]=(s<<5)+Fy(a-1),o^=a}}return t}toString(){return"{"+this.toArray().join(",")+"}"}toSeleString(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(gr.prototype);return e.length=this.length,e._words=new Uint32Array(this._words),e}}function RV(i){const{edgeCount:e,nodeCount:t,nodeArray1:n,nodeArray2:r}=i,s=new Uint8Array(t),o=new Int32Array(t);for(let c=0;c<e;++c)s[n[c]]+=1,s[r[c]]+=1;for(let c=1;c<t;++c)o[c]+=o[c-1]+s[c-1];const a=2*e,l=new Int32Array(a);for(let c=0;c<a;++c)l[c]=-1;for(let c=0;c<e;++c){const u=n[c],h=r[c];let d=o[u];for(;l[d]!==-1&&d<a;)d+=1;l[d]=c;let f=o[h];for(;l[f]!==-1&&f<a;)f+=1;l[f]=c}return{countArray:s,offsetArray:o,indexArray:l}}function Lr(i=0,e=0){return{type:i,group:e,x:0,y:0,z:0,atomSet:[]}}function Xi(i,e){i.x+=e.x,i.y+=e.y,i.z+=e.z,i.atomSet.push(e.index)}function qi(i,e){const t=e.atomSet.length;if(t>0){const{types:n,groups:r,centers:s,atomSets:o}=i;n.push(e.type),r.push(e.group),s.x.push(e.x/t),s.y.push(e.y/t),s.z.push(e.z/t),o.push(e.atomSet)}}const Dd=0,eue=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],tue=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],nue=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],IV=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],iue=["NON-POLYMER"].concat(["OTHER"],IV),LV=["h","g","i"],DV=["e","b"],NV=["s","t","l",""],FV={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},rue={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},sue={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},ZU={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},oue={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},QU={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},aue=[0,0,0],Nb={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},Vp=Object.keys(Nb),kV=["A","C","T","G","U","I"],UV=["DA","DC","DT","DG","DU","DI"],lue=["A","G","I","DA","DG","DI"],P0=kV.concat(UV),Fb=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],cue=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],uue=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],hue=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],OV=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],s0={1:{trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},2:{trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},3:{trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},4:{trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},5:{trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},6:{trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]}};s0[Dd]={};const JU={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function ky(i){switch(i){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}const e4=new Map([[2,Pi(180)],[3,Pi(120)],[4,Pi(109.4721)],[6,Pi(90)]]);function Uy(i,e){let t=[];const n=new me,r=new me;return n.subVectors(e,i),i.eachBondedAtom(s=>{s.number!==1&&(r.subVectors(s,i),t.push(n.angleTo(r)))}),t}function t4(i,e){const t=i.clone(),n=new me;n.subVectors(e,i);const r=[new me,new me];let s=0;if(i.eachBondedAtom(a=>{s>1||a.number!==1&&(t.index=a.index,r[s++].subVectors(a,i))}),s===1&&t.eachBondedAtom(a=>{s>1||a.number!==1&&a.index!==i.index&&r[s++].subVectors(a,i)}),s!==2)return;const o=r[0].cross(r[1]);return Math.abs(Math.PI/2-o.angleTo(n))}function due(i,e){const t=i.structure,n=t.atomCount,r=new Int8Array(n),s=new Int8Array(n),o=new Int8Array(n),a=new Int8Array(n);return t.eachAtom(l=>{const c=l.index,[u,h,d,f]=function(p,_){const v=p.bondToElementCount(1);let g=p.formalCharge||0;const b=g===0,m=v===0,y=p.bondCount,A=function(C){let N=0;return C.eachBond(P=>N+=P.bondOrder),N}(p),w=function(C){const N=C.structure.getBondProxy(),P=C.number,L=P===8||P===7;if(L&&C.bondCount===4)return!1;let R=!1;return C.eachBond(F=>{if(F.bondOrder>1)R=!0;else if(L){const V=F.getOtherAtom(C);V.eachBond(G=>{if(G.bondOrder>1){const U=V.number;if((U===15||U===16)&&G.getOtherAtom(V).number===8)return;R=!0}},N)}}),R}(p),M=A-y>0;let T=0,E=8;switch(p.number){case 1:b&&(y===0?(g=1,E=0):y===1&&(g=0,E=1));break;case 6:b&&(g=0),m&&(T=Math.max(0,4-A-Math.abs(g))),E=ky(y+T+Math.max(0,-g));break;case 7:if(b)if(m)if(w&&A<4)g=y-v==1&&A-v==2?1:0;else{let C=!1;p.eachBondedAtom(N=>{(N.number===16||N.isMetal())&&(C=!0)}),g=C?0:1}else g=A-3;m&&(T=Math.max(0,3-A+g)),E=ky(w&&!M?y+T-g:y+T+1-g);break;case 8:b&&(m||(g=A-2),A===1&&p.eachBondedAtom(C=>{C.eachBond(N=>{const P=N.getOtherAtom(C);P.index!==p.index&&P.number===8&&N.bondOrder===2&&(g=-1)})})),m&&(T=Math.max(0,2-A+g)),E=ky(w&&!M?y+T-g+1:y+T-g+2);break;case 16:b&&(m||(g=A<=3&&!p.bondToElementCount(8)?A-2:0)),m&&A<2&&(T=Math.max(0,2-A+g)),A<=3&&(E=ky(y+T-g+2));break;case 9:case 17:case 35:case 53:case 85:b&&(g=A-1);break;case 3:case 11:case 19:case 37:case 55:case 87:b&&(g=1-A);break;case 4:case 12:case 20:case 38:case 56:case 88:b&&(g=2-A);break;default:console.warn("Requested charge, protonation for an unhandled element",p.element)}return[g,T,T+v,E]}(l);r[c]=u,s[c]=h,o[c]=d,a[c]=f}),{charge:r,implicitH:s,totalH:o,idealGeometry:a}}function op(i){if(i["@valenceModel"])return i["@valenceModel"];const e=due(i);return i["@valenceModel"]=e,e}function n4(i){return i.number===15&&i.bondToElementCount(8)===i.bondCount}const fue=["ARG","HIS","LYS"],pue=["GLU","ASP"];function mue(i,e){return i===2&&e===1||i===1&&e===2}function gue(i,e){return i===3&&e===3}function vue(i,e){return i===3&&e===1||i===1&&e===3}function i4(i){return i.resname==="HIS"&&i.number==7&&i.isRing()}function _ue(i,e){return i===5&&e===4||i===4&&e===5}function yue(i,e){return i===9&&e===5||i===5&&e===9}const xue=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function bue(i,e){return i===12?e===11||e===12:i===13?e===10:void 0}const Sue=[17,35,53,85],wue=[7,8,16],Mue=[6,7,15,16],Aue=Pi(180),Eue=Pi(120);function r4(i,e,t){return!BV(i,e,t)&&(i.modelIndex!==e.modelIndex||i.altloc&&e.altloc&&i.altloc!==e.altloc)}const mi={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function BV(i,e,t){return i.modelIndex===t&&e.modelIndex!==t||e.modelIndex===t&&i.modelIndex!==t}function Bg(i,e,t){return!BV(i,e,t)&&(i.modelIndex!==e.modelIndex||i.residueIndex===e.residueIndex||i.altloc&&e.altloc&&i.altloc!==e.altloc)}function Tue(i){const e={types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]};return pt&&tt.time("calculateFeatures"),function(t,n){const{charge:r}=op(t.data),s={};t.eachResidue(o=>{if(fue.includes(o.resname)){const a=Lr(1);o.eachAtom(l=>{l.number===7&&l.isSidechain()&&Xi(a,l)}),qi(n,a)}else Vp.includes(o.resname)||o.isNucleic()||(o.eachAtom(a=>{let l=!1;const c=Lr(1);(function(u){let h=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===3&&u.eachBondedAtom(d=>{d.bondCount-d.bondToElementCount(1)==1&&++h}),h===2})(a)?(c.group=8,l=!0):function(u){let h=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom(d=>{d.bondCount-d.bondToElementCount(1)==1&&++h}),h===2}(a)&&(c.group=9,l=!0),l&&(a.eachBondedAtom(u=>{u.number===7&&(s[u.index]=!0,Xi(c,u))}),qi(n,c))}),o.eachAtom(a=>{const l=Lr(1);r[a.index]>0&&(s[a.index]||(Xi(l,a),qi(n,l)))}))})}(i,e),function(t,n){const{charge:r}=op(t.data),s={};t.eachResidue(o=>{if(pue.includes(o.resname)){const a=Lr(2);o.eachAtom(l=>{l.number===8&&l.isSidechain()&&Xi(a,l)}),qi(n,a)}else if(P0.includes(o.resname)){const a=Lr(2);o.eachAtom(l=>{n4(l)&&(a.group=6,l.eachBondedAtom(c=>{c.number===8&&Xi(a,c)}),qi(n,a))})}else Vp.includes(o.resname)||P0.includes(o.resname)||(o.eachAtom(a=>{let l=!1;const c=Lr(2);(function(u){return u.number===16&&u.bondToElementCount(8)===3})(a)?(c.group=4,l=!0):n4(a)?(c.group=6,l=!0):function(u){return u.number===16&&u.bondToElementCount(8)===4}(a)?(c.group=5,l=!0):function(u){let h=0;return u.number===6&&u.bondToElementCount(8)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom(d=>{d.number===8&&d.bondCount-d.bondToElementCount(1)==1&&++h}),h===2}(a)&&(c.group=10,l=!0),l&&(a.eachBondedAtom(u=>{u.number===8&&(s[u.index]=!0,Xi(c,u))}),qi(n,c))}),o.eachAtom(a=>{const l=Lr(2);r[a.index]<0&&(s[a.index]||(Xi(l,a),qi(n,l)))}))})}(i,e),function(t,n){const r=t.getAtomProxy();t.eachResidue(s=>{const o=s.getAromaticRings();if(o){const a=s.atomOffset;o.forEach(l=>{const c=Lr(3);l.forEach(u=>{r.index=u+a,Xi(c,r)}),qi(n,c)})}})}(i,e),function(t,n){const{charge:r,implicitH:s,idealGeometry:o}=op(t.data);t.eachAtom(a=>{const l=Lr(5),c=a.number;if(c===8)Xi(l,a),qi(n,l);else if(c===7){if(i4(a))Xi(l,a),qi(n,l);else if(r[a.index]<1){const u=a.bondCount+s[a.index],h=o[a.index];(h===4&&u<4||h===3&&u<3||h===2&&u<2)&&(Xi(l,a),qi(n,l))}}else c===16&&(a.resname!=="CYS"&&a.resname!=="MET"&&a.formalCharge!==-1||(Xi(l,a),qi(n,l)))})}(i,e),function(t,n){const{totalH:r}=op(t.data);t.eachAtom(s=>{const o=Lr(4),a=s.number;(i4(s)||r[s.index]>0&&(a===7||a===8||a===16))&&(Xi(o,s),qi(n,o))})}(i,e),function(t,n){const{totalH:r}=op(t.data);t.eachAtom(s=>{if(s.number===6&&r[s.index]>0&&(s.bondToElementCount(7)>0||s.bondToElementCount(8)>0||function(o){if(!o.isAromatic())return!1;const a=o.residueType.getRings();if(!a)return!1;let l=!1;return a.rings.forEach(c=>{l||c.some(u=>o.index-o.residueAtomOffset===u)&&(l=c.some(u=>{const h=o.residueType.atomTypeIdList[u],d=o.atomMap.get(h).number;return d===7||d===8}))}),l}(s))){const o=Lr(9);Xi(o,s),qi(n,o)}})}(i,e),function(t,n){t.eachAtom(r=>{let s=!1,o=!1;const a=Vp.includes(r.resname),l=P0.includes(r.resname);if(a||l?a?r.number===8?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(r.resname)&&r.isSidechain()||r.isBackbone())&&(s=!0,o=!0):r.number===16&&r.resname==="CYS"?(s=!0,o=!0):r.number===7&&r.resname==="HIS"&&r.isSidechain()&&(s=!0):l&&(r.number===8&&r.isBackbone()?(s=!0,o=!0):["N3","N4","N7"].includes(r.atomname)?s=!0:["O2","O4","O6"].includes(r.atomname)&&(s=!0,o=!0)):r.isHalogen()||r.number===8||r.number===16?(s=!0,o=!0):r.number===7&&(s=!0),s){const c=Lr(11);Xi(c,r),qi(n,c)}if(o){const c=Lr(10);Xi(c,r),qi(n,c)}})}(i,e),function(t,n){t.eachAtom(r=>{if(r.isTransitionMetal()||r.number===30||r.number===48){const s=Lr(12);Xi(s,r),qi(n,s)}else if(xue.includes(r.number)){const s=Lr(13);Xi(s,r),qi(n,s)}})}(i,e),function(t,n){t.eachAtom(r=>{const s=Lr(8);let o=!1;r.number===6?(o=!0,r.eachBondedAtom(a=>{const l=a.number;l!==6&&l!==1&&(o=!1)})):r.number===9&&(o=!0),o&&(Xi(s,r),qi(n,s))})}(i,e),function(t,n){t.eachAtom(r=>{if(wue.includes(r.number)){let s=!1;if(r.eachBondedAtom(o=>{Mue.includes(o.number)&&(s=!0)}),s){const o=Lr(7);Xi(o,r),qi(n,o)}}})}(i,e),function(t,n){t.eachAtom(r=>{if(Sue.includes(r.number)&&r.bondToElementCount(6)===1){const s=Lr(6);Xi(s,r),qi(n,s)}})}(i,e),pt&&tt.timeEnd("calculateFeatures"),e}function Cue(i,e=mi){const t=function(r){const{types:s,centers:o}=r;return{features:r,spatialHash:new b1(o),contactStore:new Jce,featureSet:new gr(s.length,!1)}}(Tue(i));pt&&tt.time("calculateContacts"),function(r,s,o={}){const a=he(o.maxIonicDist,mi.maxIonicDist),l=he(o.maxPiStackingDist,mi.maxPiStackingDist),c=he(o.maxPiStackingOffset,mi.maxPiStackingOffset),u=he(o.maxPiStackingAngle,mi.maxPiStackingAngle),h=he(o.maxCationPiDist,mi.maxCationPiDist),d=he(o.maxCationPiOffset,mi.maxCationPiOffset),f=he(o.masterModelIndex,mi.masterModelIndex),p=Math.max(a+2,l,h),_=l*l,v=h*h,{features:g,spatialHash:b,contactStore:m,featureSet:y}=s,{types:A,centers:w,atomSets:M}=g,{x:T,y:E,z:C}=w,N=A.length,P=r.atomStore.x,L=r.atomStore.y,R=r.atomStore.z,F=r.getAtomProxy(),V=r.getAtomProxy(),G=function(Z,le,re){const se=Z.length,$=le.length;for(let fe=0;fe<se;++fe){F.index=Z[fe];for(let xe=0;xe<$;++xe)if(V.index=le[xe],F.distanceTo(V)<=re)return!0}return!1},U=new me,z=new me,O=new me,D=new me,B=new me,W=new me,q=new me,j=function(Z,le){U.set(P[Z[0]],L[Z[0]],R[Z[0]]),z.set(P[Z[1]],L[Z[1]],R[Z[1]]),O.set(P[Z[2]],L[Z[2]],R[Z[2]]),D.subVectors(U,z),B.subVectors(U,O),le.crossVectors(D,B)},te=function(Z,le,re){return U.set(T[Z],E[Z],C[Z]),z.set(T[le],E[le],C[le]),U.sub(z).projectOnPlane(re).add(z).distanceTo(z)},ne=function(Z,le,re){y.setBits(Z,le),m.addContact(Z,le,re)};for(let Z=0;Z<N;++Z)b.eachWithin(T[Z],E[Z],C[Z],p,(le,re)=>{if(le<=Z||(F.index=M[Z][0],V.index=M[le][0],Bg(F,V,f)))return;const se=A[Z],$=A[le];if(mue(se,$))G(M[Z],M[le],a)&&ne(Z,le,1);else if(gue(se,$)){if(re<=_){j(M[Z],W),j(M[le],q);const fe=57.29578*W.angleTo(q);Math.min(te(Z,le,q),te(le,Z,W))<=c&&(fe<=u||fe>=180-u||fe<=u+90&&fe>=90-u)&&ne(Z,le,3)}}else if(vue(se,$)&&re<=v){const[fe,xe]=se===3?[Z,le]:[le,Z];j(M[fe],W),te(xe,fe,W)<=d&&ne(fe,xe,2)}})}(i,t,e),function(r,s,o={}){const a=he(o.maxHbondDist,mi.maxHbondDist),l=he(o.maxHbondSulfurDist,mi.maxHbondSulfurDist),c=Pi(he(o.maxHbondAccAngle,mi.maxHbondAccAngle)),u=Pi(he(o.maxHbondDonAngle,mi.maxHbondDonAngle)),h=Pi(he(o.maxHbondAccPlaneAngle,mi.maxHbondAccPlaneAngle)),d=Pi(he(o.maxHbondDonPlaneAngle,mi.maxHbondDonPlaneAngle)),f=he(o.masterModelIndex,mi.masterModelIndex),p=Math.max(a,l),_=a*a,{features:v,spatialHash:g,contactStore:b,featureSet:m}=s,{types:y,centers:A,atomSets:w}=v,{x:M,y:T,z:E}=A,C=y.length,{idealGeometry:N}=op(r.data),P=r.getAtomProxy(),L=r.getAtomProxy();for(let R=0;R<C;++R)g.eachWithin(M[R],T[R],E[R],p,(F,V)=>{if(F<=R)return;const G=y[R],U=y[F],z=yue(G,U);if(!z&&!_ue(G,U))return;const[O,D]=U===5?[R,F]:[F,R];if(P.index=w[O][0],L.index=w[D][0],L.index===P.index||Bg(P,L,f)||P.number!==16&&L.number!==16&&V>_||P.connectedTo(L))return;const B=Uy(P,L),W=e4.get(N[P.index])||Pi(120);if(B.some(le=>Math.abs(W-le)>u))return;if(N[P.index]===3){const le=t4(P,L);if(le!==void 0&&le>d)return}const q=Uy(L,P),j=e4.get(N[L.index])||Pi(120);if(q.some(le=>j-le>c))return;if(N[L.index]===3){const le=t4(L,P);if(le!==void 0&&le>h)return}m.setBits(O,D);const te=z?8:function(le,re){return le.isWater()&&re.isWater()}(ne=P,Z=L)?9:function(le,re){return le.isBackbone()&&re.isBackbone()}(ne,Z)?10:4;var ne,Z;b.addContact(O,D,te)})}(i,t,e),function(r,s,o={}){const a=he(o.maxMetalDist,mi.maxMetalDist),l=he(o.masterModelIndex,mi.masterModelIndex),{features:c,spatialHash:u,contactStore:h,featureSet:d}=s,{types:f,centers:p,atomSets:_}=c,{x:v,y:g,z:b}=p,m=f.length,y=r.getAtomProxy(),A=r.getAtomProxy();for(let w=0;w<m;++w)u.eachWithin(v[w],g[w],b[w],a,(M,T)=>{if(M<=w||(y.index=_[w][0],A.index=_[M][0],Bg(y,A,l)))return;const E=y.isMetal(),C=A.isMetal();if(!E&&!C)return;const[N,P]=E?[f[w],f[M]]:[f[M],f[w]];bue(N,P)&&(d.setBits(w,M),h.addContact(w,M,7))})}(i,t,e),function(r,s,o={}){const a=he(o.maxHydrophobicDist,mi.maxHydrophobicDist),l=he(o.masterModelIndex,mi.masterModelIndex),{features:c,spatialHash:u,contactStore:h,featureSet:d}=s,{types:f,centers:p,atomSets:_}=c,{x:v,y:g,z:b}=p,m=f.length,y=r.getAtomProxy(),A=r.getAtomProxy();for(let w=0;w<m;++w)u.eachWithin(v[w],g[w],b[w],a,(M,T)=>{var E,C;M<=w||(y.index=_[w][0],A.index=_[M][0],Bg(y,A,l)||y.number===9&&A.number===9||y.connectedTo(A)||(E=f[w],C=f[M],E===8&&C===8&&(d.setBits(w,M),h.addContact(w,M,6))))})}(i,t,e),function(r,s,o={}){const a=he(o.maxHalogenBondDist,mi.maxHalogenBondDist),l=Pi(he(o.maxHalogenBondAngle,mi.maxHalogenBondAngle)),c=he(o.masterModelIndex,mi.masterModelIndex),{features:u,spatialHash:h,contactStore:d,featureSet:f}=s,{types:p,centers:_,atomSets:v}=u,{x:g,y:b,z:m}=_,y=p.length,A=r.getAtomProxy(),w=r.getAtomProxy();for(let M=0;M<y;++M)h.eachWithin(g[M],b[M],m[M],a,(T,E)=>{if(T<=M||(A.index=v[M][0],w.index=v[T][0],Bg(A,w,c))||(C=p[M],N=p[T],!(C===7&&N===6||C===6&&N===7)))return;var C,N;const[P,L]=p[M]===6?[A,w]:[w,A],R=Uy(P,L);if(R.length!==1||Aue-R[0]>l)return;const F=Uy(L,P);F.length!==0&&(F.some(V=>Eue-V>l)||(f.setBits(M,T),d.addContact(M,T,5)))})}(i,t,e);const n=function(r){const{index1:s,index2:o,count:a}=r.contactStore,l=RV({nodeArray1:s,nodeArray2:o,edgeCount:a,nodeCount:r.featureSet.length}),c=new gr(r.contactStore.count,!0);return Object.assign({adjacencyList:l,contactSet:c},r)}(t);return function(r,s,o={}){pt&&tt.time("refineLineOfSight");const a=he(o.lineOfSightDistFactor,mi.lineOfSightDistFactor),l=he(o.masterModelIndex,mi.masterModelIndex),c=r.spatialHash,{contactSet:u,contactStore:h,features:d}=s,{index1:f,index2:p}=h,{centers:_,atomSets:v}=d,{x:g,y:b,z:m}=_,y=r.getAtomProxy(),A=r.getAtomProxy(),w=r.getAtomProxy(),M=new me,T=new me,E=3*a,C=a*a;u.forEach(N=>{M.set(g[f[N]],b[f[N]],m[f[N]]),T.set(g[p[N]],b[p[N]],m[p[N]]);const P=(M.x+T.x)/2,L=(M.y+T.y)/2,R=(M.z+T.z)/2,F=v[f[N]],V=v[p[N]];y.index=F[0],A.index=V[0],c.eachWithin(P,L,R,E,(G,U)=>{w.index=G,w.number!==1&&w.vdw*w.vdw*C>U&&!r4(y,w,l)&&!r4(A,w,l)&&!F.includes(G)&&!V.includes(G)&&M.distanceToSquared(w)>1&&T.distanceToSquared(w)>1&&(u.clear(N),pt&&tt.log("removing",y.qualifiedName(),A.qualifiedName(),"because",w.qualifiedName()))})}),pt&&tt.timeEnd("refineLineOfSight")}(i,n,e),function(r,s){const{contactSet:o,contactStore:a,features:l}=s,{type:c,index1:u,index2:h}=a,{atomSets:d}=l,f=r.getAtomProxy(),p=r.getAtomProxy(),_={},v=function(g,b,m){const[y,A]=_[m]||[1/0,-1];g<y?(A!==-1&&o.clear(A),_[m]=[g,b]):o.clear(b)};o.forEach(g=>{if(c[g]!==6)return;f.index=d[u[g]][0],p.index=d[h[g]][0];const b=f.distanceTo(p);v(b,g,`${f.index}|${p.residueIndex}`),v(b,g,`${p.index}|${f.residueIndex}`)})}(i,n),e.refineSaltBridges&&function(r,s){const{contactSet:o,contactStore:a,features:l}=s,{type:c,index1:u,index2:h}=a,{atomSets:d}=l,f={},p=function(_,v){f[_]||(f[_]=[]),f[_].push(v)};o.forEach(_=>{c[_]===1&&(d[u[_]].forEach(v=>p(v,_)),d[h[_]].forEach(v=>p(v,_)))}),o.forEach(_=>{if(!function(m){return m===4||m===9||m===10}(c[_]))return;const v=f[d[u[_]][0]],g=f[d[h[_]][0]];if(!v||!g)return;const b=v.length;for(let m=0;m<b;++m)if(g.includes(v[m]))return void o.clear(_)})}(0,n),function(r,s){const{contactSet:o,contactStore:a,features:l}=s,{type:c,index1:u,index2:h}=a,{atomSets:d}=l,f={},p=function(_,v){f[_]||(f[_]=[]),f[_].push(v)};o.forEach(_=>{c[_]===3&&(d[u[_]].forEach(v=>p(v,_)),d[h[_]].forEach(v=>p(v,_)))}),o.forEach(_=>{if(c[_]!==6&&c[_]!==2)return;const v=f[d[u[_]][0]],g=f[d[h[_]][0]];if(!v||!g)return;const b=v.length;for(let m=0;m<b;++m)if(g.includes(v[m]))return void o.clear(_)})}(0,n),function(r,s){const{contactSet:o,contactStore:a,features:l}=s,{type:c,index1:u,index2:h}=a,{atomSets:d}=l,f={},p=function(_,v){f[_]||(f[_]=[]),f[_].push(v)};o.forEach(_=>{c[_]===1&&(d[u[_]].forEach(v=>p(v,_)),d[h[_]].forEach(v=>p(v,_)))}),o.forEach(_=>{if(c[_]!==7)return;const v=f[d[u[_]][0]],g=f[d[h[_]][0]];if(!v||!g)return;const b=v.length;for(let m=0;m<b;++m)if(g.includes(v[m]))return void o.clear(v[m])})}(0,n),pt&&tt.timeEnd("calculateContacts"),n}function Pue(i){switch(i){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}const Rue={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},Xl=new $t;function Iue(i,e,t){const n=Io(t,Rue),r=[];n.hydrogenBond&&r.push(4),n.hydrophobic&&r.push(6),n.halogenBond&&r.push(5),n.ionicInteraction&&r.push(1),n.metalCoordination&&r.push(7),n.cationPi&&r.push(2),n.piStacking&&r.push(3),n.weakHydrogenBond&&r.push(8),n.waterHydrogenBond&&r.push(9),n.backboneHydrogenBond&&r.push(10);const{features:s,contactSet:o,contactStore:a}=i,{centers:l,atomSets:c}=s,{x:u,y:h,z:d}=l,{index1:f,index2:p,type:_}=a,v=[],g=[],b=[],m=[],y=[];let A;return n.filterSele&&(A=Array.isArray(n.filterSele)?n.filterSele.map(w=>e.getAtomSet(new ii(w))):e.getAtomSet(new ii(n.filterSele))),o.forEach(w=>{const M=_[w];if(!r.includes(M))return;if(A){const C=c[f[w]][0],N=c[p[w]][0];if(Array.isArray(A)){if(!(A[0].isSet(C)&&A[1].isSet(N)||A[1].isSet(C)&&A[0].isSet(N)))return}else if(!A.isSet(C)&&!A.isSet(N))return}const T=f[w],E=p[w];v.push(u[T],h[T],d[T]),g.push(u[E],h[E],d[E]),b.push(...function(C){switch(C){case 4:case 9:case 10:return Xl.setHex(2851770).toArray();case 6:return Xl.setHex(8421504).toArray();case 5:return Xl.setHex(4259775).toArray();case 1:return Xl.setHex(15779860).toArray();case 7:return Xl.setHex(9191577).toArray();case 2:return Xl.setHex(16744448).toArray();case 3:return Xl.setHex(9220966).toArray();case 8:return Xl.setHex(12967404).toArray();default:return Xl.setHex(13421772).toArray()}}(M)),m.push(n.radius),y.push(w)}),{position1:new Float32Array(v),position2:new Float32Array(g),color:new Float32Array(b),color2:new Float32Array(b),radius:new Float32Array(m),picking:new Due(y,i,e)}}class Cl{constructor(e){this.array=e}get type(){return""}get data(){return{}}getIndex(e){return this.array?this.array[e]:e}getObject(e){return{}}_applyTransformations(e,t,n){return t&&e.applyMatrix4(t.matrix),n&&e.applyMatrix4(n.matrix),e}_getPosition(e){return new me}getPosition(e,t,n){return this._applyTransformations(this._getPosition(e),t,n)}}class Yo extends Cl{constructor(e){super(),this.shape=e}get primitive(){}get data(){return this.shape}get type(){return this.primitive.type}getObject(e){return this.primitive.objectFromShape(this.shape,this.getIndex(e))}_getPosition(e){return this.primitive.positionFromShape(this.shape,this.getIndex(e))}}class Hd extends Cl{constructor(e,t){super(e),this.structure=t}get type(){return"atom"}get data(){return this.structure}getObject(e){return this.structure.getAtomProxy(this.getIndex(e))}_getPosition(e){return new me().copy(this.getObject(e))}}class Lue extends Cl{constructor(e){super(),this.axes=e}get type(){return"axes"}get data(){return this.axes}getObject(){return{axes:this.axes}}_getPosition(){return this.axes.center.clone()}}class zV extends Cl{constructor(e,t,n){super(e),this.structure=t,this.bondStore=n||t.bondStore}get type(){return"bond"}get data(){return this.structure}getObject(e){const t=this.structure.getBondProxy(this.getIndex(e));return t.bondStore=this.bondStore,t}_getPosition(e){const t=this.getObject(e);return new me().copy(t.atom1).add(t.atom2).multiplyScalar(.5)}}class Due extends Cl{constructor(e,t,n){super(e),this.contacts=t,this.structure=n}get type(){return"contact"}get data(){return this.contacts}getObject(e){const t=this.getIndex(e),{features:n,contactStore:r}=this.contacts,{centers:s,atomSets:o}=n,{x:a,y:l,z:c}=s,{index1:u,index2:h,type:d}=r,f=u[t],p=h[t];return{center1:new me(a[f],l[f],c[f]),center2:new me(a[p],l[p],c[p]),atom1:this.structure.getAtomProxy(o[f][0]),atom2:this.structure.getAtomProxy(o[p][0]),type:Pue(d[t])}}_getPosition(e){const{center1:t,center2:n}=this.getObject(e);return new me().addVectors(t,n).multiplyScalar(.5)}}class Nue extends Cl{constructor(e,t,n){super(e),this.validation=t,this.structure=n}get type(){return"clash"}get data(){return this.validation}getObject(e){const t=this.validation,n=this.getIndex(e);return{validation:t,index:n,clash:t.clashArray[n]}}_getAtomProxyFromSele(e){const t=new ii(e),n=this.structure.getAtomIndices(t)[0];return this.structure.getAtomProxy(n)}_getPosition(e){const t=this.getObject(e).clash,n=this._getAtomProxyFromSele(t.sele1),r=this._getAtomProxyFromSele(t.sele2);return new me().copy(n).add(r).multiplyScalar(.5)}}class Fue extends zV{get type(){return"distance"}}class kue extends Cl{get type(){return"ignore"}}class Uue extends Yo{constructor(e,t){super(e),this.mesh=t}get type(){return"mesh"}getObject(){const e=this.mesh;return{shape:this.shape,name:e.name,serial:e.serial}}_getPosition(){return this.__position||(this.__position=IC(this.mesh.position)),this.__position}}class Oue extends Cl{constructor(e,t){super(e),this.surface=t}get type(){return"surface"}get data(){return this.surface}getObject(e){return{surface:this.surface,index:this.getIndex(e)}}_getPosition(){return this.surface.center.clone()}}class Bue extends Cl{constructor(e,t){super(),this.unitcell=e,this.structure=t}get type(){return"unitcell"}get data(){return this.unitcell}getObject(){return{unitcell:this.unitcell,structure:this.structure}}_getPosition(){return this.unitcell.getCenter(this.structure)}}class GV extends Cl{constructor(e,t){super(e),this.volume=t}get type(){return"volume"}get data(){return this.volume}getObject(e){const t=this.volume,n=this.getIndex(e);return{volume:t,index:n,value:t.data[n]}}_getPosition(e){const t=this.volume.position,n=this.getIndex(e);return new me(t[3*n],t[3*n+1],t[3*n+2])}}class zue extends GV{get type(){return"slice"}}function VV(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function HV(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function x3(i,e,t,n,r){var s,o,a,l,c,u,h,d=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]],f=0,p=!1,_=!1,v=!1,g=!1,b=-1,m=e*t*n,y=e,A=e*t,w=new Int32Array(12),M=[],T=[],E=[],C=[],N=VV(),P=HV();function L(D,B,W){return D+(B-D)*W}function R(D,B,W){return A*(W=(W+h)%n)+y*(B=(B+u)%t)+(D=(D+c)%e)}function F(D,B,W,q,j,te,ne){var Z=3*D;if(o[Z]<0){var le=(f-te)/(ne-te),re=s,se=3*a;if(M[se]=W+le,M[se+1]=q,M[se+2]=j,!p){var $=3*D;T[se]=b*L(re[$],re[$+3],le),T[se+1]=b*L(re[$+1],re[$+4],le),T[se+2]=b*L(re[$+2],re[$+5],le)}r&&(C[a]=r[D+Math.round(le)]),o[Z]=a,w[B]=a,a+=1}else w[B]=o[Z]}function V(D,B,W,q,j,te,ne){var Z=3*D+1;if(o[Z]<0){var le=(f-te)/(ne-te),re=s,se=3*a;if(M[se]=W,M[se+1]=q+le,M[se+2]=j,!p){var $=3*D,fe=$+3*y;T[se]=b*L(re[$],re[fe],le),T[se+1]=b*L(re[$+1],re[fe+1],le),T[se+2]=b*L(re[$+2],re[fe+2],le)}r&&(C[a]=r[D+Math.round(le)*y]),o[Z]=a,w[B]=a,a+=1}else w[B]=o[Z]}function G(D,B,W,q,j,te,ne){var Z=3*D+2;if(o[Z]<0){var le=(f-te)/(ne-te),re=s,se=3*a;if(M[se]=W,M[se+1]=q,M[se+2]=j+le,!p){var $=3*D,fe=$+3*A;T[se]=b*L(re[$],re[fe],le),T[se+1]=b*L(re[$+1],re[fe+1],le),T[se+2]=b*L(re[$+2],re[fe+2],le)}r&&(C[a]=r[D+Math.round(le)*A]),o[Z]=a,w[B]=a,a+=1}else w[B]=o[Z]}function U(D){var B=3*D;s[B]===0&&(s[B]=i[(D-1+m)%m]-i[(D+1)%m],s[B+1]=i[(D-y+m)%m]-i[(D+y)%m],s[B+2]=i[(D-A+m)%m]-i[(D+A)%m])}function z(D,B,W,q,j){var te,ne,Z,le,re,se,$;v?(q=R(D,B,W),te=R(D+1,B,W),ne=R(D,B+1,W),Z=R(D,B,W+1),le=R(D+1,B+1,W),re=R(D+1,B,W+1),se=R(D,B+1,W+1),$=R(D+1,B+1,W+1)):(te=q+1,le=(ne=q+y)+1,re=(Z=q+A)+1,$=(se=ne+A)+1);var fe=0,xe=i[q],Ie=i[te],ge=i[ne],Oe=i[le],Me=i[Z],Y=i[re],Q=i[se],de=i[$];xe<f&&(fe|=1),Ie<f&&(fe|=2),ge<f&&(fe|=8),Oe<f&&(fe|=4),Me<f&&(fe|=16),Y<f&&(fe|=32),Q<f&&(fe|=128),de<f&&(fe|=64);var Le=N[fe];if(Le===0)return 0;var ie=D+1,K=B+1,be=W+1;1&Le&&(p||(U(q),U(te)),F(q,0,D,B,W,xe,Ie)),2&Le&&(p||(U(te),U(le)),V(te,1,ie,B,W,Ie,Oe)),4&Le&&(p||(U(ne),U(le)),F(ne,2,D,K,W,ge,Oe)),8&Le&&(p||(U(q),U(ne)),V(q,3,D,B,W,xe,ge)),16&Le&&(p||(U(Z),U(re)),F(Z,4,D,B,be,Me,Y)),32&Le&&(p||(U(re),U($)),V(re,5,ie,B,be,Y,de)),64&Le&&(p||(U(se),U($)),F(se,6,D,K,be,Q,de)),128&Le&&(p||(U(Z),U(se)),V(Z,7,D,B,be,Me,Q)),256&Le&&(p||(U(q),U(Z)),G(q,8,D,B,W,xe,Me)),512&Le&&(p||(U(te),U(re)),G(te,9,ie,B,W,Ie,Y)),1024&Le&&(p||(U(le),U($)),G(le,10,ie,K,W,Oe,de)),2048&Le&&(p||(U(ne),U(se)),G(ne,11,D,K,W,ge,Q));for(var Ue,ve,Ne,$e=fe<<4,Ee=0;P[$e+Ee]!==-1;)Ue=P[$e+Ee],ve=P[$e+Ee+1],Ne=P[$e+Ee+2],_?(d[Ue][ve]&j&&(E[l++]=w[Ue],E[l++]=w[ve]),d[ve][Ne]&j&&(E[l++]=w[ve],E[l++]=w[Ne]),d[Ue][Ne]&j&&(E[l++]=w[Ue],E[l++]=w[Ne])):(E[l++]=w[g?Ue:ve],E[l++]=w[g?ve:Ue],E[l++]=w[Ne]),Ee+=3}function O(D,B,W,q,j,te){let ne,Z,le,re,se,$,fe,xe,Ie,ge,Oe,Me,Y;if(D=D!==void 0?D:0,B=B!==void 0?B:0,W=W!==void 0?W:0,q=q!==void 0?q:e-1,j=j!==void 0?j:t-1,te=te!==void 0?te:n-1,v||(p?(D=Math.max(0,D),B=Math.max(0,B),W=Math.max(0,W),q=Math.min(e-1,q),j=Math.min(t-1,j),te=Math.min(n-1,te)):(D=Math.max(1,D),B=Math.max(1,B),W=Math.max(1,W),q=Math.min(e-2,q),j=Math.min(t-2,j),te=Math.min(n-2,te))),v)for(xe=D-2,Ie=B-2,ge=W-2,Oe=q+2,Me=j+2,Y=te+2,se=ge;se<Y;++se)for(re=Ie;re<Me;++re)for(le=xe;le<Oe;++le)Z=3*R(le,re,se),o[Z]=-1,o[Z+1]=-1,o[Z+2]=-1;else for(xe=Math.max(0,D-2),Ie=Math.max(0,B-2),ge=Math.max(0,W-2),Oe=Math.min(e,q+2),Me=Math.min(t,j+2),Y=Math.min(n,te+2),se=ge;se<Y;++se)for(fe=A*se,re=Ie;re<Me;++re)for($=fe+y*re,le=xe;le<Oe;++le)ne=3*($+le),o[ne]=-1,o[ne+1]=-1,o[ne+2]=-1;if(!v){var Q,de=D,Le=B,ie=W,K=q,be=j,Ue=te;for(Q=!1,se=W;se<te;++se){for(re=B;re<j;++re){for(le=D;le<q;++le)if(ne=e*t*se+e*re+le,i[ne]>=f){ie=se,Q=!0;break}if(Q)break}if(Q)break}for(Q=!1,re=B;re<j;++re){for(se=ie;se<te;++se){for(le=D;le<q;++le)if(ne=e*t*se+e*re+le,i[ne]>=f){Le=re,Q=!0;break}if(Q)break}if(Q)break}for(Q=!1,le=D;le<q;++le){for(re=Le;re<j;++re){for(se=ie;se<te;++se)if(ne=e*t*se+e*re+le,i[ne]>=f){de=le,Q=!0;break}if(Q)break}if(Q)break}for(Q=!1,se=te;se>=W;--se){for(re=j;re>=B;--re){for(le=q;le>=D;--le)if(ne=e*t*se+e*re+le,i[ne]>=f){Ue=se,Q=!0;break}if(Q)break}if(Q)break}for(Q=!1,re=j;re>=B;--re){for(se=Ue;se>=W;--se){for(le=q;le>=D;--le)if(ne=e*t*se+e*re+le,i[ne]>=f){be=re,Q=!0;break}if(Q)break}if(Q)break}for(Q=!1,le=q;le>=D;--le){for(re=be;re>=B;--re){for(se=Ue;se>=W;--se)if(ne=e*t*se+e*re+le,i[ne]>=f){K=le,Q=!0;break}if(Q)break}if(Q)break}p?(D=Math.max(0,de-1),B=Math.max(0,Le-1),W=Math.max(0,ie-1),q=Math.min(e-1,K+1),j=Math.min(t-1,be+1),te=Math.min(n-1,Ue+1)):(D=Math.max(1,de-1),B=Math.max(1,Le-1),W=Math.max(1,ie-1),q=Math.min(e-2,K+1),j=Math.min(t-2,be+1),te=Math.min(n-2,Ue+1))}var ve=15;for(se=W;se<te;++se,ve&=-5)for(fe=A*se,ve|=2,re=B;re<j;++re,ve&=-3)for($=fe+y*re,ve|=1,le=D;le<q;++le,ve&=-2)ne=$+le,z(le,re,se,ne,ve)}this.triangulate=function(D,B,W,q,j){g=(f=D)<0,_=q,v=j,(p=B||_)||(b=f>0?-1:1,s||(s=new Float32Array(3*m)));var te=3*m;if(o&&o.length===te||(o=new Int32Array(te)),a=0,l=0,W!==void 0){var ne=W[0].map(Math.round),Z=W[1].map(Math.round);c=e*Math.ceil(Math.abs(ne[0])/e),u=t*Math.ceil(Math.abs(ne[1])/t),h=n*Math.ceil(Math.abs(ne[2])/n),O(ne[0],ne[1],ne[2],Z[0],Z[1],Z[2])}else c=u=h=0,O();return M.length=3*a,p||(T.length=3*a),E.length=l,r&&(C.length=a),{position:new Float32Array(M),normal:p?void 0:new Float32Array(T),index:El(E,M.length/3),atomindex:r?new Int32Array(C):void 0,contour:_}}}qo.add("arrow",class extends Yo{get primitive(){return QS}}),qo.add("box",class extends Yo{get primitive(){return Id}}),qo.add("cone",class extends Yo{get primitive(){return JS}}),qo.add("cylinder",class extends Yo{get primitive(){return Ld}}),qo.add("ellipsoid",class extends Yo{get primitive(){return ym}}),qo.add("octahedron",class extends Yo{get primitive(){return KS}}),qo.add("sphere",class extends Yo{get primitive(){return _m}}),qo.add("tetrahedron",class extends Yo{get primitive(){return ZS}}),qo.add("torus",class extends Yo{get primitive(){return e2}}),qo.add("point",class extends Yo{get primitive(){return y1}}),qo.add("wideline",class extends Yo{get primitive(){return x1}}),Object.assign(x3,{__deps:[VV,HV,El]});class On{constructor(e,t){this.cols=e,this.rows=t,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)}copyTo(e){e.data.set(this.data)}}function Da(i,e){let t=0,n=0;const r=e.rows,s=e.cols;let o=0,a=0,l=0;const c=e.data,u=i.data;for(;t<r;a+=1,o+=s,t++)for(l=a,n=0;n<s;l+=r,n++)u[l]=c[o+n]}function zx(i,e,t){let n=0,r=0,s=0,o=0,a=0,l=0,c=0;const u=e.cols,h=e.rows,d=t.rows,f=e.data,p=t.data,_=i.data;let v=0;for(;n<h;o+=u,n++)for(l=0,r=0;r<d;c++,r++){for(a=o,v=0,s=0;s<u;a++,l++,s++)v+=f[a]*p[l];_[c]=v}}function _A(i,e,t){const n=i.data,r=e.data,s=t.data,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],d=r[6],f=r[7],p=r[8],_=s[0],v=s[1],g=s[2],b=s[3],m=s[4],y=s[5],A=s[6],w=s[7],M=s[8];n[0]=o*_+a*b+l*A,n[1]=o*v+a*m+l*w,n[2]=o*g+a*y+l*M,n[3]=c*_+u*b+h*A,n[4]=c*v+u*m+h*w,n[5]=c*g+u*y+h*M,n[6]=d*_+f*b+p*A,n[7]=d*v+f*m+p*w,n[8]=d*g+f*y+p*M}function NC(i){const e=i.rows,t=i.cols,n=i.data,r=new Array(t);for(let s=0;s<t;++s)r[s]=0;for(let s=0,o=0;s<e;++s)for(let a=0;a<t;++a,++o)r[a]+=n[o];for(let s=0;s<t;++s)r[s]/=e;return r}function FC(i,e){const t=i.rows,n=i.cols,r=i.data;for(let s=0,o=0;s<t;++s)for(let a=0;a<n;++a,++o)r[o]-=e[a]}function yA(i,e,t,n){n=i[e],i[e]=i[t],i[t]=n}function Gue(i,e){return(i=Math.abs(i))>(e=Math.abs(e))?(e/=i,i*Math.sqrt(1+e*e)):e>0?(i/=e,e*Math.sqrt(1+i*i)):0}const Vue=1192092896e-16,Hue=1e-37;function $V(i,e,t,n){let r=0,s=0;const o=i.rows,a=i.cols;let l=o,c=a;l<c&&(r=1,s=l,l=c,c=s);const u=new On(l,l),h=new On(1,c),d=new On(c,c);if(r===0)Da(u,i);else{for(s=0;s<a*o;s++)u.data[s]=i.data[s];for(;s<c*l;s++)u.data[s]=0}if(function(f,p,_,v,g,b,m,y){const A=2*Vue,w=Hue;let M=0,T=0,E=0,C=0;const N=Math.max(b,30);let P=0,L=0,R=0,F=0,V=0,G=0,U=0,z=0,O=0,D=0,B=0,W=0,q=0,j=0,te=0,ne=0,Z=0,le=4660,re=0,se=0,$=0;const fe=new Float64Array(m<<3);for(;M<m;M++){for(E=0,B=0;E<b;E++)z=f[M*p+E],B+=z*z;if(fe[M]=B,v){for(E=0;E<m;E++)v[M*g+E]=0;v[M*g+M]=1}}for(;C<N;C++){for(V=0,M=0;M<m-1;M++)for(T=M+1;T<m;T++){for(P=M*p|0,L=T*p|0,te=fe[M],ne=0,Z=fe[T],E=2,ne+=f[P]*f[L],ne+=f[P+1]*f[L+1];E<b;E++)ne+=f[P+E]*f[L+E];if(!(Math.abs(ne)<=A*Math.sqrt(te*Z))){for(ne*=2,W=te-Z,q=Gue(ne,W),W<0?(j=.5*(q-W),U=Math.sqrt(j/q),G=ne/(q*U*2)):(G=Math.sqrt((q+W)/(2*q)),U=ne/(q*G*2)),te=0,Z=0,E=2,O=G*f[P]+U*f[L],D=-U*f[P]+G*f[L],f[P]=O,f[L]=D,te+=O*O,Z+=D*D,O=G*f[P+1]+U*f[L+1],D=-U*f[P+1]+G*f[L+1],f[P+1]=O,f[L+1]=D,te+=O*O,Z+=D*D;E<b;E++)O=G*f[P+E]+U*f[L+E],D=-U*f[P+E]+G*f[L+E],f[P+E]=O,f[L+E]=D,te+=O*O,Z+=D*D;if(fe[M]=te,fe[T]=Z,V=1,v)for(R=M*g|0,F=T*g|0,E=2,O=G*v[R]+U*v[F],D=-U*v[R]+G*v[F],v[R]=O,v[F]=D,O=G*v[R+1]+U*v[F+1],D=-U*v[R+1]+G*v[F+1],v[R+1]=O,v[F+1]=D;E<m;E++)O=G*v[R+E]+U*v[F+E],D=-U*v[R+E]+G*v[F+E],v[R+E]=O,v[F+E]=D}}if(V===0)break}for(M=0;M<m;M++){for(E=0,B=0;E<b;E++)z=f[M*p+E],B+=z*z;fe[M]=Math.sqrt(B)}for(M=0;M<m-1;M++){for(T=M,E=M+1;E<m;E++)fe[T]<fe[E]&&(T=E);if(M!==T&&(yA(fe,M,T,B),v)){for(E=0;E<b;E++)yA(f,M*p+E,T*p+E,z);for(E=0;E<m;E++)yA(v,M*g+E,T*g+E,z)}}for(M=0;M<m;M++)_[M]=fe[M];if(v)for(M=0;M<y;M++){for(B=M<m?fe[M]:0;B<=w;){for(se=1/b,E=0;E<b;E++)le=214013*le+2531011,re=256&le>>16?se:-se,f[M*p+E]=re;for(C=0;C<2;C++)for(T=0;T<M;T++){for(B=0,E=0;E<b;E++)B+=f[M*p+E]*f[T*p+E];for($=0,E=0;E<b;E++)z=f[M*p+E]-B*f[T*p+E],f[M*p+E]=z,$+=Math.abs(z);for($=$?1/$:0,E=0;E<b;E++)f[M*p+E]*=$}for(B=0,E=0;E<b;E++)z=f[M*p+E],B+=z*z;B=Math.sqrt(B)}for(U=1/B,E=0;E<b;E++)f[M*p+E]*=U}}(u.data,l,h.data,d.data,c,l,c,l),e){for(s=0;s<c;s++)e.data[s]=h.data[s];for(;s<a;s++)e.data[s]=0}r===0?(t&&Da(t,u),n&&Da(n,d)):(t&&Da(t,d),n&&Da(n,u))}function o0(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function Hp(i,e,t,n,r,s,o,a,l,c,u,h,d,f,p,_,v){i[0]=e,i[4]=t,i[8]=n,i[12]=r,i[1]=s,i[5]=o,i[9]=a,i[13]=l,i[2]=c,i[6]=u,i[10]=h,i[14]=d,i[3]=f,i[7]=p,i[11]=_,i[15]=v}function Gx(i,e,t){const n=e[0],r=e[4],s=e[8],o=e[12],a=e[1],l=e[5],c=e[9],u=e[13],h=e[2],d=e[6],f=e[10],p=e[14],_=e[3],v=e[7],g=e[11],b=e[15],m=t[0],y=t[4],A=t[8],w=t[12],M=t[1],T=t[5],E=t[9],C=t[13],N=t[2],P=t[6],L=t[10],R=t[14],F=t[3],V=t[7],G=t[11],U=t[15];i[0]=n*m+r*M+s*N+o*F,i[4]=n*y+r*T+s*P+o*V,i[8]=n*A+r*E+s*L+o*G,i[12]=n*w+r*C+s*R+o*U,i[1]=a*m+l*M+c*N+u*F,i[5]=a*y+l*T+c*P+u*V,i[9]=a*A+l*E+c*L+u*G,i[13]=a*w+l*C+c*R+u*U,i[2]=h*m+d*M+f*N+p*F,i[6]=h*y+d*T+f*P+p*V,i[10]=h*A+d*E+f*L+p*G,i[14]=h*w+d*C+f*R+p*U,i[3]=_*m+v*M+g*N+b*F,i[7]=_*y+v*T+g*P+b*V,i[11]=_*A+v*E+g*L+b*G,i[15]=_*w+v*C+g*R+b*U}function kC(i,e,t,n){Hp(i,e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1)}function UC(i,e,t,n){Hp(i,1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1)}function OC(i,e){const t=Math.cos(e),n=Math.sin(e);Hp(i,t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1)}function WV(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function b3(i,e){const t=nn([e[0],e[1],e[2]]),n=nn([e[4],e[5],e[6]]),r=nn([e[8],e[9],e[10]]),s=nn();ro(s,n,r),i[0]=s[0],i[1]=s[1],i[2]=s[2],ro(s,r,t),i[3]=s[0],i[4]=s[1],i[5]=s[2],ro(s,t,n),i[6]=s[0],i[7]=s[1],i[8]=s[2]}function S3(i,e,t,n){t=t||1,n=n||!0;const r=i.length/3,s=e.length/3;let o;n&&(o=new Float32Array(3*r));const a=new Float32Array(3*r);let l;const c=new Array(20);for(l=0;l<20;++l)c[l]=new Uint32Array(r);for(l=0;l<r;++l)c[0][l]=0;let u,h,d;for(l=0;l<s;++l){var f=3*l,p=3*l+1,_=3*l+2;for(d=!0,u=0,h=c[0][e[f]];u<h;++u)if(e[p]===c[u+1][e[f]]){d=!1;break}for(d&&(c[0][e[f]]++,c[c[0][e[f]]][e[f]]=e[p]),d=!0,u=0,h=c[0][e[f]];u<h;++u)if(e[_]===c[u+1][e[f]]){d=!1;break}for(d&&(c[0][e[f]]++,c[c[0][e[f]]][e[f]]=e[_]),d=!0,u=0,h=c[0][e[p]];u<h;++u)if(e[f]===c[u+1][e[p]]){d=!1;break}for(d&&(c[0][e[p]]++,c[c[0][e[p]]][e[p]]=e[f]),d=!0,u=0,h=c[0][e[p]];u<h;++u)if(e[_]===c[u+1][e[p]]){d=!1;break}for(d&&(c[0][e[p]]++,c[c[0][e[p]]][e[p]]=e[_]),d=!0,u=0;u<c[0][e[_]];++u)if(e[f]===c[u+1][e[_]]){d=!1;break}for(d&&(c[0][e[_]]++,c[c[0][e[_]]][e[_]]=e[f]),d=!0,u=0,h=c[0][e[_]];u<h;++u)if(e[p]===c[u+1][e[_]]){d=!1;break}d&&(c[0][e[_]]++,c[c[0][e[_]]][e[_]]=e[p])}for(var v,g,b,m,y,A=.5,w=.75/4.5,M=0;M<t;++M){for(l=0;l<r;++l)if(v=3*l,(b=c[0][l])<3)a[v]=i[v],a[v+1]=i[v+1],a[v+2]=i[v+2];else if(b===3||b===4){for(a[v]=0,a[v+1]=0,a[v+2]=0,u=0;u<b;++u)g=3*c[u+1][l],a[v]+=i[g],a[v+1]+=i[g+1],a[v+2]+=i[g+2];a[v]+=A*i[v],a[v+1]+=A*i[v+1],a[v+2]+=A*i[v+2],y=A+b,a[v]/=y,a[v+1]/=y,a[v+2]/=y}else{for(a[v]=0,a[v+1]=0,a[v+2]=0,u=0;u<b;++u)g=3*c[u+1][l],a[v]+=i[g],a[v+1]+=i[g+1],a[v+2]+=i[g+2];a[v]+=1*i[v],a[v+1]+=1*i[v+1],a[v+2]+=1*i[v+2],m=1+b,a[v]/=m,a[v+1]/=m,a[v+2]/=m}if(i.set(a),n){S1(i,e,o);var T=3*r;for(v=0;v<T;v+=3)i[v]+=-1*w*o[v],i[v+1]+=-1*w*o[v+1],i[v+2]+=-1*w*o[v+2]}}}function S1(i,e,t){var n,r;if(t===void 0)t=new Float32Array(i.length);else for(n=0,r=t.length;n<r;n++)t[n]=0;var s=new Float32Array(3),o=new Float32Array(3),a=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3);if(e)for(n=0,r=e.length;n<r;n+=3){var u=3*e[n],h=3*e[n+1],d=3*e[n+2];Cs(s,i,u),Cs(o,i,h),Cs(a,i,d),_i(l,a,o),_i(c,s,o),ro(l,l,c),t[u]+=l[0],t[u+1]+=l[1],t[u+2]+=l[2],t[h]+=l[0],t[h+1]+=l[1],t[h+2]+=l[2],t[d]+=l[0],t[d+1]+=l[1],t[d+2]+=l[2]}else for(n=0,r=i.length;n<r;n+=9)Cs(s,i,n),Cs(o,i,n+3),Cs(a,i,n+6),_i(l,a,o),_i(c,s,o),ro(l,l,c),t[n]=l[0],t[n+1]=l[1],t[n+2]=l[2],t[n+3]=l[0],t[n+4]=l[1],t[n+5]=l[2],t[n+6]=l[0],t[n+7]=l[1],t[n+8]=l[2];return EV(t),t}function jV(i){for(var e={},t=0,n=i.length;t<n;++t)e[i[t]]=!0;return e}function w1(i,e,t,n,r){var s=1/n*3;CV(i,i,r+(s+=t)),Bx(e,e,r+s),$n(i,i,n),LC(i,i),Tp(i,i,n),$n(e,e,n),r0(e,e),Tp(e,e,n);var o=new Float32Array(3);_i(o,e,i),$n(o,o,n),r0(o,o),Bx(o,o,1);var a=256*Math.pow(10,6),l=o[0]*o[1]*o[2]*3;a<=l&&($n(i,i,n*=Math.pow(a/l,1/3)),LC(i,i),Tp(i,i,n),$n(e,e,n),r0(e,e),Tp(e,e,n),_i(o,e,i),$n(o,o,n),r0(o,o),Bx(o,o,1));var c=new Float32Array(i);YS(c,c);var u=o0(),h=o0();OC(h,Pi(90)),Gx(u,u,h);var d=o0();kC(d,-1/n,1/n,1/n),Gx(u,u,d);var f=o0();return UC(f,-n*c[2],-n*c[1],-n*c[0]),Gx(u,u,f),{dim:o,tran:c,matrix:u,scaleFactor:n}}kC.__deps=[Hp],UC.__deps=[Hp],OC.__deps=[Hp],b3.__deps=[nn,ro],Object.assign(S3,{__deps:[S1]}),Object.assign(S1,{__deps:[_i,ro,Cs,EV]}),Object.assign(w1,{__deps:[Pi,CV,Bx,Tp,$n,LC,r0,_i,YS,o0,Gx,UC,kC,OC]});class t2{constructor(e,t,n){this.name=e||"",this.path=t||"",this.info={},this.center=new me,this.boundingBox=new Li,n instanceof hr||n instanceof Zn?this.fromGeometry(n):n&&(this.set(n.position,n.index,n.normal,n.color,n.atomindex,n.contour),this.boundingBox.setFromArray(n.position),this.boundingBox.getCenter(this.center))}get type(){return"Surface"}set(e,t,n,r,s,o=!1){this.position=e,this.index=t,this.normal=n,this.color=r,this.atomindex=s,this.size=e.length/3,this.contour=o}fromGeometry(e){let t,n,r,s;if(pt&&tt.time("GeometrySurface.fromGeometry"),t=e instanceof hr?e:e[0],t.boundingBox||t.computeBoundingBox(),this.boundingBox.copy(t.boundingBox),this.boundingBox.getCenter(this.center),t instanceof hr){const o=t.attributes,a=!!o.normal&&o.normal.array;(!a||a[0]===0&&a[1]===0&&a[2]===0)&&t.computeVertexNormals(),n=o.position.array,r=o.index?o.index.array:null,s=o.normal.array}this.set(n,r,s,void 0,void 0),pt&&tt.timeEnd("GeometrySurface.setGeometry")}getPosition(){return this.position}getColor(e){const t=e||{};t.surface=this;const n=this.size,r=new Float32Array(3*n),s=_n.getScheme(t);if(s.volumeColor||t.scheme==="random")for(let a=0;a<n;++a)s.volumeColorToArray(a,r,3*a);else if(s.positionColor){const a=new me,l=this.position;for(let c=0;c<n;++c){var o=3*c;a.set(l[o],l[o+1],l[o+2]),s.positionColorToArray(a,r,o)}}else if(s.atomColor&&this.atomindex){const a=t.structure.getAtomProxy(),l=this.atomindex;for(let c=0;c<n;++c)a.index=l[c],s.atomColorToArray(a,r,3*c)}else{const a=new $t(t.value);Hn(n,a.r,a.g,a.b,r)}return r}getPicking(e){return this.atomindex&&e?new Hd(this.atomindex,e):new Oue(km(this.size),this)}getNormal(){return this.normal}getSize(e,t){return Lo(this.size,e*t)}getIndex(){return this.index}getFilteredIndex(e,t){if(e&&this.atomindex){const n=new ii(e),r=t.getAtomSet(n),s=[],o=this.atomindex,a=this.index,l=a.length,c=this.contour?2:3;let u=0;for(let h=0;h<l;h+=c){let d=!0;for(let f=0;f<c;f++){const p=o[a[h+f]];if(!r.get(p)){d=!1;break}}if(d)for(let f=0;f<c;f++,u++)s[u]=a[h+f]}return El(s,this.position.length/3)}return this.index}getAtomindex(){return this.atomindex}dispose(){}}function Nu(i,e,t,n,r){var s=new x3(i,e,t,n,r);this.getSurface=function(o,a,l,c,u,h=!1){const d=s.triangulate(o,a,l,u,h);if(a&&!u&&(S3(d.position,d.index,a,!0),d.normal=S1(d.position,d.index)),c&&(qS(c,d.position),d.normal)){const f=WV();b3(f,c),y3(f,d.normal)}return d}}Object.assign(Nu,{__deps:[S3,S1,x3,qS,y3,WV,b3]}),C0.add("surf",function(i,e){const t=i.data.args,n=i.data.params;if(t&&(self.volsurf=new Nu(t[0],t[1],t[2],t[3],t[4])),n){const r=self.volsurf.getSurface(n.isolevel,n.smooth,n.box,n.matrix,n.contour,n.wrap),s=[r.position.buffer,r.index.buffer];r.normal&&s.push(r.normal.buffer),r.atomindex&&s.push(r.atomindex.buffer),e({sd:r,p:n},s)}},[Nu]);class js{constructor(e,t,n,r,s,o,a){this.name=e,this.path=t,this.matrix=new Ct,this.normalMatrix=new vn,this.inverseMatrix=new Ct,this.center=new me,this.boundingBox=new Li,this.setData(n,r,s,o,a)}get type(){return"Volume"}setData(e,t,n,r,s){this.nx=t||1,this.ny=n||1,this.nz=r||1,this.data=e||new Float32Array(1),this.setAtomindex(s),delete this._position,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()}setStats(e,t,n,r){this._min=e,this._max=t,this._mean=n,this._rms=r}setMatrix(e){this.matrix.copy(e);const t=this.boundingBox,n=this.center,r=this.nx-1,s=this.ny-1,o=this.nz-1;t.makeEmpty(),t.expandByPoint(n.set(r,s,o)),t.expandByPoint(n.set(r,s,0)),t.expandByPoint(n.set(r,0,o)),t.expandByPoint(n.set(r,0,0)),t.expandByPoint(n.set(0,s,o)),t.expandByPoint(n.set(0,0,o)),t.expandByPoint(n.set(0,s,0)),t.expandByPoint(n.set(0,0,0)),t.applyMatrix4(this.matrix),t.getCenter(this.center);const a=this.matrix.elements,l=new me(a[0],a[1],a[2]),c=new me(a[4],a[5],a[6]),u=new me(a[8],a[9],a[10]),h=new me,d=this.normalMatrix.elements;h.crossVectors(c,u),d[0]=h.x,d[1]=h.y,d[2]=h.z,h.crossVectors(u,l),d[3]=h.x,d[4]=h.y,d[5]=h.z,h.crossVectors(l,c),d[6]=h.x,d[7]=h.y,d[8]=h.z,this.inverseMatrix.copy(this.matrix).invert()}setAtomindex(e){this.atomindex=e}getBox(e,t,n){return n||(n=new Li),n.set(e,e),n.expandByScalar(t),n.applyMatrix4(this.inverseMatrix),n.min.round(),n.max.round(),n}_getBox(e,t){if(!e||!t)return;this.__box||(this.__box=new Li);const n=this.getBox(e,t,this.__box);return[n.min.toArray(),n.max.toArray()]}_makeSurface(e,t,n){const r=this.name+"@"+t.toPrecision(2),s=new t2(r,"",e);return s.info.isolevel=t,s.info.smooth=n,s.info.volume=this,s}getSurface(e,t,n,r,s,o=!1){e=isNaN(e)?this.getValueForSigma(2):e,t=he(t,0),this.volsurf===void 0&&(this.volsurf=new Nu(this.data,this.nx,this.ny,this.nz,this.atomindex));const a=this._getBox(n,r),l=this.volsurf.getSurface(e,t,a,this.matrix.elements,s,o);return this._makeSurface(l,e,t)}getSurfaceWorker(e,t,n,r,s,o,a){if(e=isNaN(e)?this.getValueForSigma(2):e,t=t||0,window.hasOwnProperty("Worker")){this.workerPool===void 0&&(this.workerPool=new RC("surf",2));const l={},c=this.workerPool.getNextWorker();c.postCount===0&&Object.assign(l,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(l,{params:{isolevel:e,smooth:t,box:this._getBox(n,r),matrix:this.matrix.elements,contour:s,wrap:o}}),c.post(l,void 0,u=>{const h=u.data.sd,d=u.data.p;a(this._makeSurface(h,d.isolevel,d.smooth))},u=>{console.warn("Volume.getSurfaceWorker error - trying without worker",u);const h=this.getSurface(e,t,n,r,s,o);a(h)})}else{const l=this.getSurface(e,t,n,r,s,o);a(l)}}getValueForSigma(e){return this.mean+he(e,2)*this.rms}getSigmaForValue(e){return(he(e,0)-this.mean)/this.rms}get position(){if(!this._position){const e=this.nz,t=this.ny,n=this.nx,r=new Float32Array(n*t*e*3);let s=0;for(let o=0;o<e;++o)for(let a=0;a<t;++a)for(let l=0;l<n;++l)r[s+0]=l,r[s+1]=a,r[s+2]=o,s+=3;qS(this.matrix.elements,r),this._position=r}return this._position}getDataAtomindex(){return this.atomindex}getDataPosition(){return this.position}getDataColor(e){const t=e||{};t.volume=this,t.scale=t.scale||"Spectral",t.domain=t.domain||[this.min,this.max];const n=_n.getScheme(t),r=this.position.length/3,s=new Float32Array(3*r);for(let o=0;o<r;++o)n.volumeColorToArray(o,s,3*o);return s}getDataPicking(){const e=km(this.position.length/3);return new GV(e,this)}getDataSize(e,t){const n=this.data,r=this.position.length/3;let s;switch(e){case"value":case"deviation":s=new Float32Array(n);break;case"abs-value":s=new Float32Array(n);for(let o=0;o<r;++o)s[o]=Math.abs(s[o]);break;case"value-min":{s=new Float32Array(n);const o=this.min;for(let a=0;a<r;++a)s[a]-=o;break}default:s=Lo(r,e)}if(t!==1)for(let o=0;o<r;++o)s[o]*=t;return s}get min(){return this._min===void 0&&(this._min=Ux(this.data)),this._min}get max(){return this._max===void 0&&(this._max=kx(this.data)),this._max}get sum(){return this._sum===void 0&&(this._sum=_3(this.data)),this._sum}get mean(){return this._mean===void 0&&(this._mean=Ox(this.data)),this._mean}get rms(){return this._rms===void 0&&(this._rms=function(e){const t=e.length;let n=0;for(let r=0;r<t;++r){const s=e[r];n+=s*s}return Math.sqrt(n/t)}(this.data)),this._rms}clone(){const e=new js(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return e.matrix.copy(this.matrix),e.header=Object.assign({},this.header),e}dispose(){this.workerPool&&this.workerPool.terminate()}}function s4(i){return i==="front"?Sc:i==="back"?Ls:ll}Rn.add("shader/Mesh.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#elif defined( NOLIGHT )
vColor = color;
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),Rn.add("shader/Mesh.frag",`#define STANDARD
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#elif defined( NOLIGHT )
gl_FragColor = vec4( vColor, opacity );
#else
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
#include interior_fragment
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#include opaque_back_fragment
#endif
}`);const o4={f:1,v2:2,v3:3,c:3};function xA(i,e){i.matrix.copy(e),i.matrix.decompose(i.position,i.quaternion,i.scale),i.matrixWorldNeedsUpdate=!0}const Os={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new me,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new Ct,disablePicking:!1,sortParticles:!1,background:!1},$d={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}};class Tl{constructor(e,t={}){this.parameterTypes=$d,this.geometry=new hr,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new Zn,this.wireframeGroup=new Zn,this.pickingGroup=new Zn,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=Io(t,this.defaultParameters),this.uniforms=Dx.merge([Ut.common,{fogColor:{value:new $t(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new $t(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new $t(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},Ut.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};const n=e.position||e.position1;this._positionDataSize=n?n.length/3:0,e.primitiveId||(e.primitiveId=km(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:e.position},color:{type:"c",value:e.color},primitiveId:{type:"f",value:e.primitiveId}}),t.matrix&&(this.matrix=t.matrix),e.index&&this.initIndex(e.index),this.picking=e.picking,this.makeWireframeGeometry()}get defaultParameters(){return Os}set matrix(e){this.setMatrix(e)}get matrix(){return this.group.matrix.clone()}get transparent(){return this.parameters.opacity<1||this.parameters.forceTransparent}get size(){return this._positionDataSize}get attributeSize(){return this.size}get pickable(){return!!this.picking&&!this.parameters.disablePicking}setMatrix(e){xA(this.group,e),xA(this.wireframeGroup,e),xA(this.pickingGroup,e)}initIndex(e){this.geometry.setIndex(new Qi(e,1));const t=this.geometry.getIndex();t?t.setUsage(this.dynamic?Ff:uu):tt.error("Index is null")}makeMaterial(){const e=s4(this.parameters.side),t=new ia({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:e});t.vertexColors=!0,t.extensions.derivatives=!0,t.extensions.fragDepth=this.isImpostor;const n=new ia({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:e});n.vertexColors=!0;const r=new ia({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:e,blending:pc});r.vertexColors=!0,r.extensions.fragDepth=this.isImpostor,t.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,r.clipNear=this.parameters.clipNear,this.material=t,this.wireframeMaterial=n,this.pickingMaterial=r,this.updateShader()}makeWireframeGeometry(){this.makeWireframeIndex();const e=this.geometry,t=this.wireframeIndex,n=new hr;n.attributes=e.attributes,t&&(n.setIndex(new Qi(t,1).setUsage(this.dynamic?Ff:uu)),n.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=n}makeWireframeIndex(){const e=[];function t(s,o){if(s>o){const l=s;s=o,o=l}const a=e[s];return a===void 0?(e[s]=[o],!0):!a.includes(o)&&(a.push(o),!0)}const n=this.geometry,r=n.index;if(this.parameters.wireframe)if(r){const s=r.array;let o,a=s.length;n.drawRange.count!==1/0&&(a=n.drawRange.count),this.wireframeIndex&&this.wireframeIndex.length>2*a?o=this.wireframeIndex:o=El(2*a,n.attributes.position.count);let l=0;e.length=0;for(let c=0;c<a;c+=3){const u=s[c+0],h=s[c+1],d=s[c+2];t(u,h)&&(o[l+0]=u,o[l+1]=h,l+=2),t(h,d)&&(o[l+0]=h,o[l+1]=d,l+=2),t(d,u)&&(o[l+0]=d,o[l+1]=u,l+=2)}this.wireframeIndex=o,this.wireframeIndexCount=l,this.wireframeIndexVersion=this.indexVersion}else{const s=n.attributes.position.count;let o;o=this.wireframeIndex&&this.wireframeIndex.length>2*s?this.wireframeIndex:El(2*s,s);for(let a=0,l=0;a<s;a+=3)o[l+0]=a,o[l+1]=a+1,o[l+2]=a+1,o[l+3]=a+2,o[l+4]=a+2,o[l+5]=a,l+=6;this.wireframeIndex=o,this.wireframeIndexCount=2*s,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0}updateWireframeIndex(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new Qi(this.wireframeIndex,1).setUsage(this.dynamic?Ff:uu));else{const e=this.wireframeGeometry.getIndex();if(!e)return void tt.error("Index is null");e.set(this.wireframeIndex),e.needsUpdate=this.wireframeIndexCount>0,e.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}}getRenderOrder(){let e=0;return this.isText?e=1:this.transparent&&(e=this.isSurface?3:2),e}_getMesh(e){this.material||this.makeMaterial();const t=this.geometry,n=this[e];let r;return r=this.isLine?new MC(t,n):this.isPoint?new lV(t,n):new hl(t,n),r.frustumCulled=!1,r.renderOrder=this.getRenderOrder(),r}getMesh(){return this._getMesh("material")}getWireframeMesh(){let e;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),e=new MC(this.wireframeGeometry,this.wireframeMaterial),e.frustumCulled=!1,e.renderOrder=this.getRenderOrder(),e}getPickingMesh(){return this._getMesh("pickingMaterial")}getShader(e,t){return i0(e,this.getDefines(t))}getVertexShader(e){return this.getShader(this.vertexShader,e)}getFragmentShader(e){return this.getShader(this.fragmentShader,e)}getDefines(e){const t={};return this.parameters.clipNear&&(t.NEAR_CLIP=1),this.parameters.clipRadius&&(t.RADIUS_CLIP=1),e==="picking"?t.PICKING=1:((e==="background"||this.parameters.background)&&(t.NOLIGHT=1),this.parameters.flatShaded&&(t.FLAT_SHADED=1),this.parameters.opaqueBack&&(t.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(t.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(t.USE_INTERIOR_COLOR=1)),t}getParameters(){return this.parameters}addUniforms(e){this.uniforms=Dx.merge([this.uniforms,e]),this.pickingUniforms=Dx.merge([this.pickingUniforms,e])}addAttributes(e){for(let t in e){let n;const r=e[t],s=this.attributeSize*o4[r.type];r.value?(s!==r.value.length&&tt.error("attribute value has wrong length",t),n=r.value):n=fV("float32",s),this.geometry.setAttribute(t,new Qi(n,o4[r.type]).setUsage(this.dynamic?Ff:uu))}}updateRenderOrder(){const e=this.getRenderOrder();function t(n){n.renderOrder=e}this.group.children.forEach(t),this.pickingGroup&&this.pickingGroup.children.forEach(t)}updateShader(){const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.vertexShader=this.getVertexShader(),e.fragmentShader=this.getFragmentShader(),e.needsUpdate=!0,t.vertexShader=this.getShader("Line.vert"),t.fragmentShader=this.getShader("Line.frag"),t.needsUpdate=!0,n.vertexShader=this.getVertexShader("picking"),n.fragmentShader=this.getFragmentShader("picking"),n.needsUpdate=!0}setParameters(e){const t=e,n=this.parameterTypes,r=this.parameters,s={},o={};let a=!1,l=!1;for(const c in t){const u=t[c];u!==void 0&&(r[c]=u,n[c]!==void 0&&(n[c].property&&(n[c].property!==!0?s[n[c].property]=u:s[c]=u),n[c].uniform&&(n[c].uniform!==!0?o[n[c].uniform]=u:o[c]=u),n[c].updateShader&&(a=!0),n[c].updateVisibility&&(l=!0),this.dynamic&&c==="wireframe"&&u===!0&&this.updateWireframeIndex(),c==="forceTransparent"&&(s.transparent=this.transparent),c==="matrix"&&(this.matrix=u)))}this.setProperties(s),this.setUniforms(o),a&&this.updateShader(),l&&this.setVisibility(this.visible)}setAttributes(e){const t=this.geometry,n=t.attributes;for(const r in e){if(r==="picking")continue;const s=e[r],o=s.length;if(r==="index"){const a=t.getIndex();if(!a){tt.error("Index is null");continue}t.setDrawRange(0,1/0),o>a.array.length?t.setIndex(new Qi(s,1).setUsage(this.dynamic?Ff:uu)):(a.set(s),a.needsUpdate=o>0,a.updateRange.count=o,t.setDrawRange(0,o)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{const a=n[r];o>a.array.length?t.setAttribute(r,new Qi(s,a.itemSize).setUsage(this.dynamic?Ff:uu)):(n[r].set(s),n[r].needsUpdate=o>0,n[r].updateRange.count=o)}}}setUniforms(e){if(!e)return;const t=this.material.uniforms,n=this.wireframeMaterial.uniforms,r=this.pickingMaterial.uniforms;for(let s in e)s==="opacity"&&this.setProperties({transparent:this.transparent}),t[s]!==void 0&&(t[s].value.isVector3?t[s].value.copy(e[s]):t[s].value.set?t[s].value.set(e[s]):t[s].value=e[s]),n[s]!==void 0&&(n[s].value.isVector3?n[s].value.copy(e[s]):n[s].value.set?n[s].value.set(e[s]):n[s].value=e[s]),r[s]!==void 0&&(r[s].value.isVector3?r[s].value.copy(e[s]):r[s].value.set?r[s].value.set(e[s]):r[s].value=e[s])}setProperties(e){if(!e)return;const t=this.material,n=this.wireframeMaterial,r=this.pickingMaterial;for(const s in e){const o=s;let a=e[o];o==="transparent"?this.updateRenderOrder():o==="side"&&(a=s4(a)),t[o]=a,n[o]=a,r[o]=a}t.needsUpdate=!0,n.needsUpdate=!0,r.needsUpdate=!0}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()}toJSON(){var e={};for(var t in this)t!=="group"&&t!=="wireframeGroup"&&t!="pickingGroup"&&t!=="picking"&&(e[t]=this[t]);return e}}class Mc extends Tl{constructor(e,t={}){super(e,t),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:e.normal}}),e.normal===void 0&&this.geometry.computeVertexNormals()}}class XV extends Mc{constructor(){super(...arguments),this.isSurface=!0}}function Oy(i){i.visible=!0}function a4(i){i.visible=!1}class qV{constructor(e){this.group=new Zn,this.wireframeGroup=new Zn,this.pickingGroup=new Zn,this.frontMeshes=[],this.backMeshes=[],this.size=e.size,this.side=e.parameters.side,this.visible=e.visible,this.geometry=e.geometry,this.picking=e.picking,this.group=new Zn,this.wireframeGroup=new Zn,this.pickingGroup=new Zn,this.matrix=e.matrix;const t=e,n=new e.constructor({position:new Float32Array(0)});t.makeMaterial(),n.makeMaterial(),n.picking=e.picking,n.geometry=e.geometry,n.wireframeGeometry=e.wireframeGeometry,n.setParameters(e.getParameters()),n.updateShader(),t.setParameters({side:"front"}),n.setParameters({side:"back",opacity:n.parameters.opacity}),this.buffer=e,this.frontBuffer=t,this.backBuffer=n}set matrix(e){Tl.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking&&!this.parameters.disablePicking}get parameters(){return this.buffer.parameters}getParameters(){const e=Object.assign({},this.buffer.parameters);return e.side=this.side,e}getMesh(e){let t,n;return e?(n=this.backBuffer.getPickingMesh(),t=this.frontBuffer.getPickingMesh()):(n=this.backBuffer.getMesh(),t=this.frontBuffer.getMesh()),this.frontMeshes.push(t),this.backMeshes.push(n),this.setParameters({side:this.side}),new Zn().add(n,t)}getWireframeMesh(){return this.buffer.getWireframeMesh()}getPickingMesh(){return this.getMesh(!0)}setAttributes(e){this.buffer.setAttributes(e)}setParameters(e){(e=Object.assign({},e)).side==="front"?(this.frontMeshes.forEach(Oy),this.backMeshes.forEach(a4)):e.side==="back"?(this.frontMeshes.forEach(a4),this.backMeshes.forEach(Oy)):e.side==="double"&&(this.frontMeshes.forEach(Oy),this.backMeshes.forEach(Oy)),e.side!==void 0&&(this.side=e.side),delete e.side,e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,this.frontBuffer.setParameters(e),e.wireframe!==void 0&&(this.wireframe=e.wireframe,this.setVisibility(this.visible)),delete e.wireframe,this.backBuffer.setParameters(e)}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.frontBuffer.dispose(),this.backBuffer.dispose()}toJSON(){var e={};for(var t in this)["side","size","visible","matrix","parameters"].includes(t)&&(e[t]=this[t]);return e}}Rn.add("shader/Line.vert",`uniform float clipNear;
uniform vec3 clipCenter;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include color_pars_vertex
void main(){
#include color_vertex
#include begin_vertex
#include project_vertex
vViewPosition = -mvPosition.xyz;
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),Rn.add("shader/Line.frag",`uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
void main(){
#include nearclip_fragment
#include radiusclip_fragment
gl_FragColor = vec4( vColor, opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`);class YV extends Tl{constructor(){super(...arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}}class BC extends K1{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),e instanceof js?(this.surface=void 0,this.volume=e):(this.surface=e,this.volume=void 0),this.boxCenter=new me,this.__boxCenter=new me,this.box=new Li,this.__box=new Li,this._position=new me,this.inverseMatrix=new Ct,this.setBox=function(){this._position.copy(t.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(n)}init(e){const t=e||{};t.colorScheme=he(t.colorScheme,"uniform"),t.colorValue=he(t.colorValue,14540253),this.isolevelType=he(t.isolevelType,"sigma"),this.isolevel=he(t.isolevel,2),this.negateIsolevel=he(t.negateIsolevel,!1),this.isolevelScroll=he(t.isolevelScroll,!1),this.smooth=he(t.smooth,0),this.background=he(t.background,!1),this.opaqueBack=he(t.opaqueBack,!0),this.boxSize=he(t.boxSize,0),this.colorVolume=he(t.colorVolume,void 0),this.contour=he(t.contour,!1),this.useWorker=he(t.useWorker,!0),this.wrap=he(t.wrap,!1),super.init(t),this.inverseMatrix.copy(this.matrix).invert(),this.build()}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t)}),this.setVisibility(this.visible),e()}prepare(e){if(this.volume){let t;if(t=this.isolevelType==="sigma"?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(t*=-1),!this.surface||this.__isolevel!==t||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=t,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);const n=r=>{this.surface=r,e()};this.useWorker?this.volume.getSurfaceWorker(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,n):n(this.volume.getSurface(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else e()}else e()}create(){const e={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};let t;if(this.contour)t=new YV(e,this.getBufferParams({wireframe:!1}));else{Object.assign(e,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});const n=new XV(e,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));t=new qV(n)}this.bufferList.push(t)}update(e){if(this.bufferList.length===0)return;const t={};(e=e||{}).position&&(t.position=this.surface.getPosition()),e.color&&(t.color=this.surface.getColor(this.getColorParams())),e.index&&(t.index=this.surface.getIndex()),e.normal&&(t.normal=this.surface.getNormal()),this.bufferList.forEach(function(n){n.setAttributes(t)})}setParameters(e,t,n){return e&&e.isolevelType!==void 0&&this.volume&&(this.isolevelType==="value"&&e.isolevelType==="sigma"?this.isolevel=this.volume.getSigmaForValue(this.isolevel):this.isolevelType==="sigma"&&e.isolevelType==="value"&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=e.isolevelType),e&&e.boxCenter&&(this.boxCenter.copy(e.boxCenter),delete e.boxCenter),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),e.matrix&&this.inverseMatrix.copy(e.matrix).invert(),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),e&&e.colorVolume!==void 0&&t&&(t.color=!0),this.surface&&(e.isolevel!==void 0||e.negateIsolevel!==void 0||e.smooth!==void 0||e.wrap!==void 0||e.boxSize!==void 0||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}dispose(){this.viewer.signals.ticked.remove(this.setBox,this),super.dispose()}}class Sn{static zoomScroll(e,t){e.trackballControls.zoom(t)}static clipNearScroll(e,t){const n=e.getParameters();e.setParameters({clipNear:n.clipNear+t/10})}static focusScroll(e,t){const n=e.getFocus(),r=Math.sign(t)*function(s,o,a){if(s>o)return s;const l=s/o;return((2*a-o)*l+(2*o-3*a))*l*l+a}((100-n)/10,5,.2);e.setFocus(n+r)}static zoomFocusScroll(e,t){e.trackballControls.zoom(t);const n=e.viewer.camera.position.z;e.setFocus(100-Math.abs(n/8))}static isolevelScroll(e,t){const n=Math.sign(t)/10;e.eachRepresentation((r,s)=>{if(r.repr instanceof BC){const o=r.getParameters();o.isolevelScroll&&r.setParameters({isolevel:o.isolevel+n})}})}static panDrag(e,t,n){e.trackballControls.pan(t,n)}static rotateDrag(e,t,n){e.trackballControls.rotate(t,n)}static zRotateDrag(e,t,n){e.trackballControls.zRotate(t,n)}static zoomDrag(e,t,n){e.trackballControls.zoom((t+n)/-2)}static zoomFocusDrag(e,t,n){e.trackballControls.zoom((t+n)/-2);const r=e.viewer.camera.position.z;e.setFocus(100-Math.abs(r/8))}static panComponentDrag(e,t,n){e.trackballControls.panComponent(t,n)}static panAtomDrag(e,t,n){e.trackballControls.panAtom(t,n)}static rotateComponentDrag(e,t,n){e.trackballControls.rotateComponent(t,n)}static movePick(e,t){t&&e.animationControls.move(t.position.clone())}static tooltipPick(e,t){const n=e.tooltip;if(e.getParameters().tooltip&&t){const r=t.mouse.position;n.innerText=t.getLabel(),n.style.bottom=window.innerHeight-r.y+3+"px",n.style.left=r.x+3+"px",n.style.display="block"}else n.style.display="none"}static measurePick(e,t){if(t&&(t.atom||t.bond)){const n=t.atom||t.closestBondAtom;t.component.measurePick(n)}else e.measureClear()}}const KV={default:[["scroll",Sn.zoomScroll],["scroll-shift",Sn.focusScroll],["scroll-ctrl",Sn.isolevelScroll],["scroll-shift-ctrl",Sn.zoomFocusScroll],["drag-left",Sn.rotateDrag],["drag-right",Sn.panDrag],["drag-ctrl-left",Sn.panDrag],["drag-ctrl-right",Sn.zRotateDrag],["drag-shift-left",Sn.zoomDrag],["drag-middle",Sn.zoomFocusDrag],["drag-ctrl-shift-right",Sn.panComponentDrag],["drag-ctrl-shift-left",Sn.rotateComponentDrag],["clickPick-right",Sn.measurePick],["clickPick-ctrl-left",Sn.measurePick],["clickPick-middle",Sn.movePick],["clickPick-left",Sn.movePick],["hoverPick",Sn.tooltipPick]],pymol:[["drag-left",Sn.rotateDrag],["drag-middle",Sn.panDrag],["drag-right",Sn.zoomDrag],["scroll",Sn.focusScroll],["drag-shift-right",Sn.focusScroll],["clickPick-ctrl+shift-middle",Sn.movePick],["hoverPick",Sn.tooltipPick]],coot:[["scroll",Sn.isolevelScroll],["drag-left",Sn.rotateDrag],["drag-middle",Sn.panDrag],["drag-ctrl-left",Sn.panDrag],["drag-right",Sn.zoomFocusDrag],["drag-ctrl-right",Sn.focusScroll],["clickPick-middle",Sn.movePick],["hoverPick",Sn.tooltipPick]],astexviewer:[["drag-left",Sn.rotateDrag],["drag-ctrl-left",Sn.panDrag],["drag-shift-left",Sn.zoomDrag],["scroll",Sn.focusScroll],["clickPick-middle",Sn.movePick],["hoverPick",Sn.tooltipPick]]};function l4(i){const e=i.split(/[-+]/);let t="";e.includes("scroll")&&(t="scroll"),e.includes("drag")&&(t="drag"),e.includes("click")&&(t="click"),e.includes("doubleClick")&&(t="doubleClick"),e.includes("hover")&&(t="hover"),e.includes("clickPick")&&(t="clickPick"),e.includes("hoverPick")&&(t="hoverPick");let n=0;e.includes("alt")&&(n+=1),e.includes("ctrl")&&(n+=2),e.includes("meta")&&(n+=4),e.includes("shift")&&(n+=8);let r=0;return e.includes("left")&&(r+=1),e.includes("right")&&(r+=2),e.includes("middle")&&(r+=4),[t,n,r]}class $ue{constructor(e,t={}){this.stage=e,this.actionList=[],this.mouse=e.mouseObserver,this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e,...t){if(this.disabled)return;const n=this.mouse.key||0,r=this.mouse.buttons||0;this.actionList.forEach(s=>{s.type===e&&s.key===n&&s.button===r&&s.callback(this.stage,...t)})}add(e,t){const[n,r,s]=l4(e);this.actionList.push({type:n,key:r,button:s,callback:t})}remove(e,t){const n=e.includes("*"),[r,s,o]=l4(e),a=this.actionList.filter(function(l){return!((l.type===r||n&&r==="")&&(l.key===s||n&&s===0)&&(l.button===o||n&&o===0)&&(l.callback===t||t===void 0))});this.actionList=a}preset(e){this.clear(),(KV[e]||[]).forEach(t=>this.add(t[0],t[1]))}clear(){this.actionList.length=0}}class zg{static autoView(e){e.autoView(1e3)}static toggleAnimations(e){e.animationControls.toggle()}static toggleRock(e){e.toggleRock()}static toggleSpin(e){e.toggleSpin()}static toggleAntialiasing(e){const t=e.getParameters();e.setParameters({sampleLevel:t.sampleLevel===-1?0:-1})}}const Wue={default:[["i",zg.toggleSpin],["k",zg.toggleRock],["p",zg.toggleAnimations],["a",zg.toggleAntialiasing],["r",zg.autoView]]};class jue{constructor(e,t={}){this.stage=e,this.actionList=[],this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e){this.disabled||this.actionList.forEach(t=>{t.key===e&&t.callback(this.stage)})}add(e,t){this.actionList.push({key:e,callback:t})}remove(e,t){const n=this.actionList.filter(function(r){return!(r.key===e&&(r.callback===t||t===void 0))});this.actionList=n}preset(e){this.clear(),(Wue[e]||[]).forEach(t=>this.add(t[0],t[1]))}clear(){this.actionList.length=0}}class Xue{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)}_onClick(e,t){const n=this.stage.pickingControls.pick(e,t);this.stage.signals.clicked.dispatch(n),this.controls.run("clickPick",n)}_onHover(e,t){const n=this.stage.pickingControls.pick(e,t);n&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=n.component,this.stage.transformAtom=n.atom),this.stage.signals.hovered.dispatch(n),this.controls.run("hoverPick",n)}dispose(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class que{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)}_onMove(){this.stage.tooltip.style.display="none"}_onScroll(e){this.controls.run("scroll",e)}_onDrag(e,t){this.controls.run("drag",e,t)}_onClick(e,t){this.controls.run("click",e,t)}_onDblclick(e,t){this.controls.run("doubleClick",e,t)}_onHover(e,t){this.controls.run("hover",e,t)}dispose(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class Yue{constructor(e){this.stage=e,this.viewer=e.viewer,this.animationControls=e.animationControls,this.viewer.signals.ticked.add(this._onTick,this)}_onTick(e){this.animationControls.run(e)}dispose(){this.viewer.signals.ticked.remove(this._onTick,this)}}const c4=!!_V&&{passive:!0};class Kue{constructor(e){this.stage=e,this.stage=e,this.controls=e.keyControls,this.domElement=e.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,c4),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)}_onKeydown(){}_onKeyup(){}_onKeypress(e){let t;t="key"in KeyboardEvent.prototype?e.key:String.fromCharCode(e.which||e.keyCode),this.controls.run(t)}_focusDomElement(){this.domElement.focus()}dispose(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,c4),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)}}class Zue{constructor(e,t,n,r={}){this.component=e,this.position=t,this.offsetX=he(r.offsetX,0),this.offsetY=he(r.offsetY,0),this.visible=he(r.visible,!0),this.stage=e.stage,this.viewer=e.stage.viewer,this._viewerPosition=new me,this._updateViewerPosition(),this._canvasPosition=new on,this._cameraPosition=new me,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(n),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)}setContent(e){const t=this.element.style.display;if(t==="none"&&(this.element.style.left="-10000px",this.element.style.display="block"),e instanceof HTMLElement)this.element.appendChild(e);else{const n=document.createElement("div");n.innerText=e,Object.assign(n.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(n)}this._clientRect=this.element.getBoundingClientRect(),t==="none"&&(this.element.style.display=t)}setVisibility(e){this.visible=e,this.updateVisibility()}getVisibility(){return this.visible&&this.component.parameters.visible}updateVisibility(){this.element.style.display=this.getVisibility()?"block":"none"}_updateViewerPosition(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)}_update(){if(!this.getVisibility())return;const e=this.element.style,t=this._canvasPosition,n=this._viewerPosition,r=this._clientRect;if(this._cameraPosition.copy(n).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)return void(e.display="none");e.display="block";const s=this._cameraPosition.length(),o=this.viewer.scene.fog;e.opacity=(1-X1(o.near,o.far,s)).toString(),e.zIndex=Math.round(100*(o.far-s)).toString(),this.stage.viewerControls.getPositionOnCanvas(n,t),e.bottom=this.offsetX+t.y+r.height/2+"px",e.left=this.offsetY+t.x-r.width/2+"px"}dispose(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)}}const nu=new Ct,By=new me,u4=new Ns;class Que{constructor(e){this.component=e,this.signals={changed:new rn.Signal},this.stage=e.stage,this.viewer=e.stage.viewer}get position(){return this.component.position}get rotation(){return this.component.quaternion}changed(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()}spin(e,t){nu.copy(this.viewer.rotationGroup.matrix).invert(),By.copy(md(e)).applyMatrix4(nu),nu.extractRotation(this.component.transform),nu.premultiply(this.viewer.rotationGroup.matrix),nu.invert(),By.copy(md(e)),By.applyMatrix4(nu),nu.makeRotationAxis(By,t),u4.setFromRotationMatrix(nu),this.component.quaternion.premultiply(u4),this.changed()}}const ZV={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"};class Ac{constructor(e={}){this.max=10,this.type=he(e.type,"size"),this.scale=he(e.scale,1),this.size=he(e.size,1),this.data=he(e.data,{})}atomRadius(e){let t;switch(this.type){case"vdw":t=e.vdw;break;case"covalent":t=e.covalent;break;case"bfactor":t=e.bfactor||1;break;case"sstruc":const n=e.sstruc;t=n==="h"||n==="g"||n==="i"||n==="e"||n==="b"?.25:OV.includes(e.atomname)?.4:.1;break;case"data":t=he(this.data[e.index],1);break;case"explicit":t=e.radius,t===null&&(t=this.size);break;default:t=this.size}return Math.min(t*this.scale,this.max)}}Ac.types=ZV;const Jue=new me(-1,-1,-1),ehe=new Ct;class QV{constructor(e){const t=e.rows,n=t/3,r=new On(t,3),s=new On(3,3),o=new On(1,3),a=new On(3,3),l=new On(3,3),c=NC(e);FC(e,c),Da(r,e),zx(s,r,r),$V(s,o,a,l);const u=new me(c[0],c[1],c[2]),h=new me(a.data[0],a.data[3],a.data[6]),d=new me(a.data[1],a.data[4],a.data[7]),f=new me(a.data[2],a.data[5],a.data[8]),p=h.clone().multiplyScalar(Math.sqrt(o.data[0]/n)),_=d.clone().multiplyScalar(Math.sqrt(o.data[1]/n)),v=f.clone().multiplyScalar(Math.sqrt(o.data[2]/n));this.begA=u.clone().sub(p),this.endA=u.clone().add(p),this.begB=u.clone().sub(_),this.endB=u.clone().add(_),this.begC=u.clone().sub(v),this.endC=u.clone().add(v),this.center=u,this.vecA=p,this.vecB=_,this.vecC=v,this.normVecA=h,this.normVecB=d,this.normVecC=f}getBasisMatrix(e=new Ct){const t=e;return t.makeBasis(this.normVecB,this.normVecA,this.normVecC),t.determinant()<0&&t.scale(Jue),t}getRotationQuaternion(e=new Ns){const t=e;return t.setFromRotationMatrix(this.getBasisMatrix(ehe)),t.invert()}getProjectedScaleForAtoms(e){let t=-1/0,n=-1/0,r=-1/0,s=-1/0,o=-1/0,a=-1/0;const l=new me,c=new me,u=this.center,h=this.normVecA,d=this.normVecB,f=this.normVecC;return e.eachAtom(function(p){gd(l.copy(p),h,u);const _=c.subVectors(l,u).normalize().dot(h),v=l.distanceTo(u);_>0?v>t&&(t=v):v>n&&(n=v),gd(l.copy(p),d,u);const g=c.subVectors(l,u).normalize().dot(d),b=l.distanceTo(u);g>0?b>r&&(r=b):b>s&&(s=b),gd(l.copy(p),f,u);const m=c.subVectors(l,u).normalize().dot(f),y=l.distanceTo(u);m>0?y>o&&(o=y):y>a&&(a=y)}),{d1a:t,d2a:r,d3a:o,d1b:-n,d2b:-s,d3b:-a}}}class tc{constructor(e,t,n,r){this.volume=e,this.setFilter(t,n,r)}get header(){return this.volume.header}get matrix(){return this.volume.matrix}get normalMatrix(){return this.volume.normalMatrix}get inverseMatrix(){return this.volume.inverseMatrix}get center(){return this.volume.center}get boundingBox(){return this.volume.boundingBox}get min(){return this.volume.min}get max(){return this.volume.max}get mean(){return this.volume.mean}get rms(){return this.volume.rms}_getFilterHash(e,t,n){return JSON.stringify([e,t,n])}setFilter(e,t,n){isNaN(e)&&this.header&&(e=this.header.DMEAN+2*this.header.ARMS),e=e===void 0||isNaN(e)?-1/0:e,t=he(t,1/0),n=he(n,!1);const r=this.volume.data,s=this.volume.position,o=this.volume.atomindex,a=this._getFilterHash(e,t,n);if(a!==this._filterHash){if(e===-1/0&&t===1/0)this.data=r,this.position=s,this.atomindex=o;else{const l=r.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*l),this._positionBuffer=new ArrayBuffer(3*l*4),o&&(this._atomindexBuffer=new ArrayBuffer(4*l)));const c=new Float32Array(this._dataBuffer),u=new Float32Array(this._positionBuffer);let h;o&&(h=new Uint32Array(this._atomindexBuffer));let d=0;for(let f=0;f<l;++f){const p=3*f,_=r[f];if(!n&&_>=e&&_<=t||n&&(_<e||_>t)){const v=3*d;c[d]=_,u[v+0]=s[p+0],u[v+1]=s[p+1],u[v+2]=s[p+2],o&&h&&(h[d]=o[f]),d+=1}}this.data=new Float32Array(this._dataBuffer,0,d),this.position=new Float32Array(this._positionBuffer,0,3*d),o&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,d))}this._filterHash=a}}}tc.prototype.getValueForSigma=js.prototype.getValueForSigma,tc.prototype.getSigmaForValue=js.prototype.getSigmaForValue,tc.prototype.getDataAtomindex=js.prototype.getDataAtomindex,tc.prototype.getDataPosition=js.prototype.getDataPosition,tc.prototype.getDataColor=js.prototype.getDataColor,tc.prototype.getDataPicking=js.prototype.getDataPicking,tc.prototype.getDataSize=js.prototype.getDataSize;class the{constructor(e,t){const n=RV({nodeArray1:e.atomIndex1,nodeArray2:e.atomIndex2,edgeCount:e.count,nodeCount:t});this.countArray=n.countArray,this.offsetArray=n.offsetArray,this.indexArray=n.indexArray}}class Vx extends Um{get _defaultFields(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]}addBond(e,t,n){this.growIfFull();const r=this.count,s=e.index,o=t.index;s<o?(this.atomIndex1[r]=s,this.atomIndex2[r]=o):(this.atomIndex2[r]=s,this.atomIndex1[r]=o),n&&(this.bondOrder[r]=n),this.count+=1}addBondIfConnected(e,t,n){return!!e.connectedTo(t)&&(this.addBond(e,t,n),!0)}}class nhe extends Um{get _defaultFields(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]}setAltloc(e,t){this.altloc[e]=t.charCodeAt(0)}getAltloc(e){const t=this.altloc[e];return t?String.fromCharCode(t):""}}class ihe extends Um{get _defaultFields(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]}setSstruc(e,t){this.sstruc[e]=t.charCodeAt(0)}getSstruc(e){const t=this.sstruc[e];return t?String.fromCharCode(t):""}setInscode(e,t){this.inscode[e]=t.charCodeAt(0)}getInscode(e){const t=this.inscode[e];return t?String.fromCharCode(t):""}}class rhe extends Um{get _defaultFields(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]}setChainname(e,t){const n=4*e;this.chainname[n]=t.charCodeAt(0),this.chainname[n+1]=t.charCodeAt(1),this.chainname[n+2]=t.charCodeAt(2),this.chainname[n+3]=t.charCodeAt(3)}getChainname(e){let t="";for(let n=0;n<4;++n){const r=this.chainname[4*e+n];if(!r)break;t+=String.fromCharCode(r)}return t}setChainid(e,t){const n=4*e;this.chainid[n]=t.charCodeAt(0),this.chainid[n+1]=t.charCodeAt(1),this.chainid[n+2]=t.charCodeAt(2),this.chainid[n+3]=t.charCodeAt(3)}getChainid(e){let t="";for(let n=0;n<4;++n){const r=this.chainid[4*e+n];if(!r)break;t+=String.fromCharCode(r)}return t}}class she extends Um{get _defaultFields(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]}}class kb{constructor(e){this.polymer=e,this.size=e.residueCount}getCenterIterator(e=0){const t=this.getPosition().center,n=t.length/3;let r=0,s=-1;const o=[new me,new me,new me,new me];return{size:n,next:function(){const a=this.get(s);return s+=1,a},get:function(a){a=Math.min(n-1,Math.max(0,a));const l=o[r%4],c=3*a;if(l.fromArray(t,c),e){const u=Math.min(e,a,n-a-1);for(let h=1;h<=u;++h){const d=3*h,f=(u+1-h)/(u+1);l.x+=f*t[c-d+0]+f*t[c+d+0],l.y+=f*t[c-d+1]+f*t[c+d+1],l.z+=f*t[c-d+2]+f*t[c+d+2]}l.x/=u+1,l.y/=u+1,l.z/=u+1}return r+=1,l},reset:function(){r=0,s=-1}}}getColor(e){const t=this.polymer,n=t.structure,r=t.residueCount,s=t.residueIndexStart,o=new Float32Array(3*r),a=e||{};a.structure=n;const l=_n.getScheme(a),c=n.getResidueProxy(),u=n.getAtomProxy();for(let h=0;h<r;++h)c.index=s+h,u.index=c.traceAtomIndex,l.atomColorToArray(u,o,3*h);return{color:o}}getPicking(){const e=this.polymer,t=e.structure,n=e.residueCount,r=e.residueIndexStart,s=new Float32Array(n),o=t.getResidueProxy();for(let a=0;a<n;++a)o.index=r+a,s[a]=o.traceAtomIndex;return{picking:new Hd(s,t)}}getSize(e){const t=this.polymer,n=t.structure,r=t.residueCount,s=t.residueIndexStart,o=new Float32Array(r),a=new Ac(e),l=n.getResidueProxy(),c=n.getAtomProxy();for(let u=0;u<r;++u)l.index=s+u,c.index=l.traceAtomIndex,o[u]=a.atomRadius(c);return{size:o}}getPosition(){const e=this.polymer,t=e.structure,n=e.residueCount,r=n-3,s=new Float32Array(3*n),o=new Float32Array(3*n),a=new Float32Array(n),l=new Float32Array(n),c=new Float32Array(n),u=new Float32Array(n),h=new Float32Array(3*n),d=new me,f=new me,p=new me,_=new me,v=new me,g=new me,b=new me,m=new me,y=new me,A=new me,w=new me,M=new me(0,0,0),T="trace",E=t.getAtomProxy(),C=t.getAtomProxy(e.getAtomIndexByType(0,T)),N=t.getAtomProxy(e.getAtomIndexByType(1,T)),P=t.getAtomProxy(e.getAtomIndexByType(2,T));for(let U=0;U<r;++U){E.index=C.index,C.index=N.index,N.index=P.index,P.index=e.getAtomIndexByType(U+3,T);const z=3*U;d.subVectors(C,E),f.subVectors(N,C),p.subVectors(P,N),_.subVectors(d,f),v.subVectors(f,p),y.crossVectors(_,v).normalize(),y.toArray(o,z),U>0&&(a[U]=y.angleTo(A));const O=Math.cos(_.angleTo(v));u[U]=180/Math.PI*Math.acos(O);const D=_.length(),B=v.length();l[U]=Math.sqrt(B*D)/Math.max(2,2*(1-O)),c[U]=Math.abs(f.dot(y)),g.copy(_).multiplyScalar(l[U]/D),b.copy(v).multiplyScalar(l[U]/B),g.subVectors(C,g),b.subVectors(N,b),g.toArray(s,z+3),b.toArray(s,z+6),w.subVectors(E,M),w.toArray(h,z),A.copy(y),M.copy(g)}g.fromArray(s,3),b.fromArray(s,6),y.subVectors(g,b).normalize(),E.index=e.getAtomIndexByType(0,T),M.copy(E),m.copy(E),gd(m,y,g),m.toArray(s,0),w.subVectors(M,g),w.toArray(h,0),g.fromArray(s,3*n-6),b.fromArray(s,3*n-9),y.subVectors(g,b).normalize(),E.index=e.getAtomIndexByType(n-1,T),M.copy(E),m.copy(E),gd(m,y,g),m.toArray(s,3*n-3);for(let U=n-3;U<n;++U)g.fromArray(s,3*U),E.index=e.getAtomIndexByType(U,T),M.copy(E),w.subVectors(M,g),w.toArray(h,3*U);const L=new Float32Array(n),R=new Float32Array(n),F=new Float32Array(n),V=new Float32Array(n);L[1]=l[0],R[1]=u[0],F[1]=l[0];for(let U=2;U<n-2;++U)L[U]=.5*(l[U-2]+l[U-1]),R[U]=.5*(u[U-2]+u[U-1]),F[U]=.5*(c[U-2]+c[U-1]),g.fromArray(o,3*(U-2)),b.fromArray(o,3*(U-1)),V[U]=180/Math.PI*Math.acos(Math.cos(g.angleTo(b)));L[n-2]=l[n-4],R[n-2]=u[n-4],F[n-2]=c[n-4];const G=new Float32Array(3*n);ar(o,G,0,0,3),ar(o,G,0,3,3);for(let U=2;U<n-2;++U)g.fromArray(o,3*(U-2)),b.fromArray(o,3*(U-1)),y.addVectors(b,g).multiplyScalar(.5).normalize(),y.toArray(G,3*U);return ar(o,G,3*n-12,3*n-6,3),ar(o,G,3*n-12,3*n-3,3),{center:s,axis:G,bending:V,radius:L,rise:F,twist:R,resdir:h}}}class JV{constructor(e){this.polymer=e,this.helixorient=new kb(e),this.position=this.helixorient.getPosition()}getAxis(e,t,n,r,s){e=e||30,t=t||2.5,n=n!==void 0&&n;const o=this.polymer,a=o.structure,l=o.residueCount,c=o.residueIndexStart,u=this.position,h=r||{};h.structure=a;const d=_n.getScheme(h),f=new Ac(s);let p=0,_=0;const v=[],g=[],b=[],m=[],y=[],A=[],w=[],M=[],T=[];let E,C,N=new Float32Array(3*l),P=new Float32Array(3*l);const L=new me,R=new me,F=a.getResidueProxy(),V=a.getResidueProxy(),G=a.getAtomProxy(),U=new me,z=new me;let O=!1;for(let B=0;B<l;++B)if(F.index=c+B,U.fromArray(u.center,3*B),B===l-1?O=!0:(V.index=c+B+1,z.fromArray(u.center,3*B+3),(n&&F.sstruc!==V.sstruc||U.distanceTo(z)>t||u.bending[B]>e)&&(O=!0)),O){if(B-p<4){p=B,O=!1;continue}G.index=F.traceAtomIndex,N=u.axis.subarray(3*p+3,3*B),P=u.center.subarray(3*p,3*B+3),E=IC(N).normalize(),C=IC(P),L.fromArray(P),gd(L,E,C),R.fromArray(P,P.length-3),gd(R,E,C),E.subVectors(R,L),E.toArray(v,_),C.toArray(g,_),L.toArray(b,_),R.toArray(m,_),d.atomColorToArray(G,y,_),A.push(G.index),w.push(f.atomRadius(G)),M.push(c+p),T.push(c+B+1-p),_+=3,p=B,O=!1}const D=new Float32Array(A);return{axis:new Float32Array(v),center:new Float32Array(g),begin:new Float32Array(b),end:new Float32Array(m),color:new Float32Array(y),picking:new Hd(D,a),size:new Float32Array(w),residueOffset:M,residueCount:T}}}class ohe{constructor(e){this.scoreFunction=e,this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.bubbleUp(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return t&&this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e}peek(){return this.content[0]}remove(e){const t=this.content.length;for(let n=0;n<t;n++)if(this.content[n]===e){const r=this.content.pop();return void(r&&n!==t-1&&(this.content[n]=r,this.scoreFunction(r)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")}size(){return this.content.length}bubbleUp(e){const t=this.content[e];for(;e>0;){const n=Math.floor((e+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}}sinkDown(e){const t=this.content.length,n=this.content[e],r=this.scoreFunction(n);let s=0,o=0;for(;;){const a=2*(e+1),l=a-1;let c=null;if(l<t){const u=this.content[l];s=this.scoreFunction(u),s<r&&(c=l)}if(a<t){const u=this.content[a];o=this.scoreFunction(u),o<(c===null?r:s)&&(c=a)}if(c===null)break;this.content[e]=this.content[c],this.content[c]=n,e=c}}}/**
 * Kdtree
 * @class
 * @author Alexander Rose <alexander.rose@weirdbyte.de>, 2016
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 * @description
 * k-d Tree for typed arrays of 3d points (e.g. for Float32Array), in-place
 * provides fast nearest neighbour search
 *
 * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs
 *
 * Further information (including mathematical properties)
 * http://en.wikipedia.org/wiki/Binary_tree
 * http://en.wikipedia.org/wiki/K-d_tree
 *
 * @example
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * metric: function(a, b){
 *    return Math.pow(a[0]-b[0], 2) + Math.pow(a[1]-b[1], 2) + Math.pow(a[2]-b[2], 2);
 * }
 *
 * @param {Float32Array} points - points
 * @param {Function} metric - metric
 */class ahe{constructor(e,t){this.points=e,this.metric=t,this.maxDepth=0,this.currentNode=0;const n=e.length/3,r=new Uint32Array(n);for(let s=0;s<n;++s)r[s]=s;this.indices=r,this.nodes=new Int32Array(4*n),this.rootIndex=this.buildTree(0,-1,0,n)}buildTree(e,t,n,r){e>this.maxDepth&&(this.maxDepth=e);const s=r-n;if(s===0)return-1;const o=4*this.currentNode,a=this.nodes;if(this.currentNode+=1,s===1)return a[o]=n,a[o+1]=-1,a[o+2]=-1,a[o+3]=t,o;const l=this.indices,c=this.points,u=n+Math.floor(s/2),h=e%3;let d,f,p,_,v,g=n,b=r-1;for(;b>g;){for(p=g+b>>1,_=c[3*l[p]+h],f=l[p],l[p]=l[b],l[b]=f,v=g,d=g;d<b;++d)c[3*l[d]+h]<_&&(f=l[v],l[v]=l[d],l[d]=f,++v);if(f=l[b],l[b]=l[v],l[v]=f,p=v,u===p)break;u<p?b=p-1:g=p+1}return a[o]=u,a[o+1]=this.buildTree(e+1,o,n,u),a[o+2]=this.buildTree(e+1,o,u+1,r),a[o+3]=t,o}getNodeDepth(e){const t=this.nodes[e+3];return t===-1?0:this.getNodeDepth(t)+1}nearest(e,t,n){const r=new ohe(u=>-u[1]),s=this.nodes,o=this.points,a=this.indices,l=u=>{let h,d;const f=this.getNodeDepth(u)%3,p=3*a[s[u]],_=[o[p+0],o[p+1],o[p+2]],v=this.metric(e,_);function g(w,M){r.push([w,M]),r.size()>t&&r.pop()}const b=s[u+1],m=s[u+2];if(m===-1&&b===-1)return void((r.size()<t||v<r.peek()[1])&&v<=n&&g(u,v));h=m===-1?b:b===-1?m:e[f]<=o[p+f]?b:m,l(h),(r.size()<t||v<r.peek()[1])&&v<=n&&g(u,v);const y=[];for(let w=0;w<3;w+=1)y[w]=w===f?e[w]:o[p+w];const A=this.metric(y,_);(r.size()<t||Math.abs(A)<r.peek()[1])&&Math.abs(A)<=n&&(d=h===b?m:b,d!==-1&&l(d))};l(this.rootIndex);const c=[];for(let u=0,h=Math.min(r.size(),t);u<h;u+=1)c.push(r.content[u]);return c}verify(e,t=0){let n=1;if(e===void 0&&(e=this.rootIndex),e===-1)throw new Error("node is null");const r=t%3,s=this.nodes,o=this.points,a=this.indices,l=s[e+1],c=s[e+2];if(l!==-1){if(o[3*a[s[l]]+r]>o[3*a[s[e]]+r])throw new Error("left child is > parent!");n+=this.verify(l,t+1)}if(c!==-1){if(o[3*a[s[c]]+r]<o[3*a[s[e]]+r])throw new Error("right child is < parent!");n+=this.verify(c,t+1)}return n}}class n2{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get bondHash(){return this.structure.bondHash}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]}get residue(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)}get residueIndex(){return this.atomStore.residueIndex[this.index]}set residueIndex(e){this.atomStore.residueIndex[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.residueIndex)}get inscode(){return this.residueStore.getInscode(this.residueIndex)}get resno(){return this.residueStore.resno[this.residueIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])}get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])}get residueAtomOffset(){return this.residueStore.atomOffset[this.residueIndex]}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get atomname(){return this.atomType.atomname}get number(){return this.atomType.number}get element(){return this.atomType.element}get vdw(){return this.atomType.vdw}get covalent(){return this.atomType.covalent}get x(){return this.atomStore.x[this.index]}set x(e){this.atomStore.x[this.index]=e}get y(){return this.atomStore.y[this.index]}set y(e){this.atomStore.y[this.index]=e}get z(){return this.atomStore.z[this.index]}set z(e){this.atomStore.z[this.index]=e}get serial(){return this.atomStore.serial[this.index]}set serial(e){this.atomStore.serial[this.index]=e}get bfactor(){return this.atomStore.bfactor[this.index]}set bfactor(e){this.atomStore.bfactor[this.index]=e}get occupancy(){return this.atomStore.occupancy[this.index]}set occupancy(e){this.atomStore.occupancy[this.index]=e}get altloc(){return this.atomStore.getAltloc(this.index)}set altloc(e){this.atomStore.setAltloc(this.index,e)}get partialCharge(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null}set partialCharge(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)}get radius(){return this.atomStore.radius?this.atomStore.radius[this.index]:null}set radius(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)}get formalCharge(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null}set formalCharge(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)}get aromatic(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0}set aromatic(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)}get bondCount(){return this.bondHash.countArray[this.index]}eachBond(e,t){t=t||this.structure._bp;const n=this.index,r=this.bondHash,s=r.indexArray,o=r.countArray[n],a=r.offsetArray[n];for(let l=0;l<o;++l)t.index=s[a+l],e(t)}eachBondedAtom(e,t){const n=t||this.structure._ap,r=this.index;this.eachBond(function(s){n.index=r!==s.atomIndex1?s.atomIndex1:s.atomIndex2,e(n)}),this.index=r}hasBondTo(e){let t=!1;return this.eachBondedAtom(function(n){e.index===n.index&&(t=!0)}),t}bondToElementCount(e){let t=0;const n=this.index;return this.eachBondedAtom(function(r){r.number===e&&(t+=1)}),this.index=n,t}hasBondToElement(e){return this.bondToElementCount(e)>0}isBackbone(){const e=this.residueType.backboneIndexList;return e.length>0&&e.includes(this.index-this.residueAtomOffset)}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isSidechain(){return this.isPolymer()&&!this.isBackbone()}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isTrace(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset}isHetero(){return this.residueType.hetero===1}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isHelix(){return LV.includes(this.sstruc)}isSheet(){return DV.includes(this.sstruc)}isTurn(){return NV.includes(this.sstruc)&&this.isProtein()}isBonded(){return this.bondHash.countArray[this.index]!==0}isRing(){return this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]!==void 0}isAromatic(){return this.aromatic===1}isPolarHydrogen(){let e=!1;return this.number!==1||(e=!this.hasBondToElement(6)),e}isMetal(){return this.atomType.isMetal()}isNonmetal(){return this.atomType.isNonmetal()}isMetalloid(){return this.atomType.isMetalloid()}isHalogen(){return this.atomType.isHalogen()}isDiatomicNonmetal(){return this.atomType.isDiatomicNonmetal()}isPolyatomicNonmetal(){return this.atomType.isPolyatomicNonmetal()}isAlkaliMetal(){return this.atomType.isAlkaliMetal()}isAlkalineEarthMetal(){return this.atomType.isAlkalineEarthMetal()}isNobleGas(){return this.atomType.isNobleGas()}isTransitionMetal(){return this.atomType.isTransitionMetal()}isPostTransitionMetal(){return this.atomType.isPostTransitionMetal()}isLanthanide(){return this.atomType.isLanthanide()}isActinide(){return this.atomType.isActinide()}getDefaultValence(){return this.atomType.getDefaultValence()}getValenceList(){return this.atomType.getValenceList()}getOuterShellElectronCount(){return this.atomType.getOuterShellElectronCount()}distanceTo(e){const t=this.atomStore,n=e.atomStore,r=this.index,s=e.index,o=t.x[r]-n.x[s],a=t.y[r]-n.y[s],l=t.z[r]-n.z[s],c=o*o+a*a+l*l;return Math.sqrt(c)}connectedTo(e){const t=this.atomStore,n=e.atomStore,r=this.index,s=e.index;if(t.altloc&&n.altloc){const f=t.altloc[r],p=n.altloc[s];if(f!==0&&p!==0&&f!==32&&p!==32&&f!==p)return!1}const o=t.x[r]-n.x[s],a=t.y[r]-n.y[s],l=t.z[r]-n.z[s],c=o*o+a*a+l*l;if(c<48&&this.isCg())return!0;if(isNaN(c))return!1;const u=this.covalent+e.covalent,h=u+.3,d=u-.5;return c<h*h&&c>d*d}positionFromArray(e,t=0){return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}positionToArray(e=[],t=0){const n=this.index,r=this.atomStore;return e[t+0]=r.x[n],e[t+1]=r.y[n],e[t+2]=r.z[n],e}positionToVector3(e){return e===void 0&&(e=new me),e.x=this.x,e.y=this.y,e.z=this.z,e}positionFromVector3(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}positionAdd(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}positionSub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}getResidueBonds(e=!1){const t=this.residueAtomOffset,n=this.index-this.residueAtomOffset,r=this.residueType.getBonds(),s=r.atomIndices1,o=r.atomIndices2;let a,l,c,u;for(e||(u=[]),a=s.indexOf(n);a!==-1;){if(c=o[a]+t,!u)return c;u.push(c),a=s.indexOf(n,a+1)}for(l=o.indexOf(n);l!==-1;){if(c=s[l]+t,!u)return c;u.push(c),l=o.indexOf(n,l+1)}return u}qualifiedName(e=!1){var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chainname&&(t+=":"+this.chainname),this.atomname&&(t+="."+this.atomname),this.altloc&&(t+="%"+this.altloc),this.structure.modelStore.count>1&&(t+="/"+this.modelIndex),t}clone(){return new n2(this.structure,this.index)}toObject(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}}}function eH(i,e){const t=i[0]-e[0],n=i[1]-e[1],r=i[2]-e[2];return t*t+n*n+r*r}function lhe(i,e){return Math.sqrt(eH(i,e))}const bA=new Float32Array(3);class che{constructor(e,t=!1){pt&&tt.time("Kdtree build");const n=t?eH:lhe,r=new Float32Array(3*e.atomCount),s=new Uint32Array(e.atomCount);let o=0;e.eachAtom(function(a){r[o+0]=a.x,r[o+1]=a.y,r[o+2]=a.z,s[o/3]=a.index,o+=3}),this.atomIndices=s,this.points=r,this.kdtree=new ahe(r,n),pt&&tt.timeEnd("Kdtree build")}nearest(e,t,n){e instanceof me?e.toArray(bA):e instanceof n2&&e.positionToArray(bA);const r=this.kdtree.nearest(bA,t,n),s=this.kdtree.indices,o=this.kdtree.nodes,a=this.atomIndices,l=[];for(let c=0,u=r.length;c<u;++c){const h=r[c],d=h[0],f=h[1];l.push({index:a[s[o[d]]],distance:f})}return l}}const uhe={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},hhe={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},dhe=/^[1-9]$/;function tH(i){let e="";return i.length>0&&(e=":"+p3(i).join(" OR :")),new ii(e)}class Wu{constructor(e=""){this.name=e,this.partList=[]}get type(){return"Assembly"}addPart(e,t){const n=new fhe(e,t);return this.partList.push(n),n}getAtomCount(e){return this.partList.reduce((t,n)=>t+n.getAtomCount(e),0)}getResidueCount(e){return this.partList.reduce((t,n)=>t+n.getResidueCount(e),0)}getInstanceCount(){let e=0;return this.partList.forEach(function(t){e+=t.matrixList.length}),e}isIdentity(e){if(this.partList.length!==1)return!1;const t=this.partList[0];if(t.matrixList.length!==1||!new Ct().equals(t.matrixList[0]))return!1;let n=[];return e.eachChain(function(r){n.push(r.chainname)}),n=p3(n),t.chainList.length===n.length}getBoundingBox(e){const t=new Li;return this.partList.forEach(function(n){const r=n.getBoundingBox(e);t.expandByPoint(r.min),t.expandByPoint(r.max)}),t}getCenter(e){return this.getBoundingBox(e).getCenter(new me)}getSelection(){let e=[];return this.partList.forEach(function(t){e=e.concat(t.chainList)}),tH(e)}}class fhe{constructor(e=[],t=[]){this.matrixList=e,this.chainList=t}get type(){return"AssemblyPart"}_getCount(e,t){let n=0;return e.eachChain(r=>{(this.chainList.length===0||this.chainList.includes(r.chainname))&&(n+=r[t])}),this.matrixList.length*n}getAtomCount(e){return this._getCount(e,"atomCount")}getResidueCount(e){return this._getCount(e,"residueCount")}getBoundingBox(e){const t=new Li,n=new Li,r=this.getSelection(),s=e.getBoundingBox(r);return this.matrixList.forEach(function(o){n.copy(s).applyMatrix4(o),t.expandByPoint(n.min),t.expandByPoint(n.max)}),t}getSelection(){return tH(this.chainList)}getView(e){const t=this.getSelection();return t?e.getView(t):e}getInstanceList(){const e=[];for(let t=0,n=this.matrixList.length;t<n;++t)e.push({id:t+1,name:t,matrix:this.matrixList[t]});return e}}class phe{constructor(e){this.structure=e,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1}addResidueType(e){var t,n;const r=this.structure.atomStore,s=this.structure.residueStore,o=this.structure.residueMap,a=(t=this.structure.chemCompMap)===null||t===void 0?void 0:t.dict[this.previousResname],l=s.atomCount[e],c=s.atomOffset[e],u=new Array(l);for(let f=0;f<l;++f)u[f]=r.atomTypeId[c+f];const h=a==null?void 0:a.chemCompType,d=a?(n=this.structure.chemCompMap)===null||n===void 0?void 0:n.getBonds(this.previousResname,u):void 0;s.residueTypeId[e]=o.add(this.previousResname,u,this.previousHetero,h,d)}addAtom(e,t,n,r,s,o,a,l){const c=this.structure.atomStore,u=this.structure.residueStore,h=this.structure.chainStore,d=this.structure.modelStore;let f=!1,p=!1,_=!1;this.currentModelindex!==e?(f=!0,p=!0,_=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==n?(p=!0,_=!0,this.ci+=1,this.ri+=1):this.currentResno===s&&this.currentResname===r&&this.currentInscode===l||(_=!0,this.ri+=1),this.ai+=1,f&&(d.growIfFull(),d.chainOffset[this.mi]=this.ci,d.chainCount[this.mi]=0,d.count+=1,h.modelIndex[this.ci]=this.mi),p&&(h.growIfFull(),h.setChainname(this.ci,t),h.setChainid(this.ci,n),h.residueOffset[this.ci]=this.ri,h.residueCount[this.ci]=0,h.count+=1,h.modelIndex[this.ci]=this.mi,d.chainCount[this.mi]+=1,u.chainIndex[this.ri]=this.ci),_&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),u.growIfFull(),u.resno[this.ri]=s,a!==void 0&&(u.sstruc[this.ri]=a.charCodeAt(0)),l!==void 0&&(u.inscode[this.ri]=l.charCodeAt(0)),u.atomOffset[this.ri]=this.ai,u.atomCount[this.ri]=0,u.count+=1,u.chainIndex[this.ri]=this.ci,h.residueCount[this.ci]+=1),c.count+=1,c.residueIndex[this.ai]=this.ri,u.atomCount[this.ri]+=1,this.currentModelindex=e,this.currentChainid=n,this.currentResname=r,this.currentResno=s,this.currentInscode=l,this.currentHetero=o}finalize(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)}}function nH(i,e){if(!e)return;pt&&tt.time("assignSecondaryStructure");const t=[];i.eachModel(function(c){c.eachChain(function(u){t.push(u.chainname)})});const n=t.slice().sort(),r=[];n.forEach(function(c){r.push(t.indexOf(c))});const s=e.helices.filter(function(c){return Hh(n,c[0])>=0});s.sort(function(c,u){const h=c[0],d=u[0],f=c[1],p=u[1];if(h===d)return f===p?0:f<p?-1:1;{const _=Hh(n,h),v=Hh(n,d);return r[_]<r[v]?-1:1}});const o=i.residueStore;i.eachModel(function(c){let u=0;const h=s.length;if(h===0)return;let d=s[u],f=!1,p=!1;c.eachChain(function(_){let v=!1;if(_.chainname===d[0]){const g=_.residueCount,b=_.residueOffset,m=b+g;for(let y=b;y<m;++y)if(o.resno[y]===d[1]&&o.getInscode(y)===d[2]&&(f=!0),f&&(o.sstruc[y]=d[6],o.resno[y]===d[4]&&o.getInscode(y)===d[5]&&(f=!1,u+=1,u<h?(y=b-1,d=s[u],v=_.chainname!==d[0]):p=!0)),v||p)return}})});const a=e.sheets.filter(function(c){return Hh(n,c[0])>=0});a.sort(function(c,u){const h=c[0],d=u[0];if(h===d)return 0;const f=Hh(n,h),p=Hh(n,d);return r[f]<r[p]?-1:1});const l=101;i.eachModel(function(c){let u=0;const h=a.length;if(h===0)return;let d=a[u],f=!1,p=!1;c.eachChain(function(_){let v=!1;if(_.chainname===d[0]){const g=_.residueCount,b=_.residueOffset,m=b+g;for(let y=b;y<m;++y)if(o.resno[y]===d[1]&&o.getInscode(y)===d[2]&&(f=!0),f&&(o.sstruc[y]=l,o.resno[y]===d[4]&&o.getInscode(y)===d[5]&&(f=!1,u+=1,u<h?(y=b-1,d=a[u],v=_.chainname!==d[0]):p=!0)),v||p)return}})}),pt&&tt.timeEnd("assignSecondaryStructure")}const i2=function(){const i=function(n,r,s,o){const a=n.structure,l=n.residueIndexStart,c=a.getResidueProxy(),u=a.getResidueProxy(),h=a.getAtomProxy(),d=a.getAtomProxy();for(let f=Math.max(0,r-2);f<=r;++f)for(let p=2;p<5;++p){if(f+p>=n.residueCount)continue;c.index=l+f,u.index=l+f+p,h.index=c.traceAtomIndex,d.index=u.traceAtomIndex;const _=h.distanceTo(d);if(Math.abs(_-s[p-2])>o)return!1}return!0},e=function(n,r){return i(n,r,[5.45,5.18,6.37],2.1)},t=function(n,r){return i(n,r,[6.1,10.4,13],1.42)};return function(n){pt&&tt.time("calculateSecondaryStructure"),n.eachPolymer(function(r){if(r.residueCount<4)return;if(r.isCg())(function(a){const l=a.residueStore,c=a.residueIndexStart,u=new JV(a).position,h=new me,d=new me;for(let f=0,p=a.residueCount;f<p;++f){h.fromArray(u.center,3*f),d.fromArray(u.center,3*f+3);const _=h.distanceTo(d);_<2&&_>1&&u.bending[f]<20&&(l.sstruc[c+f]=104,l.sstruc[c+f+1]=104)}})(r);else{if(!r.isProtein())return;(function(a){const l=a.residueStore,c=a.residueIndexStart;for(let u=0,h=a.residueCount;u<h;++u){let d="c";e(a,u)?d="h":t(a,u)&&(d="e"),l.sstruc[c+u]=d.charCodeAt(0)}})(r)}let s,o=0;r.eachResidue(function(a){a.sstruc===s?o+=1:(o===1&&(a.index-=1,a.sstruc="c"),o=1,s=a.sstruc)})}),pt&&tt.timeEnd("calculateSecondaryStructure")}}(),SA="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function M1(i){const e=SA.length;let t=i,n=0,r=SA[t%e];for(;t>=e;)t=Math.floor(t/e),r+=SA[t%e],n+=1;return n>=5&&tt.warn("chainname overflow"),r}function r2(i,e=!1){pt&&tt.time("calculateChainnames");let t=!0;if(i.eachChain(function(n){n.chainname&&(t=!1)}),t){const n=i.modelStore,r=i.chainStore,s=i.residueStore,o=function(_,v,g,b){const m=r.count;for(let y=0;y<b;++y)s.chainIndex[g+y]=m;r.growIfFull(),r.modelIndex[m]=_,r.setChainname(m,v),r.setChainid(m,v),r.residueOffset[m]=g,r.residueCount[m]=b,r.count+=1,n.chainCount[_]+=1},a=i.getAtomProxy(),l=i.getAtomProxy();let c=0,u=0,h=0,d=0;const f=[];s.count===1?f.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):i.eachResidueN(2,function(_,v){let g=!1;const b=_.backboneType,m=v.backboneType,y=Dd;d=_.index,_.modelIndex!==v.modelIndex||_.moleculeType!==v.moleculeType?g=!0:b!==y&&b===m&&(a.index=_.backboneEndAtomIndex,l.index=v.backboneStartAtomIndex,g=e?!a.hasBondTo(l):!a.connectedTo(l)),g||v.index!==s.count-1||(g=!0,d=v.index),g&&(f.push({mIndex:u,chainname:M1(c),rStart:h,rCount:d-h+1}),c+=1,_.modelIndex!==v.modelIndex&&(c=0,u+=1),v.index===s.count-1&&d!==v.index&&f.push({mIndex:u,chainname:M1(c),rStart:s.count-1,rCount:1}),h=v.index,d=v.index)}),r.count=0,n.chainCount.fill(0,0,n.count),n.chainOffset.fill(0,0,n.count),f.forEach(function(_){o(_.mIndex,_.chainname,_.rStart,_.rCount)});let p=0;i.eachModel(function(_){n.chainOffset[_.index]=p,p+=n.chainCount[_.index]})}pt&&tt.timeEnd("calculateChainnames")}function Ub(i,e="all"){e!=="none"&&(pt&&tt.time("calculateBonds"),Om(i,!1,e),Bm(i),pt&&tt.timeEnd("calculateBonds"))}const mhe={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function h4(i,e,t){return[e,t]=e<t?[e,t]:[t,e],Vp.includes(i)&&e==="C"&&t==="O"||P0.includes(i)&&e==="OP1"&&t==="P"?2:mhe[`${i}|${e}|${t}`]||1}function Om(i,e=!1,t="all"){pt&&tt.time("calculateBondsWithin");const n=i.bondStore,r=i.rungBondStore,s=i.getAtomSet(!1),o=i.getAtomProxy(),a=i.getAtomProxy(),l=i.getBondProxy(),c=e?null:function(h){pt&&tt.time("calculateAtomBondMap");var d=[];return h.eachBond(function(f){var p=f.atomIndex1,_=f.atomIndex2;d[p]===void 0&&(d[p]=[]),d[p][_]=f.index}),pt&&tt.timeEnd("calculateAtomBondMap"),d}(i);let u;e||t!=="auto"||(u=new Set,c.forEach((h,d)=>{u.add(d),h.forEach(f=>{u.add(f)})})),i.eachResidue(function(h){if(!e&&c){const p=h.atomCount,_=h.atomOffset;if(p>500)return void tt.warn("more than 500 atoms, skip residue for auto-bonding",h.qualifiedName());if(t==="auto"&&h.hetero){for(let A=h.atomOffset;A<h.atomEnd;A++)if(u.has(A))return}const v=h.getBonds(),g=v.atomIndices1,b=v.atomIndices2,m=v.bondOrders,y=g.length;for(let A=0;A<y;++A){const w=g[A],M=b[A],T=w+_,E=M+_,C=c[T];C!==void 0&&C[E]!==void 0?(l.index=C[E],m[h.residueType.getBondIndex(w,M)]=l.bondOrder):(o.index=T,a.index=E,n.addBond(o,a,m[A]))}}const d=h.residueType.traceAtomIndex,f=h.residueType.rungEndAtomIndex;d!==-1&&f!==-1&&(o.index=h.traceAtomIndex,a.index=h.rungEndAtomIndex,r.addBond(o,a),s.set(o.index),s.set(a.index))}),i.atomSetDict.rung=s,pt&&tt.timeEnd("calculateBondsWithin")}function Bm(i,e=!1,t=!1){pt&&tt.time("calculateBondsBetween");const n=i.bondStore,r=i.backboneBondStore,s=i.getAtomSet(!1),o=i.getAtomProxy(),a=i.getAtomProxy();function l(h,d){const f=h.backboneType,p=d.backboneType;if(f!==Dd&&f===p){o.index=h.backboneEndAtomIndex,a.index=d.backboneStartAtomIndex;let _=!1,v=!1;t&&o.hasBondTo(a)?(_=!1,v=!0):o.connectedTo(a)&&(_=!e,v=!0),_&&n.addBond(o,a,1),v&&(o.index=h.traceAtomIndex,a.index=d.traceAtomIndex,r.addBond(o,a),s.set(o.index),s.set(a.index))}}r.count===0&&r.resize(i.residueStore.count),i.eachResidueN(2,l);const c=i.getResidueProxy(),u=i.getResidueProxy();if(i.eachChain(function(h){h.residueCount!==0&&(c.index=h.residueOffset,u.index=h.residueOffset+h.residueCount-1,l(u,c))}),i.atomSetDict.backbone=s,!e){pt&&tt.time("calculateBondsBetween inter");const h=i.spatialHash;i.eachResidue(function(d){d.backboneType!==Dd||d.isWater()||d.eachAtom(function(f){f.isMetal()||h.eachWithin(f.x,f.y,f.z,4,function(p){a.index=p,f.modelIndex!==a.modelIndex||f.residueIndex===a.residueIndex||a.isMetal()||n.addBondIfConnected(f,a,1)})})}),pt&&tt.timeEnd("calculateBondsBetween inter")}pt&&tt.timeEnd("calculateBondsBetween")}function Ob(i){if(!i.unitcell)return;pt&&tt.time("buildUnitcellAssembly");const e=i.unitcell,t=i.center.clone().applyMatrix4(e.cartToFrac),n=t.clone().floor(),r=function(p){const _=hhe[p],v={};if(_===void 0)return console.warn(`spacegroup '${p}' not found in symop library`),v;const g=[];for(let b=0,m=_.length;b<m;b+=3){const y=[];for(let A=0;A<3;++A)y.push(uhe[_[b+A]]);g.push(y)}return g.forEach(function(b){let m=0;const y=new Ct().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),A=y.elements;v[b.toString()]=y,b.forEach(function(w){let M=!1,T=!1;for(let E=0,C=w.length;E<C;++E){const N=w[E];if(N==="-")M=!0;else if(N==="+")M=!1;else if(N==="/")T=!0;else if(N==="X")A[0+m]=M?-1:1;else if(N==="Y")A[4+m]=M?-1:1;else if(N==="Z")A[8+m]=M?-1:1;else if(dhe.test(N)){const P=parseInt(N);T?A[12+m]/=P:A[12+m]=P}else tt.warn(`getSymmetryOperations: unknown token '${N}'`)}m+=1})}),v}(e.spacegroup),s=new me,o=new me;function a(p){const _=[];return Object.keys(r).forEach(function(v){const g=r[v].clone();s.copy(t).applyMatrix4(g).floor(),o.setFromMatrixPosition(g),o.sub(s),o.add(n),p&&o.add(p),g.setPosition(o),g.multiplyMatrices(e.fracToCart,g),g.multiply(e.cartToFrac),_.push(g)}),_}const l=new Wu("UNITCELL"),c=a(),u=[];if(i.biomolDict.NCS){u.push(new Ct,...i.biomolDict.NCS.partList[0].matrixList);const p=[];c.forEach(_=>{u.forEach(v=>{p.push(_.clone().multiply(v))})}),l.addPart(p)}else l.addPart(c);const h=new me,d=new Wu("SUPERCELL"),f=Array.prototype.concat.call(a(h.set(1,0,0)),a(h.set(0,1,0)),a(h.set(0,0,1)),a(h.set(-1,0,0)),a(h.set(0,-1,0)),a(h.set(0,0,-1)),a(h.set(1,1,0)),a(h.set(1,0,1)),a(h.set(0,1,1)),a(h.set(-1,-1,0)),a(h.set(-1,0,-1)),a(h.set(0,-1,-1)),a(h.set(1,-1,-1)),a(h.set(1,1,-1)),a(h.set(1,-1,1)),a(h.set(-1,1,1)),a(h.set(-1,-1,1)),a(h.set(-1,1,-1)),a(h.set(0,1,-1)),a(h.set(0,-1,1)),a(h.set(1,0,-1)),a(h.set(-1,0,1)),a(h.set(1,-1,0)),a(h.set(-1,1,0)),a(),a(h.set(1,1,1)),a(h.set(-1,-1,-1)));if(i.biomolDict.NCS){const p=[];f.forEach(function(_){u.forEach(function(v){p.push(_.clone().multiply(v))})}),d.addPart(p)}else d.addPart(f);i.biomolDict.UNITCELL=l,i.biomolDict.SUPERCELL=d,pt&&tt.timeEnd("buildUnitcellAssembly")}const d4=["H","C","O","N","S","P"],ghe=["NA","CL","FE"];function w3(i){let e=i.toUpperCase(),t=0,n=0;for(let s=0;s<e.length;s++)if(e.charCodeAt(s)<65){if(n>0)break;++t}else n=s+1;(t>0||n<e.length)&&(e=e.substring(t,n));const r=e.length;if(r===0)return"";if(r===1)return e;if(r===2){if(ghe.indexOf(e)!==-1)return e;if(d4.indexOf(e[0])!==-1)return e[0];if(e in FV)return e}return r>=3&&d4.indexOf(e[0])!==-1?e[0]:""}function Nd(i){const e=i.bondHash,t=e.countArray,n=e.offsetArray,r=e.indexArray,s=i.getBondProxy();i.eachResidue(function(o){const a=o.residueType;if(a.bonds!==void 0)return;var l=o.atomOffset,c=[],u=[],h=[],d={};const f=l+o.atomCount;o.eachAtom(function(p){const _=p.index,v=n[_];for(let g=0,b=t[_];g<b;++g){s.index=r[v+g];let m=s.atomIndex1;if(m<l||m>=f)continue;let y=s.atomIndex2;if(y<l||y>=f)continue;if(m>y){const w=y;y=m,m=w}const A=m+"|"+y;d[A]===void 0&&(d[A]=!0,c.push(m-l),u.push(y-l),h.push(s.bondOrder))}}),a.bonds={atomIndices1:c,atomIndices2:u,bondOrders:h}})}const vhe=[3,11,19,37,55,87],_he=[4,12,20,38,56,88],yhe=[6,15,16,34],xhe=[1,7,8,9,17,35,53],bhe=[2,10,18,36,54,86],She=[13,30,31,48,49,50,80,81,82,83,84,85,112],whe=[5,14,32,33,51,52,85],Mhe=[9,17,35,53,85];class Ahe{constructor(e,t,n){this.structure=e,this.atomname=t,n=n||w3(t),this.element=n,this.number=FV[n]||0,this.vdw=rue[this.number]||2,this.covalent=sue[this.number]||1.6}getDefaultValence(){const e=ZU[this.number];return e?e[0]:-1}getValenceList(){return ZU[this.number]||[]}getOuterShellElectronCount(){return oue[this.number]||2}isMetal(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()}isNonmetal(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()}isMetalloid(){return whe.includes(this.number)}isHalogen(){return Mhe.includes(this.number)}isDiatomicNonmetal(){return xhe.includes(this.number)}isPolyatomicNonmetal(){return yhe.includes(this.number)}isAlkaliMetal(){return vhe.includes(this.number)}isAlkalineEarthMetal(){return _he.includes(this.number)}isNobleGas(){return bhe.includes(this.number)}isTransitionMetal(){const e=this.number;return e>=21&&e<=29||e>=39&&e<=47||e>=72&&e<=79||e>=104&&e<=108}isPostTransitionMetal(){return She.includes(this.number)}isLanthanide(){return this.number>=57&&this.number<=71}isActinide(){return this.number>=89&&this.number<=103}}class Ehe{constructor(e){this.structure=e,this.dict={},this.list=[],this.structure=e}add(e,t){const n=function(s,o){return s+"|"+o}(e=e.toUpperCase(),t=t?t.toUpperCase():w3(e));let r=this.dict[n];if(r===void 0){const s=new Ahe(this.structure,e,t);r=this.list.length,this.dict[n]=r,this.list.push(s)}return r}get(e){return this.list[e]}}class The{constructor(e,t,n,r,s,o){this.structure=e,this.bondReferenceAtomIndices=[],this.resname=t,this.atomTypeIdList=n,this.hetero=r?1:0,this.chemCompType=s,this.bonds=o,this.atomCount=n.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();const a=s0[this.backboneType],l=s0[this.backboneStartType],c=s0[this.backboneEndType],u=this.getAtomIndexByName(a.trace);this.traceAtomIndex=he(u,-1);const h=this.getAtomIndexByName(a.direction1);this.direction1AtomIndex=he(h,-1);const d=this.getAtomIndexByName(a.direction2);this.direction2AtomIndex=he(d,-1);const f=this.getAtomIndexByName(l.backboneStart);this.backboneStartAtomIndex=he(f,-1);const p=this.getAtomIndexByName(c.backboneEnd);let _;this.backboneEndAtomIndex=he(p,-1),_=lue.includes(t)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=he(_,-1)}getBackboneIndexList(){const e=[];let t;switch(this.moleculeType){case 3:t=hue;break;case 4:case 5:t=OV;break;default:return e}const n=this.structure.atomMap,r=this.atomTypeIdList;for(let s=0,o=this.atomCount;s<o;++s){const a=n.get(r[s]);t.includes(a.atomname)&&e.push(s)}return e}getMoleculeType(){return this.isProtein()?3:this.isRna()?4:this.isDna()?5:this.isWater()?1:this.isIon()?2:this.isSaccharide()?6:0}getBackboneType(e){return this.hasProteinBackbone(e)?1:this.hasRnaBackbone(e)?2:this.hasDnaBackbone(e)?3:this.hasCgProteinBackbone(e)?4:this.hasCgRnaBackbone(e)?5:this.hasCgDnaBackbone(e)?6:Dd}isProtein(){return this.chemCompType?eue.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||Vp.includes(this.resname)}isCg(){const e=this.backboneType;return e===4||e===5||e===6}isNucleic(){return this.isRna()||this.isDna()}isRna(){return this.chemCompType?tue.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||kV.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))}isDna(){return this.chemCompType?nue.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||UV.includes(this.resname))}isHetero(){return this.hetero===1}isIon(){return cue.includes(this.resname)}isWater(){return Fb.includes(this.resname)}isSaccharide(){return this.chemCompType?IV.includes(this.chemCompType):uue.includes(this.resname)}isStandardAminoacid(){return Vp.includes(this.resname)}isStandardBase(){return P0.includes(this.resname)}hasBackboneAtoms(e,t){const n=s0[t];return e===-1?this.hasAtomWithName(n.trace,n.backboneEnd,n.direction1,n.direction2):e===0?this.hasAtomWithName(n.trace,n.direction1,n.direction2):e===1?this.hasAtomWithName(n.trace,n.backboneStart,n.direction1,n.direction2):this.hasAtomWithName(n.trace,n.backboneStart,n.backboneEnd,n.direction1,n.direction2)}hasProteinBackbone(e){return this.isProtein()&&this.hasBackboneAtoms(e,1)}hasRnaBackbone(e){return this.isRna()&&this.hasBackboneAtoms(e,2)}hasDnaBackbone(e){return this.isDna()&&this.hasBackboneAtoms(e,3)}hasCgProteinBackbone(e){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(e,4)}hasCgRnaBackbone(e){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(e,5)}hasCgDnaBackbone(e){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(e,6)}hasBackbone(e){return this.hasProteinBackbone(e)||this.hasRnaBackbone(e)||this.hasDnaBackbone(e)||this.hasCgProteinBackbone(e)||this.hasCgRnaBackbone(e)||this.hasCgDnaBackbone(e)}getAtomIndexByName(e){const t=this.atomCount,n=this.structure.atomMap,r=this.atomTypeIdList;if(Array.isArray(e))for(let s=0;s<t;++s){const o=r[s];if(e.includes(n.get(o).atomname))return s}else for(let s=0;s<t;++s){const o=r[s];if(e===n.get(o).atomname)return s}}hasAtomWithName(...e){const t=e.length;for(let n=0;n<t;++n)if(e[n]!==void 0&&this.getAtomIndexByName(e[n])===void 0)return!1;return!0}getBonds(e){return this.bonds===void 0&&(this.bonds=function(t){const n=t.structure,r=n.getAtomProxy(),s=n.getAtomProxy(),o=t.atomCount,a=t.atomOffset,l=a+o-1,c=[],u=[],h=[];if(o>500)pt&&tt.warn("more than 500 atoms, skip residue for auto-bonding",t.qualifiedName());else if(o>50){const d=new che(t,!0),f=t.isCg()?1.2:2.3;for(let p=a;p<l;++p){r.index=p;const _=r.covalent+f+.3,v=d.nearest(r,1/0,_*_),g=v.length;for(let b=0;b<g;++b)s.index=v[b].index,r.index<s.index&&r.connectedTo(s)&&(c.push(r.index-a),u.push(s.index-a),h.push(h4(r.resname,r.atomname,s.atomname)))}}else for(let d=a;d<l;++d){r.index=d;for(let f=d+1;f<=l;++f)s.index=f,r.connectedTo(s)&&(c.push(d-a),u.push(f-a),h.push(h4(r.resname,r.atomname,s.atomname)))}return{atomIndices1:c,atomIndices2:u,bondOrders:h}}(e)),this.bonds}getRings(){return this.rings===void 0&&this.calculateRings(),this.rings}getBondGraph(){return this.bondGraph===void 0&&this.calculateBondGraph(),this.bondGraph}getAromatic(e){return this.aromaticAtoms===void 0&&this.calculateAromatic(this.structure.getResidueProxy(e.residueIndex)),this.aromaticAtoms}getAromaticRings(e){return this.aromaticRings===void 0&&this.calculateAromatic(e),this.aromaticRings}calculateBondGraph(){const e=this.bondGraph={},t=this.getBonds(),n=t.atomIndices1.length,r=t.atomIndices1,s=t.atomIndices2;for(let o=0;o<n;++o){const a=r[o],l=s[o];(e[a]=e[a]||[]).push(l),(e[l]=e[l]||[]).push(a)}}calculateRings(){const e=function(t,n){const r={count:n,visited:new Int32Array(n),queue:new Int32Array(n),pred:new Int32Array(n),left:new Int32Array(R0),right:new Int32Array(R0),color:new Int32Array(n),currentColor:0,rings:[],atomRings:[],bonds:t};for(let s=0;s<n;s++)r.visited[s]=-1,r.pred[s]=-1;return r}(this.getBondGraph(),this.atomCount);for(let t=0;t<e.count;t++)e.visited[t]>=0||Ihe(e,t);this.rings={atomRings:e.atomRings,rings:e.rings}}isAromatic(e){return this.aromaticAtoms=this.getAromatic(e),this.aromaticAtoms[e.index-e.residueAtomOffset]===1}calculateAromatic(e){const t=this.aromaticAtoms=new Uint8Array(this.atomCount),n=this.getRings().rings,r=n.map(o=>function(a){if(a.some(h=>!Che.includes(h.number)))return!1;let l=0;const c=new On(3,a.length),u=c.data;return a.forEach(h=>{u[l+0]=h.x,u[l+1]=h.y,u[l+2]=h.z,l+=3}),new QV(c).vecC.length()<Phe}(o.map(a=>this.structure.getAtomProxy(a+e.atomOffset)))),s=this.aromaticRings=[];n.forEach((o,a)=>{r[a]&&(s.push(o),o.forEach(l=>t[l]=1))})}assignBondReferenceAtomIndices(){const e=this.getBondGraph(),t=this.getRings(),n=t.atomRings,r=t.rings,s=this.bonds,o=s.atomIndices1,a=s.atomIndices2,l=s.bondOrders,c=this.bondReferenceAtomIndices,u=s.atomIndices1.length;c.length=0;for(let h=0;h<u;++h){if(l[h]<=1)continue;let d;const f=o[h],p=a[h],_=n[f],v=n[p];if(_&&v){for(let g=0;g<_.length;g++)if(v.indexOf(_[g])!==-1){d=r[_[g]];break}}if(e[f].length>1)for(let g=0;g<e[f].length;++g){const b=e[f][g];if(b!==p&&(d===void 0||d.indexOf(b)!==-1)){c[h]=b;break}}else if(e[p].length>1)for(let g=0;g<e[p].length;++g){const b=e[p][g];if(b!==f&&(d===void 0||d.indexOf(b)!==-1)){c[h]=b;break}}}}getBondIndex(e,t){const n=this.bonds,r=n.atomIndices1,s=n.atomIndices2;let o=r.indexOf(e),a=s.indexOf(t);const l=a;for(;o!==-1;){for(;a!==-1;){if(o===a)return o;a=s.indexOf(t,a+1)}o=r.indexOf(e,o+1),a=l}}getBondReferenceAtomIndex(e,t){const n=this.getBondIndex(e,t);if(n!==void 0)return this.bondReferenceAtomIndices.length===0&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[n]}}const Che=[5,6,7,8,14,15,16,32,33,50,51,83],Phe=.05;function Rhe(i,e,t){if(t<e)return;const{pred:n,color:r,left:s,right:o}=i,a=++i.currentColor;let l=e;for(let g=0;g<R0&&(r[l]=a,l=n[l],!(l<0));g++);let c=0,u=0,h=!1,d=0;l=t;for(let g=0;g<R0;g++){if(r[l]===a){d=l,h=!0;break}if(o[u++]=l,l=n[l],l<0)break}if(!h)return;l=e;for(let g=0;g<R0&&(s[c++]=l,d!==l)&&(l=n[l],!(l<0));g++);const f=c+u,p=new Array(f);let _=0;for(let g=0;g<c;g++)p[_++]=s[g];for(let g=u-1;g>=0;g--)p[_++]=o[g];const v=i.rings.length;for(let g=0;g<f;++g){const b=p[g];i.atomRings[b]?i.atomRings[b].push(v):i.atomRings[b]=[v]}i.rings.push(p)}function Ihe(i,e){const{bonds:t,visited:n,queue:r,pred:s}=i;n[e]=1,r[0]=e;let o=0,a=1;for(;o<a;){const l=r[o++],c=0;if(t[l]===void 0)continue;const u=t[l].length;for(let h=c;h<u;h++){const d=t[l][h];n[d]>0?s[d]!==l&&s[l]!==d&&Rhe(i,l,d):(n[d]=1,r[a++]=d,s[d]=l)}}}const R0=4;class Lhe{constructor(e){this.structure=e,this.dict={},this.list=[]}add(e,t,n,r="",s){const o=function(l,c,u,h=""){return l+"|"+c.join(",")+"|"+(u?1:0)+"|"+h}(e=e.toUpperCase(),t,n,r);let a=this.dict[o];if(a===void 0){const l=new The(this.structure,e,t,n,r,s);a=this.list.length,this.dict[o]=a,this.list.push(l)}return a}get(e){return this.list[e]}}class M3{constructor(e,t=0){this.structure=e,this.index=t,this.bondStore=e.bondStore,this._v12=new me,this._v13=new me,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()}get atom1(){return this.structure.getAtomProxy(this.atomIndex1)}get atom2(){return this.structure.getAtomProxy(this.atomIndex2)}get atomIndex1(){return this.bondStore.atomIndex1[this.index]}set atomIndex1(e){this.bondStore.atomIndex1[this.index]=e}get atomIndex2(){return this.bondStore.atomIndex2[this.index]}set atomIndex2(e){this.bondStore.atomIndex2[this.index]=e}get bondOrder(){return this.bondStore.bondOrder[this.index]}set bondOrder(e){this.bondStore.bondOrder[this.index]=e}getOtherAtomIndex(e){return e===this.atomIndex1?this.atomIndex2:this.atomIndex1}getOtherAtom(e){return this.structure.getAtomProxy(this.getOtherAtomIndex(e.index))}getReferenceAtomIndex(){const e=this._ap1,t=this._ap2;if(e.index=this.atomIndex1,t.index=this.atomIndex2,e.residueIndex!==t.residueIndex)return;const n=e.index-e.residueAtomOffset,r=t.index-t.residueAtomOffset,s=e.residueType.getBondReferenceAtomIndex(n,r);if(s!==void 0)return s+e.residueAtomOffset;console.warn("No reference atom found",e.index,t.index)}calculateShiftDir(e=new me){const t=this._ap1,n=this._ap2,r=this._ap3,s=this._v12,o=this._v13;t.index=this.atomIndex1,n.index=this.atomIndex2;const a=this.getReferenceAtomIndex();s.subVectors(t,n).normalize(),a!==void 0?(r.index=a,o.subVectors(t,r)):o.copy(t),o.normalize();let l=s.dot(o);return 1-Math.abs(l)<1e-5&&(o.set(1,0,0),l=s.dot(o),1-Math.abs(l)<1e-5&&(o.set(0,1,0),l=s.dot(o))),e.copy(o.sub(s.multiplyScalar(l))).normalize()}qualifiedName(){return this.atomIndex1+"="+this.atomIndex2}clone(){return new M3(this.structure,this.index)}toObject(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}}class A3{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get chain(){return this.structure.getChainProxy(this.chainIndex)}get chainIndex(){return this.residueStore.chainIndex[this.index]}set chainIndex(e){this.residueStore.chainIndex[this.index]=e}get atomOffset(){return this.residueStore.atomOffset[this.index]}set atomOffset(e){this.residueStore.atomOffset[this.index]=e}get atomCount(){return this.residueStore.atomCount[this.index]}set atomCount(e){this.residueStore.atomCount[this.index]=e}get atomEnd(){return this.atomOffset+this.atomCount-1}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get resno(){return this.residueStore.resno[this.index]}set resno(e){this.residueStore.resno[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.index)}set sstruc(e){this.residueStore.setSstruc(this.index,e)}get inscode(){return this.residueStore.getInscode(this.index)}set inscode(e){this.residueStore.setInscode(this.index,e)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get moleculeType(){return this.residueType.moleculeType}get backboneType(){return this.residueType.backboneType}get backboneStartType(){return this.residueType.backboneStartType}get backboneEndType(){return this.residueType.backboneEndType}get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset}get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset}get direction2AtomIndex(){return this.residueType.direction2AtomIndex+this.atomOffset}get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset}get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset}get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset}get x(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.x[t];return e/this.atomCount}get y(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.y[t];return e/this.atomCount}get z(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.z[t];return e/this.atomCount}eachAtom(e,t){const n=this.atomCount,r=this.atomOffset,s=this.structure._ap,o=r+n;if(t&&t.atomOnlyTest){const a=t.atomOnlyTest;for(let l=r;l<o;++l)s.index=l,a(s)&&e(s)}else for(let a=r;a<o;++a)s.index=a,e(s)}positionToArray(e=[],t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isHetero(){return this.residueType.hetero===1}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isStandardAminoacid(){return this.residueType.isStandardAminoacid()}isStandardBase(){return this.residueType.isStandardBase()}isHelix(){return LV.includes(this.sstruc)}isSheet(){return DV.includes(this.sstruc)}isTurn(){return NV.includes(this.sstruc)&&this.isProtein()}getAtomType(e){return this.atomMap.get(this.atomStore.atomTypeId[e])}getResname1(){return Nb[this.resname.toUpperCase()]||"X"}getBackboneType(e){switch(e){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}}getAtomIndexByName(e){let t=this.residueType.getAtomIndexByName(e);return t!==void 0&&(t+=this.atomOffset),t}hasAtomWithName(e){return this.residueType.hasAtomWithName(e)}getAtomnameList(){console.warn("getAtomnameList - might be expensive");const e=this.atomCount,t=this.atomOffset,n=new Array(e);for(let r=0;r<e;++r)n[r]=this.getAtomType(t+r).atomname;return n}connectedTo(e){const t=this.structure.getAtomProxy(this.backboneEndAtomIndex),n=this.structure.getAtomProxy(e.backboneStartAtomIndex);return!(!t||!n)&&t.connectedTo(n)}getNextConnectedResidue(){const e=this.chainStore.residueOffset[this.chainIndex],t=this.chainStore.residueCount[this.chainIndex],n=this.index+1;if(n<e+t){const r=this.structure.getResidueProxy(n);if(this.connectedTo(r))return r}else if(n===e+t){const r=this.structure.getResidueProxy(e);if(this.connectedTo(r))return r}}getPreviousConnectedResidue(e){const t=this.chainStore.residueOffset[this.chainIndex],n=this.index-1;if(n>=t){const r=he(e,this.structure.getResidueProxy());if(r.index=n,r.connectedTo(this))return r}else if(n===t-1){const r=this.chainStore.residueCount[this.chainIndex],s=he(e,this.structure.getResidueProxy());if(s.index=t+r-1,s.connectedTo(this))return s}}getBonds(){return this.residueType.getBonds(this)}getRings(){return this.residueType.getRings()}getAromaticRings(){return this.residueType.getAromaticRings(this)}qualifiedName(e=!1){let t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chain&&(t+=":"+this.chainname),t+="/"+this.modelIndex,t}clone(){return new A3(this.structure,this.index)}toObject(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}}class wA{constructor(e,t,n){this.structure=e,this.residueIndexStart=t,this.residueIndexEnd=n,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueCount=n-t+1;const r=this.structure.getResidueProxy(this.residueIndexStart),s=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=r.getPreviousConnectedResidue()!==void 0;const o=s.getNextConnectedResidue();this.isNextConnected=o!==void 0,this.isNextNextConnected=o!==void 0&&o.getNextConnectedResidue()!==void 0,this.isCyclic=s.connectedTo(r),this.__residueProxy=this.structure.getResidueProxy()}get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}isProtein(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()}isCg(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()}isNucleic(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()}getMoleculeType(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType}getBackboneType(e){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(e)}getAtomIndexByType(e,t){this.isCyclic?e===-1?e=this.residueCount-1:e===this.residueCount&&(e=0):(e!==-1||this.isPrevConnected||(e+=1),e!==this.residueCount||this.isNextNextConnected||(e-=1));const n=this.__residueProxy;let r;switch(n.index=this.residueIndexStart+e,t){case"trace":r=n.traceAtomIndex;break;case"direction1":r=n.direction1AtomIndex;break;case"direction2":r=n.direction2AtomIndex;break;default:r=n.getAtomIndexByName(t)}return r}eachAtom(e,t){this.eachResidue(function(n){n.eachAtom(e,t)})}eachAtomN(e,t,n){const r=this.residueCount,s=new Array(e);for(let a=0;a<e;++a)s[a]=this.structure.getAtomProxy(this.getAtomIndexByType(a,n));t.apply(this,s);for(var o=e;o<r;++o){for(let a=1;a<e;++a)s[a-1].index=s[a].index;s[e-1].index=this.getAtomIndexByType(o,n),t.apply(this,s)}}eachResidue(e){const t=this.structure.getResidueProxy(),n=this.residueCount,r=this.residueIndexStart;for(let s=0;s<n;++s)t.index=r+s,e(t)}qualifiedName(){const e=this.structure.getResidueProxy(this.residueIndexStart),t=this.structure.getResidueProxy(this.residueIndexEnd);return e.qualifiedName()+" - "+t.qualifiedName()}}class E3{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get entity(){return this.structure.entityList[this.entityIndex]}get model(){return this.structure.getModelProxy(this.modelIndex)}get entityIndex(){return this.chainStore.entityIndex[this.index]}set entityIndex(e){this.chainStore.entityIndex[this.index]=e}get modelIndex(){return this.chainStore.modelIndex[this.index]}set modelIndex(e){this.chainStore.modelIndex[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.index]}set residueOffset(e){this.chainStore.residueOffset[this.index]=e}get residueCount(){return this.chainStore.residueCount[this.index]}set residueCount(e){this.chainStore.residueCount[this.index]=e}get residueEnd(){return this.residueOffset+this.residueCount-1}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}get chainname(){return this.chainStore.getChainname(this.index)}set chainname(e){this.chainStore.setChainname(this.index,e)}get chainid(){return this.chainStore.getChainid(this.index)}set chainid(e){this.chainStore.setChainid(this.index,e)}eachAtom(e,t){this.eachResidue(function(n){n.eachAtom(e,t)},t)}eachResidue(e,t){const n=this.residueCount,r=this.residueOffset,s=this.structure._rp,o=r+n;if(t&&t.test){const a=t.residueOnlyTest;if(a)for(let l=r;l<o;++l)s.index=l,a(s)&&e(s);else for(let l=r;l<o;++l)s.index=l,e(s)}else for(let a=r;a<o;++a)s.index=a,e(s)}eachResidueN(e,t){const n=this.residueCount,r=this.residueOffset,s=r+n;if(n<e)return;const o=new Array(e);for(let a=0;a<e;++a)o[a]=this.structure.getResidueProxy(r+a);t.apply(this,o);for(let a=r+e;a<s;++a){for(let l=0;l<e;++l)o[l].index+=1;t.apply(this,o)}}eachPolymer(e,t){let n=0,r=0;const s=t?t.residueOnlyTest:void 0,o=this.model.structure,a=this.residueCount,l=this.residueOffset,c=l+a,u=this.structure.getResidueProxy(),h=this.structure.getResidueProxy(l),d=this.structure.getAtomProxy(),f=this.structure.getAtomProxy();let p=!0;for(let _=l+1;_<c;++_){u.index=h.index,h.index=_;const v=p?u.backboneEndType:u.backboneType,g=h.backboneType;p&&(n=u.index,p=!1),r=h.index,v!==Dd&&v===g?(d.index=u.backboneEndAtomIndex,f.index=h.backboneStartAtomIndex,d&&f&&d.connectedTo(f)&&(!s||s(u)&&s(h))||(u.index-n>1&&e(new wA(o,n,u.index)),n=r)):(v!==Dd&&u.index-n>1&&e(new wA(o,n,u.index)),n=r)}r-n>1&&this.structure.getResidueProxy(n).backboneEndType&&e(new wA(o,n,r))}qualifiedName(){return":"+this.chainname+"/"+this.modelIndex}clone(){return new E3(this.structure,this.index)}toObject(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}}class T3{constructor(e,t=0){this.structure=e,this.index=t,this.modelStore=e.modelStore,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get chainOffset(){return this.modelStore.chainOffset[this.index]}set chainOffset(e){this.modelStore.chainOffset[this.index]=e}get chainCount(){return this.modelStore.chainCount[this.index]}set chainCount(e){this.modelStore.chainCount[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.chainOffset]}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get chainEnd(){return this.chainOffset+this.chainCount-1}get residueEnd(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get residueCount(){return this.chainCount===0?0:this.residueEnd-this.residueOffset+1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}eachAtom(e,t){this.eachChain(function(n){n.eachAtom(e,t)},t)}eachResidue(e,t){this.eachChain(function(n){n.eachResidue(e,t)},t)}eachPolymer(e,t){if(t&&t.chainOnlyTest){const n=t.chainOnlyTest;this.eachChain(function(r){n(r)&&r.eachPolymer(e,t)})}else this.eachChain(function(n){n.eachPolymer(e,t)})}eachChain(e,t){const n=this.chainCount,r=this.chainOffset,s=this.structure._cp,o=r+n;if(t&&t.test){const a=t.chainOnlyTest;if(a)for(let l=r;l<o;++l)s.index=l,a(s)&&e(s);else for(let l=r;l<o;++l)s.index=l,e(s)}else for(let a=r;a<o;++a)s.index=a,e(s)}qualifiedName(){return"/"+this.index}clone(){return new T3(this.structure,this.index)}toObject(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}}class cl{constructor(e="",t=""){this.signals={refreshed:new rn.Signal},this.init(e,t)}init(e,t){this.name=e,this.path=t,this.title="",this.id="",this.data={structure:this,"@spatialLookup":void 0,"@valenceModel":void 0},this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new Vx(0),this.backboneBondStore=new Vx(0),this.rungBondStore=new Vx(0),this.atomStore=new nhe(0),this.residueStore=new ihe(0),this.chainStore=new rhe(0),this.modelStore=new she(0),this.atomMap=new Ehe(this),this.residueMap=new Lhe(this),this.chemCompMap=void 0,this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new me,this.boundingBox=new Li,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()}get type(){return"Structure"}finalizeAtoms(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new me),this.spatialHash=new b1(this.atomStore,this.boundingBox)}finalizeBonds(){this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new the(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(let e in this.atomSetDict)this.atomSetCache["__"+e]=this.atomSetDict[e].clone()}getBondProxy(e){return new M3(this,e)}getAtomProxy(e){return new n2(this,e)}getResidueProxy(e){return new A3(this,e)}getChainProxy(e){return new E3(this,e)}getModelProxy(e){return new T3(this,e)}getBondSet(){const e=this.bondStore.count,t=new gr(e),n=this.atomSet;if(n)if(n.isAllSet())t.setAll();else if(n.isAllClear())t.clearAll();else{const r=this.getBondProxy();for(let s=0;s<e;++s)r.index=s,n.isSet(r.atomIndex1,r.atomIndex2)&&t.set(r.index)}else t.setAll();return t}getBackboneBondSet(){const e=this.backboneBondStore.count,t=new gr(e),n=this.atomSetCache.__backbone;if(n){const r=this.getBondProxy();r.bondStore=this.backboneBondStore;for(let s=0;s<e;++s)r.index=s,n.isSet(r.atomIndex1,r.atomIndex2)&&t.set(r.index)}else t.setAll();return t}getRungBondSet(){const e=this.rungBondStore.count,t=new gr(e),n=this.atomSetCache.__rung;if(n){const r=this.getBondProxy();r.bondStore=this.rungBondStore;for(let s=0;s<e;++s)r.index=s,n.isSet(r.atomIndex1,r.atomIndex2)&&t.set(r.index)}else t.setAll();return t}getAtomSet(e){const t=this.atomStore.count;if(e===void 0)return new gr(t,!0);if(e instanceof gr)return e;if(e===!0)return new gr(t,!0);if(e&&e.test){const n=e.string;if(n in this.atomSetCache)return this.atomSetCache[n];if(n==="")return new gr(t,!0);{const r=new gr(t);return this.eachAtom(function(s){r.set(s.index)},e),this.atomSetCache[n]=r,r}}return e===!1?new gr(t):new gr(t,!0)}getAtomSetWithinSelection(e,t){const n=this.spatialHash,r=this.getAtomSet(!1),s=this.getAtomProxy();return n&&this.getAtomSet(e).forEach(function(o){s.index=o,n.within(s.x,s.y,s.z,t).forEach(function(a){r.set(a)})}),r}getAtomSetWithinPoint(e,t){const n=e,r=this.getAtomSet(!1);return this.spatialHash&&this.spatialHash.within(n.x,n.y,n.z,t).forEach(function(s){r.set(s)}),r}getAtomSetWithinVolume(e,t,n,r,s){const o=new tc(e,n,r,s),a=o.getDataPosition(),l=a.length,c=o.matrix.getMaxScaleOnAxis(),u=this.getAtomSet(!1);if(!this.spatialHash)return u;for(let h=0;h<l;h+=3)this.spatialHash.within(a[h],a[h+1],a[h+2],c).forEach(function(d){u.set(d)});return u}getAtomSetWithinGroup(e){const t=this.atomStore.residueIndex,n=this.getAtomSet(!1),r=this.getResidueProxy();return this.getAtomSet(e).forEach(function(s){r.index=t[s];for(let o=r.atomOffset;o<=r.atomEnd;++o)n.set(o)}),n}getSelection(){}getStructure(){return this}eachEntity(e,t){this.entityList.forEach(function(n){t!==void 0&&n.getEntityType()!==t||e(n)})}eachBond(e,t){const n=this.getBondProxy();let r;if(t&&t.test&&(r=this.getBondSet(),this.bondSet&&r.intersection(this.bondSet)),r)r.forEach(function(s){n.index=s,e(n)});else{const s=this.bondStore.count;for(let o=0;o<s;++o)n.index=o,e(n)}}eachAtom(e,t){if(t&&t.test)this.eachModel(function(n){n.eachAtom(e,t)},t);else{const n=this.atomStore.count,r=this.getAtomProxy();for(let s=0;s<n;++s)r.index=s,e(r)}}eachResidue(e,t){if(t&&t.test){const n=this.modelStore.count,r=this.getModelProxy(),s=t.modelOnlyTest;if(s)for(let o=0;o<n;++o)r.index=o,s(r)&&r.eachResidue(e,t);else for(let o=0;o<n;++o)r.index=o,r.eachResidue(e,t)}else{const n=this.residueStore.count,r=this.getResidueProxy();for(let s=0;s<n;++s)r.index=s,e(r)}}eachResidueN(e,t){const n=this.residueStore.count;if(n<e)return;const r=new Array(e);for(let s=0;s<e;++s)r[s]=this.getResidueProxy(s);t.apply(this,r);for(let s=e;s<n;++s){for(let o=0;o<e;++o)r[o].index+=1;t.apply(this,r)}}eachPolymer(e,t){if(t&&t.modelOnlyTest){const n=t.modelOnlyTest;this.eachModel(function(r){n(r)&&r.eachPolymer(e,t)})}else this.eachModel(function(n){n.eachPolymer(e,t)})}eachChain(e,t){if(t&&t.test)this.eachModel(function(n){n.eachChain(e,t)});else{const n=this.chainStore.count,r=this.getChainProxy();for(let s=0;s<n;++s)r.index=s,e(r)}}eachModel(e,t){const n=this.modelStore.count,r=this.getModelProxy();if(t&&t.test){const s=t.modelOnlyTest;if(s)for(let o=0;o<n;++o)r.index=o,s(r)&&e(r);else for(let o=0;o<n;++o)r.index=o,e(r)}else for(let s=0;s<n;++s)r.index=s,e(r)}getAtomData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,r=he(t.atomSet,this.atomSet);let s,o;const a={},l=this.getAtomProxy(),c=r.getSize();n&&!n.position||(a.position=new Float32Array(3*c)),n&&!n.color||!t.colorParams||(a.color=new Float32Array(3*c),o=_n.getScheme(t.colorParams)),n&&!n.picking||(a.picking=new Hd(new Float32Array(c),this.getStructure())),n&&!n.radius||(a.radius=new Float32Array(c),s=new Ac(t.radiusParams)),n&&!n.index||(a.index=new Uint32Array(c));const{position:u,color:h,picking:d,radius:f,index:p}=a;return r.forEach((_,v)=>{const g=3*v;l.index=_,u&&l.positionToArray(u,g),h&&o.atomColorToArray(l,h,g),d&&(d.array[v]=_),f&&(f[v]=s.atomRadius(l)),p&&(p[v]=_)}),a}getBondData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,r=he(t.bondSet,this.bondSet),s=he(t.multipleBond,"off"),o=s!=="off",a=s==="offset",l=he(t.bondScale,.4),c=he(t.bondSpacing,1);let u,h;const d={},f=this.getBondProxy();t.bondStore&&(f.bondStore=t.bondStore);const p=this.getAtomProxy(),_=this.getAtomProxy();let v;if(o){const U=f.bondStore.bondOrder;v=0,r.forEach(function(z){v+=U[z]})}else v=r.getSize();n&&!n.position||(d.position1=new Float32Array(3*v),d.position2=new Float32Array(3*v)),n&&!n.color||!t.colorParams||(d.color=new Float32Array(3*v),d.color2=new Float32Array(3*v),h=_n.getScheme(t.colorParams)),n&&!n.picking||(d.picking=new zV(new Float32Array(v),this.getStructure(),t.bondStore)),(!n||n.radius||o&&n.position)&&(u=new Ac(t.radiusParams)),n&&!n.radius||(d.radius=new Float32Array(v),t.radius2&&(d.radius2=new Float32Array(v)));const{position1:g,position2:b,color:m,color2:y,picking:A,radius:w,radius2:M}=d;let T,E,C,N,P,L,R=0;const F=new me,V=new me,G=new me;return r.forEach(U=>{if(E=3*R,f.index=U,p.index=f.atomIndex1,_.index=f.atomIndex2,N=f.bondOrder,g)if(o&&N>1){const z=u.atomRadius(p);L=z*l/(.5*N),f.calculateShiftDir(G),a?(P=2*c*z,G.multiplyScalar(P),G.negate(),V.subVectors(_,p).multiplyScalar(Math.max(.1,P/1.88)),p.positionToArray(g,E),_.positionToArray(b,E),N>=2&&(F.addVectors(p,G).add(V).toArray(g,E+3),F.addVectors(_,G).sub(V).toArray(b,E+3),N>=3&&(F.subVectors(p,G).add(V).toArray(g,E+6),F.subVectors(_,G).sub(V).toArray(b,E+6)))):(P=(c-l)*z,G.multiplyScalar(P),N===2?(F.addVectors(p,G).toArray(g,E),F.subVectors(p,G).toArray(g,E+3),F.addVectors(_,G).toArray(b,E),F.subVectors(_,G).toArray(b,E+3)):N===3?(p.positionToArray(g,E),F.addVectors(p,G).toArray(g,E+3),F.subVectors(p,G).toArray(g,E+6),_.positionToArray(b,E),F.addVectors(_,G).toArray(b,E+3),F.subVectors(_,G).toArray(b,E+6)):(p.positionToArray(g,E),_.positionToArray(b,E)))}else p.positionToArray(g,E),_.positionToArray(b,E);if(m&&y&&(h.bondColorToArray(f,1,m,E),h.bondColorToArray(f,0,y,E),o&&N>1))for(T=1;T<N;++T)C=3*T+E,IU(m,E,C,3),IU(y,E,C,3);if(A&&A.array&&(A.array[R]=U,o&&N>1))for(T=1;T<N;++T)A.array[R+T]=U;if(w&&(w[R]=u.atomRadius(p),o&&N>1))for(L=w[R]*l/(a?1:.5*N),T=a?1:0;T<N;++T)w[R+T]=L;if(M&&(M[R]=u.atomRadius(_),o&&N>1))for(L=M[R]*l/(a?1:.5*N),T=a?1:0;T<N;++T)M[R+T]=L;R+=o?N:1}),d}getBackboneAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__backbone},e),this.getAtomData(e)}getBackboneBondData(e){return e=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},e),this.getBondData(e)}getRungAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__rung},e),this.getAtomData(e)}getRungBondData(e){return e=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},e),this.getBondData(e)}getBoundingBox(e,t){pt&&tt.time("getBoundingBox"),t=t||new Li;let n=1/0,r=1/0,s=1/0,o=-1/0,a=-1/0,l=-1/0;return this.eachAtom(c=>{const u=c.x,h=c.y,d=c.z;u<n&&(n=u),h<r&&(r=h),d<s&&(s=d),u>o&&(o=u),h>a&&(a=h),d>l&&(l=d)},e),t.min.set(n,r,s),t.max.set(o,a,l),pt&&tt.timeEnd("getBoundingBox"),t}getPrincipalAxes(e){pt&&tt.time("getPrincipalAxes");let t=0;const n=new On(3,this.atomCount),r=n.data;return this.eachAtom(s=>{r[t+0]=s.x,r[t+1]=s.y,r[t+2]=s.z,t+=3},e),pt&&tt.timeEnd("getPrincipalAxes"),new QV(n)}atomCenter(e){return e?this.getBoundingBox(e).getCenter(new me):this.center.clone()}hasCoords(){if(this._hasCoords===void 0){const e=this.atomStore;this._hasCoords=Ux(e.x)!==0||kx(e.x)!==0||Ux(e.y)!==0||kx(e.y)!==0||Ux(e.z)!==0||kx(e.z)!==0||e.count/this.modelStore.count==1}return this._hasCoords}getSequence(e){const t=[],n=this.getResidueProxy();return this.eachAtom(function(r){n.index=r.residueIndex,r.index===n.traceAtomIndex&&t.push(n.getResname1())},e),t}getAtomIndices(e){if(e&&e.string){const t=[];return this.eachAtom(function(n){t.push(n.index)},e),new Uint32Array(t)}{const t={what:{index:!0}};return this.getAtomData(t).index}}getChainnameCount(e){const t=new Set;return this.eachChain(function(n){n.residueCount&&t.add(n.chainname)},e),t.size}updatePosition(e,t=!0){let n=0;this.eachAtom(function(r){r.positionFromArray(e,n),n+=3},void 0),this._hasCoords=void 0,t&&this.refreshPosition()}refreshPosition(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new b1(this.atomStore,this.boundingBox),this.signals.refreshed.dispatch(this)}dispose(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet}}const f4=new Li,MA=[QS,Id,JS,Ld,ym,KS,_m,ZS,Db,e2,y1,x1],Dhe={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2};class Nhe{constructor(e="shape",t={}){this.boundingBox=new Li,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=e,this.parameters=Io(t,Dhe),MA.forEach(n=>{Object.keys(n.fields).forEach(r=>{this._primitiveData[n.getShapeKey(r)]=[]}),this._primitiveData[n.getShapeKey("name")]=[]})}addBuffer(e){this.bufferList.push(e);const t=e.geometry;return t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox),this}addMesh(e,t,n,r,s){let o;e=rA(e),t=rA(t),Array.isArray(n)&&(n=El(n,e.length)),r&&(r=rA(r)),o=r===void 0||r.length==0?{position:e,color:t,index:n}:{position:e,color:t,index:n,normal:r};const a=new Uue(this,Object.assign({serial:this.meshCount,name:s},o)),l=new Mc(Object.assign({picking:a},o));return this.bufferList.push(l),f4.setFromArray(e),this.boundingBox.union(f4),this.meshCount+=1,this}addSphere(e,t,n,r){return _m.objectToShape(this,{position:e,color:t,radius:n,name:r}),this}addEllipsoid(e,t,n,r,s,o){return ym.objectToShape(this,{position:e,color:t,radius:n,majorAxis:r,minorAxis:s,name:o}),this}addTorus(e,t,n,r,s,o){return e2.objectToShape(this,{position:e,color:t,radius:n,majorAxis:r,minorAxis:s,name:o}),this}addCylinder(e,t,n,r,s){return Ld.objectToShape(this,{position1:e,position2:t,color:n,radius:r,name:s}),this}addCone(e,t,n,r,s){return JS.objectToShape(this,{position1:e,position2:t,color:n,radius:r,name:s}),this}addArrow(e,t,n,r,s){return QS.objectToShape(this,{position1:e,position2:t,color:n,radius:r,name:s}),this}addBox(e,t,n,r,s,o){return Id.objectToShape(this,{position:e,color:t,size:n,heightAxis:r,depthAxis:s,name:o}),this}addOctahedron(e,t,n,r,s,o){return KS.objectToShape(this,{position:e,color:t,size:n,heightAxis:r,depthAxis:s,name:o}),this}addTetrahedron(e,t,n,r,s,o){return ZS.objectToShape(this,{position:e,color:t,size:n,heightAxis:r,depthAxis:s,name:o}),this}addText(e,t,n,r){return Db.objectToShape(this,{position:e,color:t,size:n,text:r}),this}addPoint(e,t,n){return y1.objectToShape(this,{position:e,color:t,name:n}),this}addWideline(e,t,n,r,s){return this.parameters.linewidth=r,x1.objectToShape(this,{position1:e,position2:t,color:n,name:s}),this}addLabel(e,t,n,r){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(e,t,n,r)}getBufferList(){const e=[];return MA.forEach(t=>{this._primitiveData[t.getShapeKey("color")].length&&e.push(t.bufferFromShape(this,this.parameters))}),this.bufferList.concat(e)}dispose(){this.bufferList.forEach(function(e){e.dispose()}),this.bufferList.length=0,MA.forEach(e=>{Object.keys(e.fields).forEach(t=>{this._primitiveData[e.getShapeKey(t)].length=0}),this._primitiveData[e.getShapeKey("name")].length=0})}get center(){return this._center||(this._center=this.boundingBox.getCenter(new me)),this._center}get type(){return"Shape"}}class p4 extends K1{constructor(e,t,n){Array.isArray(e)||(e=[e]),super(e,t,n),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=e,this.init(n)}init(e){super.init(e),this.build()}create(){this.bufferList.push.apply(this.bufferList,this.buffer)}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t),t.setParameters(this.getBufferParams())}),this.setVisibility(this.visible),e()}}const zy=new Ct,m4=new vn;class Ju extends Mc{constructor(e,t={},n){super(function(l,c){const u=c.attributes.position.array,h=c.index?c.index.array:void 0,d=l.position.length/3,f=u.length/3,p=d*f,_=new Float32Array(3*p),v=new Float32Array(3*p),g=new Float32Array(3*p);let b;return h&&(b=El(d*h.length,p)),{position:_,color:g,index:b,normal:v,primitiveId:l.primitiveId||PC(d,f),picking:l.picking}}(e,n),t),this.updateNormals=!1;const r=n.attributes.position.array,s=n.attributes.normal.array,o=n.index?n.index.array:void 0;this.geoPosition=r,this.geoNormal=s,this.geoIndex=o,this.positionCount=e.position.length/3,this.geoPositionCount=r.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);const a=this.geometry.attributes;if(this.meshPosition=a.position.array,this.meshColor=a.color.array,this.meshNormal=a.normal.array,this.setAttributes(e),o){const l=this.geometry.getIndex();if(!l)return void tt.error("Index is null");this.meshIndex=l.array,this.makeIndex()}}setAttributes(e={},t=!1){const n=this.geometry.attributes;let r,s,o,a,l,c,u,h,d;const f=this.updateNormals;e.position&&(r=e.position,o=this.geoPosition,u=this.meshPosition,l=this.transformedGeoPosition,n.position.needsUpdate=!0,(f||t)&&(a=this.geoNormal,d=this.meshNormal,c=this.transformedGeoNormal,n.normal.needsUpdate=!0)),e.color&&(s=e.color,h=this.meshColor,n.color.needsUpdate=!0);const p=this.positionCount,_=this.geoPositionCount;for(let v=0;v<p;++v){let g,b;const m=v*_*3,y=3*v;if(r&&l&&u&&d&&o&&a&&(l.set(o),zy.makeTranslation(r[y],r[y+1],r[y+2]),this.applyPositionTransform(zy,v,y),qS(zy.elements,l),u.set(l,m),f&&c?(c.set(a),m4.getNormalMatrix(zy),y3(m4.elements,c),d.set(c,m)):t&&d.set(a,m)),s&&h)for(g=0;g<_;++g)b=m+3*g,h[b]=s[y],h[b+1]=s[y+1],h[b+2]=s[y+2]}}makeIndex(){const e=this.geoIndex,t=this.meshIndex;if(!e)return;const n=this.positionCount,r=this.geoPositionCount,s=3*(e.length/3);for(let o=0;o<n;++o){const a=o*s,l=a+s;t.set(e,a);for(let c=a;c<l;++c)t[c]+=o*r}}}const g4=new me,iH=Object.assign({sphereDetail:1},Os);class Fhe extends Ju{constructor(e,t={}){super(e,t,new WS(1,he(t.sphereDetail,1))),this.setAttributes(e,!0)}get defaultParameters(){return iH}applyPositionTransform(e,t){const n=this._radius[t];g4.set(n,n,n),e.scale(g4)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}Rn.add("shader/SphereImpostor.vert",`uniform mat4 projectionMatrixInverse;
uniform float clipNear;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
attribute vec2 mapping;
attribute float radius;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
#include matrix_scale
const mat4 D = mat4(
1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, -1.0
);
mat4 transposeM( in mat4 inMatrix ) {
vec4 i0 = inMatrix[0];
vec4 i1 = inMatrix[1];
vec4 i2 = inMatrix[2];
vec4 i3 = inMatrix[3];
mat4 outMatrix = mat4(
vec4(i0.x, i1.x, i2.x, i3.x),
vec4(i0.y, i1.y, i2.y, i3.y),
vec4(i0.z, i1.z, i2.z, i3.z),
vec4(i0.w, i1.w, i2.w, i3.w)
);
return outMatrix;
}
void ComputePointSizeAndPositionInClipCoordSphere(){
vec2 xbc;
vec2 ybc;
mat4 T = mat4(
radius, 0.0, 0.0, 0.0,
0.0, radius, 0.0, 0.0,
0.0, 0.0, radius, 0.0,
position.x, position.y, position.z, 1.0
);
mat4 R = transposeM( projectionMatrix * modelViewMatrix * T );
float A = dot( R[ 3 ], D * R[ 3 ] );
float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );
float C = dot( R[ 0 ], D * R[ 0 ] );
xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;
A = dot( R[ 3 ], D * R[ 3 ] );
B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );
C = dot( R[ 1 ], D * R[ 1 ] );
ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;
gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );
gl_Position.xy -= mapping * vec2( sx, sy );
gl_Position.xy *= gl_Position.w;
}
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
vRadius = radius * matrixScale( modelViewMatrix );
vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
mvPosition.z -= vRadius;
gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );
ComputePointSizeAndPositionInClipCoordSphere();
vRadiusSq = vRadius * vRadius;
vec4 vPoint4 = projectionMatrixInverse * gl_Position;
vPoint = vPoint4.xyz / vPoint4.w;
vPointViewPosition = -mvPosition.xyz / mvPosition.w;
}`),Rn.add("shader/SphereImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool flag2 = false;
bool interior = false;
vec3 cameraPos;
vec3 cameraNormal;
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){
vec3 cameraSpherePos = -vPointViewPosition;
cameraSpherePos.z += vRadius;
vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );
vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );
vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );
float B = dot( rayDirection, cameraSphereDir );
float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );
if( det < 0.0 ){
discard;
return false;
}
float sqrtDet = sqrt( det );
float posT = mix( B + sqrtDet, B + sqrtDet, ortho );
float negT = mix( B - sqrtDet, sqrtDet - B, ortho );
cameraPos = rayDirection * negT + rayOrigin;
#ifdef NEAR_CLIP
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}else if( calcClip( cameraPos ) > 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
flag2 = true;
}
#else
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}
#endif
cameraNormal = normalize( cameraPos - cameraSpherePos );
cameraNormal *= float(!interior) * 2.0 - 1.0;
return !interior;
}
void main(void){
bool flag = Impostor( cameraPos, cameraNormal );
#ifdef NEAR_CLIP
if( calcClip( cameraPos ) > 0.0 )
discard;
#endif
gl_FragDepthEXT = calcDepth( cameraPos );
if( !flag ){
#ifdef NEAR_CLIP
if( flag2 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}else if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#else
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#endif
}
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vNormal = cameraNormal;
vec3 vViewPosition = -cameraPos;
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);class C3 extends Tl{constructor(e,t,n={}){super(t,n),this.index=El(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:e,value:null}}),this.setAttributes({primitiveId:km(this.size)})}get attributeSize(){return this.size*this.mappingSize}get indexSize(){return this.size*this.mappingIndicesSize}addAttributes(e){const t={};for(const n in e){const r=e[n];t[n]={type:r.type,value:null}}super.addAttributes(t)}getAttributeIndex(e){return 3*e*this.mappingSize}setAttributes(e){e&&!e.position&&e.position1&&e.position2&&(e.position=yl(e.position1,e.position2));const t=this.size,n=this.mappingSize,r=this.geometry.attributes;let s,o,a,l,c,u,h;for(const d in e)if(d!=="index"&&d!=="picking"){o=e[d],s=r[d],a=s.itemSize,l=s.array;for(let f=0;f<t;++f){c=f*a,u=c*n;for(let p=0;p<n;++p){h=u+a*p;for(let _=0;_<a;++_)l[h+_]=o[c+_]}}s.needsUpdate=!0}}makeMapping(){const e=this.size,t=this.mapping,n=this.mappingSize,r=this.mappingItemSize,s=this.geometry.attributes.mapping.array;for(let o=0;o<e;o++)s.set(t,o*r*n)}makeIndex(){const e=this.size,t=this.mappingSize,n=this.mappingIndices,r=this.mappingIndicesSize,s=this.index;for(let o=0;o<e;o++){const a=o*r,l=o*t;s.set(n,a);for(let c=0;c<r;++c)s[a+c]+=l}}}const khe=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Uhe=new Uint16Array([0,1,2,1,3,2]);class P3 extends C3{constructor(e,t={}){super("v2",e,t)}get mapping(){return khe}get mappingIndices(){return Uhe}get mappingIndicesSize(){return 6}get mappingSize(){return 4}get mappingItemSize(){return 2}}class Ohe extends P3{constructor(e,t={}){super(e,t),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new Ct},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}}Object.assign({disableImpostor:!1},iH);const eh=class{constructor(i,e){return!_l||e&&e.disableImpostor?new Fhe(i,e):new Ohe(i,e)}};function Bhe(i,e,t,n){const r=t-i,s=n-e;return Math.sqrt(r*r+s*s)}Fo.add("sphere",eh),Rn.add("shader/Point.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float size;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
varying vec3 vViewPosition;
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
#include begin_vertex
#include project_vertex
#ifdef USE_SIZEATTENUATION
gl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );
#else
gl_PointSize = size * pixelRatio;
#endif
#ifndef PICKING
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),Rn.add("shader/Point.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef USE_MAP
uniform sampler2D map;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include alphatest_pars_fragment
varying vec3 vViewPosition;
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
#ifdef USE_MAP
if( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )
discard;
#endif
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
#ifdef USE_MAP
diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );
#endif
#include color_fragment
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const zhe=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},Os),Ghe=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{uniform:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},$d);class R3 extends Tl{constructor(e,t={}){super(e,t),this.parameterTypes=Ghe,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null},alphaTest:{value:this.parameters.alphaTest}})}get defaultParameters(){return zhe}makeMaterial(){super.makeMaterial(),this.makeTexture();const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.uniforms.map.value=this.tex,e.needsUpdate=!0,t.uniforms.map.value=this.tex,t.needsUpdate=!0,n.uniforms.map.value=this.tex,n.needsUpdate=!0}makeTexture(){this.tex&&this.tex.dispose(),this.tex=function(e){const t=e||{},n=he(t.width,256),r=he(t.height,256),s=[n/2,r/2],o=Math.min(n/2,r/2),a=he(t.delta,1/(o+1))*o;let l=0,c=0;const u=new Uint8Array(n*r*4);for(let d=0,f=u.length;d<f;d+=4){const p=1-X1(o-a,o,Bhe(l,c,s[0],s[1]));u[d]=255*p,u[d+1]=255*p,u[d+2]=255*p,u[d+3]=255*p,++l===n&&(l=0,c++)}const h=new wC(u,n,r);return h.needsUpdate=!0,h}({delta:this.parameters.edgeBleach})}getDefines(e){const t=super.getDefines(e);return this.parameters.sizeAttenuation&&(t.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(t.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(t.USE_ALPHATEST=1),t}setUniforms(e){e&&e.edgeBleach!==void 0&&(this.makeTexture(),e.map=this.tex),super.setUniforms(e)}dispose(){super.dispose(),this.tex&&this.tex.dispose()}}Fo.add("point",R3);class v4 extends K1{constructor(e,t,n){super(e,t,n),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),e instanceof js?(this.surface=void 0,this.volume=new tc(e)):(this.surface=e,this.volume=void 0),this.init(n)}init(e){var t=e||{};t.colorScheme=he(t.colorScheme,"uniform"),t.colorValue=he(t.colorValue,14540253),this.thresholdType=he(t.thresholdType,"sigma"),this.thresholdMin=he(t.thresholdMin,2),this.thresholdMax=he(t.thresholdMax,1/0),this.thresholdOut=he(t.thresholdOut,!1),this.dotType=he(t.dotType,"point"),this.radius=he(t.radius,.1),this.scale=he(t.scale,1),this.pointSize=he(t.pointSize,1),this.sizeAttenuation=he(t.sizeAttenuation,!0),this.sortParticles=he(t.sortParticles,!1),this.useTexture=he(t.useTexture,!1),this.alphaTest=he(t.alphaTest,.5),this.forceTransparent=he(t.forceTransparent,!1),this.edgeBleach=he(t.edgeBleach,0),super.init(t),this.build()}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t)}),this.setVisibility(this.visible),e()}create(){var e={};if(this.volume){var t,n,r=this.volume;this.thresholdType==="sigma"?(t=r.getValueForSigma(this.thresholdMin),n=r.getValueForSigma(this.thresholdMax)):(t=this.thresholdMin,n=this.thresholdMax),r.setFilter(t,n,this.thresholdOut),Object.assign(e,{position:r.getDataPosition(),color:r.getDataColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:r.getDataSize(this.radius,this.scale),picking:r.getDataPicking()})}else{var s=this.surface;Object.assign(e,{position:s.getPosition(),color:s.getColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:s.getSize(this.radius,this.scale),picking:s.getPicking()})}this.dotType==="sphere"?this.dotBuffer=new eh(e,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new R3(e,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)}update(e={}){if(this.bufferList.length===0)return;const t={};e.color&&(this.volume?Object.assign(t,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(t,{color:this.surface.getColor(this.getColorParams())})),this.dotType==="sphere"&&(e.radius||e.scale)&&(this.volume?Object.assign(t,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(t,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(t)}setParameters(e,t={},n){return e&&e.thresholdType!==void 0&&this.volume instanceof js&&(this.thresholdType==="value"&&e.thresholdType==="sigma"?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):this.thresholdType==="sigma"&&e.thresholdType==="value"&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=e.thresholdType),e&&e.radiusType!==void 0&&(e.radiusType==="radius"?this.radius=.1:this.radius=parseFloat(e.radiusType),t.radius=!0,this.dotType!=="sphere"||_l&&!this.disableImpostor||(n=!0)),e&&e.radius!==void 0&&(t.radius=!0,this.dotType!=="sphere"||_l&&!this.disableImpostor||(n=!0)),e&&e.scale!==void 0&&(t.scale=!0,this.dotType!=="sphere"||_l&&!this.disableImpostor||(n=!0)),super.setParameters(e,t,n),this}}Rn.add("shader/Image.vert",`uniform float clipRadius;
uniform vec3 clipCenter;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void main() {
#include begin_vertex
#include project_vertex
vUv = uv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
}`),Rn.add("shader/Image.frag",`uniform sampler2D map;
uniform float opacity;
uniform vec2 mapSize;
uniform float clipNear;
uniform float clipRadius;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform sampler2D pickingMap;
uniform float objectId;
#else
#include fog_pars_fragment
#endif
#if defined( CUBIC_INTERPOLATION )
#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )
#if defined( CATMULROM_FILTER )
const float B = 0.0;
const float C = 0.5;
#elif defined( MITCHELL_FILTER )
const float B = 0.333;
const float C = 0.333;
#endif
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f < 1.0 ){
return ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +
( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +
( 6.0 - 2.0 * B ) ) / 6.0;
}else if( f >= 1.0 && f < 2.0 ){
return ( ( -B - 6.0 * C ) * ( f * f * f )
+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +
( - ( 12.0 * B ) - 48.0 * C ) * f +
8.0 * B + 24.0 * C ) / 6.0;
}else{
return 0.0;
}
}
#elif defined( BSPLINE_FILTER )
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f >= 0.0 && f <= 1.0 ){
return ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );
}else if( f > 1.0 && f <= 2.0 ){
return 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );
}
return 1.0;
}
#else
float applyFilter( float x ){
return 1.0;
}
#endif
vec4 biCubic( sampler2D tex, vec2 texCoord ){
vec2 texelSize = 1.0 / mapSize;
texCoord -= texelSize / 2.0;
vec4 nSum = vec4( 0.0 );
float nDenom = 0.0;
vec2 cell = fract( texCoord * mapSize );
for( float m = -1.0; m <= 2.0; ++m ){
for( float n = -1.0; n <= 2.0; ++n ){
vec4 vecData = texture2D(
tex, texCoord + texelSize * vec2( m, n )
);
float c = applyFilter( m - cell.x ) * applyFilter( -n + cell.y );
nSum += vecData * c;
nDenom += c;
}
}
return nSum / nDenom;
}
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( CUBIC_INTERPOLATION )
gl_FragColor = biCubic( map, vUv );
#else
gl_FragColor = texture2D( map, vUv );
#endif
#if defined( PICKING )
if( gl_FragColor.a < 0.3 )
discard;
gl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );
#else
if( gl_FragColor.a < 0.01 )
discard;
gl_FragColor.a *= opacity;
#include fog_fragment
#endif
}`);const Vhe=new Uint16Array([0,1,2,1,3,2]),Hhe=new Float32Array([0,1,0,0,1,1,1,0]),$he=Object.assign({filter:"nearest",forceTransparent:!0},Os),Whe=Object.assign({filter:{updateShader:!0,uniform:!0}},$d);class jhe extends Tl{constructor(e,t){super({position:e.position,index:Vhe,picking:e.picking},t),this.parameterTypes=Whe,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";const{imageData:n,width:r,height:s}=e,o=new wC(n,r,s);o.flipY=!0,this.tex=o;const a=n.length,l=new Uint8Array(a);for(let u=0;u<a;u+=4){const h=u/4;l[u]=h>>16&255,l[u+1]=h>>8&255,l[u+2]=255&h}const c=new wC(l,r,s);c.flipY=!0,c.minFilter=ei,c.magFilter=ei,this.pickingTex=c,this.addUniforms({map:{value:o},pickingMap:{value:c},mapSize:{value:new on(r,s)}}),this.geometry.setAttribute("uv",new Qi(Hhe,2))}get defaultParameters(){return $he}getDefines(e){const t=super.getDefines(e),n=this.parameters.filter;return n.startsWith("cubic")&&(t.CUBIC_INTERPOLATION=1,n.endsWith("bspline")?t.BSPLINE_FILTER=1:n.endsWith("catmulrom")?t.CATMULROM_FILTER=1:n.endsWith("mitchell")&&(t.MITCHELL_FILTER=1)),t}updateTexture(){const e=this.tex,t=this.parameters.filter;t.startsWith("cubic")?(e.minFilter=ei,e.magFilter=ei):t==="linear"?(e.minFilter=cs,e.magFilter=cs):(e.minFilter=ei,e.magFilter=ei),e.needsUpdate=!0,this.pickingTex.needsUpdate=!0}makeMaterial(){super.makeMaterial(),this.updateTexture();const e=this.material;e.uniforms.map.value=this.tex,e.blending=mc,e.needsUpdate=!0;const t=this.wireframeMaterial;t.uniforms.map.value=this.tex,t.blending=mc,t.needsUpdate=!0;const n=this.pickingMaterial;n.uniforms.map.value=this.tex,n.uniforms.pickingMap.value=this.pickingTex,n.blending=mc,n.needsUpdate=!0}setUniforms(e){e&&e.filter!==void 0&&(this.updateTexture(),e.map=this.tex),super.setUniforms(e)}}class Xhe{constructor(e,t){const n=t||{};this.dimension=he(n.dimension,"x"),this.positionType=he(n.positionType,"percent"),this.position=he(n.position,30),this.thresholdType=he(n.thresholdType,"sigma"),this.thresholdMin=he(n.thresholdMin,-1/0),this.thresholdMax=he(n.thresholdMax,1/0),this.normalize=he(n.normalize,!1),this.volume=e}getPositionFromCoordinate(e){const t=this.dimension,n=this.volume,r=n.matrix,s=new me().setFromMatrixPosition(r)[t],o=new me().setFromMatrixScale(r)[t];let a;return a=t==="x"?n.nx:t==="y"?n.ny:n.nz,Math.round(((e-s)/(a/100)+1)/o)}getData(e){e=e||{};const t=this.volume,n=t.data,r=t.matrix;let s;function o(O){return Math.round(O/100*(s-1))}function a(O,D,B,W){return 3*(B*t.ny*t.nx+D*t.nx+O)+W}s=this.positionType==="coordinate"?this.getPositionFromCoordinate(this.position):this.position;const l=new Float32Array(12),c=new me;let u,h,d,f,p,_=0,v=0,g=0,b=t.nx,m=t.ny,y=t.nz;function A(O,D,B,W){c.set(O,D,B).applyMatrix4(r).toArray(l,W)}this.dimension==="x"?(d=o(t.nx),f=t.ny-1,p=t.nz-1,u=t.nz,h=t.ny,_=d,b=_+1,A(d,0,0,0),A(d,f,0,3),A(d,0,p,6),A(d,f,p,9)):this.dimension==="y"?(d=t.nx-1,f=o(t.ny),p=t.nz-1,u=t.nz,h=t.nx,v=f,m=v+1,A(0,f,0,0),A(d,f,0,3),A(0,f,p,6),A(d,f,p,9)):this.dimension==="z"&&(d=t.nx-1,f=t.ny-1,p=o(t.nz),u=t.nx,h=t.ny,g=p,y=g+1,A(0,0,p,0),A(0,f,p,3),A(d,0,p,6),A(d,f,p,9));let w=0,M=0;const T=new Uint8Array(u*h*4),E=new Float32Array(u*h);let C,N;this.thresholdType==="sigma"?(C=t.getValueForSigma(this.thresholdMin),N=t.getValueForSigma(this.thresholdMax)):(C=this.thresholdMin,N=this.thresholdMax);const P=Object.assign({},e.colorParams,{volume:t});this.normalize&&(P.domain=[0,1]);const L=_n.getScheme(P),R=new Float32Array(3),F=L.getScale();let V,G=0,U=0;if(this.normalize){G=1/0,V=-1/0;for(let O=v;O<m;++O)for(let D=_;D<b;++D)for(let B=g;B<y;++B){const W=n[a(D,O,B,0)/3];W<G&&(G=W),W>V&&(V=W)}U=V-G}for(let O=v;O<m;++O)for(let D=_;D<b;++D)for(let B=g;B<y;++B){const W=a(D,O,B,0)/3;let q=n[W];this.normalize&&(q=(q-G)/U),L.colorToArray(F(q),R),T[w]=Math.round(255*R[0]),T[w+1]=Math.round(255*R[1]),T[w+2]=Math.round(255*R[2]),T[w+3]=q>C&&q<N?255:0,E[M]=W,++M,w+=4}const z=new zue(E,t);return{position:l,imageData:T,width:u,height:h,picking:z}}}class qhe extends K1{constructor(e,t,n){super(e,t,n),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=e,this.init(n)}init(e){const t=this.volume,n=e||{};n.colorDomain=he(n.colorDomain,[t.min,t.max]),n.colorScheme=he(n.colorScheme,"value"),n.colorScale=he(n.colorScale,"Spectral"),this.colorScheme="value",this.dimension=he(n.dimension,"x"),this.filter=he(n.filter,"cubic-bspline"),this.positionType=he(n.positionType,"percent"),this.position=he(n.position,30),this.thresholdType=he(n.thresholdType,"sigma"),this.thresholdMin=he(n.thresholdMin,-1/0),this.thresholdMax=he(n.thresholdMax,1/0),this.normalize=he(n.normalize,!1),super.init(n),this.build()}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t)}),this.setVisibility(this.visible),e()}create(){const e=new Xhe(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),t=new jhe(e.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(t)}}function AA(i){tt.error(`makeRepresentation: representation type ${i} unknown`)}const I3={name:"some element",status:""};class rH{constructor(e,t={}){this.stage=e,this.signals={statusChanged:new rn.Signal,nameChanged:new rn.Signal,disposed:new rn.Signal},this.parameters=Io(t,this.defaultParameters),this.uuid=m3()}get defaultParameters(){return I3}get name(){return this.parameters.name}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}dispose(){this.signals.disposed.dispatch()}}const Yhe=Object.assign({visible:!0},I3);class Khe extends rH{constructor(e,t,n={},r){super(e,Object.assign({name:t.type},n)),this.parent=r,this.signals=Object.assign({visibilityChanged:new rn.Signal,parametersChanged:new rn.Signal},this.signals),this.setRepresentation(t)}get defaultParameters(){return Yhe}get visible(){return this.parameters.visible}get type(){return"representation"}getType(){return this.repr.type}setRepresentation(e){this._disposeRepresentation(),this.repr=e,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()}_disposeRepresentation(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())}dispose(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())}setVisibility(e){return this.parameters.visible=e,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this}getVisibility(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible}toggleVisibility(){return this.setVisibility(!this.parameters.visible)}updateVisibility(){this.repr.setVisibility(this.getVisibility())}update(e){return this.repr.update(e),this}build(e){return this.repr.build(e),this}setSelection(e){const t=this.repr;return t.setSelection&&t.setSelection(e),this}setParameters(e){return this.repr.setParameters(e),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this}getParameters(){return this.repr.getParameters()}setColor(e){return this.repr.setColor(e),this}}const Qf=new Ct,Zhe=new me,sH={name:"",status:"",visible:!0};class s2{constructor(e,t,n={}){this.stage=e,this.object=t,this.signals={representationAdded:new rn.Signal,representationRemoved:new rn.Signal,visibilityChanged:new rn.Signal,matrixChanged:new rn.Signal,statusChanged:new rn.Signal,nameChanged:new rn.Signal,disposed:new rn.Signal},this.reprList=[],this.annotationList=[],this.matrix=new Ct,this.position=new me,this.quaternion=new Ns,this.scale=new me(1,1,1),this.transform=new Ct,this.parameters=Io(n,this.defaultParameters),this.uuid=m3(),this.viewer=e.viewer,this.controls=new Que(this)}get defaultParameters(){return sH}get name(){return this.parameters.name}get status(){return this.parameters.status}get visible(){return this.parameters.visible}setPosition(e){return Array.isArray(e)?this.position.fromArray(e):this.position.copy(e),this.updateMatrix(),this}setRotation(e){if(Array.isArray(e))if(e.length===3){const t=new mm().fromArray(e);this.quaternion.setFromEuler(t)}else this.quaternion.fromArray(e);else e instanceof mm?this.quaternion.setFromEuler(e):this.quaternion.copy(e);return this.updateMatrix(),this}setScale(e){return this.scale.set(e,e,e),this.updateMatrix(),this}setTransform(e){return this.transform.copy(e),this.updateMatrix(),this}updateMatrix(){const e=this.getCenterUntransformed(Zhe);this.matrix.makeTranslation(-e.x,-e.y,-e.z),Qf.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(Qf),Qf.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(Qf);const t=this.position;Qf.makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z),this.matrix.premultiply(Qf),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)}updateRepresentationMatrices(){this.reprList.forEach(e=>{e.setParameters({matrix:this.matrix})})}addAnnotation(e,t,n){const r=new Zue(this,e,t,n);return this.annotationList.push(r),r}eachAnnotation(e){this.annotationList.slice().forEach(e)}removeAnnotation(e){const t=this.annotationList.indexOf(e);t!==-1&&(this.annotationList.splice(t,1),e.dispose())}removeAllAnnotations(){this.eachAnnotation(e=>e.dispose()),this.annotationList.length=0}_addRepresentation(e,t,n,r=!1){const s=n||{},o=this.stage.getParameters();s.matrix=this.matrix.clone(),s.quality=s.quality||o.quality,s.disableImpostor=he(s.disableImpostor,!o.impostor),s.useWorker=he(s.useWorker,o.workerDefault),s.visible=he(s.visible,!0);const a=Object.assign({},s,{visible:this.parameters.visible&&s.visible}),l=function(u,h,d,f){var p;if(pt&&tt.time("makeRepresentation "+u),h instanceof cl){if(!(p=ri.get(u)))return void AA(u)}else if(h instanceof t2)if(u==="surface")p=BC;else{if(u!=="dot")return void AA(u);p=v4}else if(h instanceof js)if(u==="surface")p=BC;else if(u==="dot")p=v4;else{if(u!=="slice")return void AA(u);p=qhe}else if(h instanceof Nhe)p=p4,h=h.getBufferList();else{if(u!=="buffer")return void tt.error("makeRepresentation: object "+h+" unknown");p=p4}const _=new p(h,d,f);return pt&&tt.timeEnd("makeRepresentation "+u),_}(e,t,this.viewer,a),c=new Khe(this.stage,l,s,this);return r||(this.reprList.push(c),this.signals.representationAdded.dispatch(c)),c}addBufferRepresentation(e,t){return this._addRepresentation.call(this,"buffer",e,t)}hasRepresentation(e){return this.reprList.indexOf(e)!==-1}eachRepresentation(e){this.reprList.slice().forEach(e)}removeRepresentation(e){const t=this.reprList.indexOf(e);t!==-1&&(this.reprList.splice(t,1),e.dispose(),this.signals.representationRemoved.dispatch(e))}updateRepresentations(e){this.reprList.forEach(t=>t.update(e)),this.stage.viewer.requestRender()}removeAllRepresentations(){this.eachRepresentation(e=>e.dispose())}dispose(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()}setVisibility(e){return this.parameters.visible=e,this.eachRepresentation(t=>t.updateVisibility()),this.eachAnnotation(t=>t.updateVisibility()),this.signals.visibilityChanged.dispatch(e),this}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}getBox(...e){return this.getBoxUntransformed(...e).clone().applyMatrix4(this.matrix)}getCenter(...e){return this.getCenterUntransformed(...e).clone().applyMatrix4(this.matrix)}getZoom(...e){return this.stage.getZoomForBox(this.getBox(...e))}getBoxUntransformed(...e){return new Li}getCenterUntransformed(...e){return this.getBoxUntransformed().getCenter(new me)}autoView(e){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),he(e,0))}}class oH{constructor(e=[]){this.list=e;const t=e.length;for(let n=0;n<t;++n)e[n].signals.disposed.add(this._remove,this)}_remove(e){const t=this.list.indexOf(e);t!==-1&&this.list.splice(t,1)}get first(){return this.list.length>0?this.list[0]:void 0}forEach(e){return this.list.forEach(e),this}dispose(){return this.forEach(e=>e.dispose())}}class aH extends oH{setParameters(e){return this.forEach(t=>t.setParameters(e))}setVisibility(e){return this.forEach(t=>t.setVisibility(e))}setSelection(e){return this.forEach(t=>t.setSelection(e))}setColor(e){return this.forEach(t=>t.setColor(e))}update(e){return this.forEach(t=>t.update(e))}build(e){return this.forEach(t=>t.build(e))}dispose(e){return this.forEach(t=>t.dispose())}}const Qhe=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},I3);class Jhe extends rH{constructor(e,t,n={}){super(e,Object.assign({name:t.name},n)),this.trajectory=t,this.signals=Object.assign(this.signals,{frameChanged:new rn.Signal,playerChanged:new rn.Signal,countChanged:new rn.Signal,parametersChanged:new rn.Signal}),t.signals.frameChanged.add(r=>{this.signals.frameChanged.dispatch(r)}),t.signals.playerChanged.add(r=>{this.signals.playerChanged.dispatch(r)}),t.signals.countChanged.add(r=>{this.signals.countChanged.dispatch(r)}),n.initialFrame!==void 0&&this.setFrame(n.initialFrame)}get defaultParameters(){return Qhe}get type(){return"trajectory"}setFrame(e){this.trajectory.setFrame(e)}setParameters(e={}){this.trajectory.setParameters(e),this.signals.parametersChanged.dispatch(e)}dispose(){this.trajectory.dispose(),super.dispose()}}class lH{constructor(e,t){this.name=e,this.path=t,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1}get type(){return"Frames"}}class cH{constructor(e,t){let n,r;if(this.A=new On(3,3),this.W=new On(1,3),this.U=new On(3,3),this.V=new On(3,3),this.VH=new On(3,3),this.R=new On(3,3),this.tmp=new On(3,3),this.c=new On(3,3),e instanceof cl)n=e.atomCount;else{if(!(e instanceof Float32Array))return;n=e.length/3}if(t instanceof cl)r=t.atomCount;else{if(!(t instanceof Float32Array))return;r=t.length/3}const s=Math.min(n,r),o=new On(3,s),a=new On(3,s);this.coords1t=new On(s,3),this.coords2t=new On(s,3),this.transformationMatrix=new Ct,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(e,o,s,!1),this.prepCoords(t,a,s,!1),this._superpose(o,a)}_superpose(e,t){this.mean1=NC(e),this.mean2=NC(t),FC(e,this.mean1),FC(t,this.mean2),Da(this.coords1t,e),Da(this.coords2t,t),zx(this.A,this.coords2t,this.coords1t),$V(this.A,this.W,this.U,this.V),function(d,f){const p=d.data,_=f.data,v=p[4],g=p[8],b=p[5],m=p[7],y=p[0],A=y*v,w=y*b,M=p[3],T=p[1],E=M*T,C=p[2],N=M*C,P=p[6],L=P*T,R=P*C,F=1/(A*g-w*m-E*g+N*m+L*b-R*v);_[0]=(v*g-b*m)*F,_[1]=-(T*g-C*m)*F,_[2]=-(-T*b+C*v)*F,_[3]=-(M*g-b*P)*F,_[4]=(y*g-R)*F,_[5]=-(w-N)*F,_[6]=-(-M*m+v*P)*F,_[7]=-(y*m-L)*F,_[8]=(A-E)*F}(this.V,this.VH),_A(this.R,this.U,this.VH),function(d){const f=d.data;return f[0]*f[4]*f[8]-f[0]*f[5]*f[7]-f[3]*f[1]*f[8]+f[3]*f[2]*f[7]+f[6]*f[1]*f[5]-f[6]*f[2]*f[4]}(this.R)<0&&(pt&&tt.log("R not a right handed system"),_A(this.tmp,this.c,this.VH),_A(this.R,this.U,this.tmp));const n=new On(4,4),r=new On(4,4),s=new On(4,4),o=new On(4,4),a=new On(4,4),l=new On(4,4),c=this.R.data,u=this.mean1,h=this.mean2;o.data.set([1,0,0,-u[0],0,1,0,-u[1],0,0,1,-u[2],0,0,0,1]),a.data.set([c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,0,0,0,1]),l.data.set([1,0,0,h[0],0,1,0,h[1],0,0,1,h[2],0,0,0,1]),Da(r,o),zx(n,a,r),Da(s,n),zx(r,l,s),Da(n,r),this.transformationMatrix.elements=n.data}prepCoords(e,t,n,r){let s=0;const o=t.data;let a=3,l=3*n;if(r&&(l=4*n,a=4),e instanceof cl)e.eachAtom(function(c){s<l&&(o[s+0]=c.x,o[s+1]=c.y,o[s+2]=c.z,r&&(o[s+3]=1),s+=a)});else if(e instanceof Float32Array)for(;s<l;s+=a)s<l&&(o[s]=e[s],o[s+1]=e[s+1],o[s+2]=e[s+2],r&&(o[s+3]=1));else tt.warn("prepCoords: input type unknown")}transform(e){let t;if(e instanceof cl)t=e.atomCount;else{if(!(e instanceof Float32Array))return;t=e.length/3}const n=new On(4,t),r=new On(t,4);this.prepCoords(e,n,t,!0);const s=this.transformationMatrix,o=s.determinant();if(!o)return o;const a=new On(4,4);a.data=s.elements,function(u,h,d){let f=0,p=0,_=0,v=0,g=0,b=0,m=0,y=0;const A=h.cols,w=h.rows,M=d.cols,T=h.data,E=d.data,C=u.data;let N=0;for(;f<w;v+=A,f++)for(m=0,p=0;p<M;y++,m++,p++){for(b=m,g=v,N=0,_=0;_<A;g++,b+=M,_++)N+=T[g]*E[b];C[y]=N}}(r,n,a);let l=0;const c=r.data;if(e instanceof cl){e.eachAtom(function(d){d.x=c[l],d.y=c[l+1],d.z=c[l+2],l+=4});const u=new Ct;u.copy(s).invert();const h=e.biomolDict;for(let d in h)h.hasOwnProperty(d)&&h[d].partList.forEach(function(f){f.matrixList.forEach(function(p){p.premultiply(s),p.multiply(u)})})}else if(e instanceof Float32Array){const u=4*t;for(;l<u;l+=4)e[l]=c[l],e[l+1]=c[l+1],e[l+2]=c[l+2]}else tt.warn("transform: input type unknown");return this.transformationMatrix}}const ede={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"};class tde{constructor(e,t={}){this.signals={startedRunning:new rn.Signal,haltedRunning:new rn.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,e.signals.playerChanged.add(r=>{r!==this&&this.pause()},this);const n=he(e.frameCount,1);this.traj=e,this.parameters=Io(t,ede),this.parameters.end=Math.min(he(t.end,n-1),n-1),this.parameters.step=he(t.step,Math.ceil((n+1)/100)),this._currentFrame=this.parameters.start,this._direction=this.parameters.direction==="bounce"?"forward":this.parameters.direction,e.signals.countChanged.add(r=>{this.parameters.end=Math.min(he(this.parameters.end,r-1),r-1)},this),this._animate=this._animate.bind(this)}get isRunning(){return this._run}setParameters(e={}){dV(this.parameters,e),e.direction!==void 0&&this.parameters.direction!=="bounce"&&(this._direction=this.parameters.direction)}_animate(){if(!this._run)return;this._currentTime=window.performance.now();const e=this._currentTime-this._previousTime,t=this.parameters.interpolateType?this.parameters.interpolateStep:1,n=this.parameters.timeout/t,r=this.traj;if(r&&r.frameCount&&!r.inProgress&&e>=n)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),this._currentStep===1&&(this._currentFrame=this._nextInterpolated()),r.hasFrame(this._currentFrame)){this._currentStep+=1;const s=this._currentStep/(this.parameters.interpolateStep+1),[o,a,l,c]=this._currentFrame;r.setFrameInterpolated(o,a,l,c,s,this.parameters.interpolateType),this._previousTime=this._currentTime}else r.loadFrame(this._currentFrame);else{const s=this._next();r.hasFrame(s)?(r.setFrame(s),this._previousTime=this._currentTime):r.loadFrame(s)}window.requestAnimationFrame(this._animate)}_next(){const e=this.parameters;let t;return t=this._direction==="forward"?this.traj.currentFrame+e.step:this.traj.currentFrame-e.step,(t>e.end||t<e.start)&&(e.direction==="bounce"&&(this._direction==="forward"?this._direction="backward":this._direction="forward"),e.mode==="once"?(this.pause(),t=e.direction==="forward"?e.end:e.direction==="backward"||this._direction==="forward"?e.start:e.end):this._direction==="forward"?(t=e.start,e.interpolateType&&(t=Math.min(e.end,t+e.step))):(t=e.end,e.interpolateType&&(t=Math.max(e.start,t-e.step)))),t}_nextInterpolated(){const e=this.parameters,t=this._next();let n,r,s;return this._direction==="forward"?(n=Math.max(e.start,t-e.step),r=Math.max(e.start,t-2*e.step),s=Math.max(e.start,t-3*e.step)):(n=Math.min(e.end,t+e.step),r=Math.min(e.end,t+2*e.step),s=Math.min(e.end,t+3*e.step)),[t,n,r,s]}toggle(){this._run?this.pause():this.play()}play(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;const e=this.parameters,t=this.traj.currentFrame;let n=Math.ceil(t/e.step)*e.step;e.direction==="forward"&&t>=e.end?n=e.start:e.direction==="backward"&&t<=e.start&&(n=e.end),this.traj.setFrame(n),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}}pause(){this._run=!1,this.signals.haltedRunning.dispatch()}stop(){this.pause(),this.traj.setFrame(this.parameters.start)}}class o2{constructor(e,t,n={}){this.signals={countChanged:new rn.Signal,frameChanged:new rn.Signal,playerChanged:new rn.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=he(n.deltaTime,0),this.timeOffset=he(n.timeOffset,0),this.centerPbc=he(n.centerPbc,!1),this.removePbc=he(n.removePbc,!1),this.removePeriodicity=he(n.removePeriodicity,!1),this.superpose=he(n.superpose,!1),this.name=e.replace(/^.*[\\/]/,""),this.trajPath=e,this.selection=new ii(he(n.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add(()=>{this.selectionIndices=this.structure.getAtomIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)})}get frameCount(){return this._frameCount}get currentFrame(){return this._currentFrame}_init(e){this.setStructure(e),this._loadFrameCount(),this.setPlayer(new tde(this))}_loadFrameCount(){}setStructure(e){this.structure=e,this.atomCount=e.atomCount,this.backboneIndices=this._getIndices(new ii("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}_saveInitialCoords(){this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,()=>this._saveInitialCoords())}_saveStructureCoords(){this.structureCoords=this.structure.getAtomData({what:{position:!0}}).position}setSelection(e){return this.selection.setString(e),this}_getIndices(e){let t=0;const n=e.test,r=[];return n&&this.structure.eachAtom(s=>{n(s)&&r.push(t),t+=1}),r}_makeSuperposeCoords(){const e=3*this.selectionIndices.length;this.coords1=new Float32Array(e),this.coords2=new Float32Array(e);const t=this.initialCoords,n=this.coords2;for(let r=0;r<e;r+=3){const s=3*this.selectionIndices[r/3];n[r+0]=t[s+0],n[r+1]=t[s+1],n[r+2]=t[s+2]}}_makeAtomIndices(){tt.error("Trajectory._makeAtomIndices not implemented")}_resetCache(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)}setParameters(e={}){let t=!1;e.centerPbc!==void 0&&e.centerPbc!==this.centerPbc&&(this.centerPbc=e.centerPbc,t=!0),e.removePeriodicity!==void 0&&e.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=e.removePeriodicity,t=!0),e.removePbc!==void 0&&e.removePbc!==this.removePbc&&(this.removePbc=e.removePbc,t=!0),e.superpose!==void 0&&e.superpose!==this.superpose&&(this.superpose=e.superpose,t=!0),this.deltaTime=he(e.deltaTime,this.deltaTime),this.timeOffset=he(e.timeOffset,this.timeOffset),t&&(this._resetCache(),this.setFrame(this._currentFrame))}hasFrame(e){return Array.isArray(e)?e.every(t=>!!this.frameCache[t]):!!this.frameCache[e]}setFrame(e,t){return e===void 0||(this.inProgress=!0,e===-1||this.frameCache[e]?(this._updateStructure(e),t&&t()):this.loadFrame(e,()=>{this._updateStructure(e),t&&t()})),this}_interpolate(e,t,n,r,s,o){const a=this.frameCache;let l;l=o==="spline"?function(c,u,h,d,f){const p=c.length,_=new Float32Array(p);for(let v=0;v<p;v+=3){const g=v+1,b=v+2;_[v]=rc(d[v],h[v],u[v],c[v],f,1),_[g]=rc(d[g],h[g],u[g],c[g],f,1),_[b]=rc(d[b],h[b],u[b],c[b],f,1)}return _}(a[e],a[t],a[n],a[r],s):function(c,u,h){const d=c.length,f=new Float32Array(d);for(let p=0;p<d;p+=3){const _=p+1,v=p+2;f[p]=Zo(u[p],c[p],h),f[_]=Zo(u[_],c[_],h),f[v]=Zo(u[v],c[v],h)}return f}(a[e],a[t],s),this.structure.updatePosition(l),this._currentFrame=e,this.signals.frameChanged.dispatch(e)}setFrameInterpolated(e,t,n,r,s,o,a){if(e===void 0)return this;const l=this.frameCache,c=[];return l[r]||c.push(r),l[n]||c.push(n),l[t]||c.push(t),l[e]||c.push(e),c.length?this.loadFrame(c,()=>{this._interpolate(e,t,n,r,s,o),a&&a()}):(this._interpolate(e,t,n,r,s,o),a&&a()),this}loadFrame(e,t){Array.isArray(e)?e.forEach(n=>{this.loadQueue[n]||this.frameCache[n]||(this.loadQueue[n]=!0,this._loadFrame(n,()=>{delete this.loadQueue[n]}))}):this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,()=>{delete this.loadQueue[e],t&&t()}))}_loadFrame(e,t){tt.error("Trajectory._loadFrame not implemented",e,t)}_updateStructure(e){this._disposed?console.error("updateStructure: traj disposed"):(e===-1?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[e]),this.structure.trajectory={name:this.trajPath,frame:e},this._currentFrame=e,this.inProgress=!1,this.signals.frameChanged.dispatch(e))}_doSuperpose(e){const t=3*this.selectionIndices.length,n=this.coords1,r=this.coords2;for(let s=0;s<t;s+=3){const o=3*this.selectionIndices[s/3];n[s+0]=e[o+0],n[s+1]=e[o+1],n[s+2]=e[o+2]}new cH(n,r).transform(e)}_process(e,t,n,r){if(this._setFrameCount(r),t){if(this.backboneIndices.length>0&&this.centerPbc){const s=[t[0],t[4],t[8]],o=function(a,l,c){return[uA(l,c[0],3,0,a),uA(l,c[1],3,1,a),uA(l,c[2],3,2,a)]}(this.backboneIndices,n,s);(function(a,l,c){if(c[0]===0||c[8]===0||c[4]===0)return;const u=a.length,h=c[0],d=c[1],f=c[2],p=-l[0]+h+h/2,_=-l[1]+d+d/2,v=-l[2]+f+f/2;for(let g=0;g<u;g+=3)a[g+0]=(a[g+0]+p)%h,a[g+1]=(a[g+1]+_)%d,a[g+2]=(a[g+2]+v)%f})(n,o,s)}if(this.removePeriodicity){const s=function(o){return[Ox(o,3,0),Ox(o,3,1),Ox(o,3,2)]}(n);(function(o,a,l){if(a[0]===0||a[8]===0||a[4]===0)return;const c=o.length;for(let u=3;u<c;u+=3)for(let h=0;h<3;++h){const d=(o[u+h]-l[h])/a[3*h+h];Math.abs(d)>.5&&(o[u+h]-=a[3*h+h]*Math.round(d))}})(n,t,s)}this.removePbc&&function(s,o){if(o[0]===0||o[8]===0||o[4]===0)return;const a=s.length;for(let l=3;l<a;l+=3)for(let c=0;c<3;++c){const u=s[l+c]-s[l-3+c];if(Math.abs(u)>.9*o[3*c+c])if(u>0)for(let h=0;h<3;++h)s[l+h]-=o[3*c+h];else for(let h=0;h<3;++h)s[l+h]+=o[3*c+h]}}(n,t)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(n),this.frameCache[e]=n,this.boxCache[e]=t,this.frameCacheSize+=1}_setFrameCount(e){e!==this._frameCount&&(this._frameCount=e,this.signals.countChanged.dispatch(e))}dispose(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()}setPlayer(e){this.player=e,this.signals.playerChanged.dispatch(e)}getFrameTime(e){return this.timeOffset+e*this.deltaTime}}class nde extends o2{constructor(e,t,n){const r=n||{};r.timeOffset=he(r.timeOffset,e.timeOffset),r.deltaTime=he(r.deltaTime,e.deltaTime),super("",t,r),this.name=e.name,this.path=e.path,this.frames=e.coordinates,this.boxes=e.boxes,this._init(t)}get type(){return"frames"}_makeAtomIndices(){this.structure.type==="StructureView"?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const r=this.frames[e];if(this.atomIndices){const a=this.atomIndices,l=a.length;n=new Float32Array(3*l);for(let c=0;c<l;++c){const u=3*c,h=3*a[c];n[u+0]=r[h+0],n[u+1]=r[h+1],n[u+2]=r[h+2]}}else n=new Float32Array(r);const s=this.boxes[e],o=this.frames.length;this._process(e,s,n,o),typeof t=="function"&&t()}_loadFrameCount(){this.frames&&this._setFrameCount(this.frames.length)}}class ide extends o2{constructor(e,t,n){super("",t,n),this._init(t)}get type(){return"structure"}_makeAtomIndices(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const r=this.structure,s=r.frames[e];if(this.atomIndices){const l=this.atomIndices,c=l.length;n=new Float32Array(3*c);for(let u=0;u<c;++u){const h=3*u,d=3*l[u];n[h+0]=s[d+0],n[h+1]=s[d+1],n[h+2]=s[d+2]}}else n=new Float32Array(s);const o=r.boxes[e],a=r.frames.length;this._process(e,o,n,a),typeof t=="function"&&t()}_loadFrameCount(){this._setFrameCount(this.structure.frames.length)}}class rde extends o2{constructor(e,t,n){super(e,t,n),this._init(t)}get type(){return"remote"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),n=t.length;let r=t[0],s=t[0];for(let o=1;o<n;++o){const a=t[o];s+1<a&&(e.push([r,s+1]),r=a),s=a}e.push([r,s+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){const n=new XMLHttpRequest,r=oA.getFrameUrl(this.trajPath,e),s=oA.getFrameParams(this.trajPath,this.atomIndices);n.open("POST",r,!0),n.responseType="arraybuffer",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.addEventListener("load",()=>{const o=n.response;if(!o)return void tt.error(`empty arrayBuffer for '${r}'`);const a=new Int32Array(o,0,1)[0],l=new Float32Array(o,8,9),c=new Float32Array(o,44);this._process(e,l,c,a),typeof t=="function"&&t()},!1),n.send(s)}_loadFrameCount(){const e=new XMLHttpRequest,t=oA.getCountUrl(this.trajPath);e.open("GET",t,!0),e.addEventListener("load",()=>{this._setFrameCount(parseInt(e.response))},!1),e.send()}}class sde extends o2{constructor(e,t,n){super("",t,n),this.requestCallback=e,this._init(t)}get type(){return"callback"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),n=t.length;let r=t[0],s=t[0];for(let o=1;o<n;++o){const a=t[o];s+1<a&&(e.push([r,s+1]),r=a),s=a}e.push([r,s+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){this.requestCallback((n,r,s,o)=>{this._process(n,r,s,o),typeof t=="function"&&t()},e,this.atomIndices)}_loadFrameCount(){this.requestCallback(e=>this._setFrameCount(e))}}cl.prototype.getView=function(i){return new uH(this,i)};class uH extends cl{constructor(e,t){super(),this.structure=e,this.selection=t,this.center=new me,this.boundingBox=new Li,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}init(){}get type(){return"StructureView"}get name(){return this.structure.name}get path(){return this.structure.path}get title(){return this.structure.title}get id(){return this.structure.id}get data(){return this.structure.data}get atomSetDict(){return this.structure.atomSetDict}get biomolDict(){return this.structure.biomolDict}get entityList(){return this.structure.entityList}get unitcell(){return this.structure.unitcell}get frames(){return this.structure.frames}get boxes(){return this.structure.boxes}get validation(){return this.structure.validation}get bondStore(){return this.structure.bondStore}get backboneBondStore(){return this.structure.backboneBondStore}get rungBondStore(){return this.structure.rungBondStore}get atomStore(){return this.structure.atomStore}get residueStore(){return this.structure.residueStore}get chainStore(){return this.structure.chainStore}get modelStore(){return this.structure.modelStore}get atomMap(){return this.structure.atomMap}get residueMap(){return this.structure.residueMap}get bondHash(){return this.structure.bondHash}get spatialHash(){return this.structure.spatialHash}get _hasCoords(){return this.structure._hasCoords}set _hasCoords(e){this.structure._hasCoords=e}refresh(){pt&&tt.time("StructureView.refresh"),this.atomSetCache={};const e=this.structure;if(this.selection.isAllSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=e.atomSet.clone(),this.bondSet=e.bondSet.clone();for(let t in this.atomSetDict){const n=this.atomSetDict[t];this.atomSetCache["__"+t]=n.clone()}this.atomCount=e.atomCount,this.bondCount=e.bondCount,this.boundingBox.copy(e.boundingBox),this.center.copy(e.center)}else if(this.selection.isNoneSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=new gr(e.atomCount),this.bondSet=new gr(e.bondCount);for(let t in this.atomSetDict)this.atomSetCache["__"+t]=new gr(e.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),e.atomSet&&(this.atomSet=this.atomSet.intersection(e.atomSet)),this.bondSet=this.getBondSet();for(let t in this.atomSetDict){const n=this.atomSetDict[t];this.atomSetCache["__"+t]=n.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new me)}pt&&tt.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()}setSelection(e){this.selection=e,this.refresh()}getSelection(e){const t=[];e&&e.string&&t.push(e.string);const n=this.structure.getSelection();n&&n.string&&t.push(n.string),this.selection&&this.selection.string&&t.push(this.selection.string);let r="";return t.length>0&&(r=`( ${t.join(" ) AND ( ")} )`),new ii(r)}getStructure(){return this.structure.getStructure()}eachBond(e,t){this.structure.eachBond(e,this.getSelection(t))}eachAtom(e,t){const n=this.getAtomProxy(),r=this.getAtomSet(t),s=this.atomStore.count;if(r.getSize()<s)r.forEach(function(o){n.index=o,e(n)});else for(let o=0;o<s;++o)n.index=o,e(n)}eachResidue(e,t){this.structure.eachResidue(e,this.getSelection(t))}eachResidueN(e,t){console.error("StructureView.eachResidueN() not implemented")}eachChain(e,t){this.structure.eachChain(e,this.getSelection(t))}eachModel(e,t){this.structure.eachModel(e,this.getSelection(t))}getAtomSet(e,t=!1){let n=this.structure.getAtomSet(e);return!t&&this.atomSet&&(n=n.makeIntersection(this.atomSet)),n}getAtomIndices(e){return this.structure.getAtomIndices(this.getSelection(e))}refreshPosition(){return this.structure.refreshPosition()}dispose(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new cl,delete this.atomSet,delete this.bondSet}}const ode=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]];function _4(i,e){let t,n=0;const r={};return e.forEach(function(s){t=0;const o={};s.forEach(function(a){o[i[t++]]=a}),r[i[n++]]=o}),r}const ade={blosum62:_4("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:_4("ACDEFGHIKLMNPQRSTVWY",ode)};class lde{constructor(e,t,n=-10,r=-1,s="blosum62"){this.seq1=e,this.seq2=t,this.gapPenalty=n,this.gapExtensionPenalty=r,s&&(this.substMatrix=ade[s])}initMatrices(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(let e=0;e<=this.n;++e){this.S[e]=[],this.V[e]=[],this.H[e]=[];for(let t=0;t<=this.m;++t)this.S[e][t]=0,this.V[e][t]=0,this.H[e][t]=0}for(let e=0;e<=this.n;++e)this.S[e][0]=this.gap(0),this.H[e][0]=-1/0;for(let e=0;e<=this.m;++e)this.S[0][e]=this.gap(0),this.V[0][e]=-1/0;this.S[0][0]=0}gap(e){return this.gapPenalty+e*this.gapExtensionPenalty}makeScoreFn(){const e=this.seq1,t=this.seq2,n=this.substMatrix;return n?function(r,s){const o=e[r],a=t[s];try{return n[o][a]}catch{return-4}}:(tt.warn("Alignment: no subst matrix"),function(r,s){return e[r]===t[s]?5:-3})}calc(){pt&&tt.time("Alignment.calc"),this.initMatrices();const e=this.gap(0),t=this.makeScoreFn(),n=this.gapExtensionPenalty,r=this.V,s=this.H,o=this.S,a=this.n,l=this.m;let c,u,h,d,f;for(let p=1;p<=a;++p){u=o[p-1],c=r[p-1],h=r[p],d=s[p],f=o[p];for(let _=1;_<=l;++_)h[_]=Math.max(u[_]+e,c[_]+n),d[_]=Math.max(f[_-1]+e,d[_-1]+n),f[_]=Math.max(u[_-1]+t(p-1,_-1),h[_],d[_])}pt&&tt.timeEnd("Alignment.calc"),pt&&tt.log(this.S,this.V,this.H)}trace(){pt&&tt.time("Alignment.trace"),this.ali1="",this.ali2="";const e=this.makeScoreFn();let t,n=this.n,r=this.m;for(this.S[n][r]>=this.V[n][r]?(t="S",this.score=this.S[n][r]):this.V[n][r]>=this.H[n][r]?(t="V",this.score=this.V[n][r]):(t="H",this.score=this.H[n][r]),pt&&tt.log("Alignment: SCORE",this.score),pt&&tt.log("Alignment: S, V, H",this.S[n][r],this.V[n][r],this.H[n][r]);n>0&&r>0;)t==="S"?this.S[n][r]===this.S[n-1][r-1]+e(n-1,r-1)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--n,--r,t="S"):this.S[n][r]===this.V[n][r]?t="V":this.S[n][r]===this.H[n][r]?t="H":(--n,--r):t==="V"?this.V[n][r]===this.V[n-1][r]+this.gapExtensionPenalty?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="V"):this.V[n][r]===this.S[n-1][r]+this.gap(0)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="S"):--n:t==="H"?this.H[n][r]===this.H[n][r-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r,t="H"):this.H[n][r]===this.S[n][r-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r,t="S"):--r:tt.error("Alignment: no matrix");for(;n>0;)this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n;for(;r>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r;pt&&tt.timeEnd("Alignment.trace"),pt&&tt.log([this.ali1,this.ali2])}}function cde(i,e,t=!1,n="",r=""){let s,o,a,l,c;if(t){let h=i,d=e;n&&r&&(h=i.getView(new ii(n)),d=e.getView(new ii(r)));const f=h.getSequence(),p=d.getSequence(),_=new lde(f.join(""),p.join(""));let v,g;_.calc(),_.trace(),s=0,o=0,a=_.ali1.length;const b=[],m=[];for(let T=0;T<a;++T){const E=_.ali1[T],C=_.ali2[T];v=0,g=0,E==="-"?m[o]=!1:(m[o]=!0,v=1),C==="-"?b[s]=!1:(b[s]=!0,g=1),s+=v,o+=g}const y=[],A=[],w=h.getAtomProxy(),M=d.getAtomProxy();s=0,h.eachResidue(function(T){T.traceAtomIndex!==void 0&&T.traceAtomIndex===T.getAtomIndexByName("CA")&&(b[s]&&(w.index=T.getAtomIndexByName("CA"),y.push(w.x,w.y,w.z)),s+=1)}),s=0,d.eachResidue(function(T){T.traceAtomIndex!==void 0&&T.traceAtomIndex===T.getAtomIndexByName("CA")&&(m[s]&&(M.index=T.getAtomIndexByName("CA"),A.push(M.x,M.y,M.z)),s+=1)}),l=new Float32Array(y),c=new Float32Array(A)}else l=i.getView(new ii(`${n} and .CA`)),c=e.getView(new ii(`${r} and .CA`));const u=new cH(l,c).transform(i);return i.refreshPosition(),u}const ude=Object.assign({sele:"",defaultAssembly:""},sH);class zC extends s2{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.structure=t,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new rn.Signal,trajectoryRemoved:new rn.Signal,defaultAssemblyChanged:new rn.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=function(r){let s=0,o=0;const a=[];return{has:function(l){return a.indexOf(l)!==-1},get:function(l){return a[l]},push:function(l){a[s]=l,s=(r+s+1)%r,++o},get count(){return o},get data(){return a.slice(0,Math.min(o,r))},clear:function(){o=0,s=0,a.length=0}}}(4),this.pickDict=function(){const r={};return{has:function(s){return r[JSON.stringify(s)]!==void 0},add:function(s,o){r[JSON.stringify(s)]=o},del:function(s){delete r[JSON.stringify(s)]},get values(){return Object.keys(r).map(s=>r[s])}}}(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:Ug.opacity,color:Ug.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",Ug,!0),this.angleRepresentation=this.addRepresentation("angle",Ug,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",Ug,!0),this.measureRepresentations=new aH([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly),this.structure.signals.refreshed.add(()=>{this.updateRepresentations({position:!0})})}get defaultParameters(){return ude}get type(){return"structure"}initSelection(e){this.selection=new ii(e),this.structureView=new uH(this.structure,this.selection),this.selection.signals.stringChanged.add(()=>{this.structureView.setSelection(this.selection),this.rebuildRepresentations(),this.rebuildTrajectories()})}setSelection(e){return this.parameters.sele=e,this.selection.setString(e),this}setDefaultAssembly(e){if(this.structure.biomolDict[e]===void 0&&(e=""),this.parameters.defaultAssembly!==e){const t={defaultAssembly:e};this.reprList.forEach(n=>n.setParameters(t)),this.measureRepresentations.setParameters(t),this.parameters.defaultAssembly=e,this.signals.defaultAssemblyChanged.dispatch(e)}return this}rebuildRepresentations(){this.reprList.forEach(e=>{e.build()}),this.measureRepresentations.build()}rebuildTrajectories(){this.trajList.forEach(e=>{e.trajectory.setStructure(this.structureView)})}updateRepresentations(e){super.updateRepresentations(e),this.measureRepresentations.update(e)}updateRepresentationMatrices(){super.updateRepresentationMatrices(),this.measureRepresentations.setParameters({matrix:this.matrix})}addRepresentation(e,t={},n=!1){t.defaultAssembly=this.parameters.defaultAssembly;const r=this._addRepresentation(e,this.structureView,t,n);return n||r.signals.parametersChanged.add(()=>this.measureUpdate()),r}addTrajectory(e="",t={}){const n=function(s,o,a){let l;return l=s&&s instanceof lH?new nde(s,o,a):!s&&o.frames?new ide(s,o,a):s&&typeof s=="function"?new sde(s,o,a):new rde(s,o,a),l}(e,this.structureView,t),r=new Jhe(this.stage,n,t);return this.trajList.push(r),this.signals.trajectoryAdded.dispatch(r),r}removeTrajectory(e){const t=this.trajList.indexOf(e);t!==-1&&this.trajList.splice(t,1),e.dispose(),this.signals.trajectoryRemoved.dispatch(e)}dispose(){this.trajList.slice().forEach(e=>e.dispose()),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),super.dispose()}autoView(e,t){typeof e=="number"&&(t=e,e=""),this.stage.animationControls.zoomMove(this.getCenter(e),this.getZoom(e),he(t,0))}getBoxUntransformed(e){let t;return t=e?this.structureView.getBoundingBox(new ii(e)):this.structureView.boundingBox,t}getCenterUntransformed(e){return e&&typeof e=="string"?this.structure.atomCenter(new ii(e)):this.structure.center}superpose(e,t,n,r){return cde(this.structureView,e.structureView,t,n,r),this.updateRepresentations({position:!0}),this}getMaxRepresentationRadius(e){let t=0;const n=this.structure.getAtomProxy(e);return this.eachRepresentation(r=>{if(r.getVisibility()){const s=r.repr;t=Math.max(s.getAtomRadius(n),t)}}),t}measurePick(e){const t=this.pickBuffer.count;if(this.lastPick===e.index&&t>=1){if(t>1){const n=this.pickBuffer.data,r=this.pickBuffer.data.sort();this.pickDict.has(r)?this.pickDict.del(r):this.pickDict.add(r,n),t===2?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter(s=>s.length===2)}):t===3?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter(s=>s.length===3)}):t===4&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter(s=>s.length===4)})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(e.index)||this.pickBuffer.push(e.index),this.lastPick=e.index;this.measureUpdate()}measureClear(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")}measureBuild(){const e=this.measureData();this.distanceRepresentation.setParameters({atomPair:e.distance}),this.angleRepresentation.setParameters({atomTriple:e.angle}),this.dihedralRepresentation.setParameters({atomQuad:e.dihedral})}measureUpdate(){const e=this.pickBuffer.data,t={};e.forEach(n=>{const r=Math.max(.1,this.getMaxRepresentationRadius(n));t[n]=r*(2.3-X1(.1,2,r))}),this.spacefillRepresentation.setSelection(e.length?"@"+e.join(","):"none"),e.length&&this.spacefillRepresentation.setParameters({radiusData:t})}measureData(){const e=this.pickDict.values;return{distance:e.filter(t=>t.length===2),angle:e.filter(t=>t.length===3),dihedral:e.filter(t=>t.length===4)}}removeAllMeasurements(e){const t=this.pickDict,n=t.values,r=function(s){n.filter(o=>o.length===s).forEach(o=>t.del(o.slice().sort()))};(!e||1&e)&&r(2),(!e||2&e)&&r(3),(!e||4&e)&&r(4),this.measureBuild()}removeMeasurement(e){this.pickDict.del(e.slice().sort()),this.measureBuild()}addMeasurement(e){if(e.length<2||e.length>4)return;const t=e.slice().sort();this.pickDict.has(t)||this.pickDict.add(t,e),this.measureBuild()}}vm.add("structure",zC),vm.add("structureview",zC);class hH extends s2{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.surface=t}get type(){return"surface"}addRepresentation(e,t={}){return this._addRepresentation(e,this.surface,t)}getBoxUntransformed(){return this.surface.boundingBox}getCenterUntransformed(){return this.surface.center}dispose(){this.surface.dispose(),super.dispose()}}vm.add("surface",hH);class dH extends s2{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.volume=t}get type(){return"volume"}addRepresentation(e,t={}){return this._addRepresentation(e,this.volume,t)}getBoxUntransformed(){return this.volume.boundingBox}getCenterUntransformed(){return this.volume.center}dispose(){this.volume.dispose(),super.dispose()}}vm.add("volume",dH);class y4 extends oH{addRepresentation(e,t){return this.forEach(n=>n.addRepresentation(e,t))}autoView(e){return this.forEach(t=>t.autoView(e))}}function x4(i,e){return i instanceof RegExp?e.name.match(i)!==null:e.name===i}const hde=new me,dde={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1.2,ambientColor:14540253,ambientIntensity:.3,hoverTimeout:0,tooltip:!0,mousePreset:"default"};class fH{constructor(e,t={}){this.signals={parametersChanged:new rn.Signal,fullscreenChanged:new rn.Signal,componentAdded:new rn.Signal,componentRemoved:new rn.Signal,clicked:new rn.Signal,hovered:new rn.Signal},this.tasks=new SV,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new Oce(e),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new Bce(this.viewer.renderer.domElement),this.viewerControls=new $ce(this),this.trackballControls=new zce(this),this.pickingControls=new Vce(this),this.animationControls=new Yce(this),this.mouseControls=new $ue(this),this.keyControls=new jue(this),this.pickingBehavior=new Xue(this),this.mouseBehavior=new que(this),this.animationBehavior=new Yue(this),this.keyBehavior=new Kue(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=Io(t,dde),this.setParameters(this.parameters),this.viewer.animate())}setParameters(e={}){dV(this.parameters,e);const t=e,n=this.parameters,r=this.viewer,s=this.trackballControls;return t.quality!==void 0&&this.setQuality(n.quality),t.impostor!==void 0&&this.setImpostor(n.impostor),t.rotateSpeed!==void 0&&(s.rotateSpeed=n.rotateSpeed),t.zoomSpeed!==void 0&&(s.zoomSpeed=n.zoomSpeed),t.panSpeed!==void 0&&(s.panSpeed=n.panSpeed),t.mousePreset!==void 0&&this.mouseControls.preset(n.mousePreset),this.mouseObserver.setParameters({hoverTimeout:n.hoverTimeout}),r.setClip(n.clipNear,n.clipFar,n.clipDist,n.clipMode,n.clipScale),r.setFog(void 0,n.fogNear,n.fogFar),r.setCamera(n.cameraType,n.cameraFov,n.cameraEyeSep),r.setSampling(n.sampleLevel),r.setBackground(n.backgroundColor),r.setLight(n.lightColor,n.lightIntensity,n.ambientColor,n.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this}log(e){console.log("STAGE LOG",e),this.logList.push(e)}getParameters(){return Object.assign({},this.parameters)}defaultFileRepresentation(e){if(e instanceof zC){let t,n,r;e.setSelection("/0");const s=e.structure;if(s.biomolDict.BU1){const h=s.biomolDict.BU1;t=h.getAtomCount(s),n=h.getResidueCount(s),r=h.getInstanceCount(),e.setDefaultAssembly("BU1")}else t=s.getModelProxy(0).atomCount,n=s.getModelProxy(0).residueCount,r=1;let o=t;yV&&(o*=4);const a=s.atomStore.count/s.residueStore.count<2;a&&(o*=10);let l="chainname",c="RdYlBu",u=!1;if(s.getChainnameCount(new ii("polymer and /0"))===1&&(l="residueindex",c="Spectral",u=!0),pt&&console.log(o,t,r,a),n/r<4)e.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(r>5&&o>15e3||o>7e5){let h=Math.min(2,Math.max(.1,6e3/(o/r)));a&&(h=Math.min(h,.5)),e.addRepresentation("surface",{colorScheme:l,colorScale:c,colorReverse:u,sele:"polymer",surfaceType:"av",probeRadius:1.4,scaleFactor:h,useWorker:!1})}else o>25e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,lineOnly:!0}):o>1e5?e.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,quality:"low",disableImpostor:!0,radiusScale:2}):o>8e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,radiusScale:2}):(e.addRepresentation("cartoon",{colorScheme:l,colorScale:c,colorReverse:u,radiusScale:.7,aspectRatio:5,quality:"auto"}),o<5e4&&e.addRepresentation("base",{colorScheme:l,colorScale:c,colorReverse:u,quality:"auto"}),e.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));e.structure.frames.length&&e.addTrajectory()}else(e instanceof hH||e instanceof dH)&&e.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)}loadFile(e,t={}){const n=Object.assign({},this.defaultFileParams,t),r=io(e).name;this.tasks.increment(),this.log(`loading file '${r}'`);const s=he(n.ext,io(e).ext);let o;return o=Qt.isTrajectory(s)?Promise.reject(new Error(`loadFile: ext '${s}' is a trajectory and must be loaded into a structure component`)):RU(e,n),o.then(a=>{this.log(`loaded '${r}'`);const l=this.addComponentFromObject(a,n);return n.defaultRepresentation&&this.defaultFileRepresentation(l),this.tasks.decrement(),l},a=>{this.tasks.decrement();const l=`error loading file: '${a}'`;throw this.log(l),l})}loadScript(e){const t=io(e).name;return this.log(`loading script '${t}'`),RU(e).then(n=>{this.tasks.increment(),this.log(`running script '${t}'`),n.run(this).then(()=>{this.tasks.decrement(),this.log(`finished script '${t}'`)}),this.log(`called script '${t}'`)},n=>{this.tasks.decrement();const r=`errored script '${t}' "${n}"`;throw this.log(r),r})}addComponent(e){e?(this.compList.push(e),this.signals.componentAdded.dispatch(e)):tt.warn("Stage.addComponent: no component given")}addComponentFromObject(e,t={}){const n=vm.get(e.type);if(n){const r=new n(this,e,t);return this.addComponent(r),r}tt.warn("no component for object type",e.type)}removeComponent(e){const t=this.compList.indexOf(e);t!==-1&&(this.compList.splice(t,1),e.dispose(),this.signals.componentRemoved.dispatch(e))}removeAllComponents(){this.compList.slice().forEach(e=>this.removeComponent(e))}handleResize(){this.viewer.handleResize()}setSize(e,t){const n=this.viewer.container;n!==document.body&&(e!==void 0&&(n.style.width=e),t!==void 0&&(n.style.height=t),this.handleResize())}toggleFullscreen(e){if(!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled))return void tt.log("fullscreen mode (currently) not possible");const t=this;function n(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function r(){if(!n()&&t.lastFullscreenElement){const s=t.lastFullscreenElement;s.style.width=s.dataset.normalWidth||"",s.style.height=s.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",r),document.removeEventListener("mozfullscreenchange",r),document.removeEventListener("webkitfullscreenchange",r),document.removeEventListener("MSFullscreenChange",r),t.handleResize(),t.signals.fullscreenChanged.dispatch(!1)}}e=e||this.viewer.container,this.lastFullscreenElement=e,n()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e.dataset.normalWidth=e.style.width||"",e.dataset.normalHeight=e.style.height||"",e.style.width=window.screen.width+"px",e.style.height=window.screen.height+"px",e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",r),document.addEventListener("mozfullscreenchange",r),document.addEventListener("webkitfullscreenchange",r),document.addEventListener("MSFullscreenChange",r),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout(function(){t.handleResize()},100))}setSpin(e){e?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)}setRock(e){e?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)}toggleSpin(){this.setSpin(this.spinAnimation.paused)}toggleRock(){this.setRock(this.rockAnimation.paused)}getFocus(){const e=this.parameters;if(e.clipMode!=="scene")return 0;let t=e.clipNear;return e.clipScale==="absolute"&&(t=this.viewer.absoluteToRelative(t)),2*t}setFocus(e){if(this.parameters.clipMode!=="scene")return;let t,n,r,s;this.parameters.clipScale==="relative"?(t=CC(e/2,0,49.9),n=100-t,r=50,s=function(o){return CC(o,0,100)}(2*n-50)):(t=this.viewer.relativeToAbsolute(e/2),n=t,r=0,s=2*n),this.setParameters({clipNear:t,clipFar:n,fogNear:r,fogFar:s})}getZoomForBox(e){const t=e.getSize(hde),n=Math.max(t.x,t.y,t.z),r=Math.min(t.x,t.y,t.z);let s=n+Math.sqrt(r);const o=Pi(this.viewer.perspectiveCamera.fov),a=this.viewer.width,l=this.viewer.height,c=l<a?1:a/l;return s=Math.abs(.5*s/c/Math.sin(o/2)),s+=this.parameters.clipDist,-s}getBox(){return this.viewer.boundingBox}getZoom(){return this.getZoomForBox(this.getBox())}getCenter(e){return this.getBox().getCenter(e||new me)}autoView(e){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),he(e,0))}makeImage(e={}){return new Promise((t,n)=>{this.tasks.onZeroOnce(()=>{this.tasks.increment(),this.viewer.makeImage(e).then(r=>{this.tasks.decrement(),t(r)}).catch(r=>{this.tasks.decrement(),n(r)})})})}setImpostor(e){this.parameters.impostor=e;const t=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(n){if(!t.includes(n.getType()))return;const r=n.getParameters();r.disableImpostor=!e,n.build(r)})}setQuality(e){this.parameters.quality=e;const t=["tube","cartoon","ribbon","trace","rope"],n=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(r){const s=r.getParameters();if(!t.includes(r.getType())){if(!n.includes(r.getType()))return;if(!s.disableImpostor)return void(r.repr.quality=e)}s.quality=e,r.build(s)})}eachComponent(e,t){this.compList.slice().forEach(n=>{t!==void 0&&t!==n.type||e(n)})}eachRepresentation(e,t){this.eachComponent(n=>{n.reprList.slice().forEach(r=>{t!==void 0&&t!==r.getType()||e(r,n)})})}getComponentsByName(e){const t=[];return this.eachComponent(n=>{(e===void 0||x4(e,n))&&t.push(n)}),new y4(t)}getComponentsByObject(e){const t=[];return this.eachComponent(n=>{n.object===e&&t.push(n)}),new y4(t)}getRepresentationsByName(e){const t=[];return this.eachRepresentation((n,r)=>{(e===void 0||x4(e,n))&&t.push(n)}),new aH(t)}measureClear(){this.eachComponent(e=>e.measureClear(),"structure")}measureUpdate(){this.eachComponent(e=>e.measureUpdate(),"structure")}dispose(){this.tasks.dispose(),this.viewer.dispose(),this.mouseObserver.dispose()}}class fde extends s2{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.shape=t}get type(){return"shape"}addRepresentation(e,t={}){return this._addRepresentation(e,this.shape,t)}getBoxUntransformed(){return this.shape.boundingBox}getCenterUntransformed(){return this.shape.center}dispose(){this.shape.dispose(),super.dispose()}}function zn(i,e,t,n){var r,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(r=i[a])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}function pH(i,e,t,n){return new(t||(t=Promise))(function(r,s){function o(c){try{l(n.next(c))}catch(u){s(u)}}function a(c){try{l(n.throw(c))}catch(u){s(u)}}function l(c){c.done?r(c.value):function(u){return u instanceof t?u:new t(function(h){h(u)})}(c.value).then(o,a)}l((n=n.apply(i,[])).next())})}vm.add("shape",fde),typeof SuppressedError=="function"&&SuppressedError;class b4 extends Xn{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=he(e.reverse,!0)),this.scalePerModel={},e.structure.eachModel(t=>{this.parameters.domain=[t.atomOffset,t.atomEnd],this.scalePerModel[t.index]=this.getScale()})}atomColor(e){return this.scalePerModel[e.modelIndex](e.index)}}zn([Bn],b4.prototype,"atomColor",null),_n.add("atomindex",b4);class S4 extends Xn{constructor(e){if(super(e),e.scale||(this.parameters.scale="OrRd"),!e.domain){let t,n=1/0,r=-1/0;e.sele&&(t=new ii(e.sele)),e.structure.eachAtom(function(s){const o=s.bfactor;n=Math.min(n,o),r=Math.max(r,o)},t),this.parameters.domain=[n,r]}this.bfactorScale=this.getScale()}atomColor(e){return this.bfactorScale(e.bfactor)}}zn([Bn],S4.prototype,"atomColor",null),_n.add("bfactor",S4);class w4 extends Xn{constructor(e){super(e),this.chainidDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel(t=>{let n=0;const r={};t.eachChain(function(s){r[s.chainid]===void 0&&(r[s.chainid]=n,n+=1)}),this.parameters.domain=[0,n-1],this.chainidDictPerModel[t.index]=r,this.scalePerModel[t.index]=this.getScale()})}atomColor(e){const t=this.chainidDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainid])}}zn([Bn],w4.prototype,"atomColor",null),_n.add("chainid",w4);class M4 extends Xn{constructor(e){super(e),this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel(t=>{this.parameters.domain=[t.chainOffset,t.chainEnd],this.scalePerModel[t.index]=this.getScale()})}atomColor(e){return this.scalePerModel[e.modelIndex](e.chainIndex)}}zn([Bn],M4.prototype,"atomColor",null),_n.add("chainindex",M4);class A4 extends Xn{constructor(e){super(e),this.chainnameDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel(t=>{let n=0;const r={};t.eachChain(function(s){r[s.chainname]===void 0&&(r[s.chainname]=n,n+=1)}),this.parameters.domain=[0,n-1],this.chainnameDictPerModel[t.index]=r,this.scalePerModel[t.index]=this.getScale()})}atomColor(e){const t=this.chainnameDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainname])}}zn([Bn],A4.prototype,"atomColor",null),_n.add("chainname",A4);class E4 extends Xn{constructor(e){super(e),this.rsrzDict={},this.rsccDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});const t=e.structure.validation;t&&(this.rsrzDict=t.rsrzDict,this.rsccDict=t.rsccDict)}atomColor(e){let t=e.resno+"";e.inscode&&(t+="^"+e.inscode),e.chainname&&(t+=":"+e.chainname),t+="/"+e.modelIndex;const n=this.rsrzDict[t];if(n!==void 0)return this.rsrzScale(n);const r=this.rsccDict[t];return r!==void 0?this.rsccScale(r):9474192}}zn([Bn],E4.prototype,"atomColor",null),_n.add("densityfit",E4);const EA={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}};class T4 extends Xn{constructor(e){super(e),this.delta=new me,this.hCharges=[],e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(e.structure.atomCount);const t=[];e.structure.eachAtom(r=>{var s;if(this.charges[r.index]=((s=r).partialCharge!==null?s.partialCharge:s.isProtein()&&(EA[s.resname]&&EA[s.resname][s.atomname]||EA.backbone[s.atomname])||0)*r.occupancy,r.atomname==="N"){if(r.bondCount>=3||r.bondToElementCount(1))return;const o=function(a,l=new me){let c=!1,u=!1,h=!1;return l.set(2*a.x,2*a.y,2*a.z),a.eachBondedAtom(function(d){if(!c)return d.atomname==="H"?(l.set(d.x,d.y,d.z),void(c=!0)):void(u||d.atomname!=="CA"?h||d.atomname!=="C"||(h=!0,l.sub(d)):(l.sub(d),u=!0))}),c?l:u&&h?(l.normalize(),l.multiplyScalar(1.04),l.add(a),l):void 0}(r);o!==void 0&&(t.push(o),this.hCharges.push(.25*r.occupancy))}});const n=e.structure.getBoundingBox();n.expandByScalar(1.04),this.hStore=function(r){const s=r.length,o=new Float32Array(s),a=new Float32Array(s),l=new Float32Array(s);for(let c=0;c<r.length;c++){const u=r[c];o[c]=u.x,a[c]=u.y,l[c]=u.z}return{x:o,y:a,z:l,count:s}}(t),this.hHash=new b1(this.hStore,n),this.hash=new b1(e.structure.atomStore,n)}positionColor(e){const t=this.charges,n=this.hCharges;let r=0;return this.hash.eachWithin(e.x,e.y,e.z,12,(s,o)=>{const a=t[s];a!==0&&(r+=a/o)}),this.hHash.eachWithin(e.x,e.y,e.z,12,(s,o)=>{const a=n[s];a!==0&&(r+=a/o)}),this.scale(332*r)}}zn([Bn],T4.prototype,"positionColor",null),_n.add("electrostatic",T4);const C4={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120};class P4 extends Xn{constructor(e){e.value=he(e.value,C4.C),super(e)}atomColor(e){const t=e.element;return t==="C"?this.parameters.value:C4[t]||16777215}}zn([Bn],P4.prototype,"atomColor",null),_n.add("element",P4);class R4 extends Xn{constructor(e){super(e),e.scale||(this.parameters.scale="Spectral"),e.domain||(this.parameters.domain=[0,e.structure.entityList.length-1]),this.entityindexScale=this.getScale()}atomColor(e){return this.entityindexScale(e.entityIndex)}}zn([Bn],R4.prototype,"atomColor",null),_n.add("entityindex",R4);class I4 extends Xn{atomColor(e){const t=e.entity;switch(t?t.entityType:void 0){case 1:return 8374655;case 2:return 16629894;case 3:return 12496596;case 4:return 3697840;default:return 16777113}}}zn([Bn],I4.prototype,"atomColor",null),_n.add("entitytype",I4);class L4 extends Xn{constructor(e){super(e),this.geoAtomDict={},this.geoDict={};const t=e.structure.validation;t&&(this.geoAtomDict=t.geoAtomDict,this.geoDict=t.geoDict)}atomColor(e){let t,n=e.resno+"";e.inscode&&(n+="^"+e.inscode),e.chainname&&(n+=":"+e.chainname),n+="/"+e.modelIndex;const r=this.geoAtomDict[n];r!==void 0?(s=r[e.atomname]||0,t=16843009*((s=(858993459&(s-=s>>1&1431655765))+(s>>2&858993459))+(s>>4)&252645135)>>24):t=this.geoDict[n]||0;var s;return t===0?2188972:t===1?16703627:t===2?16018755:t>=3?10813478:9474192}}zn([Bn],L4.prototype,"atomColor",null),_n.add("geoquality",L4);class D4 extends Xn{constructor(e){super(e),this.resHF={},e.scale||(this.parameters.scale="RdYlGn");for(const t in QU)this.resHF[t]=QU[t][0];if(this.defaultResidueHydrophobicity=aue[0],!e.domain){let t=1/0,n=-1/0;for(const r in this.resHF){const s=this.resHF[r];t=Math.min(t,s),n=Math.max(n,s)}this.parameters.domain=[t,0,n]}this.hfScale=this.getScale()}atomColor(e){return this.hfScale(this.resHF[e.resname]||this.defaultResidueHydrophobicity)}}zn([Bn],D4.prototype,"atomColor",null),_n.add("hydrophobicity",D4);class N4 extends Xn{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow"),e.domain||(this.parameters.domain=[0,e.structure.modelStore.count]),this.modelindexScale=this.getScale()}atomColor(e){return this.modelindexScale(e.modelIndex)}}zn([Bn],N4.prototype,"atomColor",null),_n.add("modelindex",N4);class F4 extends Xn{atomColor(e){switch(e.residueType.moleculeType){case 1:return 3697840;case 2:return 15729279;case 3:return 12496596;case 4:return 16629894;case 5:return 12540695;case 6:return 8374655;default:return 16777113}}}zn([Bn],F4.prototype,"atomColor",null),_n.add("moleculetype",F4);class k4 extends Xn{constructor(e){super(e),e.scale||(this.parameters.scale="PuBu"),e.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}atomColor(e){return this.occupancyScale(e.occupancy)}}zn([Bn],k4.prototype,"atomColor",null),_n.add("occupancy",k4);class U4 extends Xn{constructor(e){super(e),e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}atomColor(e){return this.partialchargeScale(e.partialCharge||0)}}function TA(){return 16777215*Math.random()}zn([Bn],U4.prototype,"atomColor",null),_n.add("partialcharge",U4);class Gy extends Xn{atomColor(){return TA()}volumeColor(){return TA()}positionColor(){return TA()}}zn([Bn],Gy.prototype,"atomColor",null),zn([Bn],Gy.prototype,"volumeColor",null),zn([Bn],Gy.prototype,"positionColor",null),_n.add("random",Gy);class O4 extends Xn{constructor(e){super(e),this.rciDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});const t=e.structure.validation;t&&(this.rciDict=t.rciDict)}atomColor(e){let t=`[${e.resname}]${e.resno}`;e.chainname&&(t+=":"+e.chainname);const n=this.rciDict[t];return n!==void 0?this.rciScale(n):9474192}}zn([Bn],O4.prototype,"atomColor",null),_n.add("randomcoilindex",O4);class B4 extends Xn{constructor(e){super(e),this.scalePerChain={},e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=he(e.reverse,!0)),e.structure.eachChain(t=>{this.parameters.domain=[t.residueOffset,t.residueEnd],this.scalePerChain[t.index]=this.getScale()})}atomColor(e){return this.scalePerChain[e.chainIndex](e.residueIndex)}}zn([Bn],B4.prototype,"atomColor",null),_n.add("residueindex",B4);const pde={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723};class z4 extends Xn{atomColor(e){return pde[e.resname]||16711935}}zn([Bn],z4.prototype,"atomColor",null),_n.add("resname",z4);const mde=16711808,gde=10485888,vde=6291584,_de=16762880,yde=6324479,xde=16777215,bde=11403518,Sde=16580962,wde=10921722;class G4 extends Xn{constructor(e){super(e),this.residueProxy=e.structure.getResidueProxy()}atomColor(e){const t=e.sstruc,n=this.residueProxy;return t==="h"?mde:t==="g"?gde:t==="i"?vde:t==="e"||t==="b"?_de:t==="t"?yde:(n.index=e.residueIndex,n.isDna()?bde:n.isRna()?Sde:n.isSaccharide()?wde:n.isProtein()||t==="s"||t==="l"?xde:8421504)}}zn([Bn],G4.prototype,"atomColor",null),_n.add("sstruc",G4);class CA extends Xn{constructor(e){var t,n;super(e),e.scale||(this.parameters.scale="rwb"),this.atomData=(t=this.parameters.data)===null||t===void 0?void 0:t.atomData,this.bondData=(n=this.parameters.data)===null||n===void 0?void 0:n.bondData,this.scale=this.getScale(this.parameters)}atomColor(e){var t;const n=(t=this.atomData)===null||t===void 0?void 0:t[e.index];return n!==void 0?this.scale(n):this.parameters.value}bondColor(e,t){var n;const r=(n=this.bondData)===null||n===void 0?void 0:n[e.index];return r!==void 0?this.scale(r):this.atomProxy?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value}}zn([Bn],CA.prototype,"atomColor",null),zn([Bn],CA.prototype,"bondColor",null),_n.add("structuredata",CA);class Gg extends Xn{atomColor(){return this.parameters.value}bondColor(){return this.parameters.value}valueColor(){return this.parameters.value}volumeColor(){return this.parameters.value}}zn([Bn],Gg.prototype,"atomColor",null),zn([Bn],Gg.prototype,"bondColor",null),zn([Bn],Gg.prototype,"valueColor",null),zn([Bn],Gg.prototype,"volumeColor",null),_n.add("uniform",Gg);class V4 extends Xn{constructor(e){super(e),this.valueScale=this.getScale()}volumeColor(e){return this.valueScale(this.parameters.volume.data[e])}}zn([Bn],V4.prototype,"volumeColor",null),_n.add("value",V4);class H4 extends Xn{constructor(e){super(e),this.vec=new me,this.valueScale=this.getScale()}positionColor(e){const t=this.parameters.volume;if(!t||!t.inverseMatrix)return this.parameters.value;const n=this.vec,r=t.data,s=t.nx,o=t.ny,a=s*o;n.copy(e),n.applyMatrix4(t.inverseMatrix);const l=Math.floor(n.x),c=Math.floor(n.y),u=Math.floor(n.z),h=(u*o+c)*s+l,d=h+1,f=h+s,p=h+a,_=f+1,v=p+1,g=f+a,b=g+1,m=r[h],y=r[d],A=r[f],w=r[p],M=r[_],T=r[v],E=r[g],C=r[b],N=n.x-l,P=n.y-c,L=n.z-u,R=Zo(m,y,N),F=Zo(w,T,N),V=Zo(A,M,N),G=Zo(E,C,N),U=Zo(R,V,P),z=Zo(F,G,P),O=Zo(U,z,L);return this.valueScale(O)}}zn([Bn],H4.prototype,"positionColor",null),_n.add("volume",H4);class qr extends K1{constructor(e,t,n){const r=n||{};if(super(e,t,r),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:Ac.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new ii(r.sele),this.dataList=[],this.structure=e,this.structureView=this.structure.getView(this.selection),e.biomolDict){const s={default:"default","":e.unitcell?"AU":"FULL"};Object.keys(e.biomolDict).forEach(function(o){s[o]=o}),this.parameters.assembly={type:"select",options:s,rebuild:!0}}else this.parameters.assembly=null}get defaultScale(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}}init(e){const t=e||{};t.colorScheme=he(t.colorScheme,"element"),this.setRadius(t.radius,t),this.radiusType=he(t.radiusType,"vdw"),this.radiusData=he(t.radiusData,{}),this.radiusSize=he(t.radiusSize,1),this.radiusScale=he(t.radiusScale,1),this.assembly=he(t.assembly,"default"),this.defaultAssembly=he(t.defaultAssembly,""),t.quality==="auto"&&(t.quality=this.getQuality()),super.init(t),this.selection.signals.stringChanged.add(()=>{this.build()}),this.build()}setRadius(e,t){const n=Object.keys(ZV);return typeof e=="string"&&n.includes(e.toLowerCase())?t.radiusType=e:e!==void 0&&(t.radiusType="size",t.radiusSize=e),this}getAssembly(){const e=this.assembly==="default"?this.defaultAssembly:this.assembly;return this.structure.biomolDict[e]}getQuality(){let e;const t=this.structureView,n=this.getAssembly();return e=n?n.getAtomCount(t):t.atomCount,yV&&(e*=4),t.atomStore.count/t.residueStore.count<2&&(e*=10),e<15e3?"high":e<8e4?"medium":"low"}create(){if(this.structureView.atomCount===0)return;if(!this.structureView.hasCoords())return void(this.needsBuild=!0);this.needsBuild=!1;const e=this.getAssembly();if(e)e.partList.forEach((t,n)=>{const r=t.getView(this.structureView);if(r.atomCount===0)return;const s=this.createData(r,n);s&&(s.sview=r,s.instanceList=t.getInstanceList(),this.dataList.push(s))});else{const t=this.createData(this.structureView,0);t&&(t.sview=this.structureView,this.dataList.push(t))}}update(e){!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach(t=>{t.bufferList.length>0&&this.updateData(e,t)},this):Object.assign(this.lazyProps.what,e)}updateData(e,t){this.build()}getColorParams(){return Object.assign(Object.assign({},super.getColorParams()),{structure:this.structure})}getRadiusParams(e){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}}getAtomParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getBondParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getAtomRadius(e){return this.structureView.atomSet.isSet(e.index)?new Ac(this.getRadiusParams()).atomRadius(e):0}setSelection(e,t){return this.selection.setString(e,t),this}setParameters(e,t={},n=!1){const r=e||{};return this.setRadius(r.radius,r),r.radiusType===void 0&&r.radiusData===void 0&&r.radiusSize===void 0&&r.radiusScale===void 0||(t.radius=!0,_l&&!this.disableImpostor||(n=!0)),r.defaultAssembly!==void 0&&r.defaultAssembly!==this.defaultAssembly&&(this.assembly==="default"&&r.assembly===void 0||r.assembly==="default")&&(n=!0),super.setParameters(r,t,n),this}getParameters(){return Object.assign(super.getParameters(),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})}attach(e){const t=this.viewer,n=this.bufferList;this.dataList.forEach(function(r){r.bufferList.forEach(function(s){n.push(s),t.add(s,r.instanceList)})}),this.setVisibility(this.visible),e()}clear(){this.dataList.length=0,super.clear()}dispose(){this.structureView.dispose(),super.dispose()}}class L3 extends qr{constructor(e,t,n){super(e,t,n),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}init(e){const t=e||{};this.labelVisible=he(t.labelVisible,!0),this.labelSize=he(t.labelSize,2),this.labelColor=he(t.labelColor,16777215),this.labelFontFamily=he(t.labelFontFamily,"sans-serif"),this.labelFontStyle=he(t.labelFontstyle,"normal"),this.labelFontWeight=he(t.labelFontWeight,"bold"),this.labelsdf=he(t.labelsdf,vV==="Chrome"),this.labelXOffset=he(t.labelXOffset,0),this.labelYOffset=he(t.labelYOffset,0),this.labelZOffset=he(t.labelZOffset,.5),this.labelAttachment=he(t.labelAttachment,"bottom-left"),this.labelBorder=he(t.labelBorder,!1),this.labelBorderColor=he(t.labelBorderColor,"lightgrey"),this.labelBorderWidth=he(t.labelBorderWidth,.15),this.labelBackground=he(t.labelBackground,!1),this.labelBackgroundColor=he(t.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=he(t.labelBackgroundMargin,.5),this.labelBackgroundOpacity=he(t.labelBackgroundOpacity,1),this.labelFixedSize=he(t.labelFixedSize,!1),this.lineOpacity=he(t.lineOpacity,1),this.linewidth=he(t.linewidth,2),super.init(t)}update(e){e.position?this.build():super.update(e)}updateData(e,t){const n={};if(e&&!e.labelSize||Object.assign(n,{size:Lo(this.n,this.labelSize)}),!e||e.labelColor){const r=new $t(this.labelColor);Object.assign(n,{color:Hn(this.n,r.r,r.g,r.b)})}this.textBuffer.setAttributes(n)}setParameters(e,t={},n=!1){return e&&e.labelSize&&(t.labelSize=!0),e&&(e.labelColor||e.labelColor===0)&&(t.labelColor=!0,n=!0),super.setParameters(e,t,n),e&&e.opacity!==void 0&&this.textBuffer.setParameters({opacity:1}),e&&e.labelVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),t||this.viewer.requestRender(),this}getLabelBufferParams(e={}){return super.getBufferParams(Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},e,{opacity:1}))}getAtomRadius(){return 0}}function D3(i,e){const t=i.getAtomProxy(),n=new ii,r=e.length;if(r===0)return new Float32Array(0);const s=e[0].length,o=i.getAtomSet(),a=new Float32Array(r*s*3);let l=0;return e.forEach(function(c){let u=!1;for(let h=0;h<s;h++){const d=c[h];if(typeof d=="number"&&Number.isInteger(d)){if(!o.get(d)){u=!0;break}t.index=d}else{n.setString(d);const p=i.getAtomIndices(n);if(!p.length){u=!0;break}t.index=p[0]}let f=l+3*h;a[f++]=t.x,a[f++]=t.y,a[f++]=t.z}u||(l+=3*s)}),a.subarray(0,l)}function Aa(i,e,t,n,r){const s=Math.cos(r),o=Math.sin(r);i[0]=e[0]+t[0]*s+n[0]*o,i[1]=e[1]+t[1]*s+n[1]*o,i[2]=e[2]+t[2]*s+n[2]*o}function $4(i,e,t,n,r,s,o){for(let a=0;a<e;a++){for(let l=0;l<t;l++)n[l]=i[l*e+a];W4(n,r,s,o,t);for(let l=0;l<t;l++)i[l*e+a]=r[l]}for(let a=0;a<t;a++){for(let l=0;l<e;l++)n[l]=i[a*e+l];W4(n,r,s,o,e);for(let l=0;l<e;l++)i[a*e+l]=Math.sqrt(r[l])}}function W4(i,e,t,n,r){t[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(let s=1,o=0;s<r;s++){let a=(i[s]+s*s-(i[t[o]]+t[o]*t[o]))/(2*s-2*t[o]);for(;a<=n[o];)o--,a=(i[s]+s*s-(i[t[o]]+t[o]*t[o]))/(2*s-2*t[o]);o++,t[o]=s,n[o]=a,n[o+1]=Number.MAX_SAFE_INTEGER}for(let s=0,o=0;s<r;s++){for(;n[o+1]<s;)o++;e[s]=(s-t[o])*(s-t[o])+i[t[o]]}}Rn.add("shader/SDFFont.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float xOffset;
uniform float yOffset;
uniform float zOffset;
uniform bool ortho;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
attribute vec2 mapping;
attribute vec2 inputTexCoord;
attribute float inputSize;
#include matrix_scale
#include common
void main(void){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
texCoord = inputTexCoord;
float scale = matrixScale( modelViewMatrix );
float _xOffset = xOffset * scale;
float _yOffset = yOffset * scale;
float _zOffset = zOffset * scale;
if( texCoord.x == 10.0 ){
_zOffset -= 0.001;
}
vec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );
#ifdef FIXED_SIZE
if ( ortho ) {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;
} else {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;
}
#endif
vec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );
cameraCornerPos.xy += mapping * inputSize * 0.01 * scale;
cameraCornerPos.x += _xOffset;
cameraCornerPos.y += _yOffset;
if( ortho ){
cameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;
} else {
cameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;
}
gl_Position = projectionMatrix * cameraCornerPos;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -cameraCornerPos.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),Rn.add("shader/SDFFont.frag",`uniform sampler2D fontTexture;
uniform float opacity;
uniform bool showBorder;
uniform vec3 borderColor;
uniform float borderWidth;
uniform vec3 backgroundColor;
uniform float backgroundOpacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
const vec3 vColor = vec3( 0.0 );
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#endif
const float gamma = 2.2 * 1.4142 / 128.0;
const float padding = 0.75;
void main(){
#include nearclip_fragment
#include radiusclip_fragment
if( texCoord.x > 1.0 ){
gl_FragColor = vec4( backgroundColor, backgroundOpacity );
}else{
float sdf = texture2D( fontTexture, texCoord ).a;
if( showBorder ) sdf += borderWidth;
float a = smoothstep(padding - gamma, padding + gamma, sdf);
if( a < 0.2 ) discard;
a *= opacity;
vec3 outgoingLight = vColor;
if( showBorder && sdf < ( padding + borderWidth ) ){
outgoingLight = borderColor;
}
gl_FragColor = vec4( outgoingLight, a );
}
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const PA={},Mde={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024};class Ade{constructor(e={}){this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=Io(e,Mde);const t=this.parameters;this.radius=t.size/8,this.padding=t.size/3;const n=this.lineHeight=t.size+2*t.outline+Math.round(t.size/4),r=this.maxWidth=t.width/4,s=this.canvas=document.createElement("canvas");s.width=r,s.height=n;const o=this.context=this.canvas.getContext("2d",{willReadFrequently:!0});o.font=`${t.style} ${t.variant} ${t.weight} ${t.size}px ${t.font}`,o.fillStyle="black",o.textAlign="left",o.textBaseline="bottom",o.lineJoin="round",this.gridOuter=new Float64Array(n*r),this.gridInner=new Float64Array(n*r),this.f=new Float64Array(Math.max(n,r)),this.d=new Float64Array(Math.max(n,r)),this.z=new Float64Array(Math.max(n,r)+1),this.v=new Int16Array(Math.max(n,r)),this.data=new Uint8Array(t.width*t.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=t.width,this.canvas2.height=t.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map("");for(let a=32;a<=126;++a)this.map(String.fromCharCode(a));this.map(""),this.map(""),this.texture=new Ble(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0}map(e){const t=this.parameters;return this.mapped[e]===void 0&&(this.draw(e),this.currentX+this.scratchW>t.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>t.height&&console.warn("canvas to small"),this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[e]}get(e){return this.mapped[e]||this.placeholder}draw(e){const t=this.parameters,n=this.lineHeight,r=t.outline,s=this.context,o=this.maxWidth,a=r,l=n-t.outline,c=s.measureText(e),u=Math.min(o,Math.ceil(c.width+2*a+1)),h=u*n;s.clearRect(0,0,u,n),s.fillText(e,a,l);const d=s.getImageData(0,0,u,n),f=d.data;for(let p=0;p<h;p++){const _=d.data[4*p+3]/255;this.gridOuter[p]=_===1?0:_===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-_),2),this.gridInner[p]=_===1?Number.MAX_SAFE_INTEGER:_===0?0:Math.pow(Math.max(0,_-.5),2)}$4(this.gridOuter,u,n,this.f,this.d,this.v,this.z),$4(this.gridInner,u,n,this.f,this.d,this.v,this.z);for(let p=0;p<h;p++){const _=this.gridOuter[p]-this.gridInner[p];f[4*p+3]=Math.max(0,Math.min(255,Math.round(255-255*(_/this.radius+this.cutoff))))}s.putImageData(d,0,0),this.scratchW=u,this.scratchH=n}}const Ede=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},Os),Tde=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},$d);function j4(i,e){const t=i.position.length/3;let n=0;for(let r=0;r<t;++r)n+=i.text[r].length;return e.showBackground&&(n+=t),n}class zm extends P3{constructor(e,t={}){super({position:new Float32Array(3*j4(e,t)),color:new Float32Array(3*j4(e,t)),picking:new kue},t),this.parameterTypes=Tde,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=e.text,this.positionCount=e.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new $t(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new $t(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(e),this.makeTexture(),this.makeMapping()}get defaultParameters(){return Ede}makeMaterial(){super.makeMaterial();const e=this.texture,t=this.material;t.transparent=!0,t.extensions.derivatives=!0,t.lights=!1,t.uniforms.fontTexture.value=e,t.needsUpdate=!0;const n=this.wireframeMaterial;n.transparent=!0,n.extensions.derivatives=!0,n.lights=!1,n.uniforms.fontTexture.value=e,n.needsUpdate=!0;const r=this.pickingMaterial;r.extensions.derivatives=!0,r.lights=!1,r.uniforms.fontTexture.value=e,r.needsUpdate=!0}setAttributes(e={}){let t,n,r,s,o,a;const l=this.text,c=this.geometry.attributes;e.position&&(t=e.position,s=c.position.array,c.position.needsUpdate=!0),e.size&&(n=e.size,o=c.inputSize.array,c.inputSize.needsUpdate=!0),e.color&&(r=e.color,a=c.color.array,c.color.needsUpdate=!0);const u=this.positionCount;let h,d,f,p,_,v=0;for(let g=0;g<u;++g)for(d=3*g,f=l[g],_=f.length,this.parameters.showBackground&&(_+=1),p=0;p<_;++p,++v)for(let b=0;b<4;b++)h=4*v*3+3*b,t&&(s[h]=t[d],s[h+1]=t[d+1],s[h+2]=t[d+2]),n&&(o[4*v+b]=n[g]),r&&(a[h]=r[d],a[h+1]=r[d+1],a[h+2]=r[d+2])}makeTexture(){this.textAtlas=function(e){const t=JSON.stringify(e);return PA[t]===void 0&&(PA[t]=new Ade(e)),PA[t]}({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture}makeMapping(){const e=this.textAtlas,t=this.text,n=this.parameters.attachment,r=e.lineHeight*this.parameters.backgroundMargin*.1-10,s=this.geometry.attributes,o=s.inputTexCoord.array,a=s.mapping.array,l=this.positionCount;let c,u,h,d,f,p,_,v,g=0;for(let b=0;b<l;++b){for(h=t[b],d=0,p=h.length,f=0;f<p;++f)c=e.get(h[f]),d+=c.w-2*e.parameters.outline;for(v=n.startsWith("top")?e.lineHeight/1.25:n.startsWith("middle")?e.lineHeight/2.5:0,_=n.endsWith("right")?d:n.endsWith("center")?d/2:0,_+=e.parameters.outline,v+=e.parameters.outline,this.parameters.showBackground&&(u=2*g*4,a[u+0]=-e.lineHeight/6-_-r,a[u+1]=e.lineHeight-v+r,a[u+2]=-e.lineHeight/6-_-r,a[u+3]=0-v-r,a[u+4]=d+e.lineHeight/6-_+2*e.parameters.outline+r,a[u+5]=e.lineHeight-v+r,a[u+6]=d+e.lineHeight/6-_+2*e.parameters.outline+r,a[u+7]=0-v-r,o[u+0]=10,o[u+2]=10,o[u+4]=10,o[u+6]=10,g+=1),d=0,f=0;f<p;++f,++g){c=e.get(h[f]),u=2*g*4,a[u+0]=d-_,a[u+1]=c.h-v,a[u+2]=d-_,a[u+3]=0-v,a[u+4]=d+c.w-_,a[u+5]=c.h-v,a[u+6]=d+c.w-_,a[u+7]=0-v;const m=e.parameters.width,y=e.parameters.height,A=[c.x/m,c.y/y,c.x/m,(c.y+c.h)/y,(c.x+c.w)/m,c.y/y,(c.x+c.w)/m,(c.y+c.h)/y];o.set(A,u),d+=c.w-2*e.parameters.outline}}s.inputTexCoord.needsUpdate=!0,s.mapping.needsUpdate=!0}getDefines(e){const t=super.getDefines(e);return this.parameters.fixedSize&&(t.FIXED_SIZE=1),t}setUniforms(e){!e||e.fontFamily===void 0&&e.fontStyle===void 0&&e.fontWeight===void 0&&e.fontSize===void 0||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,e.fontTexture=this.texture),super.setUniforms(e)}}Fo.add("text",zm),Rn.add("shader/WideLine.vert",`
uniform float clipNear;
uniform vec3 clipCenter;
uniform float linewidth;
uniform vec2 resolution;
uniform mat4 projectionMatrixInverse;
attribute vec2 mapping;
attribute vec3 position1;
attribute vec3 position2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void trimSegment( const in vec4 start, inout vec4 end ) {
float a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;
float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );
end.xyz = mix( start.xyz, end.xyz, alpha );
}
void main() {
float aspect = resolution.x / resolution.y;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
flag = mapping.y;
vColor = color;
vColor2 = color2;
#endif
vec4 start = modelViewMatrix * vec4( position1, 1.0 );
vec4 end = modelViewMatrix * vec4( position2, 1.0 );
bool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {
if ( start.z < 0.0 && end.z >= 0.0 ) {
trimSegment( start, end );
} else if ( end.z < 0.0 && start.z >= 0.0 ) {
trimSegment( end, start );
}
}
vec4 clipStart = projectionMatrix * start;
vec4 clipEnd = projectionMatrix * end;
vec2 ndcStart = clipStart.xy / clipStart.w;
vec2 ndcEnd = clipEnd.xy / clipEnd.w;
vec2 dir = ndcEnd - ndcStart;
dir.x *= aspect;
dir = normalize( dir );
vec2 offset = vec2( dir.y, - dir.x );
dir.x /= aspect;
offset.x /= aspect;
if ( mapping.x < 0.0 ) offset *= - 1.0;
offset *= linewidth;
offset /= resolution.y;
vec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;
offset *= clip.w;
clip.xy += offset;
gl_Position = clip;
#ifndef PICKING
vViewPosition = ( projectionMatrixInverse * clip ).xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),Rn.add("shader/WideLine.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include fog_pars_fragment
varying vec3 vViewPosition;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
#endif
void main() {
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
if ( flag < 0.0 ) {
diffuseColor.rgb *= vColor;
} else {
diffuseColor.rgb *= vColor2;
}
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Cde=Object.assign({linewidth:2},Os),Pde=Object.assign({linewidth:{uniform:!0}},$d);class Ec extends P3{constructor(e,t={}){super(e,t),this.parameterTypes=Pde,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!e.color2&&e.color&&(e.color2=e.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new on},projectionMatrixInverse:{value:new Ct}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Cde}setParameters(e){super.setParameters(e)}}Fo.add("wideline",Ec);class Rde extends L3{constructor(e,t,n){super(e,t,n),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=he(t.side,"double"),t.opacity=he(t.opacity,.5),this.atomTriple=he(t.atomTriple,[]),this.arcVisible=he(t.arcVisible,!0),this.sectorVisible=he(t.sectorVisible,!0),this.vectorVisible=he(t.vectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomTriple.length)return;const t=function(a,l){return function(c){const u=[],h=c.length/9;for(let p=0;p<h;p++){let _=!0;for(let v=p;v<p+3;v+=3)c[v]===c[v+3]&&c[v+1]===c[v+4]&&c[v+2]===c[v+5]&&(_=!1);_&&u.push(p)}const d=new Float32Array(9*u.length);let f=0;return u.forEach(function(p){ar(c,d,9*p,9*f,9),f++}),d}(D3(a,l))}(e,this.atomTriple),n=function(a,l={}){const c=he(l.angleStep,Math.PI/90),u=a.length/9,h=new Float32Array(u),d=new Float32Array(3*u),f=new Array(u),p=new Float32Array(6*u),_=new Float32Array(6*u),v=new Array(u),g=new Array(u),b=new Array(u);let m=0;const y=nn(),A=nn(),w=nn(),M=nn(),T=nn(),E=nn(),C=nn(),N=nn(),P=nn();for(var L=0;L<u;L++){let D=9*L;Cs(y,a,D),Cs(A,a,D+3),Cs(w,a,D+6);let B=6*L;sn(y,p,B),sn(A,_,B),sn(A,p,B+3),sn(w,_,B+3),_i(M,y,A),_i(T,w,A),Ti(M,M),Ti(T,T),ro(E,M,T);const W=Du(E),q=Ws(M,T),j=h[L]=Math.atan2(W,q);f[L]=(MV*j).toFixed(1)+"",Du(E)===0&&(E[0]=1,E[1]=0,E[2]=0),ro(C,E,M),Ti(C,C),Aa(N,A,M,C,j/2),sn(N,d,3*L);const te=Math.ceil(j/c),ne=new Float32Array(9*te);b[L]=ne;const Z=new Float32Array(3*te),le=new Float32Array(3*te);v[L]=Z,g[L]=le,Ia(P,A,M);const re=function($,fe){const xe=9*fe,Ie=3*fe;sn(A,ne,xe),sn(P,ne,xe+3),sn(P,Z,Ie),Aa(P,A,M,C,$),sn(P,ne,xe+6),sn(P,le,Ie)};let se=0;for(let $=c;$<j;$+=c)re($,se),se++;re(j,se),m+=te}const R=3*m,F=9*m,V=new Float32Array(R),G=new Float32Array(R),U=new Float32Array(F);let z=0,O=0;for(let D=0;D<u;D++){const B=v[D],W=g[D];ar(B,V,0,O,B.length),ar(W,G,0,O,W.length),O+=B.length;const q=b[D];ar(q,U,0,z,q.length),z+=q.length}return{labelPosition:d,labelText:f,vectorPosition1:p,vectorPosition2:_,arcPosition1:V,arcPosition2:G,sectorPosition:U}}(t),r=this.n=n.labelPosition.length/3,s=new $t(this.labelColor);this.textBuffer=new zm({position:n.labelPosition,size:Lo(r,this.labelSize),color:Hn(r,s.r,s.g,s.b),text:n.labelText},this.getLabelBufferParams());const o=new $t(this.colorValue);return this.vectorBuffer=new Ec(DC({position1:n.vectorPosition1,position2:n.vectorPosition2,color:Hn(2*r,o.r,o.g,o.b),color2:Hn(2*r,o.r,o.g,o.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=n.arcPosition1.length/3,this.arcBuffer=new Ec(DC({position1:n.arcPosition1,position2:n.arcPosition2,color:Hn(this.arcLength,o.r,o.g,o.b),color2:Hn(this.arcLength,o.r,o.g,o.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=n.sectorPosition.length/3,this.sectorBuffer=new Mc({position:n.sectorPosition,color:Hn(this.sectorLength,o.r,o.g,o.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},r={},s={};if(e.color){const o=new $t(this.colorValue);Object.assign(n,{color:Hn(2*this.n,o.r,o.g,o.b),color2:Hn(2*this.n,o.r,o.g,o.b)}),Object.assign(r,{color:Hn(this.arcLength,o.r,o.g,o.b),color2:Hn(this.arcLength,o.r,o.g,o.b)}),Object.assign(s,{color:Hn(this.sectorLength,o.r,o.g,o.b)})}this.vectorBuffer.setAttributes(n),this.arcBuffer.setAttributes(r),this.sectorBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),!e||e.vectorVisible===void 0&&e.arcVisible===void 0&&e.sectorVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&(this.vectorBuffer.setParameters({opacity:e.lineOpacity}),this.arcBuffer.setParameters({opacity:e.lineOpacity})),e&&e.opacity!==void 0&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),e&&e.linewidth&&(this.vectorBuffer.setParameters({linewidth:e.linewidth}),this.arcBuffer.setParameters({linewidth:e.linewidth})),this}setVisibility(e,t){return super.setVisibility(e,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}ri.add("angle",Rde);const X4=new me,RA=new me,IA=new me,Ide=new me(0,1,0),N3=Object.assign({radialSegments:1,openEnded:!0},Os);function q4(i={}){const e=he(i.radialSegments,10),t=he(i.openEnded,!0),n=new Ct().makeRotationX(Math.PI/2),r=new $S(1,1,1,e,1,t);return r.applyMatrix4(n),r}class mH extends Ju{constructor(e,t={}){super(function(s,o={}){const a=q4(o),l=s.position1.length,c=a.attributes.position.array.length/3,u=l/3,h=new Float32Array(2*u*c);return PC(u,c,0,h),PC(u,c,u*c,h),{position:new Float32Array(2*l),color:new Float32Array(2*l),primitiveId:h,picking:s.picking}}(e,t),t,q4(t)),this.updateNormals=!0;const n=e.position1.length,r=e.radius.length;this.__center=new Float32Array(n),this._position=new Float32Array(2*n),this._color=new Float32Array(2*n),this._from=new Float32Array(2*n),this._to=new Float32Array(2*n),this._radius=new Float32Array(2*r),this.setAttributes(e,!0)}get defaultParameters(){return N3}applyPositionTransform(e,t,n){RA.fromArray(this._from,n),IA.fromArray(this._to,n),e.lookAt(RA,IA,Ide);const r=this._radius[t];X4.set(r,r,RA.distanceTo(IA)),e.scale(X4)}setAttributes(e={},t){const n={};e.position1&&e.position2&&(yl(e.position1,e.position2,this.__center),yl(e.position1,this.__center,this._position),yl(this.__center,e.position2,this._position,e.position1.length),this._from.set(e.position1),this._from.set(this.__center,e.position1.length),this._to.set(this.__center),this._to.set(e.position2,this.__center.length),n.position=this._position),e.color&&e.color2&&(this._color.set(e.color),this._color.set(e.color2,e.color.length),n.color=this._color),e.radius&&(this._radius.set(e.radius),this._radius.set(e.radius,e.radius.length),n.radius=this._radius),super.setAttributes(n,t)}}Rn.add("shader/CylinderImpostor.vert",`
attribute vec3 mapping;
attribute vec3 position1;
attribute vec3 position2;
attribute float radius;
varying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;
varying vec4 w;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform mat4 modelViewMatrixInverse;
uniform float ortho;
#include matrix_scale
void main(){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
base_radius.w = radius * matrixScale( modelViewMatrix );
vec3 center = position;
vec3 dir = normalize( position2 - position1 );
float ext = length( position2 - position1 ) / 2.0;
vec3 cam_dir;
if( ortho == 0.0 ){
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;
}else{
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;
}
cam_dir = normalize( cam_dir );
vec3 ldir;
float b = dot( cam_dir, dir );
end_b.w = b;
if( b < 0.0 )
ldir = -ext * dir;
else
ldir = ext * dir;
vec3 left = radius * normalize( cross( cam_dir, ldir ) );
vec3 up = radius * normalize( cross( left, ldir ) );
axis = normalize( normalMatrix * ldir );
U = normalize( normalMatrix * up );
V = normalize( normalMatrix * left );
vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );
base_radius.xyz = base4.xyz / base4.w;
vec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );
end_b.xyz = end4.xyz / end4.w;
w = modelViewMatrix * vec4(
center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0
);
gl_Position = projectionMatrix * w;
gl_Position.z = 0.99;
}`),Rn.add("shader/CylinderImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying vec3 axis;
varying vec4 base_radius;
varying vec4 end_b;
varying vec3 U;
varying vec3 V;
varying vec4 w;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float distSq3( vec3 v3a, vec3 v3b ){
return (
( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +
( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +
( v3a.z - v3b.z ) * ( v3a.z - v3b.z )
);
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
void main(){
vec3 ray_target = w.xyz / w.w;
vec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;
vec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);
vec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);
mat3 basis = mat3( U, V, axis );
vec3 diff = ray_target - 0.5 * (base + end);
vec3 P = diff * basis;
float dz = dot( axis, ray_direction );
float radius2 = vRadius*vRadius;
vec3 D = vec3(dot(U, ray_direction),
dot(V, ray_direction),
dz);
float a0 = P.x*P.x + P.y*P.y - radius2;
float a1 = P.x*D.x + P.y*D.y;
float a2 = D.x*D.x + D.y*D.y;
float d = a1*a1 - a0*a2;
if (d < 0.0) {
discard;
}
float dist = (-a1 + sqrt(d)) / a2;
vec3 surface_point = ray_target + dist * ray_direction;
vec3 base_to_surface = surface_point - base;
vec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );
float base_cap_test = dot( base_to_surface, axis );
float end_cap_test = dot((surface_point - end), axis);
#ifndef CAP
vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
vec3 tmp_point2 = new_point2 - base;
#endif
if (base_cap_test < 0.0) {
float dNV;
float near;
vec3 front_point;
if ( ortho == 1.0 ) {
front_point = ray_target;
} else {
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
front_point = ray_direction * near + ray_origin;
}
if (dot(front_point - base, front_point-base) > radius2) {
discard;
}
#ifdef CAP
surface_point = front_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(axis, end) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - end, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
if( end_cap_test > 0.0 )
{
float dNV;
float near;
vec3 end_point;
if ( ortho == 1.0 ) {
end_point = ray_target;
} else {
dNV = dot(axis, ray_direction);
if (dNV < 0.0) {
discard;
}
near = dot(axis, end) / dNV;
end_point = ray_direction * near + ray_origin;
}
if( dot(end_point - end, end_point-base) > radius2 ) {
discard;
}
#ifdef CAP
surface_point = end_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - base, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
gl_FragDepthEXT = calcDepth( surface_point );
#ifdef NEAR_CLIP
if( calcClip( surface_point ) > 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
if( calcClip( surface_point ) > 0.0 ) {
discard;
}
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#endif
if (gl_FragDepthEXT < 0.0) {
discard;
}
if (gl_FragDepthEXT > 1.0) {
discard;
}
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -surface_point;
vec3 vNormal = _normal;
vec3 vColor;
if( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){
if( b < 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}else{
if( b > 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Lde=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),Dde=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);class Y4 extends C3{constructor(e,t={}){super("v3",e,t)}get mapping(){return Lde}get mappingIndices(){return Dde}get mappingIndicesSize(){return 12}get mappingSize(){return 6}get mappingItemSize(){return 3}}const gH=Object.assign({openEnded:!1},Os),Nde=Object.assign({openEnded:{updateShader:!0}},$d);class Fde extends Y4{constructor(e,t={}){super(e,t),this.parameterTypes=Nde,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new Ct},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return gH}getDefines(e){const t=Y4.prototype.getDefines.call(this,e);return this.parameters.openEnded||(t.CAP=1),t}}Object.assign({disableImpostor:!1},N3,gH);const Pc=class{constructor(i,e={}){return!i.color2&&i.color&&(i.color2=i.color),!_l||e&&e.disableImpostor?new mH(i,e):new Fde(i,e)}};Fo.add("cylinder",Pc);class kde extends qr{constructor(e,t,n){super(e,t,n),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};t.radiusSize=he(t.radiusSize,.5),t.colorValue=he(t.colorValue,"lightgreen"),t.useInteriorColor=he(t.useInteriorColor,!0),this.showAxes=he(t.showAxes,!0),this.showBox=he(t.showBox,!1),super.init(t)}getPrincipalAxes(){let e;const t=this.getAssembly();return t&&(e=t.partList[0].getSelection()),this.structureView.getPrincipalAxes(e)}getAxesData(e){const t=this.getPrincipalAxes(),n=new $t(this.colorValue);let r=0,s=0;this.showAxes&&(r+=6,s+=3),this.showBox&&(r+=8,s+=12);const o=new Float32Array(3*r),a=Hn(r,n.r,n.g,n.b),l=Lo(r,this.radiusSize),c=new Float32Array(3*s),u=new Float32Array(3*s),h=Hn(s,n.r,n.g,n.b),d=Lo(s,this.radiusSize);let f=0;if(this.showAxes){const _=function(v,g){v.toArray(o,2*f),g.toArray(o,2*f+3),v.toArray(c,f),g.toArray(u,f),f+=3};_(t.begA,t.endA),_(t.begB,t.endB),_(t.begC,t.endC)}if(this.showBox){const _=new me,{d1a:v,d2a:g,d3a:b,d1b:m,d2b:y,d3b:A}=t.getProjectedScaleForAtoms(e);let w=2*f;const M=function(C,N,P){_.copy(t.center).addScaledVector(t.normVecA,C).addScaledVector(t.normVecB,N).addScaledVector(t.normVecC,P),_.toArray(o,w),w+=3};M(v,g,b),M(v,g,A),M(v,y,A),M(v,y,b),M(m,y,A),M(m,y,b),M(m,g,b),M(m,g,A);let T=f;const E=function(C,N){_.fromArray(o,2*f+3*C).toArray(c,T),_.fromArray(o,2*f+3*N).toArray(u,T),T+=3};E(0,1),E(0,3),E(0,6),E(1,2),E(1,7),E(2,3),E(2,4),E(3,5),E(4,5),E(4,7),E(5,6),E(6,7)}const p=new Lue(t);return{vertex:{position:o,color:a,radius:l,picking:p},edge:{position1:c,position2:u,color:h,color2:h,radius:d,picking:p}}}create(){const e=this.getAxesData(this.structureView);this.sphereBuffer=new eh(e.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new Pc(e.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=this.getAxesData(t.sview),r={},s={};e&&!e.position||(Object.assign(r,{position:n.vertex.position}),Object.assign(s,{position1:n.edge.position1,position2:n.edge.position2})),e&&!e.color||(Object.assign(r,{color:n.vertex.color}),Object.assign(s,{color:n.edge.color,color2:n.edge.color})),e&&!e.radius||(Object.assign(r,{radius:n.vertex.radius}),Object.assign(s,{radius:n.edge.radius})),this.sphereBuffer.setAttributes(r),this.cylinderBuffer.setAttributes(s)}}ri.add("axes",kde);class a2 extends qr{constructor(e,t,n){super(e,t,n),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusType=he(t.radiusType,"size"),t.radiusSize=he(t.radiusSize,.15),t.useInteriorColor=he(t.useInteriorColor,!0),this.aspectRatio=he(t.aspectRatio,2),this.lineOnly=he(t.lineOnly,!1),this.cylinderOnly=he(t.cylinderOnly,!1),this.multipleBond=he(t.multipleBond,"off"),this.bondSpacing=he(t.bondSpacing,1),this.bondScale=he(t.bondScale,.4),this.linewidth=he(t.linewidth,2),super.init(t)}getAtomRadius(e){return this.aspectRatio*super.getAtomRadius(e)}getAtomParams(e,t){var n=super.getAtomParams(e,t);return n.radiusParams.scale*=this.aspectRatio,n}getAtomData(e,t,n){return e.getAtomData(this.getAtomParams(t,n))}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},t),super.getBondParams(e,t)}getBondData(e,t,n){return e.getBondData(this.getBondParams(t,n))}createData(e){const t=[];if(this.lineOnly)this.lineBuffer=new Ec(this.getBondData(e,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),t.push(this.lineBuffer);else{const n=new Pc(this.getBondData(e),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(t.push(n),!this.cylinderOnly){const r=new eh(this.getAtomData(e),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));t.push(r)}}return{bufferList:t}}updateData(e,t){this.multipleBond!=="off"&&e&&e.radius&&(e.position=!0);const n=this.getBondData(t.sview,e);if(this.lineOnly){const a={};e&&!e.position||Object.assign(a,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(a,{color:n.color,color2:n.color2}),t.bufferList[0].setAttributes(a)}else{var r={};if(e&&!e.position||Object.assign(r,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(r,{color:n.color,color2:n.color2}),e&&!e.radius||Object.assign(r,{radius:n.radius}),t.bufferList[0].setAttributes(r),!this.cylinderOnly){var s=this.getAtomData(t.sview,e),o={};e&&!e.position||Object.assign(o,{position:s.position}),e&&!e.color||Object.assign(o,{color:s.color}),e&&!e.radius||Object.assign(o,{radius:s.radius}),t.bufferList[1].setAttributes(o)}}}setParameters(e={}){let t=!1;const n={};return(e.aspectRatio||e.bondSpacing||e.bondScale)&&(Object.assign(n,{radius:!0}),_l&&!this.disableImpostor||(t=!0)),super.setParameters(e,n,t),this}}ri.add("ball+stick",a2);class Ude extends a2{constructor(e,t,n){super(e,t,n),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(n)}init(e){var t=e||{};t.aspectRatio=he(t.aspectRatio,1),t.radiusSize=he(t.radiusSize,.25),super.init(t)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}getAtomData(e,t,n){return e.getBackboneAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){return e.getBackboneBondData(this.getBondParams(t,n))}}ri.add("backbone",Ude);class Ode extends a2{constructor(e,t,n){super(e,t,n),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){let t=e||{};t.aspectRatio=he(t.aspectRatio,1),t.radiusSize=he(t.radiusSize,.3),super.init(t)}getAtomData(e,t,n){return e.getRungAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){let r=this.getBondParams(t,n);return Object.assign(r.colorParams,{rung:!0}),e.getRungBondData(r)}}ri.add("base",Ode);class Bde{constructor(e,t){this.m=e,this.tension=t,this.dt=1/this.m,this.delta=1e-4,this.vec1=new me,this.vec2=new me,this.vDir=new me,this.vTan=new me,this.vNorm=new me,this.vBin=new me,this.m2=Math.ceil(this.m/2)}interpolateToArr(e,t,n,r,s,o,a){o[a+0]=rc(e.x,t.x,n.x,r.x,s,this.tension),o[a+1]=rc(e.y,t.y,n.y,r.y,s,this.tension),o[a+2]=rc(e.z,t.z,n.z,r.z,s,this.tension)}interpolateToVec(e,t,n,r,s,o){o.x=rc(e.x,t.x,n.x,r.x,s,this.tension),o.y=rc(e.y,t.y,n.y,r.y,s,this.tension),o.z=rc(e.z,t.z,n.z,r.z,s,this.tension)}interpolatePosition(e,t,n,r,s,o){for(var a=0;a<this.m;++a){var l=o+3*a,c=this.dt*a;this.interpolateToArr(e,t,n,r,c,s,l)}}interpolateTangent(e,t,n,r,s,o){for(var a=0;a<this.m;++a){var l=this.dt*a,c=l-this.delta,u=l+this.delta,h=o+3*a;c<0&&(c=0),u>1&&(u=1),this.interpolateToVec(e,t,n,r,c,this.vec1),this.interpolateToVec(e,t,n,r,u,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(s,h)}}vectorSubdivide(e,t,n,r,s){let o,a=t.next(),l=t.next(),c=t.next();const u=t.size,h=u-1;let d=r||0;for(let f=0;f<h;++f)o=a,a=l,l=c,c=t.next(),e.apply(this,[o,a,l,c,n,d]),d+=3*this.m;s&&(o=t.get(u-2),a=t.get(u-1),l=t.get(0),c=t.get(1),e.apply(this,[o,a,l,c,n,d]),d+=3*this.m)}getPosition(e,t,n,r){e.reset(),this.vectorSubdivide(this.interpolatePosition,e,t,n,r);var s=e.size-1,o=s*this.m*3;r&&(o+=3*this.m);var a=e.get(r?0:s);t[o]=a.x,t[o+1]=a.y,t[o+2]=a.z}getTangent(e,t,n,r){e.reset(),this.vectorSubdivide(this.interpolateTangent,e,t,n,r);let s=(e.size-1)*this.m*3;r&&(s+=3*this.m),ar(t,t,s-3,s,3)}interpolateNormalDir(e,t,n,r,s,o,a,l,c,u,h,d,f){for(let p=0;p<this.m;++p){let _=d+3*p;f&&(_+=3*this.m2);const v=this.dt*p;this.interpolateToVec(e,t,n,r,v,this.vec1),this.interpolateToVec(s,o,a,l,v,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(c,_),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(h,_),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(u,_)}}interpolateNormal(e,t,n,r,s){for(var o=0;o<this.m;++o){var a=s+3*o;e.copy(this.vNorm),this.vTan.fromArray(t,a),this.vBin.crossVectors(e,this.vTan).normalize(),this.vBin.toArray(r,a),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(n,a)}}getNormal(e,t,n,r,s,o){this.vNorm.set(0,0,1);const a=e-1;let l=s||0;for(var c=0;c<a;++c)this.interpolateNormal(this.vDir,t,n,r,l),l+=3*this.m;o&&(this.interpolateNormal(this.vDir,t,n,r,l),l+=3*this.m),this.vBin.toArray(r,l),this.vNorm.toArray(n,l)}getNormalDir(e,t,n,r,s,o,a,l){e.reset(),t.reset();const c=new me,u=new me,h=new me,d=new me,f=new me,p=new me().copy(e.next()),_=new me().copy(e.next()),v=new me().copy(e.next()),g=new me,b=new me().copy(t.next()),m=new me().copy(t.next()),y=new me().copy(t.next());this.vNorm.set(0,0,1);let A=e.size,w=A-1,M=o||0;for(var T=0;T<w;++T)f.copy(p),p.copy(_),_.copy(v),v.copy(e.next()),g.copy(b),b.copy(m),m.copy(y),y.copy(t.next()),T===0?(c.subVectors(g,f),u.subVectors(b,p),c.dot(u)<0&&(u.multiplyScalar(-1),b.addVectors(p,u)),h.subVectors(m,_),u.dot(h)<0&&(h.multiplyScalar(-1),m.addVectors(_,h))):h.copy(d),d.subVectors(y,v),h.dot(d)<0&&(d.multiplyScalar(-1),y.addVectors(v,d)),this.interpolateNormalDir(f,p,_,v,g,b,m,y,n,r,s,M,l),M+=3*this.m;if(a&&(f.copy(e.get(A-2)),p.copy(e.get(A-1)),_.copy(e.get(0)),v.copy(e.get(1)),g.copy(t.get(A-2)),b.copy(t.get(A-1)),m.copy(t.get(0)),y.copy(t.get(1)),h.copy(d),d.subVectors(y,v),h.dot(d)<0&&(d.multiplyScalar(-1),y.addVectors(v,d)),this.interpolateNormalDir(f,p,_,v,g,b,m,y,n,r,s,M,l),M+=3*this.m),l){this.vBin.fromArray(s,3*this.m2),this.vNorm.fromArray(r,3*this.m2);for(var E=0;E<this.m2;++E)this.vBin.toArray(s,3*E),this.vNorm.toArray(r,3*E)}else this.vBin.toArray(s,M),this.vNorm.toArray(r,M)}interpolateColor(e,t,n,r,s){var o,a;for(o=0;o<this.m2;++o)a=s+3*o,n.apply(this,[e,r,a]);for(o=this.m2;o<this.m;++o)a=s+3*o,n.apply(this,[t,r,a])}getColor(e,t,n,r,s){let o;e.reset(),e.next();let a=e.next();for(var l=e.size,c=l-1,u=r||0,h=0;h<c;++h)o=a,a=e.next(),this.interpolateColor(o,a,t,n,u),u+=3*this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolateColor(o,a,t,n,u),u+=3*this.m),n[u]=n[u-3],n[u+1]=n[u-2],n[u+2]=n[u-1]}interpolatePicking(e,t,n,r,s){var o;for(o=0;o<this.m2;++o)r[s+o]=n.apply(this,[e]);for(o=this.m2;o<this.m;++o)r[s+o]=n.apply(this,[t])}getPicking(e,t,n,r,s){let o;e.reset(),e.next();let a=e.next();const l=e.size,c=l-1;let u=r||0;for(var h=0;h<c;++h)o=a,a=e.next(),this.interpolatePicking(o,a,t,n,u),u+=this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolatePicking(o,a,t,n,u),u+=this.m),n[u]=n[u-1]}interpolateSize(e,t,n,r,s){const o=n.apply(this,[e]),a=n.apply(this,[t]);for(let l=0;l<this.m;++l){let c=l/this.m;r[s+l]=(1-c)*o+c*a}}getSize(e,t,n,r,s){let o;e.reset(),e.next();let a=e.next();const l=e.size,c=l-1;let u=r||0;for(var h=0;h<c;++h)o=a,a=e.next(),this.interpolateSize(o,a,t,n,u),u+=this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolateSize(o,a,t,n,u),u+=this.m),n[u]=n[u-1]}}class xm{constructor(e,t){this.polymer=e,this.size=e.residueCount;var n=t||{};this.directional=n.directional||!1,this.positionIterator=n.positionIterator||!1,this.subdiv=n.subdiv||1,this.smoothSheet=n.smoothSheet||!1,n.tension?this.tension=n.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new Bde(this.subdiv,this.tension)}getAtomIterator(e,t){const n=this.polymer,r=n.structure,s=n.residueCount;let o=0,a=-1;const l=[r.getAtomProxy(),r.getAtomProxy(),r.getAtomProxy(),r.getAtomProxy()],c=[new me,new me,new me,new me];var u=r.getAtomProxy(),h=r.getAtomProxy();function d(f){var p=l[o%4];if(p.index=n.getAtomIndexByType(f,e),t&&f>0&&f<s&&p.sstruc==="e"){var _=c[o%4];return u.index=n.getAtomIndexByType(f+1,e),h.index=n.getAtomIndexByType(f-1,e),_.addVectors(u,h).add(p).add(p).multiplyScalar(.25),o+=1,_}return o+=1,p}return{size:s,next:function(){var f=d(a);return a+=1,f},get:d,reset:function(){o=0,a=-1}}}getSubdividedColor(e){var t=this.subdiv,n=this.polymer,r=(n.residueCount-1)*t*3+3;n.isCyclic&&(r+=3*t);var s=new Float32Array(r),o=this.getAtomIterator("trace"),a=e||{};a.structure=n.structure;var l=_n.getScheme(a);return this.interpolator.getColor(o,function(c,u,h){l.atomColorToArray(c,u,h)},s,0,n.isCyclic),{color:s}}getSubdividedPicking(){var e=this.subdiv,t=this.polymer,n=(t.residueCount-1)*e+1;t.isCyclic&&(n+=e);var r=t.structure,s=this.getAtomIterator("trace"),o=new Float32Array(n);return this.interpolator.getPicking(s,function(a){return a.index},o,0,t.isCyclic),{picking:new Hd(o,r)}}getSubdividedPosition(){return{position:this.getPosition()}}getSubdividedOrientation(){const e=this.getTangent(),t=this.getNormals(e);return{tangent:e,normal:t.normal,binormal:t.binormal}}getSubdividedSize(e){var t=this.subdiv,n=this.polymer,r=(n.residueCount-1)*t+1;n.isCyclic&&(r+=t);var s=new Float32Array(r),o=this.getAtomIterator("trace"),a=new Ac(e);return this.interpolator.getSize(o,function(l){return a.atomRadius(l)},s,0,n.isCyclic),{size:s}}getPosition(){const e=this.subdiv,t=this.polymer;let n=(t.residueCount-1)*e*3+3;t.isCyclic&&(n+=3*e);const r=new Float32Array(n),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(s,r,0,t.isCyclic),r}getTangent(){const e=this.subdiv,t=this.polymer;let n=(this.size-1)*e*3+3;t.isCyclic&&(n+=3*e);const r=new Float32Array(n),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(s,r,0,t.isCyclic),r}getNormals(e){const t=this.subdiv,n=this.polymer,r=n.isProtein(),s=this.size;let o=(s-1)*t*3+3;n.isCyclic&&(o+=3*t);const a=new Float32Array(o),l=new Float32Array(o);if(this.directional&&!this.polymer.isCg()){const c=this.getAtomIterator("direction1"),u=this.getAtomIterator("direction2");this.interpolator.getNormalDir(c,u,e,a,l,0,n.isCyclic,r)}else this.interpolator.getNormal(s,e,a,l,0,n.isCyclic);return{normal:a,binormal:l}}}const K4=new me,Vy=new me,zde=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},Os);class Gde extends Mc{constructor(e,t={}){super(function(n,r={}){const s=he(r.radialSegments,4),o=he(r.capped,!1),a=o?s:0,l=o?s-2:0,c=n.position.length/3,u=c*s*3+2*a*3,h=2*(c-1)*s*3+2*l*3;return{position:new Float32Array(u),color:new Float32Array(u),index:El(h,u/3),normal:new Float32Array(u),picking:n.picking}}(e,t),t),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=e.position.length/3,e.primitiveId=km(this.size2),this.setAttributes(e),this.makeIndex()}get defaultParameters(){return zde}setAttributes(e={}){const t=this.parameters.aspectRatio,n=this.size2,r=n-1,s=this.parameters.radialSegments,o=this.geometry.attributes;let a,l,c,u,h,d,f,p,_,v,g,b,m;e.position&&(a=e.position,l=e.normal,c=e.binormal,u=e.tangent,d=e.size,p=o.position.array,v=o.normal.array,o.position.needsUpdate=!0,o.normal.needsUpdate=!0),e.color&&(h=e.color,_=o.color.array,o.color.needsUpdate=!0),e.primitiveId&&(f=e.primitiveId,g=o.primitiveId.array,o.primitiveId.needsUpdate=!0);let y=0,A=0,w=0,M=0,T=0,E=0,C=0,N=0,P=0,L=0;const R=[],F=[],V=[],G=[],U=[],z=[];if(a)for(let O=0;O<s;++O){const D=O/s*2*Math.PI;R[O]=t*Math.cos(D),F[O]=Math.sin(D),V[O]=t*Math.cos(D-.01),G[O]=Math.sin(D-.01),U[O]=t*Math.cos(D+.01),z[O]=Math.sin(D+.01)}for(let O=0;O<n;++O){b=3*O,m=b*s,a&&u&&l&&c&&d&&(K4.set(u[b],u[b+1],u[b+2]),A=l[b],w=l[b+1],M=l[b+2],T=c[b],E=c[b+1],C=c[b+2],N=a[b],P=a[b+1],L=a[b+2],y=d[O]);for(let D=0;D<s;++D){const B=m+3*D;if(a){const W=-y*R[D],q=y*F[D],j=-y*V[D],te=y*G[D],ne=-y*U[D],Z=y*z[D];p[B]=N+W*A+q*T,p[B+1]=P+W*w+q*E,p[B+2]=L+W*M+q*C,Vy.set(ne*A+Z*T-(j*A+te*T),ne*w+Z*E-(j*w+te*E),ne*M+Z*C-(j*M+te*C)).cross(K4),v[B]=Vy.x,v[B+1]=Vy.y,v[B+2]=Vy.z}h&&(_[B]=h[b],_[B+1]=h[b+1],_[B+2]=h[b+2]),f&&(g[O*s+D]=f[O])}}b=0,m=3*n*s;for(let O=0;O<s;++O){const D=b+3*O,B=m+3*O;a&&u&&(p[B]=p[D],p[B+1]=p[D+1],p[B+2]=p[D+2],v[B]=u[b],v[B+1]=u[b+1],v[B+2]=u[b+2]),h&&(_[B]=_[D],_[B+1]=_[D+1],_[B+2]=_[D+2]),f&&(g[n*s+O]=g[0+O])}b=3*(n-1)*s,m=3*(n+1)*s;for(let O=0;O<s;++O){const D=b+3*O,B=m+3*O;a&&u&&(p[B]=p[D],p[B+1]=p[D+1],p[B+2]=p[D+2],v[B]=u[3*r],v[B+1]=u[3*r+1],v[B+2]=u[3*r+2]),h&&(_[B]=_[D],_[B+1]=_[D+1],_[B+2]=_[D+2]),f&&(g[(n+1)*s+O]=g[(n-1)*s+O])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void tt.error("Index is null");const t=e.array,n=this.size2,r=n-1,s=this.capTriangles,o=this.parameters.radialSegments,a=this.parameters.radialSegments+1;let l,c;for(let h=0;h<r;++h){const d=h*o*3*2,f=h*o,p=(h+1)*o;for(let _=0;_<o;++_)c=d+3*_*2,t[c]=f+_,t[c+1]=f+(_+1)%o,t[c+2]=p+_,t[c+3]=p+_,t[c+4]=f+(_+1)%o,t[c+5]=p+(_+1)%o}const u=[0];for(let h=1;h<a/2;++h)u.push(h),o-h!==h&&u.push(o-h);c=r*o*3*2,l=n*o;for(let h=0;h<u.length-2;++h)h%2==0?(t[c+3*h+0]=l+u[h+0],t[c+3*h+1]=l+u[h+1],t[c+3*h+2]=l+u[h+2]):(t[c+3*h+0]=l+u[h+2],t[c+3*h+1]=l+u[h+1],t[c+3*h+2]=l+u[h+0]);c=r*o*3*2+3*s,l=n*o+o;for(let h=0;h<u.length-2;++h)h%2==0?(t[c+3*h+0]=l+u[h+0],t[c+3*h+1]=l+u[h+1],t[c+3*h+2]=l+u[h+2]):(t[c+3*h+0]=l+u[h+2],t[c+3*h+1]=l+u[h+1],t[c+3*h+2]=l+u[h+0])}}class F3 extends qr{constructor(e,t,n){super(e,t,n),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.colorScheme=he(t.colorScheme,"chainname"),t.colorScale=he(t.colorScale,"RdYlBu"),t.radiusType=he(t.radiusType,"sstruc"),t.radiusScale=he(t.radiusScale,.7),t.useInteriorColor=he(t.useInteriorColor,!0),this.aspectRatio=he(t.aspectRatio,5),this.tension=he(t.tension,NaN),this.capped=he(t.capped,!0),this.smoothSheet=he(t.smoothSheet,!1),t.quality==="low"?(this.subdiv=3,this.radialSegments=6):t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=he(t.subdiv,6),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:this.aspectRatio!==1,smoothSheet:this.smoothSheet},e)}getSpline(e){return new xm(e,this.getSplineParams())}getAspectRatio(e){return e.isCg()?1:this.aspectRatio}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){let t=[],n=[];return this.structure.eachPolymer(r=>{if(r.residueCount<4)return;n.push(r);const s=this.getSpline(r),o=this.getAspectRatio(r),a=s.getSubdividedPosition(),l=s.getSubdividedOrientation(),c=s.getSubdividedColor(this.getColorParams()),u=s.getSubdividedPicking(),h=s.getSubdividedSize(this.getRadiusParams());t.push(new Gde(Object.assign({},a,l,c,u,h),this.getBufferParams({radialSegments:this.radialSegments,aspectRatio:o,capped:this.capped})))},e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){pt&&tt.time(this.type+" repr update"),e=e||{};for(var n=0,r=t.polymerList.length;n<r;++n){var s={},o=t.polymerList[n],a=this.getSpline(o),l=this.getAspectRatio(o);if(Object.assign(t.bufferList[n],{aspectRatio:l}),e.position||e.radius){var c=a.getSubdividedPosition(),u=a.getSubdividedOrientation(),h=a.getSubdividedSize(this.getRadiusParams(l));s.position=c.position,s.normal=u.normal,s.binormal=u.binormal,s.tangent=u.tangent,s.size=h.size}if(e.color){var d=a.getSubdividedColor(this.getColorParams());s.color=d.color}if(e.picking){var f=a.getSubdividedPicking();s.picking=f.picking}t.bufferList[n].setAttributes(s)}pt&&tt.timeEnd(this.type+" repr update")}setParameters(e){var t={};return e&&e.aspectRatio&&(t.radius=!0),e&&e.tension&&(t.position=!0),super.setParameters(e,t,!1),this}}ri.add("cartoon",F3);class Vde extends qr{constructor(e,t,n){super(e,t,n),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusSize=he(t.radiusSize,.05),t.useInteriorColor=he(t.useInteriorColor,!0),this.hydrogenBond=he(t.hydrogenBond,!0),this.weakHydrogenBond=he(t.weakHydrogenBond,!1),this.waterHydrogenBond=he(t.waterHydrogenBond,!1),this.backboneHydrogenBond=he(t.backboneHydrogenBond,!1),this.hydrophobic=he(t.hydrophobic,!1),this.halogenBond=he(t.halogenBond,!0),this.ionicInteraction=he(t.ionicInteraction,!0),this.metalCoordination=he(t.metalCoordination,!0),this.cationPi=he(t.cationPi,!0),this.piStacking=he(t.piStacking,!0),this.filterSele=he(t.filterSele,""),this.labelVisible=he(t.labelVisible,!1),this.labelFixedSize=he(t.labelFixedSize,!1),this.labelSize=he(t.labelSize,2),this.labelUnit=he(t.labelUnit,""),this.maxHydrophobicDist=he(t.maxHydrophobicDist,4),this.maxHbondDist=he(t.maxHbondDist,3.5),this.maxHbondSulfurDist=he(t.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=he(t.maxHbondAccAngle,45),this.maxHbondDonAngle=he(t.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=he(t.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=he(t.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=he(t.maxPiStackingDist,5.5),this.maxPiStackingOffset=he(t.maxPiStackingOffset,2),this.maxPiStackingAngle=he(t.maxPiStackingAngle,30),this.maxCationPiDist=he(t.maxCationPiDist,6),this.maxCationPiOffset=he(t.maxCationPiOffset,2),this.maxIonicDist=he(t.maxIonicDist,5),this.maxHalogenBondDist=he(t.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=he(t.maxHalogenBondAngle,30),this.maxMetalDist=he(t.maxMetalDist,3),this.refineSaltBridges=he(t.refineSaltBridges,!0),this.masterModelIndex=he(t.masterModelIndex,-1),this.lineOfSightDistFactor=he(t.lineOfSightDistFactor,1),super.init(t)}getAtomRadius(){return 0}getContactData(e){const t={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},n={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return Iue(Cue(e,t),e,n)}createData(e){const t=this.getContactData(e),n=[new Pc(Qce(t),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){const r={size:this.labelSize,unit:this.labelUnit};n.push(new zm(function(s,o){const a=yl(s.position1,s.position2),l=[],c=XS(s.position1,s.position2),u=c.length/3;for(let h=0;h<u;h++){const d=3*h,f=Math.sqrt(Math.pow(c[d],2)+Math.pow(c[d+1],2)+Math.pow(c[d+2],2));switch(o.unit){case"angstrom":l[h]=f.toFixed(2)+" ";break;case"nm":l[h]=(f/10).toFixed(2)+" nm";break;default:l[h]=f.toFixed(2)}}return{position:a,size:Lo(a.length/3,o.size),color:s.color,text:l}}(t,r),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:n}}}ri.add("contact",Vde);class Hde extends L3{constructor(e,t,n){super(e,t,n),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=he(t.side,"double"),t.opacity=he(t.opacity,.5),this.atomQuad=he(t.atomQuad,[]),this.extendLine=he(t.extendLine,!0),this.lineVisible=he(t.lineVisible,!0),this.planeVisible=he(t.planeVisible,!0),this.sectorVisible=he(t.sectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomQuad.length)return;const t=function(a,l={}){const c=he(l.angleStep,Math.PI/90),u=a.length,h=a.length/12,d=new Float32Array(h),f=new Float32Array(3*h),p=new Array(h),_=new Array(h),v=new Array(h),g=new Array(h),b=new Array(h);let m=0,y=0,A=0;const w=nn(),M=nn(),T=nn(),E=nn(),C=nn(),N=nn(),P=nn(),L=nn(),R=nn(),F=nn(),V=nn(),G=nn(),U=nn(),z=nn(),O=nn();let D=0;for(var B=0;B<u;B+=12){if(Cs(w,a,B),Cs(M,a,B+3),Cs(T,a,B+6),Cs(E,a,B+9),_i(C,w,M),_i(N,T,M),Du(N)===0)continue;_i(P,E,T),$n(L,N,.5),Ia(R,M,L),Ti(C,C),Ti(N,N),Ti(P,P),_i(L,w,R);const se=Ws(L,N)>0;_i(L,E,R);const $=Ws(L,N)<0;if($n(L,N,Ws(N,C)),_i(F,C,L),$n(L,N,Ws(N,P)),_i(V,P,L),Du(F)===0||Du(V)===0)continue;Ti(F,F),Ti(V,V);const fe=d[D]=Zce(F,V);p[D]=(MV*fe).toFixed(1)+"",ro(z,F,N),Ti(z,z),Ws(z,V)<0&&YS(z,z),Aa(L,R,F,z,fe/2),sn(L,f,3*D);const xe=Math.ceil(fe/c),Ie=xe+(l.extendLine?4:2),ge=l.extendLine?36:0,Oe=new Float32Array(3*Ie),Me=new Float32Array(3*Ie),Y=new Float32Array(9*xe),Q=new Float32Array(ge);_[D]=Oe,v[D]=Me,g[D]=Y,b[D]=Q,l.extendLine&&(se?(_i(L,w,T),Ti(L,L),$n(G,L,1/Ws(F,L)),Ia(G,G,T)):($n(G,C,1/Ws(F,C)),Ia(G,G,M)),$?(_i(L,E,M),Ti(L,L),$n(U,L,1/Ws(V,L)),Ia(U,U,M)):($n(U,P,1/Ws(V,P)),Ia(U,U,T))),Ia(O,R,F);let de=0;l.extendLine?(sn(w,Oe,de),sn(G,Me,de),de+=3,sn(G,Oe,de),sn(O,Me,de),de+=3,sn(G,Q,0),sn(O,Q,3),sn(se?T:M,Q,6),sn(se?T:M,Q,9),sn(O,Q,12),sn(R,Q,15)):(sn(R,Oe,de),sn(O,Me,de),de+=3);const Le=function(K,be){const Ue=9*be;sn(R,Y,Ue),sn(O,Y,Ue+3),sn(O,Oe,de),Aa(O,R,F,z,K),sn(O,Y,Ue+6),sn(O,Me,de),de+=3};let ie=0;for(let K=c;K<fe;K+=c)Le(K,ie++);Le(fe,ie++),l.extendLine?(sn(O,Oe,3*(Ie-2)),sn(U,Me,3*(Ie-2)),sn(U,Oe,3*(Ie-1)),sn(E,Me,3*(Ie-1)),sn(U,Q,18),sn(O,Q,21),sn($?M:T,Q,24),sn($?M:T,Q,27),sn(O,Q,30),sn(R,Q,33)):(sn(O,Oe,de),sn(R,Me,de),de+=3),m+=3*Ie,y+=9*xe,A+=ge,D+=1}const W=D,q=new Float32Array(m),j=new Float32Array(m),te=new Float32Array(y),ne=new Float32Array(A);let Z=0,le=0,re=0;for(let se=0;se<W;se++){const $=_[se],fe=v[se],xe=g[se],Ie=b[se];ar($,q,0,Z,$.length),ar(fe,j,0,Z,fe.length),ar(xe,te,0,le,xe.length),ar(Ie,ne,0,re,Ie.length),Z+=$.length,le+=xe.length,re+=Ie.length}return{labelPosition:f.subarray(0,3*W),labelText:p.slice(0,W),linePosition1:q,linePosition2:j,planePosition:ne,sectorPosition:te}}(D3(e,this.atomQuad),{extendLine:this.extendLine}),n=this.n=t.labelText.length,r=new $t(this.labelColor);this.textBuffer=new zm({position:t.labelPosition,size:Lo(n,this.labelSize),color:Hn(n,r.r,r.g,r.b),text:t.labelText},this.getLabelBufferParams());const s=new $t(this.colorValue);this.lineLength=t.linePosition1.length/3;const o=Hn(this.lineLength,s.r,s.g,s.b);return this.lineBuffer=new Ec(DC({position1:t.linePosition1,position2:t.linePosition2,color:o}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=t.planePosition.length/3,this.planeBuffer=new Mc({position:t.planePosition,color:Hn(this.planeLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=t.sectorPosition.length/3,this.sectorBuffer=new Mc({position:t.sectorPosition,color:Hn(this.sectorLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},r={},s={};if(e.color){const o=new $t(this.colorValue);Object.assign(n,{color:Hn(this.lineLength,o.r,o.g,o.b),color2:Hn(this.lineLength,o.r,o.g,o.b)}),Object.assign(r,{color:Hn(this.planeLength,o.r,o.g,o.b)}),Object.assign(s,{color:Hn(this.sectorLength,o.r,o.g,o.b)})}this.lineBuffer.setAttributes(n),this.planeBuffer.setAttributes(r),this.sectorBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),!e||e.lineVisible===void 0&&e.sectorVisible===void 0&&e.planeVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&this.lineBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.lineBuffer.setParameters({linewidth:e.linewidth}),this}setVisibility(e,t){return super.setVisibility(e,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}ri.add("dihedral",Hde);function LA(i,e){function t(r,s){return s in r}const n=Object.assign({},i);for(const r in n)t(n,r)&&t(e,r)&&(n[r]=he(e[r],n[r]));return n}function ya(i,e){const t=new $t(i),n=new Float32Array(3*e);return Hn(e,t.r,t.g,t.b,n),n}class $de extends qr{constructor(e,t,n){super(e,t,n),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(n)}init(e){const t=e||{},n=LA({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},t);Object.assign(this,n);const r=LA({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},t);Object.assign(this,r),this.histogramsData.forEach(s=>{const o=LA(n,s);Object.assign(s,o)}),t.side=he(t.side,"double"),t.opacity=he(t.opacity,.5),t.radiusType=he(t.radiusType,"size"),t.radiusSize=he(t.radiusSize,.15),super.init(t)}getHistogramBinBorderBufferParameters(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})}getBondArrowsBufferParameters(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})}getOpaqueMiddleDiscBufferParameters(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})}getHistogramBufferParameters(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})}createData(e){if(!e.atomCount||!this.histogramsData.length)return;this.histogramsData.forEach(a=>a.atomPositions=D3(e,[a.atomQuad]));const t=this.scaleBinToSectorArea?function(a){return Math.sqrt(a)}:function(a){return a};function n(a){const l=a.map(h=>h.length),c=new Float32Array(_3(l));let u=0;for(let h=0;h<a.length;h++)c.set(a[h],u),u+=a[h].length;return c}function r(a,l){return new Ec({position1:n(a.map(c=>c.startPoints)),position2:n(a.map(c=>c.endPoints)),color:n(a.map(c=>c.startColors)),color2:n(a.map(c=>c.endColors))},l)}function s(a,l){return new Mc({position:n(a.map(c=>c.triangles)),color:n(a.map(c=>c.triangleColors))},l)}this.histogramsData.forEach(a=>a.histogram360Scaled=a.histogram360.map(t));const o=[];for(let a=0;a<this.histogramsData.length;a++){let l,c=this.histogramsData[a];c.histogram360.length>=3&&(l=Wde(c)),l!==void 0&&o.push(l)}return this.frontHistogramBinBordersBuffer=r(o.map(a=>a.frontHistogramBinBorders),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=r(o.map(a=>a.backHistogramBinBorders),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=r(o.map(a=>a.adjacentBondArrows),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=r(o.map(a=>a.distantBondArrows),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=s(o.map(a=>a.opaqueMiddleDisc),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=s(o.map(a=>a.frontHistogram),this.getHistogramBufferParameters()),this.backHistogramBuffer=s(o.map(a=>a.backHistogram),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}setParameters(e){return super.setParameters(e,{},!1),e&&e.histogramBinBorderVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),t||this.viewer.requestRender(),this}}function Wde(i){const e=i.atomPositions,t=i.histogram360Scaled,n=t.length<=180?360:2*t.length,r={triangles:new Float32Array(3*n*3),triangleColors:ya(i.opaqueMiddleDiscColor,3*n)},s={triangles:new Float32Array(3*t.length*3),triangleColors:ya(i.frontHistogramColor,3*t.length)},o={triangles:new Float32Array(3*t.length*3),triangleColors:ya(i.backHistogramColor,3*t.length)},a={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:ya(i.histogramBinBorderColor,t.length),endColors:ya(i.histogramBinBorderColor,t.length)},l={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:ya(i.histogramBinBorderColor,t.length),endColors:ya(i.histogramBinBorderColor,t.length)},c={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:ya(i.adjacentBondArrowColor,t.length),endColors:ya(i.adjacentBondArrowColor,t.length)},u={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:ya(i.distantBondArrowColor,t.length),endColors:ya(i.distantBondArrowColor,t.length)},h=nn(),d=nn(),f=nn(),p=nn(),_=nn(),v=nn(),g=nn(),b=nn(),m=nn(),y=nn(),A=nn(),w=nn(),M=nn(),T=nn(),E=nn(),C=nn(),N=[h,d,f,p];for(let z=0;z<N.length;z++)Cs(N[z],e,3*z);if(_i(_,h,d),_i(v,f,d),_i(b,p,f),Du(v)===0||($n(E,v,.5),Ia(m,d,E),Ti(_,_),Ti(v,v),Ti(b,b),YS(g,v),$n(E,g,Ws(g,_)),_i(y,_,E),$n(E,v,Ws(v,b)),_i(A,b,E),Du(y)===0||Du(A)===0))return;Ti(y,y),Ti(A,A);const P=Math.acos(Ws(y,A));ro(w,g,y),ro(M,v,A),Ti(w,w),Ti(M,M);let L=P;Ws(w,A)<0&&(L=-P),Ia(T,m,y);const R=Math.max.apply(null,t),F=2*Math.PI/t.length;function V(z,O,D,B,W){const q=3*O*3;sn(m,z,q);const j=Number(t[O])/R;$n(E,D,j),$n(C,B,j),Aa(T,m,E,C,O*W),sn(T,z,q+3),Aa(T,m,E,C,(O+1)*W),sn(T,z,q+6)}function G(z,O,D,B,W){ar(m,c.startPoints,0,3*D,m.length),Aa(E,m,B,W,0+0*F),ar(E,c.endPoints,0,3*D,m.length),ar(m,u.startPoints,0,3*D,m.length),Aa(E,m,B,W,L),ar(E,u.endPoints,0,3*D,m.length);for(let q=0;q<t.length;q++)ar(m,O.startPoints,0,3*q,m.length),Aa(E,m,B,W,0+F*q),ar(E,O.endPoints,0,3*q,E.length);for(let q=0;q<t.length;q++)V(z.triangles,q,B,W,F)}const U=2*Math.PI/n;for(let z=0;z<n;z++){const O=3*z*3;sn(m,r.triangles,O),Aa(T,m,y,w,z*U),sn(T,r.triangles,O+3),Aa(T,m,y,w,(z+1)*U),sn(T,r.triangles,O+6)}return $n(E,v,-.01),Ia(m,m,E),G(s,a,0,y,w),$n(E,v,.02),Ia(m,m,E),G(o,l,1,A,M),{opaqueMiddleDisc:r,frontHistogram:s,backHistogram:o,frontHistogramBinBorders:a,backHistogramBinBorders:l,adjacentBondArrows:c,distantBondArrows:u}}ri.add("dihedral-histogram",$de);class jde extends L3{constructor(e,t,n){super(e,t,n),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.linewidth=he(t.linewidth,5),t.radiusType=he(t.radiusType,"size"),t.radiusSize=he(t.radiusSize,.2),this.labelUnit=he(t.labelUnit,""),this.useCylinder=he(t.useCylinder,!1),this.atomPair=he(t.atomPair,[]),super.init(t)}getDistanceData(e,t){let n=t.length;const r=new Array(n);let s=new Float32Array(3*n);const o=new ii,a=new ii,l=new Vx,c=e.getAtomProxy(),u=e.getAtomProxy();let h=0;const d=e.getAtomSet();t.forEach((p,_)=>{let v=p[0],g=p[1];if(typeof v=="number"&&Number.isInteger(v)&&typeof g=="number"&&Number.isInteger(g)){if(!d.get(v)||!d.get(g))return void(h+=1);c.index=v,u.index=g}else{o.setString(v),a.setString(g);var b=e.getAtomIndices(o),m=e.getAtomIndices(a);if(!b.length||!m.length)return void(h+=1);c.index=b[0],u.index=m[0]}l.addBond(c,u,1),_-=h;var y=c.distanceTo(u);switch(this.labelUnit){case"angstrom":r[_]=y.toFixed(2)+" ";break;case"nm":r[_]=(y/10).toFixed(2)+" nm";break;default:r[_]=y.toFixed(2)}var A=3*_;s[A+0]=(c.x+u.x)/2,s[A+1]=(c.y+u.y)/2,s[A+2]=(c.z+u.z)/2}),h>0&&(n-=h,s=s.subarray(0,3*n));var f=new gr(l.count,!0);return{text:r,position:s,bondSet:f,bondStore:l}}getBondData(e,t,n){const r=e.getBondData(this.getBondParams(t,n));return r.picking&&(r.picking=new Fue(r.picking.array,r.picking.structure,n.bondStore)),r}createData(e){if(!e.atomCount||!this.atomPair.length)return;const t=this.atomPair.length,n=new $t(this.labelColor),r=this.getDistanceData(e,this.atomPair);this.textBuffer=new zm({position:r.position,size:Lo(t,this.labelSize),color:Hn(t,n.r,n.g,n.b),text:r.text},this.getLabelBufferParams());const s={bondSet:r.bondSet,bondStore:r.bondStore},o=this.getBondData(e,{position:!0,color:!0,picking:!0,radius:this.useCylinder},s);return this.useCylinder?this.distanceBuffer=new Pc(o,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new Ec(PV(o),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:r.bondSet,bondStore:r.bondStore,position:r.position,bufferList:[this.textBuffer,this.distanceBuffer]}}updateData(e,t){super.updateData(e,t);const n={bondSet:t.bondSet,bondStore:t.bondStore},r=this.getBondData(t.sview,e,n),s={};e&&!e.color||Object.assign(s,{color:r.color,color2:r.color2}),e&&!e.radius||Object.assign(s,{radius:r.radius}),this.distanceBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),this.useCylinder||(e&&e.lineOpacity&&this.distanceBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.distanceBuffer.setParameters({linewidth:e.linewidth})),this}}function DA(i){return 2*(i.position.length/3)*3}ri.add("distance",jde);const Xde=Object.assign({scale:1,color:"grey"},Os);class Z4 extends Tl{constructor(e,t={}){super({position:new Float32Array(DA(e)),color:new Float32Array(DA(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";const n=new $t(this.parameters.color),r=this.geometry.attributes;Hn(DA(e)/3,n.r,n.g,n.b,r.color.array),this.setAttributes(e)}get defaultParameters(){return Xde}setAttributes(e={}){const t=this.geometry.attributes;let n,r,s;e.position&&e.vector&&(n=e.position,r=e.vector,s=t.position.array,t.position.needsUpdate=!0);const o=this.size/2,a=this.parameters.scale;if(n&&r)for(let l=0;l<o;l++){const c=2*l*3,u=3*l;s[c+0]=n[u+0],s[c+1]=n[u+1],s[c+2]=n[u+2],s[c+3]=n[u+0]+r[u+0]*a,s[c+4]=n[u+1]+r[u+1]*a,s[c+5]=n[u+2]+r[u+2]*a}}}class qde extends qr{constructor(e,t,n){super(e,t,n),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){const t=e||{};t.colorScheme=he(t.colorScheme,"sstruc"),t.radiusType=he(t.radiusType,"size"),t.radiusSize=he(t.radiusSize,.15),t.radiusScale=he(t.radiusScale,1),t.useInteriorColor=he(t.useInteriorColor,!0),super.init(t)}createData(e){const t=[],n=[];return this.structure.eachPolymer(r=>{if(r.residueCount<4)return;n.push(r);const s=new kb(r),o=s.getPosition(),a=s.getColor(this.getColorParams()),l=s.getSize(this.getRadiusParams()),c=s.getPicking();t.push(new eh({position:o.center,color:a.color,radius:l.size,picking:c.picking},this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),new Z4({position:o.center,vector:o.axis},this.getBufferParams({color:"skyblue",scale:1})),new Z4({position:o.center,vector:o.resdir},this.getBufferParams({color:"lightgreen",scale:1})))},e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){pt&&tt.time(this.type+" repr update"),e=e||{};for(let n=0,r=t.polymerList.length;n<r;++n){const s=3*n,o={},a=t.polymerList[n],l=new kb(a);if(e.position){const c=l.getPosition();Object.assign(o,{position:c.center}),t.bufferList[s+1].setAttributes({position:c.center,vector:c.axis}),t.bufferList[s+2].setAttributes({position:c.center,vector:c.resdir})}t.bufferList[s].setAttributes(o)}pt&&tt.timeEnd(this.type+" repr update")}}ri.add("helixorient",qde);class vH extends a2{constructor(e,t,n){super(e,t,n),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,super.init(t)}}ri.add("licorice",vH),Rn.add("shader/HyperballStickImpostor.vert",`
attribute vec3 mapping;
attribute float radius;
attribute float radius2;
attribute vec3 position1;
attribute vec3 position2;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform float shrink;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewProjectionMatrixInverse;
void main(){
vRadius = radius;
vRadius2 = radius2;
vec4 spaceposition;
vec3 position_atom1;
vec3 position_atom2;
vec4 vertex_position;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
float radius1 = radius;
position_atom1 = position1;
position_atom2 = position2;
float distance = distance( position_atom1, position_atom2 );
spaceposition.z = mapping.z * distance;
if (radius1 > radius2) {
spaceposition.y = mapping.y * 1.5 * radius1;
spaceposition.x = mapping.x * 1.5 * radius1;
} else {
spaceposition.y = mapping.y * 1.5 * radius2;
spaceposition.x = mapping.x * 1.5 * radius2;
}
spaceposition.w = 1.0;
vec4 e3 = vec4( 1.0 );
vec3 e1, e1_temp, e2, e2_temp;
e3.xyz = normalize(position_atom1-position_atom2);
if (e3.z == 0.0) { e3.z = 0.0000000000001;}
if ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}
if ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}
if ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}
vec4 focus = vec4( 1.0 );
focus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +
( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));
focus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +
( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));
focus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +
( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;
e2 = normalize(e2_temp);
mat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );
vertex_position.xyz = R * spaceposition.xyz;
vertex_position.w = 1.0;
vertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;
vertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;
vertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;
gl_Position = modelViewProjectionMatrix * vertex_position;
vec4 i_near, i_far;
vec4 near = gl_Position;
near.z = 0.0 ;
near = modelViewProjectionMatrixInverse * near;
i_near = near;
vec4 far = gl_Position;
far.z = far.w ;
i_far = modelViewProjectionMatrixInverse * far;
prime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );
prime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );
float Rsquare = (radius1*radius1/shrink) - (
(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +
(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +
(position_atom1.z - focus.z)*(position_atom1.z - focus.z)
);
focus.w = Rsquare;
matrix_near = mat4( i_near, i_far, focus, e3 );
gl_Position.z = 1.0;
}`),Rn.add("shader/HyperballStickImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float shrink;
uniform mat4 modelViewMatrix;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewMatrixInverseTranspose;
uniform mat4 projectionMatrix;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float calcClip( vec4 cameraPos ){
return dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
float calcClip( vec3 cameraPos ){
return calcClip( vec4( cameraPos, 1.0 ) );
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
struct Ray {
vec3 origin ;
vec3 direction ;
};
bool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){
float a = x3.x;
float b = x3.y;
float c = x3.z;
float d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;
float l = a*M.x+b*M.y+c*M.z+d;
if (l<0.0) {return true;}
else{return false;}
}
vec3 isect_surf(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t1 =(-b-sqrt(delta))/a;
return r.origin+t1*r.direction;
}
vec3 isect_surf2(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t2 =(-b+sqrt(delta))/a;
return r.origin+t2*r.direction;
}
Ray primary_ray(vec4 near1, vec4 far1){
vec3 near=near1.xyz/near1.w;
vec3 far=far1.xyz/far1.w;
return Ray(near,far-near);
}
float update_z_buffer(vec3 M, mat4 ModelViewP){
float depth1;
vec4 Ms=(ModelViewP*vec4(M,1.0));
return depth1=(1.0+Ms.z/Ms.w)/2.0;
}
void main(){
float radius = max( vRadius, vRadius2 );
vec4 i_near, i_far, focus;
vec3 e3, e1, e1_temp, e2;
i_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);
i_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);
focus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);
e3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2 = normalize(cross(e1,e3));
vec4 equation = focus;
float shrinkfactor = shrink;
float t1 = -1.0/(1.0-shrinkfactor);
float t2 = 1.0/(shrinkfactor);
vec4 colonne1, colonne2, colonne3, colonne4;
mat4 mat;
vec3 equation1 = vec3(t2,t2,t1);
float A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;
float A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;
float A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;
float A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;
float A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;
float A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;
float A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;
float A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;
float A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;
float A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;
float A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;
float A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;
float A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;
colonne1 = vec4(A11,A21,A31,A41);
colonne2 = vec4(A21,A22,A32,A42);
colonne3 = vec4(A31,A32,A33,A43);
colonne4 = vec4(A41,A42,A43,A44);
mat = mat4(colonne1,colonne2,colonne3,colonne4);
Ray ray = primary_ray(i_near,i_far) ;
vec3 M;
M = isect_surf(ray, mat);
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
vec4 M1 = vec4(M,1.0);
vec4 M2 = mat*M1;
vec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
#ifdef NEAR_CLIP
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){
M = isect_surf2(ray, mat);
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )
discard;
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#endif
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
float distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /
distance(prime2.xyz,prime1.xyz);
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;
vec3 vNormal = _normal;
vec3 vColor;
if( distance_ratio>0.5 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Yde=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),Kde=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);class Zde extends C3{constructor(e,t={}){super("v3",e,t)}get mapping(){return Yde}get mappingIndices(){return Kde}get mappingIndicesSize(){return 36}get mappingSize(){return 8}get mappingItemSize(){return 3}}const _H=Object.assign({shrink:.14},Os),Qde=Object.assign({shrink:{uniform:!0}},$d);class Jde extends Zde{constructor(e,t={}){super(e,t),this.parameterTypes=Qde,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new Ct},modelViewProjectionMatrixInverse:{value:new Ct},modelViewMatrixInverseTranspose:{value:new Ct},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return _H}}Object.assign({disableImpostor:!1},N3,_H);const efe=class{constructor(i,e={}){return!_l||e&&e.disableImpostor?(i.radius=function(t,n){const r=t.length,s=new Float32Array(r);for(let o=0;o<r;o++)s[o]=Math.min(t[o],n[o]);return s}(i.radius,i.radius2),new mH(i,e)):new Jde(i,e)}};class tfe extends vH{constructor(e,t,n){super(e,t,n),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){var t=e||{};t.radiusScale=he(t.radiusScale,.2),t.radiusType=he(t.radiusType,"vdw"),t.useInteriorColor=he(t.useInteriorColor,!0),this.shrink=he(t.shrink,.12),super.init(t)}getBondParams(e,t){return e&&!e.radius||(t=Object.assign({radius2:!0},t)),super.getBondParams(e,t)}createData(e){var t=new eh(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*e.bondCount),{bufferList:[t,new efe(e.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams()),r=t.sview.getBondData(this.getBondParams()),s={},o={};if(!e||e.position){Object.assign(s,{position:n.position});var a=r.position1,l=r.position2;Object.assign(o,{position:yl(a,l,this.__center),position1:a,position2:l})}e&&!e.color||(Object.assign(s,{color:n.color}),Object.assign(o,{color:r.color,color2:r.color2})),e&&!e.radius||(Object.assign(s,{radius:n.radius}),Object.assign(o,{radius:r.radius,radius2:r.radius2})),t.bufferList[0].setAttributes(s),t.bufferList[1].setAttributes(o)}}ri.add("hyperball",tfe);class GC{constructor(e,t={},n=""){this.type=e,this.text=t,this.format=n,this.errorLogged=!1}atomLabel(e){let t;switch(this.type){case"atomname":t=e.atomname;break;case"atomindex":t=`${e.index}`;break;case"occupancy":t=e.occupancy.toFixed(2);break;case"bfactor":t=e.bfactor.toFixed(2);break;case"serial":t=`${e.serial}`;break;case"element":t=e.element;break;case"atom":t=`${e.atomname}|${e.index}`;break;case"resname":t=e.resname;break;case"resno":t=`${e.resno}`;break;case"res":t=`${Nb[e.resname.toUpperCase()]||e.resname}${e.resno}`;break;case"residue":const n=Nb[e.resname.toUpperCase()];t=n&&!e.inscode?`${n}${e.resno}`:`[${e.resname}]${e.resno}${e.inscode}`;break;case"text":t=this.text[e.index];break;case"format":try{t=hV.sprintf(this.format,e)}catch(r){this.errorLogged||(this.errorLogged=!0,console.log(r.message))}break;default:t=e.qualifiedName()}return t===void 0?"":t}}GC.types={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"};class nfe extends qr{constructor(e,t,n){super(e,t,n),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:GC.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(n)}init(e){const t=e||{};this.labelType=he(t.labelType,"res"),this.labelText=he(t.labelText,{}),this.labelFormat=he(t.labelFormat,""),this.labelGrouping=he(t.labelGrouping,"atom"),this.fontFamily=he(t.fontFamily,"sans-serif"),this.fontStyle=he(t.fontStyle,"normal"),this.fontWeight=he(t.fontWeight,"bold"),this.xOffset=he(t.xOffset,0),this.yOffset=he(t.yOffset,0),this.zOffset=he(t.zOffset,.5),this.attachment=he(t.attachment,"bottom-left"),this.showBorder=he(t.showBorder,!1),this.borderColor=he(t.borderColor,"lightgrey"),this.borderWidth=he(t.borderWidth,.15),this.showBackground=he(t.showBackground,!1),this.backgroundColor=he(t.backgroundColor,"lightgrey"),this.backgroundMargin=he(t.backgroundMargin,.5),this.backgroundOpacity=he(t.backgroundOpacity,1),this.fixedSize=he(t.fixedSize,!1),super.init(t)}getTextData(e,t){const n=this.getAtomParams(t),r=new GC(this.labelType,this.labelText,this.labelFormat);let s,o,a,l,c,u,h;if(this.labelGrouping==="atom"){const d=e.getAtomData(n);s=d.position,o=d.radius,a=d.color,t&&!t.text||(l=[],e.eachAtom(f=>l.push(r.atomLabel(f))))}else if(this.labelGrouping==="residue"){t&&!t.position||(c=[]),t&&!t.color||(h=[]),t&&!t.radius||(u=[]),t&&!t.text||(l=[]),n.colorParams&&(n.colorParams.structure=e.getStructure());const d=_n.getScheme(n.colorParams),f=new Ac(n.radiusParams),p=e.getAtomProxy();let _=0;e.eachResidue(v=>{const g=3*_;v.isProtein()||v.isNucleic()?(p.index=v.traceAtomIndex,t&&!t.position||p.positionToArray(c,g)):(p.index=v.atomOffset,t&&!t.position||v.positionToArray(c,g)),t&&!t.color||d.atomColorToArray(p,h,g),t&&!t.radius||(u[_]=f.atomRadius(p)),t&&!t.text||l.push(r.atomLabel(p)),++_}),t&&!t.position||(s=new Float32Array(c)),t&&!t.color||(a=new Float32Array(h)),t&&!t.radius||(o=new Float32Array(u))}return{position:s,size:o,color:a,text:l}}createData(e){return{bufferList:[new zm(this.getTextData(e,{position:!0,color:!0,radius:!0,text:!0}),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}}updateData(e,t){t.bufferList[0].setAttributes(this.getTextData(t.sview,e))}getAtomRadius(){return 0}}function ife(i){const e=i.getAtomSet(),t=i.getBondSet(),n=i.getBondProxy();return t.forEach(function(r){n.index=r,e.clear(n.atomIndex1),e.clear(n.atomIndex2)}),e}ri.add("label",nfe);class rfe extends qr{constructor(e,t,n){super(e,t,n),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.multipleBond=he(t.multipleBond,"off"),this.bondSpacing=he(t.bondSpacing,1),this.linewidth=he(t.linewidth,2),this.lines=he(t.lines,!0),this.crosses=he(t.crosses,"lone"),this.crossSize=he(t.crossSize,.4),super.init(t)}getAtomRadius(e){return .1}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},t),super.getBondParams(e,t)}_crossData(e,t){if(e&&!e.position&&!e.color)return;const n={};this.crosses==="lone"&&Object.assign(n,{atomSet:ife(t)});const r=t.getAtomData(this.getAtomParams(e,n)),s={},o=r.position,a=r.color,l=r.picking,c=(o||a).length,u=3*c;let h=new Float32Array(0),d=new Float32Array(0),f=new Float32Array(0),p=new Float32Array(0),_=0,v=new Float32Array(0);e&&!e.position||(h=s.position1=new Float32Array(u),d=s.position2=new Float32Array(u),_=this.crossSize/2),e&&!e.color||(f=s.color=new Float32Array(u),p=s.color2=new Float32Array(u)),e&&!e.picking||(v=new Float32Array(3*r.picking.array.length));for(let g=0;g<c;g++){const b=3*g,m=3*b;if(!e||e.position){const y=o[b],A=o[b+1],w=o[b+2];h[m]=y-_,h[m+1]=A,h[m+2]=w,d[m]=y+_,d[m+1]=A,d[m+2]=w,h[m+3]=y,h[m+4]=A-_,h[m+5]=w,d[m+3]=y,d[m+4]=A+_,d[m+5]=w,h[m+6]=y,h[m+7]=A,h[m+8]=w-_,d[m+6]=y,d[m+7]=A,d[m+8]=w+_}if(!e||e.color){const y=m+9;for(let A=m;A<y;A+=3)f[A]=p[A]=a[b],f[A+1]=p[A+1]=a[b+1],f[A+2]=p[A+2]=a[b+2]}e&&!e.picking||(v[b]=v[b+1]=v[b+2]=l.array[g])}return e&&!e.picking||(s.picking=new Hd(v,l.structure)),s}createData(e){const t={position:!0,color:!0,picking:!0},n=[];if(this.lines){const r=e.getBondData(this.getBondParams(t)),s=new Ec(r,this.getBufferParams({linewidth:this.linewidth}));n.push(s)}if(this.crosses!=="off"){const r=new Ec(this._crossData(t,e),this.getBufferParams({linewidth:this.linewidth}));n.push(r)}return{bufferList:n}}updateData(e,t){let n=0;if(this.lines){const r=t.sview.getBondData(this.getBondParams(e)),s={};e&&!e.position||Object.assign(s,{position1:r.position1,position2:r.position2}),e&&!e.color||Object.assign(s,{color:r.color,color2:r.color2}),t.bufferList[n++].setAttributes(s)}if(this.crosses!=="off"){const r=this._crossData(e,t.sview),s={};e&&!e.position||Object.assign(s,{position1:r.position1,position2:r.position2}),e&&!e.color||Object.assign(s,{color:r.color,color2:r.color2}),t.bufferList[n++].setAttributes(s)}}setParameters(e){var t={};return e&&(e.bondSpacing||e.crossSize)&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}function yH(i,e,t,n,r){const s=new(n=n||Int32Array)(i*e*t*(r=r||1));function o(a,l,c){return((a*e+l)*t+c)*r}return{data:s,index:o,set:function(a,l,c,...u){const h=o(a,l,c);for(let d=0;d<r;++d)s[h+d]=u[d]},toArray:function(a,l,c,u=[],h=0){const d=o(a,l,c);for(let f=0;f<r;++f)u[h+f]=s[d+f]},fromArray:function(a,l,c,u,h=0){const d=o(a,l,c);for(let f=0;f<r;++f)s[d+f]=u[h+f]},copy:function(a){s.set(a.data)}}}function Hx(i,e,t){var n=jV(e),r=_1(i);i.length===0&&(r[0].set([0,0,0]),r[1].set([0,0,0]));var s,o,a,l,c,u,h,d,f,p,_,v,g,b,m,y=r[0],A=r[1];function w(G,U,z,O,D){s=U||1.4,o=z||2,v=D||!0;var B=0;for(var W in n)B=Math.max(B,W);var q=w1(y,A,B,o,G?s:0);l=q.dim[0],c=q.dim[1],u=q.dim[2],h=q.matrix,d=q.tran,o=q.scaleFactor,f={},p={},N(G),_=s*o,a=O||s/o,g=new Uint8Array(l*c*u),G&&(b=new Float64Array(l*c*u)),v&&(m=new Int32Array(l*c*u))}var M=1,T=2,E=4,C=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function N(G){var U,z,O,D,B,W,q,j,te,ne;for(var Z in n)if(U=parseFloat(Z),!f[Z]){for(W=(q=G?(U+s)*o+.5:U*o+.5)*q,j=Math.floor(q)+1,te=new Int32Array(j*j),ne=0,z=0;z<j;++z)for(O=0;O<j;++O)(D=z*z+O*O)>W?te[ne]=-1:(B=Math.sqrt(W-D),te[ne]=Math.floor(B)),++ne;p[Z]=j,f[Z]=te}}function P(G){var U,z,O,D,B,W,q,j,te,ne,Z,le,re,se,$,fe,xe,Ie,ge=3*G,Oe=G;U=Math.floor(.5+o*(i[ge]+d[0])),z=Math.floor(.5+o*(i[ge+1]+d[1])),O=Math.floor(.5+o*(i[ge+2]+d[2]));var Me,Y=e[Oe],Q=f[Y],de=0,Le=c*u,ie=p[Y];for(ne=0;ne<ie;++ne)for(Z=0;Z<ie;++Z){if((Me=Q[de])!==-1){for(fe=-1;fe<2;++fe)for(xe=-1;xe<2;++xe)for(Ie=-1;Ie<2;++Ie)if(fe!==0&&xe!==0&&Ie!==0){for(q=fe*ne,te=Ie*Z,le=0;le<=Me;++le)if(se=z+(j=le*xe),$=O+te,!((re=U+q)<0||se<0||$<0||re>=l||se>=c||$>=u)){var K=re*Le+se*u+$;if(v)if(g[K]&M){if(g[K]&M){var be=m[K];be!==ge&&q*q+j*j+te*te<(D=U+q-Math.floor(.5+o*(i[be]+d[0])))*D+(B=z+j-Math.floor(.5+o*(i[be+1]+d[1])))*B+(W=O+te-Math.floor(.5+o*(i[be+2]+d[2])))*W&&(m[K]=G)}}else g[K]|=M,m[K]=G;else g[K]|=M}}}de++}}function L(G){var U,z;for(console.time("EDTSurface fillvoxels"),U=0,z=g.length;U<z;++U)g[U]=0,G&&(b[U]=-1),v&&(m[U]=-1);for(U=0,z=i.length/3;U<z;++U)P(U);for(U=0,z=g.length;U<z;++U)g[U]&M&&(g[U]|=T);console.timeEnd("EDTSurface fillvoxels")}function R(G){var U,z,O,D,B,W,q,j,te,ne,Z,le,re,se,$,fe,xe,Ie,ge,Oe=3*G,Me=G,Y=0;U=Math.floor(.5+o*(i[Oe]+d[0])),z=Math.floor(.5+o*(i[Oe+1]+d[1])),O=Math.floor(.5+o*(i[Oe+2]+d[2]));var Q=e[Me],de=c*u;for(re=0,ge=p[Q];re<ge;++re)for(se=0;se<ge;++se){if(f[Q][Y]!==-1){for(fe=-1;fe<2;++fe)for(xe=-1;xe<2;++xe)for(Ie=-1;Ie<2;++Ie)if(fe!==0&&xe!==0&&Ie!==0){for(q=fe*re,te=Ie*se,$=0;$<=f[Q][Y];++$)if(Z=z+(j=$*xe),le=O+te,!((ne=U+q)<0||Z<0||le<0||ne>=l||Z>=c||le>=u)){var Le=ne*de+Z*u+le;if(g[Le]&T){if(v){var ie=m[Le];q*q+j*j+te*te<(D=Math.floor(.5+o*(i[ie]+d[0])))*D+(B=Math.floor(.5+o*(i[ie+1]+d[1])))*B+(W=Math.floor(.5+o*(i[ie+2]+d[2])))*W&&(m[Le]=G)}}else g[Le]|=T,v&&(m[Le]=G)}}}Y++}}function F(){var G,U,z,O;console.time("EDTSurface fastdistancemap");var D,B=yH(l,c,u,Uint16Array,3),W=c*u,q=_*_,j=0;for(G=0;G<l;++G)for(U=0;U<c;++U)for(z=0;z<u;++z)g[D=G*W+U*u+z]&=~T,g[D]&M&&g[D]&E&&(B.set(G,U,z,G,U,z),b[D]=0,g[D]|=T,j+=1);var te=new Int32Array(3*j),ne=0,Z=new Int32Array(3*j),le=0;for(G=0;G<l;++G)for(U=0;U<c;++U)for(z=0;z<u;++z)g[D=G*W+U*u+z]&E&&(te[ne]=G,te[ne+1]=U,te[ne+2]=z,ne+=3,g[D]&=~E);do for(le=V(te,B,ne,Z),ne=0,G=0,O=le;G<O;G+=3)D=W*Z[G]+u*Z[G+1]+Z[G+2],g[D]&=~E,b[D]<=1.0404*q&&(te[ne]=Z[G],te[ne+1]=Z[G+1],te[ne+2]=Z[G+2],ne+=3);while(ne>0);var re,se=a*a,$=new Uint16Array(3);for(G=0;G<l;++G)for(U=0;U<c;++U)for(z=0;z<u;++z)g[D=G*W+U*u+z]&=~E,g[D]&M&&(g[D]&T&&!(g[D]&T&&b[D]>=se)||(g[D]|=E,v&&g[D]&T&&(B.toArray(G,U,z,$),re=$[0]*W+$[1]*u+$[2],m[D]=m[re])));console.timeEnd("EDTSurface fastdistancemap")}function V(G,U,z,O){var D,B,W,q,j,te,ne,Z,le,re,se,$,fe=new Uint16Array(3),xe=0;if(z===0)return xe;var Ie=-1,ge=-1,Oe=-1,Me=c*u;for(ne=0,le=z;ne<le;ne+=3)for(D=G[ne],B=G[ne+1],W=G[ne+2],U.toArray(D,B,W,fe),Z=0;Z<6;++Z)Ie=D+($=C[Z])[0],ge=B+$[1],Oe=W+$[2],Ie<l&&Ie>-1&&ge<c&&ge>-1&&Oe<u&&Oe>-1&&(g[se=Ie*Me+u*ge+Oe]&M&&!(g[se]&T)?(U.fromArray(Ie,ge,Oe,fe),re=(q=Ie-fe[0])*q+(j=ge-fe[1])*j+(te=Oe-fe[2])*te,b[se]=re,g[se]|=T,g[se]|=E,O[xe]=Ie,O[xe+1]=ge,O[xe+2]=Oe,xe+=3):g[se]&M&&g[se]&T&&(re=(q=Ie-fe[0])*q+(j=ge-fe[1])*j+(te=Oe-fe[2])*te)<b[se]&&(U.fromArray(Ie,ge,Oe,fe),b[se]=re,g[se]&E||(g[se]|=E,O[xe]=Ie,O[xe+1]=ge,O[xe+2]=Oe,xe+=3)));for(ne=0,le=z;ne<le;ne+=3)for(D=G[ne],B=G[ne+1],W=G[ne+2],U.toArray(D,B,W,fe),Z=6;Z<18;Z++)Ie=D+($=C[Z])[0],ge=B+$[1],Oe=W+$[2],Ie<l&&Ie>-1&&ge<c&&ge>-1&&Oe<u&&Oe>-1&&(g[se=Ie*Me+u*ge+Oe]&M&&!(g[se]&T)?(U.fromArray(Ie,ge,Oe,fe),re=(q=Ie-fe[0])*q+(j=ge-fe[1])*j+(te=Oe-fe[2])*te,b[se]=re,g[se]|=T,g[se]|=E,O[xe]=Ie,O[xe+1]=ge,O[xe+2]=Oe,xe+=3):g[se]&M&&g[se]&T&&(re=(q=Ie-fe[0])*q+(j=ge-fe[1])*j+(te=Oe-fe[2])*te)<b[se]&&(U.fromArray(Ie,ge,Oe,fe),b[se]=re,g[se]&E||(g[se]|=E,O[xe]=Ie,O[xe+1]=ge,O[xe+2]=Oe,xe+=3)));for(ne=0,le=z;ne<le;ne+=3)for(D=G[ne],B=G[ne+1],W=G[ne+2],U.toArray(D,B,W,fe),Z=18;Z<26;Z++)Ie=D+($=C[Z])[0],ge=B+$[1],Oe=W+$[2],Ie<l&&Ie>-1&&ge<c&&ge>-1&&Oe<u&&Oe>-1&&(g[se=Ie*Me+u*ge+Oe]&M&&!(g[se]&T)?(U.fromArray(Ie,ge,Oe,fe),re=(q=Ie-fe[0])*q+(j=ge-fe[1])*j+(te=Oe-fe[2])*te,b[se]=re,g[se]|=T,g[se]|=E,O[xe]=Ie,O[xe+1]=ge,O[xe+2]=Oe,xe+=3):g[se]&M&&g[se]&T&&(re=(q=Ie-fe[0])*q+(j=ge-fe[1])*j+(te=Oe-fe[2])*te)<b[se]&&(U.fromArray(Ie,ge,Oe,fe),b[se]=re,g[se]&E||(g[se]|=E,O[xe]=Ie,O[xe+1]=ge,O[xe+2]=Oe,xe+=3)));return xe}this.getVolume=function(G,U,z,O,D){console.time("EDTSurface.getVolume");var B=G!=="vws";w(B,U,z,O,D),L(B),function(){var j,te,ne,Z=c*u;for(j=0;j<l;++j)for(te=0;te<u;++te)for(ne=0;ne<c;++ne){var le=j*Z+ne*u+te;if(g[le]&M)for(var re=0;re<26;){var se=j+C[re][0],$=te+C[re][2],fe=ne+C[re][1];if(se>-1&&se<l&&fe>-1&&fe<c&&$>-1&&$<u&&!(g[se*Z+fe*u+$]&M)){g[le]|=E;break}re++}}}(),G!=="ms"&&G!=="ses"||F(),G==="ses"&&(N(!1),function(){var j,te;for(j=0,te=g.length;j<te;++j)g[j]&=~T;for(j=0,te=i.length/3;j<te;++j)R(j)}()),function(j){var te,ne=g.length;if(j==="vws")for(te=0;te<ne;++te)g[te]&=~E,g[te]=g[te]&T?1:0;else if(j==="ms")for(te=0;te<ne;++te)g[te]&=~T,g[te]&E&&(g[te]|=T),g[te]&=~E,g[te]=g[te]&T?1:0;else if(j==="ses")for(te=0;te<ne;++te)g[te]&E&&g[te]&T?g[te]&=~E:g[te]&E&&!(g[te]&T)&&(g[te]|=T),g[te]=g[te]&T?1:0;else if(j==="sas")for(te=0;te<ne;++te)g[te]&=~E,g[te]=g[te]&T?1:0}(G);for(var W=0,q=m.length;W<q;++W)m[W]=t[m[W]];return console.timeEnd("EDTSurface.getVolume"),{data:g,nx:u,ny:c,nz:l,atomindex:m}},this.getSurface=function(G,U,z,O,D,B,W){var q=this.getVolume(G,U,z,O,D);return new Nu(q.data,q.nx,q.ny,q.nz,q.atomindex).getSurface(1,B,void 0,h,W)}}function xH(i,e,t,n,r,s,o){o=Math.max(.1,o);var a=i.length,l=r[0],c=r[1],u=r[2],h=s[0],d=s[1],f=s[2];function p(z,O){return Math.floor((z-O)/o)}for(var _,v,g,b=p(h,l)+1,m=p(d,c)+1,y=p(f,u)+1,A=b*m*y,w=m*y,M=[],T=0;T<a;T++){var E=(_=i[T],v=e[T],g=t[T],(p(_,l)*m+p(v,c))*y+p(g,u));M[E]===void 0?M[E]=[T]:M[E].push(T)}var C=new Uint32Array(A),N=new Uint16Array(A),P=new Uint32Array(a),L=0,R=0;for(T=0;T<A;T++){var F=C[T]=L,V=M[T];if(V!==void 0)for(var G=0;G<V.length;G++)P[L]=V[G],L++;var U=L-F;N[T]=U,U>R&&(R=U)}return{neighbourListLength:27*R+1,withinRadii:function(z,O,D,B,W){for(var q=0,j=p(z,l),te=p(O,c),ne=p(D,u),Z=Math.max(0,j-1),le=Math.max(0,te-1),re=Math.max(0,ne-1),se=Math.min(b,j+2),$=Math.min(m,te+2),fe=Math.min(y,ne+2),xe=Z;xe<se;++xe)for(var Ie=xe*w,ge=le;ge<$;++ge)for(var Oe=ge*y,Me=re;Me<fe;++Me)for(var Y=Ie+Oe+Me,Q=C[Y],de=Q+N[Y],Le=Q;Le<de;Le++){var ie=P[Le],K=i[ie]-z,be=e[ie]-O,Ue=t[ie]-D,ve=n[ie]+B;K*K+be*be+Ue*Ue<=ve*ve&&(W[q++]=P[Le])}W[q]=-1}}}function $x(i,e,t){const n=e.length,r=new Float32Array(n),s=new Float32Array(n),o=new Float32Array(n);for(let j=0;j<n;j++){const te=3*j;r[j]=i[te],s[j]=i[te+1],o[j]=i[te+2]}let a=_1(i);i.length===0&&(a[0].set([0,0,0]),a[1].set([0,0,0]));const l=a[0],c=a[1];let u,h,d,f,p,_,v,g,b,m,y,A,w,M,T,E,C,N,P=-1;const L=new Float32Array([0,0,0]),R=new Float32Array([0,0,0]),F=new Float32Array([0,0,0]),V=new Float32Array([0,0,0]);let G;function U(j,te,ne,Z){f=he(j,1.4),p=he(te,2),_=he(ne,!0),v=he(Z,30),u=new Float32Array(n),h=new Float32Array(n);for(let re=0;re<u.length;++re){var le=e[re]+f;u[re]=le,h[re]=le*le}d=0;for(let re=0;re<u.length;++re)u[re]>d&&(d=u[re]);(function(){const re=w1(l,c,d,p,0);p=re.scaleFactor,g=re.dim,b=re.matrix,G=Math.max(5,2+Math.floor(f*p)),m=Lo(g[0]*g[1]*g[2],-1001),y=new Int32Array(m.length),A=new Float32Array(g[0]),w=new Float32Array(g[1]),M=new Float32Array(g[2]),z(A,l[0],1/p),z(w,l[1],1/p),z(M,l[2],1/p)})(),function(){var re=0,se=2*Math.PI/v;E=new Float32Array(v),T=new Float32Array(v);for(var $=0;$<v;$++)E[$]=Math.cos(re),T[$]=Math.sin(re),re+=se}(),C=xH(r,s,o,u,l,c,2.01*d),N=new Int32Array(C.neighbourListLength),P=-1}function z(j,te,ne){for(let Z=0;Z<j.length;Z++)j[Z]=te+ne*Z}function O(j,te,ne,Z,le){let re;if(P!==-1){if(re=P,re!==Z&&re!==le&&D(re,j,te,ne))return re;P=-1}var se=0;for(re=N[se];re>=0;){if(re!==Z&&re!==le&&D(re,j,te,ne))return P=re,re;re=N[++se]}return P=-1,-1}function D(j,te,ne,Z){var le=3*j,re=h[j],se=i[le]-te,$=i[le+1]-ne,fe=i[le+2]-Z;return se*se+$*$+fe*fe<re}function B(){for(var j=0;j<n;j++){var te=r[j],ne=s[j],Z=o[j],le=u[j],re=h[j];C.withinRadii(te,ne,Z,le,N);for(var se=Math.ceil(le*p),$=Math.floor(p*(te-l[0])),fe=Math.floor(p*(ne-l[1])),xe=Math.floor(p*(Z-l[2])),Ie=Math.max(0,$-se),ge=Math.max(0,fe-se),Oe=Math.max(0,xe-se),Me=Math.min(g[0],$+se+2),Y=Math.min(g[1],fe+se+2),Q=Math.min(g[2],xe+se+2),de=Ie;de<Me;de++)for(var Le=A[de]-te,ie=g[1]*g[2]*de,K=ge;K<Y;K++)for(var be=w[K]-ne,Ue=Le*Le+be*be,ve=ie+g[2]*K,Ne=Oe;Ne<Q;Ne++){var $e=M[Ne]-Z,Ee=Ue+$e*$e;if(Ee<re){var Ze=Ne+ve;m[Ze]<0&&(m[Ze]=-m[Ze]);var nt=Math.sqrt(Ee),rt=le/nt,Be=Le*rt,qe=be*rt,it=$e*rt;if(O(Be+=te,qe+=ne,it+=Z,j,-1)===-1){var at=le-nt;at<m[Ze]&&(m[Ze]=at,_&&(y[Ze]=j))}}}}}function W(j,te){var ne=u[j],Z=u[te],le=L[0]=r[te]-r[j],re=L[1]=s[te]-s[j],se=L[2]=o[te]-o[j],$=le*le+re*re+se*se,fe=Math.sqrt($),xe=ne*((ne*ne+fe*fe-Z*Z)/(2*ne*fe));Ti(L,L),function(je,ee){je[0]=je[1]=je[2]=1,ee[0]!==0?je[0]=(ee[1]+ee[2])/-ee[0]:ee[1]!==0?je[1]=(ee[0]+ee[2])/-ee[1]:ee[2]!==0&&(je[2]=(ee[0]+ee[1])/-ee[2])}(F,L),Ti(F,F),ro(V,L,F),Ti(V,V);var Ie=Math.sqrt(ne*ne-xe*xe);$n(F,F,Ie),$n(V,V,Ie),$n(L,L,xe),R[0]=L[0]+r[j],R[1]=L[1]+s[j],R[2]=L[2]+o[j],P=-1;for(var ge=G,Oe=0;Oe<v;Oe++){var Me=E[Oe],Y=T[Oe],Q=R[0]+Me*F[0]+Y*V[0],de=R[1]+Me*F[1]+Y*V[1],Le=R[2]+Me*F[2]+Y*V[2];if(O(Q,de,Le,j,te)===-1)for(var ie=Math.floor(p*(Q-l[0])),K=Math.floor(p*(de-l[1])),be=Math.floor(p*(Le-l[2])),Ue=Math.max(0,ie-ge),ve=Math.max(0,K-ge),Ne=Math.max(0,be-ge),$e=Math.min(g[0],ie+ge+2),Ee=Math.min(g[1],K+ge+2),Ze=Math.min(g[2],be+ge+2),nt=Ue;nt<$e;nt++){le=Q-A[nt];for(var rt=g[1]*g[2]*nt,Be=ve;Be<Ee;Be++)for(var qe=le*le+(re=de-w[Be])*re,it=rt+g[2]*Be,at=Ne;at<Ze;at++){$=qe+(se=Le-M[at])*se;var ht=at+it,Qe=m[ht];if(Qe>0&&$<Qe*Qe&&(m[ht]=Math.sqrt($),_)){const je=le*L[0]+re*L[1]+se*L[2];y[ht]=je<0?te:j}}}}}function q(j,te,ne){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),U(j,te,ne),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),B(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),function(){for(var Z=0;Z<n;Z++){C.withinRadii(r[Z],s[Z],o[Z],u[Z],N);for(var le=0,re=N[le];re>=0;)Z<re&&W(Z,re),re=N[++le]}}(),console.timeEnd("AVSurface.projectTorii"),function(){for(var Z=0;Z<m.length;Z++)m[Z]<0&&(m[Z]=0)}(),function(){for(var Z=0;Z<y.length;Z++)y[Z]=t[y[Z]]}(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(j,te,ne,Z,le,re,se){return q(te,ne,le),new Nu(m,g[2],g[1],g[0],y).getSurface(te,!1,void 0,b,se)}}ri.add("line",rfe),Object.assign(Hx,{__deps:[w1,jV,Nu,_1,yH]}),Object.assign($x,{__deps:[w1,Nu,Lo,_1,$n,ro,Ti,xH,he]}),C0.add("molsurf",function(i,e){const t=i.data.args,n=i.data.params;if(t&&n){const r=new(n.type==="av"?$x:Hx)(t.coordList,t.radiusList,t.indexList).getSurface(n.type,n.probeRadius,n.scaleFactor,n.cutoff,!0,n.smooth,n.contour),s=[r.position.buffer,r.index.buffer];r.normal&&s.push(r.normal.buffer),r.atomindex&&s.push(r.atomindex.buffer),e({sd:r,p:n},s)}},[Hx,$x]);class sfe{constructor(e){this.structure=e}_getAtomData(e){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:he(e.radiusParams,{type:"vdw",scale:1})})}_makeSurface(e,t){var n=new t2(t.name,"",e);return n.info.type=t.type,n.info.probeRadius=t.probeRadius,n.info.scaleFactor=t.scaleFactor,n.info.smooth=t.smooth,n.info.cutoff=t.cutoff,n}getSurface(e){const t=e||{},n=this._getAtomData(e),r=n.position,s=n.radius,o=n.index,a=new(t.type==="av"?$x:Hx)(r,s,o).getSurface(t.type,t.probeRadius,t.scaleFactor,t.cutoff,!0,t.smooth,t.contour);return this._makeSurface(a,t)}getSurfaceWorker(e,t){const n=Object.assign({},e);if(window.hasOwnProperty("Worker")){this.worker===void 0&&(this.worker=new AV("molsurf"));const r=this._getAtomData(e),s=r.position,o=r.radius,a=r.index,l={args:{coordList:s,radiusList:o,indexList:a},params:n},c=[s.buffer,o.buffer,a.buffer];this.worker.post(l,c,u=>{t(this._makeSurface(u.data.sd,n))},u=>{console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",u),this.worker.terminate(),this.worker=void 0;const h=this.getSurface(n);t(h)})}else{const r=this.getSurface(n);t(r)}}dispose(){this.worker&&this.worker.terminate()}}class ofe extends qr{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add(()=>{this.__forceNewMolsurf=!0}),this.toBePrepared=!0,this.init(n)}init(e){const t=e||{};t.colorScheme=he(t.colorScheme,"uniform"),t.colorValue=he(t.colorValue,14540253),t.disablePicking=he(t.disablePicking,!0),this.surfaceType=he(t.surfaceType,"ms"),this.probeRadius=he(t.probeRadius,1.4),this.smooth=he(t.smooth,2),this.scaleFactor=he(t.scaleFactor,2),this.cutoff=he(t.cutoff,0),this.contour=he(t.contour,!1),this.background=he(t.background,!1),this.opaqueBack=he(t.opaqueBack,!0),this.filterSele=he(t.filterSele,""),this.colorVolume=he(t.colorVolume,void 0),this.useWorker=he(t.useWorker,!0),super.init(e)}prepareData(e,t,n){let r=this.__infoList[t];if(r||(r={},this.__infoList[t]=r),r.molsurf&&r.sele===e.selection.string)n(t);else{if(this.filterSele){const a=e.structure.getView(new ii(this.filterSele)),l=a.boundingBox.getSize(new me),c=Math.max(l.x,l.y,l.z),u=e.getAtomSetWithinPoint(a.center,c/2+6);if((e=e.getView(new ii(e.getAtomSetWithinSelection(u,3).toSeleString()))).atomCount===0)return void n(t)}r.sele=e.selection.string,r.molsurf=new sfe(e);const s=this.getSurfaceParams(),o=a=>{r.surface=a,n(t)};this.useWorker?r.molsurf.getSurfaceWorker(s,o):o(r.molsurf.getSurface(s))}}prepare(e){if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach(s=>{s&&s.molsurf&&s.molsurf.dispose()}),this.__infoList.length=0),this.structureView.atomCount===0)return void e();const t=()=>{this.__sele=this.selection.string,this.__surfaceParams=JSON.stringify(this.getSurfaceParams()),this.__forceNewMolsurf=!1,e()},n=this.assembly==="default"?this.defaultAssembly:this.assembly,r=this.structure.biomolDict[n];r?r.partList.forEach((s,o)=>{const a=s.getView(this.structureView);this.prepareData(a,o,l=>{l===r.partList.length-1&&t()})}):this.prepareData(this.structureView,0,t)}createData(e,t){const n=this.__infoList[t],r=n.surface;if(!r)return;const s={position:r.getPosition(),color:r.getColor(this.getColorParams()),index:r.getFilteredIndex(this.filterSele,e)},o=[];if(r.contour){const a=new YV(s,this.getBufferParams({wireframe:!1}));o.push(a)}else{Object.assign(s,{normal:r.getNormal(),picking:r.getPicking(e.getStructure())});const a=new XV(s,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if(this.getBufferParams().side=="double"){const l=new qV(a);o.push(l)}else o.push(a)}return{bufferList:o,info:n}}updateData(e,t){const n={};if(e.position||e.radius)return this.__forceNewMolsurf=!0,void this.build();e.color&&(n.color=t.info.surface.getColor(this.getColorParams())),e.index&&(n.index=t.info.surface.getFilteredIndex(this.filterSele,t.sview)),t.bufferList[0].setAttributes(n)}setParameters(e,t={},n){return e&&e.filterSele&&(t.index=!0),e&&e.colorVolume!==void 0&&(t.color=!0),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),this}getSurfaceParams(e={}){return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},e)}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}getAtomRadius(){return 0}clear(){super.clear()}dispose(){this.__infoList.forEach(e=>{e&&e.molsurf&&e.molsurf.dispose()}),this.__infoList.length=0,super.dispose()}}ri.add("surface",ofe);class afe extends qr{constructor(e,t,n){super(e,t,n),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.pointSize=he(t.pointSize,1),this.sizeAttenuation=he(t.sizeAttenuation,!0),this.sortParticles=he(t.sortParticles,!1),this.useTexture=he(t.useTexture,!1),this.alphaTest=he(t.alphaTest,.5),this.forceTransparent=he(t.forceTransparent,!1),this.edgeBleach=he(t.edgeBleach,0),super.init(t)}createData(e){var t=e.getAtomData(this.getAtomParams({position:!0,color:!0,picking:!0}));return{bufferList:[new R3(t,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),r={};e&&!e.position||Object.assign(r,{position:n.position}),e&&!e.color||Object.assign(r,{color:n.color}),t.bufferList[0].setAttributes(r)}getAtomRadius(){return .1}}ri.add("point",afe),Rn.add("shader/Ribbon.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
attribute vec3 dir;
attribute float size;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
transformed += normalize( dir ) * size;
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);const lfe=new Uint16Array([0,1,2,1,3,2]);function Vg(i){return 3*(4*(i.position.length/3-1))}class cfe extends Mc{constructor(e,t={}){super({position:new Float32Array(Vg(e)),color:new Float32Array(Vg(e)),index:El(Vg(e),Vg(e)/3),normal:new Float32Array(Vg(e)),picking:e.picking},t),this.vertexShader="Ribbon.vert";const n=e.position.length/3-1,r=4*n,s=3*r;this.addAttributes({dir:{type:"v3",value:new Float32Array(s)}}),this.addAttributes({size:{type:"f",value:new Float32Array(r)}}),e.primitiveId=km(n),this.setAttributes(e),this.makeIndex()}setAttributes(e={}){const t=this.size/4,n=this.geometry.attributes;let r,s,o,a,l,c,u,h,d,f,p,_,v,g,b,m,y,A,w;e.position&&(r=e.position,u=n.position.array,n.position.needsUpdate=!0),e.normal&&(s=e.normal,h=n.normal.array,n.normal.needsUpdate=!0),e.size&&(o=e.size,d=n.size.array,n.size.needsUpdate=!0),e.dir&&(a=e.dir,f=n.dir.array,n.dir.needsUpdate=!0),e.color&&(l=e.color,p=n.color.array,n.color.needsUpdate=!0),e.primitiveId&&(c=e.primitiveId,_=n.primitiveId.array,n.primitiveId.needsUpdate=!0);let M=o?o[0]:null;for(v=0;v<t;++v){for(A=3*v,b=3*v*4,y=4*v,r&&(u[b]=u[b+3]=r[A],u[b+1]=u[b+4]=r[A+1],u[b+2]=u[b+5]=r[A+2],u[b+6]=u[b+9]=r[A+3],u[b+7]=u[b+10]=r[A+4],u[b+8]=u[b+11]=r[A+5]),s&&(h[b]=h[b+3]=-s[A],h[b+1]=h[b+4]=-s[A+1],h[b+2]=h[b+5]=-s[A+2],h[b+6]=h[b+9]=-s[A+3],h[b+7]=h[b+10]=-s[A+4],h[b+8]=h[b+11]=-s[A+5]),g=0;g<4;++g)m=b+3*g,l&&(p[m]=l[A],p[m+1]=l[A+1],p[m+2]=l[A+2]),c&&(_[y+g]=c[v]);o&&(w=o[v],M!==o[v]?(d[y]=M,d[y+1]=M,d[y+2]=w,d[y+3]=w):(d[y]=w,d[y+1]=w,d[y+2]=w,d[y+3]=w),M=w),a&&(f[b]=a[A],f[b+1]=a[A+1],f[b+2]=a[A+2],f[b+3]=-a[A],f[b+4]=-a[A+1],f[b+5]=-a[A+2],f[b+6]=a[A+3],f[b+7]=a[A+4],f[b+8]=a[A+5],f[b+9]=-a[A+3],f[b+10]=-a[A+4],f[b+11]=-a[A+5])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void tt.error("Index is null");const t=e.array,n=t.length/4/3;for(let r=0;r<n;++r){const s=6*r,o=4*r;t.set(lfe,s);for(let a=0;a<6;++a)t[s+a]+=o}}}class ufe extends qr{constructor(e,t,n){super(e,t,n),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=he(t.colorScheme,"chainname"),t.colorScale=he(t.colorScale,"RdYlBu"),t.radiusType=he(t.radiusType,"sstruc"),t.radiusScale=he(t.radiusScale,4),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=he(t.subdiv,6),this.tension=he(t.tension,NaN),this.smoothSheet=he(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){var t=[],n=[];return this.structure.eachPolymer(r=>{if(!(r.residueCount<4)){n.push(r);var s=new xm(r,this.getSplineParams()),o=s.getSubdividedPosition(),a=s.getSubdividedOrientation(),l=s.getSubdividedColor(this.getColorParams()),c=s.getSubdividedPicking(),u=s.getSubdividedSize(this.getRadiusParams());t.push(new cfe({position:o.position,normal:a.binormal,dir:a.normal,color:l.color,size:u.size,picking:c.picking},this.getBufferParams()))}},e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,r=t.polymerList.length;for(n=0;n<r;++n){var s={},o=new xm(t.polymerList[n],this.getSplineParams());if(e.position){var a=o.getSubdividedPosition(),l=o.getSubdividedOrientation();Object.assign(s,{position:a.position,normal:l.binormal,dir:l.normal})}if(e.radius||e.scale){var c=o.getSubdividedSize(this.getRadiusParams());Object.assign(s,{size:c.size})}if(e.color){var u=o.getSubdividedColor(this.getColorParams());Object.assign(s,{color:u.color})}t.bufferList[n].setAttributes(s)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}ri.add("ribbon",ufe);class hfe extends qr{constructor(e,t,n){super(e,t,n),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){let t=e||{};t.colorScheme=he(t.colorScheme,"sstruc"),t.radiusSize=he(t.radiusSize,1.5),t.radiusScale=he(t.radiusScale,1),t.openEnded=he(t.openEnded,!1),t.useInteriorColor=he(t.useInteriorColor,!0),this.localAngle=he(t.localAngle,30),this.centerDist=he(t.centerDist,2.5),this.ssBorder=he(t.ssBorder,!1),super.init(t)}createData(e){let t=0;const n=[],r=[];this.structure.eachPolymer(l=>{if(l.residueCount<4||l.isNucleic())return;const c=new JV(l),u=c.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());t+=u.size.length,n.push(u),r.push(c)},e.getSelection());const s={begin:new Float32Array(3*t),end:new Float32Array(3*t),size:new Float32Array(t),color:new Float32Array(3*t),picking:{}};let o=new Float32Array(t),a=0;return n.forEach(function(l){s.begin.set(l.begin,3*a),s.end.set(l.end,3*a),s.size.set(l.size,a),s.color.set(l.color,3*a),o.set(l.picking.array,a),a+=l.size.length}),t&&(s.picking=new Hd(o,e.getStructure())),{bufferList:[new Pc({position1:s.begin,position2:s.end,color:s.color,color2:s.color,radius:s.size,picking:s.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:n,helixbundleList:r,axisData:s}}updateData(e,t){if((e=e||{}).position)this.build();else{var n={};if(e.color||e.radius){var r=0;t.helixbundleList.forEach(s=>{var o=s.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());e.color&&t.axisData.color.set(o.color,3*r),(e.radius||e.scale)&&t.axisData.size.set(o.size,r),r+=o.size.length}),e.color&&Object.assign(n,{color:t.axisData.color,color2:t.axisData.color}),(e.radius||e.scale)&&Object.assign(n,{radius:t.axisData.size})}t.bufferList[0].setAttributes(n)}}}ri.add("rocket",hfe);class dfe extends F3{constructor(e,t,n){super(e,t,n),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}init(e){var t=e||{};t.aspectRatio=1,t.tension=he(t.tension,.5),t.radiusScale=he(t.radiusScale,5),t.smoothSheet=!1,this.smooth=he(t.smooth,2),super.init(t)}getSpline(e){var t=new kb(e);return new xm(e,this.getSplineParams({directional:!1,positionIterator:t.getCenterIterator(this.smooth)}))}}ri.add("rope",dfe);class ffe extends qr{constructor(e,t,n){super(e,t,n),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.useInteriorColor=he(t.useInteriorColor,!0),super.init(t)}createData(e){return{bufferList:[new eh(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),r={};e&&!e.position||Object.assign(r,{position:n.position}),e&&!e.color||Object.assign(r,{color:n.color}),e&&!e.radius||Object.assign(r,{radius:n.radius}),t.bufferList[0].setAttributes(r)}}function Q4(i){return 3*(i.position.length/3-1)*2}ri.add("spacefill",ffe);class pfe extends Tl{constructor(e,t={}){super({position:new Float32Array(Q4(e)),color:new Float32Array(Q4(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(e)}setAttributes(e){let t,n,r,s;const o=this.geometry.attributes;if(e.position&&(t=e.position,r=o.position.array,o.position.needsUpdate=!0),e.color&&(n=e.color,s=o.color.array,o.color.needsUpdate=!0),!t&&!n)return void tt.warn("TraceBuffer.prototype.setAttributes no data");let a,l;const c=this.size-1;for(let u=0;u<c;++u)a=3*u,l=3*u*2,t&&(r[l]=t[a],r[l+1]=t[a+1],r[l+2]=t[a+2],r[l+3]=t[a+3],r[l+4]=t[a+4],r[l+5]=t[a+5]),n&&(s[l]=n[a],s[l+1]=n[a+1],s[l+2]=n[a+2],s[l+3]=n[a+3],s[l+4]=n[a+4],s[l+5]=n[a+5])}}class mfe extends qr{constructor(e,t,n){super(e,t,n),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=he(t.colorScheme,"chainname"),t.colorScale=he(t.colorScale,"RdYlBu"),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=he(t.subdiv,6),this.tension=he(t.tension,NaN),this.smoothSheet=he(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?.1:0}createData(e){var t=[],n=[];return this.structure.eachPolymer(r=>{if(!(r.residueCount<4)){n.push(r);var s=new xm(r,this.getSplineParams()),o=s.getSubdividedPosition(),a=s.getSubdividedColor(this.getColorParams());t.push(new pfe(Object.assign({},o,a),this.getBufferParams()))}},e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,r=t.polymerList.length;for(n=0;n<r;++n){var s={},o=new xm(t.polymerList[n],this.getSplineParams());if(e.position){var a=o.getSubdividedPosition();Object.assign(s,{position:a.position})}if(e.color){var l=o.getSubdividedColor(this.getColorParams());Object.assign(s,{color:l.color})}t.bufferList[n].setAttributes(s)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}ri.add("trace",mfe);class gfe extends F3{constructor(e,t,n){super(e,t,n),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,t.radiusScale=he(t.radiusScale,2),t.quality==="low"&&(this.radialSegments=5),super.init(t)}getSplineParams(){return super.getSplineParams({directional:!1})}}ri.add("tube",gfe);class vfe extends qr{constructor(e,t,n){super(e,t,n),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};let n=.5;this.structure.unitcell&&(n=Math.cbrt(this.structure.unitcell.volume)/200),t.radiusSize=he(t.radiusSize,n),t.colorValue=he(t.colorValue,"orange"),t.useInteriorColor=he(t.useInteriorColor,!0),super.init(t)}getUnitcellData(e){return e.unitcell.getData(e)}create(){const e=this.structureView.getStructure();if(!e.unitcell)return;const t=this.getUnitcellData(e);this.sphereBuffer=new eh(t.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new Pc(t.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=t.sview.getStructure();if(!n.unitcell)return;const r=this.getUnitcellData(n),s={},o={};e&&!e.position||(Object.assign(s,{position:r.vertex.position}),Object.assign(o,{position1:r.edge.position1,position2:r.edge.position2})),e&&!e.color||(Object.assign(s,{color:r.vertex.color}),Object.assign(o,{color:r.edge.color,color2:r.edge.color2})),e&&!e.radius||(Object.assign(s,{radius:r.vertex.radius}),Object.assign(o,{radius:r.edge.radius})),this.sphereBuffer.setAttributes(s),this.cylinderBuffer.setAttributes(o)}}ri.add("unitcell",vfe);class _fe extends qr{constructor(e,t,n){super(e,t,n),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(n)}init(e){const t=e||{};t.colorValue=he(t.colorValue,"#f0027f"),t.useInteriorColor=he(t.useInteriorColor,!0),super.init(t)}createData(e){if(!e.validation)return;const t=e.validation.getClashData({structure:e,color:this.colorValue});return{bufferList:[new Pc(t,this.getBufferParams({openEnded:!1}))]}}}ri.add("validation",_fe);const J4=new me,NA=new me,FA=new me,yfe=new me(0,1,0),xfe=Object.assign({radialSegments:60,openEnded:!1},Os);class bH extends Ju{constructor(e,t={}){super({position:new Float32Array(e.position1.length),color:e.color,picking:e.picking},t,function(n={}){const r=new c3(1,1,he(n.radialSegments,60),1,he(n.openEnded,!1));return r.applyMatrix4(new Ct().makeRotationX(-Math.PI/2)),r}(t)),this.updateNormals=!0,this._position=new Float32Array(e.position1.length),this.setAttributes(e,!0)}get defaultParameters(){return xfe}applyPositionTransform(e,t,n){NA.fromArray(this._position1,n),FA.fromArray(this._position2,n),e.lookAt(NA,FA,yfe);const r=this._radius[t];J4.set(r,r,NA.distanceTo(FA)),e.scale(J4)}setAttributes(e={},t){e.position1&&e.position2&&(yl(e.position1,e.position2,this._position),this._position1=e.position1,this._position2=e.position2,e.position=this._position),e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}Fo.add("cone",bH);class bfe{constructor(e=[]){this.geometryList=e}computeBoundingBox(){this.boundingBox?this.boundingBox.empty():this.boundingBox=new Li,this.geometryList.forEach(e=>{e.boundingBox||e.computeBoundingBox(),this.boundingBox.union(e.boundingBox)})}}const Sfe=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},Os);class wfe{constructor(e,t={}){this.group=new Zn,this.wireframeGroup=new Zn,this.pickingGroup=new Zn,this.visible=!0,this.parameters=Io(t,this.defaultParameters),this.splitPosition=new Float32Array(e.position1.length),this.cylinderRadius=new Float32Array(e.radius.length);const n=this.makeAttributes(e),r={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new Pc(n.cylinder,r),this.coneBuffer=new bH(n.cone,r),this.geometry=new bfe([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=he(t.matrix,new Ct),this.picking=e.picking}get defaultParameters(){return Sfe}set matrix(e){Tl.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking}makeAttributes(e={}){const t=this.splitPosition,n=this.cylinderRadius,r=this.parameters.aspectRatio;let s,o;const a={},l={};if(e.radius){for(s=0,o=n.length;s<o;++s)n[s]=e.radius[s]/r;a.radius=n,l.radius=e.radius}if(e.position1&&e.position2){const c=new me,u=new me,h=new me,d=new me;for(s=0,o=t.length;s<o;s+=3){c.fromArray(e.position1,s),u.fromArray(e.position2,s),h.subVectors(c,u);const f=h.length(),p=n[s/3]*r*2,_=Math.min(f,p);h.setLength(_),d.copy(u).add(h),d.toArray(t,s)}a.position1=e.position1,a.position2=t,l.position1=t,l.position2=e.position2}return e.color&&(a.color=e.color,a.color2=e.color,l.color=e.color),{cylinder:a,cone:l}}getMesh(){return new Zn().add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())}getWireframeMesh(){return new Zn().add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())}getPickingMesh(){return new Zn().add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())}setAttributes(e={}){const t=this.makeAttributes(e);this.cylinderBuffer.setAttributes(t.cylinder),this.coneBuffer.setAttributes(t.cone)}setParameters(e={}){(e=Object.assign({},e))&&e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,e&&e.wireframe!==void 0&&(this.parameters.wireframe=e.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(e),this.coneBuffer.setParameters(e)}setVisibility(e){Tl.prototype.setVisibility.call(this,e)}dispose(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()}}Fo.add("arrow",wfe);const eO=new me,kA=new me,UA=new me,Mfe=new me(0,0,0);class Afe extends Ju{constructor(e,t={}){super(e,t,new Dm(1,1,1)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){kA.fromArray(this._heightAxis,n),UA.fromArray(this._depthAxis,n),e.lookAt(Mfe,kA,UA),eO.set(this._size[t],UA.length(),kA.length()),e.scale(eO)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}Fo.add("box",Afe);const tO=new me,OA=new me,BA=new me,Efe=new me(0,0,0),Tfe=Object.assign({sphereDetail:2},Os);class Cfe extends Ju{constructor(e,t={}){super(e,t,new WS(1,he(t.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return Tfe}applyPositionTransform(e,t,n){OA.fromArray(this._majorAxis,n),BA.fromArray(this._minorAxis,n),e.lookAt(Efe,OA,BA),tO.set(this._radius[t],BA.length(),OA.length()),e.scale(tO)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}Fo.add("ellipsoid",Cfe);const nO=new me,zA=new me,GA=new me,Pfe=new me(0,0,0);class Rfe extends Ju{constructor(e,t={}){super(e,t,new u3(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){zA.fromArray(this._heightAxis,n),GA.fromArray(this._depthAxis,n),e.lookAt(Pfe,zA,GA),nO.set(this._size[t],GA.length(),zA.length()),e.scale(nO)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}Fo.add("octahedron",Rfe);const iO=new me,VA=new me,HA=new me,Ife=new me(0,0,0);class Lfe extends Ju{constructor(e,t={}){super(e,t,new h3(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){VA.fromArray(this._heightAxis,n),HA.fromArray(this._depthAxis,n),e.lookAt(Ife,VA,HA),iO.set(this._size[t],HA.length(),VA.length()),e.scale(iO)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}Fo.add("tetrahedron",Lfe);const rO=new me,sO=new me,oO=new me,Dfe=new me(0,0,0),Nfe=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},Os);class Ffe extends Ju{constructor(e,t={}){super(e,t,new d3(1,he(t.radiusRatio,.2),he(t.radialSegments,16),he(t.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return Nfe}applyPositionTransform(e,t,n){sO.fromArray(this._majorAxis,n),oO.fromArray(this._minorAxis,n),e.lookAt(Dfe,sO,oO);const r=this._radius[t];rO.set(r,r,r),e.scale(rO)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}function Cp(i,e){return{start:e&&e.start!==void 0?Math.max(Math.min(e.start,i-1),0):0,end:e&&e.end!==void 0?Math.min(e.end,i):i}}function Z1(i,e){const t=e&&e.array!==void 0?e.array:Array,{start:n,end:r}=Cp(i,e);return{array:new t(r-n),start:n,end:r}}function as(i,e,t){const{array:n,start:r}=Z1(i,t);return function(s,o,a){for(let l=0,c=o.length;l<c;l++)o[l]=s(a+l);return o}(e,n,r)}function k3(i){return!!i.buffer&&typeof i.byteLength=="number"&&typeof i.BYTES_PER_ELEMENT=="number"}function Bb(i,e){const{constructor:t,buffer:n,length:r,byteOffset:s,BYTES_PER_ELEMENT:o}=i,{start:a,end:l}=Cp(r,e);return a===0&&l===r?i:new t(n,s+o*a,Math.min(r,l-a))}Fo.add("torus",Ffe);const Ui=1e-6;function zr(i,e,t){return Math.abs(i-e)<=t}function aO(i,e,t){return Math.max(e,Math.min(t,i))}function $A(i,e,t,n,r,s){const o=(t-i)*s,a=(n-e)*s,l=r*r;return(2*e-2*t+o+a)*(r*l)+(-3*e+3*t-2*o-a)*l+o*r+e}function WA(i,e,t,n){const r=1-n;return r*r*i+2*r*n*e+n*n*t}const jA=isFinite;function Un(){return Un.zero()}(function(i){function e(){const P=[.1,0,0];return P[0]=0,P}function t(P,L,R){const F=e();return F[0]=P,F[1]=L,F[2]=R,F}function n(P,L){return P[0]=L[0],P[1]=L[1],P[2]=L[2],P}function r(P,L,R){return P[0]=L[0]+R[0],P[1]=L[1]+R[1],P[2]=L[2]+R[2],P}function s(P,L,R){return P[0]=L[0]-R[0],P[1]=L[1]-R[1],P[2]=L[2]-R[2],P}function o(P,L,R){return P[0]=L[0]*R,P[1]=L[1]*R,P[2]=L[2]*R,P}function a(P,L,R,F){return P[0]=L[0]+R[0]*F,P[1]=L[1]+R[1]*F,P[2]=L[2]+R[2]*F,P}function l(P){const L=P[0],R=P[1],F=P[2];return L*L+R*R+F*F}function c(P,L){return P[0]=-L[0],P[1]=-L[1],P[2]=-L[2],P}function u(P,L){const R=L[0],F=L[1],V=L[2];let G=R*R+F*F+V*V;return G>0&&(G=1/Math.sqrt(G),P[0]=L[0]*G,P[1]=L[1]*G,P[2]=L[2]*G),P}function h(P,L){return P[0]*L[0]+P[1]*L[1]+P[2]*L[2]}function d(P,L,R){const F=L[0],V=L[1],G=L[2],U=R[0],z=R[1],O=R[2];return P[0]=V*O-G*z,P[1]=G*U-F*O,P[2]=F*z-V*U,P}i.zero=e,i.clone=function(P){const L=e();return L[0]=P[0],L[1]=P[1],L[2]=P[2],L},i.isFinite=function(P){return jA(P[0])&&jA(P[1])&&jA(P[2])},i.hasNaN=function(P){return isNaN(P[0])||isNaN(P[1])||isNaN(P[2])},i.setNaN=function(P){return P[0]=NaN,P[1]=NaN,P[2]=NaN,P},i.fromObj=function(P){return t(P.x,P.y,P.z)},i.toObj=function(P){return{x:P[0],y:P[1],z:P[2]}},i.fromArray=function(P,L,R){return P[0]=L[R+0],P[1]=L[R+1],P[2]=L[R+2],P},i.toArray=function(P,L,R){return L[R+0]=P[0],L[R+1]=P[1],L[R+2]=P[2],L},i.create=t,i.ofArray=function(P){const L=e();return L[0]=P[0],L[1]=P[1],L[2]=P[2],L},i.set=function(P,L,R,F){return P[0]=L,P[1]=R,P[2]=F,P},i.copy=n,i.add=r,i.sub=s,i.mul=function(P,L,R){return P[0]=L[0]*R[0],P[1]=L[1]*R[1],P[2]=L[2]*R[2],P},i.div=function(P,L,R){return P[0]=L[0]/R[0],P[1]=L[1]/R[1],P[2]=L[2]/R[2],P},i.scale=o,i.scaleAndAdd=a,i.scaleAndSub=function(P,L,R,F){return P[0]=L[0]-R[0]*F,P[1]=L[1]-R[1]*F,P[2]=L[2]-R[2]*F,P},i.addScalar=function(P,L,R){return P[0]=L[0]+R,P[1]=L[1]+R,P[2]=L[2]+R,P},i.subScalar=function(P,L,R){return P[0]=L[0]-R,P[1]=L[1]-R,P[2]=L[2]-R,P},i.round=function(P,L){return P[0]=Math.round(L[0]),P[1]=Math.round(L[1]),P[2]=Math.round(L[2]),P},i.ceil=function(P,L){return P[0]=Math.ceil(L[0]),P[1]=Math.ceil(L[1]),P[2]=Math.ceil(L[2]),P},i.floor=function(P,L){return P[0]=Math.floor(L[0]),P[1]=Math.floor(L[1]),P[2]=Math.floor(L[2]),P},i.trunc=function(P,L){return P[0]=Math.trunc(L[0]),P[1]=Math.trunc(L[1]),P[2]=Math.trunc(L[2]),P},i.abs=function(P,L){return P[0]=Math.abs(L[0]),P[1]=Math.abs(L[1]),P[2]=Math.abs(L[2]),P},i.min=function(P,L,R){return P[0]=Math.min(L[0],R[0]),P[1]=Math.min(L[1],R[1]),P[2]=Math.min(L[2],R[2]),P},i.max=function(P,L,R){return P[0]=Math.max(L[0],R[0]),P[1]=Math.max(L[1],R[1]),P[2]=Math.max(L[2],R[2]),P},i.clamp=function(P,L,R,F){return P[0]=Math.max(R[0],Math.min(F[0],L[0])),P[1]=Math.max(R[1],Math.min(F[1],L[1])),P[2]=Math.max(R[2],Math.min(F[2],L[2])),P},i.distance=function(P,L){const R=L[0]-P[0],F=L[1]-P[1],V=L[2]-P[2];return Math.sqrt(R*R+F*F+V*V)},i.squaredDistance=function(P,L){const R=L[0]-P[0],F=L[1]-P[1],V=L[2]-P[2];return R*R+F*F+V*V},i.magnitude=function(P){const L=P[0],R=P[1],F=P[2];return Math.sqrt(L*L+R*R+F*F)},i.squaredMagnitude=l,i.setMagnitude=function(P,L,R){return o(P,u(P,L),R)},i.negate=c,i.inverse=function(P,L){return P[0]=1/L[0],P[1]=1/L[1],P[2]=1/L[2],P},i.normalize=u,i.dot=h,i.cross=d,i.lerp=function(P,L,R,F){const V=L[0],G=L[1],U=L[2];return P[0]=V+F*(R[0]-V),P[1]=G+F*(R[1]-G),P[2]=U+F*(R[2]-U),P};const f=e();function p(P,L){const R=Math.sqrt(l(P)*l(L));if(R===0)return Math.PI/2;const F=h(P,L)/R;return Math.acos(aO(F,-1,1))}i.slerp=function(P,L,R,F){const V=aO(h(L,R),-1,1),G=Math.acos(V)*F;return a(f,R,L,-V),u(f,f),r(P,o(P,L,Math.cos(G)),o(f,f,Math.sin(G)))},i.hermite=function(P,L,R,F,V,G){const U=G*G,z=U*(2*G-3)+1,O=U*(G-2)+G,D=U*(G-1),B=U*(3-2*G);return P[0]=L[0]*z+R[0]*O+F[0]*D+V[0]*B,P[1]=L[1]*z+R[1]*O+F[1]*D+V[1]*B,P[2]=L[2]*z+R[2]*O+F[2]*D+V[2]*B,P},i.bezier=function(P,L,R,F,V,G){const U=1-G,z=U*U,O=G*G,D=z*U,B=3*G*z,W=3*O*U,q=O*G;return P[0]=L[0]*D+R[0]*B+F[0]*W+V[0]*q,P[1]=L[1]*D+R[1]*B+F[1]*W+V[1]*q,P[2]=L[2]*D+R[2]*B+F[2]*W+V[2]*q,P},i.quadraticBezier=function(P,L,R,F,V){return P[0]=WA(L[0],R[0],F[0],V),P[1]=WA(L[1],R[1],F[1],V),P[2]=WA(L[2],R[2],F[2],V),P},i.spline=function(P,L,R,F,V,G,U){return P[0]=$A(L[0],R[0],F[0],V[0],G,U),P[1]=$A(L[1],R[1],F[1],V[1],G,U),P[2]=$A(L[2],R[2],F[2],V[2],G,U),P},i.random=function(P,L){const R=2*Math.random()*Math.PI,F=2*Math.random()-1,V=Math.sqrt(1-F*F)*L;return P[0]=Math.cos(R)*V,P[1]=Math.sin(R)*V,P[2]=F*L,P},i.transformMat4=function(P,L,R){const F=L[0],V=L[1],G=L[2],U=1/(R[3]*F+R[7]*V+R[11]*G+R[15]||1);return P[0]=(R[0]*F+R[4]*V+R[8]*G+R[12])*U,P[1]=(R[1]*F+R[5]*V+R[9]*G+R[13])*U,P[2]=(R[2]*F+R[6]*V+R[10]*G+R[14])*U,P},i.transformDirection=function(P,L,R){const F=L[0],V=L[1],G=L[2];return P[0]=R[0]*F+R[4]*V+R[8]*G,P[1]=R[1]*F+R[5]*V+R[9]*G,P[2]=R[2]*F+R[6]*V+R[10]*G,u(P,P)},i.transformMat4Offset=function(P,L,R,F,V,G){const U=L[0+V],z=L[1+V],O=L[2+V],D=1/(R[3+G]*U+R[7+G]*z+R[11+G]*O+R[15+G]||1);return P[0+F]=(R[0+G]*U+R[4+G]*z+R[8+G]*O+R[12+G])*D,P[1+F]=(R[1+G]*U+R[5+G]*z+R[9+G]*O+R[13+G])*D,P[2+F]=(R[2+G]*U+R[6+G]*z+R[10+G]*O+R[14+G])*D,P},i.transformDirectionOffset=function(P,L,R,F,V,G){const U=L[0+V],z=L[1+V],O=L[2+V];P[0+F]=R[0+G]*U+R[4+G]*z+R[8+G]*O,P[1+F]=R[1+G]*U+R[5+G]*z+R[9+G]*O,P[2+F]=R[2+G]*U+R[6+G]*z+R[10+G]*O;const D=Math.hypot(P[0+F],P[1+F],P[2+F]);return D>0&&(P[0+F]/=D,P[1+F]/=D,P[2+F]/=D),P},i.transformMat3=function(P,L,R){const F=L[0],V=L[1],G=L[2];return P[0]=F*R[0]+V*R[3]+G*R[6],P[1]=F*R[1]+V*R[4]+G*R[7],P[2]=F*R[2]+V*R[5]+G*R[8],P},i.transformQuat=function(P,L,R){const F=L[0],V=L[1],G=L[2],U=R[0],z=R[1],O=R[2],D=R[3],B=D*F+z*G-O*V,W=D*V+O*F-U*G,q=D*G+U*V-z*F,j=-U*F-z*V-O*G;return P[0]=B*D+j*-U+W*-O-q*-z,P[1]=W*D+j*-z+q*-U-B*-O,P[2]=q*D+j*-O+B*-z-W*-U,P},i.angle=p;const _=e(),v=e(),g=e(),b=e(),m=e(),y=e(),A=e();i.dihedralAngle=function(P,L,R,F){s(_,P,L),s(v,R,L),s(g,L,R),s(b,F,R),d(m,_,v),d(y,g,b);const V=p(m,y);return d(A,m,y),h(v,A)>0?V:-V},i.directionFromSpherical=function(P,L,R,F){return i.set(P,F*Math.cos(R)*Math.sin(L),F*Math.sin(R)*Math.sin(L),F*Math.cos(L))},i.exactEquals=function(P,L){return P[0]===L[0]&&P[1]===L[1]&&P[2]===L[2]},i.equals=function(P,L){const R=P[0],F=P[1],V=P[2],G=L[0],U=L[1],z=L[2];return Math.abs(R-G)<=Ui*Math.max(1,Math.abs(R),Math.abs(G))&&Math.abs(F-U)<=Ui*Math.max(1,Math.abs(F),Math.abs(U))&&Math.abs(V-z)<=Ui*Math.max(1,Math.abs(V),Math.abs(z))};const w=e();i.makeRotation=function(P,L,R){const F=p(L,R);if(Math.abs(F)<1e-4)return _u.setIdentity(P);if(Math.abs(F-Math.PI)<Ui)return _u.fromScaling(P,i.negUnit);const V=d(w,L,R);return _u.fromRotation(P,F,V)},i.isZero=function(P){return P[0]===0&&P[1]===0&&P[2]===0},i.projectPointOnVector=function(P,L,R,F){return s(P,L,F),r(P,o(P,R,h(R,P)/l(R)),F)};const M=e();function T(P,L,R){return o(P,R,h(R,L)/l(R))}i.projectPointOnPlane=function(P,L,R,F){return u(M,R),s(P,L,F),s(P,L,o(M,M,h(P,M)))},i.projectOnVector=T;const E=e();i.projectOnPlane=function(P,L,R){return T(E,L,R),s(P,L,E)},i.orthogonalize=function(P,L,R){return u(P,d(P,d(P,L,R),L))},i.matchDirection=function(P,L,R){return h(L,R)>0?n(P,L):c(P,n(P,L)),P};const C=e(),N=e();i.triangleNormal=function(P,L,R,F){return s(C,R,L),s(N,F,L),u(P,d(P,C,N))},i.toString=function(P,L){return`[${P[0].toPrecision(L)} ${P[1].toPrecision(L)} ${P[2].toPrecision(L)}]`},i.origin=t(0,0,0),i.unit=t(1,1,1),i.negUnit=t(-1,-1,-1),i.unitX=t(1,0,0),i.unitY=t(0,1,0),i.unitZ=t(0,0,1),i.negUnitX=t(-1,0,0),i.negUnitY=t(0,-1,0),i.negUnitZ=t(0,0,-1)})(Un||(Un={}));const kfe=Math.PI/180;function Dh(i){return i*kfe}function _u(){return _u.zero()}function Wx(){return Wx.zero()}function VC(){return VC.zero()}function HC(){return HC.zero()}function zb(i){throw new Error("unreachable")}function $C(){return $C.zero()}var a0,li,lO,Es;function $p(i,e,t){let n=e,r=0,s=1;for(i.charCodeAt(n)===45?(s=-1,++n):i.charCodeAt(n)===43&&++n;n<t;n++){const o=i.charCodeAt(n)-48;if(o>9||o<0)return s*r|0;r=10*r+o|0}return s*r}function cO(i,e,t,n){return e.charCodeAt(t)===43&&t++,i*Math.pow(10,$p(e,t,n))}function I0(i,e,t){let n=e,r=1,s=0,o=0,a=1;for(i.charCodeAt(n)===45?(r=-1,++n):i.charCodeAt(n)===43&&++n;n<t;){let l=i.charCodeAt(n)-48;if(!(l>=0&&l<10)){if(l===-2){for(++n;n<t;){if(l=i.charCodeAt(n)-48,!(l>=0&&l<10))return l===53||l===21?cO(r*(s+o/a),i,n+1,t):r*(s+o/a);o=10*o+l,a*=10,++n}return r*(s+o/a)}if(l===53||l===21)return cO(r*s,i,n+1,t);break}s=10*s+l,++n}return r*s}function uO(i,e,t,n){return{schema:t,__array:void 0,isDefined:n===0,rowCount:e,value:r=>i,valueKind:r=>n,toArray:r=>{const{array:s}=Z1(e,r);for(let o=0,a=s.length;o<a;o++)s[o]=i;return s},areValuesEqual:(r,s)=>!0}}function Hy({value:i,valueKind:e,areValuesEqual:t,rowCount:n,schema:r}){return{schema:r,__array:void 0,isDefined:!0,rowCount:n,value:i,valueKind:e||(s=>0),toArray:s=>{const{array:o,start:a}=Z1(n,s);for(let l=0,c=o.length;l<c;l++)o[l]=i(l+a);return o},areValuesEqual:t||((s,o)=>i(s)===i(o))}}function nc({array:i,schema:e,valueKind:t}){const n=i.length,r=e.T,s=e.valueType==="str"?e.transform==="lowercase"?a=>{const l=i[a];return typeof l=="string"?l.toLowerCase():`${l??r}`.toLowerCase()}:e.transform==="uppercase"?a=>{const l=i[a];return typeof l=="string"?l.toUpperCase():`${l??r}`.toUpperCase()}:a=>{const l=i[a];return typeof l=="string"?l:`${l??r}`}:a=>i[a],o=k3(i);return{schema:e,__array:i,isDefined:!0,rowCount:n,value:s,valueKind:t||(a=>0),toArray:e.valueType==="str"?e.transform==="lowercase"?a=>{const{start:l,end:c}=Cp(n,a),u=new(a&&a.array!==void 0?a.array:i.constructor)(c-l);for(let h=0,d=c-l;h<d;h++){const f=i[l+h];u[h]=typeof f=="string"?f.toLowerCase():`${f??r}`.toLowerCase()}return u}:e.transform==="uppercase"?a=>{const{start:l,end:c}=Cp(n,a),u=new(a&&a.array!==void 0?a.array:i.constructor)(c-l);for(let h=0,d=c-l;h<d;h++){const f=i[l+h];u[h]=typeof f=="string"?f.toUpperCase():`${f??r}`.toUpperCase()}return u}:a=>{const{start:l,end:c}=Cp(n,a),u=new(a&&a.array!==void 0?a.array:i.constructor)(c-l);for(let h=0,d=c-l;h<d;h++){const f=i[l+h];u[h]=typeof f=="string"?f:`${f??r}`}return u}:o?a=>Bb(i,a):a=>{const{start:l,end:c}=Cp(n,a);if(l===0&&c===i.length)return i;const u=new(a&&a.array!==void 0?a.array:i.constructor)(c-l);for(let h=0,d=c-l;h<d;h++)u[h]=i[l+h];return u},areValuesEqual:(a,l)=>i[a]===i[l]}}function Ufe(i,e,t){return i.isDefined?e===0&&t===i.rowCount?i:i.__array&&k3(i.__array)?function(n,r,s){const o=Bb(n.__array,{start:r,end:s}),a=n.valueKind;return nc({array:o,schema:n.schema,valueKind:l=>a(r+l)})}(i,e,t):function(n,r,s){const o=n.value,a=n.valueKind,l=n.areValuesEqual,c=r===0?o:h=>o(h+r),u=s-r;return{schema:n.schema,__array:void 0,isDefined:n.isDefined,rowCount:u,value:c,valueKind:r===0?a:h=>a(h+r),toArray:h=>{const{array:d}=Z1(u,h);for(let f=0,p=d.length;f<p;f++)d[f]=o(f+r);return d},areValuesEqual:r===0?l:(h,d)=>l(h+r,d+r)}}(i,e,t):li.Undefined(t-e,i.schema)}function Ofe(i,e,t){return i.rowCount===0||t&&function(n,r){if(n.length!==r)return!1;for(let s=0,o=n.length;s<o;s++)if(n[s]!==s)return!1;return!0}(e,i.rowCount)?i:i.__array&&typeof i.value(0)==typeof i.__array[0]?function(n,r){const s=n.__array,o=new s.constructor(r.length);for(let l=0,c=r.length;l<c;l++)o[l]=s[r[l]];const a=n.valueKind;return nc({array:o,schema:n.schema,valueKind:l=>a(r[l])})}(i,e):function(n,r){const s=n.value,o=n.valueKind,a=n.areValuesEqual,l=u=>s(r[u]),c=r.length;return{schema:n.schema,__array:void 0,isDefined:n.isDefined,rowCount:c,value:l,valueKind:u=>o(r[u]),toArray:u=>{const{array:h}=Z1(c,u);for(let d=0,f=h.length;d<f;d++)h[d]=s(r[d]);return h},areValuesEqual:(u,h)=>a(r[u],r[h])}}(i,e)}function jx(i,e,t){return i[e]-i[t]}function l0(i,e,t){const n=i[e];i[e]=i[t],i[t]=n}function SH(i,e,t,n){const r=t+n>>1;return e(i,t,n)>0?e(i,t,r)>0?e(i,r,n)>0?r:n:t:e(i,n,r)>0?e(i,r,t)>0?r:t:n}function Bfe(i,e,t){const{cmp:n,swap:r,data:s,parts:o}=i;let a=e+1,l=t;for(r(s,e,SH(s,n,e,t));n(s,l,e)>0;)--l;for(let c=e+1;c<=l;c++){const u=n(s,c,e);if(u>0){for(r(s,c,l),--l;n(s,l,e)>0;)--l;c--}else u===0&&(r(s,c,a),a++)}for(let c=e;c<a;c++)r(s,c,e+l-c);o[0]=l-a+e+1,o[1]=l}function zfe({data:i,cmp:e,swap:t},n,r){for(let s=n+1;s<=r;s++){let o=s-1;for(;o>=n&&e(i,o,o+1)>0;)t(i,o,o+1),o-=1}}function WC(i,e,t){const{parts:n}=i;for(;e<t;){if(t-e<16)return void zfe(i,e,t);Bfe(i,e,t);const r=n[0],s=n[1];r-e<t-s?(WC(i,e,r-1),e=s+1):(WC(i,s+1,t),t=r-1)}}function Gfe(i,e,t,n){let r=t+1,s=n;l0(i,t,SH(i,jx,t,n));const o=i[t];for(;i[s]>o;)--s;for(let a=t+1;a<=s;a++){const l=i[a];if(l>o){for(l0(i,a,s),--s;i[s]>o;)--s;a--}else l===o&&(l0(i,a,r),++r)}for(let a=t;a<r;a++)l0(i,a,t+s-a);e[0]=s-r+t+1,e[1]=s}function Vfe(i,e,t){for(let n=e+1;n<=t;n++){const r=i[n];let s=n-1;for(;s>=e&&i[s]>r;)i[s+1]=i[s],s-=1;i[s+1]=r}}function jC(i,e,t,n){for(;t<n;){if(n-t<16)return void Vfe(i,t,n);Gfe(i,e,t,n);const r=e[0],s=e[1];r-t<n-s?(jC(i,e,t,r-1),t=s+1):(jC(i,e,s+1,n),n=r-1)}}function Hfe(i,e=jx){return function(t,n,r,s=jx){return s===jx?jC(t,[0,0],n,r-1):WC({data:t,cmp:s,swap:l0,parts:[0,0]},n,r-1),t}(i,0,i.length,e)}(function(i){function e(){const m=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return m[0]=0,m}function t(){const m=e();return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function n(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function r(m){for(let y=0;y<16;y++)m[y]=0;return m}i.zero=e,i.identity=t,i.setIdentity=n,i.setZero=r,i.ofRows=function(m){const y=e();for(let A=0;A<4;A++){const w=m[A];for(let M=0;M<4;M++)y[4*M+A]=w[M]}return y};const s=t();function o(m,y,A){for(let w=0;w<16;w++)if(Math.abs(m[w]-y[w])>A)return!1;return!0}function a(m,y,A,w){m[4*A+y]=w}function l(m,y){return m[0]=y[0],m[1]=y[1],m[2]=y[2],m[3]=y[3],m[4]=y[4],m[5]=y[5],m[6]=y[6],m[7]=y[7],m[8]=y[8],m[9]=y[9],m[10]=y[10],m[11]=y[11],m[12]=y[12],m[13]=y[13],m[14]=y[14],m[15]=y[15],m}function c(m,y){const A=y[0]+y[5]+y[10];let w=0;return A>0?(w=2*Math.sqrt(A+1),m[3]=.25*w,m[0]=(y[6]-y[9])/w,m[1]=(y[8]-y[2])/w,m[2]=(y[1]-y[4])/w):y[0]>y[5]&&y[0]>y[10]?(w=2*Math.sqrt(1+y[0]-y[5]-y[10]),m[3]=(y[6]-y[9])/w,m[0]=.25*w,m[1]=(y[1]+y[4])/w,m[2]=(y[8]+y[2])/w):y[5]>y[10]?(w=2*Math.sqrt(1+y[5]-y[0]-y[10]),m[3]=(y[8]-y[2])/w,m[0]=(y[1]+y[4])/w,m[1]=.25*w,m[2]=(y[6]+y[9])/w):(w=2*Math.sqrt(1+y[10]-y[0]-y[5]),m[3]=(y[1]-y[4])/w,m[0]=(y[8]+y[2])/w,m[1]=(y[6]+y[9])/w,m[2]=.25*w),m}function u(m,y){const A=y[0],w=y[1],M=y[2],T=y[3],E=y[4],C=y[5],N=y[6],P=y[7],L=y[8],R=y[9],F=y[10],V=y[11],G=y[12],U=y[13],z=y[14],O=y[15],D=A*C-w*E,B=A*N-M*E,W=A*P-T*E,q=w*N-M*C,j=w*P-T*C,te=M*P-T*N,ne=L*U-R*G,Z=L*z-F*G,le=L*O-V*G,re=R*z-F*U,se=R*O-V*U,$=F*O-V*z;let fe=D*$-B*se+W*re+q*le-j*Z+te*ne;return!!fe&&(fe=1/fe,m[0]=(C*$-N*se+P*re)*fe,m[1]=(M*se-w*$-T*re)*fe,m[2]=(U*te-z*j+O*q)*fe,m[3]=(F*j-R*te-V*q)*fe,m[4]=(N*le-E*$-P*Z)*fe,m[5]=(A*$-M*le+T*Z)*fe,m[6]=(z*W-G*te-O*B)*fe,m[7]=(L*te-F*W+V*B)*fe,m[8]=(E*se-C*le+P*ne)*fe,m[9]=(w*le-A*se-T*ne)*fe,m[10]=(G*j-U*W+O*D)*fe,m[11]=(R*W-L*j-V*D)*fe,m[12]=(C*Z-E*re-N*ne)*fe,m[13]=(A*re-w*Z+M*ne)*fe,m[14]=(U*B-G*q-z*D)*fe,m[15]=(L*q-R*B+F*D)*fe,!0)}function h(m,y,A){const w=y[0],M=y[1],T=y[2],E=y[3],C=y[4],N=y[5],P=y[6],L=y[7],R=y[8],F=y[9],V=y[10],G=y[11],U=y[12],z=y[13],O=y[14],D=y[15];let B=A[0],W=A[1],q=A[2],j=A[3];return m[0]=B*w+W*C+q*R+j*U,m[1]=B*M+W*N+q*F+j*z,m[2]=B*T+W*P+q*V+j*O,m[3]=B*E+W*L+q*G+j*D,B=A[4],W=A[5],q=A[6],j=A[7],m[4]=B*w+W*C+q*R+j*U,m[5]=B*M+W*N+q*F+j*z,m[6]=B*T+W*P+q*V+j*O,m[7]=B*E+W*L+q*G+j*D,B=A[8],W=A[9],q=A[10],j=A[11],m[8]=B*w+W*C+q*R+j*U,m[9]=B*M+W*N+q*F+j*z,m[10]=B*T+W*P+q*V+j*O,m[11]=B*E+W*L+q*G+j*D,B=A[12],W=A[13],q=A[14],j=A[15],m[12]=B*w+W*C+q*R+j*U,m[13]=B*M+W*N+q*F+j*z,m[14]=B*T+W*P+q*V+j*O,m[15]=B*E+W*L+q*G+j*D,m}function d(m,y,A){let w=A[0],M=A[1],T=A[2],E=Math.sqrt(w*w+M*M+T*T);if(Math.abs(E)<Ui)return n(m);E=1/E,w*=E,M*=E,T*=E;const C=Math.sin(y),N=Math.cos(y),P=1-N;return m[0]=w*w*P+N,m[1]=M*w*P+T*C,m[2]=T*w*P-M*C,m[3]=0,m[4]=w*M*P-T*C,m[5]=M*M*P+N,m[6]=T*M*P+w*C,m[7]=0,m[8]=w*T*P+M*C,m[9]=M*T*P-w*C,m[10]=T*T*P+N,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}i.isIdentity=function(m,y){return o(m,s,y===void 0?Ui:y)},i.hasNaN=function(m){for(let y=0;y<16;y++)if(isNaN(m[y]))return!0;return!1},i.areEqual=o,i.setValue=a,i.getValue=function(m,y,A){return m[4*A+y]},i.toArray=function(m,y,A){return y[A+0]=m[0],y[A+1]=m[1],y[A+2]=m[2],y[A+3]=m[3],y[A+4]=m[4],y[A+5]=m[5],y[A+6]=m[6],y[A+7]=m[7],y[A+8]=m[8],y[A+9]=m[9],y[A+10]=m[10],y[A+11]=m[11],y[A+12]=m[12],y[A+13]=m[13],y[A+14]=m[14],y[A+15]=m[15],y},i.fromArray=function(m,y,A){return m[0]=y[A+0],m[1]=y[A+1],m[2]=y[A+2],m[3]=y[A+3],m[4]=y[A+4],m[5]=y[A+5],m[6]=y[A+6],m[7]=y[A+7],m[8]=y[A+8],m[9]=y[A+9],m[10]=y[A+10],m[11]=y[A+11],m[12]=y[A+12],m[13]=y[A+13],m[14]=y[A+14],m[15]=y[A+15],m},i.fromBasis=function(m,y,A,w){return r(m),a(m,0,0,y[0]),a(m,1,0,y[1]),a(m,2,0,y[2]),a(m,0,1,A[0]),a(m,1,1,A[1]),a(m,2,1,A[2]),a(m,0,2,w[0]),a(m,1,2,w[1]),a(m,2,2,w[2]),a(m,3,3,1),m},i.copy=l,i.clone=function(m){return l(e(),m)},i.getTranslation=function(m,y){return m[0]=y[12],m[1]=y[13],m[2]=y[14],m},i.getScaling=function(m,y){const A=y[0],w=y[1],M=y[2],T=y[4],E=y[5],C=y[6],N=y[8],P=y[9],L=y[10];return m[0]=Math.sqrt(A*A+w*w+M*M),m[1]=Math.sqrt(T*T+E*E+C*C),m[2]=Math.sqrt(N*N+P*P+L*L),m},i.getRotation=c,i.extractRotation=function(m,y){const A=1/Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),w=1/Math.sqrt(y[4]*y[4]+y[5]*y[5]+y[6]*y[6]),M=1/Math.sqrt(y[8]*y[8]+y[9]*y[9]+y[10]*y[10]);return m[0]=y[0]*A,m[1]=y[1]*A,m[2]=y[2]*A,m[3]=0,m[4]=y[4]*w,m[5]=y[5]*w,m[6]=y[6]*w,m[7]=0,m[8]=y[8]*M,m[9]=y[9]*M,m[10]=y[10]*M,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},i.transpose=function(m,y){if(m===y){const A=y[1],w=y[2],M=y[3],T=y[6],E=y[7],C=y[11];m[1]=y[4],m[2]=y[8],m[3]=y[12],m[4]=A,m[6]=y[9],m[7]=y[13],m[8]=w,m[9]=T,m[11]=y[14],m[12]=M,m[13]=E,m[14]=C}else m[0]=y[0],m[1]=y[4],m[2]=y[8],m[3]=y[12],m[4]=y[1],m[5]=y[5],m[6]=y[9],m[7]=y[13],m[8]=y[2],m[9]=y[6],m[10]=y[10],m[11]=y[14],m[12]=y[3],m[13]=y[7],m[14]=y[11],m[15]=y[15];return m},i.tryInvert=u,i.invert=function(m,y){return u(m,y)||console.warn("non-invertible matrix.",y),m},i.mul=h,i.mulOffset=function(m,y,A,w,M,T){const E=y[0+M],C=y[1+M],N=y[2+M],P=y[3+M],L=y[4+M],R=y[5+M],F=y[6+M],V=y[7+M],G=y[8+M],U=y[9+M],z=y[10+M],O=y[11+M],D=y[12+M],B=y[13+M],W=y[14+M],q=y[15+M];let j=A[0+T],te=A[1+T],ne=A[2+T],Z=A[3+T];return m[0+w]=j*E+te*L+ne*G+Z*D,m[1+w]=j*C+te*R+ne*U+Z*B,m[2+w]=j*N+te*F+ne*z+Z*W,m[3+w]=j*P+te*V+ne*O+Z*q,j=A[4+T],te=A[5+T],ne=A[6+T],Z=A[7+T],m[4+w]=j*E+te*L+ne*G+Z*D,m[5+w]=j*C+te*R+ne*U+Z*B,m[6+w]=j*N+te*F+ne*z+Z*W,m[7+w]=j*P+te*V+ne*O+Z*q,j=A[8+T],te=A[9+T],ne=A[10+T],Z=A[11+T],m[8+w]=j*E+te*L+ne*G+Z*D,m[9+w]=j*C+te*R+ne*U+Z*B,m[10+w]=j*N+te*F+ne*z+Z*W,m[11+w]=j*P+te*V+ne*O+Z*q,j=A[12+T],te=A[13+T],ne=A[14+T],Z=A[15+T],m[12+w]=j*E+te*L+ne*G+Z*D,m[13+w]=j*C+te*R+ne*U+Z*B,m[14+w]=j*N+te*F+ne*z+Z*W,m[15+w]=j*P+te*V+ne*O+Z*q,m},i.mul3=function(m,y,A,w){return h(m,h(m,y,A),w)},i.translate=function(m,y,A){const w=A[0],M=A[1],T=A[2];let E,C,N,P,L,R,F,V,G,U,z,O;return y===m?(m[12]=y[0]*w+y[4]*M+y[8]*T+y[12],m[13]=y[1]*w+y[5]*M+y[9]*T+y[13],m[14]=y[2]*w+y[6]*M+y[10]*T+y[14],m[15]=y[3]*w+y[7]*M+y[11]*T+y[15]):(E=y[0],C=y[1],N=y[2],P=y[3],L=y[4],R=y[5],F=y[6],V=y[7],G=y[8],U=y[9],z=y[10],O=y[11],m[0]=E,m[1]=C,m[2]=N,m[3]=P,m[4]=L,m[5]=R,m[6]=F,m[7]=V,m[8]=G,m[9]=U,m[10]=z,m[11]=O,m[12]=E*w+L*M+G*T+y[12],m[13]=C*w+R*M+U*T+y[13],m[14]=N*w+F*M+z*T+y[14],m[15]=P*w+V*M+O*T+y[15]),m},i.fromTranslation=function(m,y){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=y[0],m[13]=y[1],m[14]=y[2],m[15]=1,m},i.setTranslation=function(m,y){return m[12]=y[0],m[13]=y[1],m[14]=y[2],m},i.setAxes=function(m,y,A,w){return m[0]=A[0],m[4]=A[1],m[8]=A[2],m[1]=w[0],m[5]=w[1],m[9]=w[2],m[2]=y[0],m[6]=y[1],m[10]=y[2],m},i.rotate=function(m,y,A,w){let M=w[0],T=w[1],E=w[2],C=Math.sqrt(M*M+T*T+E*E);if(Math.abs(C)<Ui)return t();C=1/C,M*=C,T*=C,E*=C;const N=Math.sin(A),P=Math.cos(A),L=1-P,R=y[0],F=y[1],V=y[2],G=y[3],U=y[4],z=y[5],O=y[6],D=y[7],B=y[8],W=y[9],q=y[10],j=y[11],te=M*M*L+P,ne=T*M*L+E*N,Z=E*M*L-T*N,le=M*T*L-E*N,re=T*T*L+P,se=E*T*L+M*N,$=M*E*L+T*N,fe=T*E*L-M*N,xe=E*E*L+P;return m[0]=R*te+U*ne+B*Z,m[1]=F*te+z*ne+W*Z,m[2]=V*te+O*ne+q*Z,m[3]=G*te+D*ne+j*Z,m[4]=R*le+U*re+B*se,m[5]=F*le+z*re+W*se,m[6]=V*le+O*re+q*se,m[7]=G*le+D*re+j*se,m[8]=R*$+U*fe+B*xe,m[9]=F*$+z*fe+W*xe,m[10]=V*$+O*fe+q*xe,m[11]=G*$+D*fe+j*xe,y!==m&&(m[12]=y[12],m[13]=y[13],m[14]=y[14],m[15]=y[15]),m},i.fromRotation=d,i.scale=function(m,y,A){const w=A[0],M=A[1],T=A[2];return m[0]=y[0]*w,m[1]=y[1]*w,m[2]=y[2]*w,m[3]=y[3]*w,m[4]=y[4]*M,m[5]=y[5]*M,m[6]=y[6]*M,m[7]=y[7]*M,m[8]=y[8]*T,m[9]=y[9]*T,m[10]=y[10]*T,m[11]=y[11]*T,m[12]=y[12],m[13]=y[13],m[14]=y[14],m[15]=y[15],m},i.scaleUniformly=function(m,y,A){return m[0]=y[0]*A,m[1]=y[1]*A,m[2]=y[2]*A,m[3]=y[3]*A,m[4]=y[4]*A,m[5]=y[5]*A,m[6]=y[6]*A,m[7]=y[7]*A,m[8]=y[8]*A,m[9]=y[9]*A,m[10]=y[10]*A,m[11]=y[11]*A,m[12]=y[12],m[13]=y[13],m[14]=y[14],m[15]=y[15],m},i.fromScaling=function(m,y){return m[0]=y[0],m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=y[1],m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=y[2],m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},i.fromUniformScaling=function(m,y){return m[0]=y,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=y,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=y,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},i.fromMat3=function(m,y){return m[0]=y[0],m[1]=y[1],m[2]=y[2],m[4]=y[3],m[5]=y[4],m[6]=y[5],m[8]=y[6],m[9]=y[7],m[10]=y[8],m},i.compose=function(m,y,A,w){const[M,T,E,C]=A,N=M+M,P=T+T,L=E+E,R=M*N,F=M*P,V=M*L,G=T*P,U=T*L,z=E*L,O=C*N,D=C*P,B=C*L,[W,q,j]=w;return m[0]=(1-(G+z))*W,m[1]=(F+B)*W,m[2]=(V-D)*W,m[3]=0,m[4]=(F-B)*q,m[5]=(1-(R+z))*q,m[6]=(U+O)*q,m[7]=0,m[8]=(V+D)*j,m[9]=(U-O)*j,m[10]=(1-(R+G))*j,m[11]=0,m[12]=y[0],m[13]=y[1],m[14]=y[2],m[15]=1,m};const f=[0,0,0],p=e();function _(m){const y=m[0],A=m[1],w=m[2],M=m[3],T=m[4],E=m[5],C=m[6],N=m[7],P=m[8],L=m[9],R=m[10],F=m[11],V=m[12],G=m[13],U=m[14],z=m[15];return(y*E-A*T)*(R*z-F*U)-(y*C-w*T)*(L*z-F*G)+(y*N-M*T)*(L*U-R*G)+(A*C-w*E)*(P*z-F*V)-(A*N-M*E)*(P*U-R*V)+(w*N-M*C)*(P*G-L*V)}i.decompose=function(m,y,A,w){let M=Un.magnitude(Un.set(f,m[0],m[1],m[2]));const T=Un.magnitude(Un.set(f,m[4],m[5],m[6])),E=Un.magnitude(Un.set(f,m[8],m[9],m[10]));_(m)<0&&(M=-M),y[0]=m[12],y[1]=m[13],y[2]=m[14],l(p,m);const C=1/M,N=1/T,P=1/E;return p[0]*=C,p[1]*=C,p[2]*=C,p[4]*=N,p[5]*=N,p[6]*=N,p[8]*=P,p[9]*=P,p[10]*=P,c(A,p),w[0]=M,w[1]=T,w[2]=E,m},i.makeTable=function(m){let y="";for(let A=0;A<4;A++){for(let w=0;w<4;w++)y+=m[4*w+A].toString(),w<3&&(y+=" ");A<3&&(y+=`
`)}return y},i.determinant=_,i.isRotationAndTranslation=function(m,y){return function(A,w){const M=A[0],T=A[1],E=A[2],C=A[3],N=A[4],P=A[5],L=A[6],R=A[7],F=A[8],V=A[9],G=A[10],U=A[11],z=A[15];return!(!(zr(z,1,w)&&zr(C,0,w)&&zr(R,0,w)&&zr(U,0,w))||!zr(Math.abs(M*(P*G-L*V)-T*(N*G-L*F)+E*(N*V-P*F)),1,w))}(m,y!==void 0?y:Ui)},i.isTranslationAndUniformScaling=function(m,y){return function(A,w){const M=A[0];return zr(A[1],0,w)&&zr(A[2],0,w)&&zr(A[3],0,w)&&zr(A[4],0,w)&&zr(A[5],M,w)&&zr(A[6],0,w)&&zr(A[7],0,w)&&zr(A[8],0,w)&&zr(A[9],0,w)&&zr(A[10],M,w)&&zr(A[11],0,w)&&zr(A[15],1,w)}(m,y!==void 0?y:Ui)},i.fromQuat=function(m,y){const A=y[0],w=y[1],M=y[2],T=y[3],E=A+A,C=w+w,N=M+M,P=A*E,L=w*E,R=w*C,F=M*E,V=M*C,G=M*N,U=T*E,z=T*C,O=T*N;return m[0]=1-R-G,m[1]=L+O,m[2]=F-z,m[3]=0,m[4]=L-O,m[5]=1-P-G,m[6]=V+U,m[7]=0,m[8]=F+z,m[9]=V-U,m[10]=1-P-R,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},i.fromEuler=function(m,y,A){const w=y[0],M=y[1],T=y[2],E=Math.cos(w),C=Math.sin(w),N=Math.cos(M),P=Math.sin(M),L=Math.cos(T),R=Math.sin(T);if(A==="XYZ"){const F=E*L,V=E*R,G=C*L,U=C*R;m[0]=N*L,m[4]=-N*R,m[8]=P,m[1]=V+G*P,m[5]=F-U*P,m[9]=-C*N,m[2]=U-F*P,m[6]=G+V*P,m[10]=E*N}else if(A==="YXZ"){const F=N*L,V=N*R,G=P*L,U=P*R;m[0]=F+U*C,m[4]=G*C-V,m[8]=E*P,m[1]=E*R,m[5]=E*L,m[9]=-C,m[2]=V*C-G,m[6]=U+F*C,m[10]=E*N}else if(A==="ZXY"){const F=N*L,V=N*R,G=P*L,U=P*R;m[0]=F-U*C,m[4]=-E*R,m[8]=G+V*C,m[1]=V+G*C,m[5]=E*L,m[9]=U-F*C,m[2]=-E*P,m[6]=C,m[10]=E*N}else if(A==="ZYX"){const F=E*L,V=E*R,G=C*L,U=C*R;m[0]=N*L,m[4]=G*P-V,m[8]=F*P+U,m[1]=N*R,m[5]=U*P+F,m[9]=V*P-G,m[2]=-P,m[6]=C*N,m[10]=E*N}else if(A==="YZX"){const F=E*N,V=E*P,G=C*N,U=C*P;m[0]=N*L,m[4]=U-F*R,m[8]=G*R+V,m[1]=R,m[5]=E*L,m[9]=-C*L,m[2]=-P*L,m[6]=V*R+G,m[10]=F-U*R}else if(A==="XZY"){const F=E*N,V=E*P,G=C*N,U=C*P;m[0]=N*L,m[4]=-R,m[8]=P*L,m[1]=F*R+U,m[5]=E*L,m[9]=V*R-G,m[2]=G*R-V,m[6]=C*L,m[10]=U*R+F}return m[3]=0,m[7]=0,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},i.perspective=function(m,y,A,w,M,T,E){const C=2*T/(A-y),N=2*T/(w-M),P=(A+y)/(A-y),L=(w+M)/(w-M),R=-(E+T)/(E-T),F=-2*E*T/(E-T);return m[0]=C,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=N,m[6]=0,m[7]=0,m[8]=P,m[9]=L,m[10]=R,m[11]=-1,m[12]=0,m[13]=0,m[14]=F,m[15]=0,m},i.ortho=function(m,y,A,w,M,T,E){const C=1/(A-y),N=1/(w-M),P=1/(E-T),L=(A+y)*C,R=(w+M)*N,F=(E+T)*P;return m[0]=2*C,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=2*N,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=-2*P,m[11]=0,m[12]=-L,m[13]=-R,m[14]=-F,m[15]=1,m},i.lookAt=function(m,y,A,w){let M,T,E,C,N,P,L,R,F,V;const G=y[0],U=y[1],z=y[2],O=w[0],D=w[1],B=w[2],W=A[0],q=A[1],j=A[2];return Math.abs(G-W)<Ui&&Math.abs(U-q)<Ui&&Math.abs(z-j)<Ui?n(m):(L=G-W,R=U-q,F=z-j,V=1/Math.sqrt(L*L+R*R+F*F),L*=V,R*=V,F*=V,M=D*F-B*R,T=B*L-O*F,E=O*R-D*L,V=Math.sqrt(M*M+T*T+E*E),V?(V=1/V,M*=V,T*=V,E*=V):(M=0,T=0,E=0),C=R*E-F*T,N=F*M-L*E,P=L*T-R*M,V=Math.sqrt(C*C+N*N+P*P),V?(V=1/V,C*=V,N*=V,P*=V):(C=0,N=0,P=0),m[0]=M,m[1]=C,m[2]=L,m[3]=0,m[4]=T,m[5]=N,m[6]=R,m[7]=0,m[8]=E,m[9]=P,m[10]=F,m[11]=0,m[12]=-(M*G+T*U+E*z),m[13]=-(C*G+N*U+P*z),m[14]=-(L*G+R*U+F*z),m[15]=1,m)},i.targetTo=function(m,y,A,w){const M=y[0],T=y[1],E=y[2],C=w[0],N=w[1],P=w[2];let L=M-A[0],R=T-A[1],F=E-A[2],V=L*L+R*R+F*F;V>0&&(V=1/Math.sqrt(V),L*=V,R*=V,F*=V);let G=N*F-P*R,U=P*L-C*F,z=C*R-N*L;return V=G*G+U*U+z*z,V>0&&(V=1/Math.sqrt(V),G*=V,U*=V,z*=V),m[0]=G,m[1]=U,m[2]=z,m[3]=0,m[4]=R*z-F*U,m[5]=F*G-L*z,m[6]=L*U-R*G,m[7]=0,m[8]=L,m[9]=R,m[10]=F,m[11]=0,m[12]=M,m[13]=T,m[14]=E,m[15]=1,m},i.fromPermutation=function(m,y){r(m);for(let A=0;A<4;A++)a(m,A,y[A],1);return m},i.getMaxScaleOnAxis=function(m){const y=m[0]*m[0]+m[1]*m[1]+m[2]*m[2],A=m[4]*m[4]+m[5]*m[5]+m[6]*m[6],w=m[8]*m[8]+m[9]*m[9]+m[10]*m[10];return Math.sqrt(Math.max(y,A,w))};const v=[1,0,0],g=[0,1,0],b=[0,0,1];i.rotX90=d(e(),Dh(90),v),i.rotX180=d(e(),Dh(180),v),i.rotY90=d(e(),Dh(90),g),i.rotY180=d(e(),Dh(180),g),i.rotY270=d(e(),Dh(270),g),i.rotZ90=d(e(),Dh(90),b),i.rotZ180=d(e(),Dh(180),b),i.rotXY90=h(e(),i.rotX90,i.rotY90),i.rotZY90=h(e(),i.rotZ90,i.rotY90),i.rotZYZ90=h(e(),i.rotZY90,i.rotZ90),i.rotZ90X180=h(e(),i.rotZ90,i.rotX180),i.rotY90Z180=h(e(),i.rotY90,i.rotZ180),i.id=t()})(_u||(_u={})),function(i){function e(){const w=[.1,0,0,0,0,0,0,0,0];return w[0]=0,w}function t(){const w=e();return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=1,w[5]=0,w[6]=0,w[7]=0,w[8]=1,w}function n(w,M){return w[0]=M[0],w[1]=M[1],w[2]=M[2],w[3]=M[4],w[4]=M[5],w[5]=M[6],w[6]=M[8],w[7]=M[9],w[8]=M[10],w}i.zero=e,i.identity=t,i.setIdentity=function(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=1,w[5]=0,w[6]=0,w[7]=0,w[8]=1,w},i.toArray=function(w,M,T){return M[T+0]=w[0],M[T+1]=w[1],M[T+2]=w[2],M[T+3]=w[3],M[T+4]=w[4],M[T+5]=w[5],M[T+6]=w[6],M[T+7]=w[7],M[T+8]=w[8],M},i.fromArray=function(w,M,T){return w[0]=M[T+0],w[1]=M[T+1],w[2]=M[T+2],w[3]=M[T+3],w[4]=M[T+4],w[5]=M[T+5],w[6]=M[T+6],w[7]=M[T+7],w[8]=M[T+8],w},i.fromColumns=function(w,M,T,E){return w[0]=M[0],w[1]=M[1],w[2]=M[2],w[3]=T[0],w[4]=T[1],w[5]=T[2],w[6]=E[0],w[7]=E[1],w[8]=E[2],w},i.fromMat4=n;const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];i.fromEuler=function(w,M,T){return _u.fromEuler(r,M,T),n(w,r)},i.create=function(w,M,T,E,C,N,P,L,R){const F=e();return F[0]=w,F[1]=M,F[2]=T,F[3]=E,F[4]=C,F[5]=N,F[6]=P,F[7]=L,F[8]=R,F};const s=t();function o(w,M,T){for(let E=0;E<9;E++)if(Math.abs(w[E]-M[E])>T)return!1;return!0}function a(w,M){return w[0]=M[0],w[1]=M[1],w[2]=M[2],w[3]=M[3],w[4]=M[4],w[5]=M[5],w[6]=M[6],w[7]=M[7],w[8]=M[8],w}function l(w,M){if(w===M){const T=M[1],E=M[2],C=M[5];w[1]=M[3],w[2]=M[6],w[3]=T,w[5]=M[7],w[6]=E,w[7]=C}else w[0]=M[0],w[1]=M[3],w[2]=M[6],w[3]=M[1],w[4]=M[4],w[5]=M[7],w[6]=M[2],w[7]=M[5],w[8]=M[8];return w}function c(w,M){const T=M[0],E=M[1],C=M[2],N=M[3],P=M[4],L=M[5],R=M[6],F=M[7],V=M[8],G=V*P-L*F,U=-V*N+L*R,z=F*N-P*R;let O=T*G+E*U+C*z;return O?(O=1/O,w[0]=G*O,w[1]=(-V*E+C*F)*O,w[2]=(L*E-C*P)*O,w[3]=U*O,w[4]=(V*T-C*R)*O,w[5]=(-L*T+C*N)*O,w[6]=z*O,w[7]=(-F*T+E*R)*O,w[8]=(P*T-E*N)*O,w):(console.warn("non-invertible matrix.",M),w)}function u(w){const M=w[0],T=w[1],E=w[2],C=w[3],N=w[4],P=w[5],L=w[6],R=w[7],F=w[8];return M*(F*N-P*R)+T*(-F*C+P*L)+E*(R*C-N*L)}function h(w){return w[0]+w[4]+w[8]}function d(w,M,T){return w[0]=M[0]-T[0],w[1]=M[1]-T[1],w[2]=M[2]-T[2],w[3]=M[3]-T[3],w[4]=M[4]-T[4],w[5]=M[5]-T[5],w[6]=M[6]-T[6],w[7]=M[7]-T[7],w[8]=M[8]-T[8],w}function f(w,M,T){return w[0]=M[0]*T,w[1]=M[1]*T,w[2]=M[2]*T,w[3]=M[3]*T,w[4]=M[4]*T,w[5]=M[5]*T,w[6]=M[6]*T,w[7]=M[7]*T,w[8]=M[8]*T,w}i.isIdentity=function(w,M){return o(w,s,M===void 0?Ui:M)},i.hasNaN=function(w){for(let M=0;M<9;M++)if(isNaN(w[M]))return!0;return!1},i.clone=function(w){return a(e(),w)},i.areEqual=o,i.setValue=function(w,M,T,E){w[3*T+M]=E},i.getValue=function(w,M,T){return w[3*T+M]},i.copy=a,i.transpose=l,i.invert=c,i.symmtricFromUpper=function(w,M){return w===M?(w[3]=M[1],w[6]=M[2],w[7]=M[5]):(w[0]=M[0],w[1]=M[1],w[2]=M[2],w[3]=M[1],w[4]=M[4],w[5]=M[5],w[6]=M[2],w[7]=M[5],w[8]=M[8]),w},i.symmtricFromLower=function(w,M){return w===M?(w[1]=M[3],w[2]=M[6],w[5]=M[7]):(w[0]=M[0],w[1]=M[3],w[2]=M[6],w[3]=M[3],w[4]=M[4],w[5]=M[7],w[6]=M[6],w[7]=M[7],w[8]=M[8]),w},i.determinant=u,i.trace=h,i.sub=d,i.add=function(w,M,T){return w[0]=M[0]+T[0],w[1]=M[1]+T[1],w[2]=M[2]+T[2],w[3]=M[3]+T[3],w[4]=M[4]+T[4],w[5]=M[5]+T[5],w[6]=M[6]+T[6],w[7]=M[7]+T[7],w[8]=M[8]+T[8],w},i.mul=function(w,M,T){const E=M[0],C=M[1],N=M[2],P=M[3],L=M[4],R=M[5],F=M[6],V=M[7],G=M[8],U=T[0],z=T[1],O=T[2],D=T[3],B=T[4],W=T[5],q=T[6],j=T[7],te=T[8];return w[0]=U*E+z*P+O*F,w[1]=U*C+z*L+O*V,w[2]=U*N+z*R+O*G,w[3]=D*E+B*P+W*F,w[4]=D*C+B*L+W*V,w[5]=D*N+B*R+W*G,w[6]=q*E+j*P+te*F,w[7]=q*C+j*L+te*V,w[8]=q*N+j*R+te*G,w},i.subScalar=function(w,M,T){return w[0]=M[0]-T,w[1]=M[1]-T,w[2]=M[2]-T,w[3]=M[3]-T,w[4]=M[4]-T,w[5]=M[5]-T,w[6]=M[6]-T,w[7]=M[7]-T,w[8]=M[8]-T,w},i.addScalar=function(w,M,T){return w[0]=M[0]+T,w[1]=M[1]+T,w[2]=M[2]+T,w[3]=M[3]+T,w[4]=M[4]+T,w[5]=M[5]+T,w[6]=M[6]+T,w[7]=M[7]+T,w[8]=M[8]+T,w},i.mulScalar=f;const p=Math.PI/3,_=e();i.symmetricEigenvalues=function(w,M){const T=M[1]*M[1]+M[2]*M[2]+M[5]*M[5];if(T===0)w[0]=M[0],w[1]=M[4],w[2]=M[8];else{const E=h(M)/3,C=M[0]-E,N=M[4]-E,P=M[8]-E,L=C*C+N*N+P*P+2*T,R=Math.sqrt(L/6);f(_,i.Identity,E),d(_,M,_),f(_,_,1/R);const F=u(_)/2,V=F<=-1?p:F>=1?0:Math.acos(F)/3;w[0]=E+2*R*Math.cos(V),w[2]=E+2*R*Math.cos(V+2*p),w[1]=3*E-w[0]-w[2]}return w};const v=[.1,0,0],g=[.1,0,0],b=[.1,0,0],m=[.1,0,0],y=[.1,0,0],A=[.1,0,0];i.eigenvector=function(w,M,T){Un.set(v,M[0]-T,M[1],M[2]),Un.set(g,M[1],M[4]-T,M[5]),Un.set(b,M[2],M[5],M[8]-T),Un.cross(m,v,g),Un.cross(y,v,b),Un.cross(A,g,b);const E=Un.dot(m,m),C=Un.dot(y,y),N=Un.dot(A,A);let P=E,L=0;return C>P&&(P=C,L=1),N>P&&(L=2),L===0?Un.scale(w,m,1/Math.sqrt(E)):L===1?Un.scale(w,y,1/Math.sqrt(C)):Un.scale(w,A,1/Math.sqrt(N)),w},i.directionTransform=function(w,M){return n(w,M),c(w,w),l(w,w),w},i.Identity=t(),i.innerProduct=function(w,M){return w[0]*M[0]+w[1]*M[1]+w[2]*M[2]+w[3]*M[3]+w[4]*M[4]+w[5]*M[5]+w[6]*M[6]+w[7]*M[7]+w[8]*M[8]}}(Wx||(Wx={})),function(i){function e(){const t=[.1,0];return t[0]=0,t}i.zero=e,i.clone=function(t){const n=e();return n[0]=t[0],n[1]=t[1],n},i.create=function(t,n){const r=e();return r[0]=t,r[1]=n,r},i.hasNaN=function(t){return isNaN(t[0])||isNaN(t[1])},i.toArray=function(t,n,r){return n[r+0]=t[0],n[r+1]=t[1],n},i.fromArray=function(t,n,r){return t[0]=n[r+0],t[1]=n[r+1],t},i.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t},i.set=function(t,n,r){return t[0]=n,t[1]=r,t},i.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t},i.sub=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t},i.mul=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t},i.div=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t},i.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t},i.round=function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t},i.ceil=function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t},i.floor=function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t},i.distance=function(t,n){const r=n[0]-t[0],s=n[1]-t[1];return Math.sqrt(r*r+s*s)},i.squaredDistance=function(t,n){const r=n[0]-t[0],s=n[1]-t[1];return r*r+s*s},i.magnitude=function(t){const n=t[0],r=t[1];return Math.sqrt(n*n+r*r)},i.squaredMagnitude=function(t){const n=t[0],r=t[1];return n*n+r*r},i.inverse=function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t},i.areEqual=function(t,n){return t[0]===n[0]&&t[1]===n[1]},i.toString=function(t,n){return`[${t[0].toPrecision(n)} ${t[1].toPrecision(n)}}]`}}(VC||(VC={})),function(i){function e(){const n=[.1,0,0,0];return n[0]=0,n}function t(n,r){return n[0]=r.center[0],n[1]=r.center[1],n[2]=r.center[2],n[3]=r.radius,n}i.zero=e,i.clone=function(n){const r=e();return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r},i.create=function(n,r,s,o){const a=e();return a[0]=n,a[1]=r,a[2]=s,a[3]=o,a},i.fromSphere=t,i.ofSphere=function(n){return t(e(),n)},i.hasNaN=function(n){return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])},i.toArray=function(n,r,s){return r[s+0]=n[0],r[s+1]=n[1],r[s+2]=n[2],r[s+3]=n[3],r},i.fromArray=function(n,r,s){return n[0]=r[s+0],n[1]=r[s+1],n[2]=r[s+2],n[3]=r[s+3],n},i.toVec3Array=function(n,r,s){r[s+0]=n[0],r[s+1]=n[1],r[s+2]=n[2]},i.fromVec3Array=function(n,r,s){return n[0]=r[s+0],n[1]=r[s+1],n[2]=r[s+2],n[3]=0,n},i.copy=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n},i.set=function(n,r,s,o,a){return n[0]=r,n[1]=s,n[2]=o,n[3]=a,n},i.add=function(n,r,s){return n[0]=r[0]+s[0],n[1]=r[1]+s[1],n[2]=r[2]+s[2],n[3]=r[3]+s[3],n},i.distance=function(n,r){const s=r[0]-n[0],o=r[1]-n[1],a=r[2]-n[2],l=r[3]-n[3];return Math.sqrt(s*s+o*o+a*a+l*l)},i.scale=function(n,r,s){return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[4]=r[4]*s,n},i.round=function(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n[2]=Math.round(r[2]),n[3]=Math.round(r[3]),n},i.ceil=function(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n[2]=Math.ceil(r[2]),n[3]=Math.ceil(r[3]),n},i.floor=function(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n[2]=Math.floor(r[2]),n[3]=Math.floor(r[3]),n},i.squaredDistance=function(n,r){const s=r[0]-n[0],o=r[1]-n[1],a=r[2]-n[2],l=r[3]-n[3];return s*s+o*o+a*a+l*l},i.norm=function(n){const r=n[0],s=n[1],o=n[2],a=n[3];return Math.sqrt(r*r+s*s+o*o+a*a)},i.squaredNorm=function(n){const r=n[0],s=n[1],o=n[2],a=n[3];return r*r+s*s+o*o+a*a},i.transformMat4=function(n,r,s){const o=r[0],a=r[1],l=r[2],c=r[3];return n[0]=s[0]*o+s[4]*a+s[8]*l+s[12]*c,n[1]=s[1]*o+s[5]*a+s[9]*l+s[13]*c,n[2]=s[2]*o+s[6]*a+s[10]*l+s[14]*c,n[3]=s[3]*o+s[7]*a+s[11]*l+s[15]*c,n},i.dot=function(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]+n[3]*r[3]},i.inverse=function(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n[3]=1/r[3],n},i.exactEquals=function(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]},i.equals=function(n,r){const s=n[0],o=n[1],a=n[2],l=n[3],c=r[0],u=r[1],h=r[2],d=r[3];return Math.abs(s-c)<=Ui*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(o-u)<=Ui*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(a-h)<=Ui*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(l-d)<=Ui*Math.max(1,Math.abs(l),Math.abs(d))},i.toString=function(n,r){return`[${n[0].toPrecision(r)} ${n[1].toPrecision(r)} ${n[2].toPrecision(r)}  ${n[3].toPrecision(r)}]`}}(HC||(HC={})),function(i){function e(){const p=[.1,0,0,0];return p[0]=0,p}function t(){const p=e();return p[3]=1,p}function n(p,_,v){v*=.5;const g=Math.sin(v);return p[0]=g*_[0],p[1]=g*_[1],p[2]=g*_[2],p[3]=Math.cos(v),p}function r(p,_,v,g){const b=_[0],m=_[1],y=_[2],A=_[3];let w,M,T,E,C,N=v[0],P=v[1],L=v[2],R=v[3];return M=b*N+m*P+y*L+A*R,M<0&&(M=-M,N=-N,P=-P,L=-L,R=-R),1-M>1e-6?(w=Math.acos(M),T=Math.sin(w),E=Math.sin((1-g)*w)/T,C=Math.sin(g*w)/T):(E=1-g,C=g),p[0]=E*b+C*N,p[1]=E*m+C*P,p[2]=E*y+C*L,p[3]=E*A+C*R,p}function s(p,_){const v=_[0]+_[4]+_[8];let g;if(v>0)g=Math.sqrt(v+1),p[3]=.5*g,g=.5/g,p[0]=(_[5]-_[7])*g,p[1]=(_[6]-_[2])*g,p[2]=(_[1]-_[3])*g;else{let b=0;_[4]>_[0]&&(b=1),_[8]>_[3*b+b]&&(b=2);const m=(b+1)%3,y=(b+2)%3;g=Math.sqrt(_[3*b+b]-_[3*m+m]-_[3*y+y]+1),p[b]=.5*g,g=.5/g,p[3]=(_[3*m+y]-_[3*y+m])*g,p[m]=(_[3*m+b]+_[3*b+m])*g,p[y]=(_[3*y+b]+_[3*b+y])*g}return p}i.zero=e,i.identity=t,i.setIdentity=function(p){p[0]=0,p[1]=0,p[2]=0,p[3]=1},i.hasNaN=function(p){return isNaN(p[0])||isNaN(p[1])||isNaN(p[2])||isNaN(p[3])},i.create=function(p,_,v,g){const b=t();return b[0]=p,b[1]=_,b[2]=v,b[3]=g,b},i.setAxisAngle=n,i.getAxisAngle=function(p,_){const v=2*Math.acos(_[3]),g=Math.sin(v/2);return g!==0?(p[0]=_[0]/g,p[1]=_[1]/g,p[2]=_[2]/g):(p[0]=1,p[1]=0,p[2]=0),v},i.multiply=function(p,_,v){const g=_[0],b=_[1],m=_[2],y=_[3],A=v[0],w=v[1],M=v[2],T=v[3];return p[0]=g*T+y*A+b*M-m*w,p[1]=b*T+y*w+m*A-g*M,p[2]=m*T+y*M+g*w-b*A,p[3]=y*T-g*A-b*w-m*M,p},i.rotateX=function(p,_,v){v*=.5;const g=_[0],b=_[1],m=_[2],y=_[3],A=Math.sin(v),w=Math.cos(v);return p[0]=g*w+y*A,p[1]=b*w+m*A,p[2]=m*w-b*A,p[3]=y*w-g*A,p},i.rotateY=function(p,_,v){v*=.5;const g=_[0],b=_[1],m=_[2],y=_[3],A=Math.sin(v),w=Math.cos(v);return p[0]=g*w-m*A,p[1]=b*w+y*A,p[2]=m*w+g*A,p[3]=y*w-b*A,p},i.rotateZ=function(p,_,v){v*=.5;const g=_[0],b=_[1],m=_[2],y=_[3],A=Math.sin(v),w=Math.cos(v);return p[0]=g*w+b*A,p[1]=b*w-g*A,p[2]=m*w+y*A,p[3]=y*w-m*A,p},i.calculateW=function(p,_){const v=_[0],g=_[1],b=_[2];return p[0]=v,p[1]=g,p[2]=b,p[3]=Math.sqrt(Math.abs(1-v*v-g*g-b*b)),p},i.slerp=r,i.invert=function(p,_){const v=_[0],g=_[1],b=_[2],m=_[3],y=v*v+g*g+b*b+m*m,A=y?1/y:0;return p[0]=-v*A,p[1]=-g*A,p[2]=-b*A,p[3]=m*A,p},i.conjugate=function(p,_){return p[0]=-_[0],p[1]=-_[1],p[2]=-_[2],p[3]=_[3],p},i.dot=function(p,_){return p[0]*_[0]+p[1]*_[1]+p[2]*_[2]+p[3]*_[3]},i.fromMat3=s,i.fromEuler=function(p,_,v){const[g,b,m]=_,y=Math.cos(g/2),A=Math.cos(b/2),w=Math.cos(m/2),M=Math.sin(g/2),T=Math.sin(b/2),E=Math.sin(m/2);switch(v){case"XYZ":p[0]=M*A*w+y*T*E,p[1]=y*T*w-M*A*E,p[2]=y*A*E+M*T*w,p[3]=y*A*w-M*T*E;break;case"YXZ":p[0]=M*A*w+y*T*E,p[1]=y*T*w-M*A*E,p[2]=y*A*E-M*T*w,p[3]=y*A*w+M*T*E;break;case"ZXY":p[0]=M*A*w-y*T*E,p[1]=y*T*w+M*A*E,p[2]=y*A*E+M*T*w,p[3]=y*A*w-M*T*E;break;case"ZYX":p[0]=M*A*w-y*T*E,p[1]=y*T*w+M*A*E,p[2]=y*A*E-M*T*w,p[3]=y*A*w+M*T*E;break;case"YZX":p[0]=M*A*w+y*T*E,p[1]=y*T*w+M*A*E,p[2]=y*A*E-M*T*w,p[3]=y*A*w-M*T*E;break;case"XZY":p[0]=M*A*w-y*T*E,p[1]=y*T*w-M*A*E,p[2]=y*A*E+M*T*w,p[3]=y*A*w+M*T*E;break;default:zb()}return p};const o=[0,0,0];function a(p,_){const v=_[0],g=_[1],b=_[2],m=_[3];let y=v*v+g*g+b*b+m*m;return y>0&&(y=1/Math.sqrt(y),p[0]=v*y,p[1]=g*y,p[2]=b*y,p[3]=m*y),p}i.fromUnitVec3=function(p,_,v){let g=Un.dot(_,v)+1;return g<Ui?(g=0,Math.abs(_[0])>Math.abs(_[2])?Un.set(o,-_[1],_[0],0):Un.set(o,0,-_[2],_[1])):Un.cross(o,_,v),p[0]=o[0],p[1]=o[1],p[2]=o[2],p[3]=g,a(p,p),p},i.clone=function(p){const _=e();return _[0]=p[0],_[1]=p[1],_[2]=p[2],_[3]=p[3],_},i.toArray=function(p,_,v){return _[v+0]=p[0],_[v+1]=p[1],_[v+2]=p[2],_[v+3]=p[3],_},i.fromArray=function(p,_,v){return p[0]=_[v+0],p[1]=_[v+1],p[2]=_[v+2],p[3]=_[v+3],p},i.copy=function(p,_){return p[0]=_[0],p[1]=_[1],p[2]=_[2],p[3]=_[3],p},i.set=function(p,_,v,g,b){return p[0]=_,p[1]=v,p[2]=g,p[3]=b,p},i.exactEquals=function(p,_){return p[0]===_[0]&&p[1]===_[1]&&p[2]===_[2]&&p[3]===_[3]},i.equals=function(p,_){const v=p[0],g=p[1],b=p[2],m=p[3],y=_[0],A=_[1],w=_[2],M=_[3];return Math.abs(v-y)<=Ui*Math.max(1,Math.abs(v),Math.abs(y))&&Math.abs(g-A)<=Ui*Math.max(1,Math.abs(g),Math.abs(A))&&Math.abs(b-w)<=Ui*Math.max(1,Math.abs(b),Math.abs(w))&&Math.abs(m-M)<=Ui*Math.max(1,Math.abs(m),Math.abs(M))},i.add=function(p,_,v){return p[0]=_[0]+v[0],p[1]=_[1]+v[1],p[2]=_[2]+v[2],p[3]=_[3]+v[3],p},i.normalize=a;const l=[0,0,0],c=[1,0,0],u=[0,1,0];i.rotationTo=function(p,_,v){const g=Un.dot(_,v);return g<-.999999?(Un.cross(l,c,_),Un.magnitude(l)<1e-6&&Un.cross(l,u,_),Un.normalize(l,l),n(p,l,Math.PI),p):g>.999999?(p[0]=0,p[1]=0,p[2]=0,p[3]=1,p):(Un.cross(l,_,v),p[0]=l[0],p[1]=l[1],p[2]=l[2],p[3]=1+g,a(p,p))};const h=e(),d=e();i.sqlerp=function(p,_,v,g,b,m){return r(h,_,b,m),r(d,v,g,m),r(p,h,d,2*m*(1-m)),p};const f=[0,0,0,0,0,0,0,0,0];i.setAxes=function(p,_,v,g){return f[0]=v[0],f[3]=v[1],f[6]=v[2],f[1]=g[0],f[4]=g[1],f[7]=g[2],f[2]=-_[0],f[5]=-_[1],f[8]=-_[2],a(p,s(p,f))},i.toString=function(p,_){return`[${p[0].toPrecision(_)} ${p[1].toPrecision(_)} ${p[2].toPrecision(_)}  ${p[3].toPrecision(_)}]`},i.Identity=t()}($C||($C={})),function(i){function e(o,a,l){const c=function(_,v,g){const b=[];for(let y=0;y<v.length;y++)b[y]=v[v.length-y-1];const m=[1];for(let y=1;y<_.length;y++)m[y]=_[b[y-1]];return{dimensions:_,axisOrderFastToSlow:b,axisOrderSlowToFast:v,accessDimensions:m,defaultCtor:g||Float64Array}}(o,a,l),{get:u,set:h,add:d,dataOffset:f,getCoords:p}=t(c);return{rank:o.length,dimensions:o,axisOrderSlowToFast:a,create:n(c),get:u,set:h,add:d,dataOffset:f,getCoords:p}}function t(o){const{dimensions:a,axisOrderFastToSlow:l}=o;switch(a.length){case 1:return{get:(c,u)=>c[u],set:(c,u,h)=>c[u]=h,add:(c,u,h)=>c[u]+=h,dataOffset:c=>c,getCoords:(c,u)=>(u[0]=c,u)};case 2:if(l[0]===0&&l[1]===1){const c=a[0];return{get:(u,h,d)=>u[d*c+h],set:(u,h,d,f)=>u[d*c+h]=f,add:(u,h,d,f)=>u[d*c+h]+=f,dataOffset:(u,h)=>h*c+u,getCoords:(u,h)=>(h[0]=u%c,h[1]=Math.floor(u/c),h)}}if(l[0]===1&&l[1]===0){const c=a[1];return{get:(u,h,d)=>u[h*c+d],set:(u,h,d,f)=>u[h*c+d]=f,add:(u,h,d,f)=>u[h*c+d]+=f,dataOffset:(u,h)=>u*c+h,getCoords:(u,h)=>(h[0]=Math.floor(u/c),h[1]=u%c,h)}}throw new Error("bad axis order");case 3:if(l[0]===0&&l[1]===1&&l[2]===2){const c=a[0],u=a[1],h=c*u;return{get:(d,f,p,_)=>d[f+p*c+_*h],set:(d,f,p,_,v)=>d[f+p*c+_*h]=v,add:(d,f,p,_,v)=>d[f+p*c+_*h]+=v,dataOffset:(d,f,p)=>d+f*c+p*h,getCoords:(d,f)=>{const p=Math.floor(d/c);return f[0]=d%c,f[1]=p%u,f[2]=Math.floor(p/u),f}}}if(l[0]===0&&l[1]===2&&l[2]===1){const c=a[0],u=a[2],h=c*u;return{get:(d,f,p,_)=>d[f+_*c+p*h],set:(d,f,p,_,v)=>d[f+_*c+p*h]=v,add:(d,f,p,_,v)=>d[f+_*c+p*h]+=v,dataOffset:(d,f,p)=>d+p*c+f*h,getCoords:(d,f)=>{const p=Math.floor(d/c);return f[0]=d%c,f[1]=Math.floor(p/u),f[2]=p%u,f}}}if(l[0]===1&&l[1]===0&&l[2]===2){const c=a[1],u=a[0],h=c*u;return{get:(d,f,p,_)=>d[p+f*c+_*h],set:(d,f,p,_,v)=>d[p+f*c+_*h]=v,add:(d,f,p,_,v)=>d[p+f*c+_*h]+=v,dataOffset:(d,f,p)=>f+d*c+p*h,getCoords:(d,f)=>{const p=Math.floor(d/c);return f[0]=p%u,f[1]=d%c,f[2]=Math.floor(p/u),f}}}if(l[0]===1&&l[1]===2&&l[2]===0){const c=a[1],u=a[2],h=c*u;return{get:(d,f,p,_)=>d[p+_*c+f*h],set:(d,f,p,_,v)=>d[p+_*c+f*h]=v,add:(d,f,p,_,v)=>d[p+_*c+f*h]+=v,dataOffset:(d,f,p)=>f+p*c+d*h,getCoords:(d,f)=>{const p=Math.floor(d/c);return f[0]=Math.floor(p/u),f[1]=d%c,f[2]=p%u,f}}}if(l[0]===2&&l[1]===0&&l[2]===1){const c=a[2],u=a[0],h=c*u;return{get:(d,f,p,_)=>d[_+f*c+p*h],set:(d,f,p,_,v)=>d[_+f*c+p*h]=v,add:(d,f,p,_,v)=>d[_+f*c+p*h]+=v,dataOffset:(d,f,p)=>p+d*c+f*h,getCoords:(d,f)=>{const p=Math.floor(d/c);return f[0]=p%u,f[1]=Math.floor(p/u),f[2]=d%c,f}}}if(l[0]===2&&l[1]===1&&l[2]===0){const c=a[2],u=a[1],h=c*u;return{get:(d,f,p,_)=>d[_+p*c+f*h],set:(d,f,p,_,v)=>d[_+p*c+f*h]=v,add:(d,f,p,_,v)=>d[_+p*c+f*h]+=v,dataOffset:(d,f,p)=>p+f*c+d*h,getCoords:(d,f)=>{const p=Math.floor(d/c);return f[0]=Math.floor(p/u),f[1]=p%u,f[2]=d%c,f}}}throw new Error("bad axis order");default:return{get:(c,...u)=>c[r(o,u)],set:(c,...u)=>c[r(o,u)]=u[u.length-1],add:(c,...u)=>c[r(o,u)]+=u[u.length-1],dataOffset:(...c)=>r(o,c),getCoords:(c,u)=>function(h,d,f){const{dimensions:p,axisOrderFastToSlow:_}=h,v=p.length;let g=d;for(let b=0;b<v;b++){const m=p[_[b]];f[_[b]]=g%m,g=Math.floor(g/m)}return f[_[v+1]]=g,f}(o,c,u)}}}function n(o){const{dimensions:a}=o;let l=1;for(let c=0,u=a.length;c<u;c++)l*=a[c];return c=>new(c||o.defaultCtor)(l)}function r(o,a){const{accessDimensions:l,axisOrderFastToSlow:c}=o,u=l.length-1;let h=l[u]*a[c[u]];for(let d=u-1;d>=0;d--)h=(h+a[c[d]])*l[d];return h}function s(o,a){const l=[];for(let c=0;c<o.length;c++)l[c]=o[a[c]];return l}i.create=function(o,a){return{space:o,data:a}},i.Space=e,i.Data1=function(o){return o},i.Vector=function(o,a){return e([o],[0],a)},i.ColumnMajorMatrix=function(o,a,l){return e([o,a],[1,0],l)},i.RowMajorMatrix=function(o,a,l){return e([o,a],[0,1],l)},i.toMat4=function(o,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const c=Math.min(4,a.dimensions[0]),u=Math.min(4,a.dimensions[1]);for(let h=0;h<c;h++)for(let d=0;d<u;d++)_u.setValue(o,h,d,a.get(l,h,d));return o},i.toMat3=function(o,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const c=Math.min(3,a.dimensions[0]),u=Math.min(3,a.dimensions[1]);for(let h=0;h<c;h++)for(let d=0;d<u;d++)Wx.setValue(o,h,d,a.get(l,h,d));return o},i.toVec3=function(o,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const c=Math.min(3,a.dimensions[0]);for(let u=0;u<c;u++)o[u]=l[u];return o},i.toVec4=function(o,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const c=Math.min(4,a.dimensions[0]);for(let u=0;u<c;u++)o[u]=l[u];return o},i.areEqualExact=function(o,a){const l=o.length;if(l!==a.length)return!1;for(let c=0;c<l;c++)if(o[c]!==a[c])return!1;return!0},i.invertAxisOrder=function(o){const a=[];for(let l=0;l<o.length;l++)a[l]=o[o.length-l-1];return a},i.convertToCanonicalAxisIndicesFastToSlow=function(o){const a=new Int32Array(o.length);for(let l=0;l<o.length;l++)a[o[l]]=l;return l=>s(l,a)},i.convertToCanonicalAxisIndicesSlowToFast=function(o){const a=new Int32Array(o.length);for(let l=0;l<o.length;l++)a[o[o.length-l-1]]=l;return l=>s(l,a)}}(a0||(a0={})),function(i){let e;function t(r,s){return uO(s.T,r,s,1)}function n(r){return Hy(r)}(function(r){function s(o,a=r.float){return{"@type":"tensor",T:o.create(),space:o,valueType:"tensor",baseType:a}}r.str={"@type":"str",T:"",valueType:"str"},r.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},r.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},r.int={"@type":"int",T:0,valueType:"int"},r.coord={"@type":"coord",T:0,valueType:"float"},r.float={"@type":"float",T:0,valueType:"float"},r.Str=function(o){var a;return{"@type":"str",T:(a=o==null?void 0:o.defaultValue)!==null&&a!==void 0?a:"",transform:o==null?void 0:o.transform,valueType:"str"}},r.Int=function(o=0){return{"@type":"int",T:o,valueType:"int"}},r.Float=function(o=0){return{"@type":"float",T:o,valueType:"float"}},r.Tensor=s,r.Vector=function(o,a=r.float){return s(a0.Vector(o,a["@type"]==="int"?Int32Array:Float64Array),a)},r.Matrix=function(o,a,l=r.float){return s(a0.ColumnMajorMatrix(o,a,l["@type"]==="int"?Int32Array:Float64Array),l)},r.Aliased=function(o){return o},r.List=function(o,a,l=[]){return{"@type":"list",T:l,separator:o,itemParse:a,valueType:"list"}}})(e=i.Schema||(i.Schema={})),i.is=function(r){return!!r&&!!r.schema&&!!r.value},i.ValueKind={Present:0,NotPresent:1,Unknown:2},i.Undefined=t,i.ofConst=function(r,s,o){return uO(r,s,o,0)},i.ofLambda=n,i.range=function(r,s){return n({value:o=>o+r,rowCount:Math.max(s-r+1,0),schema:e.int})},i.ofArray=function(r){return nc(r)},i.ofIntArray=function(r){return nc({array:r,schema:e.int})},i.ofFloatArray=function(r){return nc({array:r,schema:e.float})},i.ofStringArray=function(r){return nc({array:r,schema:e.str})},i.ofStringAliasArray=function(r){return nc({array:r,schema:e.Aliased(e.str)})},i.ofStringListArray=function(r,s=","){return nc({array:r,schema:e.List(s,o=>o)})},i.ofIntTokens=function(r){const{count:s,data:o,indices:a}=r;return Hy({value:l=>$p(o,a[2*l],a[2*l+1])||0,rowCount:s,schema:e.int})},i.ofFloatTokens=function(r){const{count:s,data:o,indices:a}=r;return Hy({value:l=>I0(o,a[2*l],a[2*l+1])||0,rowCount:s,schema:e.float})},i.ofStringTokens=function(r){const{count:s,data:o,indices:a}=r;return Hy({value:l=>{const c=o.substring(a[2*l],a[2*l+1]);return c==="."||c==="?"?"":c},rowCount:s,schema:e.str})},i.window=function(r,s,o){return Ufe(r,s,o)},i.view=function(r,s,o=!0){return Ofe(r,s,o)},i.createFirstIndexMap=function(r){return function(s){const o=new Map;for(let a=0,l=s.rowCount;a<l;a++){const c=s.value(a);o.has(c)||o.set(s.value(a),a)}return o}(r)},i.createIndexer=function(r){return function(s){const o=new Map;for(let a=0,l=s.rowCount;a<l;a++){const c=s.value(a);o.has(c)||o.set(s.value(a),a)}return a=>o.has(a)?o.get(a):-1}(r)},i.mapToArray=function(r,s,o){return function(a,l,c){const u=new c(a.rowCount);for(let h=0,d=a.rowCount;h<d;h++)u[h]=l(a.value(h));return u}(r,s,o||Array)},i.areEqual=function(r,s){return function(o,a){return o===a||o.rowCount===a.rowCount&&o.isDefined===a.isDefined&&o.schema.valueType===a.schema.valueType&&(o.__array&&a.__array?function(l,c){const u=l.__array,h=c.__array;for(let d=0,f=l.rowCount;d<f;d++)if(u[d]!==h[d])return!1;return!0}(o,a):function(l,c){const u=l.value,h=c.value;for(let d=0,f=l.rowCount;d<f;d++)if(u(d)!==h(d))return!1;return!0}(o,a))}(r,s)},i.indicesOf=function(r,s){return function(o,a){const l=[],c=o.value;for(let u=0,h=o.rowCount;u<h;u++)a(c(u))&&(l[l.length]=u);return l}(r,s)},i.asArrayColumn=function(r,s){return r.__array?r:r.isDefined?nc({array:r.toArray({array:s}),schema:r.schema,valueKind:r.valueKind}):t(r.rowCount,r.schema)},i.copyToArray=function(r,s,o=0){if(!r.isDefined)return;const a=r.__array;if(a)for(let l=0,c=a.length;l<c;l++)s[o+l]=a[l];else for(let l=0,c=r.rowCount;l<c;l++)s[o+l]=r.value(l)},i.isIdentity=function(r){for(let s=0,o=r.rowCount;s<o;s++)if(s!==r.value(s))return!1;return!0}}(li||(li={})),function(i){i.create=function(e){return e},i.has=function(e,t){return!!(e&t)},i.hasAll=function(e,t){return!!t&&(e&t)===t}}(lO||(lO={})),function(i){i.create=function(r=512){return{current:[],offset:0,capacity:r,chunks:[]}},i.getString=function(r){return r.chunks.length?(r.offset>0&&(r.chunks[r.chunks.length]=r.current.length===r.offset?r.current.join(""):r.current.slice(0,r.offset).join("")),r.chunks.join("")):r.current.length===r.offset?r.current.join(""):r.current.splice(0,r.offset).join("")},i.getSize=function(r){let s=0;for(const o of r.chunks)s+=o.length;for(let o=0;o<r.offset;o++)s+=r.current[o].length;return s},i.getChunks=function(r){return r.offset>0&&(r.current.length===r.offset?r.chunks[r.chunks.length]=r.current.join(""):r.chunks[r.chunks.length]=r.current.slice(0,r.offset).join(""),r.offset=0),r.chunks};const e=[];function t(r,s){s>0&&n(r,e[s])}function n(r,s){r.offset===r.capacity&&(r.chunks[r.chunks.length]=r.current.join(""),r.offset=0),r.current[r.offset++]=s}(function(){let r="";for(let s=0;s<512;s++)e[s]=r,r+=" "})(),i.newline=function(r){n(r,`
`)},i.whitespace=t,i.whitespace1=function(r){n(r," ")},i.write=function(r,s){s&&(r.offset===r.capacity&&(r.chunks[r.chunks.length]=r.current.join(""),r.offset=0),r.current[r.offset++]=s)},i.writeSafe=n,i.writePadLeft=function(r,s,o){if(!s)return void t(r,o);t(r,o-s.length),n(r,s)},i.writePadRight=function(r,s,o){if(!s)return void t(r,o);const a=o-s.length;n(r,s),t(r,a)},i.writeInteger=function(r,s){n(r,""+s)},i.writeIntegerAndSpace=function(r,s){n(r,s+" ")},i.writeIntegerPadLeft=function(r,s,o){const a=""+s;t(r,o-a.length),n(r,a)},i.writeIntegerPadRight=function(r,s,o){const a=""+s,l=o-a.length;n(r,a),t(r,l)},i.writeFloat=function(r,s,o){n(r,""+Math.round(o*s)/o)},i.writeFloatPadLeft=function(r,s,o,a){const l=""+Math.round(o*s)/o;t(r,a-l.length),n(r,l)},i.writeFloatPadRight=function(r,s,o,a){const l=""+Math.round(o*s)/o,c=a-l.length;n(r,l),t(r,c)}}(Es||(Es={}));const xl=function(){if(typeof window<"u"&&window.performance){const i=window.performance;return()=>i.now()}return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?()=>{const i=process.hrtime();return 1e3*i[0]+i[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();var hO,dO,L0;function $fe(i,e){return i-e}function wH(i=0,e=Number.MAX_SAFE_INTEGER){let t=i;return()=>{const n=t;return t=(t+1)%e,n}}(function(i){const e=typeof btoa<"u"?btoa:n=>Buffer.from(n).toString("base64"),t=[];i.create22=function(){let n=+new Date+xl();for(let r=0;r<16;r++)t[r]=String.fromCharCode((n+255*Math.random())%255|0),n=Math.floor(n/255);return e(t.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},i.createv4=function(){let n=+new Date+xl();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const s=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(r==="x"?s:3&s|8).toString(16)})},i.is=function(n){return typeof n=="string"}})(hO||(hO={})),function(i){class e{has(c){return!1}forEach(c,u){return u}constructor(){this.size=0}}class t{has(c){return c===this.idx}forEach(c,u){return c(this.idx,u),u}constructor(c){this.idx=c,this.size=1}}class n{has(c){return c<this.length&&!!this.mask[c]}_forEach(c,u){for(let h=0;h<this.length;h++)this.mask[h]&&c(h,u)}forEach(c,u){return this._forEach(c,u),u}constructor(c,u){this.mask=c,this.size=u,this.length=c.length}}class r{has(c){return!0}_forEach(c,u){for(let h=0;h<this.size;h++)c(h,u)}forEach(c,u){return this._forEach(c,u),u}constructor(c){this.size=c}}class s{has(c){return this.set.has(c)}_forEach(c,u){for(const h of this.flatten())c(h,u)}flatten(){if(this._flat)return this._flat;const c=new Int32Array(this.size);let u=0;return this.set.forEach(h=>c[u++]=h),function(h){Array.prototype.sort.call(h,$fe)}(c),this._flat=c,this._flat}forEach(c,u){return this._forEach(c,u),u}constructor(c){this.set=c,this._flat=void 0,this.size=c.size}}function o(l){return new s(l)}function a(l,c){return new n(l,c)}i.always=function(l){return new r(l)},i.never=new e,i.ofSet=o,i.singleton=function(l){return new t(l)},i.ofUniqueIndices=function(l){const c=l.length;if(c===0)return new e;if(c===1)return new t(l[0]);let u=0;for(const d of l)d>u&&(u=d);if(c===u)return new r(c);if(c/u<1/12){const d=new Set;for(const f of l)d.add(f);return new s(d)}const h=new Int8Array(u+1);for(const d of l)h[d]=1;return new n(h,l.length)},i.ofMask=a,i.hasAny=function(l,c){for(const u of c)if(l.has(u))return!0;return!1},i.complement=function(l,c){let u=0,h=0;if(c.forEach(d=>{l.has(d)||(u++,d>h&&(h=d))}),u/h<1/12){const d=new Set;return c.forEach(f=>{l.has(f)||d.add(f)}),o(d)}{const d=new Uint8Array(h+1);return c.forEach(f=>{l.has(f)||(d[f]=1)}),a(d,u)}}}(dO||(dO={})),function(i){i.create=function(e){return{ref:e}},i.set=function(e,t){return e.ref=t,e}}(L0||(L0={}));const Wfe=wH(0,2147483647);var $y,fO,Wy,XC,Wp;function jfe(i){const{data:e,indices:t}=i;return function(n,r){const s=t[2*n],o=t[2*r],a=t[2*n+1]-s;if(a!==t[2*r+1]-o)return!1;for(let l=0;l<a;l++)if(e.charCodeAt(l+s)!==e.charCodeAt(l+o))return!1;return!0}}function MH(i,e){return{name:e,blocks:i}}function U3(i,e,t,n=[]){return{categoryNames:i,header:t,categories:e,saveFrames:n,getField(r){const[s,o]=r.split(".");return e[s].getField(o||"")}}}function Gb(i,e,t,n){return{rowCount:e,name:i,fieldNames:[...t],getField:r=>n[r]}}(function(i){i.create=function(e,t){return{id:Wfe(),version:0,value:e,metadata:t}},i.withValue=function(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}})($y||($y={})),function(i){function e(t,n){return L0.set(t,$y.withValue(t.ref,n))}i.create=function(t,n){return L0.create($y.create(t,n))},i.update=e,i.set=function(t,n){return L0.set(t,n)},i.updateIfChanged=function(t,n){return t.ref.value!==n?e(t,n):t}}(fO||(fO={})),function(i){function e(n,r,s){const o=Object.create(null),a=Object.keys(r);o._rowCount=s.length,o._columns=a,o._schema=r;for(const l of a)o[l]=li.view(n[l],s);return o}function t(n,r){const s=Object.create(null),{_columns:o}=n;for(let a=0;a<o.length;a++){const l=o[a];s[l]=n[l].value(r)}return s}i.is=function(n){return n&&typeof n._rowCount=="number"&&!!n._columns&&!!n._schema},i.pickColumns=function(n,r,s={}){const o=Object.create(null),a=Object.keys(n);o._rowCount=r._rowCount,o._columns=a,o._schema=n;for(const l of a)if(r[l])o[l]=r[l];else{if(!s[l])throw Error(`Cannot find column '${l}'.`);o[l]=s[l]}return o},i.ofColumns=function(n,r){const s=Object.keys(r);return{_rowCount:r[s[0]].rowCount,_columns:s,_schema:n,...r}},i.ofPartialColumns=function(n,r,s){const o=Object.create(null),a=Object.keys(n);o._rowCount=s,o._columns=a,o._schema=n;for(const l of a)o[l]=l in r?r[l]:li.Undefined(s,n[l]);return o},i.ofUndefinedColumns=function(n,r){const s=Object.create(null),o=Object.keys(n);s._rowCount=r,s._columns=o,s._schema=n;for(const a of o)s[a]=li.Undefined(r,n[a]);return s},i.ofRows=function(n,r){const s=Object.create(null),o=r.length,a=Object.keys(n);s._rowCount=o,s._columns=a,s._schema=n;for(const l of a)s[l]=li.ofLambda({rowCount:o,schema:n[l],value:c=>r[c][l],valueKind:c=>r[c][l]===void 0?1:0});return s},i.ofArrays=function(n,r){var s;const o=Object.create(null),a=Object.keys(n);o._rowCount=0,o._columns=a,o._schema=n;for(const l of a)r[l]!==void 0?(o[l]=li.ofArray({array:r[l],schema:n[l]}),o._rowCount=(s=r[l])===null||s===void 0?void 0:s.length):o[l]=li.Undefined(o._rowCount,n[l]);return o},i.view=e,i.pick=function(n,r,s){const o=[];for(let a=0,l=n._rowCount;a<l;++a)s(a)&&o.push(a);return e(n,r,o)},i.window=function(n,r,s,o){if(s===0&&o===n._rowCount)return n;const a=Object.create(null),l=Object.keys(r);a._rowCount=o-s,a._columns=l,a._schema=r;for(const c of l)a[c]=li.window(n[c],s,o);return a},i.concat=function(n,r){const s=Object.create(null),o=Object.keys(r);s._rowCount=0;for(const c of n)s._rowCount+=c._rowCount;const a={};for(const c of o)a[c]=new Array(s._rowCount);s._columns=o,s._schema=r;let l=0;for(const c of n){for(const u of o)li.copyToArray(c[u],a[u],l);l+=c._rowCount}for(const c of o)s[c]=li.ofArray({array:a[c],schema:r[c]});return s},i.columnToArray=function(n,r,s){n[r]=li.asArrayColumn(n[r],s)},i.sort=function(n,r){const s=new Int32Array(n._rowCount);for(let l=0,c=s.length;l<c;l++)s[l]=l;Hfe(s,(l,c,u)=>r(c,u));let o=!0;for(let l=0,c=s.length;l<c;l++)if(s[l]!==l){o=!1;break}if(o)return n;const a=Object.create(null);a._rowCount=n._rowCount,a._columns=n._columns,a._schema=n._schema;for(const l of n._columns)a[l]=li.view(n[l],s,!1);return a},i.areEqual=function(n,r){if(n._rowCount!==r._rowCount||n._columns.length!==r._columns.length)return!1;for(const s of n._columns)if(!r[s])return!1;for(const s of n._columns)if(!li.areEqual(n[s],r[s]))return!1;return!0},i.getRow=t,i.pickRow=function(n,r){for(let s=0,o=n._rowCount;s<o;++s)if(r(s))return t(n,s)},i.getRows=function(n){const r=[],{_rowCount:s}=n;for(let o=0;o<s;o++)r[o]=t(n,o);return r},i.toArrays=function(n){const r={},{_columns:s}=n;for(let o=0;o<s.length;o++){const a=s[o];r[a]=n[a].toArray()}return r},i.formatToString=function(n){const r=Es.create(),{_columns:s,_rowCount:o}=n;let a=1;Es.write(r,"|");for(let l=0;l<s.length;l++)Es.write(r,s[l]),Es.write(r,"|"),a+=s[l].length+1;Es.newline(r),Es.write(r,new Array(a+1).join("-")),Es.newline(r);for(let l=0;l<o;l++){Es.write(r,"|");for(let c=0;c<s.length;c++){const u=n[s[c]];u.valueKind(l)===0?(Es.write(r,u.value(l)),Es.write(r,"|")):Es.write(r,".|")}Es.newline(r)}return Es.getString(r)}}(Wy||(Wy={})),function(i){i.ofTables=function(e,t,n){const r=Object.keys(n),s=Object.create(null),o=[];s._name=e,s._tableNames=o,s._schema=t;for(const a of r)Wy.is(n[a])&&(s[a]=n[a],o[o.length]=a);return s},i.getTablesAsRows=function(e){const t={};for(const n of e._tableNames)t[n]=Wy.getRows(e[n]);return t}}(XC||(XC={})),function(i){function e(t,n){const r=Object.keys(n);return{rowCount:r.length>0?n[r[0]].rowCount:0,name:t,fieldNames:r,getField:s=>n[s]}}i.empty=function(t){return{rowCount:0,name:t,fieldNames:[],getField(n){}}},i.ofFields=e,i.ofTable=function(t,n){const r={};for(const s of n._columns)r[s]=Wp.ofColumn(n[s]);return e(t,r)}}(Gb||(Gb={})),function(i){function e(n){const r=n.length,s=l=>{const c=n[l];return c&&c!=="."&&c!=="?"?c:""},o=l=>{const c=n[l];return $p(c,0,c.length)||0},a=l=>{const c=n[l];return I0(c,0,c.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:r,str:s,int:o,float:a,valueKind:l=>{const c=n[l],u=c.length;if(u>1)return 0;if(u===0)return 1;const h=c.charCodeAt(0);return h===46?1:h===63?2:0},areValuesEqual:(l,c)=>n[l]===n[c],toStringArray:l=>l?as(r,s,l):n,toIntArray:l=>as(r,o,l),toFloatArray:l=>as(r,a,l)}}function t(n){const{rowCount:r,valueKind:s,areValuesEqual:o,isDefined:a}=n;let l,c,u;switch(n.schema.valueType){case"float":case"int":l=d=>""+n.value(d),c=n.value,u=n.value;break;case"str":l=n.value,c=d=>{const f=n.value(d);return $p(f,0,f.length)||0},u=d=>{const f=n.value(d);return I0(f,0,f.length)||0};break;case"list":const{separator:h}=n.schema;l=d=>n.value(d).join(h),c=d=>NaN,u=d=>NaN;break;default:throw new Error(`unsupported valueType '${n.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:a,rowCount:r,str:l,int:c,float:u,valueKind:s,areValuesEqual:o,toStringArray:h=>as(r,l,h),toIntArray:h=>as(r,c,h),toFloatArray:h=>as(r,u,h)}}i.ofString=function(n){return e([n])},i.ofStrings=e,i.ofNumbers=function(n){const r=n.length,s=l=>""+n[l],o=l=>n[l],a=l=>!l||l.array&&n instanceof l.array?n:as(r,o,l);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:r,str:s,int:o,float:o,valueKind:l=>0,areValuesEqual:(l,c)=>n[l]===n[c],toStringArray:l=>as(r,s,l),toIntArray:a,toFloatArray:a}},i.ofTokens=function(n){const{data:r,indices:s,count:o}=n,a=u=>{const h=r.substring(s[2*u],s[2*u+1]);return h==="."||h==="?"?"":h},l=u=>$p(r,s[2*u],s[2*u+1])||0,c=u=>I0(r,s[2*u],s[2*u+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:o,str:a,int:l,float:c,valueKind:u=>{const h=s[2*u],d=s[2*u+1]-h;if(d>1)return 0;if(d===0)return 1;const f=r.charCodeAt(h);return f===46?1:f===63?2:0},areValuesEqual:jfe(n),toStringArray:u=>as(o,a,u),toIntArray:u=>as(o,l,u),toFloatArray:u=>as(o,c,u)}},i.ofColumn=t,i.ofUndefined=function(n,r){return t(li.Undefined(n,r))}}(Wp||(Wp={}));const qC=typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(i,...e)=>window.setImmediate(i,...e),clearImmediate:i=>window.clearImmediate(i)}:{setImmediate,clearImmediate}:function(){const i=function(){const a=typeof window<"u"&&window,l=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return a||typeof global<"u"&&global||l}(),e={},t=typeof document<"u"?document:void 0;let n,r=1;function s(a){delete e[a]}function o(a){const l=e[a];s(a),function(c){const u=c.callback,h=c.args;switch(h.length){case 0:u();break;case 1:u(h[0]);break;case 2:u(h[0],h[1]);break;case 3:u(h[0],h[1],h[2]);break;default:u.apply(void 0,h)}}(l)}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?n=function(a){process.nextTick(function(){o(a)})}:function(){if(i&&i.postMessage&&!i.importScripts){let a=!0;const l=i.onmessage;return i.onmessage=function(){a=!1},i.postMessage("","*"),i.onmessage=l,a}}()?function(){const a="setImmediate$"+Math.random()+"$",l=function(c){c.source===i&&typeof c.data=="string"&&c.data.indexOf(a)===0&&o(+c.data.slice(a.length))};window.addEventListener?window.addEventListener("message",l,!1):window.attachEvent("onmessage",l),n=function(c){window.postMessage(a+c,"*")}}():typeof MessageChannel<"u"?function(){const a=new MessageChannel;a.port1.onmessage=function(l){o(l.data)},n=function(l){a.port2.postMessage(l)}}():t&&"onreadystatechange"in t.createElement("script")?function(){const a=t.documentElement;n=function(l){let c=t.createElement("script");c.onreadystatechange=function(){o(l),c.onreadystatechange=null,a.removeChild(c),c=null},a.appendChild(c)}}():n=function(a){setTimeout(o,0,a)},{setImmediate:function(a,...l){typeof a!="function"&&(a=new Function(""+a));const c={callback:a,args:l};return e[r]=c,n(r),r++},clearImmediate:s}}();function Xfe(i){qC.setImmediate(i)}const qfe={setImmediate:qC.setImmediate,clearImmediate:qC.clearImmediate,immediatePromise:()=>new Promise(Xfe),delay:(i,e=void 0)=>new Promise(t=>setTimeout(t,i,e))};(function(){try{return!0}catch{return!1}})(),function(){try{const i=jle.DEBUG;return i==="*"||i==="molstar"}catch{return!1}}();var D0;function Yfe(i,e,t=250){const n=function(r,s,o){const a={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:o,lastNotified:xl(),observer:s,abortToken:a,taskId:r.id,root:{progress:AH(r),children:[]},tryAbort:Kfe(a)}}(i,e,t);return O3(i,new B3(n,n.root))}function AH(i){return{taskId:i.id,taskName:i.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function Kfe(i){return e=>{i.abortRequested=!0,i.reason=e||i.reason}}function EH(i){return{progress:{...i.progress},children:i.children.map(EH)}}function TH(i){return i.progress.canAbort&&i.children.every(TH)}async function O3(i,e){D0.markStart(i),e.node.progress.startedTime=xl();try{const t=await i.f(e);return D0.markEnd(i),D0.measure(i),e.info.abortToken.abortRequested&&CH(e.info),t}catch(t){throw Fd.isAbort(t)&&(e.isAborted=!0,e.node.children.length>0&&await new Promise(n=>{e.onChildrenFinished=n}),i.onAbort&&i.onAbort()),t}}function CH(i){throw i.abortToken.treeAborted||(i.abortToken.treeAborted=!0,PH(i.root),RH(i,xl())),Fd.Aborted(i.abortToken.reason)}function PH(i){const e=i.progress;e.isIndeterminate=!0,e.canAbort=!1,e.message="Aborting...";for(const t of i.children)PH(t)}function RH(i,e){i.lastNotified=e;const t=function(n){return{root:EH(n.root),canAbort:TH(n.root),requestAbort:n.tryAbort}}(i);i.observer(t)}(function(i){i.markStart=function(e){},i.markEnd=function(e){},i.measure=function(e){}})(D0||(D0={}));class B3{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,CH(this.info))}get shouldUpdate(){return this.checkAborted(),xl()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return;const t=this.node.progress;typeof e=="string"?(t.message=e,t.isIndeterminate=!0):(e.canAbort!==void 0&&(t.canAbort=e.canAbort),e.message!==void 0&&(t.message=e.message),e.current!==void 0&&(t.current=e.current),e.max!==void 0&&(t.max=e.max),t.isIndeterminate=t.current===void 0||t.max===void 0,e.isIndeterminate!==void 0&&(t.isIndeterminate=e.isIndeterminate))}update(e,t){if(this.lastUpdatedTime=xl(),this.updateProgress(e),!t)return RH(this.info,this.lastUpdatedTime),this.checkAborted(),qfe.immediatePromise()}async runChild(e,t){this.updateProgress(t);const n={progress:AH(e),children:[]},r=this.node.children;r.push(n);const s=new B3(this.info,n);try{return await O3(e,s)}catch(o){if(Fd.isAbort(o)&&this.isAborted)return;throw o}finally{const o=r.indexOf(n);if(o>=0){for(let a=o,l=r.length-1;a<l;a++)r[a]=r[a+1];r.pop()}r.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}}const jy=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(i,e){}};var Fd,pO,mO,ba,vd,hn;async function YC(i,e,t,n,r){let s=Math.max(e,0),o=0,a=0;if(i.isSynchronous)return n(Number.MAX_SAFE_INTEGER,t),t;let l=xl(),c=0,u=0;for(;(c=n(s,t))>0;){o+=c;const h=xl()-l;u+=h,a+=h,i.shouldUpdate&&(await r(i,t,o),s=Math.round(u*o/a)+1,l=xl(),u=0)}return i.shouldUpdate&&await r(i,t,o),t}function KC(i){return{data:i,position:0,length:i.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function gO(i){for(;i.position<i.length;)switch(i.data.charCodeAt(i.position)){case 9:case 10:case 13:case 32:return void(i.tokenEnd=i.position);default:++i.position}i.tokenEnd=i.position}function vO(i){return!(i.length-i.position<2)&&i.data.charCodeAt(i.position+1)===39&&i.data.charCodeAt(i.position+2)===39}function Zfe(i,e,t){let n;const r=t-e,s=i.tokenStart-e,o=i.tokenEnd-i.tokenStart;if(o<r)return!1;for(n=e;n<t;++n)if(i.data.charCodeAt(n)!==i.data.charCodeAt(n+s))return!1;return r===o||i.data.charCodeAt(n+s)===46}function IH(i){let e;for(e=i.tokenStart;e<i.tokenEnd;++e)if(i.data.charCodeAt(e)===46)return e;return e}function LH(i,e){return i.data.substring(i.tokenStart,e)}function ZC(i){return i.data.substring(i.tokenStart,i.tokenEnd)}function _O(i){const e=function(n){let r=10;for(;n.position<n.length;){const s=n.data.charCodeAt(n.position);switch(s){case 9:case 32:r=s,++n.position;break;case 10:r!==13&&++n.lineNumber,r=s,++n.position;break;case 13:r=s,++n.position,++n.lineNumber;break;default:return r}}return r}(i);if(i.position>=i.length)return void(i.tokenType=6);i.tokenStart=i.position,i.tokenEnd=i.position,i.isEscaped=!1;const t=i.data.charCodeAt(i.position);switch(t){case 35:(function(n){for(;n.position<n.length;){const r=n.data.charCodeAt(n.position);if(r===10||r===13)return;++n.position}})(i),i.tokenType=5;break;case 39:if(vO(i)){(function(n){for(n.position+=3;n.position<n.length;){if(n.data.charCodeAt(n.position)===39&&vO(n))return n.tokenStart+=3,n.tokenEnd=n.position,n.isEscaped=!0,void(n.position+=3);++n.position}n.tokenEnd=n.position})(i),i.tokenType=3;break}case 34:(function(n,r){let s,o;for(++n.position;n.position<n.length;)if(o=n.data.charCodeAt(n.position),o===r)switch(s=n.data.charCodeAt(n.position+1),s){case 9:case 10:case 13:case 32:return n.tokenStart++,n.tokenEnd=n.position,n.isEscaped=!0,void++n.position;default:if(s===void 0)return n.tokenStart++,n.tokenEnd=n.position,n.isEscaped=!0,void++n.position;++n.position}else{if(o===10||o===13)return void(n.tokenEnd=n.position);++n.position}n.tokenEnd=n.position})(i,t),i.tokenType=3;break;case 59:e===10||e===13?function(n){let r,s=59,o=n.position+1;for(;o<n.length;){if(r=n.data.charCodeAt(o),r===59&&(s===10||s===13)){for(n.position=o+1,n.tokenStart++,o--,r=n.data.charCodeAt(o);r===10||r===13;)o--,r=n.data.charCodeAt(o);return n.tokenEnd=o+1,void(n.isEscaped=!0)}(r===13||r===10&&s!==13)&&n.lineNumber++,s=r,++o}n.position=o}(i):gO(i),i.tokenType=3;break;default:i.isImportGet?function(n){for(;n.position<n.length;){if(n.data.charCodeAt(n.position)===93)return++n.position,n.tokenEnd=n.position,void(n.isImportGet=!1);++n.position}}(i):gO(i),i.isEscaped?i.tokenType=3:i.data.charCodeAt(i.tokenStart)===95?(i.inSaveFrame&&function(n){return n.tokenEnd-n.tokenStart==11&&n.data.charCodeAt(n.tokenStart+1)===105&&n.data.charCodeAt(n.tokenStart+2)===109&&n.data.charCodeAt(n.tokenStart+3)===112&&n.data.charCodeAt(n.tokenStart+4)===111&&n.data.charCodeAt(n.tokenStart+5)===114&&n.data.charCodeAt(n.tokenStart+6)===116&&n.data.charCodeAt(n.tokenStart+7)===46&&n.data.charCodeAt(n.tokenStart+8)===103&&n.data.charCodeAt(n.tokenStart+9)===101&&n.data.charCodeAt(n.tokenStart+10)===116}(i)&&(i.isImportGet=!0),i.tokenType=4):i.tokenEnd-i.tokenStart>=5&&i.data.charCodeAt(i.tokenStart+4)===95?function(n){let r=n.data.charCodeAt(n.tokenStart);return!(r!==68&&r!==100||(r=n.data.charCodeAt(n.tokenStart+1),r!==65&&r!==97||(r=n.data.charCodeAt(n.tokenStart+2),r!==84&&r!==116||(r=n.data.charCodeAt(n.tokenStart+3),r!==65&&r!==97))))}(i)?i.tokenType=0:function(n){let r=n.data.charCodeAt(n.tokenStart);return!(r!==83&&r!==115||(r=n.data.charCodeAt(n.tokenStart+1),r!==65&&r!==97||(r=n.data.charCodeAt(n.tokenStart+2),r!==86&&r!==118||(r=n.data.charCodeAt(n.tokenStart+3),r!==69&&r!==101))))}(i)?i.tokenType=1:function(n){if(n.tokenEnd-n.tokenStart!=5)return!1;let r=n.data.charCodeAt(n.tokenStart);return!(r!==76&&r!==108||(r=n.data.charCodeAt(n.tokenStart+1),r!==79&&r!==111||(r=n.data.charCodeAt(n.tokenStart+2),r!==79&&r!==111||(r=n.data.charCodeAt(n.tokenStart+3),r!==80&&r!==112))))}(i)?i.tokenType=2:i.tokenType=3:i.tokenType=3}}function Fu(i){for(_O(i);i.tokenType===5;)_O(i)}function Xy(){return{categoryNames:[],categoryData:Object.create(null)}}function z3(i,e){const t=Object.create(null);for(const n of i){const r=e[n];t[n]=Gb(r.name,r.rowCount,r.fieldNames,r.fields)}return t}function yO(i,e,t){return U3(i.categoryNames,z3(i.categoryNames,i.categoryData),e,t)}function Qfe(i,e){return U3(i.categoryNames,z3(i.categoryNames,i.categoryData),e)}function QC(i,e,t,n,r){if(e in i.categoryData){const s=i.categoryData[e];s.fieldNames.push(...n),Object.assign(s.fields,r)}else i.categoryData[e]={name:e,rowCount:t,fieldNames:n,fields:r},i.categoryNames.push(e)}function Jfe(i,e){const t=i.tokenStart,n=IH(i),r=LH(i,n),s=Object.create(null),o=[];let a=!0;for(;a;){if(i.tokenType!==4||!Zfe(i,t,n)){a=!1;break}const l=ZC(i).substring(r.length+1);if(Fu(i),i.tokenType!==3)return{hasError:!0,errorLine:i.lineNumber,errorMessage:"Expected value."};s[l]=Wp.ofTokens({data:i.data,indices:[i.tokenStart,i.tokenEnd],count:1}),o[o.length]=l,Fu(i)}return QC(e,r.substr(1),1,o,s),{hasError:!1,errorLine:0,errorMessage:""}}function epe(i,e){const{tokenizer:t,tokens:n,fieldCount:r}=e;let s=e.tokenCount,o=0;for(;t.tokenType===3&&o<i;)ba.add(n[s++%r],t.tokenStart,t.tokenEnd),Fu(t),o++;return e.tokenCount=s,o}function tpe(i,e){return i.update({message:"Parsing...",current:e.tokenizer.position,max:e.tokenizer.data.length})}async function npe(i,e){const t=i.lineNumber;Fu(i);const n=LH(i,IH(i)),r=function(h){let d;for(d=h.tokenStart;d<h.tokenEnd;++d)if(h.data.charCodeAt(d)===46)return!1;return!0}(i),s=[];for(;i.tokenType===4;)s[s.length]=r?ZC(i):ZC(i).substring(n.length+1),Fu(i);const o=n==="_atom_site"?i.data.length/100|0:32,a=[],l=s.length;for(let h=0;h<l;h++)a[h]=ba.create(i.data,o);const c={fieldCount:l,tokenCount:0,tokenizer:i,tokens:a};if(await YC(i.runtimeCtx,1e6,c,epe,tpe),c.tokenCount%l!=0)return{hasError:!0,errorLine:i.lineNumber,errorMessage:`The number of values for loop starting at line ${t} is not a multiple of the number of columns.`};const u=c.tokenCount/l|0;if(r)for(let h=0;h<l;h++){const d={"":Wp.ofTokens(a[h])};QC(e,s[h].substr(1),u,[""],d)}else{const h=Object.create(null);for(let d=0;d<l;d++)h[s[d]]=Wp.ofTokens(a[d]);QC(e,n.substr(1),u,s,h)}return{hasError:!1,errorLine:0,errorMessage:""}}function Jf(i,e){return vd.error(e,i)}async function ipe(i,e){const t=[],n=function(u,h){return{data:u,length:u.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:h}}(i,e);let r="",s=Xy(),o=[],a=Xy();const l=function(u,h,d){return{categoryNames:u,header:d,categories:h}}(a.categoryNames,z3(a.categoryNames,a.categoryData),"");let c="";for(e.update({message:"Parsing...",current:0,max:i.length}),Fu(n);n.tokenType!==6;){const u=n.tokenType;if(u===0){if(n.inSaveFrame)return Jf(n.lineNumber,"Unexpected data block inside a save frame.");s.categoryNames.length>0&&t.push(yO(s,r,o)),r=i.substring(n.tokenStart+5,n.tokenEnd),s=Xy(),o=[],Fu(n)}else if(u===1){if(n.tokenEnd-n.tokenStart==5)a.categoryNames.length>0&&(o[o.length]=Qfe(a,c)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return Jf(n.lineNumber,"Save frames cannot be nested.");n.inSaveFrame=!0,c=i.substring(n.tokenStart+5,n.tokenEnd),a=Xy()}Fu(n)}else if(u===2){const h=await npe(n,n.inSaveFrame?a:s);if(h.hasError)return Jf(h.errorLine,h.errorMessage)}else{if(u!==4)return console.log(n.tokenType,KC.getTokenString(n)),Jf(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const h=Jfe(n,n.inSaveFrame?a:s);if(h.hasError)return Jf(h.errorLine,h.errorMessage)}}}return n.inSaveFrame?Jf(n.lineNumber,`Unfinished save frame (${l.header}).`):((s.categoryNames.length>0||o.length>0)&&t.push(yO(s,r,o)),function(u){return vd.success(u)}(MH(t)))}function xO(i){return Fd.create("Parse CIF",async e=>await ipe(i,e))}(function(i){class e{run(o,a=250){return o?Yfe(this,o,a):this.f(jy)}runAsChild(o,a){return o.isSynchronous?this.f(jy):function(l,c,u){return l.runChild(c,u)}(o,this,a)}runInContext(o){return o.isSynchronous?this.f(jy):function(a,l){return O3(l,a)}(o,this)}constructor(o,a,l){this.name=o,this.f=a,this.onAbort=l,this.id=r()}}function t(s){const o=s;return!!s&&typeof o.id=="number"&&typeof o.name=="string"&&!!o.run}function n(s,o,a){return new e(s,o,a)}i.is=t,i.isAbort=function(s){return!!s&&!!s.isAborted},i.Aborted=function(s){return{isAborted:!0,reason:s,toString:()=>"Aborted"+(s?": "+s:"")}},i.create=n,i.constant=function(s,o){return n(s,async a=>o)},i.empty=function(){return n("",async s=>{})},i.fail=function(s,o){return n(s,async a=>{throw new Error(o)})},i.resolveInContext=function(s,o){return t(s)?o?s.runInContext(o):s.run():s};const r=wH(0,1073741823)})(Fd||(Fd={})),function(i){i.Synchronous=jy}(pO||(pO={})),function(i){function e(t,n=""){const r=t.progress;if(!t.children.length)return r.isIndeterminate?`${n}${r.taskName}: ${r.message}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}`;const s=n+"  |_ ",o=t.children.map(a=>e(a,s));return r.isIndeterminate?`${n}${r.taskName}: ${r.message}
${o.join(`
`)}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}
${o.join(`
`)}`}i.format=function(t){return e(t.root)}}(mO||(mO={})),function(i){function e(o){return o.data.substring(o.tokenStart,o.tokenEnd)}function t(o){const{data:a}=o;for(;o.position<o.length;)switch(a.charCodeAt(o.position)){case 10:return o.tokenEnd=o.position,++o.position,++o.lineNumber,!0;case 13:return o.tokenEnd=o.position,++o.position,++o.lineNumber,a.charCodeAt(o.position)===10&&++o.position,!0;default:++o.position}return o.tokenEnd=o.position,o.tokenStart!==o.tokenEnd}function n(o){return o.tokenStart=o.position,t(o)}function r(o,a,l){let c=0;for(let u=0;u<a;u++){if(!n(o))return c;ba.addUnchecked(l,o.tokenStart,o.tokenEnd),c++}return c}function s(o,a,l){const{data:c}=o;let u=a,h=l-1,d=c.charCodeAt(u);for(;(d===9||d===32)&&u<=h;)d=c.charCodeAt(++u);for(d=c.charCodeAt(h);(d===9||d===32)&&h>=u;)d=c.charCodeAt(--h);return o.tokenStart=u,o.tokenEnd=h+1,o.position=l,o}i.getTokenString=e,i.reset=function(o){o.position=0,o.lineNumber=1,o.tokenStart=0,o.tokenEnd=0},i.eatLine=t,i.markStart=function(o){o.tokenStart=o.position},i.markLine=n,i.readLine=function(o){return n(o),e(o)},i.readLineTrim=function(o){n(o);const a=o.position;return s(o,o.tokenStart,o.tokenEnd),o.position=a,e(o)},i.markLines=function(o,a){const l=ba.create(o.data,2*a);return r(o,a,l),l},i.readLines=function(o,a){const l=[];for(let c=0;c<a;c++)l.push(i.readLine(o));return l},i.readLinesAsync=async function(o,a,l,c=1e5){const u=ba.create(o.data,2*a);let h=0;return await YC(l,c,o,(d,f)=>{const p=Math.min(a-h,d);return r(f,p,u),h+=p,p},(d,f)=>d.update({message:"Parsing...",current:f.position,max:f.length})),u},i.readAllLines=function(o){const a=i(o),l=ba.create(a.data,Math.max(o.length/80,2));for(;n(a);)ba.add(l,a.tokenStart,a.tokenEnd);return l},i.readAllLinesAsync=async function(o,a,l=1e5){const c=i(o),u=ba.create(c.data,Math.max(o.length/80,2));return await YC(a,l,c,(h,d)=>(function(f,p,_){let v=0;for(let g=0;g<p;g++){if(!n(f))return v;ba.add(_,f.tokenStart,f.tokenEnd),v++}}(d,h,u),d.position<d.length?h:0),(h,d)=>h.update({message:"Parsing...",current:d.position,max:d.length})),u},i.eatValue=function(o){for(;o.position<o.length;)switch(o.data.charCodeAt(o.position)){case 9:case 10:case 13:case 32:return void(o.tokenEnd=o.position);default:++o.position}o.tokenEnd=o.position},i.skipWhitespace=function(o){let a=-1;for(;o.position<o.length;){const l=o.data.charCodeAt(o.position);switch(l){case 9:case 32:a=l,++o.position;break;case 10:a!==13&&++o.lineNumber,a=l,++o.position;break;case 13:a=l,++o.position,++o.lineNumber;break;default:return a}}return a},i.trim=s}(KC||(KC={})),function(i){function e(t,n,r){const s=t;s.offset>s.indicesLenMinus2&&function(o){const a=new Uint32Array(1.61*o.indices.length|0);a.set(o.indices),o.indices=a,o.indicesLenMinus2=a.length-2|0}(s),s.indices[s.offset++]=n,s.indices[s.offset++]=r,t.count++}i.add=e,i.addToken=function(t,n){e(t,n.tokenStart,n.tokenEnd)},i.addUnchecked=function(t,n,r){t.indices[t.offset++]=n,t.indices[t.offset++]=r,t.count++},i.create=function(t,n){return{data:t,indicesLenMinus2:(n=Math.max(10,n))-2|0,count:0,offset:0,indices:new Uint32Array(n)}}}(ba||(ba={})),function(i){i.error=function(n,r=-1){return new e(n,r)},i.success=function(n,r=[]){return new t(n,r)};class e{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(r,s){this.message=r,this.line=s,this.isError=!0}}i.Error=e;class t{constructor(r,s){this.result=r,this.warnings=s,this.isError=!1}}i.Success=t}(vd||(vd={})),function(i){var e,t;(e=i.IntDataType||(i.IntDataType={}))[e.Int8=1]="Int8",e[e.Int16=2]="Int16",e[e.Int32=3]="Int32",e[e.Uint8=4]="Uint8",e[e.Uint16=5]="Uint16",e[e.Uint32=6]="Uint32",(t=i.FloatDataType||(i.FloatDataType={}))[t.Float32=32]="Float32",t[t.Float64=33]="Float64",i.getDataType=function(n){let r;return r=n instanceof Int8Array?i.IntDataType.Int8:n instanceof Int16Array?i.IntDataType.Int16:n instanceof Int32Array?i.IntDataType.Int32:n instanceof Uint8Array?i.IntDataType.Uint8:n instanceof Uint16Array?i.IntDataType.Uint16:n instanceof Uint32Array?i.IntDataType.Uint32:n instanceof Float32Array?i.FloatDataType.Float32:n instanceof Float64Array?i.FloatDataType.Float64:i.IntDataType.Int32,r},i.isSignedIntegerDataType=function(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(let r=0,s=n.length;r<s;r++)if(r<0)return!1;return!0}}(hn||(hn={}));const rpe=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function Vb(i){let e=i.data;for(let t=i.encoding.length-1;t>=0;t--)e=spe(e,i.encoding[t]);return e}function spe(i,e){switch(e.kind){case"ByteArray":switch(e.type){case hn.IntDataType.Uint8:return i;case hn.IntDataType.Int8:return function(t){return new Int8Array(t.buffer,t.byteOffset)}(i);case hn.IntDataType.Int16:return function(t){return ep(t,2,Int16Array)}(i);case hn.IntDataType.Uint16:return function(t){return ep(t,2,Uint16Array)}(i);case hn.IntDataType.Int32:return function(t){return ep(t,4,Int32Array)}(i);case hn.IntDataType.Uint32:return function(t){return ep(t,4,Uint32Array)}(i);case hn.FloatDataType.Float32:return function(t){return ep(t,4,Float32Array)}(i);case hn.FloatDataType.Float64:return function(t){return ep(t,8,Float64Array)}(i);default:zb(e.type)}case"FixedPoint":return function(t,n){const r=t.length,s=SO(n.srcType,r),o=1/n.factor;for(let a=0;a<r;a++)s[a]=o*t[a];return s}(i,e);case"IntervalQuantization":return function(t,n){const r=t.length,s=SO(n.srcType,r),o=(n.max-n.min)/(n.numSteps-1),a=n.min;for(let l=0;l<r;l++)s[l]=a+o*t[l];return s}(i,e);case"RunLength":return function(t,n){const r=bO(n.srcType,n.srcSize);let s=0;for(let o=0,a=t.length;o<a;o+=2){const l=t[o],c=t[o+1];for(let u=0;u<c;++u)r[s++]=l}return r}(i,e);case"Delta":return function(t,n){const r=t.length,s=bO(n.srcType,r);if(!r)return t;s[0]=t[0]+(0|n.origin);for(let o=1;o<r;++o)s[o]=t[o]+s[o-1];return s}(i,e);case"IntegerPacking":return function(t,n){return t.length===n.srcSize?t:n.isUnsigned?function(r,s){const o=s.byteCount===1?255:65535,a=r.length,l=new Int32Array(s.srcSize);let c=0,u=0;for(;c<a;){let h=0,d=r[c];for(;d===o;)h+=d,c++,d=r[c];h+=d,l[u]=h,c++,u++}return l}(t,n):function(r,s){const o=s.byteCount===1?127:32767,a=-o-1,l=r.length,c=new Int32Array(s.srcSize);let u=0,h=0;for(;u<l;){let d=0,f=r[u];for(;f===o||f===a;)d+=f,u++,f=r[u];d+=f,c[h]=d,u++,h++}return c}(t,n)}(i,e);case"StringArray":return function(t,n){const r=Vb({encoding:n.offsetEncoding,data:n.offsets}),s=Vb({encoding:n.dataEncoding,data:t}),o=n.stringData,a=new Array(r.length);a[0]="";for(let u=1,h=r.length;u<h;u++)a[u]=o.substring(r[u-1],r[u]);let l=0;const c=new Array(s.length);for(let u=0,h=s.length;u<h;u++)c[l++]=a[s[u]+1];return c}(i,e)}}function bO(i,e){switch(i){case hn.IntDataType.Int8:return new Int8Array(e);case hn.IntDataType.Int16:return new Int16Array(e);case hn.IntDataType.Int32:return new Int32Array(e);case hn.IntDataType.Uint8:return new Uint8Array(e);case hn.IntDataType.Uint16:return new Uint16Array(e);case hn.IntDataType.Uint32:return new Uint32Array(e);default:return new Int32Array(e)}}function SO(i,e){switch(i){case hn.FloatDataType.Float32:return new Float32Array(e);case hn.FloatDataType.Float64:default:return new Float64Array(e)}}function ep(i,e,t){return new t(rpe?i.buffer:function(n,r){const s=new ArrayBuffer(n.length),o=new Uint8Array(s);for(let a=0,l=n.length;a<l;a+=r)for(let c=0;c<r;c++)o[a+r-c-1]=n[a+c];return s}(i,e))}var Pp,c0,wO,MO,Cn;function ope(i,e,t){let n,r=1;for(n=0;n<e;n++){const s=r*i;if(Math.abs(Math.round(s)-s)<=t)return n;r*=10}return-1}function AO(i){return c0.classify(i)}(function(i){function e(n){const r=n.growBy*n.elementSize;n.currentSize=r,n.currentIndex=0,n.currentChunk=new n.ctor(r),n.allocatedSize+=r,n.chunks[n.chunks.length]=n.currentChunk}function t(n,r){const{ctor:s,chunks:o,currentIndex:a}=n;if(!o.length)return new s(0);if(o.length===1&&(r||a===n.allocatedSize))return o[0];let l=0;for(let d=0,f=o.length-1;d<f;d++)l+=o[d].length;l+=n.currentIndex;const c=new s(l);let u=0;if(c.buffer)for(let d=0,f=o.length-1;d<f;d++)c.set(o[d],u),u+=o[d].length;else for(let d=0,f=o.length-1;d<f;d++){const p=o[d];for(let _=0,v=p.length;_<v;_++)c[u+_]=p[_];u+=p.length}const h=o[o.length-1];if(c.buffer&&a>=n.currentSize)c.set(h,u);else for(let d=0,f=h.length;d<f;d++)c[u+d]=h[d];return c}i.is=function(n){return n.creator&&n.chunkSize},i.add4=function(n,r,s,o,a){n.currentIndex>=n.currentSize&&e(n);const l=n.currentChunk,c=n.currentIndex;return l[c]=r,l[c+1]=s,l[c+2]=o,l[c+3]=a,n.currentIndex+=4,n.elementCount++},i.add3=function(n,r,s,o){n.currentIndex>=n.currentSize&&e(n);const a=n.currentChunk,l=n.currentIndex;return a[l]=r,a[l+1]=s,a[l+2]=o,n.currentIndex+=3,n.elementCount++},i.add2=function(n,r,s){n.currentIndex>=n.currentSize&&e(n);const o=n.currentChunk,a=n.currentIndex;return o[a]=r,o[a+1]=s,n.currentIndex+=2,n.elementCount++},i.add=function(n,r){return n.currentIndex>=n.currentSize&&e(n),n.currentChunk[n.currentIndex]=r,n.currentIndex+=1,n.elementCount++},i.addRepeat=function(n,r,s){for(let o=0;o<r;o++)n.currentIndex>=n.currentSize&&e(n),n.currentChunk[n.currentIndex++]=s,n.elementCount++;return n.elementCount},i.addMany=function(n,r){const{elementSize:s}=n;for(let o=0,a=r.length;o<a;o+=s){n.currentIndex>=n.currentSize&&e(n);const{currentChunk:l}=n;for(let c=0;c<s;c++)l[n.currentIndex++]=r[o+c];n.elementCount++}return n.elementCount},i.compact=function(n,r=!1){return t(n,r)},i._compact=t,i.create=function(n,r,s,o){const a={ctor:n,elementSize:r,growBy:Math.max(1,Math.ceil(s)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(o===void 0)return a;if(typeof o=="number")return a.currentChunk=new n(o*r),a.allocatedSize=o*r,a.currentSize=a.currentChunk.length,a.chunks[0]=a.currentChunk,a;const l=o;if(l.length%r!=0)throw new Error("initialChunk length must be a multiple of the element size.");return a.currentChunk=l,a.allocatedSize=l.length,a.currentSize=l.length,a.chunks[0]=l,a}})(Pp||(Pp={})),function(i){function e(u,h){return u>=0?Math.ceil((u+1)/h):Math.ceil((u+1)/(-h-1))}function t({limit8:u,limit16:h},d,f){d.pack8+=e(f,u),d.pack16+=e(f,h),d.count+=1}function n(u,h){u.pack8+=e(h,127),u.pack16+=e(h,32767),u.count+=1}function r(u){return 4*u.count<2*u.pack16?{length:4*u.count,elem:4}:2*u.pack16<u.pack8?{length:2*u.pack16,elem:2}:{length:u.pack8,elem:1}}function s(u,h){const d={pack8:0,pack16:0,count:0};for(let f=0,p=u.length;f<p;f++)t(h,d,u[f]);return{...r(d),kind:"pack"}}function o(u,h){const d={pack8:0,pack16:0,count:0};let f=u[0];for(let p=1,_=u.length;p<_;p++)n(d,u[p]-f),f=u[p];return{...r(d),kind:"delta"}}function a(u,h){const d={pack8:0,pack16:0,count:0};let f=1;for(let p=1,_=u.length;p<_;p++)u[p-1]!==u[p]?(t(h,d,u[p-1]),t(h,d,f),f=1):f++;return t(h,d,u[u.length-1]),t(h,d,f),{...r(d),kind:"rle"}}function l(u,h){const d={pack8:0,pack16:0,count:0};let f=1,p=0,_=0;for(let v=1,g=u.length;v<g;v++){const b=u[v]-p;_!==b?(n(d,_),n(d,f),f=1):f++,_=b,p=u[v]}return n(d,_),n(d,f),{...r(d),kind:"delta-rle"}}function c(u){const h=function(f){let p=!1;for(let _=0,v=f.length;_<v;_++)if(f[_]<0){p=!0;break}return p?{signed:p,limit8:127,limit16:32767}:{signed:p,limit8:255,limit16:65535}}(u),d=[s(u,h),a(u,h),o(u),l(u)];return d.sort((f,p)=>f.length-p.length),d}i.getSize=c,i.classify=function(u){if(u.length<2)return Cn.by(Cn.byteArray);switch(c(u)[0].kind){case"pack":return Cn.by(Cn.integerPacking);case"rle":return Cn.by(Cn.runLength).and(Cn.integerPacking);case"delta":return Cn.by(Cn.delta).and(Cn.integerPacking);case"delta-rle":return Cn.by(Cn.delta).and(Cn.runLength).and(Cn.integerPacking);default:zb()}}}(c0||(c0={})),function(i){i.classify=function(e){const{mantissaDigits:t,integerDigits:n}=function(l,c,u){let h=1,d=0;for(let f=0,p=l.length;f<p;f++){if(h>=0){const v=ope(l[f],c,u);v<0?h=-1:v>h&&(h=v)}const _=Math.abs(l[f]);if(_>u){const v=Math.floor(Math.log10(Math.abs(_)))+1;v>d&&(d=v)}}return{mantissaDigits:h,integerDigits:d}}(e,4,1e-6);if(t<0||t+n>10)return Cn.by(Cn.byteArray);if(t===0)return c0.classify(e);const r=function(l){let c=1;for(let u=0;u<l;u++)c*=10;return c}(t),s=new Int32Array(e.length);for(let l=0,c=e.length;l<c;l++)s[l]=Math.round(r*e[l]);const o=c0.getSize(s)[0],a=Cn.by(Cn.fixedPoint(r));switch(o.kind){case"pack":return a.and(Cn.integerPacking);case"rle":return a.and(Cn.runLength).and(Cn.integerPacking);case"delta":return a.and(Cn.delta).and(Cn.integerPacking);case"delta-rle":return a.and(Cn.delta).and(Cn.runLength).and(Cn.integerPacking);default:zb()}}}(wO||(wO={}));class Hb{and(e){return new Hb(this.providers.concat([e]))}encode(e){const t=[];for(const n of this.providers){const r=n(e);if(!r.encodings.length)throw new Error("Encodings must be non-empty.");e=r.data;for(const s of r.encodings)t.push(s)}if(!(e instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:t,data:e}}constructor(e){this.providers=e}}(function(i){function e(n){return new Hb([n])}function t(n){switch(n.kind){case"ByteArray":return Cn.byteArray;case"FixedPoint":return Cn.fixedPoint(n.factor);case"IntervalQuantization":return Cn.intervalQuantizaiton(n.min,n.max,n.numSteps);case"RunLength":return Cn.runLength;case"Delta":return Cn.delta;case"IntegerPacking":return Cn.integerPacking;case"StringArray":return Cn.stringArray}}i.by=e,i.fromEncoding=function(n){let r=e(t(n[0]));for(let s=1;s<n.length&&n[s-1].kind!=="IntegerPacking";s++)r=r.and(t(n[s]));return r}})(MO||(MO={})),function(i){i.by=function(o){return new Hb([o])};const e={[hn.IntDataType.Int16]:function(o,a,l){o.setInt16(2*a,l,!0)},[hn.IntDataType.Uint16]:function(o,a,l){o.setUint16(2*a,l,!0)},[hn.IntDataType.Int32]:function(o,a,l){o.setInt32(4*a,l,!0)},[hn.IntDataType.Uint32]:function(o,a,l){o.setUint32(4*a,l,!0)},[hn.FloatDataType.Float32]:function(o,a,l){o.setFloat32(4*a,l,!0)},[hn.FloatDataType.Float64]:function(o,a,l){o.setFloat64(8*a,l,!0)}},t={[hn.IntDataType.Int16]:2,[hn.IntDataType.Uint16]:2,[hn.IntDataType.Int32]:4,[hn.IntDataType.Uint32]:4,[hn.FloatDataType.Float32]:4,[hn.FloatDataType.Float64]:8};function n(o){const a=hn.getDataType(o);if(a===hn.IntDataType.Int8)return function(h){return{encodings:[{kind:"ByteArray",type:hn.IntDataType.Int8}],data:new Uint8Array(h.buffer,h.byteOffset)}}(o);if(a===hn.IntDataType.Uint8)return function(h){return{encodings:[{kind:"ByteArray",type:hn.IntDataType.Uint8}],data:h}}(o);const l=new Uint8Array(o.length*t[a]),c=e[a],u=new DataView(l.buffer);for(let h=0,d=o.length;h<d;h++)c(u,h,o[h]);return{encodings:[{kind:"ByteArray",type:a}],data:l}}function r(o,a){let l=0;for(let c=0,u=o.length;c<u;c++)l+=o[c]/a|0;return l+=o.length,l}function s(o,a){const l=-a-1;let c=0;for(let u=0,h=o.length;u<h;u++){const d=o[u];c+=d>=0?d/a|0:d/l|0}return c+=o.length,c}i.byteArray=n,i.fixedPoint=function(o){return a=>function(l,c){const u=hn.getDataType(l),h=new Int32Array(l.length);for(let d=0,f=l.length;d<f;d++)h[d]=Math.round(l[d]*c);return{encodings:[{kind:"FixedPoint",factor:c,srcType:u}],data:h}}(a,o)},i.intervalQuantizaiton=function(o,a,l,c=Int32Array){return u=>function(h,d,f,p,_){const v=hn.getDataType(h);if(!h.length)return{encodings:[{kind:"IntervalQuantization",min:d,max:f,numSteps:p,srcType:v}],data:new Int32Array(0)};if(f<d){const m=d;d=f,f=m}const g=(f-d)/(p-1),b=new _(h.length);for(let m=0,y=h.length;m<y;m++){const A=h[m];b[m]=A<=d?0:A>=f?p-1:0|Math.round((A-d)/g)}return{encodings:[{kind:"IntervalQuantization",min:d,max:f,numSteps:p,srcType:v}],data:b}}(u,o,a,l,c)},i.runLength=function(o){let a=hn.getDataType(o);if(a===void 0&&(o=new Int32Array(o),a=hn.IntDataType.Int32),!o.length)return{encodings:[{kind:"RunLength",srcType:a,srcSize:0}],data:new Int32Array(0)};let l=2;for(let d=1,f=o.length;d<f;d++)o[d-1]!==o[d]&&(l+=2);const c=new Int32Array(l);let u=0,h=1;for(let d=1,f=o.length;d<f;d++)o[d-1]!==o[d]?(c[u]=o[d-1],c[u+1]=h,h=1,u+=2):++h;return c[u]=o[o.length-1],c[u+1]=h,{encodings:[{kind:"RunLength",srcType:a,srcSize:o.length}],data:c}},i.delta=function(o){if(!hn.isSignedIntegerDataType(o))throw new Error("Only signed integer types can be encoded using delta encoding.");let a=hn.getDataType(o);if(a===void 0&&(o=new Int32Array(o),a=hn.IntDataType.Int32),!o.length)return{encodings:[{kind:"Delta",origin:0,srcType:a}],data:new o.constructor(0)};const l=new o.constructor(o.length),c=o[0];l[0]=o[0];for(let u=1,h=o.length;u<h;u++)l[u]=o[u]-o[u-1];return l[0]=0,{encodings:[{kind:"Delta",origin:c,srcType:a}],data:l}},i.integerPacking=function(o){const a=function(l){const c=function(d){for(let f=0,p=d.length;f<p;f++)if(d[f]<0)return!0;return!1}(l),u=c?s(l,127):r(l,255),h=c?s(l,32767):r(l,65535);return 4*l.length<2*h?{isSigned:c,size:l.length,bytesPerElement:4}:2*h<u?{isSigned:c,size:h,bytesPerElement:2}:{isSigned:c,size:u,bytesPerElement:1}}(o);return a.bytesPerElement===4?n(o):function(l,c){const u=c.isSigned?c.bytesPerElement===1?127:32767:c.bytesPerElement===1?255:65535,h=-u-1,d=l.length,f=c.isSigned?c.bytesPerElement===1?new Int8Array(c.size):new Int16Array(c.size):c.bytesPerElement===1?new Uint8Array(c.size):new Uint16Array(c.size);let p=0;for(let v=0;v<d;v++){let g=l[v];if(g>=0)for(;g>=u;)f[p]=u,++p,g-=u;else for(;g<=h;)f[p]=h,++p,g-=h;f[p]=g,++p}const _=n(f);return{encodings:[{kind:"IntegerPacking",byteCount:c.bytesPerElement,isUnsigned:!c.isSigned,srcSize:d},_.encodings[0]],data:_.data}}(o,a)},i.stringArray=function(o){const a=Object.create(null),l=[],c=new Int32Array(o.length),u=Pp.create(Int32Array,1,Math.min(1024,o.length<32?o.length+1:Math.round(o.length/8)+1));Pp.add(u,0);let h=0,d=0;for(const v of o){if(v==null){c[d++]=-1;continue}let g=a[v];g===void 0&&(h+=v.length,g=l.length,l[g]=v,a[v]=g,Pp.add(u,h)),c[d++]=g}const f=Pp.compact(u),p=AO(f).encode(f),_=AO(c).encode(c);return{encodings:[{kind:"StringArray",dataEncoding:_.encoding,stringData:l.join(""),offsetEncoding:p.encoding,offsets:p.data}],data:_.data}}}(Cn||(Cn={}));const ape=function(){const i=[];for(let e=0;e<1024;e++)i[e]=String.fromCharCode(e);return i}();function lpe(i){throw new Error(i)}const EO=typeof TextDecoder<"u"?new TextDecoder:void 0;function cpe(i,e,t){if(EO){const n=e||t!==i.length?i.subarray(e,e+t):i;return EO.decode(n)}return function(n,r,s){const o=ape;let a,l=0;const c=[];for(let u=r,h=r+s;u<h;u++){const d=n[u];128&d?(224&d)==192?c[l++]=o[(15&d)<<6|63&n[++u]]:(240&d)==224?c[l++]=String.fromCharCode((15&d)<<12|(63&n[++u])<<6|63&n[++u]):(248&d)==240?c[l++]=String.fromCharCode((7&d)<<18|(63&n[++u])<<12|(63&n[++u])<<6|63&n[++u]):lpe("Invalid byte "+d.toString(16)):c[l++]=o[d],l===512&&(a=a||[],a[a.length]=c.join(""),l=0)}return a?(l>0&&(a[a.length]=c.slice(0,l).join("")),a.join("")):c.slice(0,l).join("")}(i,e,t)}function XA(i,e){const t={};for(let n=0;n<e;n++)t[$b(i)]=$b(i);return t}function qA(i,e){const t=new Uint8Array(e),n=i.offset;for(let r=0;r<e;r++)t[r]=i.buffer[r+n];return i.offset+=e,t}function qy(i,e){const t=cpe(i.buffer,i.offset,e);return i.offset+=e,t}function YA(i,e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=$b(i);return t}function $b(i){const e=i.buffer[i.offset];let t,n;if(!(128&e))return i.offset++,e;if((240&e)==128)return n=15&e,i.offset++,XA(i,n);if((240&e)==144)return n=15&e,i.offset++,YA(i,n);if((224&e)==160)return n=31&e,i.offset++,qy(i,n);if(!(224&~e))return t=i.dataView.getInt8(i.offset),i.offset++,t;switch(e){case 192:return i.offset++,null;case 194:return i.offset++,!1;case 195:return i.offset++,!0;case 196:return n=i.dataView.getUint8(i.offset+1),i.offset+=2,qA(i,n);case 197:return n=i.dataView.getUint16(i.offset+1),i.offset+=3,qA(i,n);case 198:return n=i.dataView.getUint32(i.offset+1),i.offset+=5,qA(i,n);case 202:return t=i.dataView.getFloat32(i.offset+1),i.offset+=5,t;case 203:return t=i.dataView.getFloat64(i.offset+1),i.offset+=9,t;case 204:return t=i.buffer[i.offset+1],i.offset+=2,t;case 205:return t=i.dataView.getUint16(i.offset+1),i.offset+=3,t;case 206:return t=i.dataView.getUint32(i.offset+1),i.offset+=5,t;case 208:return t=i.dataView.getInt8(i.offset+1),i.offset+=2,t;case 209:return t=i.dataView.getInt16(i.offset+1),i.offset+=3,t;case 210:return t=i.dataView.getInt32(i.offset+1),i.offset+=5,t;case 217:return n=i.dataView.getUint8(i.offset+1),i.offset+=2,qy(i,n);case 218:return n=i.dataView.getUint16(i.offset+1),i.offset+=3,qy(i,n);case 219:return n=i.dataView.getUint32(i.offset+1),i.offset+=5,qy(i,n);case 220:return n=i.dataView.getUint16(i.offset+1),i.offset+=3,YA(i,n);case 221:return n=i.dataView.getUint32(i.offset+1),i.offset+=5,YA(i,n);case 222:return n=i.dataView.getUint16(i.offset+1),i.offset+=3,XA(i,n);case 223:return n=i.dataView.getUint32(i.offset+1),i.offset+=5,XA(i,n)}throw new Error("Unknown type 0x"+e.toString(16))}function upe(i){const e=Object.create(null),t=Object.create(null);for(const n of i.columns)e[n.name]=n;return{rowCount:i.rowCount,name:i.name.substr(1),fieldNames:i.columns.map(n=>n.name),getField(n){const r=e[n];if(r)return t[n]||(t[n]=function(s){const o=s.mask?Vb(s.mask):void 0,a=Vb(s.data),l=k3(a),c=l?o?p=>o[p]===0?""+a[p]:"":p=>""+a[p]:o?p=>o[p]===0?a[p]:"":p=>a[p],u=l?p=>a[p]:p=>{const _=a[p];return $p(_,0,_.length)},h=l?p=>a[p]:p=>{const _=a[p];return I0(_,0,_.length)},d=o?p=>o[p]:p=>0,f=a.length;return{__array:a,binaryEncoding:s.data.encoding,isDefined:!0,rowCount:f,str:c,int:u,float:h,valueKind:d,areValuesEqual:(p,_)=>a[p]===a[_],toStringArray:p=>as(f,c,p),toIntArray:l?p=>Bb(a,p):p=>as(f,u,p),toFloatArray:l?p=>Bb(a,p):p=>as(f,h,p)}}(r)),t[n]}}}function TO(i){return Fd.create("Parse BinaryCIF",async e=>{const t=[0,3];try{const r=$b({buffer:n=i,offset:0,dataView:new DataView(n.buffer)});if(!function(o,a){for(let l=0;l<2;l++)if(o[l]>a[l])return!1;return!0}(t,r.version.match(/(\d)\.(\d)\.\d/).slice(1).map(o=>+o)))return vd.error(`Unsupported format version. Current ${r.version}, required ${t.join(".")}.`);const s=MH(r.dataBlocks.map(o=>{const a=Object.create(null);for(const l of o.categories)a[l.name.substr(1)]=upe(l);return U3(o.categories.map(l=>l.name.substr(1)),a,o.header)}));return vd.success(s)}catch(r){return vd.error(""+r)}var n})}var jp;function ql(i,e,t){return function(n,r,s){const o=Object.create(null);for(const a of Object.keys(n))o[a]=gpe(a,n[a],r,s);return XC.ofTables(r.header,n,o)}(i,e,t)}function hpe(i){switch(i.valueType){case"str":return(e,t,n)=>function(r,s,o,a){return{schema:r,__array:s.__array,isDefined:s.isDefined,rowCount:s.rowCount,value:r.transform==="lowercase"?l=>o(l).toLowerCase():r.transform==="uppercase"?l=>o(l).toUpperCase():o,valueKind:s.valueKind,areValuesEqual:s.areValuesEqual,toArray:r.transform==="lowercase"?l=>Array.from(a(l)).map(c=>c.toLowerCase()):r.transform==="uppercase"?l=>Array.from(a(l)).map(c=>c.toUpperCase()):a}}(i,e,e.str,e.toStringArray);case"int":return(e,t,n)=>CO(i,e,e.int,e.toIntArray);case"float":return(e,t,n)=>CO(i,e,e.float,e.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function CO(i,e,t,n){return{schema:i,__array:e.__array,isDefined:e.isDefined,rowCount:e.rowCount,value:t,valueKind:e.valueKind,areValuesEqual:e.areValuesEqual,toArray:n}}function dpe(i,e,t){const n=i.separator,r=i.itemParse,s=e.getField(t),o=s?a=>s.str(a).split(n).map(l=>r(l.trim())).filter(l=>!!l):a=>[];return{schema:i,__array:void 0,isDefined:!!s,rowCount:e.rowCount,value:o,valueKind:s?s.valueKind:()=>1,areValuesEqual:(a,l)=>function(c,u){const h=c.length;if(h!==u.length)return!1;for(let d=0;d<h;d++)if(c[d]!==u[d])return!1;return!0}(o(a),o(l)),toArray:a=>as(e.rowCount,o,a)}}function fpe(i,e,t){const n=i.space,r=e.fieldNames.includes(`${t}[0]`)||e.fieldNames.includes(`${t}[0][0]`)||e.fieldNames.includes(`${t}[0][0][0]`),s=r?0:1,o=e.fieldNames.includes(`${t}_1`)||e.fieldNames.includes(`${t}_11`)||e.fieldNames.includes(`${t}_111`)?"underscore":"brackets",a=function(u,h,d,f){const p=d?0:1;switch(h){case 1:return f==="brackets"?_=>`${u}[${_+p}]`:_=>`${u}_${_+p}`;case 2:return f==="brackets"?(_,v)=>`${u}[${_+p}][${v+p}]`:(_,v)=>`${u}_${_+p}${v+p}`;case 3:return f==="brackets"?(_,v,g)=>`${u}[${_+p}][${v+p}][${g+p}]`:(_,v,g)=>`${u}_${_+p}${v+p}${g+p}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}(t,n.rank,r,o),l=e.getField(a(s,s,s))||li.Undefined(e.rowCount,i),c=u=>function(h,d,f,p){const _=d.create();if(d.rank===1){const v=d.dimensions[0];for(let g=0;g<v;g++){const b=h.getField(p(g));d.set(_,g,b?b.float(f):0)}}else if(d.rank===2){const v=d.dimensions[0],g=d.dimensions[1];for(let b=0;b<v;b++)for(let m=0;m<g;m++){const y=h.getField(p(b,m));d.set(_,b,m,y?y.float(f):0)}}else{if(d.rank!==3)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const v=d.dimensions[0],g=d.dimensions[1],b=d.dimensions[2];for(let m=0;m<v;m++)for(let y=0;y<g;y++)for(let A=0;A<b;A++){const w=h.getField(p(m,y,A));d.set(_,m,y,A,w?w.float(f):0)}}}return _}(e,n,u,a);return{schema:i,__array:void 0,isDefined:l.isDefined,rowCount:e.rowCount,value:c,valueKind:l.valueKind,areValuesEqual:(u,h)=>a0.areEqualExact(c(u),c(h)),toArray:u=>as(e.rowCount,c,u)}}(function(i){function e(t){return t.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}i.canonical=e,i.equal=function(t,n){return e(t)===e(n)},i.create=function(t,n,r=!1){const s=`${t}${n?`.${n}`:""}`;return r?e(s):s}})(jp||(jp={}));class ppe{constructor(e,t,n){this._isDefined=n;const r=Object.keys(t);this._rowCount=e.rowCount,this._columns=r,this._schema=t;const s=Object.create(null);for(const o of r)Object.defineProperty(this,o,{get:function(){if(s[o])return s[o];const a=t[o];if(a.valueType==="list")s[o]=dpe(a,e,o);else if(a.valueType==="tensor")s[o]=fpe(a,e,o);else{const l=hpe(a),c=e.getField(o);s[o]=c?l(c,e,o):li.Undefined(e.rowCount,a)}return s[o]},enumerable:!0,configurable:!1})}}function mpe(i,e,t,n){const r=jp.create(e,i),s=jp.canonical(r);if(s in t)return t[s];if(n&&r in n)for(const o of n[r]){const a=jp.canonical(o);if(a in t)return t[a]}}function gpe(i,e,t,n){let r=t.categories[i];if(n){const s=function(c){const u=Object.create(null);for(const h of Object.keys(c.categories))for(const d of c.categories[h].fieldNames)u[jp.create(h,d,!0)]=c.categories[h].getField(d);return u}(t),o=Object.create(null),a=[];let l=0;for(const c of Object.keys(e)){const u=mpe(c,i,s,n);u&&(o[c]=u,a.push(c),l=u.rowCount)}r={rowCount:l,name:i,fieldNames:[...a],getField:c=>o[c]}}return new ppe(r||Gb.empty(i),e,!!r)}var Rc=li.Schema;const ce=Rc.str,Ve=Rc.int,Zt=Rc.float,KA=Rc.coord,At=Rc.Aliased,iu=Rc.Matrix,Yy=Rc.Vector,wn=Rc.lstr,Nh=Rc.List,vpe={atom_site:{auth_asym_id:ce,auth_atom_id:ce,auth_comp_id:ce,auth_seq_id:Ve,B_iso_or_equiv:Zt,Cartn_x:KA,Cartn_y:KA,Cartn_z:KA,group_PDB:At(ce),id:Ve,label_alt_id:ce,label_asym_id:ce,label_atom_id:ce,label_comp_id:ce,label_entity_id:ce,label_seq_id:Ve,occupancy:Zt,type_symbol:ce,pdbx_PDB_ins_code:ce,pdbx_PDB_model_num:Ve,pdbx_formal_charge:Ve,pdbx_label_index:Ve,pdbx_sifts_xref_db_name:ce,pdbx_sifts_xref_db_acc:ce,pdbx_sifts_xref_db_num:ce,pdbx_sifts_xref_db_res:ce,ihm_model_id:Ve},atom_site_anisotrop:{id:Ve,type_symbol:ce,U:iu(3,3),U_esd:iu(3,3),pdbx_auth_seq_id:ce,pdbx_auth_asym_id:ce,pdbx_auth_atom_id:ce,pdbx_auth_comp_id:ce,pdbx_label_seq_id:Ve,pdbx_label_alt_id:ce,pdbx_label_asym_id:ce,pdbx_label_atom_id:ce,pdbx_label_comp_id:ce,pdbx_PDB_ins_code:ce},atom_sites:{entry_id:ce,fract_transf_matrix:iu(3,3),fract_transf_vector:Yy(3)},audit_author:{name:ce,pdbx_ordinal:Ve,identifier_ORCID:ce},audit_conform:{dict_location:ce,dict_name:ce,dict_version:ce},cell:{angle_alpha:Zt,angle_beta:Zt,angle_gamma:Zt,entry_id:ce,length_a:Zt,length_b:Zt,length_c:Zt,Z_PDB:Ve,pdbx_unique_axis:ce},chem_comp:{formula:ce,formula_weight:Zt,id:ce,mon_nstd_flag:At(wn),name:ce,type:At(wn),pdbx_synonyms:Nh(";",i=>i)},chem_comp_bond:{atom_id_1:ce,atom_id_2:ce,comp_id:ce,value_order:At(wn),pdbx_ordinal:Ve,pdbx_stereo_config:At(wn),pdbx_aromatic_flag:At(wn)},citation:{book_publisher:ce,country:ce,id:ce,journal_abbrev:ce,journal_id_ASTM:ce,journal_id_CSD:ce,journal_id_ISSN:ce,journal_volume:ce,page_first:ce,page_last:ce,title:ce,year:Ve,pdbx_database_id_DOI:ce,pdbx_database_id_PubMed:Ve},citation_author:{citation_id:ce,name:ce,ordinal:Ve},database_2:{database_id:At(wn),database_code:ce},entity:{details:ce,formula_weight:Zt,id:ce,src_method:At(wn),type:At(wn),pdbx_description:Nh(",",i=>i),pdbx_number_of_molecules:Ve,pdbx_mutation:ce,pdbx_fragment:ce,pdbx_ec:Nh(",",i=>i)},entity_poly:{entity_id:ce,nstd_linkage:At(wn),nstd_monomer:At(wn),type:At(ce),pdbx_strand_id:Nh(",",i=>i),pdbx_seq_one_letter_code:ce,pdbx_seq_one_letter_code_can:ce,pdbx_target_identifier:ce},entity_poly_seq:{entity_id:ce,hetero:At(wn),mon_id:ce,num:Ve},entry:{id:ce},exptl:{entry_id:ce,method:At(ce)},software:{classification:ce,date:ce,description:ce,name:ce,type:At(wn),version:ce,pdbx_ordinal:Ve},struct:{entry_id:ce,title:ce,pdbx_descriptor:ce},struct_asym:{details:ce,entity_id:ce,id:ce,pdbx_modified:ce,pdbx_blank_PDB_chainid_flag:At(ce)},struct_conf:{beg_label_asym_id:ce,beg_label_comp_id:ce,beg_label_seq_id:Ve,beg_auth_asym_id:ce,beg_auth_comp_id:ce,beg_auth_seq_id:Ve,conf_type_id:At(wn),details:ce,end_label_asym_id:ce,end_label_comp_id:ce,end_label_seq_id:Ve,end_auth_asym_id:ce,end_auth_comp_id:ce,end_auth_seq_id:Ve,id:ce,pdbx_beg_PDB_ins_code:ce,pdbx_end_PDB_ins_code:ce,pdbx_PDB_helix_class:ce,pdbx_PDB_helix_length:Ve,pdbx_PDB_helix_id:ce},struct_conn:{conn_type_id:At(wn),details:ce,id:ce,ptnr1_label_asym_id:ce,ptnr1_label_atom_id:ce,ptnr1_label_comp_id:ce,ptnr1_label_seq_id:Ve,ptnr1_auth_asym_id:ce,ptnr1_auth_comp_id:ce,ptnr1_auth_seq_id:Ve,ptnr1_symmetry:ce,ptnr2_label_asym_id:ce,ptnr2_label_atom_id:ce,ptnr2_label_comp_id:ce,ptnr2_label_seq_id:Ve,ptnr2_auth_asym_id:ce,ptnr2_auth_comp_id:ce,ptnr2_auth_seq_id:Ve,ptnr2_symmetry:ce,pdbx_ptnr1_PDB_ins_code:ce,pdbx_ptnr1_label_alt_id:ce,pdbx_ptnr1_standard_comp_id:ce,pdbx_ptnr2_PDB_ins_code:ce,pdbx_ptnr2_label_alt_id:ce,pdbx_ptnr3_PDB_ins_code:ce,pdbx_ptnr3_label_alt_id:ce,pdbx_ptnr3_label_asym_id:ce,pdbx_ptnr3_label_atom_id:ce,pdbx_ptnr3_label_comp_id:ce,pdbx_ptnr3_label_seq_id:Ve,pdbx_PDB_id:ce,pdbx_dist_value:Zt,pdbx_value_order:At(wn)},struct_conn_type:{criteria:ce,id:At(wn),reference:ce},struct_keywords:{entry_id:ce,text:Nh(",",i=>i),pdbx_keywords:ce},struct_ncs_oper:{code:At(ce),details:ce,id:Ve,matrix:iu(3,3),vector:Yy(3)},struct_sheet_range:{beg_label_asym_id:ce,beg_label_comp_id:ce,beg_label_seq_id:Ve,end_label_asym_id:ce,end_label_comp_id:ce,end_label_seq_id:Ve,beg_auth_asym_id:ce,beg_auth_comp_id:ce,beg_auth_seq_id:Ve,end_auth_asym_id:ce,end_auth_comp_id:ce,end_auth_seq_id:Ve,id:ce,sheet_id:ce,pdbx_beg_PDB_ins_code:ce,pdbx_end_PDB_ins_code:ce},struct_site:{details:ce,id:ce,pdbx_num_residues:Ve,pdbx_evidence_code:ce,pdbx_auth_asym_id:ce,pdbx_auth_comp_id:ce,pdbx_auth_seq_id:ce,pdbx_auth_ins_code:ce},struct_site_gen:{details:ce,id:ce,label_alt_id:ce,label_asym_id:ce,label_atom_id:ce,label_comp_id:ce,label_seq_id:Ve,auth_asym_id:ce,auth_comp_id:ce,auth_seq_id:ce,site_id:ce,symmetry:ce,pdbx_auth_ins_code:ce,pdbx_num_res:Ve},symmetry:{entry_id:ce,cell_setting:At(wn),Int_Tables_number:Ve,space_group_name_Hall:ce,"space_group_name_H-M":ce},pdbx_database_status:{status_code:At(ce),status_code_sf:At(ce),status_code_mr:At(ce),entry_id:ce,recvd_initial_deposition_date:ce,SG_entry:At(wn),deposit_site:At(ce),process_site:At(ce),status_code_cs:At(ce),methods_development_category:At(ce),pdb_format_compatible:At(wn)},pdbx_nonpoly_scheme:{asym_id:ce,entity_id:ce,mon_id:ce,pdb_strand_id:ce,ndb_seq_num:ce,pdb_seq_num:ce,auth_seq_num:ce,pdb_mon_id:ce,auth_mon_id:ce,pdb_ins_code:ce},pdbx_database_related:{db_name:ce,details:ce,db_id:ce,content_type:At(ce)},pdbx_entity_nonpoly:{entity_id:ce,comp_id:ce,name:ce},pdbx_chem_comp_synonyms:{name:ce,comp_id:ce,provenance:At(ce)},pdbx_chem_comp_identifier:{comp_id:ce,identifier:ce,type:At(ce),program:ce,program_version:ce},pdbx_unobs_or_zero_occ_residues:{id:Ve,polymer_flag:At(wn),occupancy_flag:At(Ve),PDB_model_num:Ve,auth_asym_id:ce,auth_comp_id:ce,auth_seq_id:ce,PDB_ins_code:ce,label_asym_id:ce,label_comp_id:ce,label_seq_id:Ve},pdbx_struct_mod_residue:{id:Ve,auth_asym_id:ce,auth_comp_id:ce,auth_seq_id:Ve,PDB_ins_code:ce,label_asym_id:ce,label_comp_id:ce,label_seq_id:Ve,parent_comp_id:ce,details:ce},pdbx_struct_oper_list:{id:ce,type:At(ce),name:ce,symmetry_operation:ce,matrix:iu(3,3),vector:Yy(3)},pdbx_struct_assembly:{method_details:ce,oligomeric_details:ce,oligomeric_count:Ve,details:ce,id:ce},pdbx_struct_assembly_gen:{asym_id_list:Nh(",",i=>i),assembly_id:ce,oper_expression:ce},pdbx_reference_entity_list:{prd_id:ce,ref_entity_id:ce,type:At(wn),details:ce,component_id:Ve},pdbx_reference_entity_link:{link_id:Ve,prd_id:ce,details:ce,ref_entity_id_1:ce,ref_entity_id_2:ce,entity_seq_num_1:Ve,entity_seq_num_2:Ve,comp_id_1:ce,comp_id_2:ce,atom_id_1:ce,atom_id_2:ce,value_order:At(wn),component_1:Ve,component_2:Ve,link_class:At(ce)},pdbx_reference_entity_poly_link:{link_id:Ve,prd_id:ce,ref_entity_id:ce,component_id:Ve,entity_seq_num_1:Ve,entity_seq_num_2:Ve,comp_id_1:ce,comp_id_2:ce,atom_id_1:ce,atom_id_2:ce,value_order:At(wn)},pdbx_molecule:{prd_id:ce,instance_id:Ve,asym_id:ce},pdbx_molecule_features:{prd_id:ce,class:At(wn),type:At(wn),name:ce,details:ce},entity_src_nat:{entity_id:ce,pdbx_organism_scientific:ce,pdbx_plasmid_name:ce,pdbx_src_id:Ve,pdbx_beg_seq_num:Ve,pdbx_end_seq_num:Ve},entity_src_gen:{entity_id:ce,pdbx_gene_src_gene:Nh(",",i=>i),pdbx_gene_src_scientific_name:ce,plasmid_name:ce,pdbx_src_id:Ve,pdbx_beg_seq_num:Ve,pdbx_end_seq_num:Ve},pdbx_entity_src_syn:{organism_scientific:ce,entity_id:ce,pdbx_src_id:Ve,pdbx_beg_seq_num:Ve,pdbx_end_seq_num:Ve},pdbx_entity_branch_descriptor:{entity_id:ce,descriptor:ce,type:At(wn),program:ce,program_version:ce,ordinal:Ve},pdbx_entity_instance_feature:{details:ce,feature_type:At(ce),auth_asym_id:ce,asym_id:ce,auth_seq_num:ce,seq_num:Ve,comp_id:ce,auth_comp_id:ce,ordinal:Ve},pdbx_entity_branch_list:{entity_id:ce,hetero:At(wn),comp_id:ce,num:Ve},pdbx_entity_branch_link:{link_id:Ve,details:ce,entity_id:ce,entity_branch_list_num_1:Ve,entity_branch_list_num_2:Ve,comp_id_1:ce,comp_id_2:ce,atom_id_1:ce,leaving_atom_id_1:ce,atom_stereo_config_1:At(wn),atom_id_2:ce,leaving_atom_id_2:ce,atom_stereo_config_2:At(wn),value_order:At(wn)},pdbx_entity_branch:{entity_id:ce,type:At(ce)},pdbx_branch_scheme:{entity_id:ce,hetero:At(wn),asym_id:ce,mon_id:ce,num:Ve,pdb_asym_id:ce,pdb_seq_num:ce,pdb_mon_id:ce,auth_asym_id:ce,auth_seq_num:ce,auth_mon_id:ce},pdbx_chem_comp_related:{comp_id:ce,related_comp_id:ce,relationship_type:At(ce),details:ce},ihm_starting_model_details:{starting_model_id:ce,entity_id:ce,entity_description:ce,asym_id:ce,entity_poly_segment_id:Ve,starting_model_source:At(ce),starting_model_auth_asym_id:ce,starting_model_sequence_offset:Ve,dataset_list_id:Ve},ihm_starting_comparative_models:{id:Ve,starting_model_id:ce,starting_model_auth_asym_id:ce,starting_model_seq_id_begin:Ve,starting_model_seq_id_end:Ve,template_auth_asym_id:ce,template_seq_id_begin:Ve,template_seq_id_end:Ve,template_sequence_identity:Zt,template_sequence_identity_denominator:At(Ve),template_dataset_list_id:Ve,alignment_file_id:Ve},ihm_starting_model_seq_dif:{id:Ve,entity_id:ce,asym_id:ce,seq_id:Ve,comp_id:ce,starting_model_id:ce,db_asym_id:ce,db_seq_id:Ve,db_comp_id:ce,details:ce},ihm_model_representation:{id:Ve,name:ce,details:ce},ihm_model_representation_details:{id:Ve,representation_id:Ve,entity_poly_segment_id:Ve,entity_id:ce,entity_description:ce,entity_asym_id:ce,model_object_primitive:At(ce),starting_model_id:ce,model_mode:At(ce),model_granularity:At(ce),model_object_count:Ve},ihm_struct_assembly_details:{id:Ve,assembly_id:Ve,parent_assembly_id:Ve,entity_description:ce,entity_id:ce,asym_id:ce,entity_poly_segment_id:Ve},ihm_struct_assembly:{id:Ve,name:ce,description:ce},ihm_modeling_protocol:{id:Ve,num_steps:Ve,protocol_name:ce},ihm_modeling_protocol_details:{id:Ve,protocol_id:Ve,step_id:Ve,struct_assembly_id:Ve,dataset_group_id:Ve,struct_assembly_description:ce,step_name:ce,step_method:ce,num_models_begin:Ve,num_models_end:Ve,multi_scale_flag:At(wn),multi_state_flag:At(wn),ordered_flag:At(wn),script_file_id:Ve,software_id:Ve},ihm_multi_state_modeling:{state_id:Ve,state_group_id:Ve,population_fraction:Zt,population_fraction_sd:Zt,state_type:ce,state_name:ce,experiment_type:At(ce),details:ce},ihm_modeling_post_process:{id:Ve,protocol_id:Ve,analysis_id:Ve,step_id:Ve,type:At(ce),feature:At(ce),num_models_begin:Ve,num_models_end:Ve},ihm_ensemble_info:{ensemble_id:Ve,ensemble_name:ce,post_process_id:Ve,model_group_id:Ve,ensemble_clustering_method:At(ce),ensemble_clustering_feature:At(ce),num_ensemble_models:Ve,num_ensemble_models_deposited:Ve,ensemble_precision_value:Zt,ensemble_file_id:Ve},ihm_model_list:{model_id:Ve,model_name:ce,assembly_id:Ve,protocol_id:Ve,representation_id:Ve},ihm_model_group:{id:Ve,name:ce,details:ce},ihm_model_group_link:{model_id:Ve,group_id:Ve},ihm_model_representative:{id:Ve,model_group_id:Ve,model_id:Ve,selection_criteria:At(ce)},ihm_dataset_list:{id:Ve,data_type:At(ce),database_hosted:At(wn)},ihm_dataset_group:{id:Ve,name:ce,application:At(ce),details:ce},ihm_dataset_group_link:{dataset_list_id:Ve,group_id:Ve},ihm_related_datasets:{dataset_list_id_derived:Ve,dataset_list_id_primary:Ve},ihm_dataset_related_db_reference:{id:Ve,dataset_list_id:Ve,db_name:At(ce),accession_code:ce,version:ce,details:ce},ihm_external_reference_info:{reference_id:Ve,reference_provider:ce,reference_type:At(ce),reference:ce,refers_to:At(ce),associated_url:ce},ihm_external_files:{id:Ve,reference_id:Ve,file_path:ce,content_type:At(ce),file_size_bytes:Zt,details:ce},ihm_dataset_external_reference:{id:Ve,dataset_list_id:Ve,file_id:Ve},ihm_localization_density_files:{id:Ve,file_id:Ve,ensemble_id:Ve,entity_id:ce,entity_poly_segment_id:Ve,asym_id:ce},ihm_predicted_contact_restraint:{id:Ve,group_id:Ve,entity_id_1:ce,entity_id_2:ce,asym_id_1:ce,asym_id_2:ce,comp_id_1:ce,comp_id_2:ce,seq_id_1:Ve,seq_id_2:Ve,rep_atom_1:At(ce),rep_atom_2:At(ce),distance_lower_limit:Zt,distance_upper_limit:Zt,probability:Zt,restraint_type:At(ce),model_granularity:At(ce),dataset_list_id:Ve,software_id:Ve},ihm_cross_link_list:{id:Ve,group_id:Ve,entity_description_1:ce,entity_description_2:ce,entity_id_1:ce,entity_id_2:ce,comp_id_1:ce,comp_id_2:ce,seq_id_1:Ve,seq_id_2:Ve,linker_type:At(ce),dataset_list_id:Ve},ihm_cross_link_restraint:{id:Ve,group_id:Ve,entity_id_1:ce,entity_id_2:ce,asym_id_1:ce,asym_id_2:ce,comp_id_1:ce,comp_id_2:ce,seq_id_1:Ve,seq_id_2:Ve,atom_id_1:ce,atom_id_2:ce,restraint_type:At(ce),conditional_crosslink_flag:At(ce),model_granularity:At(ce),distance_threshold:Zt,psi:Zt,sigma_1:Zt,sigma_2:Zt},ihm_cross_link_result_parameters:{id:Ve,restraint_id:Ve,model_id:Ve,psi:Zt,sigma_1:Zt,sigma_2:Zt},ihm_2dem_class_average_restraint:{id:Ve,dataset_list_id:Ve,number_raw_micrographs:Ve,pixel_size_width:Zt,pixel_size_height:Zt,image_resolution:Zt,image_segment_flag:At(wn),number_of_projections:Ve,struct_assembly_id:Ve,details:ce},ihm_2dem_class_average_fitting:{id:Ve,restraint_id:Ve,model_id:Ve,cross_correlation_coefficient:Zt,rot_matrix:iu(3,3),tr_vector:Yy(3)},ihm_3dem_restraint:{id:Ve,dataset_list_id:Ve,model_id:Ve,struct_assembly_id:Ve,fitting_method:ce,number_of_gaussians:Ve,cross_correlation_coefficient:Zt},ihm_sas_restraint:{id:Ve,dataset_list_id:Ve,model_id:Ve,struct_assembly_id:Ve,profile_segment_flag:At(wn),fitting_atom_type:ce,fitting_method:ce,fitting_state:At(ce),radius_of_gyration:Zt,chi_value:Zt,details:ce},ihm_starting_model_coord:{ordinal_id:Ve,starting_model_id:ce,group_PDB:At(ce),id:Ve,type_symbol:ce,entity_id:ce,atom_id:ce,comp_id:ce,seq_id:Ve,asym_id:ce,Cartn_x:Zt,Cartn_y:Zt,Cartn_z:Zt,B_iso_or_equiv:Zt},ihm_sphere_obj_site:{id:Ve,entity_id:ce,seq_id_begin:Ve,seq_id_end:Ve,asym_id:ce,Cartn_x:Zt,Cartn_y:Zt,Cartn_z:Zt,object_radius:Zt,rmsf:Zt,model_id:Ve},ihm_gaussian_obj_site:{id:Ve,entity_id:ce,seq_id_begin:Ve,seq_id_end:Ve,asym_id:ce,mean_Cartn_x:Zt,mean_Cartn_y:Zt,mean_Cartn_z:Zt,weight:Zt,covariance_matrix:iu(3,3),model_id:Ve},ihm_gaussian_obj_ensemble:{id:Ve,entity_id:ce,seq_id_begin:Ve,seq_id_end:Ve,asym_id:ce,mean_Cartn_x:Zt,mean_Cartn_y:Zt,mean_Cartn_z:Zt,weight:Zt,covariance_matrix:iu(3,3),ensemble_id:Ve},ihm_feature_list:{feature_id:Ve,feature_type:At(ce),entity_type:At(ce)},ihm_poly_residue_feature:{ordinal_id:Ve,feature_id:Ve,entity_id:ce,asym_id:ce,comp_id_begin:ce,comp_id_end:ce,seq_id_begin:Ve,seq_id_end:Ve},ihm_derived_distance_restraint:{id:Ve,group_id:Ve,feature_id_1:Ve,feature_id_2:Ve,group_conditionality:At(ce),random_exclusion_fraction:Zt,distance_upper_limit:Zt,restraint_type:At(ce),dataset_list_id:Ve},ma_model_list:{ordinal_id:Ve,model_id:Ve,model_group_id:Ve,model_name:ce,model_group_name:ce,model_type:At(ce),data_id:Ve},ma_target_entity:{entity_id:ce,data_id:Ve,origin:At(ce)},ma_target_entity_instance:{asym_id:ce,entity_id:ce,details:ce},ma_target_ref_db_details:{target_entity_id:ce,db_name:At(ce),db_code:ce,db_accession:ce,seq_db_isoform:ce,seq_db_align_begin:ce,seq_db_align_end:ce,ncbi_taxonomy_id:ce,organism_scientific:ce},ma_data:{id:Ve,content_type:At(ce),content_type_other_details:ce,name:ce},ma_software_group:{ordinal_id:Ve,group_id:Ve,software_id:Ve},ma_qa_metric:{id:Ve,name:ce,type:At(ce),mode:At(ce),software_group_id:Ve},ma_qa_metric_global:{ordinal_id:Ve,model_id:Ve,metric_id:Ve,metric_value:Zt},ma_qa_metric_local:{ordinal_id:Ve,model_id:Ve,label_asym_id:ce,label_seq_id:Ve,label_comp_id:ce,metric_id:Ve,metric_value:Zt}};var Wd=li.Schema;const Fn=Wd.str,_pe=Wd.float,PO=Wd.List,tl=Wd.lstr,So=Wd.Aliased,Hg=Wd.int,tp=Wd.coord,ype={chem_comp:{formula:Fn,formula_weight:_pe,id:Fn,mon_nstd_parent_comp_id:PO(",",i=>i),name:Fn,one_letter_code:Fn,three_letter_code:Fn,type:So(tl),pdbx_synonyms:PO(";",i=>i),pdbx_type:Fn,pdbx_ambiguous_flag:Fn,pdbx_replaced_by:Fn,pdbx_replaces:Fn,pdbx_formal_charge:Hg,pdbx_model_coordinates_details:Fn,pdbx_model_coordinates_db_code:Fn,pdbx_ideal_coordinates_details:Fn,pdbx_ideal_coordinates_missing_flag:So(tl),pdbx_model_coordinates_missing_flag:So(tl),pdbx_initial_date:Fn,pdbx_modified_date:Fn,pdbx_release_status:So(Fn),pdbx_processing_site:So(Fn)},chem_comp_atom:{alt_atom_id:Fn,atom_id:Fn,charge:Hg,model_Cartn_x:tp,model_Cartn_y:tp,model_Cartn_z:tp,comp_id:Fn,type_symbol:Fn,pdbx_align:Hg,pdbx_ordinal:Hg,pdbx_model_Cartn_x_ideal:tp,pdbx_model_Cartn_y_ideal:tp,pdbx_model_Cartn_z_ideal:tp,pdbx_stereo_config:So(tl),pdbx_aromatic_flag:So(tl),pdbx_leaving_atom_flag:So(tl)},chem_comp_bond:{atom_id_1:Fn,atom_id_2:Fn,comp_id:Fn,value_order:So(tl),pdbx_ordinal:Hg,pdbx_stereo_config:So(tl),pdbx_aromatic_flag:So(tl)},pdbx_chem_comp_descriptor:{comp_id:Fn,descriptor:Fn,type:So(tl),program:Fn,program_version:Fn},pdbx_chem_comp_identifier:{comp_id:Fn,identifier:Fn,type:So(Fn),program:Fn,program_version:Fn}};var Q1=li.Schema;const Yt=Q1.str,xpe=Q1.float,Yl=Q1.lstr,Ss=Q1.Aliased,Xo=Q1.int,bpe={pdbx_reference_molecule:{prd_id:Yt,formula_weight:xpe,formula:Yt,type:Ss(Yl),type_evidence_code:Yt,class:Ss(Yl),class_evidence_code:Yt,name:Yt,represent_as:Ss(Yl),chem_comp_id:Yt,compound_details:Yt,description:Yt,representative_PDB_id_code:Yt,release_status:Ss(Yl),replaces:Yt,replaced_by:Yt},pdbx_reference_entity_list:{prd_id:Yt,ref_entity_id:Yt,type:Ss(Yl),details:Yt,component_id:Xo},pdbx_reference_entity_nonpoly:{prd_id:Yt,ref_entity_id:Yt,name:Yt,chem_comp_id:Yt},pdbx_reference_entity_link:{link_id:Xo,prd_id:Yt,details:Yt,ref_entity_id_1:Yt,ref_entity_id_2:Yt,entity_seq_num_1:Xo,entity_seq_num_2:Xo,comp_id_1:Yt,comp_id_2:Yt,atom_id_1:Yt,atom_id_2:Yt,value_order:Ss(Yl),component_1:Xo,component_2:Xo,link_class:Ss(Yt)},pdbx_reference_entity_poly_link:{link_id:Xo,prd_id:Yt,ref_entity_id:Yt,component_id:Xo,entity_seq_num_1:Xo,entity_seq_num_2:Xo,comp_id_1:Yt,comp_id_2:Yt,atom_id_1:Yt,atom_id_2:Yt,value_order:Ss(Yl)},pdbx_reference_entity_poly:{prd_id:Yt,ref_entity_id:Yt,type:Ss(Yt),db_code:Yt,db_name:Yt},pdbx_reference_entity_poly_seq:{prd_id:Yt,ref_entity_id:Yt,mon_id:Yt,parent_mon_id:Yt,num:Xo,observed:Ss(Yl),hetero:Ss(Yl)},pdbx_reference_entity_sequence:{prd_id:Yt,ref_entity_id:Yt,type:Ss(Yt),NRP_flag:Ss(Yt),one_letter_codes:Yt},pdbx_reference_entity_src_nat:{prd_id:Yt,ref_entity_id:Yt,ordinal:Xo,organism_scientific:Yt,taxid:Yt,db_code:Yt,db_name:Yt},pdbx_prd_audit:{prd_id:Yt,date:Yt,processing_site:Ss(Yt),action_type:Ss(Yt)}};var DH=li.Schema;const ki=DH.str,Spe={datablock:{id:ki,description:ki},dictionary:{title:ki,datablock_id:ki,version:ki},dictionary_history:{version:ki,update:ki,revision:ki},sub_category:{id:ki,description:ki},category_group_list:{id:ki,parent_id:ki,description:ki},item_type_list:{code:ki,primitive_code:ki,construct:ki,detail:ki},item_units_list:{code:ki,detail:ki},item_units_conversion:{from_code:ki,to_code:ki,operator:ki,factor:DH.float}};var J1=li.Schema;const u0=J1.str,Ky=J1.int,Kl=J1.float,Zy=J1.Aliased,hu=J1.Vector;Zy(u0),Zy(u0),Zy(u0),Zy(u0),hu(3),hu(3);const NH={volume_data_3d_info:{name:u0,axis_order:hu(3,Ky),origin:hu(3),dimensions:hu(3),sample_rate:Ky,sample_count:hu(3,Ky),spacegroup_number:Ky,spacegroup_cell_size:hu(3),spacegroup_cell_angles:hu(3),mean_source:Kl,mean_sampled:Kl,sigma_source:Kl,sigma_sampled:Kl,min_source:Kl,min_sampled:Kl,max_source:Kl,max_sampled:Kl},volume_data_3d:{values:Kl}};var l2=li.Schema;const gi=l2.float,ZA=l2.int,kn=l2.str,wpe={cell:{angle_alpha:gi,angle_beta:gi,angle_gamma:gi,formula_units_z:ZA,length_a:gi,length_b:gi,length_c:gi,volume:gi},chemical:{melting_point:gi,name_common:kn,name_systematic:kn},chemical_formula:{moiety:kn,sum:kn,weight:gi},space_group:{crystal_system:kn,it_number:ZA,"name_h-m_full":kn},space_group_symop:{operation_xyz:kn},geom_bond:{atom_site_label_1:kn,atom_site_label_2:kn,distance:gi,publ_flag:kn,site_symmetry_1:kn,site_symmetry_2:kn,valence:gi},audit:{block_doi:kn},database_code:{cod:kn,csd:kn,depnum_ccdc_archive:kn,depnum_ccdc_fiz:kn,icsd:kn,mdf:kn,nbs:kn},atom_site:{adp_type:kn,calc_flag:kn,disorder_assembly:kn,disorder_group:kn,fract_x:gi,fract_y:gi,fract_z:gi,label:kn,occupancy:gi,refinement_flags:kn,site_symmetry_multiplicity:ZA,type_symbol:kn,u_iso_or_equiv:gi},atom_site_aniso:{label:kn,u_11:gi,u:(0,l2.Matrix)(3,3),u_12:gi,u_13:gi,u_22:gi,u_23:gi,u_33:gi},atom_type:{description:kn,symbol:kn},atom_type_scat:{dispersion_imag:gi,dispersion_real:gi,source:kn}},Mpe={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},QA=li.Schema.int,Ape={volume_data_3d_info:NH.volume_data_3d_info,segmentation_data_table:{set_id:QA,segment_id:QA},segmentation_data_3d:{values:QA}},RO={parse:i=>typeof i=="string"?xO(i):TO(i),parseText:xO,parseBinary:TO,toDatabaseCollection:function(i,e,t){const n={};for(const r of e.blocks)n[r.header]=ql(i,r,t);return n},toDatabase:ql,schema:{mmCIF:i=>ql(vpe,i),CCD:i=>ql(ype,i),BIRD:i=>ql(bpe,i),dic:i=>ql(Spe,i),cifCore:i=>ql(wpe,i,Mpe),densityServer:i=>ql(NH,i),segmentation:i=>ql(Ape,i)}};class Xa{constructor(e,t){var n=t||{};this.streamer=e,this.name=he(n.name,""),this.path=he(n.path,"")}get type(){return""}get __objName(){return""}get isBinary(){return!1}get isJson(){return!1}get isXml(){return!1}parse(){return this.streamer.read().then(()=>pH(this,void 0,void 0,function*(){return yield this._beforeParse(),yield this._parse(),yield this._afterParse(),this[this.__objName]}))}_parse(){}_beforeParse(){}_afterParse(){pt&&tt.log(this[this.__objName])}}class Ic extends Xa{constructor(e,t){var n=t||{};super(e,n),this.firstModelOnly=he(n.firstModelOnly,!1),this.asTrajectory=he(n.asTrajectory,!1),this.cAlphaOnly=he(n.cAlphaOnly,!1),this.structure=new cl(this.name,this.path),this.structureBuilder=new phe(this.structure)}get type(){return"structure"}get __objName(){return"structure"}}class Wb{constructor(e,t,n="",r,s=[]){this.structure=e,this.index=t,this.description=n,this.entityType=function(o){switch(o=o.toLowerCase()){case"polymer":return 1;case"non-polymer":return 2;case"macrolide":return 3;case"water":return 4;default:return 0}}(r||""),this.chainIndexList=s,s.forEach(function(o){e.chainStore.entityIndex[o]=t})}get type(){return function(e){switch(e){case 1:return"polymer";case 2:return"non-polymer";case 3:return"macrolide";case 4:return"water";default:return}}(this.entityType)}getEntityType(){return this.entityType}isPolymer(){return this.entityType===1}isNonPolymer(){return this.entityType===2}isMacrolide(){return this.entityType===3}isWater(){return this.entityType===4}eachChain(e){const t=this.structure.getChainProxy();this.chainIndexList.forEach(function(n){t.index=n,e(t)})}}const Epe={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"};class jb{constructor(e=Epe){this.cartToFrac=new Ct,this.fracToCart=new Ct,this.a=e.a,this.b=e.b,this.c=e.c,this.alpha=e.alpha,this.beta=e.beta,this.gamma=e.gamma,this.spacegroup=e.spacegroup;const t=Pi(this.alpha),n=Pi(this.beta),r=Pi(this.gamma),s=Math.cos(t),o=Math.cos(n),a=Math.cos(r),l=Math.sin(n),c=Math.sin(r);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-s*s-o*o-a*a+2*s*o*a),e.cartToFrac===void 0){const u=this.a*this.b*c/this.volume,h=(o*a-s)/(l*c);this.fracToCart.set(this.a,0,0,0,this.b*a,this.b*c,0,0,this.c*o,-this.c*l*h,1/u,0,0,0,0,1).transpose(),this.cartToFrac.copy(this.fracToCart).invert()}else this.cartToFrac.copy(e.cartToFrac),this.fracToCart.copy(this.cartToFrac).invert()}getPosition(e){const t=new Float32Array(24);if(e.unitcell){const n=e.unitcell,r=e.center.clone().applyMatrix4(n.cartToFrac).floor(),s=new me;let o=0;const a=function(l,c,u){s.set(l,c,u).add(r).applyMatrix4(n.fracToCart).toArray(t,o),o+=3};a(0,0,0),a(1,0,0),a(0,1,0),a(0,0,1),a(1,1,0),a(1,0,1),a(0,1,1),a(1,1,1)}return t}getCenter(e){return function(t,n=new me){const r=t.length;for(let s=0;s<r;s+=3)n.x+=t[s],n.y+=t[s+1],n.z+=t[s+2];return n.divideScalar(r/3),n}(this.getPosition(e))}getData(e,t={}){const n=he(t.colorValue,"orange"),r=he(t.radius,Math.cbrt(this.volume)/200),s=new $t(n),o=new me,a=this.getPosition(e),l=Hn(8,s.r,s.g,s.b),c=Lo(8,r),u=new Float32Array(36),h=new Float32Array(36),d=Hn(12,s.r,s.g,s.b),f=Lo(12,r);let p=0;function _(g,b){o.fromArray(a,3*g).toArray(u,p),o.fromArray(a,3*b).toArray(h,p),p+=3}_(0,1),_(0,2),_(0,3),_(1,4),_(1,5),_(2,6),_(3,5),_(4,7),_(5,7),_(2,4),_(7,6),_(3,6);const v=new Bue(this,e);return{vertex:{position:a,color:l,radius:c,picking:v},edge:{position1:u,position2:h,color:d,color2:d,radius:f,picking:v}}}}const Xb={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},Tpe=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],Cpe=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],IO=/\s+/;function LO(i,e,t){let n=`${i}`;return e&&(n+=`:${e}`),t&&(n+=`^${t}`),n}class N0 extends Ic{constructor(e,t){const n=t||{};super(e,n),this.hex=he(n.hex,!1),this.inferBonds=he(n.inferBonds,"all")}get type(){return"pdb"}_parse(){pt&&tt.time("PdbParser._parse "+this.name);let e=!1;const t=this.streamer.peekLines(1)[0],n=t.substr(62,4),r=t.substr(72,4);n===r&&r.trim()&&(e=!0);const s=this.type==="pqr",o=this.type==="pdbqt",a=this.structure,l=this.structureBuilder,c=this.hex;let u=10,h=10;const d=this.firstModelOnly,f=this.asTrajectory,p=this.cAlphaOnly,_=a.frames,v=a.boxes;let g,b,m=!1;const y=a.biomolDict;let A,w,M,T,E,C,N,P,L,R,F,V,G,U,z,O,D,B,W,q,j,te,ne={};const Z={},le={},re=[];let se,$;const fe={},xe={},Ie={};let ge,Oe,Me,Y,Q,de,Le;const ie={};let K;const be={helices:[],sheets:[]},Ue=be.helices,ve=be.sheets,Ne=a.atomMap,$e=a.atomStore;$e.resize(Math.round(this.streamer.data.length/80)),(s||o)&&$e.addField("partialCharge",1,"float32"),s&&$e.addField("radius",1,"float32");const Ee=a.getAtomProxy(),Ze=a.getAtomProxy();let nt=0,rt=0,Be=!0;this.streamer.eachChunkOfLines(function(it){(function(at,ht,Qe){for(let je=at;je<ht;++je)if(T=Qe[je],E=T.substr(0,6),E==="ATOM  "||E==="HETATM"){if(Be&&(f?(m?(g=new Float32Array(3*$e.count),_.push(g)):g=[],b=0):d||(ne={}),ge=1,Oe=ge.toString(),Me=!0,Be=!1),d&&rt>0)continue;let ee,Ge,Ce,De,Xe,gt=0;if(s){if(De=T.split(IO),gt=De.length===10?1:0,V=De[2],p&&V!=="CA")continue;ee=parseFloat(De[6-gt]),Ge=parseFloat(De[7-gt]),Ce=parseFloat(De[8-gt])}else{if(V=T.substr(12,4).trim(),p&&V!=="CA")continue;ee=parseFloat(T.substr(30,8)),Ge=parseFloat(T.substr(38,8)),Ce=parseFloat(T.substr(46,8))}if(f){const Mt=3*b;if(g[Mt+0]=ee,g[Mt+1]=Ge,g[Mt+2]=Ce,b+=1,m)continue}s?(C=parseInt(De[1]),Xe="",G=T[0]==="H",N=gt?"":De[4],P=parseInt(De[5-gt]),F="",L=De[3],z="",R=1):(C=parseInt(T.substr(6,5),u),c&&C===99999&&(u=16),G=T[0]==="H",N=T[21].trim(),P=parseInt(T.substr(22,4),h),c&&P===9999&&(h=16),F=T[26].trim(),L=T.substr(17,4).trim()||"MOL",U=parseFloat(T.substr(60,6)),z=T[16].trim(),R=parseFloat(T.substr(54,6)),e||(o?(Xe=T.substr(76,3).trim(),Xe in JU&&(Xe=JU[Xe])):(Xe=T.substr(76,2).trim(),N||(N=T.substr(72,4).trim())),O=parseInt((T.substr(79,1)+T.substr(78,1)).trim()))),$e.growIfFull(),$e.atomTypeId[nt]=Ne.add(V,Xe),$e.x[nt]=ee,$e.y[nt]=Ge,$e.z[nt]=Ce,$e.serial[nt]=C,$e.altloc[nt]=z.charCodeAt(0),$e.occupancy[nt]=isNaN(R)?0:R,s?($e.partialCharge[nt]=parseFloat(De[9-gt]),$e.radius[nt]=parseFloat(De[10-gt])):($e.bfactor[nt]=isNaN(U)?0:U,o&&($e.partialCharge[nt]=parseFloat(T.substr(70,6))),isFinite(O)&&($e.formalCharge||$e.addField("formalCharge",1,"int8"),$e.formalCharge[nt]=O));const _t=LO(P,N,F);!G||xe[_t]||Tpe.includes(L)?Me||Y===N||(ge+=1,Oe=ge.toString()):Y===N&&de===L&&(Fb.includes(L)||Q===P&&Le===F)||(ge+=1,Oe=ge.toString(),Q=P,de=L,Le=F),l.addAtom(rt,N,Oe,L,P,G,void 0,F),ne[C]=nt,nt+=1,Me=!1,Y=N}else if(E==="CONECT"){const ee=ne[parseInt(T.substr(6,5))],Ge=[11,16,21,26],Ce={};if(ee===void 0)continue;for(let De=0;De<4;++De){let Xe=parseInt(T.substr(Ge[De],5));if(!Number.isNaN(Xe)&&(Xe=ne[Xe],Xe!==void 0))if(ee<Xe?(Ee.index=ee,Ze.index=Xe):(Ee.index=Xe,Ze.index=ee),Ce[Xe]!==void 0)a.bondStore.bondOrder[Ce[Xe]]+=1;else{const gt=Ee.index+"|"+Ze.index;le[gt]===void 0&&(le[gt]=!0,Ce[Xe]=a.bondStore.count,a.bondStore.addBond(Ee,Ze,1))}}}else if(E==="HELIX "){D=T[19].trim(),B=parseInt(T.substr(21,4)),W=T[25].trim(),q=T[31].trim(),j=parseInt(T.substr(33,4)),te=T[37].trim();let ee=parseInt(T.substr(39,1));ee=(Xb[ee]||Xb[0]).charCodeAt(0),Ue.push([D,B,W,q,j,te,ee])}else if(E==="SHEET ")D=T[21].trim(),B=parseInt(T.substr(22,4)),W=T[26].trim(),q=T[32].trim(),j=parseInt(T.substr(33,4)),te=T[37].trim(),ve.push([D,B,W,q,j,te]);else if(E==="HETNAM")fe[T.substr(11,3)]=T.substr(15).trim();else if(E==="SEQRES"){const ee=T[11].trim();ee!==K&&(ie[ee]=[],K=ee),ie[ee].push(...T.substr(19).trim().split(IO))}else if(E==="MODRES"){const ee=T.substr(12,3).trim(),Ge=T[16].trim(),Ce=T[22].trim(),De=parseInt(T.substr(18,4).trim()),Xe=LO(De,Ge,Ce);xe[Xe]={resname:ee,chainname:Ge,inscode:Ce,resno:De}}else if(E==="COMPND"){const ee=T.substr(10,70).trim(),Ge=ee.indexOf(":"),Ce=ee.substring(0,Ge);let De;Cpe.includes(Ce)?($=Ce,De=ee.substring(Ge+2)):De=ee,De=De.replace(/;$/,""),$==="MOL_ID"?(se={chainList:[],name:""},re.push(se)):$==="MOLECULE"?(se.name&&(se.name+=" "),se.name+=De):$==="CHAIN"&&Array.prototype.push.apply(se.chainList,De.split(/\s*,\s*/))}else if(T.startsWith("TER")){const ee=a.getChainProxy(a.chainStore.count-1);Ie[ee.chainname]=ee.index,ge+=1,Oe=ge.toString(),Me=!0}else if(E==="REMARK"&&T.substr(7,3)==="350"){if(T.substr(11,12)==="BIOMOLECULE:"){let ee=T.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(ee)&&(ee="BU"+ee),A=new Wu(ee),y[ee]=A}else if(T.substr(13,5)==="BIOMT"){const ee=T.split(/\s+/),Ge=parseInt(T[18])-1;Ge===0&&(M=new Ct,w.matrixList.push(M));const Ce=M.elements;Ce[0+Ge]=parseFloat(ee[4]),Ce[4+Ge]=parseFloat(ee[5]),Ce[8+Ge]=parseFloat(ee[6]),Ce[12+Ge]=parseFloat(ee[7])}else if(T.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||T.substr(11,30)==="                   AND CHAINS:"){T.substr(11,5)==="APPLY"&&(w=A.addPart());const ee=T.substr(41,30).split(",");for(let Ge=0,Ce=ee.length;Ge<Ce;++Ge){const De=ee[Ge].trim();De&&w.chainList.push(De)}}}else if(E==="HEADER")a.id=T.substr(62,4);else if(E==="TITLE ")a.title+=(a.title?" ":"")+T.substr(10,70).trim();else if(E==="MODEL ")Be=!0;else if(E==="ENDMDL"||T.trim()==="END"){if(Be)continue;f&&!m&&(_.push(new Float32Array(g)),m=!0),rt+=1,Be=!0}else if(T.substr(0,5)==="MTRIX"){if(T[59]==="1")continue;if(!A||A.name!=="NCS"){const De="NCS";A=new Wu(De),y[De]=A,w=A.addPart()}const ee=T.split(/\s+/),Ge=parseInt(T[5])-1;Ge===0&&(M=new Ct,w.matrixList.push(M));const Ce=M.elements;Ce[0+Ge]=parseFloat(ee[2]),Ce[4+Ge]=parseFloat(ee[3]),Ce[8+Ge]=parseFloat(ee[4]),Ce[12+Ge]=parseFloat(ee[5])}else if(T.substr(0,5)==="ORIGX"){Z.origx||(Z.origx=new Ct);const ee=T.split(/\s+/),Ge=parseInt(T[5])-1,Ce=Z.origx.elements;Ce[0+Ge]=parseFloat(ee[1]),Ce[4+Ge]=parseFloat(ee[2]),Ce[8+Ge]=parseFloat(ee[3]),Ce[12+Ge]=parseFloat(ee[4])}else if(T.substr(0,5)==="SCALE"){Z.scale||(Z.scale=new Ct);const ee=T.split(/\s+/),Ge=parseInt(T[5])-1,Ce=Z.scale.elements;Ce[0+Ge]=parseFloat(ee[1]),Ce[4+Ge]=parseFloat(ee[2]),Ce[8+Ge]=parseFloat(ee[3]),Ce[12+Ge]=parseFloat(ee[4])}else if(E==="CRYST1"){const ee=parseFloat(T.substr(6,9)),Ge=parseFloat(T.substr(15,9)),Ce=parseFloat(T.substr(24,9)),De=parseFloat(T.substr(33,7)),Xe=parseFloat(T.substr(40,7)),gt=parseFloat(T.substr(47,7)),_t=T.substr(55,11).trim(),Mt=new Float32Array(9);Mt[0]=ee,Mt[4]=Ge,Mt[8]=Ce,v.push(Mt),rt===0&&(Z.a=ee,Z.b=Ge,Z.c=Ce,Z.alpha=De,Z.beta=Xe,Z.gamma=gt,Z.spacegroup=_t)}})(0,it.length,it)}),l.finalize();const qe=re.length;if(qe){a.eachChain(function(Qe){Qe.entityIndex=qe}),re.forEach(function(Qe,je){const ee=Qe.chainList.map(function(Ge){return Ie[Ge]});a.entityList.push(new Wb(a,je,Qe.name,"polymer",ee))});let it=re.length;const at=a.getResidueProxy(),ht={};a.eachChain(function(Qe){Qe.entityIndex===qe&&(at.index=Qe.residueOffset,ht[at.resname]||(ht[at.resname]=[]),ht[at.resname].push(Qe.index))}),Object.keys(ht).forEach(function(Qe){const je=ht[Qe];let ee="non-polymer",Ge=fe[Qe]||Qe;Fb.includes(Qe)&&(Ge="water",ee="water"),a.entityList.push(new Wb(a,it,Ge,ee,je)),it+=1})}Z.a!==void 0?a.unitcell=new jb(Z):a.unitcell=void 0,(Ue.length||ve.length)&&nH(a,be),a.finalizeAtoms(),e||r2(a),Ub(a,this.inferBonds),a.finalizeBonds(),Ue.length||ve.length||i2(a),Ob(a),pt&&tt.timeEnd("PdbParser._parse "+this.name)}}Qt.add("pdb",N0),Qt.add("pdb1",N0),Qt.add("ent",N0);class Ppe{constructor(e){this.structure=e,this.dict={},this.structure=e}add(e,t,n){this.dict[e]={chemCompType:t},n&&(this.dict[e].bonds=n)}addBond(e,t,n,r){const s=this.dict[e];if(!s)return;s.bonds||(s.bonds={atom1:[],atom2:[],bondOrders:[]});const o=s.bonds;o.atom1.push(t),o.atom2.push(n),o.bondOrders.push(r)}getBonds(e,t){var n;const r=(n=this.dict[e])===null||n===void 0?void 0:n.bonds;if(!r)return;const s=this.structure.atomMap,o=new Map(t.map((d,f)=>{var p;return[(p=s.get(d))===null||p===void 0?void 0:p.atomname,f]})),a=[],l=[],c=[];let u,h;for(let d=0;d<r.atom1.length;d++)(u=o.get(r.atom1[d]))!==void 0&&(h=o.get(r.atom2[d]))!==void 0&&(a.push(u),l.push(h),c.push(r.bondOrders[d]));return{atomIndices1:a,atomIndices2:l,bondOrders:c}}}const Rpe=/^\D{1,2}/,Ipe={HELX_RH_AL_P:"h",STRN:"e",HELX_RH_3T_P:"g",HELX_RH_PI_P:"i",HELX_LH_PP_P:"e",TURN_TY1_P:"t",BEND:"s",OTHER:" "},Lpe={AROM:1,DELO:2,DIRECTED:0,DOUB:2,PI:0,POLY:0,QUAD:4,SING:1,TRIP:3};function DO(i){switch(i.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}class Qy extends Ic{get type(){return"cif"}get isBinary(){return!1}_parse(){var e,t,n,r,s,o,a,l,c,u,h,d,f,p,_,v,g,b,m,y,A;return pH(this,void 0,void 0,function*(){tt.time("CifParser._parse "+this.name);const w=this.structure,M=this.structureBuilder,T=this.firstModelOnly,E=this.asTrajectory,C=w.frames;let N,P;const L=this.isBinary?RO.parseBinary(this.streamer.data):RO.parseText(this.streamer.compressed?v1(this.streamer.data):this.streamer.data),R=yield L.run();if(R.isError)throw R;const F=R.result.blocks[0];if("chem_comp"in F.categories&&"chem_comp_atom"in F.categories&&!("struct"in F.categories))(function(V,G,U){const z=G.atomStore,O=G.atomMap;let D,B;const W=V.chem_comp,q=V.chem_comp_atom,j=V.chem_comp_bond;let te;W&&((te=W.getField("name"))&&(G.title=te.str(0)),(te=W.getField("id"))&&(G.id=te.str(0)));const ne={};if(q){let Z,le,re,se;B=q.rowCount,z.resize(2*B);const $=q.getField("atom_id"),fe=q.getField("type_symbol"),xe=q.getField("pdbx_component_comp_id"),Ie=q.getField("pdbx_residue_numbering");[["model_Cartn_x","model_Cartn_y","model_Cartn_z"],["pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal"]].forEach(([ge,Oe,Me],Y)=>{var Q;const de=q.getField(ge),Le=q.getField(Oe),ie=q.getField(Me),K=Y*B;for(let be=0;be<B;++be){const Ue=be+K;z.growIfFull(),Z=$==null?void 0:$.str(be),le=fe==null?void 0:fe.str(be),ne[Z]=be,z.atomTypeId[Ue]=O.add(Z,le),z.x[Ue]=de.float(be),z.y[Ue]=Le.float(be),z.z[Ue]=ie.float(be),z.serial[Ue]=be,re=xe.str(be),se=(Q=Ie==null?void 0:Ie.int(be))!==null&&Q!==void 0?Q:1,U.addAtom(Y,"","",re,se,!0)}})}if(q&&j){let Z,le,re;B=j.rowCount;const se=q.rowCount,$=G.getAtomProxy(),fe=G.getAtomProxy(),xe=j.getField("atom_id_1"),Ie=j.getField("atom_id_2"),ge=j.getField("value_order");for(D=0;D<B;++D)Z=xe.str(D),le=Ie.str(D),re=DO(ge.str(D)),$.index=ne[Z],fe.index=ne[le],G.bondStore.growIfFull(),G.bondStore.addBond($,fe,re),$.index+=se,fe.index+=se,G.bondStore.growIfFull(),G.bondStore.addBond($,fe,re)}})(F.categories,w,M),M.finalize(),w.finalizeAtoms(),w.finalizeBonds(),Nd(w);else if("atom_site_type_symbol"in F.categories&&"atom_site_label"in F.categories&&"atom_site_fract_x"in F.categories)(function(V,G,U){var z,O,D=G.atomStore,B=G.atomMap;V.header&&(G.id=V.header,G.name=V.header),G.unitcell=new jb({a:V.getField("cell_length_a").float(0),b:V.getField("cell_length_b").float(0),c:V.getField("cell_length_c").float(0),alpha:V.getField("cell_angle_alpha").float(0),beta:V.getField("cell_angle_beta").float(0),gamma:V.getField("cell_angle_gamma").float(0),spacegroup:V.getField("symmetry_space_group_name_H-M").str(0)});const W=new me,q=new me,j=V.getField("atom_site_type_symbol");if(!j)return;const te=(z=j.rowCount)!==null&&z!==void 0?z:0,ne=V.getField("atom_site_type_symbol"),Z=V.getField("atom_site_fract_x"),le=V.getField("atom_site_fract_y"),re=V.getField("atom_site_fract_z"),se=V.getField("atom_site_occupancy"),$={};for(let Y=0;Y<te;++Y){D.growIfFull();const Q=ne.str(Y),de=j.str(Y);let Le=$[de];if(!Le){const ie=de.match(Rpe);$[de]=Le=(O=ie==null?void 0:ie[0])!==null&&O!==void 0?O:de}D.atomTypeId[Y]=B.add(Q,Le),W.set(Z.float(Y),le.float(Y),re.float(Y)),W.applyMatrix4(G.unitcell.fracToCart),q.add(W),D.x[Y]=W.x,D.y[Y]=W.y,D.z[Y]=W.z,se&&(D.occupancy[Y]=se.float(Y)),D.serial[Y]=Y,U.addAtom(0,"","","HET",1,!0)}q.divideScalar(te),G.center=q,Ob(G);const fe=new me,xe=new me,Ie=G.biomolDict.SUPERCELL.partList[0].matrixList;let ge=te;function Oe(Y){return B.get(D.atomTypeId[Y]).covalent}const Me=new Ct;for(let Y=0;Y<te;++Y){const Q=Oe(Y);W.set(D.x[Y],D.y[Y],D.z[Y]),Ie.forEach(function(de){if(!Me.equals(de)){fe.copy(W),fe.applyMatrix4(de);for(let Le=0;Le<te;++Le){xe.set(D.x[Le],D.y[Le],D.z[Le]);const ie=fe.distanceToSquared(xe),K=Oe(Le)+Q,be=K+.3,Ue=K-.5;if(ie<be*be&&ie>Ue*Ue)return D.growIfFull(),D.atomTypeId[ge]=D.atomTypeId[Y],D.x[ge]=fe.x,D.y[ge]=fe.y,D.z[ge]=fe.z,D.occupancy[ge]=D.occupancy[Y],D.serial[ge]=ge,D.altloc[ge]=65,U.addAtom(0,"","","HET",1,!0),void(ge+=1)}}})}})(F,w,M),M.finalize(),w.finalizeAtoms(),Ub(w),w.finalizeBonds();else{const V={},G={},U=w.atomMap,z=w.atomStore,O=F.categories.atom_site;let D=O.rowCount;const B=O.getField("pdbx_PDB_model_num");if(!((e=B==null?void 0:B.areValuesEqual(0,D-1))===null||e===void 0||e)&&(E||T)){const Y=B.int(0);for(let Q=0;Q<D;Q++)if(B.int(Q)>Y){D=Q;break}}w.chemCompMap=new Ppe(w);const W=F.categories.chem_comp;let q=W.getField("id");const j=W.getField("type");for(let Y=0;Y<W.rowCount;Y++)w.chemCompMap.add(q.str(Y),j.str(Y).toUpperCase());if(F.categoryNames.includes("chem_comp_bond")){const Y=F.categories.chem_comp_bond;q=Y.getField("comp_id");const Q=Y.getField("atom_id_1"),de=Y.getField("atom_id_2"),Le=Y.getField("value_order");for(let ie=0;ie<Y.rowCount;ie++){const K=Lpe[Le.str(ie)];K&&w.chemCompMap.addBond(q.str(ie),Q.str(ie),de.str(ie),K)}}const te=(Y,Q,de)=>{const Le=Y.getField(Q);return Le?Le.toFloatArray({array:Float32Array,start:0,end:de}):new Float32Array(de)};z.resize(D),z.x=te(O,"Cartn_x",D),z.y=te(O,"Cartn_y",D),z.z=te(O,"Cartn_z",D),z.serial=O.getField("id").toIntArray({start:0,end:D}),z.bfactor=te(O,"B_iso_or_equiv",D),z.occupancy=te(O,"occupancy",D);const ne=O.getField("label_alt_id");ne!=null&&ne.isDefined&&(z.altloc=Uint8Array.from(ne.toStringArray(),Y=>Y.charCodeAt(0)));const Z=O.getField("label_atom_id"),le=O.getField("type_symbol");q=O.getField("label_comp_id");const re=(t=O.getField("auth_seq_id"))!==null&&t!==void 0?t:O.getField("label_seq_id"),se=O.getField("pdbx_PDB_ins_code"),$=O.getField("auth_asym_id"),fe=O.getField("label_asym_id"),xe=O.getField("group_PDB"),Ie=O.getField("label_entity_id");for(let Y=0;Y<D;Y++){const Q=(n=B==null?void 0:B.int(Y))!==null&&n!==void 0?n:1,de=(r=$==null?void 0:$.str(Y))!==null&&r!==void 0?r:"",Le=(s=fe==null?void 0:fe.str(Y))!==null&&s!==void 0?s:"",ie=(o=q==null?void 0:q.str(Y))!==null&&o!==void 0?o:"",K=(a=re==null?void 0:re.int(Y))!==null&&a!==void 0?a:0,be=(xe==null?void 0:xe.str(Y)[0])==="H",Ue=(l=se==null?void 0:se.str(Y))!==null&&l!==void 0?l:"",ve=(c=Ie==null?void 0:Ie.int(Y))!==null&&c!==void 0?c:1;z.atomTypeId[Y]=U.add((Z==null?void 0:Z.str(Y))||"",le==null?void 0:le.str(Y)),M.addAtom(Q-1,de,Le,ie,K,be,void 0,Ue),V[Le]=de,G[ve]||(G[ve]=new Set),G[ve].add(w.chainStore.count-1)}if(E){const Y=O.rowCount/D|0,Q=O.getField("Cartn_x"),de=O.getField("Cartn_y"),Le=O.getField("Cartn_z");for(let ie=0;ie<Y;ie++){N=new Float32Array(3*D);const K=ie*D,be=K+D;P=0;for(let Ue=K;Ue<be;Ue++)N[P+0]=Q.float(Ue),N[P+1]=de.float(Ue),N[P+2]=Le.float(Ue),P+=3;C.push(N)}}const ge=function(Y,Q,de){var Le,ie,K,be,Ue,ve;const Ne=[],$e=[];let Ee,Ze,nt,rt;const Be=Y.struct_conf;if(Be!=null&&Be.fieldNames.includes("pdbx_PDB_helix_class")){const it=Be.getField("pdbx_beg_PDB_ins_code"),at=Be.getField("pdbx_end_PDB_ins_code"),ht=Be.getField("pdbx_PDB_helix_class"),Qe=Be.getField("beg_label_asym_id"),je=Be.getField("end_label_asym_id"),ee=Be.getField("beg_auth_seq_id"),Ge=Be.getField("end_auth_seq_id");for(Ee=0,Ze=Be.rowCount;Ee<Ze;++Ee){const Ce=ht==null?void 0:ht.int(Ee);Number.isFinite(Ce)&&(nt=(Le=it==null?void 0:it.str(Ee))!==null&&Le!==void 0?Le:"",rt=(ie=at==null?void 0:at.str(Ee))!==null&&ie!==void 0?ie:"",Ne.push([de[Qe.str(Ee)],ee.int(Ee),nt,de[je.str(Ee)],Ge.int(Ee),rt,(Xb[Ce]||Xb[0]).charCodeAt(0)]))}}else if(Be!=null&&Be.fieldNames.includes("conf_type_id")){const it=Be.getField("conf_type_id"),at=Be.getField("pdbx_beg_PDB_ins_code"),ht=Be.getField("pdbx_end_PDB_ins_code"),Qe=Be.getField("beg_label_asym_id"),je=Be.getField("end_label_asym_id"),ee=Be.getField("beg_auth_seq_id"),Ge=Be.getField("end_auth_seq_id");let Ce;for(Ee=0,Ze=Be.rowCount;Ee<Ze;++Ee){const De=it.str(Ee);(Ce=Ipe[De])&&(nt=(K=at==null?void 0:at.str(Ee))!==null&&K!==void 0?K:"",rt=(be=ht==null?void 0:ht.str(Ee))!==null&&be!==void 0?be:"",Ce==="h"||Ce==="g"||Ce==="i"?Ne.push([de[Qe.str(Ee)],ee.int(Ee),nt,de[je.str(Ee)],Ge.int(Ee),rt,Ce.charCodeAt(0)]):Ce==="e"&&$e.push([de[Qe.str(Ee)],ee.int(Ee),nt,de[je.str(Ee)],Ge.int(Ee),rt]))}}const qe=Y.struct_sheet_range;if(qe&&$e.length===0){const it=qe.getField("pdbx_beg_PDB_ins_code"),at=qe.getField("pdbx_end_PDB_ins_code"),ht=qe.getField("beg_label_asym_id"),Qe=qe.getField("end_label_asym_id"),je=qe.getField("beg_auth_seq_id"),ee=qe.getField("end_auth_seq_id");for(Ee=0,Ze=qe.rowCount;Ee<Ze;++Ee)nt=(Ue=it==null?void 0:it.str(Ee))!==null&&Ue!==void 0?Ue:"",rt=(ve=at==null?void 0:at.str(Ee))!==null&&ve!==void 0?ve:"",$e.push([de[ht.str(Ee)],je.int(Ee),nt,de[Qe.str(Ee)],ee.int(Ee),rt])}return!(!Be&&!qe)&&{helices:Ne,sheets:$e}}(F.categories,0,V);let Oe,Me;if(function(Y,Q,de){const Le={},ie=Q.biomolDict;if(Y.pdbx_struct_oper_list){const ve=Y.pdbx_struct_oper_list,Ne=ve.getField("id"),$e=ve.getField("matrix[1][1]"),Ee=ve.getField("matrix[1][2]"),Ze=ve.getField("matrix[1][3]"),nt=ve.getField("matrix[2][1]"),rt=ve.getField("matrix[2][2]"),Be=ve.getField("matrix[2][3]"),qe=ve.getField("matrix[3][1]"),it=ve.getField("matrix[3][2]"),at=ve.getField("matrix[3][3]"),ht=ve.getField("vector[1]"),Qe=ve.getField("vector[2]"),je=ve.getField("vector[3]");for(let ee=0;ee<ve.rowCount;ee++){const Ge=new Ct,Ce=Ge.elements;Ce[0]=$e.float(ee),Ce[1]=Ee.float(ee),Ce[2]=Ze.float(ee),Ce[4]=nt.float(ee),Ce[5]=rt.float(ee),Ce[6]=Be.float(ee),Ce[8]=qe.float(ee),Ce[9]=it.float(ee),Ce[10]=at.float(ee),Ce[3]=ht.float(ee),Ce[7]=Qe.float(ee),Ce[11]=je.float(ee),Ge.transpose(),Le[Ne.str(ee)]=Ge}}if(Y.pdbx_struct_assembly_gen){const ve=Y.pdbx_struct_assembly_gen,Ne=function(nt){const rt={};return nt.replace(/[()']/g,"").split(",").forEach(function(Be){if(Be.includes("-"))for(var qe=Be.split("-"),it=parseInt(qe[0]),at=parseInt(qe[1]);it<=at;++it)rt[it]=Le[it];else rt[Be]=Le[Be]}),rt},$e=ve.getField("assembly_id"),Ee=ve.getField("oper_expression"),Ze=ve.getField("asym_id_list");for(let nt=0;nt<ve.rowCount;nt++){const rt=$e.int(nt);let Be={},qe=Ee.str(nt).replace(/['"]\(|['"]/g,"");if(qe.includes(")(")||qe.indexOf("(")>0){const[Qe,je]=qe.split("(").filter(Ce=>!!Ce),ee=Ne(Qe),Ge=Ne(je);Object.keys(ee).forEach(function(Ce){Object.keys(Ge).forEach(function(De){const Xe=new Ct;Xe.multiplyMatrices(ee[Ce],Ge[De]),Be[Ce+"x"+De]=Xe})})}else Be=Ne(qe);const it=[];for(let Qe in Be)it.push(Be[Qe]);let at=""+rt;/^(0|[1-9][0-9]*)$/.test(at)&&(at="BU"+at);const ht=Ze.str(nt).split(",").map(Qe=>de[Qe]);ie[at]===void 0&&(ie[at]=new Wu(at)),ie[at].addPart(it,ht)}}if(Y.struct_ncs_oper){const ve=Y.struct_ncs_oper,Ne="NCS";ie[Ne]=new Wu(Ne);const $e=ie[Ne].addPart(),Ee=ve.getField("code"),Ze=ve.getField("matrix[1][1]"),nt=ve.getField("matrix[1][2]"),rt=ve.getField("matrix[1][3]"),Be=ve.getField("matrix[2][1]"),qe=ve.getField("matrix[2][2]"),it=ve.getField("matrix[2][3]"),at=ve.getField("matrix[3][1]"),ht=ve.getField("matrix[3][2]"),Qe=ve.getField("matrix[3][3]"),je=ve.getField("vector[1]"),ee=ve.getField("vector[2]"),Ge=ve.getField("vector[3]");for(let Ce=0;Ce<ve.rowCount;Ce++){if(Ee.str(Ce)==="given")return;const De=new Ct,Xe=De.elements;Xe[0]=Ze.float(Ce),Xe[1]=nt.float(Ce),Xe[2]=rt.float(Ce),Xe[4]=Be.float(Ce),Xe[5]=qe.float(Ce),Xe[6]=it.float(Ce),Xe[8]=at.float(Ce),Xe[9]=ht.float(Ce),Xe[10]=Qe.float(Ce),Xe[3]=je.float(Ce),Xe[7]=ee.float(Ce),Xe[11]=Ge.float(Ce),De.transpose(),$e.matrixList.push(De)}$e.matrixList.length===0&&delete ie[Ne]}const K={};if(Y.cell){const ve=Y.cell,Ne=ve.getField("length_a").float(0),$e=ve.getField("length_b").float(0),Ee=ve.getField("length_c").float(0),Ze=new Float32Array(9);Ze[0]=Ne,Ze[4]=$e,Ze[8]=Ee,Q.boxes.push(Ze),K.a=Ne,K.b=$e,K.c=Ee,K.alpha=ve.getField("angle_alpha").float(0),K.beta=ve.getField("angle_beta").float(0),K.gamma=ve.getField("angle_gamma").float(0)}Y.symmetry&&(K.spacegroup=Y.symmetry.getField("space_group_name_H-M").str(0));const be=new Ct;if(Y.database_PDB_matrix){const ve=Y.database_PDB_matrix,Ne=be.elements,$e=ve.getField("origx[1][1]"),Ee=ve.getField("origx[1][2]"),Ze=ve.getField("origx[1][3]"),nt=ve.getField("origx[2][1]"),rt=ve.getField("origx[2][2]"),Be=ve.getField("origx[2][3]"),qe=ve.getField("origx[3][1]"),it=ve.getField("origx[3][2]"),at=ve.getField("origx[3][3]"),ht=ve.getField("origx_vector[1]"),Qe=ve.getField("origx_vector[2]"),je=ve.getField("origx_vector[3]");Ne[0]=$e.float(0),Ne[1]=Ee.float(0),Ne[2]=Ze.float(0),Ne[4]=nt.float(0),Ne[5]=rt.float(0),Ne[6]=Be.float(0),Ne[8]=qe.float(0),Ne[9]=it.float(0),Ne[10]=at.float(0),Ne[3]=ht.float(0),Ne[7]=Qe.float(0),Ne[11]=je.float(0),be.transpose(),K.origx=be}const Ue=new Ct;if(Y.atom_sites){const ve=Y.atom_sites,Ne=Ue.elements,$e=ve.getField("fract_transf_matrix[1][1]"),Ee=ve.getField("fract_transf_matrix[1][2]"),Ze=ve.getField("fract_transf_matrix[1][3]"),nt=ve.getField("fract_transf_matrix[2][1]"),rt=ve.getField("fract_transf_matrix[2][2]"),Be=ve.getField("fract_transf_matrix[2][3]"),qe=ve.getField("fract_transf_matrix[3][1]"),it=ve.getField("fract_transf_matrix[3][2]"),at=ve.getField("fract_transf_matrix[3][3]"),ht=ve.getField("fract_transf_vector[1]"),Qe=ve.getField("fract_transf_vector[2]"),je=ve.getField("fract_transf_vector[3]");Ne[0]=$e.float(0),Ne[1]=Ee.float(0),Ne[2]=Ze.float(0),Ne[4]=nt.float(0),Ne[5]=rt.float(0),Ne[6]=Be.float(0),Ne[8]=qe.float(0),Ne[9]=it.float(0),Ne[10]=at.float(0),Ne[3]=ht.float(0),Ne[7]=Qe.float(0),Ne[11]=je.float(0),Ue.transpose(),K.scale=Ue}K.a!==void 0?Q.unitcell=new jb(K):Q.unitcell=void 0}(F.categories,w,V),function(Y,Q,de){const Le=Y.struct_conn;if(Le){const be=Q.getAtomProxy(),Ue=Q.getAtomProxy(),ve={},Ne=Le.getField("conn_type_id"),$e=Le.getField("ptnr1_symmetry"),Ee=Le.getField("pdbx_ptnr1_PDB_ins_code"),Ze=Le.getField("pdbx_ptnr1_label_alt_id"),nt=Le.getField("ptnr1_auth_seq_id"),rt=Le.getField("ptnr1_label_asym_id"),Be=Le.getField("ptnr1_label_atom_id"),qe=Le.getField("ptnr2_symmetry"),it=Le.getField("pdbx_ptnr2_PDB_ins_code"),at=Le.getField("pdbx_ptnr2_label_alt_id"),ht=Le.getField("ptnr2_auth_seq_id"),Qe=Le.getField("ptnr2_label_asym_id"),je=Le.getField("ptnr2_label_atom_id"),ee=Le.getField("pdbx_value_order");for(let Ge=0,Ce=Le.rowCount;Ge<Ce;++Ge){const De=Ne.str(Ge);if(De==="hydrog"||De==="mismat"||De==="saltbr"||$e.str(Ge)!=="1_555"||qe.str(Ge)!=="1_555")continue;const Xe=Ee.str(Ge),gt=Ze.str(Ge),_t=nt.str(Ge)+(Xe?"^"+Xe:"")+":"+de[rt.str(Ge)]+"."+Be.str(Ge)+(gt?"%"+gt:"");let Mt=ve[_t];if(!Mt){const Se=new ii(_t);if(Se.selection.error){pt&&tt.warn("invalid selection for connection",_t);continue}Mt=Q.getAtomIndices(Se),ve[_t]=Mt}const J=it.str(Ge),ae=at.str(Ge),ue=ht.str(Ge)+(J?"^"+J:"")+":"+de[Qe.str(Ge)]+"."+je.str(Ge)+(ae?"%"+ae:"");let ye=ve[ue];if(!ye){const Se=new ii(ue);if(Se.selection.error){pt&&tt.warn("invalid selection for connection",ue);continue}ye=Q.getAtomIndices(Se),ve[ue]=ye}var ie=Mt.length,K=ye.length;if(ie>K&&([ie,K]=[K,ie],[Mt,ye]=[ye,Mt]),ie!==0&&K!==0)for(let Se=0;Se<K;++Se)be.index=Mt[Se%ie],Ue.index=ye[Se],be&&Ue?Q.bondStore.addBond(be,Ue,DO(ee.str(Ge))):tt.log("atoms for connection not found");else pt&&tt.warn("no atoms found for",_t,ue)}}}(F.categories,w,V),function(Y,Q,de){var Le;if(Y.entity){const ie=Y.entity,K=ie.getField("id"),be=ie.getField("pdbx_description"),Ue=ie.getField("type"),ve=ie.rowCount;for(let Ne=0;Ne<ve;++Ne){const $e=Array.from((Le=de[K.int(Ne)])!==null&&Le!==void 0?Le:[]);Q.entityList[Ne]=new Wb(Q,Ne,be==null?void 0:be.str(Ne),Ue.str(Ne),$e)}}}(F.categories,w,G),(Oe=(u=F.categories.struct)===null||u===void 0?void 0:u.getField("title"))&&(Me=Oe.str(0))&&(w.title=Me),(Oe=(h=F.categories.entry)===null||h===void 0?void 0:h.getField("id"))&&(Me=Oe.str(0))&&(w.id=Me),F.categories.pdbx_audit_revision_history){if(Oe=(d=F.categories.pdbx_audit_revision_history)===null||d===void 0?void 0:d.getField("revision_date")){for(let Y=0;Y<Oe.rowCount;Y++)if(Me=Oe.str(Y)){w.header.releaseDate=Me;break}}if(Oe=(f=F.categories.pdbx_database_status)===null||f===void 0?void 0:f.getField("recvd_initial_deposition_date")){for(let Y=0;Y<Oe.rowCount;Y++)if(Me=Oe.str(Y)){w.header.depositionDate=Me;break}}}else if(F.categories.database_PDB_rev){if(Oe=(p=F.categories.database_PDB_rev)===null||p===void 0?void 0:p.getField("date")){for(let Y=0;Y<Oe.rowCount;Y++)if(Me=Oe.str(Y)){w.header.releaseDate=Me;break}}if(Oe=(_=F.categories.database_PDB_rev)===null||_===void 0?void 0:_.getField("date_original")){for(let Y=0;Y<Oe.rowCount;Y++)if(Me=Oe.str(Y)){w.header.depositionDate=Me;break}}}(Oe=(g=(v=F.categories.reflns)===null||v===void 0?void 0:v.getField("d_resolution_high"))!==null&&g!==void 0?g:(b=F.categories.refine)===null||b===void 0?void 0:b.getField("ls_d_res_high"))&&Oe.valueKind(0)===0&&(w.header.resolution=Oe.float(0)),(Oe=(m=F.categories.refine)===null||m===void 0?void 0:m.getField("ls_R_factor_R_free"))&&Oe.valueKind(0)===0&&(w.header.rFree=Oe.float(0)),(Oe=(y=F.categories.refine)===null||y===void 0?void 0:y.getField("ls_R_factor_R_work"))&&Oe.valueKind(0)===0&&(w.header.rFree=Oe.float(0)),(Oe=(A=F.categories.exptl)===null||A===void 0?void 0:A.getField("method"))&&(w.header.experimentalMethods=Oe.toStringArray().slice()),M.finalize(),w.finalizeAtoms(),Ub(w),w.finalizeBonds(),ge?nH(w,ge):i2(w),Ob(w),w.extraData.cif=F}pt&&tt.timeEnd("CifParser._parse "+this.name)})}}Qt.add("bcif",class extends Qy{get type(){return"bcif"}get isBinary(){return!0}}),Qt.add("cif",Qy),Qt.add("mcif",Qy),Qt.add("mmcif",Qy);Qt.add("gro",class extends Ic{get type(){return"gro"}_parse(){pt&&tt.time("GroParser._parse "+this.name);var i,e,t=this.structure,n=this.structureBuilder,r=this.firstModelOnly,s=this.asTrajectory,o=this.cAlphaOnly,a=t.frames,l=t.boxes,c=this.streamer.peekLines(3);t.title=c[0].trim();var u,h,d,f,p=5+(c[2].length-c[2].lastIndexOf(".")-1),_=20+p,v=20+2*p,g=parseInt(c[1]),b=g+3,m=t.atomMap,y=t.atomStore;y.resize(g);var A=0,w=0,M=0;this.streamer.eachChunkOfLines(function(T){(function(E,C,N){for(var P=E;P<C;++P){var L=++M-1,R=N[P];if(R){if(L%b==0)s&&(i=new Float32Array(3*g),a.push(i),e=0);else if(L%b!=1)if(L%b==b-1){var F=R.trim().split(/\s+/),V=new Float32Array(9);if(V[0]=10*parseFloat(F[0]),V[4]=10*parseFloat(F[1]),V[8]=10*parseFloat(F[2]),l.push(V),r)return!0;w+=1}else{if(u=R.substr(10,5).trim(),o&&u!=="CA")continue;var G=10*parseFloat(R.substr(20,p)),U=10*parseFloat(R.substr(_,p)),z=10*parseFloat(R.substr(v,p));if(s){var O=3*e;if(i[O+0]=G,i[O+1]=U,i[O+2]=z,e+=1,L>b)continue}h=R.substr(5,5).trim(),d=parseInt(R.substr(0,5)),f=parseInt(R.substr(15,5)),y.growIfFull(),y.atomTypeId[A]=m.add(u),y.x[A]=G,y.y[A]=U,y.z[A]=z,y.serial[A]=f,n.addAtom(w,"","",h,d,!1,"l"),A+=1}}}})(0,T.length,T)}),n.finalize(),t.finalizeAtoms(),r2(t),Ub(t),t.finalizeBonds(),i2(t),pt&&tt.timeEnd("GroParser._parse "+this.name)}});var Dpe=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function ev(i,e,t){return e?new i(e.buffer,e.byteOffset,e.byteLength/(t||1)):void 0}function JC(i){return ev(DataView,i)}function JA(i){return ev(Int8Array,i)}function qb(i){return ev(Int32Array,i,4)}function $g(i,e){var t=i.length/2;e||(e=new Int16Array(t));for(var n=0,r=0;n<t;++n,r+=2)e[n]=i[r]<<8^i[r+1];return e}function nl(i,e){var t=i.length/4;e||(e=new Int32Array(t));for(var n=0,r=0;n<t;++n,r+=4)e[n]=i[r]<<24^i[r+1]<<16^i[r+2]<<8^i[r+3];return e}function Yb(i,e,t){var n=i.length,r=1/e;t||(t=new Float32Array(n));for(var s=0;s<n;++s)t[s]=i[s]*r;return t}function Jy(i,e){var t,n;if(!e){var r=0;for(t=0,n=i.length;t<n;t+=2)r+=i[t+1];e=new i.constructor(r)}var s=0;for(t=0,n=i.length;t<n;t+=2)for(var o=i[t],a=i[t+1],l=0;l<a;++l)e[s]=o,++s;return e}function FH(i,e){var t=i.length;e||(e=new i.constructor(t)),t&&(e[0]=i[0]);for(var n=1;n<t;++n)e[n]=i[n]+e[n-1];return e}function Kb(i,e){var t,n,r=i instanceof Int8Array?127:32767,s=-r-1,o=i.length;if(!e){var a=0;for(t=0;t<o;++t)i[t]<r&&i[t]>s&&++a;e=new Int32Array(a)}for(t=0,n=0;t<o;){for(var l=0;i[t]===r||i[t]===s;)l+=i[t],++t;l+=i[t],++t,e[n]=l,++n}return e}function NO(i,e,t){return Yb(Kb(i,qb(t)),e,t)}function Npe(i,e,t){var n=Kb(i,qb(t));return function(r,s,o){return Yb(FH(r,qb(o)),s,o)}(n,e,ev(Float32Array,n,4))}function kH(i){var e=0,t=new DataView(i.buffer);function n(l){for(var c={},u=0;u<l;u++)c[a()]=a();return c}function r(l){var c=i.subarray(e,e+l);return e+=l,c}function s(l){var c=i.subarray(e,e+l);e+=l;var u=65535;if(l>u){for(var h=[],d=0;d<c.length;d+=u)h.push(String.fromCharCode.apply(null,c.subarray(d,d+u)));return h.join("")}return String.fromCharCode.apply(null,c)}function o(l){for(var c=new Array(l),u=0;u<l;u++)c[u]=a();return c}function a(){var l,c,u=i[e];if(!(128&u))return e++,u;if((240&u)==128)return e++,n(c=15&u);if((240&u)==144)return e++,o(c=15&u);if((224&u)==160)return e++,s(c=31&u);if(!(224&~u))return l=t.getInt8(e),e++,l;switch(u){case 192:return e++,null;case 194:return e++,!1;case 195:return e++,!0;case 196:return c=t.getUint8(e+1),e+=2,r(c);case 197:return c=t.getUint16(e+1),e+=3,r(c);case 198:return c=t.getUint32(e+1),e+=5,r(c);case 202:return l=t.getFloat32(e+1),e+=5,l;case 203:return l=t.getFloat64(e+1),e+=9,l;case 204:return l=i[e+1],e+=2,l;case 205:return l=t.getUint16(e+1),e+=3,l;case 206:return l=t.getUint32(e+1),e+=5,l;case 208:return l=t.getInt8(e+1),e+=2,l;case 209:return l=t.getInt16(e+1),e+=3,l;case 210:return l=t.getInt32(e+1),e+=5,l;case 217:return c=t.getUint8(e+1),e+=2,s(c);case 218:return c=t.getUint16(e+1),e+=3,s(c);case 219:return c=t.getUint32(e+1),e+=5,s(c);case 220:return c=t.getUint16(e+1),e+=3,o(c);case 221:return c=t.getUint32(e+1),e+=5,o(c);case 222:return c=t.getUint16(e+1),e+=3,n(c);case 223:return c=t.getUint32(e+1),e+=5,n(c)}throw new Error("Unknown type 0x"+u.toString(16))}return a()}function Fpe(i,e,t,n){switch(i){case 1:return function(a,l){var c=a.length;l||(l=new Float32Array(c/4));for(var u=JC(l),h=JC(a),d=0,f=0,p=c/4;d<p;++d,f+=4)u.setFloat32(f,h.getFloat32(f),!0);return l}(e);case 2:return JA(e);case 3:return $g(e);case 4:return nl(e);case 5:return ev(Uint8Array,e);case 6:return Jy(nl(e),new Uint8Array(t));case 7:return Jy(nl(e));case 8:return function(a,l){return FH(Jy(a),l)}(nl(e));case 9:return r=nl(e),s=nl(n)[0],Yb(Jy(r,qb(o)),s,o);case 10:return Npe($g(e),nl(n)[0]);case 11:return Yb($g(e),nl(n)[0]);case 12:return NO($g(e),nl(n)[0]);case 13:return NO(JA(e),nl(n)[0]);case 14:return Kb($g(e));case 15:return Kb(JA(e))}var r,s,o}function kpe(i,e){var t=(e=e||{}).ignoreFields,n={};return Dpe.forEach(function(r){var s,o,a,l,c,u=!!t&&t.indexOf(r)!==-1,h=i[r];u||h===void 0||(h instanceof Uint8Array?n[r]=Fpe.apply(null,(o=JC(s=h),a=o.getInt32(0),l=o.getInt32(4),c=s.subarray(8,12),[a,s=s.subarray(12),l,c])):n[r]=h)}),n}const Upe={0:105,1:115,2:104,3:101,4:103,5:98,6:116,7:108,"-1":NaN};Qt.add("mmtf",class extends Ic{get type(){return"mmtf"}get isBinary(){return!0}_parse(){let i,e,t,n,r;pt&&tt.time("MmtfParser._parse "+this.name);const s=this.structure,o=kpe(kH(this.streamer.data));let a,l,c,u,h,d;if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach(function(U){o[U]!==void 0&&(s.header[U]=o[U])}),s.id=o.structureId,s.title=o.title,s.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(h=1,u=o.chainsPerModel[0],c=0,i=0,e=u;i<e;++i)c+=o.groupsPerChain[i];for(l=0,i=0,e=c;i<e;++i)r=o.groupList[o.groupTypeList[i]],l+=r.atomNameList.length;a=o.numBonds,d=[u]}else a=o.numBonds,l=o.numAtoms,c=o.numGroups,u=o.numChains,h=o.numModels,d=o.chainsPerModel;if(a+=c,this.asTrajectory)for(i=0,e=o.numModels;i<e;++i){const U=new Float32Array(3*l),z=l*i;for(t=0;t<l;++t){const O=3*t,D=t+z;U[O]=o.xCoordList[D],U[O+1]=o.yCoordList[D],U[O+2]=o.zCoordList[D]}s.frames.push(U)}const f=new Uint32Array(a),p=new Uint32Array(a),_=new Uint8Array(a),v=new Uint32Array(l),g=new Int8Array(l),b=new Uint32Array(c),m=new Uint32Array(c),y=new Uint32Array(c),A=new Uint16Array(u),w=new Uint32Array(u),M=new Uint32Array(u),T=new Uint32Array(h),E=new Uint32Array(h);let C=0;for(i=0,e=h;i<e;++i){const U=d[i];for(T[i]=C,E[i]=U,t=0;t<U;++t)A[t+C]=i;C+=U}const N=o.groupsPerChain;let P=0;for(i=0,e=u;i<e;++i){const U=N[i];for(w[i]=P,M[i]=U,t=0;t<U;++t)b[t+P]=i;P+=U}let L=0,R=0;for(i=0,e=c;i<e;++i){r=o.groupList[o.groupTypeList[i]];const U=r.atomNameList.length,z=r.formalChargeList,O=r.bondAtomList,D=r.bondOrderList;for(t=0,n=D.length;t<n;++t)f[R]=L+O[2*t],p[R]=L+O[2*t+1],_[R]=D[t],R+=1;for(m[i]=L,y[i]=U,t=0;t<U;++t)v[L]=i,g[L]=z[t],L+=1}const F=o.bondAtomList;if(F)for(o.bondOrderList&&_.set(o.bondOrderList,R),i=0,e=F.length;i<e;i+=2){const U=F[i],z=F[i+1];U<l&&z<l&&(f[R]=U,p[R]=z,R+=1)}s.bondStore.length=_.length,s.bondStore.count=R,s.bondStore.atomIndex1=f,s.bondStore.atomIndex2=p,s.bondStore.bondOrder=_,s.atomStore.length=l,s.atomStore.count=l,s.atomStore.residueIndex=v,s.atomStore.atomTypeId=new Uint16Array(l),s.atomStore.x=o.xCoordList.subarray(0,l),s.atomStore.y=o.yCoordList.subarray(0,l),s.atomStore.z=o.zCoordList.subarray(0,l),s.atomStore.serial=o.atomIdList.subarray(0,l),s.atomStore.bfactor=o.bFactorList.subarray(0,l),s.atomStore.altloc=o.altLocList.subarray(0,l),s.atomStore.occupancy=o.occupancyList.subarray(0,l),s.atomStore.formalCharge=g,s.residueStore.length=c,s.residueStore.count=c,s.residueStore.chainIndex=b,s.residueStore.residueTypeId=o.groupTypeList,s.residueStore.atomOffset=m,s.residueStore.atomCount=y,s.residueStore.resno=o.groupIdList.subarray(0,c),s.residueStore.sstruc=o.secStructList.subarray(0,c),s.residueStore.inscode=o.insCodeList.subarray(0,c),s.chainStore.length=u,s.chainStore.count=u,s.chainStore.entityIndex=new Uint16Array(u),s.chainStore.modelIndex=A,s.chainStore.residueOffset=w,s.chainStore.residueCount=M,s.chainStore.chainname=o.chainNameList.subarray(0,4*u),s.chainStore.chainid=o.chainIdList.subarray(0,4*u),s.modelStore.length=h,s.modelStore.count=h,s.modelStore.chainOffset=T,s.modelStore.chainCount=E;let V={};for(i=0,e=o.groupList.length;i<e;++i){const U=o.groupList[i],z=[];for(t=0,n=U.atomNameList.length;t<n;++t){const te=U.elementList[t].toUpperCase(),ne=U.atomNameList[t];z.push(s.atomMap.add(ne,te))}const O=U.chemCompType.toUpperCase(),D=iue.includes(O),B=U.bondOrderList.length,W=new Array(B),q=new Array(B);for(t=0;t<B;++t)W[t]=U.bondAtomList[2*t],q[t]=U.bondAtomList[2*t+1];const j={atomIndices1:W,atomIndices2:q,bondOrders:U.bondOrderList};V[i]=s.residueMap.add(U.groupName,z,D,O,j)}for(i=0,e=c;i<e;++i)s.residueStore.residueTypeId[i]=V[s.residueStore.residueTypeId[i]];for(i=0,e=s.atomStore.count;i<e;++i){const U=s.atomStore.residueIndex[i],z=s.residueMap.list[s.residueStore.residueTypeId[U]],O=s.residueStore.atomOffset[U];s.atomStore.atomTypeId[i]=z.atomTypeIdList[i-O]}if(o.secStructList){const U=o.secStructList.length;for(i=0,e=s.residueStore.count;i<e;++i){const z=Upe[s.residueStore.sstruc[i%U]];z!==void 0&&(s.residueStore.sstruc[i]=z)}}if(o.entityList&&o.entityList.forEach(function(U,z){s.entityList[z]=new Wb(s,z,U.description,U.type,U.chainIndexList)}),o.bioAssemblyList&&o.bioAssemblyList.forEach(function(U,z){const O=z+1,D=new Wu(""+O);s.biomolDict["BU"+O]=D;let B={};U.transformList.forEach(function(W){const q=new Ct().fromArray(W.matrix).transpose(),j=W.chainIndexList.map(function(ne){let Z="";for(let le=0;le<4;++le){const re=o.chainNameList[4*ne+le];if(!re)break;Z+=String.fromCharCode(re)}return Z}),te=B[j.toString()];te?te.matrixList.push(q):B[j.toString()]=D.addPart([q],j)})}),o.ncsOperatorList){const U="NCS",z=new Wu(U),O=z.addPart();o.ncsOperatorList.forEach(function(D){const B=new Ct().fromArray(D).transpose();O.matrixList.push(B)}),O.matrixList.length>0&&(s.biomolDict[U]=z)}const G=o.unitCell;G&&Array.isArray(G)&&G[0]?s.unitcell=new jb({a:G[0],b:G[1],c:G[2],alpha:G[3],beta:G[4],gamma:G[5],spacegroup:o.spaceGroup}):s.unitcell=void 0,Bm(s,!0),Om(s,!0),s.finalizeAtoms(),s.finalizeBonds(),Ob(s),pt&&tt.timeEnd("MmtfParser._parse "+this.name)}});const eE=/\s+/,Ope={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};Qt.add("mol2",class extends Ic{get type(){return"mol2"}_parse(){pt&&tt.time("Mol2Parser._parse "+this.name);const i=this.structure,e=this.structureBuilder,t=this.firstModelOnly,n=this.asTrajectory,r=i.frames;let s,o,a=!1;const l=i.atomMap,c=i.atomStore;c.resize(Math.round(this.streamer.data.length/60)),c.addField("partialCharge",1,"float32");let u=0,h=0,d=0,f=-1,p=0,_=0;const v=i.getAtomProxy(),g=i.getAtomProxy();this.streamer.eachChunkOfLines(function(b){(function(m,y,A){for(let w=m;w<y;++w){const M=A[w].trim();if(M!==""&&M[0]!=="#"){if(M[0]==="@")M==="@<TRIPOS>MOLECULE"?(_=1,h=0,++f):M==="@<TRIPOS>ATOM"?(_=2,d=c.count,n&&(o=0,s=new Float32Array(3*p),r.push(s),f>0&&(a=!0))):_=M==="@<TRIPOS>BOND"?3:0;else if(_===1){if(h===0)i.title=M,i.id=M;else if(h===1){const T=M.split(eE);p=parseInt(T[0])}++h}else if(_===2){const T=M.split(eE);if(t&&f>0)continue;const E=parseFloat(T[2]),C=parseFloat(T[3]),N=parseFloat(T[4]);if(n){const U=3*o;if(s[U+0]=E,s[U+1]=C,s[U+2]=N,o+=1,a)continue}const P=T[0],L=T[1],R=T[5].split(".")[0],F=T[6]?parseInt(T[6]):1,V=T[7]?T[7]:"",G=T[8]?parseFloat(T[8]):0;c.growIfFull(),c.atomTypeId[u]=l.add(L,R),c.x[u]=E,c.y[u]=C,c.z[u]=N,c.serial[u]=+P,c.partialCharge[u]=G,e.addAtom(f,"","",V,F,!0),u+=1}else if(_===3){if(t&&f>0||n&&f>0)continue;const T=M.split(eE);v.index=parseInt(T[1])-1+d,g.index=parseInt(T[2])-1+d;const E=Ope[T[3]];i.bondStore.addBond(v,g,E)}}}})(0,b.length,b)}),e.finalize(),i.finalizeAtoms(),r2(i),Om(i,!0),Bm(i,!0),i.finalizeBonds(),Nd(i),i2(i),pt&&tt.timeEnd("Mol2Parser._parse "+this.name)}});Qt.add("pdbqt",class extends N0{get type(){return"pdbqt"}});Qt.add("pqr",class extends N0{get type(){return"pqr"}});const Bpe=/> +<(.+)>/;class tE extends Ic{get type(){return"sdf"}_parse(){pt&&tt.time("SdfParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=this.firstModelOnly,r=this.asTrajectory,s=this.streamer.peekLines(2);e.id=s[0].trim(),e.title=s[1].trim();const o=e.frames;let a,l,c=!1;const u=e.atomMap,h=e.atomStore;h.resize(Math.round(this.streamer.data.length/50)),h.addField("formalCharge",1,"int8");const d=e.getAtomProxy(),f=e.getAtomProxy();let p=0,_=0,v=0,g=0;const b=[];let m,y,A,w,M,T,E,C,N,P,L,R,F,V,G=!1,U={};e.extraData.sdf=b;let z=!1,O=!1,D=!1,B=[],W=[];const q=new Map;this.streamer.eachChunkOfLines(function(j){(function(te,ne,Z){for(let le=te;le<ne;++le){const re=Z[le];if(z&&re&&(B=re.substring(7).split(" "),W.length&&(B=[...W,...B],W=[]),B[B.length-1]==="-"))B.pop(),W=B;else{if(re.substr(0,4)==="$$$$")_=-1,++v,g=h.count,b.push(U),U={},G=!1,z=!1;else if(_===3)z=re.indexOf(" V3000")>-1,z?q.clear():(y=parseInt(re.substr(0,3)),A=parseInt(re.substr(3,3)),w=4,M=w+y,T=M,E=T+A,r&&(l=0,a=new Float32Array(3*y),o.push(a),v>0&&(c=!0)));else if(z&&B[0]==="COUNTS")y=parseInt(B[1]),r&&(l=0,a=new Float32Array(3*y),o.push(a),v>0&&(c=!0));else if(z&&B.length==2)B[1]==="ATOM"?B[0]==="BEGIN"?O=!0:B[0]==="END"&&(O=!1):B[1]==="BOND"&&(B[0]==="BEGIN"?D=!0:B[0]==="END"&&(D=!1));else if(O||!z&&_>=w&&_<M){if(n&&v>0)continue;let se=0;if(z){if(C=parseFloat(B[2]),N=parseFloat(B[3]),P=parseFloat(B[4]),R=B[1],F=parseInt(B[0]),q.set(F,p),L=R+F,B.length>6){let $=B.slice(6).find(fe=>fe.indexOf("CHG=")===0);$&&(se=parseInt($.substring(4)))}}else C=parseFloat(re.substr(0,10)),N=parseFloat(re.substr(10,10)),P=parseFloat(re.substr(20,10)),R=re.substr(31,3).trim(),L=R+(p-g+1);if(r){const $=3*l;if(a[$+0]=C,a[$+1]=N,a[$+2]=P,l+=1,c)continue}h.growIfFull(),h.atomTypeId[p]=u.add(L,R),h.x[p]=C,h.y[p]=N,h.z[p]=P,h.serial[p]=z?F:p,h.formalCharge[p]=se,t.addAtom(v,"","","HET",1,!0),p+=1}else if(D||!z&&_>=T&&_<E){if(n&&v>0||r&&v>0)continue;z?(d.index=q.get(parseInt(B[2])),f.index=q.get(parseInt(B[3])),V=parseInt(B[1])):(d.index=parseInt(re.substr(0,3))-1+g,f.index=parseInt(re.substr(3,3))-1+g,V=parseInt(re.substr(6,3))),e.bondStore.addBond(d,f,V)}else if(re.substr(0,6)==="M  CHG"){const se=parseInt(re.substr(6,3));for(let $=0,fe=10;$<se;++$,fe+=8){const xe=parseInt(re.substr(fe,3))-1+g,Ie=parseInt(re.substr(fe+4,3));h.formalCharge[xe]=Ie}}else re.charAt(0)===">"&&(m=re.match(Bpe))?(G=m[1],U[G]=[]):G!==!1&&re&&U[G].push(re);++_}}})(0,j.length,j)}),t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),Nd(e),pt&&tt.timeEnd("SdfParser._parse "+this.name)}_postProcess(){Nd(this.structure)}}Qt.add("sdf",tE),Qt.add("sd",tE),Qt.add("mol",tE);function Wg(i,e,t){return parseInt(i.substr(e,t).trim())}class FO extends Ic{get type(){return"prmtop"}_parse(){pt&&tt.time("PrmtopParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,r=e.atomStore;r.addField("partialCharge",1,"float32"),r.addField("radius",1,"float32");const s=[],o={},a=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];let l,c,u,h,d;a.forEach(M=>{o[M]=0});let f,p,_,v,g,b=new Uint8Array(0);this.streamer.eachChunkOfLines(function(M){(function(T,E,C){for(let N=T;N<E;++N){const P=C[N],L=P.trim();if(L&&!P.startsWith("%FORMAT")){if(P.startsWith("%FLAG")){const R=P.substr(5).trim();v=0,R==="TITLE"?_=0:R==="POINTERS"?_=1:R==="ATOM_NAME"?_=2:R==="CHARGE"?_=3:R==="MASS"?_=4:R==="RESIDUE_LABEL"?_=5:R==="RESIDUE_POINTER"?_=6:R==="BONDS_INC_HYDROGEN"?(g=0,_=7):R==="BONDS_WITHOUT_HYDROGEN"?(g=o.NBONH,_=8):_=R==="RADII"?9:void 0}else if(_===0)s.push(L);else if(_===1){const R=Math.min(v+10,32);for(let V=0;v<R;++V,++v)o[a[v]]=parseInt(P.substr(8*V,8).trim());l=new Array(o.NATOM),c=new Float32Array(o.NATOM),u=new Float32Array(o.NATOM),r.resize(o.NATOM);const F=o.NBONH+o.MBONA;h=new Uint32Array(F),d=new Uint32Array(F),b=new Uint8Array(F),f=new Array(o.NRES),p=new Uint32Array(o.NRES)}else if(_===2){const R=Math.min(v+20,o.NATOM);for(let F=0;v<R;++F,++v)l[v]=P.substr(4*F,4).trim()}else if(_===3){const R=Math.min(v+5,o.NATOM);for(let F=0;v<R;++F,++v)c[v]=parseFloat(P.substr(16*F,16))/18.2223}else if(_!==4){if(_===5){const R=Math.min(v+20,o.NRES);for(let F=0;v<R;++F,++v)f[v]=P.substr(4*F,4).trim()}else if(_===6){const R=Math.min(v+10,o.NRES);for(let F=0;v<R;++F,++v)p[v]=Wg(P,8*F,8)}else if(_===7){const R=Math.min(v+10,3*o.NBONH);for(let F=0;v<R;++F,++v){const V=v%3;V===0&&(h[g]=Wg(P,8*F,8)/3),V===1&&(d[g]=Wg(P,8*F,8)/3,b[g]=1,++g)}}else if(_===8){const R=Math.min(v+10,3*o.MBONA);for(let F=0;v<R;++F,++v){const V=v%3;V===0&&(h[g]=Wg(P,8*F,8)/3),V===1&&(d[g]=Wg(P,8*F,8)/3,b[g]=1,++g)}}else if(_===9){const R=Math.min(v+5,o.NATOM);for(let F=0;v<R;++F,++v)u[v]=parseFloat(P.substr(16*F,16))}}}}})(0,M.length,M)}),e.title=s.join(" ");const m=o.NATOM;let y=0,A=f[0],w=1;for(let M=0;M<m;++M)M+1===p[y+1]&&(++y,A=f[y],w=y+1),r.atomTypeId[M]=n.add(l[M]),r.serial[M]=M+1,t.addAtom(0,"","",A,w,!1);r.partialCharge.set(c),r.radius.set(u),e.bondStore.length=b.length,e.bondStore.count=b.length,e.bondStore.atomIndex1=h,e.bondStore.atomIndex2=d,e.bondStore.bondOrder=b,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),Om(e,!0),Bm(e,!0,!0),r2(e,!0),Nd(e),pt&&tt.timeEnd("PrmtopParser._parse "+this.name)}}Qt.add("prmtop",FO),Qt.add("parm7",FO);const ex=/\s+/,zpe=/(^\*|REMARK)*/;Qt.add("psf",class extends Ic{get type(){return"psf"}_parse(){pt&&tt.time("PsfParser._parse "+this.name);const i=this.structure,e=this.structureBuilder,t=i.atomMap,n=i.atomStore;n.addField("partialCharge",1,"float32");const r=[];let s,o,a,l,c,u,h=0,d=0,f=0;this.streamer.eachChunkOfLines(function(p){(function(_,v,g){for(let b=_;b<v;++b){const m=g[b].trim();if(m){if(s===2){const y=m.split(ex),A=parseInt(y[0]),w=y[1],M=parseInt(y[2]),T=y[3],E=y[4],C=parseFloat(y[6]);w!==a&&(o=M1(d),++d),n.growIfFull(),n.atomTypeId[h]=t.add(E),n.serial[h]=A,n.partialCharge[h]=C,e.addAtom(0,o,o,T,M,!1),h+=1,a=w}else if(s===3){const y=m.split(ex);for(let A=0,w=y.length;A<w;A+=2)l[f]=parseInt(y[A])-1,c[f]=parseInt(y[A+1])-1,u[f]=1,f+=1}else if(s===1)r.push(m.replace(zpe,"").trim());else if(s!==4){if(s!==5){if(s!==6)if(m.includes("!NATOM")){s=2;const y=parseInt(m.split(ex)[0]);n.resize(y)}else if(m.includes("!NBOND")){s=3;const y=parseInt(m.split(ex)[0]);l=new Uint32Array(y),c=new Uint32Array(y),u=new Uint8Array(y)}else m.includes("!NTITLE")?s=1:m.includes("!NTHETA")?s=4:m.includes("!NPHI")?s=5:m.includes("!NIMPHI")&&(s=6)}}}else s=void 0}})(0,p.length,p)}),i.title=r.join(" "),i.bondStore.length=u.length,i.bondStore.count=f,i.bondStore.atomIndex1=l,i.bondStore.atomIndex2=c,i.bondStore.bondOrder=u,e.finalize(),i.finalizeAtoms(),i.finalizeBonds(),Om(i,!0),Bm(i,!0,!0),Nd(i),pt&&tt.timeEnd("PsfParser._parse "+this.name)}});const Gpe=/\[ (.+) \]/,tx=/\s+/;Qt.add("top",class extends Ic{get type(){return"top"}_parse(){pt&&tt.time("TopParser._parse "+this.name);const i=this.structure,e=this.structureBuilder,t=i.atomMap,n=i.bondStore,r=i.atomStore;r.addField("partialCharge",1,"float32");const s=[],o={};let a,l;this.streamer.eachChunkOfLines(function(b){(function(m,y,A){for(let w=m;w<y;++w){const M=A[w];let T=M.trim();if(!T||T[0]==="*"||T[0]===";")continue;if(T.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");const E=M.match(Gpe);if(E!==null){const N=E[1];N==="moleculetype"?(l=2,a={atoms:[],bonds:[]}):l=N==="atoms"?3:N==="bonds"?4:N==="system"?0:N==="molecules"?1:void 0;continue}const C=T.indexOf(";");if(C!==-1&&(T=T.substring(0,C).trim()),l===2){const N=T.split(tx)[0];o[N]=a}else if(l===3){const N=T.split(tx);a.atoms.push([parseInt(N[2]),N[3],N[4],parseFloat(N[6])])}else if(l===4){const N=T.split(tx);a.bonds.push([parseInt(N[0]),parseInt(N[1])])}else if(l===0)i.title=T;else if(l===1){const N=T.split(tx);s.push([N[0],parseInt(N[1])])}}})(0,b.length,b)});let c=0,u=0;s.forEach(function(b){const[m,y]=b,A=o[m];c+=y*A.atoms.length,u+=y*A.bonds.length}),r.resize(c),n.resize(u);let h,d=0,f=0,p=0,_=0,v=0,g=0;s.forEach(function(b){const[m,y]=b,A=o[m],w=M1(_);for(let M=0;M<y;++M){h=-1;const T=Fb.includes(m)?w:M1(p);A.atoms.forEach(function(E){const[C,N,P,L]=E;C!==h&&++f,r.atomTypeId[d]=t.add(P),r.serial[d]=d+1,r.partialCharge[d]=L,e.addAtom(0,w,T,N,f+1,!1),++d,h=C}),A.bonds.forEach(function(E){n.atomIndex1[v]=g+E[0]-1,n.atomIndex2[v]=g+E[1]-1,++v}),++p,g+=A.atoms.length}++_}),n.count=u,e.finalize(),i.finalizeAtoms(),i.finalizeBonds(),Om(i,!0),Bm(i,!0,!0),Nd(i),pt&&tt.timeEnd("TopParser._parse "+this.name)}});class c2 extends Xa{constructor(e,t){super(e,t),this.frames=new lH(this.name,this.path)}get type(){return"trajectory"}get __objName(){return"frames"}}function Mo(i,e){if(i)throw new TypeError("Not a valid NetCDF v3.x file: "+e)}function UH(i){i.offset%4!=0&&i.skip(4-i.offset%4)}function eP(i){const e=i.readUint32(),t=i.readChars(e);return UH(i),t}Qt.add("dcd",class extends c2{get type(){return"dcd"}get isBinary(){return!0}_parse(){pt&&tt.time("DcdParser._parse "+this.name);const i=Fm(this.streamer.data),e=new DataView(i),t=this.frames,n=t.coordinates,r=t.boxes,s={};let o=0;const a=new Int32Array(i,0,23),l=a[0]!==e.getInt32(0);if(a[0]!==84){const v=i.byteLength;for(let g=0;g<v;g+=4)e.setFloat32(g,e.getFloat32(g),!0)}a[0]!==84&&tt.error("dcd bad format, header block start"),String.fromCharCode(e.getUint8(4),e.getUint8(5),e.getUint8(6),e.getUint8(7))!=="CORD"&&tt.error("dcd bad format, format string");let c=!1,u=!1,h=!1;a[22]!==0&&(c=!0,a[12]!==0&&(u=!0),a[13]===1&&(h=!0)),s.NSET=a[2],s.ISTART=a[3],s.NSAVC=a[4],s.NAMNF=a[10],s.DELTA=c?e.getFloat32(44,l):e.getFloat64(44,l),a[22]!==84&&tt.error("dcd bad format, header block end"),o=o+84+8;const d=e.getInt32(o,l),f=o+1;if((d-4)%80!=0&&tt.error("dcd bad format, title block start"),s.TITLE=v1(new Uint8Array(i,f,d)),e.getInt32(f+d+4-1,l)!==d&&tt.error("dcd bad format, title block end"),o=o+d+8,e.getInt32(o,l)!==4&&tt.error("dcd bad format, natom block start"),s.NATOM=e.getInt32(o+4,l),e.getInt32(o+8,l)!==4&&tt.error("dcd bad format, natom block end"),o=o+4+8,s.NAMNF>0)return void tt.error("dcd format with fixed atoms unsupported, aborting");const p=s.NATOM,_=4*p;for(let v=0,g=s.NSET;v<g;++v){if(u){o+=4;const m=new Float32Array(9);m[0]=e.getFloat64(o,l),m[4]=e.getFloat64(o+16,l),m[8]=e.getFloat64(o+40,l),r.push(m),o+=48,o+=4}const b=new Float32Array(3*p);for(let m=0;m<3;++m){e.getInt32(o,l)!==_&&tt.error("dcd bad format, coord block start",v,m),o+=4;const y=new Float32Array(i,o,p);for(let A=0;A<p;++A)b[3*A+m]=y[A];o+=_,e.getInt32(o,l)!==_&&tt.error("dcd bad format, coord block end",v,m),o+=4}n.push(b),h&&(o+=4+e.getInt32(o,l)+4)}s.DELTA&&(t.deltaTime=20.45482949774598*s.DELTA),s.ISTART>=1&&(t.timeOffset=(s.ISTART-1)*t.deltaTime),pt&&tt.timeEnd("DcdParser._parse "+this.name)}});const xi={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function OH(i){switch(Number(i)){case xi.BYTE:return"byte";case xi.CHAR:return"char";case xi.SHORT:return"short";case xi.INT:return"int";case xi.FLOAT:return"float";case xi.DOUBLE:return"double";default:return"undefined"}}function kO(i){switch(Number(i)){case xi.BYTE:case xi.CHAR:return 1;case xi.SHORT:return 2;case xi.INT:case xi.FLOAT:return 4;case xi.DOUBLE:return 8;default:return-1}}function UO(i){switch(String(i)){case"byte":return xi.BYTE;case"char":return xi.CHAR;case"short":return xi.SHORT;case"int":return xi.INT;case"float":return xi.FLOAT;case"double":return xi.DOUBLE;default:return-1}}function nx(i,e){if(i!==1){const t=new Array(i);for(let n=0;n<i;n++)t[n]=e();return t}return e()}function tP(i,e,t){switch(e){case xi.BYTE:return i.readBytes(t);case xi.CHAR:return function(n){return n.charCodeAt(n.length-1)===0?n.substring(0,n.length-1):n}(i.readChars(t));case xi.SHORT:return nx(t,i.readInt16.bind(i));case xi.INT:return nx(t,i.readInt32.bind(i));case xi.FLOAT:return nx(t,i.readFloat32.bind(i));case xi.DOUBLE:return nx(t,i.readFloat64.bind(i));default:return void Mo(!0,"non valid type "+e)}}const Rp=0,Vpe=10,Hpe=11,$pe=12;function Wpe(i,e){const t={recordDimension:{length:i.readUint32()}};t.version=e;const n=function(s){let o,a,l;const c=s.readUint32();if(c===Rp)return Mo(s.readUint32()!==Rp,"wrong empty tag for list of dimensions"),[];{Mo(c!==Vpe,"wrong tag for list of dimensions");const u=s.readUint32();o=new Array(u);for(let h=0;h<u;h++){const d=eP(s),f=s.readUint32();f===0&&(a=h,l=d),o[h]={name:d,size:f}}return{dimensions:o,recordId:a,recordName:l}}}(i);t.recordDimension.id=n.recordId,t.recordDimension.name=n.recordName,t.dimensions=n.dimensions,t.globalAttributes=OO(i);const r=function(s,o,a){const l=s.readUint32();let c,u=0;if(l===Rp)return Mo(s.readUint32()!==Rp,"wrong empty tag for list of variables"),[];{Mo(l!==Hpe,"wrong tag for list of variables");const h=s.readUint32();c=new Array(h);for(let d=0;d<h;d++){const f=eP(s),p=s.readUint32(),_=new Array(p);for(let y=0;y<p;y++)_[y]=s.readUint32();const v=OO(s),g=s.readUint32();Mo(g<1&&g>6,"non valid type "+g);const b=s.readUint32();let m=s.readUint32();a===2&&(Mo(m>0,"offsets larger than 4GB not supported"),m=s.readUint32()),_[0]===o&&(u+=b),c[d]={name:f,dimensions:_,attributes:v,type:OH(g),size:b,offset:m,record:_[0]===o}}}return{variables:c,recordStep:u}}(i,n.recordId,e);return t.variables=r.variables,t.recordDimension.recordStep=r.recordStep,t}function OO(i){let e;const t=i.readUint32();if(t===Rp)return Mo(i.readUint32()!==Rp,"wrong empty tag for list of attributes"),[];{Mo(t!==$pe,"wrong tag for list of attributes");const n=i.readUint32();e=new Array(n);for(let r=0;r<n;r++){const s=eP(i),o=i.readUint32();Mo(o<1||o>6,"non valid type "+o);const a=i.readUint32(),l=tP(i,o,a);UH(i),e[r]={name:s,type:OH(o),value:l}}}return e}class BH{constructor(e){const t=new Cce(e);t.setBigEndian(),Mo(t.readChars(3)!=="CDF","should start with CDF");const n=t.readByte();Mo(n>2,"unknown version"),this.header=Wpe(t,n),this.buffer=t}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return this.header.variables.findIndex(function(t){return t.name===e})!==-1}getDataVariable(e){let t;return t=typeof e=="string"?this.header.variables.find(function(n){return n.name===e}):e,Mo(t===void 0,"variable not found"),this.buffer.seek(t.offset),t.record?function(n,r,s){const o=UO(r.type),a=r.size?r.size/kO(o):1,l=s.length,c=new Array(l),u=s.recordStep;for(let h=0;h<l;h++){const d=n.offset;c[h]=tP(n,o,a),n.seek(d+u)}return c}(this.buffer,t,this.header.recordDimension):function(n,r){const s=UO(r.type),o=r.size/kO(s),a=new Array(o);for(let l=0;l<o;l++)a[l]=tP(n,s,1);return a}(this.buffer,t)}}class nE extends c2{get type(){return"nctraj"}get isBinary(){return!0}_parse(){pt&&tt.time("NctrajParser._parse "+this.name);const e=new BH(this.streamer.data),t=this.frames,n=t.coordinates,r=t.boxes,s=t.times;e.getDataVariable("coordinates").forEach(function(o){n.push(new Float32Array(o))}),e.hasDataVariable("cell_lengths")&&e.getDataVariable("cell_lengths").forEach(function(o){r.push(new Float32Array(o))}),e.hasDataVariable("time")&&e.getDataVariable("time").forEach(function(o){s.push(o)}),s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),pt&&tt.timeEnd("NctrajParser._parse "+this.name)}}Qt.add("nctraj",nE),Qt.add("ncdf",nE),Qt.add("nc",nE);Qt.add("trr",class extends c2{get type(){return"trr"}get isBinary(){return!0}_parse(){pt&&tt.time("TrrParser._parse "+this.name);const i=Fm(this.streamer.data),e=new DataView(i),t=this.frames,n=t.coordinates,r=t.boxes,s=t.times;let o=0;for(;;){o+=8;const a=e.getInt32(o);o+=4,o+=a;const l=e.getInt32(o+8),c=e.getInt32(o+12),u=e.getInt32(o+16),h=e.getInt32(o+28),d=e.getInt32(o+32),f=e.getInt32(o+36),p=e.getInt32(o+40);o+=52;const _=l/9,v=3*p;if(_===8?s.push(e.getFloat64(o)):s.push(e.getFloat32(o)),o+=2*_,l){const g=new Float32Array(9);if(_===8)for(let b=0;b<9;++b)g[b]=10*e.getFloat64(o),o+=8;else for(let b=0;b<9;++b)g[b]=10*e.getFloat32(o),o+=4;r.push(g)}if(o+=c,o+=u,h){let g;if(_===8){g=new Float32Array(v);for(let b=0;b<v;++b)g[b]=10*e.getFloat64(o),o+=8}else{const b=new Uint32Array(i,o,v);for(let m=0;m<v;++m){const y=b[m];b[m]=(255&y)<<24|(65280&y)<<8|y>>8&65280|y>>24&255}g=new Float32Array(i,o,v);for(let m=0;m<v;++m)g[m]*=10,o+=4}n.push(g)}if(o+=d,o+=f,o>=i.byteLength)break}s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),pt&&tt.timeEnd("TrrParser._parse "+this.name)}});const np=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]);function iE(i){let e=1,t=0;for(;i>=e&&t<32;)t++,e<<=1;return t}const jg=new Uint8Array(32);function jpe(i,e){let t=1,n=0;jg[0]=1;for(let s=0;s<i;s++){let o,a=0;for(o=0;o<t;o++)a+=jg[o]*e[s],jg[o]=255&a,a>>=8;for(;a!==0;)jg[o++]=255&a,a>>=8;t=o}let r=1;for(t--;jg[t]>=r;)n++,r*=2;return n+8*t}function Xh(i,e,t,n){const r=(1<<t)-1;let s=n[1],o=n[2],a=i[0],l=0;for(;t>=8;)o=o<<8|e[a++],l|=o>>s<<t-8,t-=8;return t>0&&(s<t&&(s+=8,o=o<<8|e[a++]),s-=t,l|=o>>s&(1<<t)-1),l&=r,i[0]=a,i[1]=s,i[2]=o,l}const xa=new Int32Array(32);function BO(i,e,t,n,r,s,o){let a=0;for(xa[1]=0,xa[2]=0,xa[3]=0;n>8;)xa[a++]=Xh(i,e,8,o),n-=8;n>0&&(xa[a++]=Xh(i,e,n,o));for(let l=t-1;l>0;l--){let c=0;for(let u=a-1;u>=0;u--){c=c<<8|xa[u];const h=c/r[l]|0;xa[u]=h,c-=h*r[l]}s[l]=c}s[0]=xa[0]|xa[1]<<8|xa[2]<<16|xa[3]<<24}Qt.add("xtc",class extends c2{get type(){return"xtc"}get isBinary(){return!0}_parse(){pt&&tt.time("XtcParser._parse "+this.name);const i=Fm(this.streamer.data),e=new DataView(i),t=this.frames,n=t.coordinates,r=t.boxes,s=t.times,o=new Int32Array(6),a=new Int32Array(3),l=new Int32Array(3),c=new Uint32Array(3),u=new Float32Array(3),h=new Float32Array(3);let d=0;const f=new Int32Array(3),p=new Uint32Array(f.buffer);for(;;){let _;const v=e.getInt32(d+4);d+=12;const g=3*v;s.push(e.getFloat32(d)),d+=4;const b=new Float32Array(9);for(let m=0;m<9;++m)b[m]=10*e.getFloat32(d),d+=4;if(r.push(b),v<=9){_=new Float32Array(v);for(let m=0;m<v;++m)_[m]=e.getFloat32(d),d+=4}else{f[0]=f[1]=f[2]=0,a[0]=a[1]=a[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,h[0]=h[1]=h[2]=0,_=new Float32Array(g);let m=0;const y=e.getInt32(d);d+=4;const A=e.getFloat32(d);let w;d+=4,o[0]=e.getInt32(d),o[1]=e.getInt32(d+4),o[2]=e.getInt32(d+8),o[3]=e.getInt32(d+12),o[4]=e.getInt32(d+16),o[5]=e.getInt32(d+20),a[0]=o[3]-o[0]+1,a[1]=o[4]-o[1]+1,a[2]=o[5]-o[2]+1,d+=24,(a[0]|a[1]|a[2])>16777215?(l[0]=iE(a[0]),l[1]=iE(a[1]),l[2]=iE(a[2]),w=0):w=jpe(3,a);let M=e.getInt32(d);d+=4;let T=M-1;T=9>T?9:T;let E=np[T]/2|0,C=np[M]/2|0;c[0]=c[1]=c[2]=np[M];let N=4*Math.ceil(e.getInt32(d)/4);d+=4;const P=1/A;let L=0,R=0;const F=new Uint8Array(i,d);for(u[0]=u[1]=u[2]=0;R<y;){w===0?(u[0]=Xh(f,F,l[0],p),u[1]=Xh(f,F,l[1],p),u[2]=Xh(f,F,l[2],p)):BO(f,F,3,w,a,u,p),R++,u[0]+=o[0],u[1]+=o[1],u[2]+=o[2],h[0]=u[0],h[1]=u[1],h[2]=u[2];let V=0;if(Xh(f,F,1,p)===1&&(L=Xh(f,F,5,p),V=L%3,L-=V,V--),L>0){u[0]=u[1]=u[2]=0;for(let G=0;G<L;G+=3){if(BO(f,F,3,M,c,u,p),R++,u[0]+=h[0]-C,u[1]+=h[1]-C,u[2]+=h[2]-C,G===0){let U=u[0];u[0]=h[0],h[0]=U,U=u[1],u[1]=h[1],h[1]=U,U=u[2],u[2]=h[2],h[2]=U,_[m++]=h[0]*P,_[m++]=h[1]*P,_[m++]=h[2]*P}else h[0]=u[0],h[1]=u[1],h[2]=u[2];_[m++]=u[0]*P,_[m++]=u[1]*P,_[m++]=u[2]*P}}else _[m++]=u[0]*P,_[m++]=u[1]*P,_[m++]=u[2]*P;if(M+=V,V<0?(C=E,E=M>9?np[M-1]/2|0:0):V>0&&(E=C,C=np[M]/2|0),c[0]=c[1]=c[2]=np[M],c[0]===0||c[1]===0||c[2]===0)return void console.error("(xdrfile error) Undefined error.")}d+=N}for(let m=0;m<g;m++)_[m]*=10;if(n.push(_),d>=i.byteLength)break}s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),pt&&tt.timeEnd("XtcParser._parse "+this.name)}});class tv extends Xa{constructor(e,t){const n=t||{};super(e,n),this.volume=new js(this.name,this.path),this.voxelSize=he(n.voxelSize,1)}get type(){return"volume"}get __objName(){return"volume"}_afterParse(){this.volume.setMatrix(this.getMatrix()),super._afterParse()}getMatrix(){return new Ct}}const Xpe=/\s+/,qpe=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,ix=.529177210859;class zO extends tv{get type(){return"cube"}_parse(){pt&&tt.time("CubeParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(6),n={},r=ix*this.voxelSize;function s(u,h){var d=t[u].trim().split(Xpe)[h];return parseFloat(d)}n.atomCount=Math.abs(s(2,0)),n.originX=s(2,1)*ix,n.originY=s(2,2)*ix,n.originZ=s(2,3)*ix,n.NVX=s(3,0),n.NVY=s(4,0),n.NVZ=s(5,0),n.basisX=new me(s(3,1),s(3,2),s(3,3)).multiplyScalar(r),n.basisY=new me(s(4,1),s(4,2),s(4,3)).multiplyScalar(r),n.basisZ=new me(s(5,1),s(5,2),s(5,3)).multiplyScalar(r);const o=new Float32Array(n.NVX*n.NVY*n.NVZ);let a=0,l=0;const c=s(2,0)>0?0:1;this.streamer.eachChunkOfLines(function(u){(function(h,d,f){for(let p=h;p<d;++p){const _=f[p].trim();if(_!==""&&l>=n.atomCount+6+c){const v=_.match(qpe);for(let g=0,b=v.length;g<b;++g)o[a]=parseFloat(v[g]),++a}++l}})(0,u.length,u)}),e.header=n,e.setData(o,n.NVZ,n.NVY,n.NVX),pt&&tt.timeEnd("CubeParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=new Ct;return t.multiply(new Ct().makeTranslation(e.originX,e.originY,e.originZ)),t.multiply(new Ct().makeBasis(e.basisZ,e.basisY,e.basisX)),t}}Qt.add("cub",zO),Qt.add("cube",zO);class GO extends tv{get type(){return"dsn6"}get isBinary(){return!0}_parse(){pt&&tt.time("Dsn6Parser._parse "+this.name);const e=this.volume,t={};let n,r;const s=Fm(this.streamer.data),o=new Int16Array(s),a=new Uint8Array(s),l=String.fromCharCode.apply(null,a.subarray(0,512));if(l.startsWith(":-)"))t.xStart=parseInt(l.substr(10,5)),t.yStart=parseInt(l.substr(15,5)),t.zStart=parseInt(l.substr(20,5)),t.xExtent=parseInt(l.substr(32,5)),t.yExtent=parseInt(l.substr(38,5)),t.zExtent=parseInt(l.substr(42,5)),t.xRate=parseInt(l.substr(52,5)),t.yRate=parseInt(l.substr(58,5)),t.zRate=parseInt(l.substr(62,5)),t.xlen=parseFloat(l.substr(73,10))*this.voxelSize,t.ylen=parseFloat(l.substr(83,10))*this.voxelSize,t.zlen=parseFloat(l.substr(93,10))*this.voxelSize,t.alpha=parseFloat(l.substr(103,10)),t.beta=parseFloat(l.substr(113,10)),t.gamma=parseFloat(l.substr(123,10)),n=parseFloat(l.substr(138,12))/100,r=parseInt(l.substr(155,8)),t.sigma=100*parseFloat(l.substr(170,12));else{if(o[18]!==100)for(let E=0,C=o.length;E<C;++E){const N=o[E];o[E]=(255&N)<<8|N>>8&255}t.xStart=o[0],t.yStart=o[1],t.zStart=o[2],t.xExtent=o[3],t.yExtent=o[4],t.zExtent=o[5],t.xRate=o[6],t.yRate=o[7],t.zRate=o[8];const M=1/o[17],T=M*this.voxelSize;t.xlen=o[9]*T,t.ylen=o[10]*T,t.zlen=o[11]*T,t.alpha=o[12]*M,t.beta=o[13]*M,t.gamma=o[14]*M,n=o[15]/100,r=o[16],t.gamma=o[14]*M}e.header=t,pt&&tt.log(t,n,r);const c=new Float32Array(t.xExtent*t.yExtent*t.zExtent);let u=512;const h=Math.ceil(t.xExtent/8),d=Math.ceil(t.yExtent/8),f=Math.ceil(t.zExtent/8);for(var p=0;p<f;++p)for(var _=0;_<d;++_)for(var v=0;v<h;++v)for(var g=0;g<8;++g)for(var b=8*p+g,m=0;m<8;++m)for(var y=8*_+m,A=0;A<8;++A){var w=8*v+A;if(!(w<t.xExtent&&y<t.yExtent&&b<t.zExtent)){u+=8-A;break}c[(w*t.yExtent+y)*t.zExtent+b]=(a[u]-r)/n,++u}e.setData(c,t.zExtent,t.yExtent,t.xExtent),t.sigma&&e.setStats(void 0,void 0,void 0,t.sigma),pt&&tt.timeEnd("Dsn6Parser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],r=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];r[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-r[1]*r[1]);const s=[[],t,n,r],o=[0,e.xRate,e.yRate,e.zRate],a=[0,1,2,3],l=new Ct;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.multiply(new Ct().makeRotationY(Pi(90))),l.multiply(new Ct().makeTranslation(-e.zStart,e.yStart,e.xStart)),l.multiply(new Ct().makeScale(-1,1,1)),l}}Qt.add("dsn6",GO),Qt.add("brix",GO);const rx=/\s+/;class zH extends tv{get type(){return"dx"}_parse(){pt&&tt.time("DxParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(30),n=this.parseHeaderLines(t),r=this.volume.header,s=n.dataLineStart,o=r.nx*r.ny*r.nz,a=new Float32Array(o);let l=0,c=0;this.streamer.eachChunkOfLines(function(u){(function(h,d,f){for(let p=h;p<d;++p){if(l<o&&c>s){const _=f[p].trim();if(_!==""){const v=_.split(rx);for(let g=0,b=v.length;g<b;++g)a[l]=parseFloat(v[g]),++l}}++c}})(0,u.length,u)}),e.setData(a,r.nz,r.ny,r.nx),pt&&tt.timeEnd("DxParser._parse "+this.name)}parseHeaderLines(e){const t={},n=e.length;let r=0,s=0,o=0;for(let a=0;a<n;++a){let l;const c=e[a];if(c.startsWith("object 1"))l=c.split(rx),t.nx=parseInt(l[5]),t.ny=parseInt(l[6]),t.nz=parseInt(l[7]);else if(c.startsWith("origin"))l=c.split(rx),t.xmin=parseFloat(l[1]),t.ymin=parseFloat(l[2]),t.zmin=parseFloat(l[3]);else if(c.startsWith("delta"))l=c.split(rx),o===0?t.hx=parseFloat(l[1])*this.voxelSize:o===1?t.hy=parseFloat(l[2])*this.voxelSize:o===2&&(t.hz=parseFloat(l[3])*this.voxelSize),o+=1;else if(c.startsWith("object 3")){r=a,s+=c.length+1;break}s+=c.length+1}return this.volume.header=t,{dataLineStart:r,headerByteCount:s}}getMatrix(){const e=this.volume.header,t=new Ct;return t.multiply(new Ct().makeRotationY(Pi(90))),t.multiply(new Ct().makeTranslation(-e.zmin,e.ymin,e.xmin)),t.multiply(new Ct().makeScale(-e.hz,e.hy,e.hx)),t}}Qt.add("dx",zH);Qt.add("dxbin",class extends zH{get type(){return"dxbin"}get isBinary(){return!0}_parse(){pt&&tt.time("DxbinParser._parse "+this.name);const i=Fm(this.streamer.data),e=function(l,c=10485760,u=`
`){let h="",d=[];for(let f=0;f<l.length;f+=c){const p=v1(l.subarray(f,f+c)),_=p.lastIndexOf(u);if(_===-1)h+=p;else{const v=h+p.substr(0,_);d=d.concat(v.split(u)),h=_===p.length-u.length?"":p.substr(_+u.length)}}return h!==""&&d.push(h),d}(new Uint8Array(i,0,1e3)),t=this.parseHeaderLines(e),n=this.volume.header,r=t.headerByteCount,s=n.nx*n.ny*n.nz,o=new DataView(i),a=new Float32Array(s);for(let l=0;l<s;++l)a[l]=o.getFloat64(8*l+r,!0);this.volume.setData(a,n.nz,n.ny,n.nx),pt&&tt.timeEnd("DxbinParser._parse "+this.name)}});class rE extends tv{get type(){return"mrc"}get isBinary(){return!0}_parse(){pt&&tt.time("MrcParser._parse "+this.name);const e=this.volume,t={},n=Fm(this.streamer.data),r=new Int32Array(n,0,56),s=new Float32Array(n,0,56),o=new DataView(n);if(t.MAP=String.fromCharCode(o.getUint8(208),o.getUint8(209),o.getUint8(210),o.getUint8(211)),t.MACHST=[o.getUint8(212),o.getUint8(213)],t.MACHST[0]===17&&t.MACHST[1]===17){const l=n.byteLength;for(let c=0;c<l;c+=4)o.setFloat32(c,o.getFloat32(c),!0)}let a;if(t.NX=r[0],t.NY=r[1],t.NZ=r[2],t.MODE=r[3],t.NXSTART=r[4],t.NYSTART=r[5],t.NZSTART=r[6],t.MX=r[7],t.MY=r[8],t.MZ=r[9],t.xlen=s[10]*this.voxelSize,t.ylen=s[11]*this.voxelSize,t.zlen=s[12]*this.voxelSize,t.alpha=s[13],t.beta=s[14],t.gamma=s[15],t.MAPC=r[16],t.MAPR=r[17],t.MAPS=r[18],t.DMIN=s[19],t.DMAX=s[20],t.DMEAN=s[21],t.ISPG=r[22],t.NSYMBT=r[23],t.LSKFLG=r[24],t.originX=s[49],t.originY=s[50],t.originZ=s[51],t.ARMS=s[54],e.header=t,t.MODE===2)a=new Float32Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ);else if(t.MODE===0){if(a=new Float32Array(new Int8Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ)),r[39]===-128&&r[40]===127){const l=(t.DMAX-t.DMIN)/255,c=.5*(t.DMIN+t.DMAX+l);for(let u=0,h=a.length;u<h;++u)a[u]=l*a[u]+c}}else tt.error("MrcParser unknown mode",t.MODE);e.setData(a,t.NX,t.NY,t.NZ),t.ARMS!==0&&e.setStats(t.DMIN,t.DMAX,t.DMEAN,t.ARMS),pt&&tt.timeEnd("MrcParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],r=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];r[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-r[1]*r[1]);const s=[[],t,n,r],o=[0,e.MX,e.MY,e.MZ],a=[0,e.MAPC,e.MAPR,e.MAPS],l=new Ct;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.setPosition(new me(e.originX,e.originY,e.originZ)),l.multiply(new Ct().makeTranslation(e.NXSTART,e.NYSTART,e.NZSTART)),l}}Qt.add("mrc",rE),Qt.add("ccp4",rE),Qt.add("map",rE);const Ype=/\s+/;function sE(i){return i.trim().split(Ype).map(parseFloat)}class VO extends tv{get type(){return"xplor"}_parse(){pt&&tt.time("XplorParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(8),n={};let r;r=t[2].startsWith("REMARKS")?parseInt(t[1].substring(0,8))+2:5;const s=r+3,o=sE(t[r]);n.NA=o[0],n.AMIN=o[1],n.AMAX=o[2],n.NB=o[3],n.BMIN=o[4],n.BMAX=o[5],n.NC=o[6],n.CMIN=o[7],n.CMAX=o[8];const a=sE(t[r+1]);n.a=a[0]*this.voxelSize,n.b=a[1]*this.voxelSize,n.c=a[2]*this.voxelSize,n.alpha=a[3],n.beta=a[4],n.gamma=a[5];const l=n.AMAX-n.AMIN+1,c=n.BMAX-n.BMIN+1,u=n.CMAX-n.CMIN+1,h=l*c*u,d=new Float32Array(h),f=Math.ceil(1+l*c/6);let p=0,_=0;this.streamer.eachChunkOfLines(function(v){(function(g,b,m){for(let y=g;y<b;++y){const A=m[y];if(_>=s&&(_-s)%f!=0&&p<h)for(let w=0,M=6;w<M;++w){const T=parseFloat(A.substr(12*w,12));if(isNaN(T))break;d[p++]=T}else if(p===h){const w=A.trim();if(w&&w!=="-9999"){const M=sE(A);n.RAVE=M[0],n.RSIGMA=M[1]}}++_}})(0,v.length,v)}),e.header=n,e.setData(d,l,c,u),n.RAVE!==0&&n.RSIGMA!==1&&e.setStats(void 0,void 0,n.RAVE,n.RSIGMA),pt&&tt.timeEnd("XplorParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.a,0,0],n=[e.b*Math.cos(Math.PI/180*e.gamma),e.b*Math.sin(Math.PI/180*e.gamma),0],r=[e.c*Math.cos(Math.PI/180*e.beta),e.c*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];r[2]=Math.sqrt(e.c*e.c*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-r[1]*r[1]);const s=[[],t,n,r],o=[0,e.NA,e.NB,e.NC],a=[0,1,2,3],l=new Ct;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.multiply(new Ct().makeTranslation(e.AMIN,e.BMIN,e.CMIN)),l}}function si(i,e,t){let n,r,s;i/=360,e/=100,t/=100;const o=Math.floor(6*i),a=6*i-o,l=t*(1-e),c=t*(1-a*e),u=t*(1-(1-a)*e);switch(o%6){case 0:n=t,r=u,s=l;break;case 1:n=c,r=t,s=l;break;case 2:n=l,r=t,s=u;break;case 3:n=l,r=c,s=t;break;case 4:n=u,r=l,s=t;break;case 5:n=t,r=l,s=c}return[n,r,s]}Qt.add("xplor",VO),Qt.add("cns",VO);const nP={red:si(0,100,100),orange:si(20,100,100),gold:si(40,100,100),yellow:si(60,100,100),lime:si(80,100,100),green:si(120,80,100),sea:si(150,100,100),cyan:si(180,100,85),sky:si(210,75,95),blue:si(240,70,100),purple:si(275,75,100),magenta:si(300,95,100),hotpink:si(335,100,100),pink:si(350,55,100),peach:si(25,75,100),lilac:si(275,55,100),pinktint:si(340,30,100),peachtint:si(25,50,100),yellowtint:si(60,50,100),greentint:si(135,40,100),bluetint:si(220,40,100),lilactint:si(275,35,100),white:si(0,0,100),gray:si(0,0,50),brown:si(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},Kpe=/[\s,]+/,GH=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,iP=/^{+|}+$/g,Zpe=/^['"]+|['"]+$/g,VH=/\s*=\s*/g;function sx(i){let e,t,n,r=[];const s=(i=i.replace(VH,"=")).match(GH);for(let o=1;o<s.length;++o){const a=s[o];if(a[0]==="{")e=a.substring(1,a.length-1);else{const l=a.split("=");l.length===2&&(l[0]==="color"?t=nP[l[1]]:l[0]==="width"?n=parseInt(l[1]):l[0]==="master"&&r.push(l[1].replace(iP,"")))}}return{listName:e,listColor:t,listMasters:r,listWidth:n}}function ox(i){const e=(i=i.trim()).indexOf("{"),t=i.indexOf("}"),n=i.substr(t+1).split(Kpe),r=i.substr(e+1,t-1),s=[parseFloat(n[n.length-3]),parseFloat(n[n.length-2]),parseFloat(n[n.length-1])];let o,a,l,c=!1,u=!1;for(let h=4;h<=n.length;h++){const d=n[n.length-h];d in nP&&(o=nP[n[n.length-h]]),d.startsWith("width")&&(a=parseInt(d.substring(5))),d.startsWith("r=")&&(l=parseFloat(d.split("=")[1])),d.startsWith("P")&&(c=!0),d.startsWith("X")&&(u=!0)}return{label:r,position:s,color:o,radius:l,width:a,isLineBreak:c,isTriangleBreak:u}}function oE(i){const e=i.indexOf("{"),t=i.indexOf("}");return i.substring(e!==-1?e+1:0,t!==-1?t:void 0).trim()}function Qpe(i){const e=i.indexOf("}");return e===-1?void 0:i.substr(e+1).trim()}function aE(i){let e="",t=[],n={};const r=(i=i.replace(VH,"=")).match(GH);for(let s=1;s<r.length;++s){const o=r[s];if(o[0]==="{")e=o.substring(1,o.length-1);else{const a=o.split("=");a.length===2?a[0]==="master"?t.push(a[1].replace(iP,"")):n[a[0]]=a[1].replace(iP,""):n[a[0]]=!0}}return{groupName:e,groupFlags:n,groupMasters:t}}Qt.add("kin",class extends Xa{get type(){return"kin"}get __objName(){return"kinemage"}_parse(){pt&&tt.time(`KinParser._parse ${this.name}`);const i={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};let e,t;this.kinemage=i;let n,r,s,o,a,l,c,u,h,d,f,p,_,v,g,b,m,y,A,w,M,T,E=!1,C="",N=!1,P="",L=null,R=null,F=!1,V="",G=!1,U="",z=!1,O=!1;if(this.streamer.eachChunkOfLines(function(D){(function(B,W,q){for(let te=B;te<W;++te){const ne=q[te];if(ne[0]==="@"&&(E=!1,N=!1,F=!1,G=!1,z=!1,O=!1),ne)if(ne.startsWith("@dotlist")){let{listColor:Z,listName:le,listMasters:re}=sx(ne);E=!0,C="",r=[],s=[],o=[],n=Z,e&&(re=re.concat(e)),t&&(re=re.concat(t)),i.dotLists.push({name:le,masterArray:re,labelArray:r,positionArray:s,colorArray:o})}else if(ne.startsWith("@vectorlist")){let{listMasters:Z,listName:le,listWidth:re,listColor:se}=sx(ne);Z&&Z.forEach(function($){i.masterDict[$]||(i.masterDict[$]={indent:!1,visible:!1})}),N=!0,P="",L=null,R=null,c=[],u=[],h=[],d=[],f=[],p=[],a=se,l=[],re&&l.push(re),e&&(Z=Z.concat(e)),t&&(Z=Z.concat(t)),i.vectorLists.push({name:le,masterArray:Z,label1Array:c,label2Array:u,position1Array:h,position2Array:d,color1Array:f,color2Array:p,width:l})}else if(ne.startsWith("@balllist")){let{listName:Z,listColor:le,listMasters:re}=sx(ne);re&&re.forEach(function(se){i.masterDict[se]||(i.masterDict[se]={indent:!1,visible:!1})}),F=!0,V="",g=[],_=[],b=[],m=[],v=le,e&&(re=re.concat(e)),t&&(re=re.concat(t)),i.ballLists.push({name:Z,masterArray:re,labelArray:g,radiusArray:_,positionArray:b,colorArray:m})}else if(ne.startsWith("@ribbonlist")||ne.startsWith("@trianglelist")){let{listMasters:Z,listName:le,listColor:re}=sx(ne);Z&&Z.forEach(function(se){i.masterDict[se]||(i.masterDict[se]={indent:!1,visible:!1})}),G=!0,U="",A=[],w=[],M=[],T=[],y=re,e&&(Z=Z.concat(e)),t&&(Z=Z.concat(t)),i.ribbonLists.push({name:le,masterArray:Z,labelArray:A,positionArray:w,breakArray:M,colorArray:T})}else if(ne.startsWith("@text"))z=!0,i.texts.push(ne.substr(5));else if(ne.startsWith("@caption"))O=!0,i.captions.push(ne.substr(8));else if(E){let{label:Z,color:le,position:re}=ox(ne);Z==='"'?Z=C:C=Z,le===void 0&&(le=n),r.push(Z),s.push(...re),o.push(...le)}else if(N){let Z=ne.replace(/(?!^){/g,`
{`).split(/\n/);for(var j=0;j<Z.length;j++){let le=Z[j],{label:re,color:se,width:$,position:fe,isLineBreak:xe}=ox(le);re==='"'?re=P:P=re,se===void 0&&(se=a),xe||L!==null&&($&&l.push($),c.push(P),h.push(...L),f.push(...R),u.push(re),d.push(...fe),p.push(...se)),P=re,L=fe,R=se}}else if(F){let{label:Z,radius:le,color:re,position:se}=ox(ne);Z==='"'?Z=V:V=Z,le===void 0&&(le=1),re===void 0&&(re=v),g.push(Z),_.push(le),b.push(...se),m.push(...re)}else if(G){let{label:Z,color:le,position:re,isTriangleBreak:se}=ox(ne);Z==='"'?Z=U:U=Z,le===void 0&&(le=y),A.push(Z),w.push(...re),M.push(se),T.push(...le)}else if(z)i.texts.push(ne);else if(O)i.captions.push(ne);else if(ne.startsWith("@kinemage"))i.kinemage=parseInt(ne.substr(9).trim());else if(ne.startsWith("@onewidth"))i.onewidth=!0;else if(ne.startsWith("@1viewid"))i["1viewid"]=oE(ne);else if(ne.startsWith("@pdbfile"))i.pdbfile=oE(ne);else if(ne.startsWith("@group")){let{groupName:Z,groupFlags:le,groupMasters:re}=aE(ne);i.groupDict[Z]||(i.groupDict[Z]={dominant:!1,animate:!1},e=re),e&&e.forEach(function(se){i.masterDict[se]||(i.masterDict[se]={indent:!1,visible:!1})});for(let se in le)i.groupDict[Z][se]=le[se]}else if(ne.startsWith("@subgroup")){const{groupName:Z,groupFlags:le,groupMasters:re}=aE(ne);i.subgroupDict[Z]||(i.subgroupDict[Z]={dominant:!1,animate:!1},t=re),t&&t.forEach(function(se){i.masterDict[se]||(i.masterDict[se]={indent:!1,visible:!1})});for(let se in le)i.subgroupDict[Z][se]=le[se]}else if(ne.startsWith("@master")){const Z=oE(ne),le=Qpe(ne);i.masterDict[Z]||(i.masterDict[Z]={indent:!1,visible:!1}),le==="on"?i.masterDict[Z].visible=!0:le==="off"?i.masterDict[Z].visible=!1:le==="indent"&&(i.masterDict[Z].indent=!0)}else if(ne.startsWith("@pointmaster")){const{groupName:Z,groupFlags:le}=aE(ne);i.pointmasterDict[Z]={id:Object.keys(le)[0].replace(Zpe,"")}}else console.log(ne);else E=!1,N=!1,F=!1,G=!1}})(0,D.length,D)}),i.text=i.texts.join(`
`).trim(),i.caption=i.captions.join(`
`).trim(),i.ribbonLists){let D=[];i.ribbonLists.forEach(function(B){D.push(function(W){let{labelArray:q,positionArray:j,colorArray:te,breakArray:ne}=W,Z=[],le=[],re=[],se=[];for(let $=0;$<ne.length/3;$++){let fe=3*$,xe=9*$;ne[fe+1]||ne[fe+2]||(Z.push(q[fe]),Z.push(q[fe+1]),Z.push(q[fe+2]),se.push(ne[fe]),se.push(ne[fe+1]),se.push(ne[fe+2]),le.push(j[xe]),le.push(j[xe+1]),le.push(j[xe+2]),le.push(j[xe+3]),le.push(j[xe+4]),le.push(j[xe+5]),le.push(j[xe+6]),le.push(j[xe+7]),le.push(j[xe+8]),re.push(te[xe]),re.push(te[xe+1]),re.push(te[xe+2]),re.push(te[xe+3]),re.push(te[xe+4]),re.push(te[xe+5]),re.push(te[xe+6]),re.push(te[xe+7]),re.push(te[xe+8]))}return{name:W.name,masterArray:W.masterArray,labelArray:Z,positionArray:le,breakArray:se,colorArray:re}}(function(W){let{labelArray:q,positionArray:j,colorArray:te,breakArray:ne}=W,Z=[];for(let fe=0;fe<3*(q.length-2);++fe)Z[fe]=q[fe-2*Math.floor(fe/3)];let le=[];for(let fe=0;fe<3*(ne.length-2);++fe)le[fe]=ne[fe-2*Math.floor(fe/3)];let re=[];for(let fe=0;fe<9*(j.length/3-2);++fe)re[fe]=j[fe-6*Math.floor(fe/9)];let se=[];for(let fe=0;fe<9*(te.length/3-2);++fe)se[fe]=te[fe-6*Math.floor(fe/9)];let $=[];for(let fe=0;fe<re.length/3;++fe)$.push(new me(re[3*fe],re[3*fe]+1,re[3*fe]+2));return{name:W.name,masterArray:W.masterArray,labelArray:Z,positionArray:re,breakArray:le,colorArray:se}}(B)))}),i.ribbonLists=D}pt&&tt.timeEnd(`KinParser._parse ${this.name}`)}});class HH extends Xa{constructor(e,t){super(e,t),this.loader=this.getLoader(),this.surface=new t2(this.name,this.path)}get type(){return"surface"}get __objName(){return"surface"}_parse(){var e=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(e)}}const rP=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};rP.prototype={constructor:rP,setPath:function(i){this.path=i},_createParserState:function(){var i={objects:[],object:{},vertices:[],normals:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);this.object={name:e||"",geometry:{vertices:[],normals:[]},fromDeclaration:t!==!1},this.objects.push(this.object)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},addVertex:function(e,t,n){var r=this.vertices,s=this.object.geometry.vertices;s.push(r[e+0]),s.push(r[e+1]),s.push(r[e+2]),s.push(r[t+0]),s.push(r[t+1]),s.push(r[t+2]),s.push(r[n+0]),s.push(r[n+1]),s.push(r[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var r=this.normals,s=this.object.geometry.normals;s.push(r[e+0]),s.push(r[e+1]),s.push(r[e+2]),s.push(r[t+0]),s.push(r[t+1]),s.push(r[t+2]),s.push(r[n+0]),s.push(r[n+1]),s.push(r[n+2])},addFace:function(e,t,n,r,s,o,a,l){var c,u=this.vertices.length,h=this.parseVertexIndex(e,u),d=this.parseVertexIndex(t,u),f=this.parseVertexIndex(n,u);if(r===void 0?this.addVertex(h,d,f):(c=this.parseVertexIndex(r,u),this.addVertex(h,d,c),this.addVertex(d,f,c)),s!==void 0){var p=this.normals.length;h=this.parseNormalIndex(s,p),d=s===o?h:this.parseNormalIndex(o,p),f=s===a?h:this.parseNormalIndex(a,p),r===void 0?this.addNormal(h,d,f):(c=this.parseNormalIndex(l,p),this.addNormal(h,d,c),this.addNormal(d,f,c))}},addLineGeometry:function(e){this.object.geometry.type="Line";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++)this.addVertexLine(this.parseVertexIndex(e[n],t))}};return i.startObject("",!1),i},parse:function(i){var e,t,n=this._createParserState();i.indexOf(`\r
`)!==-1&&(i=i.replace(/\r\n/g,`
`)),i.indexOf(`\\
`)!==-1&&(i=i.replace(/\\\n/g,""));var r=i.split(`
`),s="",o="",a="",l=[],c=typeof"".trimLeft=="function";for(e=0,t=r.length;e<t;e++)if(s=r[e],(s=c?s.trimLeft():s.trim()).length!==0&&(o=s.charAt(0))!=="#"){if(o==="v"){if((a=s.charAt(1))===" "&&(l=this.regexp.vertex_pattern.exec(s))!==null)n.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a==="n"&&(l=this.regexp.normal_pattern.exec(s))!==null)n.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a!=="t"||this.regexp.uv_pattern.exec(s)===null)throw new Error("Unexpected vertex/normal/uv line: '"+s+"'")}else if(o==="f"){if((l=this.regexp.face_vertex_uv_normal.exec(s))!==null)n.addFace(l[1],l[4],l[7],l[10],l[3],l[6],l[9],l[12]);else if(this.regexp.face_vertex_uv.exec(s)===null)if((l=this.regexp.face_vertex_normal.exec(s))!==null)n.addFace(l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else{if((l=this.regexp.face_vertex.exec(s))===null)throw new Error("Unexpected face line: '"+s+"'");n.addFace(l[1],l[2],l[3],l[4])}}else if(o==="l"){var u=s.substring(1).trim().split(" "),h=[],d=[];if(s.indexOf("/")===-1)h=u;else for(var f=0,p=u.length;f<p;f++){var _=u[f].split("/");_[0]!==""&&h.push(_[0]),_[1]!==""&&d.push(_[1])}n.addLineGeometry(h,d)}else if((l=this.regexp.object_pattern.exec(s))!==null){var v=l[0].substr(1).trim();n.startObject(v)}else if(!this.regexp.material_use_pattern.test(s)){if(!this.regexp.material_library_pattern.test(s)){if(this.regexp.smoothing_pattern.exec(s)===null){if(s==="\0")continue;throw new Error("Unexpected line: '"+s+"'")}}}}var g=[];for(e=0,t=n.objects.length;e<t;e++){var b=n.objects[e].geometry;if(b.vertices.length!==0){var m=new hr;m.setAttribute("position",new Qi(new Float32Array(b.vertices),3)),b.normals.length>0?m.setAttribute("normal",new Qi(new Float32Array(b.normals),3)):m.computeVertexNormals(),g.push(m)}}return g}};Qt.add("obj",class extends HH{get type(){return"obj"}getLoader(){return new rP}});const Jpe=["int8","char","uint8","uchar","int16","short","uint16","ushort","int32","int","uint32","uint","float32","float","float64","double"];function lE(i){if(function(e){return Jpe.includes(e)}(i))return i;throw new Error(`Unsupported data type: ${i}`)}function eme(i){if(typeof i!="object"||i===null)throw new Error("Expected element to be an object");if(typeof i.name!="string")throw new Error("Expected element.name to be a string");if(typeof i.count!="number")throw new Error("Expected element.count to be a number");if(!Array.isArray(i.properties))throw new Error("Expected element.properties to be an array")}function cE(i,e,t){switch(e){case"int8":case"char":return{read:n=>i.getInt8(n),size:1};case"uint8":case"uchar":return{read:n=>i.getUint8(n),size:1};case"int16":case"short":return{read:n=>i.getInt16(n,t),size:2};case"uint16":case"ushort":return{read:n=>i.getUint16(n,t),size:2};case"int32":case"int":return{read:n=>i.getInt32(n,t),size:4};case"uint32":case"uint":return{read:n=>i.getUint32(n,t),size:4};case"float32":case"float":return{read:n=>i.getFloat32(n,t),size:4};case"float64":case"double":return{read:n=>i.getFloat64(n,t),size:8};default:throw new Error(`Unsupported data type: ${e}`)}}function tme(i,e){const t={};let n=0;for(let r=0;r<e.length;r++){const s=e[r],o=s.valueReader;if(s.isList){const a=[],l=s.countReader.read(i+n);n+=s.countReader.size;for(let c=0;c<l;c++)a.push(o.read(i+n)),n+=o.size;t[s.name]=a}else t[s.name]=o.read(i+n),n+=o.size}return[t,n]}class nme{constructor(){this._color=new $t,this.propertyNameMapping={},this.customPropertyMapping={}}setPropertyNameMapping(e){this.propertyNameMapping=e}createBuffer(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const t of Object.keys(this.customPropertyMapping))e[t]=[];return e}extractHeaderText(e){let t=0,n=!0,r="";const s=[],o=new TextDecoder().decode(e.subarray(0,5)),a=/^ply\r\n/.test(o);do{const l=String.fromCharCode(e[t++]);l!==`
`&&l!=="\r"?r+=l:(r==="end_header"&&(n=!1),r!==""&&(s.push(r),r=""))}while(n&&t<e.length);return a===!0&&t++,{headerText:s.join("\r")+"\r",headerLength:t}}handleElement(e,t,n,r){if(t==="vertex"){e.vertices.push(n[r.attrX],n[r.attrY],n[r.attrZ]),r.attrNX!==null&&r.attrNY!==null&&r.attrNZ!==null&&e.normals.push(n[r.attrNX],n[r.attrNY],n[r.attrNZ]),r.attrS!==null&&r.attrT!==null&&e.uvs.push(n[r.attrS],n[r.attrT]),r.attrR!==null&&r.attrG!==null&&r.attrB!==null&&(this._color.setRGB(n[r.attrR]/255,n[r.attrG]/255,n[r.attrB]/255).convertSRGBToLinear(),e.colors.push(this._color.r,this._color.g,this._color.b));for(const s of Object.keys(this.customPropertyMapping))for(const o of this.customPropertyMapping[s])e[s].push(n[o])}else if(t==="face"){const s=n.vertex_indices||n.vertex_index,o=n.texcoord;s.length===3?(e.indices.push(s[0],s[1],s[2]),o&&o.length===6&&(e.faceVertexUvs.push(o[0],o[1]),e.faceVertexUvs.push(o[2],o[3]),e.faceVertexUvs.push(o[4],o[5]))):s.length===4&&(e.indices.push(s[0],s[1],s[3]),e.indices.push(s[1],s[2],s[3])),r.attrR!==null&&r.attrG!==null&&r.attrB!==null&&(this._color.setRGB(n[r.attrR]/255,n[r.attrG]/255,n[r.attrB]/255).convertSRGBToLinear(),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b))}}parse(e){let t;if(e instanceof ArrayBuffer){const n=new Uint8Array(e),{headerText:r,headerLength:s}=this.extractHeaderText(n),o=this.parseHeader(r,s);if(o.format==="ascii"){const a=new TextDecoder().decode(n);t=this.parseASCII(a,o)}else t=this.parseBinary(n,o)}else t=this.parseASCII(e,this.parseHeader(e));return t}parseHeader(e,t=0){let n="";const r=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);r!==null&&(n=r[1]);const s={comments:[],elements:[],headerLength:t,objInfo:"",format:"",version:""},o=n.split(/\r\n|\r|\n/);let a;for(let l=0;l<o.length;l++){let c=o[l];if(c=c.trim(),c==="")continue;const u=c.split(/\s+/),h=u.shift();switch(c=u.join(" "),h){case"format":s.format=u[0],s.version=u[1];break;case"comment":s.comments.push(c);break;case"element":a!==void 0&&(eme(a),s.elements.push(a)),a={name:u[0],count:parseInt(u[1]),properties:[]};break;case"property":if(a===void 0){console.warn("property without element");continue}a.properties.push(ime(u,this.propertyNameMapping));break;case"obj_info":s.objInfo=c;break;default:console.log("unhandled",h,u)}}return a!==void 0&&s.elements.push(a),s}parseASCII(e,t){const n=this.createBuffer();let r,s;r=(s=/end_header\s+(\S[\s\S]*\S|\S)\s*$/.exec(e))!==null?s[1].split(/\s+/):[];const o=new sme(r);e:for(let a=0;a<t.elements.length;a++){const l=t.elements[a],c=HO(l.properties);for(let u=0;u<l.count;u++){const h=rme(l.properties,o);if(!h)break e;this.handleElement(n,l.name,h,c)}}return this.postProcess(n)}parseBinary(e,t){const n=this.createBuffer(),r=t.format==="binary_little_endian",s=new DataView(e,t.headerLength);let o,a=0;for(let l=0;l<t.elements.length;l++){const c=t.elements[l],u=c.properties,h=HO(u),d=this.makeBinaryProperties(u,s,r);for(let f=0;f<c.count;f++){o=tme(a,d),a+=o[1];const p=o[0];this.handleElement(n,c.name,p,h)}}return this.postProcess(n)}postProcess(e){let t=new hr;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new ui(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new ui(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new ui(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new ui(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(t=t.toNonIndexed(),e.faceVertexUvs.length>0&&t.setAttribute("uv",new ui(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&t.setAttribute("color",new ui(e.faceVertexColors,3)));for(const n of Object.keys(this.customPropertyMapping))e[n].length>0&&t.setAttribute(n,new ui(e[n],this.customPropertyMapping[n].length));return t.computeBoundingSphere(),t}makeBinaryProperties(e,t,n){const r=[];for(let s=0,o=e.length;s<o;s++){const a=e[s];a.isList?r.push(Object.assign(Object.assign({},a),{countReader:cE(t,a.countType,n),valueReader:cE(t,a.type,n)})):r.push(Object.assign(Object.assign({},a),{valueReader:cE(t,a.type,n)}))}return r}}function ime(i,e){const t=i[0];let n;return n=t==="list"?{isList:!0,name:i[3],type:lE(i[2]),countType:lE(i[1])}:{isList:!1,name:i[1],type:lE(t)},n.name in e&&(n.name=e[n.name]),n}function uE(i,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(i);case"float":case"double":case"float32":case"float64":return parseFloat(i)}return 0}function rme(i,e){const t={name:"",type:""};for(let n=0;n<i.length;n++){if(e.empty())return null;const r=i[n];if(r.isList){const s=[],o=uE(e.next(),r.countType);for(let a=0;a<o;a++){if(e.empty())return null;s.push(uE(e.next(),r.type))}t[r.name]=s}else t[i[n].name]=uE(e.next(),i[n].type)}return t}function HO(i){const e=i.map(n=>n.name);function t(n){for(let r=0,s=n.length;r<s;r++){const o=n[r];if(e.includes(o))return o}return null}return{attrX:t(["x","px","posx"])||"x",attrY:t(["y","py","posy"])||"y",attrZ:t(["z","pz","posz"])||"z",attrNX:t(["nx","normalx"]),attrNY:t(["ny","normaly"]),attrNZ:t(["nz","normalz"]),attrS:t(["s","u","texture_u","tx"]),attrT:t(["t","v","texture_v","ty"]),attrR:t(["red","diffuse_red","r","diffuse_r"]),attrG:t(["green","diffuse_green","g","diffuse_g"]),attrB:t(["blue","diffuse_blue","b","diffuse_b"])}}class sme{constructor(e){this.arr=e,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}Qt.add("ply",class extends HH{get type(){return"ply"}getLoader(){return new nme}});Qt.add("csv",class extends Xa{constructor(i,e){const t=e||{};super(i,t),this.delimiter=he(t.delimiter,","),this.comment=he(t.comment,"#"),this.columnNames=he(t.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}get type(){return"csv"}get __objName(){return"table"}_parse(){const i=this.table.data,e=new RegExp("\\s*"+this.delimiter+"\\s*");let t=0;this.streamer.eachChunkOfLines(n=>{const r=n.length;for(let s=0;s<r;++s){const o=n[s].trim();if(o.startsWith(this.comment))continue;const a=o.split(e);t===0?this.table.columnNames=a:o&&i.push(a),++t}})}});Qt.add("json",class extends Xa{constructor(i,e){const t=e||{};super(i,t),this.string=he(t.string,!1),this.json={name:this.name,path:this.path,data:{}}}get type(){return"json"}get __objName(){return"json"}get isJson(){return!0}_parse(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data}});Qt.add("msgpack",class extends Xa{constructor(i,e){super(i,e||{}),this.msgpack={name:this.name,path:this.path,data:void 0}}get type(){return"msgpack"}get __objName(){return"msgpack"}get isBinary(){return!0}_parse(){pt&&tt.time("MsgpackParser._parse "+this.name),this.msgpack.data=kH(this.streamer.data),pt&&tt.timeEnd("MsgpackParser._parse "+this.name)}});Qt.add("netcdf",class extends Xa{constructor(i,e){super(i,e||{}),this.netcdf={name:this.name,path:this.path,data:void 0}}get type(){return"netcdf"}get __objName(){return"netcdf"}get isBinary(){return!0}_parse(){pt&&tt.time("NetcdfParser._parse "+this.name),this.netcdf.data=new BH(this.streamer.data),pt&&tt.timeEnd("NetcdfParser._parse "+this.name)}});class $O extends Xa{constructor(e,t){super(e,t),this.text={name:this.name,path:this.path,data:""}}get type(){return"text"}get __objName(){return"text"}_parse(){this.text.data=this.streamer.asText()}}Qt.add("txt",$O),Qt.add("text",$O);const ome=/^['"]|['"]$/g,ame=/^<([\w-:.]+)\s*/,lme=/^([^<]*)/,cme=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;function ume(i){return i=i.trim().replace(/<!--[\s\S]*?-->/g,""),{declaration:e(),root:t()};function e(){if(!r(/^<\?xml\s*/))return;const a={attributes:{}};for(;!s()&&!o("?>");){const l=n();if(!l)return a;a.attributes[l.name]=l.value}return r(/\?>\s*/),a}function t(){const a=r(ame);if(!a)return;const l={name:a[1],attributes:{},children:[]};for(;!(s()||o(">")||o("?>")||o("/>"));){const u=n();if(!u)return l;l.attributes[u.name]=u.value}if(r(/^\s*\/>\s*/))return l;let c;for(r(/\??>\s*/),l.content=function(){const u=r(lme);return u?u[1]:""}();c=t();)l.children.push(c);return r(/^<\/[\w-:.]+>\s*/),l}function n(){const a=r(cme);var l;if(a)return{name:a[1],value:(l=a[2],l.replace(ome,""))}}function r(a){const l=i.match(a);if(l)return i=i.slice(l[0].length),l}function s(){return i.length===0}function o(a){return i.indexOf(a)===0}}class $H extends Xa{constructor(e,t){const n=t||{};super(e,n),this.useDomParser=he(n.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}get type(){return"xml"}get __objName(){return"xml"}get isXml(){return!0}__xmlParser(e){return ume(e)}__domParser(e){return new window.DOMParser().parseFromString(e,"text/xml")}_parse(){pt&&tt.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),pt&&tt.timeEnd("XmlParser._parse "+this.name)}}function or(i,e){const t=i.getNamedItem(e);return t!==null?t.value:""}function WO(i,e,t=!1){const n=or(i,"icode").trim(),r=or(i,"chain").trim(),s=or(i,"altcode");let o=or(i,"resnum");return n&&(o+="^"+n),r&&(o+=":"+r),e&&(o+="."+e),t&&s.trim()&&(o+="%"+s),o+="/"+(parseInt(or(i,"model"))-1),o}function hme(i){const e=or(i,"chain").trim();let t=`[${or(i,"rescode")}]${or(i,"resnum")}`;return e&&(t+=`:${e}`),t}function hE(i,e,t){i[e]===void 0?i[e]=t:i[e]|=t}function dE(i,e){return i!==null&&i.value===e}function dme(i,e,t){let n=0;const r=e.getElementsByTagName("clash");for(let s=0,o=r.length;s<o;++s)if(i[or(r[s].attributes,"cid")]){n+=1;break}return e.getElementsByTagName("angle-outlier").length>0&&(n+=1),e.getElementsByTagName("bond-outlier").length>0&&(n+=1),e.getElementsByTagName("plane-outlier").length>0&&(n+=1),dE(t.getNamedItem("rota"),"OUTLIER")&&(n+=1),dE(t.getNamedItem("rama"),"OUTLIER")&&(n+=1),dE(t.getNamedItem("RNApucker"),"outlier")&&(n+=1),n}Qt.add("xml",$H);class fme{constructor(e,t){this.name=e,this.path=t,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"}get type(){return"validation"}fromXml(e){pt&&tt.time("Validation.fromXml");const t=this.rsrzDict,n=this.rsccDict,r=this.rciDict,s=this.clashDict,o=this.clashArray,a=this.geoDict,l=this.geoAtomDict,c=this.atomDict,u=e.getElementsByTagName("Entry");if(u.length===1){const p=u[0].getElementsByTagName("chemical_shift_list");if(p.length===1){const _=p[0].getElementsByTagName("random_coil_index");for(let v=0,g=_.length;v<g;++v){const b=_[v].attributes;r[hme(b)]=parseFloat(or(b,"value"))}}}const h=e.getElementsByTagName("ModelledSubgroup"),d={},f=[];pt&&tt.time("Validation.fromXml#clashDict");for(let p=0,_=h.length;p<_;++p){const v=h[p],g=v.attributes,b=WO(g);g.getNamedItem("rsrz")!==null&&(t[b]=parseFloat(or(g,"rsrz"))),g.getNamedItem("rscc")!==null&&(n[b]=parseFloat(or(g,"rscc")));const m=e.createAttribute("sele");m.value=b,g.setNamedItem(m);const y=v.getElementsByTagName("clash");for(let A=0,w=y.length;A<w;++A){const M=y[A].attributes,T=or(M,"atom");if(w3(T)!=="H"){const E=or(M,"cid"),C=WO(g,T,!0);if(c[C]=!0,d[E]===void 0)d[E]={sele1:C,res1:b};else{const N=d[E];N.res1!==b&&(N.sele2=C,N.res2=b,f.push(N.res1,b),s[E]=N,o.push(N))}}}}pt&&tt.timeEnd("Validation.fromXml#clashDict");for(let p=0,_=h.length;p<_;++p){const v=h[p],g=v.attributes,b=or(g,"sele");if(or(g,"seq")!=="."){const m=dme(s,v,g);m>0&&(a[b]=m)}else{const m=v.getElementsByTagName("clash"),y=v.getElementsByTagName("mog-bond-outlier"),A=v.getElementsByTagName("mog-angle-outlier");if(y.length>0||A.length>0||m.length>0){const w={};l[b]=w;for(let M=0,T=m.length;M<T;++M){const E=m[M].attributes;s[or(E,"cid")]&&hE(w,or(E,"atom"),1)}for(let M=0,T=y.length;M<T;++M)or(y[M].attributes,"atoms").split(",").forEach(function(E){hE(w,E,2)});for(let M=0,T=A.length;M<T;++M)or(A[M].attributes,"atoms").split(",").forEach(function(E){hE(w,E,4)})}}}this.clashSele=f.length?f.join(" OR "):"NONE",pt&&tt.timeEnd("Validation.fromXml")}getClashData(e){pt&&tt.time("Validation.getClashData");const t=e||{},n=t.structure,r=n.atomSet,s=new $t(he(t.color,"#f0027f")),o=n.getAtomProxy(),a=n.getAtomProxy(),l=new me,c=new me,u=new me,h=this.clashArray,d=h.length,f=new Float32Array(3*d),p=new Float32Array(3*d),_=Hn(d,s.r,s.g,s.b),v=new Float32Array(d),g=new Float32Array(d);pt&&tt.time("Validation.getClashData#atomDict");const b=this.atomDict;n.eachAtom(function(y){const A=function(w){const M=w.inscode,T=w.chainname,E=w.atomname,C=w.altloc;let N=w.resno+"";return M&&(N+="^"+M),T&&(N+=":"+T),E&&(N+="."+E),C&&(N+="%"+C),N+="/"+w.modelIndex,N}(y);b[A]===!0&&(b[A]=y.index)}),pt&&tt.timeEnd("Validation.getClashData#atomDict");let m=0;return h.forEach(function(y,A){if(o.index=b[y.sele1],a.index=b[y.sele2],o.index===void 0||a.index===void 0||!r.isSet(o.index,a.index))return;l.subVectors(a,o).setLength(o.vdw),c.copy(o).add(l),l.subVectors(o,a).setLength(a.vdw),u.copy(a).add(l);const w=o.distanceTo(a)/2,M=Math.sqrt(o.vdw*o.vdw-w*w),T=Math.sqrt(a.vdw*a.vdw-w*w);c.toArray(f,3*m),u.toArray(p,3*m),v[m]=(M+T)/2,g[m]=A,++m}),pt&&tt.timeEnd("Validation.getClashData"),{position1:f.subarray(0,3*m),position2:p.subarray(0,3*m),color:_.subarray(0,3*m),color2:_.subarray(0,3*m),radius:v.subarray(0,m),picking:new Nue(g.subarray(0,m),this,n)}}}function WH(i,e){return i.length===e?i:i.subarray?i.subarray(0,e):(i.length=e,i)}function Xp(i,e,t,n,r){if(e.subarray&&i.subarray)i.set(e.subarray(t,t+n),r);else for(var s=0;s<n;s++)i[r+s]=e[t+s]}function sP(i,e,t,n){for(var r=65535&i,s=i>>>16&65535,o=0;t!==0;){t-=o=t>2e3?2e3:t;do s=s+(r=r+e[n++]|0)|0;while(--o);r%=65521,s%=65521}return r|s<<16}Qt.add("validation",class extends $H{constructor(i,e){super(i,e||{}),this.useDomParser=!0,this.validation=new fme(this.name,this.path)}get __objName(){return"validation"}get isXml(){return!0}_parse(){super._parse(),pt&&tt.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),pt&&tt.timeEnd("ValidationParser._parse "+this.name)}});var pme=function(){for(var i,e=[],t=0;t<256;t++){i=t;for(var n=0;n<8;n++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}();function il(i,e,t,n){var r=pme,s=n+t;i^=-1;for(var o=n;o<s;o++)i=i>>>8^r[255&(i^e[o])];return~i}var ax=30,mme=12;function gme(i,e){var t,n,r,s,o,a,l,c,u,h,d,f,p,_,v,g,b,m,y,A,w,M,T,E,C;t=i.state,n=i.next_in,E=i.input,r=n+(i.avail_in-5),s=i.next_out,C=i.output,o=s-(e-i.avail_out),a=s+(i.avail_out-257),l=t.dmax,c=t.wsize,u=t.whave,h=t.wnext,d=t.window,f=t.hold,p=t.bits,_=t.lencode,v=t.distcode,g=(1<<t.lenbits)-1,b=(1<<t.distbits)-1;e:do{p<15&&(f+=E[n++]<<p,p+=8,f+=E[n++]<<p,p+=8),m=_[f&g];t:for(;;){if(f>>>=y=m>>>24,p-=y,(y=m>>>16&255)===0)C[s++]=65535&m;else{if(!(16&y)){if(64&y){if(32&y){t.mode=mme;break e}i.msg="invalid literal/length code",t.mode=ax;break e}m=_[(65535&m)+(f&(1<<y)-1)];continue t}for(A=65535&m,(y&=15)&&(p<y&&(f+=E[n++]<<p,p+=8),A+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=E[n++]<<p,p+=8,f+=E[n++]<<p,p+=8),m=v[f&b];;){if(f>>>=y=m>>>24,p-=y,16&(y=m>>>16&255)){if(w=65535&m,p<(y&=15)&&(f+=E[n++]<<p,(p+=8)<y&&(f+=E[n++]<<p,p+=8)),(w+=f&(1<<y)-1)>l){i.msg="invalid distance too far back",t.mode=ax;break e}if(f>>>=y,p-=y,w>(y=s-o)){if((y=w-y)>u&&t.sane){i.msg="invalid distance too far back",t.mode=ax;break e}if(M=0,T=d,h===0){if(M+=c-y,y<A){A-=y;do C[s++]=d[M++];while(--y);M=s-w,T=C}}else if(h<y){if(M+=c+h-y,(y-=h)<A){A-=y;do C[s++]=d[M++];while(--y);if(M=0,h<A){A-=y=h;do C[s++]=d[M++];while(--y);M=s-w,T=C}}}else if(M+=h-y,y<A){A-=y;do C[s++]=d[M++];while(--y);M=s-w,T=C}for(;A>2;)C[s++]=T[M++],C[s++]=T[M++],C[s++]=T[M++],A-=3;A&&(C[s++]=T[M++],A>1&&(C[s++]=T[M++]))}else{M=s-w;do C[s++]=C[M++],C[s++]=C[M++],C[s++]=C[M++],A-=3;while(A>2);A&&(C[s++]=C[M++],A>1&&(C[s++]=C[M++]))}break}if(64&y){i.msg="invalid distance code",t.mode=ax;break e}m=v[(65535&m)+(f&(1<<y)-1)]}}break}}while(n<r&&s<a);n-=A=p>>3,f&=(1<<(p-=A<<3))-1,i.next_in=n,i.next_out=s,i.avail_in=n<r?r-n+5:5-(n-r),i.avail_out=s<a?a-s+257:257-(s-a),t.hold=f,t.bits=p}var ip=15,jO=852,XO=592,qO=0,fE=1,YO=2,vme=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],_me=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],yme=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],xme=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function F0(i,e,t,n,r,s,o,a){var l,c,u,h,d,f,p,_,v,g=a.bits,b=0,m=0,y=0,A=0,w=0,M=0,T=0,E=0,C=0,N=0,P=null,L=0,R=new Uint16Array(ip+1),F=new Uint16Array(ip+1),V=null,G=0;for(b=0;b<=ip;b++)R[b]=0;for(m=0;m<n;m++)R[e[t+m]]++;for(w=g,A=ip;A>=1&&R[A]===0;A--);if(w>A&&(w=A),A===0)return r[s++]=20971520,r[s++]=20971520,a.bits=1,0;for(y=1;y<A&&R[y]===0;y++);for(w<y&&(w=y),E=1,b=1;b<=ip;b++)if(E<<=1,(E-=R[b])<0)return-1;if(E>0&&(i===qO||A!==1))return-1;for(F[1]=0,b=1;b<ip;b++)F[b+1]=F[b]+R[b];for(m=0;m<n;m++)e[t+m]!==0&&(o[F[e[t+m]]++]=m);if(i===qO?(P=V=o,f=19):i===fE?(P=vme,L-=257,V=_me,G-=257,f=256):(P=yme,V=xme,f=-1),N=0,m=0,b=y,d=s,M=w,T=0,u=-1,h=(C=1<<w)-1,i===fE&&C>jO||i===YO&&C>XO)return 1;for(;;){p=b-T,o[m]<f?(_=0,v=o[m]):o[m]>f?(_=V[G+o[m]],v=P[L+o[m]]):(_=96,v=0),l=1<<b-T,y=c=1<<M;do r[d+(N>>T)+(c-=l)]=p<<24|_<<16|v;while(c!==0);for(l=1<<b-1;N&l;)l>>=1;if(l!==0?(N&=l-1,N+=l):N=0,m++,--R[b]==0){if(b===A)break;b=e[t+o[m]]}if(b>w&&(N&h)!==u){for(T===0&&(T=w),d+=y,E=1<<(M=b-T);M+T<A&&!((E-=R[M+T])<=0);)M++,E<<=1;if(C+=1<<M,i===fE&&C>jO||i===YO&&C>XO)return 1;r[u=N&h]=w<<24|M<<16|d-s}}return N!==0&&(r[d+N]=b-T<<24|64<<16),a.bits=w,0}var jH=1,XH=2,bm=0,bl=-2,qH=1,Zl=12,vi=30,bme=852,Sme=592;function KO(i){return(i>>>24&255)+(i>>>8&65280)+((65280&i)<<8)+((255&i)<<24)}function wme(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Mme(i){var e;return i&&i.state?((e=i.state).wsize=0,e.whave=0,e.wnext=0,function(t){var n;return t&&t.state?(n=t.state,t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=1&n.wrap),n.mode=qH,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(bme),n.distcode=n.distdyn=new Int32Array(Sme),n.sane=1,n.back=-1,bm):bl}(i)):bl}function Ame(i,e){var t,n;return i?(n=new wme,i.state=n,n.window=null,t=function(r,s){var o,a;return r&&r.state?(a=r.state,s<0?(o=0,s=-s):(o=1+(s>>4),s<48&&(s&=15)),s&&(s<8||s>15)?bl:(a.window!==null&&a.wbits!==s&&(a.window=null),a.wrap=o,a.wbits=s,Mme(r))):bl}(i,e),t!==bm&&(i.state=null),t):bl}var pE,mE,ZO=!0;function Eme(i){if(ZO){var e;for(pE=new Int32Array(512),mE=new Int32Array(32),e=0;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(F0(jH,i.lens,0,288,pE,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;F0(XH,i.lens,0,32,mE,0,i.work,{bits:5}),ZO=!1}i.lencode=pE,i.lenbits=9,i.distcode=mE,i.distbits=5}function YH(i,e,t,n){var r,s=i.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(Xp(s.window,e,t-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((r=s.wsize-s.wnext)>n&&(r=n),Xp(s.window,e,t-n,r,s.wnext),(n-=r)?(Xp(s.window,e,t-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0}function Tme(i,e){var t,n,r,s,o,a,l,c,u,h,d,f,p,_,v,g,b,m,y,A,w,M,T,E,C=0,N=new Uint8Array(4),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!i||!i.state||!i.output||!i.input&&i.avail_in!==0)return bl;(t=i.state).mode===Zl&&(t.mode=13),o=i.next_out,r=i.output,l=i.avail_out,s=i.next_in,n=i.input,a=i.avail_in,c=t.hold,u=t.bits,h=a,d=l,M=bm;e:for(;;)switch(t.mode){case qH:if(t.wrap===0){t.mode=13;break}for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(2&t.wrap&&c===35615){t.check=0,N[0]=255&c,N[1]=c>>>8&255,t.check=il(t.check,N,2,0),c=0,u=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&c)<<8)+(c>>8))%31){i.msg="incorrect header check",t.mode=vi;break}if((15&c)!=8){i.msg="unknown compression method",t.mode=vi;break}if(u-=4,w=8+(15&(c>>>=4)),t.wbits===0)t.wbits=w;else if(w>t.wbits){i.msg="invalid window size",t.mode=vi;break}t.dmax=1<<w,i.adler=t.check=1,t.mode=512&c?10:Zl,c=0,u=0;break;case 2:for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(t.flags=c,(255&t.flags)!=8){i.msg="unknown compression method",t.mode=vi;break}if(57344&t.flags){i.msg="unknown header flags set",t.mode=vi;break}t.head&&(t.head.text=c>>8&1),512&t.flags&&(N[0]=255&c,N[1]=c>>>8&255,t.check=il(t.check,N,2,0)),c=0,u=0,t.mode=3;case 3:for(;u<32;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.head&&(t.head.time=c),512&t.flags&&(N[0]=255&c,N[1]=c>>>8&255,N[2]=c>>>16&255,N[3]=c>>>24&255,t.check=il(t.check,N,4,0)),c=0,u=0,t.mode=4;case 4:for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.head&&(t.head.xflags=255&c,t.head.os=c>>8),512&t.flags&&(N[0]=255&c,N[1]=c>>>8&255,t.check=il(t.check,N,2,0)),c=0,u=0,t.mode=5;case 5:if(1024&t.flags){for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.length=c,t.head&&(t.head.extra_len=c),512&t.flags&&(N[0]=255&c,N[1]=c>>>8&255,t.check=il(t.check,N,2,0)),c=0,u=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((f=t.length)>a&&(f=a),f&&(t.head&&(w=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Array(t.head.extra_len)),Xp(t.head.extra,n,s,f,w)),512&t.flags&&(t.check=il(t.check,n,f,s)),a-=f,s+=f,t.length-=f),t.length))break e;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(a===0)break e;f=0;do w=n[s+f++],t.head&&w&&t.length<65536&&(t.head.name+=String.fromCharCode(w));while(w&&f<a);if(512&t.flags&&(t.check=il(t.check,n,f,s)),a-=f,s+=f,w)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(a===0)break e;f=0;do w=n[s+f++],t.head&&w&&t.length<65536&&(t.head.comment+=String.fromCharCode(w));while(w&&f<a);if(512&t.flags&&(t.check=il(t.check,n,f,s)),a-=f,s+=f,w)break e}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(c!==(65535&t.check)){i.msg="header crc mismatch",t.mode=vi;break}c=0,u=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=Zl;break;case 10:for(;u<32;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}i.adler=t.check=KO(c),c=0,u=0,t.mode=11;case 11:if(t.havedict===0)return i.next_out=o,i.avail_out=l,i.next_in=s,i.avail_in=a,t.hold=c,t.bits=u,2;i.adler=t.check=1,t.mode=Zl;case Zl:case 13:if(t.last){c>>>=7&u,u-=7&u,t.mode=27;break}for(;u<3;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}switch(t.last=1&c,u-=1,3&(c>>>=1)){case 0:t.mode=14;break;case 1:Eme(t),t.mode=20;break;case 2:t.mode=17;break;case 3:i.msg="invalid block type",t.mode=vi}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){i.msg="invalid stored block lengths",t.mode=vi;break}t.length=65535&c,c=0,u=0,t.mode=15;case 15:t.mode=16;case 16:if(f=t.length){if(f>a&&(f=a),f>l&&(f=l),f===0)break e;Xp(r,n,s,f,o),a-=f,s+=f,l-=f,o+=f,t.length-=f;break}t.mode=Zl;break;case 17:for(;u<14;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(t.nlen=257+(31&c),c>>>=5,u-=5,t.ndist=1+(31&c),c>>>=5,u-=5,t.ncode=4+(15&c),c>>>=4,u-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=vi;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;u<3;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.lens[P[t.have++]]=7&c,c>>>=3,u-=3}for(;t.have<19;)t.lens[P[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,T={bits:t.lenbits},M=F0(0,t.lens,0,19,t.lencode,0,t.work,T),t.lenbits=T.bits,M){i.msg="invalid code lengths set",t.mode=vi;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;g=(C=t.lencode[c&(1<<t.lenbits)-1])>>>16&255,b=65535&C,!((v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(b<16)c>>>=v,u-=v,t.lens[t.have++]=b;else{if(b===16){for(E=v+2;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(c>>>=v,u-=v,t.have===0){i.msg="invalid bit length repeat",t.mode=vi;break}w=t.lens[t.have-1],f=3+(3&c),c>>>=2,u-=2}else if(b===17){for(E=v+3;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}u-=v,w=0,f=3+(7&(c>>>=v)),c>>>=3,u-=3}else{for(E=v+7;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}u-=v,w=0,f=11+(127&(c>>>=v)),c>>>=7,u-=7}if(t.have+f>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=vi;break}for(;f--;)t.lens[t.have++]=w}}if(t.mode===vi)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=vi;break}if(t.lenbits=9,T={bits:t.lenbits},M=F0(jH,t.lens,0,t.nlen,t.lencode,0,t.work,T),t.lenbits=T.bits,M){i.msg="invalid literal/lengths set",t.mode=vi;break}if(t.distbits=6,t.distcode=t.distdyn,T={bits:t.distbits},M=F0(XH,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,T),t.distbits=T.bits,M){i.msg="invalid distances set",t.mode=vi;break}t.mode=20;case 20:t.mode=21;case 21:if(a>=6&&l>=258){i.next_out=o,i.avail_out=l,i.next_in=s,i.avail_in=a,t.hold=c,t.bits=u,gme(i,d),o=i.next_out,r=i.output,l=i.avail_out,s=i.next_in,n=i.input,a=i.avail_in,c=t.hold,u=t.bits,t.mode===Zl&&(t.back=-1);break}for(t.back=0;g=(C=t.lencode[c&(1<<t.lenbits)-1])>>>16&255,b=65535&C,!((v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(g&&!(240&g)){for(m=v,y=g,A=b;g=(C=t.lencode[A+((c&(1<<m+y)-1)>>m)])>>>16&255,b=65535&C,!(m+(v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}c>>>=m,u-=m,t.back+=m}if(c>>>=v,u-=v,t.back+=v,t.length=b,g===0){t.mode=26;break}if(32&g){t.back=-1,t.mode=Zl;break}if(64&g){i.msg="invalid literal/length code",t.mode=vi;break}t.extra=15&g,t.mode=22;case 22:if(t.extra){for(E=t.extra;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.length+=c&(1<<t.extra)-1,c>>>=t.extra,u-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;g=(C=t.distcode[c&(1<<t.distbits)-1])>>>16&255,b=65535&C,!((v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(!(240&g)){for(m=v,y=g,A=b;g=(C=t.distcode[A+((c&(1<<m+y)-1)>>m)])>>>16&255,b=65535&C,!(m+(v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}c>>>=m,u-=m,t.back+=m}if(c>>>=v,u-=v,t.back+=v,64&g){i.msg="invalid distance code",t.mode=vi;break}t.offset=b,t.extra=15&g,t.mode=24;case 24:if(t.extra){for(E=t.extra;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.offset+=c&(1<<t.extra)-1,c>>>=t.extra,u-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=vi;break}t.mode=25;case 25:if(l===0)break e;if(f=d-l,t.offset>f){if((f=t.offset-f)>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=vi;break}f>t.wnext?(f-=t.wnext,p=t.wsize-f):p=t.wnext-f,f>t.length&&(f=t.length),_=t.window}else _=r,p=o-t.offset,f=t.length;f>l&&(f=l),l-=f,t.length-=f;do r[o++]=_[p++];while(--f);t.length===0&&(t.mode=21);break;case 26:if(l===0)break e;r[o++]=t.length,l--,t.mode=21;break;case 27:if(t.wrap){for(;u<32;){if(a===0)break e;a--,c|=n[s++]<<u,u+=8}if(d-=l,i.total_out+=d,t.total+=d,d&&(i.adler=t.check=t.flags?il(t.check,r,d,o-d):sP(t.check,r,d,o-d)),d=l,(t.flags?c:KO(c))!==t.check){i.msg="incorrect data check",t.mode=vi;break}c=0,u=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;u<32;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(c!==(4294967295&t.total)){i.msg="incorrect length check",t.mode=vi;break}c=0,u=0}t.mode=29;case 29:M=1;break e;case vi:M=-3;break e;case 31:return-4;default:return bl}return i.next_out=o,i.avail_out=l,i.next_in=s,i.avail_in=a,t.hold=c,t.bits=u,(t.wsize||d!==i.avail_out&&t.mode<vi&&(t.mode<27||e!==4))&&YH(i,i.output,i.next_out,d-i.avail_out),h-=i.avail_in,d-=i.avail_out,i.total_in+=h,i.total_out+=d,t.total+=d,t.wrap&&d&&(i.adler=t.check=t.flags?il(t.check,r,d,i.next_out-d):sP(t.check,r,d,i.next_out-d)),i.data_type=t.bits+(t.last?64:0)+(t.mode===Zl?128:0)+(t.mode===20||t.mode===15?256:0),(h===0&&d===0||e===4)&&M===bm&&(M=-5),M}function Cme(i,e){var t,n=e.length;return i&&i.state?(t=i.state).wrap!==0&&t.mode!==11?bl:t.mode===11&&sP(1,e,n,0)!==t.check?-3:YH(i,e,n,n)?(t.mode=31,-4):(t.havedict=1,bm):bl}var KH=!0,ZH=!0;try{String.fromCharCode.apply(null,[0])}catch{KH=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ZH=!1}for(var A1=new Uint8Array(256),ru=0;ru<256;ru++)A1[ru]=ru>=252?6:ru>=248?5:ru>=240?4:ru>=224?3:ru>=192?2:1;function Pme(i){var e,t,n,r,s,o=i.length,a=0;for(r=0;r<o;r++)(64512&(t=i.charCodeAt(r)))==55296&&r+1<o&&(64512&(n=i.charCodeAt(r+1)))==56320&&(t=65536+(t-55296<<10)+(n-56320),r++),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),s=0,r=0;s<a;r++)(64512&(t=i.charCodeAt(r)))==55296&&r+1<o&&(64512&(n=i.charCodeAt(r+1)))==56320&&(t=65536+(t-55296<<10)+(n-56320),r++),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|63&t):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|63&t):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|63&t);return e}function Rme(i,e){var t,n,r,s,o=e||i.length,a=new Array(2*o);for(n=0,t=0;t<o;)if((r=i[t++])<128)a[n++]=r;else if((s=A1[r])>4)a[n++]=65533,t+=s-1;else{for(r&=s===2?31:s===3?15:7;s>1&&t<o;)r=r<<6|63&i[t++],s--;s>1?a[n++]=65533:r<65536?a[n++]=r:(r-=65536,a[n++]=55296|r>>10&1023,a[n++]=56320|1023&r)}return function(l,c){if(c<65537&&(l.subarray&&ZH||!l.subarray&&KH))return String.fromCharCode.apply(null,WH(l,c));for(var u="",h=0;h<c;h++)u+=String.fromCharCode(l[h]);return u}(a,n)}function Ime(i,e){var t;for((e=e||i.length)>i.length&&(e=i.length),t=e-1;t>=0&&(192&i[t])==128;)t--;return t<0||t===0?e:t+A1[i[t]]>e?t:e}A1[254]=A1[254]=1;var ap=0,Lme={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Dme(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Nme(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var QO=Object.prototype.toString;function Ip(i){if(!(this instanceof Ip))return new Ip(i);this.options=function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var c in l)l.hasOwnProperty(c)&&(o[c]=l[c])}}return o}({chunkSize:16384,windowBits:0,to:""},i||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||i&&i.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Dme,this.strm.avail_out=0;var t,n,r,s=Ame(this.strm,e.windowBits);if(s!==ap)throw new Error(Lme[s]);this.header=new Nme,t=this.strm,n=this.header,t&&t.state&&2&(r=t.state).wrap&&(r.head=n,n.done=!1)}Ip.prototype.push=function(i,e){var t,n,r,s,o,a,l=this.strm,c=this.options.chunkSize,u=this.options.dictionary,h=!1;if(this.ended)return!1;n=e===~~e?e:e===!0?4:0,typeof i=="string"?l.input=function(d){for(var f=new Uint8Array(d.length),p=0,_=f.length;p<_;p++)f[p]=d.charCodeAt(p);return f}(i):QO.call(i)==="[object ArrayBuffer]"?l.input=new Uint8Array(i):l.input=i,l.next_in=0,l.avail_in=l.input.length;do{if(l.avail_out===0&&(l.output=new Uint8Array(c),l.next_out=0,l.avail_out=c),(t=Tme(l,0))===2&&u&&(a=typeof u=="string"?Pme(u):QO.call(u)==="[object ArrayBuffer]"?new Uint8Array(u):u,t=Cme(this.strm,a)),t===-5&&h===!0&&(t=ap,h=!1),t!==1&&t!==ap)return this.onEnd(t),this.ended=!0,!1;l.next_out&&(l.avail_out!==0&&t!==1&&(l.avail_in!==0||n!==4&&n!==2)||(this.options.to==="string"?(r=Ime(l.output,l.next_out),s=l.next_out-r,o=Rme(l.output,r),l.next_out=s,l.avail_out=c-s,s&&Xp(l.output,l.output,r,s,0),this.onData(o)):this.onData(WH(l.output,l.next_out)))),l.avail_in===0&&l.avail_out===0&&(h=!0)}while((l.avail_in>0||l.avail_out===0)&&t!==1);return t===1&&(n=4),n===4?(t=function(d){if(!d||!d.state)return bl;var f=d.state;return f.window&&(f.window=null),d.state=null,bm}(this.strm),this.onEnd(t),this.ended=!0,t===ap):n!==2||(this.onEnd(ap),l.avail_out=0,!0)},Ip.prototype.onData=function(i){this.chunks.push(i)},Ip.prototype.onEnd=function(i){i===ap&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=function(e){var t,n,r,s,o,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),s=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,s),s+=o.length;return a}(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg},v3.add("gz",function(i){let e;i instanceof ArrayBuffer&&(i=new Uint8Array(i));try{e=function(t,n){var r=new Ip(n);if(r.push(t,!0),r.err)throw r.msg;return r.result}(i)}catch{e=i}return e});class nv{}const JO="https:";Lu.add("rcsb",new class extends nv{getUrl(i){const e=io(i),t=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);return!["pdb","cif"].includes(e.ext)||e.compressed!==!1&&e.compressed!=="gz"?(e.ext==="mmtf"&&(tt.warn(`MMTF files distribution has been discontinued by RCSB PDB as of July 2024.
 Defaulting to bcif format instead. See https://www.rcsb.org/news/65a1af31c76ca3abcc925d0c for the deprecation notice`),e.base.endsWith(".bb")&&tt.warn("Backbone only files are not available from RCSB PDB anymore."),e.ext=""),e.ext?tt.warn("unsupported ext",e.ext):tt.warn(`mmCif files available from RCSB PDB lack connectivity information.
 Consider using PDBe as the data provider for using "Updated mmCif files" that contain residues connectivity records.`),JO+"//models.rcsb.org/"+t+".bcif.gz"):JO+"//files.rcsb.org/download/"+e.path}getExt(i){return io(i).ext||"bcif"}});const Xg="//www.ebi.ac.uk/pdbe/entry-files/download/";Lu.add("pdbe",new class extends nv{getUrl(i){const e=io(i);let t,n=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);switch(e.ext){case"cif":t=Xg+n+"_updated.cif";break;case"pdb":case"ent":n.startsWith("pdb")||(n="pdb"+n),t=Xg+n+".ent";break;case"bcif":t=Xg+e.path;break;case"":t=Xg+n+".bcif";break;default:tt.warn("unsupported ext",e.ext),t=Xg+n+".bcif"}return"https://"+t}getExt(i){return io(i).ext||"bcif"}});const e5="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",t5="/SDF?record_type=3d";Lu.add("pubchem",new class extends nv{getUrl(i){const e=io(i),t=e.name;let n;return e.ext&&e.ext!=="sdf"&&tt.warn("unsupported ext",e.ext),n=e5+t+t5,function(){const r=window.location.protocol;return r.match(/http(s)?:/gi)===null?"http:":r}()+n}getExt(i){return io(i).ext||"sdf"}});class gE extends nv{getUrl(e){return e}getExt(e){return io(e).ext}}Lu.add("ftp",new gE),Lu.add("http",new gE),Lu.add("https",new gE);const n5="//alphafold.ebi.ac.uk/files/AF-",i5="-F1-model_v4.pdb";Lu.add("alphafold",new class extends nv{getUrl(i){const e=io(i),t=e.name;let n;return e.ext&&e.ext!=="pdb"&&tt.warn("unsupported AF ext",e.ext),n=n5+t+i5,"https://"+n}getExt(i){return io(i).ext||"pdb"}});function qg(...i){return{type:"select",options:i.reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:t}),{})}}qg("auto","low","medium","high"),qg("scene","camera"),qg("relative","absolute"),qg("perspective","orthographic","stereo"),qg(...Object.keys(KV));function Fme(i){if(i.startsWith("rcsb://")||i.startsWith("pdb://"))return i.split("//")[1].toUpperCase();const e=i.match(/\/(\w{4})\.(pdb|cif)$/i);return e?e[1].toUpperCase():null}const kme=({cifUrl:i})=>{const e=Re.useRef(null),t=Re.useRef(null),[n,r]=Re.useState(!0),[s,o]=Re.useState(null),[a,l]=Re.useState(!1);return Re.useEffect(()=>{const c=window.location.search.includes("vr=true")||document.querySelector('canvas[data-engine="three.js"]')!==null;l(c)},[]),Re.useEffect(()=>{if(!e.current)return;r(!0),o(null);const c=new fH(e.current,{backgroundColor:a?"transparent":"white",quality:"high",impostor:!0});t.current=c;const u=()=>{c.handleResize()};if(window.addEventListener("resize",u),i){console.log("Loading structure from URL:",i);const h=Fme(i);(async()=>{try{let d;if(h){try{if(console.log(`Loading PDB ID ${h} using rcsb:// protocol`),d=await c.loadFile(`rcsb://${h}`,{defaultRepresentation:!1}),d.addRepresentation("cartoon",{colorScheme:"chainname",quality:a?"high":"medium",aspectRatio:2,smoothSheet:!0}),d.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric",quality:a?"high":"medium"}),c.autoView(),a){c.viewerControls.zoom(.8);const f=d.structure?d.structure.center:new Te(0,0,0);c.viewerControls.center(f)}r(!1);return}catch(f){console.warn("Failed to load with rcsb protocol:",f)}try{if(console.log(`Loading PDB ID ${h} using pdb:// protocol`),d=await c.loadFile(`pdb://${h}`,{defaultRepresentation:!1}),d.addRepresentation("cartoon",{colorScheme:"chainname",quality:a?"high":"medium",aspectRatio:2}),d.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),c.autoView(),a){c.viewerControls.zoom(.8);const f=d.structure?d.structure.center:new Te(0,0,0);c.viewerControls.center(f)}r(!1);return}catch(f){console.warn("Failed to load with pdb protocol:",f)}}try{if(console.log("Loading structure directly from URL:",i),d=await c.loadFile(i,{defaultRepresentation:!1}),d.addRepresentation("cartoon",{colorScheme:"chainname",quality:a?"high":"medium",aspectRatio:2}),d.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),c.autoView(),a){c.viewerControls.zoom(.8);const f=d.structure?d.structure.center:new Te(0,0,0);c.viewerControls.center(f)}r(!1);return}catch(f){console.warn("Direct URL loading failed:",f)}if(console.log("Loading fallback example structure (1CRN)"),d=await c.loadFile("rcsb://1CRN",{defaultRepresentation:!1}),d.addRepresentation("cartoon",{colorScheme:"chainname",quality:a?"high":"medium",aspectRatio:2}),d.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),c.autoView(),a){c.viewerControls.zoom(.8);const f=d.structure?d.structure.center:new Te(0,0,0);c.viewerControls.center(f)}r(!1),o("Using example protein (1CRN) for demonstration. The requested protein could not be loaded.")}catch(d){console.error("All loading attempts failed:",d),o("Failed to load any protein structure. Please check your network connection or try a different PDB ID."),r(!1)}})()}return()=>{window.removeEventListener("resize",u),t.current&&(t.current.dispose(),t.current=null)}},[i,a]),_e.jsxs("div",{className:"relative w-full h-full rounded-lg overflow-hidden border-2 border-sky-500/30",children:[n&&_e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-70 z-10",children:_e.jsxs("div",{className:"text-white text-center",children:[_e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-sky-500 mx-auto mb-4"}),_e.jsx("p",{children:"Loading protein structure..."})]})}),s&&_e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-70 z-10",children:_e.jsxs("div",{className:"text-white text-center max-w-md p-4",children:[_e.jsx("div",{className:"text-red-500 text-3xl mb-2",children:""}),_e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Error"}),_e.jsx("p",{children:s}),_e.jsx("p",{className:"mt-4 text-sm text-gray-400",children:"Try a different protein or check the URL format"})]})}),_e.jsx("div",{ref:e,className:"w-full h-full"})]})};function Ume(i){if(i.startsWith("rcsb://")||i.startsWith("pdb://"))return i.split("//")[1].toUpperCase();const e=i.match(/\/(\w{4})\.(pdb|cif)$/i);return e?e[1].toUpperCase():null}function Ome({cifUrl:i,position:e=[0,0,0],rotation:t=[0,0,0],scale:n=1,interactive:r=!0}){const s=Re.useRef(null),o=Re.useRef(null),a=Re.useRef(null),l=Re.useRef(null),[c,u]=Re.useState(!0),[h,d]=Re.useState(null),[f,p]=Re.useState(!1),[_,v]=Re.useState(!1),[g,b]=Re.useState(t),[m,y]=Re.useState(n),A=Re.useCallback(()=>{v(Z=>!Z)},[]),w=Re.useRef(r),M=Re.useRef(.005),T=Re.useRef(t),E=Re.useCallback(()=>{s.current&&s.current.rotation.set(T.current[0],T.current[1],T.current[2])},[]);Re.useEffect(()=>{if(!a.current){const Z=document.createElement("canvas");Z.width=1024,Z.height=1024,Z.style.display="none",document.body.appendChild(Z),a.current=Z;const le=new Ad(Z);le.needsUpdate=!0,o.current=le}return()=>{a.current&&(document.body.removeChild(a.current),a.current=null)}},[]),Re.useEffect(()=>{if(!a.current)return;u(!0),d(null);const Z=new fH(a.current,{backgroundColor:"transparent",quality:"high",impostor:!0});if(l.current=Z,i){console.log("Loading structure from URL:",i);const le=Ume(i);(async()=>{try{let re;if(le){try{console.log(`Loading PDB ID ${le} using rcsb:// protocol`),re=await Z.loadFile(`rcsb://${le}`,{defaultRepresentation:!1}),re.addRepresentation("cartoon",{colorScheme:"chainname",quality:"high",aspectRatio:2,smoothSheet:!0}),re.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric",quality:"high"}),Z.autoView(),u(!1);return}catch(se){console.warn("Failed to load with rcsb protocol:",se)}try{console.log(`Loading PDB ID ${le} using pdb:// protocol`),re=await Z.loadFile(`pdb://${le}`,{defaultRepresentation:!1}),re.addRepresentation("cartoon",{colorScheme:"chainname",quality:"high",aspectRatio:2}),re.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),Z.autoView(),u(!1);return}catch(se){console.warn("Failed to load with pdb protocol:",se)}}try{console.log("Loading structure directly from URL:",i),re=await Z.loadFile(i,{defaultRepresentation:!1}),re.addRepresentation("cartoon",{colorScheme:"chainname",quality:"high",aspectRatio:2}),re.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),Z.autoView(),u(!1);return}catch(se){console.warn("Direct URL loading failed:",se)}console.log("Loading fallback example structure (1CRN)"),re=await Z.loadFile("rcsb://1CRN",{defaultRepresentation:!1}),re.addRepresentation("cartoon",{colorScheme:"chainname"}),re.addRepresentation("ball+stick",{sele:"hetero and not water"}),l.current.autoView(),console.log("Protein loaded successfully"),u(!1),p(!0),d("Using example protein (1CRN) for demonstration.")}catch(re){console.error("All loading attempts failed:",re),d("Failed to load any protein structure."),u(!1)}})()}return()=>{l.current&&(l.current.dispose(),l.current=null)}},[i]),no(()=>{o.current&&!c&&l.current&&(l.current.viewer.requestRender(),o.current.needsUpdate=!0)}),no((Z,le)=>{r&&w.current&&s.current&&b(re=>[re[0],re[1]+M.current,re[2]])});const C=_F("right"),N=_F("left"),[P,L]=Re.useState(!1),[R,F]=Re.useState(!1),[V,G]=Re.useState(!1),U=Re.useRef(null);Re.useEffect(()=>{if(C){const Z=()=>{L(!0),w.current=!w.current,console.log("Auto-rotation toggled via right controller:",w.current),G(!0),U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{G(!1)},500)},le=()=>{L(!1)};return C.controller.addEventListener("selectstart",Z),C.controller.addEventListener("selectend",le),()=>{C.controller.removeEventListener("selectstart",Z),C.controller.removeEventListener("selectend",le),U.current&&clearTimeout(U.current)}}},[C]);const[z,O]=Re.useState(!1),D=Re.useRef(null);Re.useEffect(()=>{if(N){const Z=()=>{F(!0),O(!0),D.current&&clearTimeout(D.current)},le=()=>{F(!1),D.current=setTimeout(()=>{O(!1)},500)};return N.controller.addEventListener("selectstart",Z),N.controller.addEventListener("selectend",le),()=>{N.controller.removeEventListener("selectstart",Z),N.controller.removeEventListener("selectend",le),D.current&&clearTimeout(D.current)}}},[N]),no(()=>{var Z;if(N&&R){const le=(Z=N.inputSource)==null?void 0:Z.gamepad;if(le&&le.axes.length>=2){const re=le.axes[1];M.current=.001+(1-re)*.01,console.log("Rotation speed adjusted:",M.current)}}});const B=Re.useMemo(()=>window.location.search.includes("debug=true"),[]),W=({position:Z})=>_e.jsx(dne,{args:[.5,.5,.5],position:Z,visible:!0,"material-wireframe":!0,"material-color":"#ff0000","material-transparent":!0,"material-opacity":.5}),q=()=>{const{scene:Z,raycaster:le,camera:re,gl:se}=Ci(),$=Re.useRef(null),[fe,xe]=Re.useState(!1),Ie=ge=>{if(!$.current)return;const Oe=new yt;Oe.x=ge.clientX/se.domElement.clientWidth*2-1,Oe.y=-(ge.clientY/se.domElement.clientHeight)*2+1,le.setFromCamera(Oe,re),le.intersectObject($.current,!0).length>0&&(w.current=!w.current,console.log("Auto-rotation toggled via click:",w.current))};return Re.useEffect(()=>(se.domElement.addEventListener("click",Ie),()=>{se.domElement.removeEventListener("click",Ie)}),[se.domElement,re,le]),Re.useEffect(()=>{if(!$.current){const ge=new To;ge.position.set(e[0],e[1],e[2]),ge.rotation.set(g[0],g[1],g[2]),ge.scale.set(m,m,m),Z.add(ge),$.current=ge,s.current=ge}return()=>{$.current&&(Z.remove($.current),$.current=null)}},[Z]),Re.useEffect(()=>{$.current&&($.current.rotation.set(g[0],g[1],g[2]),$.current.scale.set(m,m,m))},[g,m]),Re.useEffect(()=>{if(l.current&&!c&&!h&&$.current&&!fe){console.log("Initializing direct NGL to Three.js integration");const ge=l.current.viewer;if(!ge||!ge.renderer||!ge.renderer.domElement){console.error("NGL viewer or renderer not available");return}try{const Me=l.current.compList;if(!Me||Me.length===0){console.error("No components found in NGL stage");return}console.log("NGL components found:",Me.length),B&&Me.forEach((Y,Q)=>{console.log(`Component ${Q} details:`,{name:Y.name,structureType:Y.structure?Y.structure.type:"unknown",atomCount:Y.structure?Y.structure.atomCount:0,reprCount:Y.reprList?Y.reprList.length:0})}),Me.forEach((Y,Q)=>{const de=Y.reprList;console.log(`Component ${Q} has ${de.length} representations`),de.forEach((Le,ie)=>{const K=Le.bufferList;console.log(`Representation ${ie} has ${K.length} buffers`),K.forEach((be,Ue)=>{try{if(be.geometry)try{const ve=new mn;if(be.geometry.attributes.position)try{const Ee=be.geometry.attributes.position.array;if(Ee&&Ee.length>0)ve.setAttribute("position",new An(new Float32Array(Ee),3));else{console.warn("Position attribute has invalid or empty array");return}}catch(Ee){console.error("Error copying position attribute:",Ee);return}else{console.warn("Buffer geometry missing position attribute");return}if(be.geometry.attributes.normal)try{const Ee=be.geometry.attributes.normal.array;Ee&&Ee.length>0&&ve.setAttribute("normal",new An(new Float32Array(Ee),3))}catch(Ee){console.warn("Error copying normal attribute:",Ee)}if(be.geometry.attributes.color)try{const Ee=be.geometry.attributes.color.array;Ee&&Ee.length>0&&ve.setAttribute("color",new An(new Float32Array(Ee),3))}catch(Ee){console.warn("Error copying color attribute:",Ee)}if(be.geometry.index)try{const Ee=be.geometry.index.array;if(Ee&&Ee.length>0){const Ze=Array.from(Ee).map(Number);Math.max(...Ze)>65535?ve.setIndex(new An(new Uint32Array(Ee),1)):ve.setIndex(new An(new Uint16Array(Ee),1))}}catch(Ee){console.warn("Error copying index attribute:",Ee)}be.geometry.attributes.normal||ve.computeVertexNormals(),ve.computeBoundingSphere(),ve.computeBoundingBox();let Ne;if(be.geometry.attributes.color)Ne=new so({vertexColors:!0,metalness:.1,roughness:.7,clearcoat:.2,clearcoatRoughness:.3,envMapIntensity:.5,side:cr});else{let Ee;try{Ee=Le.getParameters().color||new It(3447003)}catch(Ze){console.warn("Error getting representation color:",Ze),Ee=new It(3447003)}Ne=new so({color:Ee,metalness:.1,roughness:.7,clearcoat:.2,clearcoatRoughness:.3,envMapIntensity:.5,side:cr})}const $e=new Tn(ve,Ne);$e.name=`protein-${Q}-${ie}-${Ue}`,$e.userData.isProteinPart=!0,$e.userData.reprType=Le.name,$e.castShadow=!0,$e.receiveShadow=!0,$.current&&($.current.add($e),console.log(`Added protein mesh ${$e.name} to group`)),window.location.search.includes("debug=true")&&console.log(`Mesh ${$e.name} details:`,{vertexCount:ve.attributes.position.count,triangleCount:ve.index?ve.index.count/3:ve.attributes.position.count/3,hasNormals:!!ve.attributes.normal,hasColors:!!ve.attributes.color,isIndexed:!!ve.index})}catch(ve){console.error(`Error creating mesh for buffer ${Ue}:`,ve)}}catch(ve){console.error(`Error processing buffer ${Ue}:`,ve)}})})}),xe(!0),console.log("Direct NGL integration complete")}catch(Oe){console.error("Error during direct NGL integration:",Oe)}}},[Z,c,h,fe]),null},j=()=>{const{scene:Z}=Ci();return Re.useEffect(()=>{if(!s.current){const le=new Va(5,5),re=o.current?new fi({map:o.current,transparent:!0,side:cr}):new fi({color:"white",transparent:!0,opacity:.5}),se=new Tn(le,re);se.position.set(e[0],e[1],e[2]),se.rotation.set(g[0],g[1],g[2]),se.scale.set(m,m,m),Z.add(se),s.current=se}return()=>{s.current&&(Z.remove(s.current),s.current.geometry&&s.current.geometry.dispose(),s.current.material instanceof ur?s.current.material.dispose():Array.isArray(s.current.material)&&s.current.material.forEach(le=>le.dispose()),s.current=null)}},[Z]),Re.useEffect(()=>{s.current&&o.current&&s.current.material instanceof fi&&(s.current.material.map=o.current,s.current.material.needsUpdate=!0)},[o.current]),Re.useEffect(()=>{s.current&&(s.current.rotation.set(g[0],g[1],g[2]),s.current.scale.set(m,m,m))},[g,m]),null},[te,ne]=Re.useState(w.current);return Re.useEffect(()=>{const Z=setInterval(()=>{te!==w.current&&ne(w.current)},100);return()=>clearInterval(Z)},[te]),_e.jsxs(_e.Fragment,{children:[_e.jsx(q,{}),!f&&_e.jsx(j,{}),B&&!c&&!h&&s.current&&_e.jsx(_e.Fragment,{children:_e.jsx(W,{position:e})}),!c&&!h&&_e.jsx(cu,{position:[e[0]+.5,e[1]+1.5,e[2]],transform:!0,children:_e.jsx("button",{onClick:A,style:{color:"white",backgroundColor:"rgba(0,0,255,0.7)",padding:"5px",borderRadius:"50%",width:"30px",height:"30px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",border:"none",cursor:"pointer",boxShadow:"0 0 5px rgba(255,255,255,0.5)",transition:"transform 0.2s ease-in-out"},onMouseOver:Z=>Z.currentTarget.style.transform="scale(1.1)",onMouseOut:Z=>Z.currentTarget.style.transform="scale(1)",children:"?"})}),!c&&!h&&_e.jsx(cu,{position:[e[0],e[1]+1.5,e[2]],transform:!0,children:_e.jsx("div",{style:{color:"white",backgroundColor:w.current?"rgba(0,128,0,0.7)":"rgba(128,0,0,0.7)",padding:"5px",borderRadius:"50%",width:"20px",height:"20px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",boxShadow:V?"0 0 15px 5px rgba(255,255,255,0.8)":"none",transition:"box-shadow 0.2s ease-in-out"},children:w.current?"":""})}),!c&&!h&&z&&_e.jsx(cu,{position:[e[0]-.5,e[1]+1.5,e[2]],transform:!0,children:_e.jsx("div",{style:{color:"white",backgroundColor:"rgba(0,0,255,0.7)",padding:"5px",borderRadius:"50%",width:"20px",height:"20px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",boxShadow:"0 0 15px 5px rgba(0,128,255,0.8)",animation:"pulse 1s infinite"},children:""})}),c&&_e.jsx(cu,{position:[e[0],e[1],e[2]+.1],transform:!0,children:_e.jsx("div",{style:{color:"white",backgroundColor:"rgba(0,0,0,0.7)",padding:"10px",borderRadius:"5px",width:"200px",textAlign:"center"},children:"Loading protein data..."})}),h&&_e.jsx(cu,{position:[e[0],e[1],e[2]+.1],transform:!0,children:_e.jsxs("div",{style:{color:"white",backgroundColor:"rgba(255,0,0,0.7)",padding:"10px",borderRadius:"5px",width:"200px",textAlign:"center"},children:["Error: ",h]})}),_&&!c&&!h&&_e.jsx(cu,{position:[e[0],e[1]-2,e[2]],transform:!0,children:_e.jsxs("div",{style:{color:"white",backgroundColor:"rgba(0,0,0,0.7)",padding:"10px",borderRadius:"5px",width:"200px",textAlign:"center"},children:[_e.jsx("h3",{style:{margin:"0 0 10px 0",fontSize:"16px"},children:"Protein Controls"}),_e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"10px"},children:[_e.jsx("button",{onClick:()=>{w.current=!w.current,ne(w.current)},style:{backgroundColor:w.current?"#4CAF50":"#f44336",color:"white",padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",flex:"1"},children:w.current?"Stop":"Start"}),_e.jsx("button",{onClick:E,style:{backgroundColor:"#2196F3",color:"white",padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",flex:"1"},children:"Reset"})]}),_e.jsxs("div",{style:{marginTop:"10px"},children:[_e.jsx("label",{style:{marginRight:"10px"},children:"Speed:"}),_e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[_e.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",defaultValue:M.current,onChange:Z=>M.current=parseFloat(Z.target.value),style:{width:"120px"}}),_e.jsx("div",{style:{marginLeft:"10px",width:"30px",height:"20px",backgroundColor:"rgba(255,255,255,0.2)",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px"},children:Math.round(M.current*1e3)})]})]}),_e.jsxs("div",{style:{marginTop:"15px",fontSize:"12px",color:"#aaa"},children:[_e.jsx("p",{style:{margin:"5px 0"},children:"Right controller trigger: Toggle rotation"}),_e.jsx("p",{style:{margin:"5px 0"},children:"Left controller trigger + move: Adjust speed"})]})]})})]})}function Bme(){const{scene:i}=Ci(),e=Re.useRef([]);return Re.useEffect(()=>{const t=new HR(16777215,.5),n=new US(16777215,1);return n.position.set(10,10,10),i.add(t),i.add(n),e.current=[t,n],()=>{e.current.forEach(r=>{i.remove(r)}),e.current=[]}},[i]),null}const zme=({onClose:i})=>{const[e,t]=Re.useState(""),[n,r]=Re.useState([]),[s,o]=Re.useState(null),[a,l]=Re.useState(!1),[c,u]=Re.useState(null),[h,d]=Re.useState(""),f=async()=>{if(e.trim()){l(!0),u(null),r([]);try{const m=await fetch("https://search.rcsb.org/rcsbsearch/v2/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:{type:"terminal",service:"text",parameters:{value:e}},return_type:"entry"})});if(!m.ok)throw new Error(`API request failed with status ${m.status}`);const y=await m.json();if(console.log("PDB search results:",y),!y.result_set||y.result_set.length===0){u("No results found for your query."),l(!1);return}const A=await Promise.all(y.result_set.slice(0,10).map(async w=>{var T,E,C;const M=w.identifier;if(!M)return console.error("Could not extract PDB ID from result item:",w),null;try{const N=await fetch(`https://data.rcsb.org/rest/v1/core/entry/${M}`);if(!N.ok)throw new Error(`Failed to get details for ${M}: ${N.status}`);const P=await N.json();return{identifier:M,title:((T=P.struct)==null?void 0:T.title)||`PDB ID: ${M}`,organism:((E=P.entity)==null?void 0:E.length)>0&&((C=P.entity[0].src)==null?void 0:C.length)>0?P.entity[0].src[0].organism_scientific:void 0}}catch(N){return console.warn(`Failed to get details for ${M}:`,N),{identifier:M,title:`PDB ID: ${M}`}}}).filter(Boolean));r(A)}catch(m){console.error("PDB search failed:",m),u(m instanceof Error?m.message:"An unknown error occurred.")}finally{l(!1)}}},p=m=>{const A=`rcsb://${m.identifier.trim().toUpperCase()}`;console.log("Loading PDB with protocol:",A),o({name:m.title,url:A})},_=async()=>{if(!h.trim())return;l(!0),u(null);const m=h.trim().toUpperCase();try{const y=await fetch(`https://data.rcsb.org/rest/v1/core/entry/${m}`);if(!y.ok){y.status===404?u(`PDB ID ${m} not found. Please check the ID and try again.`):u(`Error checking PDB ID: ${y.status}`),l(!1);return}const A=`rcsb://${m}`;console.log("Loading direct PDB with protocol:",A),o({name:`PDB ID: ${m}`,url:A}),l(!1)}catch(y){console.error("Error loading PDB ID:",y),u(`Failed to load PDB ID: ${y instanceof Error?y.message:"Unknown error"}`),l(!1)}},v=()=>{o(null),r([]),t(""),u(null)},[g,b]=Re.useState("2d");return s?_e.jsx(hm,{title:s.name,breadcrumbs:["Home","Visualise","Viewer"],onClose:i,children:_e.jsxs("div",{className:"w-full h-full flex flex-col items-center p-0 space-y-4",children:[_e.jsxs("div",{className:"absolute top-4 left-4 z-10 flex space-x-2",children:[_e.jsx(Pa,{onClick:v,variant:"secondary",className:"!text-sm !px-3 !py-1",children:"New Search"}),_e.jsx(Pa,{onClick:()=>b(g==="2d"?"vr":"2d"),variant:g==="vr"?"primary":"secondary",className:"!text-sm !px-3 !py-1",children:g==="2d"?"VR Mode":"2D Mode"})]}),g==="2d"?_e.jsx(kme,{cifUrl:s.url}):_e.jsxs("div",{className:"w-full h-full",children:[_e.jsx(gG,{className:"absolute top-4 right-4 z-10"}),_e.jsx("div",{className:"absolute top-4 left-4 z-10 flex gap-2",children:_e.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:()=>{const m=document.getElementById("vr-controls");m&&(m.style.display=m.style.display==="none"?"block":"none")},children:"Controls"})}),_e.jsxs("div",{id:"vr-controls",className:"absolute bottom-4 left-4 z-10 bg-black bg-opacity-70 p-4 rounded text-white",style:{display:"block"},children:[_e.jsx("h3",{className:"font-bold mb-2",children:"VR Controls"}),_e.jsxs("ul",{className:"list-disc pl-5",children:[_e.jsx("li",{children:"Auto-rotation is enabled by default"}),_e.jsx("li",{children:"Use the slider to adjust rotation speed"}),_e.jsx("li",{children:"Click the protein to toggle rotation on/off"}),_e.jsx("li",{children:"Use the Reset button to return to initial position"}),_e.jsx("li",{children:"Click the ? button to show/hide controls"}),_e.jsx("li",{className:"mt-2 font-bold",children:"VR Controller Actions:"}),_e.jsx("li",{children:"Right controller trigger: Toggle auto-rotation"}),_e.jsx("li",{children:"Left controller trigger + move: Adjust rotation speed"})]})]}),_e.jsx(uG,{className:"w-full h-full",children:_e.jsxs(fG,{children:[_e.jsx(Bme,{}),_e.jsx(Ome,{cifUrl:s.url,position:[0,1.5,-2],scale:.5,interactive:!0})]})})]})]})}):_e.jsx(hm,{title:"Add Entity",breadcrumbs:["Home","Visualise"],onClose:i,children:_e.jsxs("div",{className:"w-full max-w-3xl flex flex-col items-center p-4 space-y-4",children:[_e.jsx("h3",{className:"text-xl text-sky-200",children:"Search Protein Data Bank"}),_e.jsxs("div",{className:"relative w-full max-w-md flex space-x-2",children:[_e.jsx(hC,{placeholder:"Search by protein name (e.g., hemoglobin)...",className:"flex-grow",value:e,onChange:m=>t(m.target.value),onKeyDown:m=>m.key==="Enter"&&f()}),_e.jsx(Pa,{onClick:f,disabled:a,children:a?"...":_e.jsx(ute,{className:"w-5 h-5"})})]}),_e.jsxs("div",{className:"w-full h-64 mt-2 bg-slate-900/50 rounded-lg flex flex-col p-2 overflow-y-auto",children:[a&&_e.jsx("p",{className:"text-slate-400 m-auto",children:"Searching..."}),c&&_e.jsx("p",{className:"text-red-400 m-auto",children:c}),!a&&!c&&n.length>0&&_e.jsx("ul",{className:"space-y-2",children:n.map(m=>_e.jsxs("li",{className:"flex justify-between items-center p-2 rounded-md bg-slate-800 hover:bg-sky-900/50 transition-colors",children:[_e.jsxs("div",{className:"flex-grow mr-4 overflow-hidden",children:[_e.jsx("p",{className:"font-semibold text-white truncate",title:m.title,children:m.title}),m.organism&&_e.jsxs("p",{className:"text-sm text-slate-400 truncate",children:[m.organism," (",m.identifier,")"]}),!m.organism&&_e.jsxs("p",{className:"text-sm text-slate-400 truncate",children:["PDB ID: ",m.identifier]})]}),_e.jsx(Pa,{onClick:()=>p(m),size:"sm",children:"Load"})]},m.identifier))}),!a&&!c&&n.length===0&&_e.jsx("p",{className:"text-slate-500 m-auto",children:"Search results will appear here."})]}),_e.jsxs("div",{className:"flex items-center space-x-2 w-full max-w-md pt-2",children:[_e.jsx("hr",{className:"w-full border-slate-600"}),_e.jsx("span",{className:"text-slate-400",children:"OR"}),_e.jsx("hr",{className:"w-full border-slate-600"})]}),_e.jsxs("div",{className:"flex items-center space-x-4",children:[_e.jsx(hC,{placeholder:"Enter PDB ID (e.g., 1AKE)",value:h,onChange:m=>d(m.target.value),onKeyDown:m=>m.key==="Enter"&&_()}),_e.jsx(Pa,{onClick:_,children:"Load"})]})]})})},Gme=({onClose:i,distance:e,setDistance:t,yOffset:n,setYOffset:r})=>_e.jsx(hm,{title:"Settings",breadcrumbs:["Home","Settings"],onClose:i,children:_e.jsxs("div",{className:"w-full max-w-md flex flex-col items-center space-y-8 p-4",children:[_e.jsxs("div",{className:"w-full",children:[_e.jsxs("label",{htmlFor:"distance-slider",className:"text-xl text-slate-200 block text-center mb-2",children:["Page Distance: ",_e.jsx("span",{className:"font-bold text-sky-400 tabular-nums",children:e.toFixed(1)})]}),_e.jsx("input",{id:"distance-slider",type:"range",min:"2",max:"8",step:"0.1",value:e,onChange:s=>t(parseFloat(s.target.value)),className:"w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer range-lg [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:h-6 [&::-webkit-slider-thumb]:bg-sky-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:transition-all [&::-webkit-slider-thumb]:hover:bg-sky-400"}),_e.jsx("p",{className:"text-sm text-slate-400 text-center mt-2",children:"Adjust how far the UI panels appear from your viewpoint."})]}),_e.jsxs("div",{className:"w-full",children:[_e.jsxs("label",{htmlFor:"y-offset-slider",className:"text-xl text-slate-200 block text-center mb-2",children:["Vertical Offset: ",_e.jsx("span",{className:"font-bold text-sky-400 tabular-nums",children:n.toFixed(1)})]}),_e.jsx("input",{id:"y-offset-slider",type:"range",min:"-1.5",max:"1.5",step:"0.1",value:n,onChange:s=>r(parseFloat(s.target.value)),className:"w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer range-lg [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:h-6 [&::-webkit-slider-thumb]:bg-sky-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:transition-all [&::-webkit-slider-thumb]:hover:bg-sky-400"}),_e.jsx("p",{className:"text-sm text-slate-400 text-center mt-2",children:"Adjust the vertical position of the UI panels."})]})]})}),ws=({children:i})=>_e.jsx("code",{className:"px-2 py-1 bg-slate-700 text-sky-300 rounded-md font-mono text-base",children:i}),Vme=({onClose:i})=>_e.jsx(hm,{title:"Help & Instructions",breadcrumbs:["Home","Help"],onClose:i,children:_e.jsxs("div",{className:"w-full h-full flex flex-col md:flex-row gap-8 p-4 text-slate-200",children:[_e.jsxs("div",{className:"flex-1 bg-slate-800/50 p-6 rounded-lg",children:[_e.jsx("h2",{className:"text-2xl font-bold text-white mb-4 border-b-2 border-sky-500/50 pb-2",children:"Desktop Controls"}),_e.jsxs("ul",{className:"space-y-4 text-lg",children:[_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Move"}),_e.jsxs("div",{className:"flex gap-2",children:[_e.jsx(ws,{children:"W"}),_e.jsx(ws,{children:"A"}),_e.jsx(ws,{children:"S"}),_e.jsx(ws,{children:"D"})]})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Look Around"}),_e.jsx(ws,{children:"Click / T"})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Open/Close Menu"}),_e.jsx(ws,{children:"M"})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Go Back / Exit UI"}),_e.jsx(ws,{children:"Esc"})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Select Menu Item"}),_e.jsx(ws,{children:"Enter"})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Adjust UI Distance"}),_e.jsxs("div",{className:"flex gap-2",children:[_e.jsx(ws,{children:"Numpad 4"}),_e.jsx(ws,{children:"Numpad 6"})]})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Adjust UI Height"}),_e.jsxs("div",{className:"flex gap-2",children:[_e.jsx(ws,{children:"Numpad 2"}),_e.jsx(ws,{children:"Numpad 8"})]})]})]})]}),_e.jsxs("div",{className:"flex-1 bg-slate-800/50 p-6 rounded-lg",children:[_e.jsx("h2",{className:"text-2xl font-bold text-white mb-4 border-b-2 border-sky-500/50 pb-2",children:"VR Controls"}),_e.jsxs("ul",{className:"space-y-4 text-lg",children:[_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Move"}),_e.jsx(ws,{children:"Left Stick"})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Look Around"}),_e.jsx("span",{className:"text-slate-300",children:"Move Your Head"})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Open/Close Menu"}),_e.jsx(ws,{children:"Left 'Y' Button"})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Go Back / Exit UI"}),_e.jsx(ws,{children:"Right 'B' Button"})]}),_e.jsxs("li",{className:"flex items-center justify-between",children:[_e.jsx("span",{children:"Select Menu Item"}),_e.jsx("span",{className:"text-slate-300",children:"Point & Trigger"})]})]})]})]})}),vE=4.8,r5=6,Hme=({content:i,onClose:e,pageDistance:t,setPageDistance:n,pageYOffset:r,setPageYOffset:s})=>{const{camera:o}=Ci(),a=Re.useRef(null);no(()=>{if(a.current){const c=t,u=o.position.clone().add(o.getWorldDirection(new Te).multiplyScalar(c)),h=vE/2,d=Math.max(u.y,h+.2);u.y=d+r,a.current.position.lerp(u,.1),a.current.quaternion.slerp(o.quaternion,.1)}});let l;switch(i.id){case"visualise":l=_e.jsx(zme,{onClose:e});break;case"host-join":l=_e.jsx(Rne,{onClose:e});break;case"assessments":l=_e.jsx(Cne,{title:"Assessments",message:"Quizzes And Extra Related Content",onClose:e});break;case"settings":l=_e.jsx(Gme,{onClose:e,distance:t,setDistance:n,yOffset:r,setYOffset:s});break;case"help":l=_e.jsx(Vme,{onClose:e});break;default:l=_e.jsxs("div",{className:"text-white",children:[_e.jsx("h1",{className:"text-2xl",children:"Unknown Page"}),_e.jsx("button",{onClick:e,className:"mt-4 px-4 py-2 bg-sky-500 rounded",children:"Close"})]})}return _e.jsxs("group",{ref:a,children:[_e.jsxs("mesh",{children:[_e.jsx("planeGeometry",{args:[r5,vE]}),_e.jsx("meshStandardMaterial",{color:"#111827",side:cr,transparent:!0,opacity:0})]}),_e.jsx(cu,{transform:!0,occlude:!0,position:[0,0,.01],scale:.1,className:"bg-transparent text-white antialiased",style:{width:`${r5*10}rem`,height:`${vE*10}rem`},children:_e.jsx("div",{className:"w-full h-full select-none",children:l})})]})},$me=({onMenuToggle:i,onBack:e,onMenuSelect:t,onMove:n})=>{const{controllers:r,isPresenting:s,player:o,session:a}=Vi(),{scene:l}=Ci();Re.useRef(!1),Re.useRef(!1),Re.useRef(!1);const[c,u]=Re.useState(""),h=Re.useRef(void 0),[d,f]=Re.useState({left:!1,right:!1,leftType:"unknown",rightType:"unknown"}),p=Re.useRef({}),_=Re.useRef(null),v=Re.useRef([]),g=Re.useRef({}),b=Re.useCallback((A,w)=>{if(!A)return;const M=A.handedness||`controller-${w}`;Et.log(`Setting up listeners for ${M} controller`),p.current[M]=A,f(N=>({...N,[M]:!0}));const T=()=>{Et.log(`${M} controller: select pressed`),M==="right"&&t&&(Et.log("Select action triggered"),t())},E=()=>{Et.log(`${M} controller: squeeze pressed`),M==="right"&&(Et.log("Back action triggered"),e())};A.removeEventListener("selectstart",T),A.removeEventListener("squeezestart",E),A.addEventListener("selectstart",T),A.addEventListener("squeezestart",E),A._eventListeners=A._eventListeners||{},A._eventListeners.selectstart=T,A._eventListeners.squeezestart=E;const C=()=>{var N,P,L;if((N=A.inputSource)!=null&&N.gamepad){Et.log(`${M} controller gamepad connected`);const R=A.inputSource.gamepad;Et.log(`Gamepad: ${R.id||"unknown"}, buttons: ${((P=R.buttons)==null?void 0:P.length)||0}, axes: ${((L=R.axes)==null?void 0:L.length)||0}`)}else Et.log(`${M} controller has no gamepad yet`)};return C(),setTimeout(C,100),setTimeout(C,500),setTimeout(C,1e3),()=>{A&&A._eventListeners&&(A.removeEventListener("selectstart",A._eventListeners.selectstart),A.removeEventListener("squeezestart",A._eventListeners.squeezestart))}},[t,e]);Re.useEffect(()=>{if(!s||!a){f({left:!1,right:!1,leftType:"unknown",rightType:"unknown"}),v.current=[];return}Et.log("VR session active - monitoring for controllers");const A=setInterval(()=>{Et.log("Performing periodic controller check..."),M()},5e3),w=()=>{if(a)try{const C=a.inputSources;v.current=Array.from(C||[]),Et.log(`Direct WebXR: Found ${v.current.length} input sources`),v.current.forEach((N,P)=>{var R,F,V,G;const L=N.handedness||"unknown";if(Et.log(`Input source ${P}: ${L} hand, ${N.targetRayMode} mode`),N.gamepad){Et.log(`Gamepad found for ${L}: ${N.gamepad.id||"unknown"}, buttons: ${((R=N.gamepad.buttons)==null?void 0:R.length)||0}, axes: ${((F=N.gamepad.axes)==null?void 0:F.length)||0}`);const U=N.gamepad.buttons||[];for(let O=0;O<U.length;O++){const D=((V=U[O])==null?void 0:V.pressed)||!1,B=((G=U[O])==null?void 0:G.value)||0;D&&Et.log(`${L} controller button ${O} is pressed (value: ${B.toFixed(2)})`)}const z=N.gamepad.axes||[];z.length>0&&Et.log(`${L} controller axes: [${z.map(O=>(O==null?void 0:O.toFixed(2))||"0.00").join(", ")}]`)}else Et.log(`No gamepad for ${L} input source`)})}catch(C){Et.log(`Error accessing input sources: ${C.message}`)}},M=()=>{w();const C={left:!1,right:!1,leftType:"unknown",rightType:"unknown"};v.current.forEach(L=>{const R=L.handedness;(R==="left"||R==="right")&&(C[R]=!0)}),r.forEach((L,R)=>{const F=L.handedness||`controller-${R}`;(F==="left"||F==="right")&&(C[F]=!0),p.current[F]||b(L,R)});let N="unknown",P="unknown";if(v.current.length>0){const L=v.current.find(F=>F.handedness==="left"),R=v.current.find(F=>F.handedness==="right");L!=null&&L.gamepad&&(N=detectControllerType(L.gamepad)),R!=null&&R.gamepad&&(P=detectControllerType(R.gamepad))}f({...C,leftType:N,rightType:P}),Et.log(`Controller status: Left: ${C.left?"Connected":"Disconnected"}, Right: ${C.right?"Connected":"Disconnected"}`)};M(),_.current=window.setInterval(M,1e3);const T=C=>{Et.log(`Controller connected event: ${C.data.handedness||"unknown hand"}`),b(C.data,r.length)},E=C=>{const N=C.data.handedness||"unknown";Et.log(`Controller disconnected: ${N}`),f(P=>({...P,[N]:!1})),delete p.current[N]};return o&&o.addEventListener("controlleradded",T),Object.values(p.current).forEach(C=>{C&&C._eventListeners&&(C.removeEventListener("selectstart",C._eventListeners.selectstart),C.removeEventListener("squeezestart",C._eventListeners.squeezestart))}),a.addEventListener("inputsourceschange",C=>{Et.log("Input sources changed"),C.added&&C.added.length&&(Et.log(`${C.added.length} new input sources added`),C.added.forEach(N=>{N.gamepad&&Et.log(`Gamepad found for ${N.handedness}: ${N.gamepad.id||"unknown"}`)})),C.removed&&C.removed.length&&Et.log(`${C.removed.length} input sources removed`),w(),setTimeout(M,100)}),window.navigator&&window.navigator.xr?Et.log("Navigator XR API is available"):Et.log("Navigator XR API not found"),()=>{_.current&&window.clearInterval(_.current),A&&clearInterval(A),o&&(o.removeEventListener("controlleradded",T),o.removeEventListener("controllerremoved",E)),Object.values(p.current).forEach(C=>{C&&C._eventListeners&&(C.removeEventListener("selectstart",C._eventListeners.selectstart),C.removeEventListener("squeezestart",C._eventListeners.squeezestart))}),p.current={}}},[s,a,r,o,b]);const m=(A,w,M)=>{const T=`${A}-${w}`,E=g.current[T]||!1;return g.current[T]=M,M&&!E},y=Re.useRef(0);return no(()=>{var N,P,L,R,F,V,G,U;if(!s)return;const A=Date.now(),w=A-y.current>2e3;w&&(Et.log("Checking controller status..."),y.current=A);let M,T,E,C;if(v.current.length>0){const z=v.current.find(D=>D.handedness==="left"),O=v.current.find(D=>D.handedness==="right");z&&(w&&Et.log("Found left controller via WebXR API"),E=z.gamepad),O&&(w&&Et.log("Found right controller via WebXR API"),C=O.gamepad)}if(r.length>0&&(M=r.find(z=>z.handedness==="left"),T=r.find(z=>z.handedness==="right"),M&&w&&Et.log("Found left controller via react-three/xr"),T&&w&&Et.log("Found right controller via react-three/xr"),!E&&((N=M==null?void 0:M.inputSource)!=null&&N.gamepad)&&(E=M.inputSource.gamepad,w&&Et.log("Using left gamepad from react-three/xr")),!C&&((P=T==null?void 0:T.inputSource)!=null&&P.gamepad)&&(C=T.inputSource.gamepad,w&&Et.log("Using right gamepad from react-three/xr"))),(!E||!C)&&navigator.getGamepads)try{const z=navigator.getGamepads();if(z&&z.length>0)for(let O=0;O<z.length;O++){const D=z[O];if(D&&(D.id.includes("Oculus")||D.id.includes("Quest")||D.id.includes("VR")||D.id.includes("XR"))){const B=D.id.toLowerCase().includes("left"),W=D.id.toLowerCase().includes("right");B&&!E?(E=D,w&&Et.log(`Found left gamepad via navigator: ${D.id}`)):W&&!C?(C=D,w&&Et.log(`Found right gamepad via navigator: ${D.id}`)):!E&&!C&&(E=D,w&&Et.log(`Using unknown gamepad as left: ${D.id}`))}}}catch(z){w&&Et.log(`Error accessing gamepads: ${z.message}`)}if(!E&&!C&&!M&&!T){w&&Et.log("No controllers detected - using fallback controls");return}if(E){const z=E.buttons||[],O=E.axes||[];let D=0,B=0,W="none";if(O.length>=2&&(D=O[0]||0,B=O[1]||0,(Math.abs(D)>.1||Math.abs(B)>.1)&&(W="0,1")),W==="none"&&O.length>=4&&(D=O[2]||0,B=O[3]||0,(Math.abs(D)>.1||Math.abs(B)>.1)&&(W="2,3")),W==="none"&&O.length>=6&&(D=O[4]||0,B=O[5]||0,(Math.abs(D)>.1||Math.abs(B)>.1)&&(W="4,5")),W!=="none"){(Math.abs(D)>.5||Math.abs(B)>.5)&&Et.log(`Left stick (${W}): X:${D.toFixed(2)}, Y:${B.toFixed(2)}`),n&&n(D,B);const q=new CustomEvent("vr-movement",{detail:{x:D,y:B}});window.dispatchEvent(q),typeof window<"u"&&(window.vrMovement={x:D,y:B})}if(W==="none"&&z.length>=4){const q={up:[0,4,12],down:[1,5,13],left:[2,6,14],right:[3,7,15]};for(const j of q.up)if(j<z.length&&((L=z[j])!=null&&L.pressed)){B=-1,Et.log(`Button-based movement: Forward (button ${j})`);break}for(const j of q.down)if(j<z.length&&((R=z[j])!=null&&R.pressed)){B=1,Et.log(`Button-based movement: Backward (button ${j})`);break}for(const j of q.left)if(j<z.length&&((F=z[j])!=null&&F.pressed)){D=-1,Et.log(`Button-based movement: Left (button ${j})`);break}for(const j of q.right)if(j<z.length&&((V=z[j])!=null&&V.pressed)){D=1,Et.log(`Button-based movement: Right (button ${j})`);break}if(D!==0||B!==0){n&&n(D,B);const j=new CustomEvent("vr-movement",{detail:{x:D,y:B}});window.dispatchEvent(j),typeof window<"u"&&(window.vrMovement={x:D,y:B})}}if(z)for(let q=0;q<z.length;q++)(((G=z[q])==null?void 0:G.pressed)||!1)&&Et.log(`Left controller button ${q} is pressed`)}if(C){const z=C.buttons||[],O=d.rightType;let D=[0,2,4];O==="vive"?D=[0,1,3]:O==="index"?D=[0,1,4]:O==="wmr"&&(D=[0,2,7]),Et.log(`Using ${O} controller mapping for select buttons: ${D.join(", ")}`);for(const j of D)if(j<z.length&&z[j]){const te=z[j].pressed;if(m("right",j,te)&&(Et.log(`Right controller: Button ${j} pressed (select)`),t)){Et.log("Triggering menu select action"),t();break}}let B=[1,3,5];O==="vive"?B=[2,3,8]:O==="index"?B=[1,3,5]:O==="wmr"&&(B=[1,3,6]),Et.log(`Using ${O} controller mapping for back buttons: ${B.join(", ")}`);for(const j of B)if(j<z.length&&z[j]){const te=z[j].pressed;if(m("right",j,te)&&(Et.log(`Right controller: Button ${j} pressed (back)`),e)){Et.log("Triggering back action"),e();break}}const W=[6,7,2];for(const j of W)if(j<z.length&&z[j]){const te=z[j].value||0,ne=z[j].pressed||te>.7;if(m("right-trigger",j,ne)&&(Et.log(`Right controller: Trigger ${j} pressed (select)`),t)){Et.log("Triggering menu select action via trigger"),t();break}}const q=[8,9,1];for(const j of q)if(j<z.length&&z[j]){const te=z[j].value||0,ne=z[j].pressed||te>.7;if(m("right-grip",j,ne)&&(Et.log(`Right controller: Grip ${j} pressed (back)`),e)){Et.log("Triggering back action via grip"),e();break}}for(let j=0;j<z.length;j++)(((U=z[j])==null?void 0:U.pressed)||!1)&&Et.log(`Right controller button ${j} is pressed`)}}),Re.useEffect(()=>{if(s){const A=document.createElement("canvas");A.width=512,A.height=256;const w=()=>{const P=A.getContext("2d");P&&(P.fillStyle="rgba(0, 0, 0, 0.7)",P.fillRect(0,0,A.width,A.height),P.strokeStyle="white",P.lineWidth=2,P.strokeRect(5,5,A.width-10,A.height-10),P.fillStyle="white",P.font="bold 24px Arial",P.fillText("Controller Status",20,40),P.font="20px Arial",P.fillStyle=d.left?"#00FF00":"#FF0000",P.fillText(`Left Controller: ${d.left?"CONNECTED":"DISCONNECTED"}`,20,80),P.fillText(`Type: ${d.leftType}`,250,80),P.fillStyle=d.right?"#00FF00":"#FF0000",P.fillText(`Right Controller: ${d.right?"CONNECTED":"DISCONNECTED"}`,20,120),P.fillText(`Type: ${d.rightType}`,250,120),P.fillStyle="#FFFF00",P.font="16px Arial",P.fillText("Auto-reconnection active - checking every second",20,160),P.fillText("If controllers are not detected, try:",20,190),P.fillText("1. Press any button on controllers",30,220),P.fillText("2. Restart VR session",30,245))},M=new Ad(A),T=new fi({map:M,transparent:!0,opacity:.9,side:cr}),E=new Va(1,.5),C=new Tn(E,T);C.position.set(-1.2,1.6,-1.5),C.rotation.y=Math.PI/8,l.add(C),h.current=C,w();const N=setInterval(()=>{w(),M.needsUpdate=!0},500);return()=>{clearInterval(N),l.remove(C)}}},[s,d,l]),_e.jsx(_e.Fragment,{children:s&&r.map((A,w)=>{const T=(A.handedness||`controller-${w}`)==="left"?"#ff0000":"#0000ff";return _e.jsxs("group",{children:[_e.jsxs("mesh",{position:[0,0,0],visible:!0,matrix:A.matrix,matrixAutoUpdate:!1,children:[_e.jsx("sphereGeometry",{args:[.05,16,16]}),_e.jsx("meshBasicMaterial",{color:T,transparent:!0,opacity:.8})]}),_e.jsxs("mesh",{position:[0,0,-.05],visible:!0,matrix:A.matrix,matrixAutoUpdate:!1,children:[_e.jsx("cylinderGeometry",{args:[.002,.002,.2,8]}),_e.jsx("meshBasicMaterial",{color:T})]})]},`controller-indicator-${w}`)})})},Wme=()=>{const{controllers:i,player:e}=Vi(),{scene:t}=Ci(),[n,r]=Re.useState(!0),s=Re.useRef({});return Re.useEffect(()=>{i.forEach(o=>{var l,c,u;const a=(l=o.inputSource)==null?void 0:l.handedness;if(Et.log(`${a} controller connected`),(c=o.inputSource)!=null&&c.gamepad){const h=o.inputSource.gamepad;Et.log(`${a} controller has ${h.buttons.length} buttons and ${h.axes.length} axes`)}if(n&&((u=o.inputSource)!=null&&u.gamepad)){const d=o.inputSource.gamepad.buttons.length;for(let f=0;f<d;f++){const p=new Od(.01,16,16),_=new fi({color:16776960,transparent:!0,opacity:.7}),v=new Tn(p,_),g=f/d*Math.PI*2,b=.05;v.position.set(Math.cos(g)*b,Math.sin(g)*b,0),o.add(v);const m=`${a}-button-${f}`;s.current[m]=v,v.visible=!1}}})},[i,n,t]),no(()=>{i.forEach(o=>{var c;if(!((c=o.inputSource)!=null&&c.gamepad))return;const a=o.inputSource.handedness,l=o.inputSource.gamepad;l.buttons.forEach((u,h)=>{const d=`${a}-button-${h}`,f=s.current[d];if(f&&(f.visible=u.pressed&&n,u.value>0)){const p=f.material,_=new It(1,1-u.value,0);p.color=_}u.pressed?o.userData[`button${h}Pressed`]||(Et.log(`${a} controller button ${h} pressed (value: ${u.value.toFixed(2)})`),o.userData[`button${h}Pressed`]=!0):o.userData[`button${h}Pressed`]&&(o.userData[`button${h}Pressed`]=!1)}),l.axes.forEach((u,h)=>{if(Math.abs(u)>.5){const d=o.userData[`axis${h}Value`]||0;Math.abs(u-d)>.2&&(Et.log(`${a} controller axis ${h}: ${u.toFixed(2)}`),o.userData[`axis${h}Value`]=u)}})})}),Re.useEffect(()=>{if(!e)return;const o=e.session;if(!o)return;const a=()=>{const c=Array.from(o.inputSources||[]);Et.log(`Found ${c.length} WebXR input sources`),c.forEach((u,h)=>{Et.log(`Source ${h}: ${u.handedness} hand, ${u.targetRayMode} mode`)})};a();const l=()=>{a()};return o.addEventListener("inputsourceschange",l),()=>{o&&o.removeEventListener("inputsourceschange",l)}},[e]),Re.useEffect(()=>{const o=a=>{(a.key==="b"||a.key==="B")&&(r(l=>!l),Et.log(`Debug visuals ${n?"disabled":"enabled"}`))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[n]),_e.jsxs(_e.Fragment,{children:[_e.jsx(rte,{rayMaterial:{color:"#ffffff"}}),n&&_e.jsxs("group",{position:[0,1.6,-1],rotation:[0,0,0],children:[_e.jsxs("mesh",{position:[0,.1,0],children:[_e.jsx("planeGeometry",{args:[.4,.15]}),_e.jsx("meshBasicMaterial",{color:"#000000",transparent:!0,opacity:.7})]}),_e.jsx("group",{position:[0,.1,.01],children:_e.jsx(jme,{position:[0,0,0],color:"white",fontSize:.02,anchorX:"center",anchorY:"middle",children:"Controller Debug Mode Press buttons to test B key toggles visuals"})})]})]})},jme=({children:i,position:e,color:t,fontSize:n,anchorX:r,anchorY:s})=>{const o=document.createElement("canvas"),a=o.getContext("2d"),[l,c]=Re.useState(null);return Re.useEffect(()=>{if(!a)return;o.width=512,o.height=256,a.fillStyle="rgba(0,0,0,0)",a.fillRect(0,0,o.width,o.height),a.fillStyle=t,a.font=`${Math.floor(n*1e3)}px Arial`,a.textAlign="center",a.textBaseline="middle";const h=((i==null?void 0:i.toString())||"").split(`
`),d=n*1e3*1.2;h.forEach((p,_)=>{a.fillText(p,o.width/2,o.height/2-(h.length-1)*d/2+_*d)});const f=new Ad(o);return c(f),()=>{f.dispose()}},[i,t,n]),l?_e.jsxs("mesh",{position:e,children:[_e.jsx("planeGeometry",{args:[.4,.15]}),_e.jsx("meshBasicMaterial",{map:l,transparent:!0})]}):null},Xme=()=>(mne(),null);function qme(){const[i,e]=Re.useState(Mi.START),[t,n]=Re.useState(null),[r,s]=Re.useState(!1),[o,a]=Re.useState(4),[l,c]=Re.useState(0),u=Re.useCallback(()=>{e(Mi.EXPLORING)},[]),h=Re.useCallback(()=>{i===Mi.EXPLORING?e(Mi.MENU):i===Mi.MENU&&e(Mi.EXPLORING)},[i]),d=Re.useCallback(v=>{n(v),e(Mi.PAGE_VIEW)},[]),f=Re.useCallback(()=>{n(null),e(Mi.EXPLORING)},[]),p=Re.useCallback(v=>{s(v)},[]),_=Re.useCallback(()=>{i===Mi.PAGE_VIEW?f():i===Mi.MENU&&e(Mi.EXPLORING)},[i,f]);return Re.useEffect(()=>{const v=g=>{g.key.toLowerCase()==="m"&&h(),g.key==="Escape"&&_();const b=.1,m=.1,y=8,A=2,w=1.5,M=-1.5;switch(g.code){case"Numpad8":c(T=>Math.min(w,T+m));break;case"Numpad2":c(T=>Math.max(M,T-m));break;case"Numpad6":a(T=>Math.min(y,T+b));break;case"Numpad4":a(T=>Math.max(A,T-b));break}};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[i,_,h]),_e.jsxs("div",{className:"w-screen h-screen bg-black",children:[i===Mi.START&&_e.jsxs("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-black bg-opacity-70 text-white",children:[_e.jsx("h1",{className:"text-5xl font-bold mb-4",children:"Fold VR"}),_e.jsxs("p",{className:"text-lg mb-8 text-center leading-relaxed",children:[_e.jsx("span",{className:"font-bold",children:"Desktop:"})," Use WASD to move. Press 'M' to open the menu. Click to begin.",_e.jsx("br",{}),_e.jsx("span",{className:"font-bold",children:"VR:"})," Use left stick to move. Press 'Y' button for menu."]}),_e.jsx("button",{onClick:u,className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-lg font-semibold transition-colors",children:"Start Exploring"})]}),i===Mi.EXPLORING&&!r&&_e.jsxs("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-black bg-opacity-50 text-white pointer-events-none",children:[_e.jsx("h2",{className:"text-4xl font-bold animate-pulse",children:"Click or Press 'T' to Look"}),_e.jsx("p",{className:"text-lg mt-2",children:"Use WASD to move, 'M' for menu, 'Esc' to release control"}),_e.jsx("p",{className:"text-sm mt-4 text-slate-300",children:"(In VR, you can look around freely)"})]}),_e.jsx(gG,{}),_e.jsx(uG,{shadows:!0,camera:{fov:75,position:[0,1.6,5]},children:_e.jsxs(fG,{children:[_e.jsx(pne,{maxLines:15}),_e.jsx(Xme,{}),_e.jsx(Wme,{}),_e.jsx($me,{onMenuToggle:h,onBack:_,onMenuSelect:i===Mi.MENU?d.bind(null,zh[0]):void 0,onMove:(v,g)=>{const b=new CustomEvent("vr-movement",{detail:{x:v,y:g}});window.dispatchEvent(b)}}),_e.jsx(fte,{}),_e.jsx(gne,{gameState:i,isLocked:r,onPointerLockChange:p}),i===Mi.MENU&&_e.jsx(Tne,{onSelectPage:d,pageYOffset:l}),i===Mi.PAGE_VIEW&&t&&_e.jsx(Hme,{content:t,onClose:f,pageDistance:o,setPageDistance:a,pageYOffset:l,setPageYOffset:c})]})})]})}const QH=document.getElementById("root");if(!QH)throw new Error("Could not find root element to mount to");const Yme=_E.createRoot(QH);Yme.render(_e.jsx($$.StrictMode,{children:_e.jsx(qme,{})}));

(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var mO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gO(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var vO={exports:{}},Pb={},_O={exports:{}},wn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s1=Symbol.for("react.element"),zH=Symbol.for("react.portal"),GH=Symbol.for("react.fragment"),VH=Symbol.for("react.strict_mode"),HH=Symbol.for("react.profiler"),$H=Symbol.for("react.provider"),WH=Symbol.for("react.context"),jH=Symbol.for("react.forward_ref"),XH=Symbol.for("react.suspense"),qH=Symbol.for("react.memo"),YH=Symbol.for("react.lazy"),FI=Symbol.iterator;function KH(i){return i===null||typeof i!="object"?null:(i=FI&&i[FI]||i["@@iterator"],typeof i=="function"?i:null)}var yO={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xO=Object.assign,bO={};function qp(i,e,t){this.props=i,this.context=e,this.refs=bO,this.updater=t||yO}qp.prototype.isReactComponent={};qp.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};qp.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function SO(){}SO.prototype=qp.prototype;function NC(i,e,t){this.props=i,this.context=e,this.refs=bO,this.updater=t||yO}var FC=NC.prototype=new SO;FC.constructor=NC;xO(FC,qp.prototype);FC.isPureReactComponent=!0;var kI=Array.isArray,wO=Object.prototype.hasOwnProperty,kC={current:null},MO={key:!0,ref:!0,__self:!0,__source:!0};function AO(i,e,t){var n,r={},s=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)wO.call(e,n)&&!MO.hasOwnProperty(n)&&(r[n]=e[n]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(i&&i.defaultProps)for(n in a=i.defaultProps,a)r[n]===void 0&&(r[n]=a[n]);return{$$typeof:s1,type:i,key:s,ref:o,props:r,_owner:kC.current}}function ZH(i,e){return{$$typeof:s1,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function UC(i){return typeof i=="object"&&i!==null&&i.$$typeof===s1}function QH(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var UI=/\/+/g;function F2(i,e){return typeof i=="object"&&i!==null&&i.key!=null?QH(""+i.key):e.toString(36)}function By(i,e,t,n,r){var s=typeof i;(s==="undefined"||s==="boolean")&&(i=null);var o=!1;if(i===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(i.$$typeof){case s1:case zH:o=!0}}if(o)return o=i,r=r(o),i=n===""?"."+F2(o,0):n,kI(r)?(t="",i!=null&&(t=i.replace(UI,"$&/")+"/"),By(r,e,t,"",function(c){return c})):r!=null&&(UC(r)&&(r=ZH(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(UI,"$&/")+"/")+i)),e.push(r)),1;if(o=0,n=n===""?".":n+":",kI(i))for(var a=0;a<i.length;a++){s=i[a];var l=n+F2(s,a);o+=By(s,e,t,l,r)}else if(l=KH(i),typeof l=="function")for(i=l.call(i),a=0;!(s=i.next()).done;)s=s.value,l=n+F2(s,a++),o+=By(s,e,t,l,r);else if(s==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function wv(i,e,t){if(i==null)return i;var n=[],r=0;return By(i,n,"","",function(s){return e.call(t,s,r++)}),n}function JH(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var Ps={current:null},zy={transition:null},e$={ReactCurrentDispatcher:Ps,ReactCurrentBatchConfig:zy,ReactCurrentOwner:kC};function EO(){throw Error("act(...) is not supported in production builds of React.")}wn.Children={map:wv,forEach:function(i,e,t){wv(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return wv(i,function(){e++}),e},toArray:function(i){return wv(i,function(e){return e})||[]},only:function(i){if(!UC(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};wn.Component=qp;wn.Fragment=GH;wn.Profiler=HH;wn.PureComponent=NC;wn.StrictMode=VH;wn.Suspense=XH;wn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=e$;wn.act=EO;wn.cloneElement=function(i,e,t){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var n=xO({},i.props),r=i.key,s=i.ref,o=i._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=kC.current),e.key!==void 0&&(r=""+e.key),i.type&&i.type.defaultProps)var a=i.type.defaultProps;for(l in e)wO.call(e,l)&&!MO.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];n.children=a}return{$$typeof:s1,type:i.type,key:r,ref:s,props:n,_owner:o}};wn.createContext=function(i){return i={$$typeof:WH,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:$H,_context:i},i.Consumer=i};wn.createElement=AO;wn.createFactory=function(i){var e=AO.bind(null,i);return e.type=i,e};wn.createRef=function(){return{current:null}};wn.forwardRef=function(i){return{$$typeof:jH,render:i}};wn.isValidElement=UC;wn.lazy=function(i){return{$$typeof:YH,_payload:{_status:-1,_result:i},_init:JH}};wn.memo=function(i,e){return{$$typeof:qH,type:i,compare:e===void 0?null:e}};wn.startTransition=function(i){var e=zy.transition;zy.transition={};try{i()}finally{zy.transition=e}};wn.unstable_act=EO;wn.useCallback=function(i,e){return Ps.current.useCallback(i,e)};wn.useContext=function(i){return Ps.current.useContext(i)};wn.useDebugValue=function(){};wn.useDeferredValue=function(i){return Ps.current.useDeferredValue(i)};wn.useEffect=function(i,e){return Ps.current.useEffect(i,e)};wn.useId=function(){return Ps.current.useId()};wn.useImperativeHandle=function(i,e,t){return Ps.current.useImperativeHandle(i,e,t)};wn.useInsertionEffect=function(i,e){return Ps.current.useInsertionEffect(i,e)};wn.useLayoutEffect=function(i,e){return Ps.current.useLayoutEffect(i,e)};wn.useMemo=function(i,e){return Ps.current.useMemo(i,e)};wn.useReducer=function(i,e,t){return Ps.current.useReducer(i,e,t)};wn.useRef=function(i){return Ps.current.useRef(i)};wn.useState=function(i){return Ps.current.useState(i)};wn.useSyncExternalStore=function(i,e,t){return Ps.current.useSyncExternalStore(i,e,t)};wn.useTransition=function(){return Ps.current.useTransition()};wn.version="18.3.1";_O.exports=wn;var Ge=_O.exports;const t$=gO(Ge);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n$=Ge,i$=Symbol.for("react.element"),r$=Symbol.for("react.fragment"),s$=Object.prototype.hasOwnProperty,o$=n$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a$={key:!0,ref:!0,__self:!0,__source:!0};function TO(i,e,t){var n,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)s$.call(e,n)&&!a$.hasOwnProperty(n)&&(r[n]=e[n]);if(i&&i.defaultProps)for(n in e=i.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:i$,type:i,key:s,ref:o,props:r,_owner:o$.current}}Pb.Fragment=r$;Pb.jsx=TO;Pb.jsxs=TO;vO.exports=Pb;var we=vO.exports,qA={},CO={exports:{}},Ao={},PO={exports:{}},RO={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(U,G){var B=U.length;U.push(G);e:for(;0<B;){var D=B-1>>>1,O=U[D];if(0<r(O,G))U[D]=G,U[B]=O,B=D;else break e}}function t(U){return U.length===0?null:U[0]}function n(U){if(U.length===0)return null;var G=U[0],B=U.pop();if(B!==G){U[0]=B;e:for(var D=0,O=U.length,j=O>>>1;D<j;){var q=2*(D+1)-1,Y=U[q],ie=q+1,ne=U[ie];if(0>r(Y,B))ie<O&&0>r(ne,Y)?(U[D]=ne,U[ie]=B,D=ie):(U[D]=Y,U[q]=B,D=q);else if(ie<O&&0>r(ne,B))U[D]=ne,U[ie]=B,D=ie;else break e}}return G}function r(U,G){var B=U.sortIndex-G.sortIndex;return B!==0?B:U.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,d=3,f=!1,m=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function p(U){for(var G=t(c);G!==null;){if(G.callback===null)n(c);else if(G.startTime<=U)n(c),G.sortIndex=G.expirationTime,e(l,G);else break;G=t(c)}}function y(U){if(_=!1,p(U),!m)if(t(l)!==null)m=!0,V(A);else{var G=t(c);G!==null&&z(y,G.startTime-U)}}function A(U,G){m=!1,_&&(_=!1,g(T),T=-1),f=!0;var B=d;try{for(p(G),h=t(l);h!==null&&(!(h.expirationTime>G)||U&&!N());){var D=h.callback;if(typeof D=="function"){h.callback=null,d=h.priorityLevel;var O=D(h.expirationTime<=G);G=i.unstable_now(),typeof O=="function"?h.callback=O:h===t(l)&&n(l),p(G)}else n(l);h=t(l)}if(h!==null)var j=!0;else{var q=t(c);q!==null&&z(y,q.startTime-G),j=!1}return j}finally{h=null,d=B,f=!1}}var w=!1,M=null,T=-1,E=5,C=-1;function N(){return!(i.unstable_now()-C<E)}function P(){if(M!==null){var U=i.unstable_now();C=U;var G=!0;try{G=M(!0,U)}finally{G?L():(w=!1,M=null)}}else w=!1}var L;if(typeof b=="function")L=function(){b(P)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,F=R.port2;R.port1.onmessage=P,L=function(){F.postMessage(null)}}else L=function(){v(P,0)};function V(U){M=U,w||(w=!0,L())}function z(U,G){T=v(function(){U(i.unstable_now())},G)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(U){U.callback=null},i.unstable_continueExecution=function(){m||f||(m=!0,V(A))},i.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<U?Math.floor(1e3/U):5},i.unstable_getCurrentPriorityLevel=function(){return d},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(U){switch(d){case 1:case 2:case 3:var G=3;break;default:G=d}var B=d;d=G;try{return U()}finally{d=B}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(U,G){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var B=d;d=U;try{return G()}finally{d=B}},i.unstable_scheduleCallback=function(U,G,B){var D=i.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?D+B:D):B=D,U){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=B+O,U={id:u++,callback:G,priorityLevel:U,startTime:B,expirationTime:O,sortIndex:-1},B>D?(U.sortIndex=B,e(c,U),t(l)===null&&U===t(c)&&(_?(g(T),T=-1):_=!0,z(y,B-D))):(U.sortIndex=O,e(l,U),m||f||(m=!0,V(A))),U},i.unstable_shouldYield=N,i.unstable_wrapCallback=function(U){var G=d;return function(){var B=d;d=G;try{return U.apply(this,arguments)}finally{d=B}}}})(RO);PO.exports=RO;var l$=PO.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c$=Ge,So=l$;function Ct(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var IO=new Set,c0={};function pd(i,e){Mp(i,e),Mp(i+"Capture",e)}function Mp(i,e){for(c0[i]=e,i=0;i<e.length;i++)IO.add(e[i])}var ic=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),YA=Object.prototype.hasOwnProperty,u$=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,OI={},BI={};function h$(i){return YA.call(BI,i)?!0:YA.call(OI,i)?!1:u$.test(i)?BI[i]=!0:(OI[i]=!0,!1)}function d$(i,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function f$(i,e,t,n){if(e===null||typeof e>"u"||d$(i,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Rs(i,e,t,n,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Ur={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Ur[i]=new Rs(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];Ur[e]=new Rs(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Ur[i]=new Rs(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Ur[i]=new Rs(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Ur[i]=new Rs(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Ur[i]=new Rs(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Ur[i]=new Rs(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Ur[i]=new Rs(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Ur[i]=new Rs(i,5,!1,i.toLowerCase(),null,!1,!1)});var OC=/[\-:]([a-z])/g;function BC(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(OC,BC);Ur[e]=new Rs(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(OC,BC);Ur[e]=new Rs(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(OC,BC);Ur[e]=new Rs(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Ur[i]=new Rs(i,1,!1,i.toLowerCase(),null,!1,!1)});Ur.xlinkHref=new Rs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Ur[i]=new Rs(i,1,!1,i.toLowerCase(),null,!0,!0)});function zC(i,e,t,n){var r=Ur.hasOwnProperty(e)?Ur[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(f$(e,t,r,n)&&(t=null),n||r===null?h$(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):r.mustUseProperty?i[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,n=r.attributeNamespace,t===null?i.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,n?i.setAttributeNS(n,e,t):i.setAttribute(e,t))))}var mc=c$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Mv=Symbol.for("react.element"),Gf=Symbol.for("react.portal"),Vf=Symbol.for("react.fragment"),GC=Symbol.for("react.strict_mode"),KA=Symbol.for("react.profiler"),LO=Symbol.for("react.provider"),DO=Symbol.for("react.context"),VC=Symbol.for("react.forward_ref"),ZA=Symbol.for("react.suspense"),QA=Symbol.for("react.suspense_list"),HC=Symbol.for("react.memo"),jc=Symbol.for("react.lazy"),NO=Symbol.for("react.offscreen"),zI=Symbol.iterator;function Fm(i){return i===null||typeof i!="object"?null:(i=zI&&i[zI]||i["@@iterator"],typeof i=="function"?i:null)}var Ci=Object.assign,k2;function xg(i){if(k2===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);k2=e&&e[1]||""}return`
`+k2+i}var U2=!1;function O2(i,e){if(!i||U2)return"";U2=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var n=c}Reflect.construct(i,[],e)}else{try{e.call()}catch(c){n=c}i.call(e.prototype)}else{try{throw Error()}catch(c){n=c}i()}}catch(c){if(c&&n&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=n.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return i.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",i.displayName)),l}while(1<=o&&0<=a);break}}}finally{U2=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?xg(i):""}function p$(i){switch(i.tag){case 5:return xg(i.type);case 16:return xg("Lazy");case 13:return xg("Suspense");case 19:return xg("SuspenseList");case 0:case 2:case 15:return i=O2(i.type,!1),i;case 11:return i=O2(i.type.render,!1),i;case 1:return i=O2(i.type,!0),i;default:return""}}function JA(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Vf:return"Fragment";case Gf:return"Portal";case KA:return"Profiler";case GC:return"StrictMode";case ZA:return"Suspense";case QA:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case DO:return(i.displayName||"Context")+".Consumer";case LO:return(i._context.displayName||"Context")+".Provider";case VC:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case HC:return e=i.displayName||null,e!==null?e:JA(i.type)||"Memo";case jc:e=i._payload,i=i._init;try{return JA(i(e))}catch{}}return null}function m$(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return JA(e);case 8:return e===GC?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function bu(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function FO(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function g$(i){var e=FO(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),n=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function Av(i){i._valueTracker||(i._valueTracker=g$(i))}function kO(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return i&&(n=FO(i)?i.checked?"true":"false":i.value),i=n,i!==t?(e.setValue(i),!0):!1}function Mx(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function eE(i,e){var t=e.checked;return Ci({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??i._wrapperState.initialChecked})}function GI(i,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=bu(e.value!=null?e.value:t),i._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function UO(i,e){e=e.checked,e!=null&&zC(i,"checked",e,!1)}function tE(i,e){UO(i,e);var t=bu(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(n==="submit"||n==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?nE(i,e.type,t):e.hasOwnProperty("defaultValue")&&nE(i,e.type,bu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function VI(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function nE(i,e,t){(e!=="number"||Mx(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}var bg=Array.isArray;function up(i,e,t,n){if(i=i.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<i.length;t++)r=e.hasOwnProperty("$"+i[t].value),i[t].selected!==r&&(i[t].selected=r),r&&n&&(i[t].defaultSelected=!0)}else{for(t=""+bu(t),e=null,r=0;r<i.length;r++){if(i[r].value===t){i[r].selected=!0,n&&(i[r].defaultSelected=!0);return}e!==null||i[r].disabled||(e=i[r])}e!==null&&(e.selected=!0)}}function iE(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ct(91));return Ci({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function HI(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Ct(92));if(bg(t)){if(1<t.length)throw Error(Ct(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:bu(t)}}function OO(i,e){var t=bu(e.value),n=bu(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),n!=null&&(i.defaultValue=""+n)}function $I(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function BO(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rE(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?BO(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ev,zO=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return i(e,t,n,r)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(Ev=Ev||document.createElement("div"),Ev.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ev.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function u0(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var Ug={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},v$=["Webkit","ms","Moz","O"];Object.keys(Ug).forEach(function(i){v$.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),Ug[e]=Ug[i]})});function GO(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Ug.hasOwnProperty(i)&&Ug[i]?(""+e).trim():e+"px"}function VO(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,r=GO(t,e[t],n);t==="float"&&(t="cssFloat"),n?i.setProperty(t,r):i[t]=r}}var _$=Ci({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sE(i,e){if(e){if(_$[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ct(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ct(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ct(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ct(62))}}function oE(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var aE=null;function $C(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var lE=null,hp=null,dp=null;function WI(i){if(i=l1(i)){if(typeof lE!="function")throw Error(Ct(280));var e=i.stateNode;e&&(e=Nb(e),lE(i.stateNode,i.type,e))}}function HO(i){hp?dp?dp.push(i):dp=[i]:hp=i}function $O(){if(hp){var i=hp,e=dp;if(dp=hp=null,WI(i),e)for(i=0;i<e.length;i++)WI(e[i])}}function WO(i,e){return i(e)}function jO(){}var B2=!1;function XO(i,e,t){if(B2)return i(e,t);B2=!0;try{return WO(i,e,t)}finally{B2=!1,(hp!==null||dp!==null)&&(jO(),$O())}}function h0(i,e){var t=i.stateNode;if(t===null)return null;var n=Nb(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(i=i.type,n=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!n;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(Ct(231,e,typeof t));return t}var cE=!1;if(ic)try{var km={};Object.defineProperty(km,"passive",{get:function(){cE=!0}}),window.addEventListener("test",km,km),window.removeEventListener("test",km,km)}catch{cE=!1}function y$(i,e,t,n,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var Og=!1,Ax=null,Ex=!1,uE=null,x$={onError:function(i){Og=!0,Ax=i}};function b$(i,e,t,n,r,s,o,a,l){Og=!1,Ax=null,y$.apply(x$,arguments)}function S$(i,e,t,n,r,s,o,a,l){if(b$.apply(this,arguments),Og){if(Og){var c=Ax;Og=!1,Ax=null}else throw Error(Ct(198));Ex||(Ex=!0,uE=c)}}function md(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function qO(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function jI(i){if(md(i)!==i)throw Error(Ct(188))}function w$(i){var e=i.alternate;if(!e){if(e=md(i),e===null)throw Error(Ct(188));return e!==i?null:i}for(var t=i,n=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(n=r.return,n!==null){t=n;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return jI(r),i;if(s===n)return jI(r),e;s=s.sibling}throw Error(Ct(188))}if(t.return!==n.return)t=r,n=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,n=s;break}if(a===n){o=!0,n=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,n=r;break}if(a===n){o=!0,n=s,t=r;break}a=a.sibling}if(!o)throw Error(Ct(189))}}if(t.alternate!==n)throw Error(Ct(190))}if(t.tag!==3)throw Error(Ct(188));return t.stateNode.current===t?i:e}function YO(i){return i=w$(i),i!==null?KO(i):null}function KO(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=KO(i);if(e!==null)return e;i=i.sibling}return null}var ZO=So.unstable_scheduleCallback,XI=So.unstable_cancelCallback,M$=So.unstable_shouldYield,A$=So.unstable_requestPaint,Vi=So.unstable_now,E$=So.unstable_getCurrentPriorityLevel,WC=So.unstable_ImmediatePriority,QO=So.unstable_UserBlockingPriority,Tx=So.unstable_NormalPriority,T$=So.unstable_LowPriority,JO=So.unstable_IdlePriority,Rb=null,tl=null;function C$(i){if(tl&&typeof tl.onCommitFiberRoot=="function")try{tl.onCommitFiberRoot(Rb,i,void 0,(i.current.flags&128)===128)}catch{}}var Pa=Math.clz32?Math.clz32:I$,P$=Math.log,R$=Math.LN2;function I$(i){return i>>>=0,i===0?32:31-(P$(i)/R$|0)|0}var Tv=64,Cv=4194304;function Sg(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Cx(i,e){var t=i.pendingLanes;if(t===0)return 0;var n=0,r=i.suspendedLanes,s=i.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?n=Sg(a):(s&=o,s!==0&&(n=Sg(s)))}else o=t&~r,o!==0?n=Sg(o):s!==0&&(n=Sg(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=n;0<e;)t=31-Pa(e),r=1<<t,n|=i[t],e&=~r;return n}function L$(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function D$(i,e){for(var t=i.suspendedLanes,n=i.pingedLanes,r=i.expirationTimes,s=i.pendingLanes;0<s;){var o=31-Pa(s),a=1<<o,l=r[o];l===-1?(!(a&t)||a&n)&&(r[o]=L$(a,e)):l<=e&&(i.expiredLanes|=a),s&=~a}}function hE(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function e5(){var i=Tv;return Tv<<=1,!(Tv&4194240)&&(Tv=64),i}function z2(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function o1(i,e,t){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-Pa(e),i[e]=t}function N$(i,e){var t=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var n=i.eventTimes;for(i=i.expirationTimes;0<t;){var r=31-Pa(t),s=1<<r;e[r]=0,n[r]=-1,i[r]=-1,t&=~s}}function jC(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var n=31-Pa(t),r=1<<n;r&e|i[n]&e&&(i[n]|=e),t&=~r}}var Vn=0;function t5(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var n5,XC,i5,r5,s5,dE=!1,Pv=[],su=null,ou=null,au=null,d0=new Map,f0=new Map,Qc=[],F$="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qI(i,e){switch(i){case"focusin":case"focusout":su=null;break;case"dragenter":case"dragleave":ou=null;break;case"mouseover":case"mouseout":au=null;break;case"pointerover":case"pointerout":d0.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":f0.delete(e.pointerId)}}function Um(i,e,t,n,r,s){return i===null||i.nativeEvent!==s?(i={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[r]},e!==null&&(e=l1(e),e!==null&&XC(e)),i):(i.eventSystemFlags|=n,e=i.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),i)}function k$(i,e,t,n,r){switch(e){case"focusin":return su=Um(su,i,e,t,n,r),!0;case"dragenter":return ou=Um(ou,i,e,t,n,r),!0;case"mouseover":return au=Um(au,i,e,t,n,r),!0;case"pointerover":var s=r.pointerId;return d0.set(s,Um(d0.get(s)||null,i,e,t,n,r)),!0;case"gotpointercapture":return s=r.pointerId,f0.set(s,Um(f0.get(s)||null,i,e,t,n,r)),!0}return!1}function o5(i){var e=Ph(i.target);if(e!==null){var t=md(e);if(t!==null){if(e=t.tag,e===13){if(e=qO(t),e!==null){i.blockedOn=e,s5(i.priority,function(){i5(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Gy(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=fE(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t===null){t=i.nativeEvent;var n=new t.constructor(t.type,t);aE=n,t.target.dispatchEvent(n),aE=null}else return e=l1(t),e!==null&&XC(e),i.blockedOn=t,!1;e.shift()}return!0}function YI(i,e,t){Gy(i)&&t.delete(e)}function U$(){dE=!1,su!==null&&Gy(su)&&(su=null),ou!==null&&Gy(ou)&&(ou=null),au!==null&&Gy(au)&&(au=null),d0.forEach(YI),f0.forEach(YI)}function Om(i,e){i.blockedOn===e&&(i.blockedOn=null,dE||(dE=!0,So.unstable_scheduleCallback(So.unstable_NormalPriority,U$)))}function p0(i){function e(r){return Om(r,i)}if(0<Pv.length){Om(Pv[0],i);for(var t=1;t<Pv.length;t++){var n=Pv[t];n.blockedOn===i&&(n.blockedOn=null)}}for(su!==null&&Om(su,i),ou!==null&&Om(ou,i),au!==null&&Om(au,i),d0.forEach(e),f0.forEach(e),t=0;t<Qc.length;t++)n=Qc[t],n.blockedOn===i&&(n.blockedOn=null);for(;0<Qc.length&&(t=Qc[0],t.blockedOn===null);)o5(t),t.blockedOn===null&&Qc.shift()}var fp=mc.ReactCurrentBatchConfig,Px=!0;function O$(i,e,t,n){var r=Vn,s=fp.transition;fp.transition=null;try{Vn=1,qC(i,e,t,n)}finally{Vn=r,fp.transition=s}}function B$(i,e,t,n){var r=Vn,s=fp.transition;fp.transition=null;try{Vn=4,qC(i,e,t,n)}finally{Vn=r,fp.transition=s}}function qC(i,e,t,n){if(Px){var r=fE(i,e,t,n);if(r===null)K2(i,e,n,Rx,t),qI(i,n);else if(k$(r,i,e,t,n))n.stopPropagation();else if(qI(i,n),e&4&&-1<F$.indexOf(i)){for(;r!==null;){var s=l1(r);if(s!==null&&n5(s),s=fE(i,e,t,n),s===null&&K2(i,e,n,Rx,t),s===r)break;r=s}r!==null&&n.stopPropagation()}else K2(i,e,n,null,t)}}var Rx=null;function fE(i,e,t,n){if(Rx=null,i=$C(n),i=Ph(i),i!==null)if(e=md(i),e===null)i=null;else if(t=e.tag,t===13){if(i=qO(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return Rx=i,null}function a5(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(E$()){case WC:return 1;case QO:return 4;case Tx:case T$:return 16;case JO:return 536870912;default:return 16}default:return 16}}var tu=null,YC=null,Vy=null;function l5(){if(Vy)return Vy;var i,e=YC,t=e.length,n,r="value"in tu?tu.value:tu.textContent,s=r.length;for(i=0;i<t&&e[i]===r[i];i++);var o=t-i;for(n=1;n<=o&&e[t-n]===r[s-n];n++);return Vy=r.slice(i,1<n?1-n:void 0)}function Hy(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function Rv(){return!0}function KI(){return!1}function Eo(i){function e(t,n,r,s,o){this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in i)i.hasOwnProperty(a)&&(t=i[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Rv:KI,this.isPropagationStopped=KI,this}return Ci(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Rv)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Rv)},persist:function(){},isPersistent:Rv}),e}var Yp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},KC=Eo(Yp),a1=Ci({},Yp,{view:0,detail:0}),z$=Eo(a1),G2,V2,Bm,Ib=Ci({},a1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ZC,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Bm&&(Bm&&i.type==="mousemove"?(G2=i.screenX-Bm.screenX,V2=i.screenY-Bm.screenY):V2=G2=0,Bm=i),G2)},movementY:function(i){return"movementY"in i?i.movementY:V2}}),ZI=Eo(Ib),G$=Ci({},Ib,{dataTransfer:0}),V$=Eo(G$),H$=Ci({},a1,{relatedTarget:0}),H2=Eo(H$),$$=Ci({},Yp,{animationName:0,elapsedTime:0,pseudoElement:0}),W$=Eo($$),j$=Ci({},Yp,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),X$=Eo(j$),q$=Ci({},Yp,{data:0}),QI=Eo(q$),Y$={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},K$={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Z$={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Q$(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=Z$[i])?!!e[i]:!1}function ZC(){return Q$}var J$=Ci({},a1,{key:function(i){if(i.key){var e=Y$[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=Hy(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?K$[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ZC,charCode:function(i){return i.type==="keypress"?Hy(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Hy(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),e7=Eo(J$),t7=Ci({},Ib,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),JI=Eo(t7),n7=Ci({},a1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ZC}),i7=Eo(n7),r7=Ci({},Yp,{propertyName:0,elapsedTime:0,pseudoElement:0}),s7=Eo(r7),o7=Ci({},Ib,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),a7=Eo(o7),l7=[9,13,27,32],QC=ic&&"CompositionEvent"in window,Bg=null;ic&&"documentMode"in document&&(Bg=document.documentMode);var c7=ic&&"TextEvent"in window&&!Bg,c5=ic&&(!QC||Bg&&8<Bg&&11>=Bg),eL=" ",tL=!1;function u5(i,e){switch(i){case"keyup":return l7.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function h5(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Hf=!1;function u7(i,e){switch(i){case"compositionend":return h5(e);case"keypress":return e.which!==32?null:(tL=!0,eL);case"textInput":return i=e.data,i===eL&&tL?null:i;default:return null}}function h7(i,e){if(Hf)return i==="compositionend"||!QC&&u5(i,e)?(i=l5(),Vy=YC=tu=null,Hf=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return c5&&e.locale!=="ko"?null:e.data;default:return null}}var d7={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nL(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!d7[i.type]:e==="textarea"}function d5(i,e,t,n){HO(n),e=Ix(e,"onChange"),0<e.length&&(t=new KC("onChange","change",null,t,n),i.push({event:t,listeners:e}))}var zg=null,m0=null;function f7(i){w5(i,0)}function Lb(i){var e=jf(i);if(kO(e))return i}function p7(i,e){if(i==="change")return e}var f5=!1;if(ic){var $2;if(ic){var W2="oninput"in document;if(!W2){var iL=document.createElement("div");iL.setAttribute("oninput","return;"),W2=typeof iL.oninput=="function"}$2=W2}else $2=!1;f5=$2&&(!document.documentMode||9<document.documentMode)}function rL(){zg&&(zg.detachEvent("onpropertychange",p5),m0=zg=null)}function p5(i){if(i.propertyName==="value"&&Lb(m0)){var e=[];d5(e,m0,i,$C(i)),XO(f7,e)}}function m7(i,e,t){i==="focusin"?(rL(),zg=e,m0=t,zg.attachEvent("onpropertychange",p5)):i==="focusout"&&rL()}function g7(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Lb(m0)}function v7(i,e){if(i==="click")return Lb(e)}function _7(i,e){if(i==="input"||i==="change")return Lb(e)}function y7(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var Da=typeof Object.is=="function"?Object.is:y7;function g0(i,e){if(Da(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var r=t[n];if(!YA.call(e,r)||!Da(i[r],e[r]))return!1}return!0}function sL(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function oL(i,e){var t=sL(i);i=0;for(var n;t;){if(t.nodeType===3){if(n=i+t.textContent.length,i<=e&&n>=e)return{node:t,offset:e-i};i=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=sL(t)}}function m5(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?m5(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function g5(){for(var i=window,e=Mx();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=Mx(i.document)}return e}function JC(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function x7(i){var e=g5(),t=i.focusedElem,n=i.selectionRange;if(e!==t&&t&&t.ownerDocument&&m5(t.ownerDocument.documentElement,t)){if(n!==null&&JC(t)){if(e=n.start,i=n.end,i===void 0&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if(i=(e=t.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var r=t.textContent.length,s=Math.min(n.start,r);n=n.end===void 0?s:Math.min(n.end,r),!i.extend&&s>n&&(r=n,n=s,s=r),r=oL(t,s);var o=oL(t,n);r&&o&&(i.rangeCount!==1||i.anchorNode!==r.node||i.anchorOffset!==r.offset||i.focusNode!==o.node||i.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),i.removeAllRanges(),s>n?(i.addRange(e),i.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)i=e[t],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var b7=ic&&"documentMode"in document&&11>=document.documentMode,$f=null,pE=null,Gg=null,mE=!1;function aL(i,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;mE||$f==null||$f!==Mx(n)||(n=$f,"selectionStart"in n&&JC(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Gg&&g0(Gg,n)||(Gg=n,n=Ix(pE,"onSelect"),0<n.length&&(e=new KC("onSelect","select",null,e,t),i.push({event:e,listeners:n}),e.target=$f)))}function Iv(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var Wf={animationend:Iv("Animation","AnimationEnd"),animationiteration:Iv("Animation","AnimationIteration"),animationstart:Iv("Animation","AnimationStart"),transitionend:Iv("Transition","TransitionEnd")},j2={},v5={};ic&&(v5=document.createElement("div").style,"AnimationEvent"in window||(delete Wf.animationend.animation,delete Wf.animationiteration.animation,delete Wf.animationstart.animation),"TransitionEvent"in window||delete Wf.transitionend.transition);function Db(i){if(j2[i])return j2[i];if(!Wf[i])return i;var e=Wf[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in v5)return j2[i]=e[t];return i}var _5=Db("animationend"),y5=Db("animationiteration"),x5=Db("animationstart"),b5=Db("transitionend"),S5=new Map,lL="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pu(i,e){S5.set(i,e),pd(e,[i])}for(var X2=0;X2<lL.length;X2++){var q2=lL[X2],S7=q2.toLowerCase(),w7=q2[0].toUpperCase()+q2.slice(1);Pu(S7,"on"+w7)}Pu(_5,"onAnimationEnd");Pu(y5,"onAnimationIteration");Pu(x5,"onAnimationStart");Pu("dblclick","onDoubleClick");Pu("focusin","onFocus");Pu("focusout","onBlur");Pu(b5,"onTransitionEnd");Mp("onMouseEnter",["mouseout","mouseover"]);Mp("onMouseLeave",["mouseout","mouseover"]);Mp("onPointerEnter",["pointerout","pointerover"]);Mp("onPointerLeave",["pointerout","pointerover"]);pd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));pd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));pd("onBeforeInput",["compositionend","keypress","textInput","paste"]);pd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));pd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));pd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),M7=new Set("cancel close invalid load scroll toggle".split(" ").concat(wg));function cL(i,e,t){var n=i.type||"unknown-event";i.currentTarget=t,S$(n,e,void 0,i),i.currentTarget=null}function w5(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var n=i[t],r=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;cL(r,a,c),s=l}else for(o=0;o<n.length;o++){if(a=n[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;cL(r,a,c),s=l}}}if(Ex)throw i=uE,Ex=!1,uE=null,i}function ii(i,e){var t=e[xE];t===void 0&&(t=e[xE]=new Set);var n=i+"__bubble";t.has(n)||(M5(e,i,2,!1),t.add(n))}function Y2(i,e,t){var n=0;e&&(n|=4),M5(t,i,n,e)}var Lv="_reactListening"+Math.random().toString(36).slice(2);function v0(i){if(!i[Lv]){i[Lv]=!0,IO.forEach(function(t){t!=="selectionchange"&&(M7.has(t)||Y2(t,!1,i),Y2(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[Lv]||(e[Lv]=!0,Y2("selectionchange",!1,e))}}function M5(i,e,t,n){switch(a5(e)){case 1:var r=O$;break;case 4:r=B$;break;default:r=qC}t=r.bind(null,e,t,i),r=void 0,!cE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?i.addEventListener(e,t,{capture:!0,passive:r}):i.addEventListener(e,t,!0):r!==void 0?i.addEventListener(e,t,{passive:r}):i.addEventListener(e,t,!1)}function K2(i,e,t,n,r){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var a=n.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=n.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Ph(a),o===null)return;if(l=o.tag,l===5||l===6){n=s=o;continue e}a=a.parentNode}}n=n.return}XO(function(){var c=s,u=$C(t),h=[];e:{var d=S5.get(i);if(d!==void 0){var f=KC,m=i;switch(i){case"keypress":if(Hy(t)===0)break e;case"keydown":case"keyup":f=e7;break;case"focusin":m="focus",f=H2;break;case"focusout":m="blur",f=H2;break;case"beforeblur":case"afterblur":f=H2;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=ZI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=V$;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=i7;break;case _5:case y5:case x5:f=W$;break;case b5:f=s7;break;case"scroll":f=z$;break;case"wheel":f=a7;break;case"copy":case"cut":case"paste":f=X$;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=JI}var _=(e&4)!==0,v=!_&&i==="scroll",g=_?d!==null?d+"Capture":null:d;_=[];for(var b=c,p;b!==null;){p=b;var y=p.stateNode;if(p.tag===5&&y!==null&&(p=y,g!==null&&(y=h0(b,g),y!=null&&_.push(_0(b,y,p)))),v)break;b=b.return}0<_.length&&(d=new f(d,m,null,t,u),h.push({event:d,listeners:_}))}}if(!(e&7)){e:{if(d=i==="mouseover"||i==="pointerover",f=i==="mouseout"||i==="pointerout",d&&t!==aE&&(m=t.relatedTarget||t.fromElement)&&(Ph(m)||m[rc]))break e;if((f||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,f?(m=t.relatedTarget||t.toElement,f=c,m=m?Ph(m):null,m!==null&&(v=md(m),m!==v||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=c),f!==m)){if(_=ZI,y="onMouseLeave",g="onMouseEnter",b="mouse",(i==="pointerout"||i==="pointerover")&&(_=JI,y="onPointerLeave",g="onPointerEnter",b="pointer"),v=f==null?d:jf(f),p=m==null?d:jf(m),d=new _(y,b+"leave",f,t,u),d.target=v,d.relatedTarget=p,y=null,Ph(u)===c&&(_=new _(g,b+"enter",m,t,u),_.target=p,_.relatedTarget=v,y=_),v=y,f&&m)t:{for(_=f,g=m,b=0,p=_;p;p=Od(p))b++;for(p=0,y=g;y;y=Od(y))p++;for(;0<b-p;)_=Od(_),b--;for(;0<p-b;)g=Od(g),p--;for(;b--;){if(_===g||g!==null&&_===g.alternate)break t;_=Od(_),g=Od(g)}_=null}else _=null;f!==null&&uL(h,d,f,_,!1),m!==null&&v!==null&&uL(h,v,m,_,!0)}}e:{if(d=c?jf(c):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var A=p7;else if(nL(d))if(f5)A=_7;else{A=g7;var w=m7}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(A=v7);if(A&&(A=A(i,c))){d5(h,A,t,u);break e}w&&w(i,d,c),i==="focusout"&&(w=d._wrapperState)&&w.controlled&&d.type==="number"&&nE(d,"number",d.value)}switch(w=c?jf(c):window,i){case"focusin":(nL(w)||w.contentEditable==="true")&&($f=w,pE=c,Gg=null);break;case"focusout":Gg=pE=$f=null;break;case"mousedown":mE=!0;break;case"contextmenu":case"mouseup":case"dragend":mE=!1,aL(h,t,u);break;case"selectionchange":if(b7)break;case"keydown":case"keyup":aL(h,t,u)}var M;if(QC)e:{switch(i){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Hf?u5(i,t)&&(T="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(T="onCompositionStart");T&&(c5&&t.locale!=="ko"&&(Hf||T!=="onCompositionStart"?T==="onCompositionEnd"&&Hf&&(M=l5()):(tu=u,YC="value"in tu?tu.value:tu.textContent,Hf=!0)),w=Ix(c,T),0<w.length&&(T=new QI(T,i,null,t,u),h.push({event:T,listeners:w}),M?T.data=M:(M=h5(t),M!==null&&(T.data=M)))),(M=c7?u7(i,t):h7(i,t))&&(c=Ix(c,"onBeforeInput"),0<c.length&&(u=new QI("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=M))}w5(h,e)})}function _0(i,e,t){return{instance:i,listener:e,currentTarget:t}}function Ix(i,e){for(var t=e+"Capture",n=[];i!==null;){var r=i,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=h0(i,t),s!=null&&n.unshift(_0(i,s,r)),s=h0(i,e),s!=null&&n.push(_0(i,s,r))),i=i.return}return n}function Od(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function uL(i,e,t,n,r){for(var s=e._reactName,o=[];t!==null&&t!==n;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&c!==null&&(a=c,r?(l=h0(t,s),l!=null&&o.unshift(_0(t,l,a))):r||(l=h0(t,s),l!=null&&o.push(_0(t,l,a)))),t=t.return}o.length!==0&&i.push({event:e,listeners:o})}var A7=/\r\n?/g,E7=/\u0000|\uFFFD/g;function hL(i){return(typeof i=="string"?i:""+i).replace(A7,`
`).replace(E7,"")}function Dv(i,e,t){if(e=hL(e),hL(i)!==e&&t)throw Error(Ct(425))}function Lx(){}var gE=null,vE=null;function _E(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var yE=typeof setTimeout=="function"?setTimeout:void 0,T7=typeof clearTimeout=="function"?clearTimeout:void 0,dL=typeof Promise=="function"?Promise:void 0,C7=typeof queueMicrotask=="function"?queueMicrotask:typeof dL<"u"?function(i){return dL.resolve(null).then(i).catch(P7)}:yE;function P7(i){setTimeout(function(){throw i})}function Z2(i,e){var t=e,n=0;do{var r=t.nextSibling;if(i.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(n===0){i.removeChild(r),p0(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=r}while(t);p0(e)}function lu(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function fL(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var Kp=Math.random().toString(36).slice(2),Za="__reactFiber$"+Kp,y0="__reactProps$"+Kp,rc="__reactContainer$"+Kp,xE="__reactEvents$"+Kp,R7="__reactListeners$"+Kp,I7="__reactHandles$"+Kp;function Ph(i){var e=i[Za];if(e)return e;for(var t=i.parentNode;t;){if(e=t[rc]||t[Za]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=fL(i);i!==null;){if(t=i[Za])return t;i=fL(i)}return e}i=t,t=i.parentNode}return null}function l1(i){return i=i[Za]||i[rc],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function jf(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Ct(33))}function Nb(i){return i[y0]||null}var bE=[],Xf=-1;function Ru(i){return{current:i}}function li(i){0>Xf||(i.current=bE[Xf],bE[Xf]=null,Xf--)}function Jn(i,e){Xf++,bE[Xf]=i.current,i.current=e}var Su={},rs=Ru(Su),Xs=Ru(!1),Jh=Su;function Ap(i,e){var t=i.type.contextTypes;if(!t)return Su;var n=i.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=r),r}function qs(i){return i=i.childContextTypes,i!=null}function Dx(){li(Xs),li(rs)}function pL(i,e,t){if(rs.current!==Su)throw Error(Ct(168));Jn(rs,e),Jn(Xs,t)}function A5(i,e,t){var n=i.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(Ct(108,m$(i)||"Unknown",r));return Ci({},t,n)}function Nx(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Su,Jh=rs.current,Jn(rs,i),Jn(Xs,Xs.current),!0}function mL(i,e,t){var n=i.stateNode;if(!n)throw Error(Ct(169));t?(i=A5(i,e,Jh),n.__reactInternalMemoizedMergedChildContext=i,li(Xs),li(rs),Jn(rs,i)):li(Xs),Jn(Xs,t)}var $l=null,Fb=!1,Q2=!1;function E5(i){$l===null?$l=[i]:$l.push(i)}function L7(i){Fb=!0,E5(i)}function Iu(){if(!Q2&&$l!==null){Q2=!0;var i=0,e=Vn;try{var t=$l;for(Vn=1;i<t.length;i++){var n=t[i];do n=n(!0);while(n!==null)}$l=null,Fb=!1}catch(r){throw $l!==null&&($l=$l.slice(i+1)),ZO(WC,Iu),r}finally{Vn=e,Q2=!1}}return null}var qf=[],Yf=0,Fx=null,kx=0,Ho=[],$o=0,ed=null,Xl=1,ql="";function gh(i,e){qf[Yf++]=kx,qf[Yf++]=Fx,Fx=i,kx=e}function T5(i,e,t){Ho[$o++]=Xl,Ho[$o++]=ql,Ho[$o++]=ed,ed=i;var n=Xl;i=ql;var r=32-Pa(n)-1;n&=~(1<<r),t+=1;var s=32-Pa(e)+r;if(30<s){var o=r-r%5;s=(n&(1<<o)-1).toString(32),n>>=o,r-=o,Xl=1<<32-Pa(e)+r|t<<r|n,ql=s+i}else Xl=1<<s|t<<r|n,ql=i}function eP(i){i.return!==null&&(gh(i,1),T5(i,1,0))}function tP(i){for(;i===Fx;)Fx=qf[--Yf],qf[Yf]=null,kx=qf[--Yf],qf[Yf]=null;for(;i===ed;)ed=Ho[--$o],Ho[$o]=null,ql=Ho[--$o],Ho[$o]=null,Xl=Ho[--$o],Ho[$o]=null}var xo=null,yo=null,pi=!1,_a=null;function C5(i,e){var t=jo(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=i,e=i.deletions,e===null?(i.deletions=[t],i.flags|=16):e.push(t)}function gL(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,xo=i,yo=lu(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,xo=i,yo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=ed!==null?{id:Xl,overflow:ql}:null,i.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=jo(18,null,null,0),t.stateNode=e,t.return=i,i.child=t,xo=i,yo=null,!0):!1;default:return!1}}function SE(i){return(i.mode&1)!==0&&(i.flags&128)===0}function wE(i){if(pi){var e=yo;if(e){var t=e;if(!gL(i,e)){if(SE(i))throw Error(Ct(418));e=lu(t.nextSibling);var n=xo;e&&gL(i,e)?C5(n,t):(i.flags=i.flags&-4097|2,pi=!1,xo=i)}}else{if(SE(i))throw Error(Ct(418));i.flags=i.flags&-4097|2,pi=!1,xo=i}}}function vL(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;xo=i}function Nv(i){if(i!==xo)return!1;if(!pi)return vL(i),pi=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!_E(i.type,i.memoizedProps)),e&&(e=yo)){if(SE(i))throw P5(),Error(Ct(418));for(;e;)C5(i,e),e=lu(e.nextSibling)}if(vL(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ct(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){yo=lu(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}yo=null}}else yo=xo?lu(i.stateNode.nextSibling):null;return!0}function P5(){for(var i=yo;i;)i=lu(i.nextSibling)}function Ep(){yo=xo=null,pi=!1}function nP(i){_a===null?_a=[i]:_a.push(i)}var D7=mc.ReactCurrentBatchConfig;function zm(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Ct(309));var n=t.stateNode}if(!n)throw Error(Ct(147,i));var r=n,s=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof i!="string")throw Error(Ct(284));if(!t._owner)throw Error(Ct(290,i))}return i}function Fv(i,e){throw i=Object.prototype.toString.call(e),Error(Ct(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function _L(i){var e=i._init;return e(i._payload)}function R5(i){function e(g,b){if(i){var p=g.deletions;p===null?(g.deletions=[b],g.flags|=16):p.push(b)}}function t(g,b){if(!i)return null;for(;b!==null;)e(g,b),b=b.sibling;return null}function n(g,b){for(g=new Map;b!==null;)b.key!==null?g.set(b.key,b):g.set(b.index,b),b=b.sibling;return g}function r(g,b){return g=du(g,b),g.index=0,g.sibling=null,g}function s(g,b,p){return g.index=p,i?(p=g.alternate,p!==null?(p=p.index,p<b?(g.flags|=2,b):p):(g.flags|=2,b)):(g.flags|=1048576,b)}function o(g){return i&&g.alternate===null&&(g.flags|=2),g}function a(g,b,p,y){return b===null||b.tag!==6?(b=sw(p,g.mode,y),b.return=g,b):(b=r(b,p),b.return=g,b)}function l(g,b,p,y){var A=p.type;return A===Vf?u(g,b,p.props.children,y,p.key):b!==null&&(b.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===jc&&_L(A)===b.type)?(y=r(b,p.props),y.ref=zm(g,b,p),y.return=g,y):(y=Ky(p.type,p.key,p.props,null,g.mode,y),y.ref=zm(g,b,p),y.return=g,y)}function c(g,b,p,y){return b===null||b.tag!==4||b.stateNode.containerInfo!==p.containerInfo||b.stateNode.implementation!==p.implementation?(b=ow(p,g.mode,y),b.return=g,b):(b=r(b,p.children||[]),b.return=g,b)}function u(g,b,p,y,A){return b===null||b.tag!==7?(b=Bh(p,g.mode,y,A),b.return=g,b):(b=r(b,p),b.return=g,b)}function h(g,b,p){if(typeof b=="string"&&b!==""||typeof b=="number")return b=sw(""+b,g.mode,p),b.return=g,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Mv:return p=Ky(b.type,b.key,b.props,null,g.mode,p),p.ref=zm(g,null,b),p.return=g,p;case Gf:return b=ow(b,g.mode,p),b.return=g,b;case jc:var y=b._init;return h(g,y(b._payload),p)}if(bg(b)||Fm(b))return b=Bh(b,g.mode,p,null),b.return=g,b;Fv(g,b)}return null}function d(g,b,p,y){var A=b!==null?b.key:null;if(typeof p=="string"&&p!==""||typeof p=="number")return A!==null?null:a(g,b,""+p,y);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Mv:return p.key===A?l(g,b,p,y):null;case Gf:return p.key===A?c(g,b,p,y):null;case jc:return A=p._init,d(g,b,A(p._payload),y)}if(bg(p)||Fm(p))return A!==null?null:u(g,b,p,y,null);Fv(g,p)}return null}function f(g,b,p,y,A){if(typeof y=="string"&&y!==""||typeof y=="number")return g=g.get(p)||null,a(b,g,""+y,A);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Mv:return g=g.get(y.key===null?p:y.key)||null,l(b,g,y,A);case Gf:return g=g.get(y.key===null?p:y.key)||null,c(b,g,y,A);case jc:var w=y._init;return f(g,b,p,w(y._payload),A)}if(bg(y)||Fm(y))return g=g.get(p)||null,u(b,g,y,A,null);Fv(b,y)}return null}function m(g,b,p,y){for(var A=null,w=null,M=b,T=b=0,E=null;M!==null&&T<p.length;T++){M.index>T?(E=M,M=null):E=M.sibling;var C=d(g,M,p[T],y);if(C===null){M===null&&(M=E);break}i&&M&&C.alternate===null&&e(g,M),b=s(C,b,T),w===null?A=C:w.sibling=C,w=C,M=E}if(T===p.length)return t(g,M),pi&&gh(g,T),A;if(M===null){for(;T<p.length;T++)M=h(g,p[T],y),M!==null&&(b=s(M,b,T),w===null?A=M:w.sibling=M,w=M);return pi&&gh(g,T),A}for(M=n(g,M);T<p.length;T++)E=f(M,g,T,p[T],y),E!==null&&(i&&E.alternate!==null&&M.delete(E.key===null?T:E.key),b=s(E,b,T),w===null?A=E:w.sibling=E,w=E);return i&&M.forEach(function(N){return e(g,N)}),pi&&gh(g,T),A}function _(g,b,p,y){var A=Fm(p);if(typeof A!="function")throw Error(Ct(150));if(p=A.call(p),p==null)throw Error(Ct(151));for(var w=A=null,M=b,T=b=0,E=null,C=p.next();M!==null&&!C.done;T++,C=p.next()){M.index>T?(E=M,M=null):E=M.sibling;var N=d(g,M,C.value,y);if(N===null){M===null&&(M=E);break}i&&M&&N.alternate===null&&e(g,M),b=s(N,b,T),w===null?A=N:w.sibling=N,w=N,M=E}if(C.done)return t(g,M),pi&&gh(g,T),A;if(M===null){for(;!C.done;T++,C=p.next())C=h(g,C.value,y),C!==null&&(b=s(C,b,T),w===null?A=C:w.sibling=C,w=C);return pi&&gh(g,T),A}for(M=n(g,M);!C.done;T++,C=p.next())C=f(M,g,T,C.value,y),C!==null&&(i&&C.alternate!==null&&M.delete(C.key===null?T:C.key),b=s(C,b,T),w===null?A=C:w.sibling=C,w=C);return i&&M.forEach(function(P){return e(g,P)}),pi&&gh(g,T),A}function v(g,b,p,y){if(typeof p=="object"&&p!==null&&p.type===Vf&&p.key===null&&(p=p.props.children),typeof p=="object"&&p!==null){switch(p.$$typeof){case Mv:e:{for(var A=p.key,w=b;w!==null;){if(w.key===A){if(A=p.type,A===Vf){if(w.tag===7){t(g,w.sibling),b=r(w,p.props.children),b.return=g,g=b;break e}}else if(w.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===jc&&_L(A)===w.type){t(g,w.sibling),b=r(w,p.props),b.ref=zm(g,w,p),b.return=g,g=b;break e}t(g,w);break}else e(g,w);w=w.sibling}p.type===Vf?(b=Bh(p.props.children,g.mode,y,p.key),b.return=g,g=b):(y=Ky(p.type,p.key,p.props,null,g.mode,y),y.ref=zm(g,b,p),y.return=g,g=y)}return o(g);case Gf:e:{for(w=p.key;b!==null;){if(b.key===w)if(b.tag===4&&b.stateNode.containerInfo===p.containerInfo&&b.stateNode.implementation===p.implementation){t(g,b.sibling),b=r(b,p.children||[]),b.return=g,g=b;break e}else{t(g,b);break}else e(g,b);b=b.sibling}b=ow(p,g.mode,y),b.return=g,g=b}return o(g);case jc:return w=p._init,v(g,b,w(p._payload),y)}if(bg(p))return m(g,b,p,y);if(Fm(p))return _(g,b,p,y);Fv(g,p)}return typeof p=="string"&&p!==""||typeof p=="number"?(p=""+p,b!==null&&b.tag===6?(t(g,b.sibling),b=r(b,p),b.return=g,g=b):(t(g,b),b=sw(p,g.mode,y),b.return=g,g=b),o(g)):t(g,b)}return v}var Tp=R5(!0),I5=R5(!1),Ux=Ru(null),Ox=null,Kf=null,iP=null;function rP(){iP=Kf=Ox=null}function sP(i){var e=Ux.current;li(Ux),i._currentValue=e}function ME(i,e,t){for(;i!==null;){var n=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),i===t)break;i=i.return}}function pp(i,e){Ox=i,iP=Kf=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(js=!0),i.firstContext=null)}function Ko(i){var e=i._currentValue;if(iP!==i)if(i={context:i,memoizedValue:e,next:null},Kf===null){if(Ox===null)throw Error(Ct(308));Kf=i,Ox.dependencies={lanes:0,firstContext:i}}else Kf=Kf.next=i;return e}var Rh=null;function oP(i){Rh===null?Rh=[i]:Rh.push(i)}function L5(i,e,t,n){var r=e.interleaved;return r===null?(t.next=t,oP(e)):(t.next=r.next,r.next=t),e.interleaved=t,sc(i,n)}function sc(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}var Xc=!1;function aP(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function D5(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Jl(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function cu(i,e,t){var n=i.updateQueue;if(n===null)return null;if(n=n.shared,Cn&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,sc(i,t)}return r=n.interleaved,r===null?(e.next=e,oP(n)):(e.next=r.next,r.next=e),n.interleaved=e,sc(i,t)}function $y(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,jC(i,t)}}function yL(i,e){var t=i.updateQueue,n=i.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:n.shared,effects:n.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function Bx(i,e,t,n){var r=i.updateQueue;Xc=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=i.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;o=0,u=c=l=null,a=s;do{var d=a.lane,f=a.eventTime;if((n&d)===d){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=i,_=a;switch(d=e,f=t,_.tag){case 1:if(m=_.payload,typeof m=="function"){h=m.call(f,h,d);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=_.payload,d=typeof m=="function"?m.call(f,h,d):m,d==null)break e;h=Ci({},h,d);break e;case 2:Xc=!0}}a.callback!==null&&a.lane!==0&&(i.flags|=64,d=r.effects,d===null?r.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=h):u=u.next=f,o|=d;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;d=a,a=d.next,d.next=null,r.lastBaseUpdate=d,r.shared.pending=null}}while(!0);if(u===null&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);nd|=o,i.lanes=o,i.memoizedState=h}}function xL(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var n=i[e],r=n.callback;if(r!==null){if(n.callback=null,n=t,typeof r!="function")throw Error(Ct(191,r));r.call(n)}}}var c1={},nl=Ru(c1),x0=Ru(c1),b0=Ru(c1);function Ih(i){if(i===c1)throw Error(Ct(174));return i}function lP(i,e){switch(Jn(b0,e),Jn(x0,i),Jn(nl,c1),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:rE(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=rE(e,i)}li(nl),Jn(nl,e)}function Cp(){li(nl),li(x0),li(b0)}function N5(i){Ih(b0.current);var e=Ih(nl.current),t=rE(e,i.type);e!==t&&(Jn(x0,i),Jn(nl,t))}function cP(i){x0.current===i&&(li(nl),li(x0))}var bi=Ru(0);function zx(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var J2=[];function uP(){for(var i=0;i<J2.length;i++)J2[i]._workInProgressVersionPrimary=null;J2.length=0}var Wy=mc.ReactCurrentDispatcher,ew=mc.ReactCurrentBatchConfig,td=0,Ei=null,ar=null,wr=null,Gx=!1,Vg=!1,S0=0,N7=0;function Wr(){throw Error(Ct(321))}function hP(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!Da(i[t],e[t]))return!1;return!0}function dP(i,e,t,n,r,s){if(td=s,Ei=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Wy.current=i===null||i.memoizedState===null?O7:B7,i=t(n,r),Vg){s=0;do{if(Vg=!1,S0=0,25<=s)throw Error(Ct(301));s+=1,wr=ar=null,e.updateQueue=null,Wy.current=z7,i=t(n,r)}while(Vg)}if(Wy.current=Vx,e=ar!==null&&ar.next!==null,td=0,wr=ar=Ei=null,Gx=!1,e)throw Error(Ct(300));return i}function fP(){var i=S0!==0;return S0=0,i}function qa(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wr===null?Ei.memoizedState=wr=i:wr=wr.next=i,wr}function Zo(){if(ar===null){var i=Ei.alternate;i=i!==null?i.memoizedState:null}else i=ar.next;var e=wr===null?Ei.memoizedState:wr.next;if(e!==null)wr=e,ar=i;else{if(i===null)throw Error(Ct(310));ar=i,i={memoizedState:ar.memoizedState,baseState:ar.baseState,baseQueue:ar.baseQueue,queue:ar.queue,next:null},wr===null?Ei.memoizedState=wr=i:wr=wr.next=i}return wr}function w0(i,e){return typeof e=="function"?e(i):e}function tw(i){var e=Zo(),t=e.queue;if(t===null)throw Error(Ct(311));t.lastRenderedReducer=i;var n=ar,r=n.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}n.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,n=n.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((td&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),n=c.hasEagerState?c.eagerState:i(n,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=n):l=l.next=h,Ei.lanes|=u,nd|=u}c=c.next}while(c!==null&&c!==s);l===null?o=n:l.next=a,Da(n,e.memoizedState)||(js=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=l,t.lastRenderedState=n}if(i=t.interleaved,i!==null){r=i;do s=r.lane,Ei.lanes|=s,nd|=s,r=r.next;while(r!==i)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function nw(i){var e=Zo(),t=e.queue;if(t===null)throw Error(Ct(311));t.lastRenderedReducer=i;var n=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=i(s,o.action),o=o.next;while(o!==r);Da(s,e.memoizedState)||(js=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function F5(){}function k5(i,e){var t=Ei,n=Zo(),r=e(),s=!Da(n.memoizedState,r);if(s&&(n.memoizedState=r,js=!0),n=n.queue,pP(B5.bind(null,t,n,i),[i]),n.getSnapshot!==e||s||wr!==null&&wr.memoizedState.tag&1){if(t.flags|=2048,M0(9,O5.bind(null,t,n,r,e),void 0,null),Ar===null)throw Error(Ct(349));td&30||U5(t,e,r)}return r}function U5(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=Ei.updateQueue,e===null?(e={lastEffect:null,stores:null},Ei.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function O5(i,e,t,n){e.value=t,e.getSnapshot=n,z5(e)&&G5(i)}function B5(i,e,t){return t(function(){z5(e)&&G5(i)})}function z5(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!Da(i,t)}catch{return!0}}function G5(i){var e=sc(i,1);e!==null&&Ra(e,i,1,-1)}function bL(i){var e=qa();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:w0,lastRenderedState:i},e.queue=i,i=i.dispatch=U7.bind(null,Ei,i),[e.memoizedState,i]}function M0(i,e,t,n){return i={tag:i,create:e,destroy:t,deps:n,next:null},e=Ei.updateQueue,e===null?(e={lastEffect:null,stores:null},Ei.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(n=t.next,t.next=i,i.next=n,e.lastEffect=i)),i}function V5(){return Zo().memoizedState}function jy(i,e,t,n){var r=qa();Ei.flags|=i,r.memoizedState=M0(1|e,t,void 0,n===void 0?null:n)}function kb(i,e,t,n){var r=Zo();n=n===void 0?null:n;var s=void 0;if(ar!==null){var o=ar.memoizedState;if(s=o.destroy,n!==null&&hP(n,o.deps)){r.memoizedState=M0(e,t,s,n);return}}Ei.flags|=i,r.memoizedState=M0(1|e,t,s,n)}function SL(i,e){return jy(8390656,8,i,e)}function pP(i,e){return kb(2048,8,i,e)}function H5(i,e){return kb(4,2,i,e)}function $5(i,e){return kb(4,4,i,e)}function W5(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function j5(i,e,t){return t=t!=null?t.concat([i]):null,kb(4,4,W5.bind(null,e,i),t)}function mP(){}function X5(i,e){var t=Zo();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&hP(e,n[1])?n[0]:(t.memoizedState=[i,e],i)}function q5(i,e){var t=Zo();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&hP(e,n[1])?n[0]:(i=i(),t.memoizedState=[i,e],i)}function Y5(i,e,t){return td&21?(Da(t,e)||(t=e5(),Ei.lanes|=t,nd|=t,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,js=!0),i.memoizedState=t)}function F7(i,e){var t=Vn;Vn=t!==0&&4>t?t:4,i(!0);var n=ew.transition;ew.transition={};try{i(!1),e()}finally{Vn=t,ew.transition=n}}function K5(){return Zo().memoizedState}function k7(i,e,t){var n=hu(i);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},Z5(i))Q5(e,t);else if(t=L5(i,e,t,n),t!==null){var r=ws();Ra(t,i,n,r),J5(t,e,n)}}function U7(i,e,t){var n=hu(i),r={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(Z5(i))Q5(e,r);else{var s=i.alternate;if(i.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(r.hasEagerState=!0,r.eagerState=a,Da(a,o)){var l=e.interleaved;l===null?(r.next=r,oP(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=L5(i,e,r,n),t!==null&&(r=ws(),Ra(t,i,n,r),J5(t,e,n))}}function Z5(i){var e=i.alternate;return i===Ei||e!==null&&e===Ei}function Q5(i,e){Vg=Gx=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function J5(i,e,t){if(t&4194240){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,jC(i,t)}}var Vx={readContext:Ko,useCallback:Wr,useContext:Wr,useEffect:Wr,useImperativeHandle:Wr,useInsertionEffect:Wr,useLayoutEffect:Wr,useMemo:Wr,useReducer:Wr,useRef:Wr,useState:Wr,useDebugValue:Wr,useDeferredValue:Wr,useTransition:Wr,useMutableSource:Wr,useSyncExternalStore:Wr,useId:Wr,unstable_isNewReconciler:!1},O7={readContext:Ko,useCallback:function(i,e){return qa().memoizedState=[i,e===void 0?null:e],i},useContext:Ko,useEffect:SL,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,jy(4194308,4,W5.bind(null,e,i),t)},useLayoutEffect:function(i,e){return jy(4194308,4,i,e)},useInsertionEffect:function(i,e){return jy(4,2,i,e)},useMemo:function(i,e){var t=qa();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var n=qa();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},n.queue=i,i=i.dispatch=k7.bind(null,Ei,i),[n.memoizedState,i]},useRef:function(i){var e=qa();return i={current:i},e.memoizedState=i},useState:bL,useDebugValue:mP,useDeferredValue:function(i){return qa().memoizedState=i},useTransition:function(){var i=bL(!1),e=i[0];return i=F7.bind(null,i[1]),qa().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,t){var n=Ei,r=qa();if(pi){if(t===void 0)throw Error(Ct(407));t=t()}else{if(t=e(),Ar===null)throw Error(Ct(349));td&30||U5(n,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,SL(B5.bind(null,n,s,i),[i]),n.flags|=2048,M0(9,O5.bind(null,n,s,t,e),void 0,null),t},useId:function(){var i=qa(),e=Ar.identifierPrefix;if(pi){var t=ql,n=Xl;t=(n&~(1<<32-Pa(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=S0++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=N7++,e=":"+e+"r"+t.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},B7={readContext:Ko,useCallback:X5,useContext:Ko,useEffect:pP,useImperativeHandle:j5,useInsertionEffect:H5,useLayoutEffect:$5,useMemo:q5,useReducer:tw,useRef:V5,useState:function(){return tw(w0)},useDebugValue:mP,useDeferredValue:function(i){var e=Zo();return Y5(e,ar.memoizedState,i)},useTransition:function(){var i=tw(w0)[0],e=Zo().memoizedState;return[i,e]},useMutableSource:F5,useSyncExternalStore:k5,useId:K5,unstable_isNewReconciler:!1},z7={readContext:Ko,useCallback:X5,useContext:Ko,useEffect:pP,useImperativeHandle:j5,useInsertionEffect:H5,useLayoutEffect:$5,useMemo:q5,useReducer:nw,useRef:V5,useState:function(){return nw(w0)},useDebugValue:mP,useDeferredValue:function(i){var e=Zo();return ar===null?e.memoizedState=i:Y5(e,ar.memoizedState,i)},useTransition:function(){var i=nw(w0)[0],e=Zo().memoizedState;return[i,e]},useMutableSource:F5,useSyncExternalStore:k5,useId:K5,unstable_isNewReconciler:!1};function pa(i,e){if(i&&i.defaultProps){e=Ci({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}function AE(i,e,t,n){e=i.memoizedState,t=t(n,e),t=t==null?e:Ci({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var Ub={isMounted:function(i){return(i=i._reactInternals)?md(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var n=ws(),r=hu(i),s=Jl(n,r);s.payload=e,t!=null&&(s.callback=t),e=cu(i,s,r),e!==null&&(Ra(e,i,r,n),$y(e,i,r))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var n=ws(),r=hu(i),s=Jl(n,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=cu(i,s,r),e!==null&&(Ra(e,i,r,n),$y(e,i,r))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=ws(),n=hu(i),r=Jl(t,n);r.tag=2,e!=null&&(r.callback=e),e=cu(i,r,n),e!==null&&(Ra(e,i,n,t),$y(e,i,n))}};function wL(i,e,t,n,r,s,o){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(n,s,o):e.prototype&&e.prototype.isPureReactComponent?!g0(t,n)||!g0(r,s):!0}function eB(i,e,t){var n=!1,r=Su,s=e.contextType;return typeof s=="object"&&s!==null?s=Ko(s):(r=qs(e)?Jh:rs.current,n=e.contextTypes,s=(n=n!=null)?Ap(i,r):Su),e=new e(t,s),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ub,i.stateNode=e,e._reactInternals=i,n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=s),e}function ML(i,e,t,n){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==i&&Ub.enqueueReplaceState(e,e.state,null)}function EE(i,e,t,n){var r=i.stateNode;r.props=t,r.state=i.memoizedState,r.refs={},aP(i);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Ko(s):(s=qs(e)?Jh:rs.current,r.context=Ap(i,s)),r.state=i.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(AE(i,e,s,t),r.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Ub.enqueueReplaceState(r,r.state,null),Bx(i,t,r,n),r.state=i.memoizedState),typeof r.componentDidMount=="function"&&(i.flags|=4194308)}function Pp(i,e){try{var t="",n=e;do t+=p$(n),n=n.return;while(n);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:i,source:e,stack:r,digest:null}}function iw(i,e,t){return{value:i,source:null,stack:t??null,digest:e??null}}function TE(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var G7=typeof WeakMap=="function"?WeakMap:Map;function tB(i,e,t){t=Jl(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){$x||($x=!0,UE=n),TE(i,e)},t}function nB(i,e,t){t=Jl(-1,t),t.tag=3;var n=i.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;t.payload=function(){return n(r)},t.callback=function(){TE(i,e)}}var s=i.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){TE(i,e),typeof n!="function"&&(uu===null?uu=new Set([this]):uu.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function AL(i,e,t){var n=i.pingCache;if(n===null){n=i.pingCache=new G7;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(t)||(r.add(t),i=t9.bind(null,i,e,t),e.then(i,i))}function EL(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function TL(i,e,t,n,r){return i.mode&1?(i.flags|=65536,i.lanes=r,i):(i===e?i.flags|=65536:(i.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Jl(-1,1),e.tag=2,cu(t,e,1))),t.lanes|=1),i)}var V7=mc.ReactCurrentOwner,js=!1;function xs(i,e,t,n){e.child=i===null?I5(e,null,t,n):Tp(e,i.child,t,n)}function CL(i,e,t,n,r){t=t.render;var s=e.ref;return pp(e,r),n=dP(i,e,t,n,s,r),t=fP(),i!==null&&!js?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,oc(i,e,r)):(pi&&t&&eP(e),e.flags|=1,xs(i,e,n,r),e.child)}function PL(i,e,t,n,r){if(i===null){var s=t.type;return typeof s=="function"&&!wP(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,iB(i,e,s,n,r)):(i=Ky(t.type,null,n,e,e.mode,r),i.ref=e.ref,i.return=e,e.child=i)}if(s=i.child,!(i.lanes&r)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:g0,t(o,n)&&i.ref===e.ref)return oc(i,e,r)}return e.flags|=1,i=du(s,n),i.ref=e.ref,i.return=e,e.child=i}function iB(i,e,t,n,r){if(i!==null){var s=i.memoizedProps;if(g0(s,n)&&i.ref===e.ref)if(js=!1,e.pendingProps=n=s,(i.lanes&r)!==0)i.flags&131072&&(js=!0);else return e.lanes=i.lanes,oc(i,e,r)}return CE(i,e,t,n,r)}function rB(i,e,t){var n=e.pendingProps,r=n.children,s=i!==null?i.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Jn(Qf,go),go|=t;else{if(!(t&1073741824))return i=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,Jn(Qf,go),go|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,Jn(Qf,go),go|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,Jn(Qf,go),go|=n;return xs(i,e,r,t),e.child}function sB(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function CE(i,e,t,n,r){var s=qs(t)?Jh:rs.current;return s=Ap(e,s),pp(e,r),t=dP(i,e,t,n,s,r),n=fP(),i!==null&&!js?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~r,oc(i,e,r)):(pi&&n&&eP(e),e.flags|=1,xs(i,e,t,r),e.child)}function RL(i,e,t,n,r){if(qs(t)){var s=!0;Nx(e)}else s=!1;if(pp(e,r),e.stateNode===null)Xy(i,e),eB(e,t,n),EE(e,t,n,r),n=!0;else if(i===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=Ko(c):(c=qs(t)?Jh:rs.current,c=Ap(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==n||l!==c)&&ML(e,o,n,c),Xc=!1;var d=e.memoizedState;o.state=d,Bx(e,n,o,r),l=e.memoizedState,a!==n||d!==l||Xs.current||Xc?(typeof u=="function"&&(AE(e,t,u,n),l=e.memoizedState),(a=Xc||wL(e,t,a,n,d,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),o.props=n,o.state=l,o.context=c,n=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,D5(i,e),a=e.memoizedProps,c=e.type===e.elementType?a:pa(e.type,a),o.props=c,h=e.pendingProps,d=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=Ko(l):(l=qs(t)?Jh:rs.current,l=Ap(e,l));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&ML(e,o,n,l),Xc=!1,d=e.memoizedState,o.state=d,Bx(e,n,o,r);var m=e.memoizedState;a!==h||d!==m||Xs.current||Xc?(typeof f=="function"&&(AE(e,t,f,n),m=e.memoizedState),(c=Xc||wL(e,t,c,n,d,m,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,m,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,m,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=m),o.props=n,o.state=m,o.context=l,n=c):(typeof o.componentDidUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===i.memoizedProps&&d===i.memoizedState||(e.flags|=1024),n=!1)}return PE(i,e,t,n,s,r)}function PE(i,e,t,n,r,s){sB(i,e);var o=(e.flags&128)!==0;if(!n&&!o)return r&&mL(e,t,!1),oc(i,e,s);n=e.stateNode,V7.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,i!==null&&o?(e.child=Tp(e,i.child,null,s),e.child=Tp(e,null,a,s)):xs(i,e,a,s),e.memoizedState=n.state,r&&mL(e,t,!0),e.child}function oB(i){var e=i.stateNode;e.pendingContext?pL(i,e.pendingContext,e.pendingContext!==e.context):e.context&&pL(i,e.context,!1),lP(i,e.containerInfo)}function IL(i,e,t,n,r){return Ep(),nP(r),e.flags|=256,xs(i,e,t,n),e.child}var RE={dehydrated:null,treeContext:null,retryLane:0};function IE(i){return{baseLanes:i,cachePool:null,transitions:null}}function aB(i,e,t){var n=e.pendingProps,r=bi.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=i!==null&&i.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(r|=1),Jn(bi,r&1),i===null)return wE(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,i=n.fallback,s?(n=e.mode,s=e.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=zb(o,n,0,null),i=Bh(i,n,t,null),s.return=e,i.return=e,s.sibling=i,e.child=s,e.child.memoizedState=IE(t),e.memoizedState=RE,i):gP(e,o));if(r=i.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return H7(i,e,o,n,a,r,t);if(s){s=n.fallback,o=e.mode,r=i.child,a=r.sibling;var l={mode:"hidden",children:n.children};return!(o&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=du(r,l),n.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=du(a,s):(s=Bh(s,o,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,o=i.child.memoizedState,o=o===null?IE(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=i.childLanes&~t,e.memoizedState=RE,n}return s=i.child,i=s.sibling,n=du(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,i!==null&&(t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)),e.child=n,e.memoizedState=null,n}function gP(i,e){return e=zb({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function kv(i,e,t,n){return n!==null&&nP(n),Tp(e,i.child,null,t),i=gP(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function H7(i,e,t,n,r,s,o){if(t)return e.flags&256?(e.flags&=-257,n=iw(Error(Ct(422))),kv(i,e,o,n)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(s=n.fallback,r=e.mode,n=zb({mode:"visible",children:n.children},r,0,null),s=Bh(s,r,o,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&Tp(e,i.child,null,o),e.child.memoizedState=IE(o),e.memoizedState=RE,s);if(!(e.mode&1))return kv(i,e,o,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(Ct(419)),n=iw(s,n,void 0),kv(i,e,o,n)}if(a=(o&i.childLanes)!==0,js||a){if(n=Ar,n!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,sc(i,r),Ra(n,i,r,-1))}return SP(),n=iw(Error(Ct(421))),kv(i,e,o,n)}return r.data==="$?"?(e.flags|=128,e.child=i.child,e=n9.bind(null,i),r._reactRetry=e,null):(i=s.treeContext,yo=lu(r.nextSibling),xo=e,pi=!0,_a=null,i!==null&&(Ho[$o++]=Xl,Ho[$o++]=ql,Ho[$o++]=ed,Xl=i.id,ql=i.overflow,ed=e),e=gP(e,n.children),e.flags|=4096,e)}function LL(i,e,t){i.lanes|=e;var n=i.alternate;n!==null&&(n.lanes|=e),ME(i.return,e,t)}function rw(i,e,t,n,r){var s=i.memoizedState;s===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=r)}function lB(i,e,t){var n=e.pendingProps,r=n.revealOrder,s=n.tail;if(xs(i,e,n.children,t),n=bi.current,n&2)n=n&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&LL(i,t,e);else if(i.tag===19)LL(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}n&=1}if(Jn(bi,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)i=t.alternate,i!==null&&zx(i)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),rw(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(i=r.alternate,i!==null&&zx(i)===null){e.child=r;break}i=r.sibling,r.sibling=t,t=r,r=i}rw(e,!0,t,null,s);break;case"together":rw(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Xy(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function oc(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),nd|=e.lanes,!(t&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(Ct(153));if(e.child!==null){for(i=e.child,t=du(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=du(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function $7(i,e,t){switch(e.tag){case 3:oB(e),Ep();break;case 5:N5(e);break;case 1:qs(e.type)&&Nx(e);break;case 4:lP(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;Jn(Ux,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(Jn(bi,bi.current&1),e.flags|=128,null):t&e.child.childLanes?aB(i,e,t):(Jn(bi,bi.current&1),i=oc(i,e,t),i!==null?i.sibling:null);Jn(bi,bi.current&1);break;case 19:if(n=(t&e.childLanes)!==0,i.flags&128){if(n)return lB(i,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Jn(bi,bi.current),n)break;return null;case 22:case 23:return e.lanes=0,rB(i,e,t)}return oc(i,e,t)}var cB,LE,uB,hB;cB=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};LE=function(){};uB=function(i,e,t,n){var r=i.memoizedProps;if(r!==n){i=e.stateNode,Ih(nl.current);var s=null;switch(t){case"input":r=eE(i,r),n=eE(i,n),s=[];break;case"select":r=Ci({},r,{value:void 0}),n=Ci({},n,{value:void 0}),s=[];break;case"textarea":r=iE(i,r),n=iE(i,n),s=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(i.onclick=Lx)}sE(t,n);var o;t=null;for(c in r)if(!n.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(c0.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in n){var l=n[c];if(a=r!=null?r[c]:void 0,n.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(c0.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ii("scroll",i),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};hB=function(i,e,t,n){t!==n&&(e.flags|=4)};function Gm(i,e){if(!pi)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:n.sibling=null}}function jr(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,n=0;if(e)for(var r=i.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=i,r=r.sibling;else for(r=i.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=i,r=r.sibling;return i.subtreeFlags|=n,i.childLanes=t,e}function W7(i,e,t){var n=e.pendingProps;switch(tP(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jr(e),null;case 1:return qs(e.type)&&Dx(),jr(e),null;case 3:return n=e.stateNode,Cp(),li(Xs),li(rs),uP(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(i===null||i.child===null)&&(Nv(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,_a!==null&&(zE(_a),_a=null))),LE(i,e),jr(e),null;case 5:cP(e);var r=Ih(b0.current);if(t=e.type,i!==null&&e.stateNode!=null)uB(i,e,t,n,r),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Ct(166));return jr(e),null}if(i=Ih(nl.current),Nv(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[Za]=e,n[y0]=s,i=(e.mode&1)!==0,t){case"dialog":ii("cancel",n),ii("close",n);break;case"iframe":case"object":case"embed":ii("load",n);break;case"video":case"audio":for(r=0;r<wg.length;r++)ii(wg[r],n);break;case"source":ii("error",n);break;case"img":case"image":case"link":ii("error",n),ii("load",n);break;case"details":ii("toggle",n);break;case"input":GI(n,s),ii("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},ii("invalid",n);break;case"textarea":HI(n,s),ii("invalid",n)}sE(t,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&Dv(n.textContent,a,i),r=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Dv(n.textContent,a,i),r=["children",""+a]):c0.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ii("scroll",n)}switch(t){case"input":Av(n),VI(n,s,!0);break;case"textarea":Av(n),$I(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=Lx)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=BO(t)),i==="http://www.w3.org/1999/xhtml"?t==="script"?(i=o.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof n.is=="string"?i=o.createElement(t,{is:n.is}):(i=o.createElement(t),t==="select"&&(o=i,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):i=o.createElementNS(i,t),i[Za]=e,i[y0]=n,cB(i,e,!1,!1),e.stateNode=i;e:{switch(o=oE(t,n),t){case"dialog":ii("cancel",i),ii("close",i),r=n;break;case"iframe":case"object":case"embed":ii("load",i),r=n;break;case"video":case"audio":for(r=0;r<wg.length;r++)ii(wg[r],i);r=n;break;case"source":ii("error",i),r=n;break;case"img":case"image":case"link":ii("error",i),ii("load",i),r=n;break;case"details":ii("toggle",i),r=n;break;case"input":GI(i,n),r=eE(i,n),ii("invalid",i);break;case"option":r=n;break;case"select":i._wrapperState={wasMultiple:!!n.multiple},r=Ci({},n,{value:void 0}),ii("invalid",i);break;case"textarea":HI(i,n),r=iE(i,n),ii("invalid",i);break;default:r=n}sE(t,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?VO(i,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&zO(i,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&u0(i,l):typeof l=="number"&&u0(i,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(c0.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ii("scroll",i):l!=null&&zC(i,s,l,o))}switch(t){case"input":Av(i),VI(i,n,!1);break;case"textarea":Av(i),$I(i);break;case"option":n.value!=null&&i.setAttribute("value",""+bu(n.value));break;case"select":i.multiple=!!n.multiple,s=n.value,s!=null?up(i,!!n.multiple,s,!1):n.defaultValue!=null&&up(i,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(i.onclick=Lx)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return jr(e),null;case 6:if(i&&e.stateNode!=null)hB(i,e,i.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Ct(166));if(t=Ih(b0.current),Ih(nl.current),Nv(e)){if(n=e.stateNode,t=e.memoizedProps,n[Za]=e,(s=n.nodeValue!==t)&&(i=xo,i!==null))switch(i.tag){case 3:Dv(n.nodeValue,t,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Dv(n.nodeValue,t,(i.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Za]=e,e.stateNode=n}return jr(e),null;case 13:if(li(bi),n=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(pi&&yo!==null&&e.mode&1&&!(e.flags&128))P5(),Ep(),e.flags|=98560,s=!1;else if(s=Nv(e),n!==null&&n.dehydrated!==null){if(i===null){if(!s)throw Error(Ct(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Ct(317));s[Za]=e}else Ep(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;jr(e),s=!1}else _a!==null&&(zE(_a),_a=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(i!==null&&i.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(i===null||bi.current&1?cr===0&&(cr=3):SP())),e.updateQueue!==null&&(e.flags|=4),jr(e),null);case 4:return Cp(),LE(i,e),i===null&&v0(e.stateNode.containerInfo),jr(e),null;case 10:return sP(e.type._context),jr(e),null;case 17:return qs(e.type)&&Dx(),jr(e),null;case 19:if(li(bi),s=e.memoizedState,s===null)return jr(e),null;if(n=(e.flags&128)!==0,o=s.rendering,o===null)if(n)Gm(s,!1);else{if(cr!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(o=zx(i),o!==null){for(e.flags|=128,Gm(s,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,i=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,i=o.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return Jn(bi,bi.current&1|2),e.child}i=i.sibling}s.tail!==null&&Vi()>Rp&&(e.flags|=128,n=!0,Gm(s,!1),e.lanes=4194304)}else{if(!n)if(i=zx(o),i!==null){if(e.flags|=128,n=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Gm(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!pi)return jr(e),null}else 2*Vi()-s.renderingStartTime>Rp&&t!==1073741824&&(e.flags|=128,n=!0,Gm(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Vi(),e.sibling=null,t=bi.current,Jn(bi,n?t&1|2:t&1),e):(jr(e),null);case 22:case 23:return bP(),n=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?go&1073741824&&(jr(e),e.subtreeFlags&6&&(e.flags|=8192)):jr(e),null;case 24:return null;case 25:return null}throw Error(Ct(156,e.tag))}function j7(i,e){switch(tP(e),e.tag){case 1:return qs(e.type)&&Dx(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Cp(),li(Xs),li(rs),uP(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return cP(e),null;case 13:if(li(bi),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(Ct(340));Ep()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return li(bi),null;case 4:return Cp(),null;case 10:return sP(e.type._context),null;case 22:case 23:return bP(),null;case 24:return null;default:return null}}var Uv=!1,Jr=!1,X7=typeof WeakSet=="function"?WeakSet:Set,Gt=null;function Zf(i,e){var t=i.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Di(i,e,n)}else t.current=null}function DE(i,e,t){try{t()}catch(n){Di(i,e,n)}}var DL=!1;function q7(i,e){if(gE=Px,i=g5(),JC(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var r=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=i,d=null;t:for(;;){for(var f;h!==t||r!==0&&h.nodeType!==3||(a=o+r),h!==s||n!==0&&h.nodeType!==3||(l=o+n),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===i)break t;if(d===t&&++c===r&&(a=o),d===s&&++u===n&&(l=o),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(vE={focusedElem:i,selectionRange:t},Px=!1,Gt=e;Gt!==null;)if(e=Gt,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,Gt=i;else for(;Gt!==null;){e=Gt;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var _=m.memoizedProps,v=m.memoizedState,g=e.stateNode,b=g.getSnapshotBeforeUpdate(e.elementType===e.type?_:pa(e.type,_),v);g.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var p=e.stateNode.containerInfo;p.nodeType===1?p.textContent="":p.nodeType===9&&p.documentElement&&p.removeChild(p.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ct(163))}}catch(y){Di(e,e.return,y)}if(i=e.sibling,i!==null){i.return=e.return,Gt=i;break}Gt=e.return}return m=DL,DL=!1,m}function Hg(i,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&i)===i){var s=r.destroy;r.destroy=void 0,s!==void 0&&DE(e,t,s)}r=r.next}while(r!==n)}}function Ob(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&i)===i){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function NE(i){var e=i.ref;if(e!==null){var t=i.stateNode;switch(i.tag){case 5:i=t;break;default:i=t}typeof e=="function"?e(i):e.current=i}}function dB(i){var e=i.alternate;e!==null&&(i.alternate=null,dB(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[Za],delete e[y0],delete e[xE],delete e[R7],delete e[I7])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function fB(i){return i.tag===5||i.tag===3||i.tag===4}function NL(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||fB(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function FE(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Lx));else if(n!==4&&(i=i.child,i!==null))for(FE(i,e,t),i=i.sibling;i!==null;)FE(i,e,t),i=i.sibling}function kE(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(n!==4&&(i=i.child,i!==null))for(kE(i,e,t),i=i.sibling;i!==null;)kE(i,e,t),i=i.sibling}var Lr=null,ga=!1;function Pc(i,e,t){for(t=t.child;t!==null;)pB(i,e,t),t=t.sibling}function pB(i,e,t){if(tl&&typeof tl.onCommitFiberUnmount=="function")try{tl.onCommitFiberUnmount(Rb,t)}catch{}switch(t.tag){case 5:Jr||Zf(t,e);case 6:var n=Lr,r=ga;Lr=null,Pc(i,e,t),Lr=n,ga=r,Lr!==null&&(ga?(i=Lr,t=t.stateNode,i.nodeType===8?i.parentNode.removeChild(t):i.removeChild(t)):Lr.removeChild(t.stateNode));break;case 18:Lr!==null&&(ga?(i=Lr,t=t.stateNode,i.nodeType===8?Z2(i.parentNode,t):i.nodeType===1&&Z2(i,t),p0(i)):Z2(Lr,t.stateNode));break;case 4:n=Lr,r=ga,Lr=t.stateNode.containerInfo,ga=!0,Pc(i,e,t),Lr=n,ga=r;break;case 0:case 11:case 14:case 15:if(!Jr&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&DE(t,e,o),r=r.next}while(r!==n)}Pc(i,e,t);break;case 1:if(!Jr&&(Zf(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(a){Di(t,e,a)}Pc(i,e,t);break;case 21:Pc(i,e,t);break;case 22:t.mode&1?(Jr=(n=Jr)||t.memoizedState!==null,Pc(i,e,t),Jr=n):Pc(i,e,t);break;default:Pc(i,e,t)}}function FL(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new X7),e.forEach(function(n){var r=i9.bind(null,i,n);t.has(n)||(t.add(n),n.then(r,r))})}}function na(i,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];try{var s=i,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Lr=a.stateNode,ga=!1;break e;case 3:Lr=a.stateNode.containerInfo,ga=!0;break e;case 4:Lr=a.stateNode.containerInfo,ga=!0;break e}a=a.return}if(Lr===null)throw Error(Ct(160));pB(s,o,r),Lr=null,ga=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Di(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)mB(e,i),e=e.sibling}function mB(i,e){var t=i.alternate,n=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(na(e,i),$a(i),n&4){try{Hg(3,i,i.return),Ob(3,i)}catch(_){Di(i,i.return,_)}try{Hg(5,i,i.return)}catch(_){Di(i,i.return,_)}}break;case 1:na(e,i),$a(i),n&512&&t!==null&&Zf(t,t.return);break;case 5:if(na(e,i),$a(i),n&512&&t!==null&&Zf(t,t.return),i.flags&32){var r=i.stateNode;try{u0(r,"")}catch(_){Di(i,i.return,_)}}if(n&4&&(r=i.stateNode,r!=null)){var s=i.memoizedProps,o=t!==null?t.memoizedProps:s,a=i.type,l=i.updateQueue;if(i.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&UO(r,s),oE(a,o);var c=oE(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?VO(r,h):u==="dangerouslySetInnerHTML"?zO(r,h):u==="children"?u0(r,h):zC(r,u,h,c)}switch(a){case"input":tE(r,s);break;case"textarea":OO(r,s);break;case"select":var d=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;f!=null?up(r,!!s.multiple,f,!1):d!==!!s.multiple&&(s.defaultValue!=null?up(r,!!s.multiple,s.defaultValue,!0):up(r,!!s.multiple,s.multiple?[]:"",!1))}r[y0]=s}catch(_){Di(i,i.return,_)}}break;case 6:if(na(e,i),$a(i),n&4){if(i.stateNode===null)throw Error(Ct(162));r=i.stateNode,s=i.memoizedProps;try{r.nodeValue=s}catch(_){Di(i,i.return,_)}}break;case 3:if(na(e,i),$a(i),n&4&&t!==null&&t.memoizedState.isDehydrated)try{p0(e.containerInfo)}catch(_){Di(i,i.return,_)}break;case 4:na(e,i),$a(i);break;case 13:na(e,i),$a(i),r=i.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(yP=Vi())),n&4&&FL(i);break;case 22:if(u=t!==null&&t.memoizedState!==null,i.mode&1?(Jr=(c=Jr)||u,na(e,i),Jr=c):na(e,i),$a(i),n&8192){if(c=i.memoizedState!==null,(i.stateNode.isHidden=c)&&!u&&i.mode&1)for(Gt=i,u=i.child;u!==null;){for(h=Gt=u;Gt!==null;){switch(d=Gt,f=d.child,d.tag){case 0:case 11:case 14:case 15:Hg(4,d,d.return);break;case 1:Zf(d,d.return);var m=d.stateNode;if(typeof m.componentWillUnmount=="function"){n=d,t=d.return;try{e=n,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(_){Di(n,t,_)}}break;case 5:Zf(d,d.return);break;case 22:if(d.memoizedState!==null){UL(h);continue}}f!==null?(f.return=d,Gt=f):UL(h)}u=u.sibling}e:for(u=null,h=i;;){if(h.tag===5){if(u===null){u=h;try{r=h.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=GO("display",o))}catch(_){Di(i,i.return,_)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(_){Di(i,i.return,_)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===i)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===i)break e;for(;h.sibling===null;){if(h.return===null||h.return===i)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:na(e,i),$a(i),n&4&&FL(i);break;case 21:break;default:na(e,i),$a(i)}}function $a(i){var e=i.flags;if(e&2){try{e:{for(var t=i.return;t!==null;){if(fB(t)){var n=t;break e}t=t.return}throw Error(Ct(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(u0(r,""),n.flags&=-33);var s=NL(i);kE(i,s,r);break;case 3:case 4:var o=n.stateNode.containerInfo,a=NL(i);FE(i,a,o);break;default:throw Error(Ct(161))}}catch(l){Di(i,i.return,l)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function Y7(i,e,t){Gt=i,gB(i)}function gB(i,e,t){for(var n=(i.mode&1)!==0;Gt!==null;){var r=Gt,s=r.child;if(r.tag===22&&n){var o=r.memoizedState!==null||Uv;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Jr;a=Uv;var c=Jr;if(Uv=o,(Jr=l)&&!c)for(Gt=r;Gt!==null;)o=Gt,l=o.child,o.tag===22&&o.memoizedState!==null?OL(r):l!==null?(l.return=o,Gt=l):OL(r);for(;s!==null;)Gt=s,gB(s),s=s.sibling;Gt=r,Uv=a,Jr=c}kL(i)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Gt=s):kL(i)}}function kL(i){for(;Gt!==null;){var e=Gt;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Jr||Ob(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Jr)if(t===null)n.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:pa(e.type,t.memoizedProps);n.componentDidUpdate(r,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&xL(e,s,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}xL(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&p0(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ct(163))}Jr||e.flags&512&&NE(e)}catch(d){Di(e,e.return,d)}}if(e===i){Gt=null;break}if(t=e.sibling,t!==null){t.return=e.return,Gt=t;break}Gt=e.return}}function UL(i){for(;Gt!==null;){var e=Gt;if(e===i){Gt=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Gt=t;break}Gt=e.return}}function OL(i){for(;Gt!==null;){var e=Gt;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Ob(4,e)}catch(l){Di(e,t,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(l){Di(e,r,l)}}var s=e.return;try{NE(e)}catch(l){Di(e,s,l)}break;case 5:var o=e.return;try{NE(e)}catch(l){Di(e,o,l)}}}catch(l){Di(e,e.return,l)}if(e===i){Gt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Gt=a;break}Gt=e.return}}var K7=Math.ceil,Hx=mc.ReactCurrentDispatcher,vP=mc.ReactCurrentOwner,Xo=mc.ReactCurrentBatchConfig,Cn=0,Ar=null,tr=null,Nr=0,go=0,Qf=Ru(0),cr=0,A0=null,nd=0,Bb=0,_P=0,$g=null,Gs=null,yP=0,Rp=1/0,Gl=null,$x=!1,UE=null,uu=null,Ov=!1,nu=null,Wx=0,Wg=0,OE=null,qy=-1,Yy=0;function ws(){return Cn&6?Vi():qy!==-1?qy:qy=Vi()}function hu(i){return i.mode&1?Cn&2&&Nr!==0?Nr&-Nr:D7.transition!==null?(Yy===0&&(Yy=e5()),Yy):(i=Vn,i!==0||(i=window.event,i=i===void 0?16:a5(i.type)),i):1}function Ra(i,e,t,n){if(50<Wg)throw Wg=0,OE=null,Error(Ct(185));o1(i,t,n),(!(Cn&2)||i!==Ar)&&(i===Ar&&(!(Cn&2)&&(Bb|=t),cr===4&&Jc(i,Nr)),Ys(i,n),t===1&&Cn===0&&!(e.mode&1)&&(Rp=Vi()+500,Fb&&Iu()))}function Ys(i,e){var t=i.callbackNode;D$(i,e);var n=Cx(i,i===Ar?Nr:0);if(n===0)t!==null&&XI(t),i.callbackNode=null,i.callbackPriority=0;else if(e=n&-n,i.callbackPriority!==e){if(t!=null&&XI(t),e===1)i.tag===0?L7(BL.bind(null,i)):E5(BL.bind(null,i)),C7(function(){!(Cn&6)&&Iu()}),t=null;else{switch(t5(n)){case 1:t=WC;break;case 4:t=QO;break;case 16:t=Tx;break;case 536870912:t=JO;break;default:t=Tx}t=MB(t,vB.bind(null,i))}i.callbackPriority=e,i.callbackNode=t}}function vB(i,e){if(qy=-1,Yy=0,Cn&6)throw Error(Ct(327));var t=i.callbackNode;if(mp()&&i.callbackNode!==t)return null;var n=Cx(i,i===Ar?Nr:0);if(n===0)return null;if(n&30||n&i.expiredLanes||e)e=jx(i,n);else{e=n;var r=Cn;Cn|=2;var s=yB();(Ar!==i||Nr!==e)&&(Gl=null,Rp=Vi()+500,Oh(i,e));do try{J7();break}catch(a){_B(i,a)}while(!0);rP(),Hx.current=s,Cn=r,tr!==null?e=0:(Ar=null,Nr=0,e=cr)}if(e!==0){if(e===2&&(r=hE(i),r!==0&&(n=r,e=BE(i,r))),e===1)throw t=A0,Oh(i,0),Jc(i,n),Ys(i,Vi()),t;if(e===6)Jc(i,n);else{if(r=i.current.alternate,!(n&30)&&!Z7(r)&&(e=jx(i,n),e===2&&(s=hE(i),s!==0&&(n=s,e=BE(i,s))),e===1))throw t=A0,Oh(i,0),Jc(i,n),Ys(i,Vi()),t;switch(i.finishedWork=r,i.finishedLanes=n,e){case 0:case 1:throw Error(Ct(345));case 2:vh(i,Gs,Gl);break;case 3:if(Jc(i,n),(n&130023424)===n&&(e=yP+500-Vi(),10<e)){if(Cx(i,0)!==0)break;if(r=i.suspendedLanes,(r&n)!==n){ws(),i.pingedLanes|=i.suspendedLanes&r;break}i.timeoutHandle=yE(vh.bind(null,i,Gs,Gl),e);break}vh(i,Gs,Gl);break;case 4:if(Jc(i,n),(n&4194240)===n)break;for(e=i.eventTimes,r=-1;0<n;){var o=31-Pa(n);s=1<<o,o=e[o],o>r&&(r=o),n&=~s}if(n=r,n=Vi()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*K7(n/1960))-n,10<n){i.timeoutHandle=yE(vh.bind(null,i,Gs,Gl),n);break}vh(i,Gs,Gl);break;case 5:vh(i,Gs,Gl);break;default:throw Error(Ct(329))}}}return Ys(i,Vi()),i.callbackNode===t?vB.bind(null,i):null}function BE(i,e){var t=$g;return i.current.memoizedState.isDehydrated&&(Oh(i,e).flags|=256),i=jx(i,e),i!==2&&(e=Gs,Gs=t,e!==null&&zE(e)),i}function zE(i){Gs===null?Gs=i:Gs.push.apply(Gs,i)}function Z7(i){for(var e=i;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var r=t[n],s=r.getSnapshot;r=r.value;try{if(!Da(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Jc(i,e){for(e&=~_P,e&=~Bb,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-Pa(e),n=1<<t;i[t]=-1,e&=~n}}function BL(i){if(Cn&6)throw Error(Ct(327));mp();var e=Cx(i,0);if(!(e&1))return Ys(i,Vi()),null;var t=jx(i,e);if(i.tag!==0&&t===2){var n=hE(i);n!==0&&(e=n,t=BE(i,n))}if(t===1)throw t=A0,Oh(i,0),Jc(i,e),Ys(i,Vi()),t;if(t===6)throw Error(Ct(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,vh(i,Gs,Gl),Ys(i,Vi()),null}function xP(i,e){var t=Cn;Cn|=1;try{return i(e)}finally{Cn=t,Cn===0&&(Rp=Vi()+500,Fb&&Iu())}}function id(i){nu!==null&&nu.tag===0&&!(Cn&6)&&mp();var e=Cn;Cn|=1;var t=Xo.transition,n=Vn;try{if(Xo.transition=null,Vn=1,i)return i()}finally{Vn=n,Xo.transition=t,Cn=e,!(Cn&6)&&Iu()}}function bP(){go=Qf.current,li(Qf)}function Oh(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,T7(t)),tr!==null)for(t=tr.return;t!==null;){var n=t;switch(tP(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Dx();break;case 3:Cp(),li(Xs),li(rs),uP();break;case 5:cP(n);break;case 4:Cp();break;case 13:li(bi);break;case 19:li(bi);break;case 10:sP(n.type._context);break;case 22:case 23:bP()}t=t.return}if(Ar=i,tr=i=du(i.current,null),Nr=go=e,cr=0,A0=null,_P=Bb=nd=0,Gs=$g=null,Rh!==null){for(e=0;e<Rh.length;e++)if(t=Rh[e],n=t.interleaved,n!==null){t.interleaved=null;var r=n.next,s=t.pending;if(s!==null){var o=s.next;s.next=r,n.next=o}t.pending=n}Rh=null}return i}function _B(i,e){do{var t=tr;try{if(rP(),Wy.current=Vx,Gx){for(var n=Ei.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}Gx=!1}if(td=0,wr=ar=Ei=null,Vg=!1,S0=0,vP.current=null,t===null||t.return===null){cr=1,A0=e,tr=null;break}e:{var s=i,o=t.return,a=t,l=e;if(e=Nr,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=EL(o);if(f!==null){f.flags&=-257,TL(f,o,a,s,e),f.mode&1&&AL(s,c,e),e=f,l=c;var m=e.updateQueue;if(m===null){var _=new Set;_.add(l),e.updateQueue=_}else m.add(l);break e}else{if(!(e&1)){AL(s,c,e),SP();break e}l=Error(Ct(426))}}else if(pi&&a.mode&1){var v=EL(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),TL(v,o,a,s,e),nP(Pp(l,a));break e}}s=l=Pp(l,a),cr!==4&&(cr=2),$g===null?$g=[s]:$g.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=tB(s,l,e);yL(s,g);break e;case 1:a=l;var b=s.type,p=s.stateNode;if(!(s.flags&128)&&(typeof b.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(uu===null||!uu.has(p)))){s.flags|=65536,e&=-e,s.lanes|=e;var y=nB(s,a,e);yL(s,y);break e}}s=s.return}while(s!==null)}bB(t)}catch(A){e=A,tr===t&&t!==null&&(tr=t=t.return);continue}break}while(!0)}function yB(){var i=Hx.current;return Hx.current=Vx,i===null?Vx:i}function SP(){(cr===0||cr===3||cr===2)&&(cr=4),Ar===null||!(nd&268435455)&&!(Bb&268435455)||Jc(Ar,Nr)}function jx(i,e){var t=Cn;Cn|=2;var n=yB();(Ar!==i||Nr!==e)&&(Gl=null,Oh(i,e));do try{Q7();break}catch(r){_B(i,r)}while(!0);if(rP(),Cn=t,Hx.current=n,tr!==null)throw Error(Ct(261));return Ar=null,Nr=0,cr}function Q7(){for(;tr!==null;)xB(tr)}function J7(){for(;tr!==null&&!M$();)xB(tr)}function xB(i){var e=wB(i.alternate,i,go);i.memoizedProps=i.pendingProps,e===null?bB(i):tr=e,vP.current=null}function bB(i){var e=i;do{var t=e.alternate;if(i=e.return,e.flags&32768){if(t=j7(t,e),t!==null){t.flags&=32767,tr=t;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{cr=6,tr=null;return}}else if(t=W7(t,e,go),t!==null){tr=t;return}if(e=e.sibling,e!==null){tr=e;return}tr=e=i}while(e!==null);cr===0&&(cr=5)}function vh(i,e,t){var n=Vn,r=Xo.transition;try{Xo.transition=null,Vn=1,e9(i,e,t,n)}finally{Xo.transition=r,Vn=n}return null}function e9(i,e,t,n){do mp();while(nu!==null);if(Cn&6)throw Error(Ct(327));t=i.finishedWork;var r=i.finishedLanes;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(Ct(177));i.callbackNode=null,i.callbackPriority=0;var s=t.lanes|t.childLanes;if(N$(i,s),i===Ar&&(tr=Ar=null,Nr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Ov||(Ov=!0,MB(Tx,function(){return mp(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Xo.transition,Xo.transition=null;var o=Vn;Vn=1;var a=Cn;Cn|=4,vP.current=null,q7(i,t),mB(t,i),x7(vE),Px=!!gE,vE=gE=null,i.current=t,Y7(t),A$(),Cn=a,Vn=o,Xo.transition=s}else i.current=t;if(Ov&&(Ov=!1,nu=i,Wx=r),s=i.pendingLanes,s===0&&(uu=null),C$(t.stateNode),Ys(i,Vi()),e!==null)for(n=i.onRecoverableError,t=0;t<e.length;t++)r=e[t],n(r.value,{componentStack:r.stack,digest:r.digest});if($x)throw $x=!1,i=UE,UE=null,i;return Wx&1&&i.tag!==0&&mp(),s=i.pendingLanes,s&1?i===OE?Wg++:(Wg=0,OE=i):Wg=0,Iu(),null}function mp(){if(nu!==null){var i=t5(Wx),e=Xo.transition,t=Vn;try{if(Xo.transition=null,Vn=16>i?16:i,nu===null)var n=!1;else{if(i=nu,nu=null,Wx=0,Cn&6)throw Error(Ct(331));var r=Cn;for(Cn|=4,Gt=i.current;Gt!==null;){var s=Gt,o=s.child;if(Gt.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(Gt=c;Gt!==null;){var u=Gt;switch(u.tag){case 0:case 11:case 15:Hg(8,u,s)}var h=u.child;if(h!==null)h.return=u,Gt=h;else for(;Gt!==null;){u=Gt;var d=u.sibling,f=u.return;if(dB(u),u===c){Gt=null;break}if(d!==null){d.return=f,Gt=d;break}Gt=f}}}var m=s.alternate;if(m!==null){var _=m.child;if(_!==null){m.child=null;do{var v=_.sibling;_.sibling=null,_=v}while(_!==null)}}Gt=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,Gt=o;else e:for(;Gt!==null;){if(s=Gt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Hg(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,Gt=g;break e}Gt=s.return}}var b=i.current;for(Gt=b;Gt!==null;){o=Gt;var p=o.child;if(o.subtreeFlags&2064&&p!==null)p.return=o,Gt=p;else e:for(o=b;Gt!==null;){if(a=Gt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ob(9,a)}}catch(A){Di(a,a.return,A)}if(a===o){Gt=null;break e}var y=a.sibling;if(y!==null){y.return=a.return,Gt=y;break e}Gt=a.return}}if(Cn=r,Iu(),tl&&typeof tl.onPostCommitFiberRoot=="function")try{tl.onPostCommitFiberRoot(Rb,i)}catch{}n=!0}return n}finally{Vn=t,Xo.transition=e}}return!1}function zL(i,e,t){e=Pp(t,e),e=tB(i,e,1),i=cu(i,e,1),e=ws(),i!==null&&(o1(i,1,e),Ys(i,e))}function Di(i,e,t){if(i.tag===3)zL(i,i,t);else for(;e!==null;){if(e.tag===3){zL(e,i,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(uu===null||!uu.has(n))){i=Pp(t,i),i=nB(e,i,1),e=cu(e,i,1),i=ws(),e!==null&&(o1(e,1,i),Ys(e,i));break}}e=e.return}}function t9(i,e,t){var n=i.pingCache;n!==null&&n.delete(e),e=ws(),i.pingedLanes|=i.suspendedLanes&t,Ar===i&&(Nr&t)===t&&(cr===4||cr===3&&(Nr&130023424)===Nr&&500>Vi()-yP?Oh(i,0):_P|=t),Ys(i,e)}function SB(i,e){e===0&&(i.mode&1?(e=Cv,Cv<<=1,!(Cv&130023424)&&(Cv=4194304)):e=1);var t=ws();i=sc(i,e),i!==null&&(o1(i,e,t),Ys(i,t))}function n9(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),SB(i,t)}function i9(i,e){var t=0;switch(i.tag){case 13:var n=i.stateNode,r=i.memoizedState;r!==null&&(t=r.retryLane);break;case 19:n=i.stateNode;break;default:throw Error(Ct(314))}n!==null&&n.delete(e),SB(i,t)}var wB;wB=function(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps||Xs.current)js=!0;else{if(!(i.lanes&t)&&!(e.flags&128))return js=!1,$7(i,e,t);js=!!(i.flags&131072)}else js=!1,pi&&e.flags&1048576&&T5(e,kx,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Xy(i,e),i=e.pendingProps;var r=Ap(e,rs.current);pp(e,t),r=dP(null,e,n,i,r,t);var s=fP();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qs(n)?(s=!0,Nx(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,aP(e),r.updater=Ub,e.stateNode=r,r._reactInternals=e,EE(e,n,i,t),e=PE(null,e,n,!0,s,t)):(e.tag=0,pi&&s&&eP(e),xs(null,e,r,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Xy(i,e),i=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=s9(n),i=pa(n,i),r){case 0:e=CE(null,e,n,i,t);break e;case 1:e=RL(null,e,n,i,t);break e;case 11:e=CL(null,e,n,i,t);break e;case 14:e=PL(null,e,n,pa(n.type,i),t);break e}throw Error(Ct(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:pa(n,r),CE(i,e,n,r,t);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:pa(n,r),RL(i,e,n,r,t);case 3:e:{if(oB(e),i===null)throw Error(Ct(387));n=e.pendingProps,s=e.memoizedState,r=s.element,D5(i,e),Bx(e,n,null,t);var o=e.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Pp(Error(Ct(423)),e),e=IL(i,e,n,t,r);break e}else if(n!==r){r=Pp(Error(Ct(424)),e),e=IL(i,e,n,t,r);break e}else for(yo=lu(e.stateNode.containerInfo.firstChild),xo=e,pi=!0,_a=null,t=I5(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ep(),n===r){e=oc(i,e,t);break e}xs(i,e,n,t)}e=e.child}return e;case 5:return N5(e),i===null&&wE(e),n=e.type,r=e.pendingProps,s=i!==null?i.memoizedProps:null,o=r.children,_E(n,r)?o=null:s!==null&&_E(n,s)&&(e.flags|=32),sB(i,e),xs(i,e,o,t),e.child;case 6:return i===null&&wE(e),null;case 13:return aB(i,e,t);case 4:return lP(e,e.stateNode.containerInfo),n=e.pendingProps,i===null?e.child=Tp(e,null,n,t):xs(i,e,n,t),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:pa(n,r),CL(i,e,n,r,t);case 7:return xs(i,e,e.pendingProps,t),e.child;case 8:return xs(i,e,e.pendingProps.children,t),e.child;case 12:return xs(i,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,Jn(Ux,n._currentValue),n._currentValue=o,s!==null)if(Da(s.value,o)){if(s.children===r.children&&!Xs.current){e=oc(i,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(s.tag===1){l=Jl(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),ME(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Ct(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),ME(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}xs(i,e,r.children,t),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,pp(e,t),r=Ko(r),n=n(r),e.flags|=1,xs(i,e,n,t),e.child;case 14:return n=e.type,r=pa(n,e.pendingProps),r=pa(n.type,r),PL(i,e,n,r,t);case 15:return iB(i,e,e.type,e.pendingProps,t);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:pa(n,r),Xy(i,e),e.tag=1,qs(n)?(i=!0,Nx(e)):i=!1,pp(e,t),eB(e,n,r),EE(e,n,r,t),PE(null,e,n,!0,i,t);case 19:return lB(i,e,t);case 22:return rB(i,e,t)}throw Error(Ct(156,e.tag))};function MB(i,e){return ZO(i,e)}function r9(i,e,t,n){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jo(i,e,t,n){return new r9(i,e,t,n)}function wP(i){return i=i.prototype,!(!i||!i.isReactComponent)}function s9(i){if(typeof i=="function")return wP(i)?1:0;if(i!=null){if(i=i.$$typeof,i===VC)return 11;if(i===HC)return 14}return 2}function du(i,e){var t=i.alternate;return t===null?(t=jo(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&14680064,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function Ky(i,e,t,n,r,s){var o=2;if(n=i,typeof i=="function")wP(i)&&(o=1);else if(typeof i=="string")o=5;else e:switch(i){case Vf:return Bh(t.children,r,s,e);case GC:o=8,r|=8;break;case KA:return i=jo(12,t,e,r|2),i.elementType=KA,i.lanes=s,i;case ZA:return i=jo(13,t,e,r),i.elementType=ZA,i.lanes=s,i;case QA:return i=jo(19,t,e,r),i.elementType=QA,i.lanes=s,i;case NO:return zb(t,r,s,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case LO:o=10;break e;case DO:o=9;break e;case VC:o=11;break e;case HC:o=14;break e;case jc:o=16,n=null;break e}throw Error(Ct(130,i==null?i:typeof i,""))}return e=jo(o,t,e,r),e.elementType=i,e.type=n,e.lanes=s,e}function Bh(i,e,t,n){return i=jo(7,i,n,e),i.lanes=t,i}function zb(i,e,t,n){return i=jo(22,i,n,e),i.elementType=NO,i.lanes=t,i.stateNode={isHidden:!1},i}function sw(i,e,t){return i=jo(6,i,null,e),i.lanes=t,i}function ow(i,e,t){return e=jo(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function o9(i,e,t,n,r){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=z2(0),this.expirationTimes=z2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=z2(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function MP(i,e,t,n,r,s,o,a,l){return i=new o9(i,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=jo(3,null,null,e),i.current=s,s.stateNode=i,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},aP(s),i}function a9(i,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gf,key:n==null?null:""+n,children:i,containerInfo:e,implementation:t}}function AB(i){if(!i)return Su;i=i._reactInternals;e:{if(md(i)!==i||i.tag!==1)throw Error(Ct(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ct(171))}if(i.tag===1){var t=i.type;if(qs(t))return A5(i,t,e)}return e}function EB(i,e,t,n,r,s,o,a,l){return i=MP(t,n,!0,i,r,s,o,a,l),i.context=AB(null),t=i.current,n=ws(),r=hu(t),s=Jl(n,r),s.callback=e??null,cu(t,s,r),i.current.lanes=r,o1(i,r,n),Ys(i,n),i}function Gb(i,e,t,n){var r=e.current,s=ws(),o=hu(r);return t=AB(t),e.context===null?e.context=t:e.pendingContext=t,e=Jl(s,o),e.payload={element:i},n=n===void 0?null:n,n!==null&&(e.callback=n),i=cu(r,e,o),i!==null&&(Ra(i,r,o,s),$y(i,r,o)),o}function Xx(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function GL(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function AP(i,e){GL(i,e),(i=i.alternate)&&GL(i,e)}function l9(){return null}var TB=typeof reportError=="function"?reportError:function(i){console.error(i)};function EP(i){this._internalRoot=i}Vb.prototype.render=EP.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(Ct(409));Gb(i,e,null,null)};Vb.prototype.unmount=EP.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;id(function(){Gb(null,i,null,null)}),e[rc]=null}};function Vb(i){this._internalRoot=i}Vb.prototype.unstable_scheduleHydration=function(i){if(i){var e=r5();i={blockedOn:null,target:i,priority:e};for(var t=0;t<Qc.length&&e!==0&&e<Qc[t].priority;t++);Qc.splice(t,0,i),t===0&&o5(i)}};function TP(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Hb(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function VL(){}function c9(i,e,t,n,r){if(r){if(typeof n=="function"){var s=n;n=function(){var c=Xx(o);s.call(c)}}var o=EB(e,n,i,0,null,!1,!1,"",VL);return i._reactRootContainer=o,i[rc]=o.current,v0(i.nodeType===8?i.parentNode:i),id(),o}for(;r=i.lastChild;)i.removeChild(r);if(typeof n=="function"){var a=n;n=function(){var c=Xx(l);a.call(c)}}var l=MP(i,0,!1,null,null,!1,!1,"",VL);return i._reactRootContainer=l,i[rc]=l.current,v0(i.nodeType===8?i.parentNode:i),id(function(){Gb(e,l,t,n)}),l}function $b(i,e,t,n,r){var s=t._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=Xx(o);a.call(l)}}Gb(e,o,i,r)}else o=c9(t,e,i,r,n);return Xx(o)}n5=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var t=Sg(e.pendingLanes);t!==0&&(jC(e,t|1),Ys(e,Vi()),!(Cn&6)&&(Rp=Vi()+500,Iu()))}break;case 13:id(function(){var n=sc(i,1);if(n!==null){var r=ws();Ra(n,i,1,r)}}),AP(i,1)}};XC=function(i){if(i.tag===13){var e=sc(i,134217728);if(e!==null){var t=ws();Ra(e,i,134217728,t)}AP(i,134217728)}};i5=function(i){if(i.tag===13){var e=hu(i),t=sc(i,e);if(t!==null){var n=ws();Ra(t,i,e,n)}AP(i,e)}};r5=function(){return Vn};s5=function(i,e){var t=Vn;try{return Vn=i,e()}finally{Vn=t}};lE=function(i,e,t){switch(e){case"input":if(tE(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==i&&n.form===i.form){var r=Nb(n);if(!r)throw Error(Ct(90));kO(n),tE(n,r)}}}break;case"textarea":OO(i,t);break;case"select":e=t.value,e!=null&&up(i,!!t.multiple,e,!1)}};WO=xP;jO=id;var u9={usingClientEntryPoint:!1,Events:[l1,jf,Nb,HO,$O,xP]},Vm={findFiberByHostInstance:Ph,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},h9={bundleType:Vm.bundleType,version:Vm.version,rendererPackageName:Vm.rendererPackageName,rendererConfig:Vm.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:mc.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=YO(i),i===null?null:i.stateNode},findFiberByHostInstance:Vm.findFiberByHostInstance||l9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bv.isDisabled&&Bv.supportsFiber)try{Rb=Bv.inject(h9),tl=Bv}catch{}}Ao.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=u9;Ao.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!TP(e))throw Error(Ct(200));return a9(i,e,null,t)};Ao.createRoot=function(i,e){if(!TP(i))throw Error(Ct(299));var t=!1,n="",r=TB;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=MP(i,1,!1,null,null,t,!1,n,r),i[rc]=e.current,v0(i.nodeType===8?i.parentNode:i),new EP(e)};Ao.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(Ct(188)):(i=Object.keys(i).join(","),Error(Ct(268,i)));return i=YO(e),i=i===null?null:i.stateNode,i};Ao.flushSync=function(i){return id(i)};Ao.hydrate=function(i,e,t){if(!Hb(e))throw Error(Ct(200));return $b(null,i,e,!0,t)};Ao.hydrateRoot=function(i,e,t){if(!TP(i))throw Error(Ct(405));var n=t!=null&&t.hydratedSources||null,r=!1,s="",o=TB;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=EB(e,null,i,1,t??null,r,!1,s,o),i[rc]=e.current,v0(i),n)for(i=0;i<n.length;i++)t=n[i],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new Vb(e)};Ao.render=function(i,e,t){if(!Hb(e))throw Error(Ct(200));return $b(null,i,e,!1,t)};Ao.unmountComponentAtNode=function(i){if(!Hb(i))throw Error(Ct(40));return i._reactRootContainer?(id(function(){$b(null,null,i,!1,function(){i._reactRootContainer=null,i[rc]=null})}),!0):!1};Ao.unstable_batchedUpdates=xP;Ao.unstable_renderSubtreeIntoContainer=function(i,e,t,n){if(!Hb(t))throw Error(Ct(200));if(i==null||i._reactInternals===void 0)throw Error(Ct(38));return $b(i,e,t,!1,n)};Ao.version="18.3.1-next-f1338f8080-20240426";function CB(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(CB)}catch(i){console.error(i)}}CB(),CO.exports=Ao;var d9=CO.exports,PB,HL=d9;PB=qA.createRoot=HL.createRoot,qA.hydrateRoot=HL.hydrateRoot;/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Wb="160",f9={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},p9={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},RB=0,GE=1,IB=2,m9=3,LB=0,jb=1,jg=2,ma=3,ac=0,Ms=1,ts=2,g9=2,ec=0,zh=1,VE=2,HE=3,$E=4,DB=5,eu=100,NB=101,FB=102,WE=103,jE=104,kB=200,UB=201,OB=202,BB=203,qx=204,Yx=205,zB=206,GB=207,VB=208,HB=209,$B=210,WB=211,jB=212,XB=213,qB=214,YB=0,KB=1,ZB=2,E0=3,QB=4,JB=5,ez=6,tz=7,u1=0,nz=1,iz=2,il=0,rz=1,sz=2,oz=3,CP=4,az=5,lz=6,XE="attached",cz="detached",Xb=300,lc=301,wu=302,T0=303,C0=304,Zp=306,P0=1e3,ns=1001,R0=1002,Gi=1003,Kx=1004,v9=1004,Xg=1005,_9=1005,Mi=1006,PP=1007,y9=1007,Mu=1008,x9=1008,rl=1009,uz=1010,hz=1011,qb=1012,RP=1013,Yl=1014,Ea=1015,Ip=1016,IP=1017,LP=1018,fu=1020,dz=1021,Ss=1023,fz=1024,pz=1025,pu=1026,rd=1027,mz=1028,DP=1029,gz=1030,NP=1031,FP=1033,Zy=33776,Qy=33777,Jy=33778,ex=33779,qE=35840,YE=35841,KE=35842,ZE=35843,kP=36196,QE=37492,JE=37496,eT=37808,tT=37809,nT=37810,iT=37811,rT=37812,sT=37813,oT=37814,aT=37815,lT=37816,cT=37817,uT=37818,hT=37819,dT=37820,fT=37821,tx=36492,pT=36494,mT=36495,vz=36283,gT=36284,vT=36285,_T=36286,_z=2200,yz=2201,xz=2202,I0=2300,L0=2301,nx=2302,Lh=2400,Dh=2401,D0=2402,Yb=2500,UP=2501,b9=0,S9=1,w9=2,OP=3e3,mu=3001,bz=3200,BP=3201,Lu=0,Sz=1,_o="",lr="srgb",hl="srgb-linear",Kb="display-p3",h1="display-p3-linear",N0="linear",Qn="srgb",F0="rec709",k0="p3",M9=0,_h=7680,A9=7681,E9=7682,T9=7683,C9=34055,P9=34056,R9=5386,I9=512,L9=513,D9=514,N9=515,F9=516,k9=517,U9=518,yT=519,wz=512,Mz=513,Az=514,zP=515,Ez=516,Tz=517,Cz=518,Pz=519,U0=35044,O9=35048,B9=35040,z9=35045,G9=35049,V9=35041,H9=35046,$9=35050,W9=35042,j9="100",xT="300 es",Zx=1035,Ta=2e3,Lp=2001;let gc=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};const Xr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let $L=1234567;const Gh=Math.PI/180,Dp=180/Math.PI;function bo(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Xr[i&255]+Xr[i>>8&255]+Xr[i>>16&255]+Xr[i>>24&255]+"-"+Xr[e&255]+Xr[e>>8&255]+"-"+Xr[e>>16&15|64]+Xr[e>>24&255]+"-"+Xr[t&63|128]+Xr[t>>8&255]+"-"+Xr[t>>16&255]+Xr[t>>24&255]+Xr[n&255]+Xr[n>>8&255]+Xr[n>>16&255]+Xr[n>>24&255]).toLowerCase()}function Ni(i,e,t){return Math.max(e,Math.min(t,i))}function GP(i,e){return(i%e+e)%e}function X9(i,e,t,n,r){return n+(i-e)*(r-n)/(t-e)}function q9(i,e,t){return i!==e?(t-i)/(e-i):0}function qg(i,e,t){return(1-t)*i+t*e}function Y9(i,e,t,n){return qg(i,e,1-Math.exp(-t*n))}function K9(i,e=1){return e-Math.abs(GP(i,e*2)-e)}function Z9(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function Q9(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function J9(i,e){return i+Math.floor(Math.random()*(e-i+1))}function eW(i,e){return i+Math.random()*(e-i)}function tW(i){return i*(.5-Math.random())}function nW(i){i!==void 0&&($L=i);let e=$L+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function iW(i){return i*Gh}function rW(i){return i*Dp}function bT(i){return(i&i-1)===0&&i!==0}function sW(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Qx(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function oW(i,e,t,n,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+n)/2),u=o((e+n)/2),h=s((e-n)/2),d=o((e-n)/2),f=s((n-e)/2),m=o((n-e)/2);switch(r){case"XYX":i.set(a*u,l*h,l*d,a*c);break;case"YZY":i.set(l*d,a*u,l*h,a*c);break;case"ZXZ":i.set(l*h,l*d,a*u,a*c);break;case"XZX":i.set(a*u,l*m,l*f,a*c);break;case"YXY":i.set(l*f,a*u,l*m,a*c);break;case"ZYZ":i.set(l*m,l*f,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function $s(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function fn(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}const Mg={DEG2RAD:Gh,RAD2DEG:Dp,generateUUID:bo,clamp:Ni,euclideanModulo:GP,mapLinear:X9,inverseLerp:q9,lerp:qg,damp:Y9,pingpong:K9,smoothstep:Z9,smootherstep:Q9,randInt:J9,randFloat:eW,randFloatSpread:tW,seededRandom:nW,degToRad:iW,radToDeg:rW,isPowerOfTwo:bT,ceilPowerOfTwo:sW,floorPowerOfTwo:Qx,setQuaternionFromProperEuler:oW,normalize:fn,denormalize:$s};let xt=class Rz{constructor(e=0,t=0){Rz.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ni(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},yn=class Iz{constructor(e,t,n,r,s,o,a,l,c){Iz.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c)}set(e,t,n,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],u=n[4],h=n[7],d=n[2],f=n[5],m=n[8],_=r[0],v=r[3],g=r[6],b=r[1],p=r[4],y=r[7],A=r[2],w=r[5],M=r[8];return s[0]=o*_+a*b+l*A,s[3]=o*v+a*p+l*w,s[6]=o*g+a*y+l*M,s[1]=c*_+u*b+h*A,s[4]=c*v+u*p+h*w,s[7]=c*g+u*y+h*M,s[2]=d*_+f*b+m*A,s[5]=d*v+f*p+m*w,s[8]=d*g+f*y+m*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-n*s*u+n*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,d=a*l-u*s,f=c*s-o*l,m=t*h+n*d+r*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/m;return e[0]=h*_,e[1]=(r*c-u*n)*_,e[2]=(a*n-r*o)*_,e[3]=d*_,e[4]=(u*t-r*l)*_,e[5]=(r*s-a*t)*_,e[6]=f*_,e[7]=(n*l-c*t)*_,e[8]=(o*t-n*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(aw.makeScale(e,t)),this}rotate(e){return this.premultiply(aw.makeRotation(-e)),this}translate(e,t){return this.premultiply(aw.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const aw=new yn;function Lz(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const aW={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Jf(i,e){return new aW[i](e)}function O0(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function Dz(){const i=O0("canvas");return i.style.display="block",i}const WL={};function Yg(i){i in WL||(WL[i]=!0,console.warn(i))}const jL=new yn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),XL=new yn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),zv={[hl]:{transfer:N0,primaries:F0,toReference:i=>i,fromReference:i=>i},[lr]:{transfer:Qn,primaries:F0,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[h1]:{transfer:N0,primaries:k0,toReference:i=>i.applyMatrix3(XL),fromReference:i=>i.applyMatrix3(jL)},[Kb]:{transfer:Qn,primaries:k0,toReference:i=>i.convertSRGBToLinear().applyMatrix3(XL),fromReference:i=>i.applyMatrix3(jL).convertLinearToSRGB()}},lW=new Set([hl,h1]),On={enabled:!0,_workingColorSpace:hl,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!lW.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const n=zv[e].toReference,r=zv[t].fromReference;return r(n(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this._workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this._workingColorSpace)},getPrimaries:function(i){return zv[i].primaries},getTransfer:function(i){return i===_o?N0:zv[i].transfer}};function gp(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function lw(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let Bd,VP=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Bd===void 0&&(Bd=O0("canvas")),Bd.width=e.width,Bd.height=e.height;const n=Bd.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Bd}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=O0("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=gp(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(gp(t[n]/255)*255):t[n]=gp(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},cW=0,Nh=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:cW++}),this.uuid=bo(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(cw(r[o].image)):s.push(cw(r[o]))}else s=cw(r);n.url=s}return t||(e.images[this.uuid]=n),n}};function cw(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?VP.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let uW=0,Tr=class ix extends gc{constructor(e=ix.DEFAULT_IMAGE,t=ix.DEFAULT_MAPPING,n=ns,r=ns,s=Mi,o=Mu,a=Ss,l=rl,c=ix.DEFAULT_ANISOTROPY,u=_o){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:uW++}),this.uuid=bo(),this.name="",this.source=new Nh(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new xt(0,0),this.repeat=new xt(1,1),this.center=new xt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new yn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(Yg("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===mu?lr:_o),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Xb)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case P0:e.x=e.x-Math.floor(e.x);break;case ns:e.x=e.x<0?0:1;break;case R0:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case P0:e.y=e.y-Math.floor(e.y);break;case ns:e.y=e.y<0?0:1;break;case R0:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return Yg("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===lr?mu:OP}set encoding(e){Yg("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===mu?lr:_o}};Tr.DEFAULT_IMAGE=null;Tr.DEFAULT_MAPPING=Xb;Tr.DEFAULT_ANISOTROPY=1;let Gn=class Nz{constructor(e=0,t=0,n=0,r=1){Nz.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],f=l[5],m=l[9],_=l[2],v=l[6],g=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-_)<.01&&Math.abs(m-v)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+_)<.1&&Math.abs(m+v)<.1&&Math.abs(c+f+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const p=(c+1)/2,y=(f+1)/2,A=(g+1)/2,w=(u+d)/4,M=(h+_)/4,T=(m+v)/4;return p>y&&p>A?p<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(p),r=w/n,s=M/n):y>A?y<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(y),n=w/r,s=T/r):A<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(A),n=M/s,r=T/s),this.set(n,r,s,t),this}let b=Math.sqrt((v-m)*(v-m)+(h-_)*(h-_)+(d-u)*(d-u));return Math.abs(b)<.001&&(b=1),this.x=(v-m)/b,this.y=(h-_)/b,this.z=(d-u)/b,this.w=Math.acos((c+f+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Fz=class extends gc{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Gn(0,0,e,t),this.scissorTest=!1,this.viewport=new Gn(0,0,e,t);const r={width:e,height:t,depth:1};n.encoding!==void 0&&(Yg("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===mu?lr:_o),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Mi,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Tr(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Nh(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Na=class extends Fz{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}},Zb=class extends Tr{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Gi,this.minFilter=Gi,this.wrapR=ns,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class hW extends Na{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Zb(null,e,t,n),this.texture.isRenderTargetTexture=!0}}let HP=class extends Tr{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Gi,this.minFilter=Gi,this.wrapR=ns,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};class dW extends Na{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new HP(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class fW extends Na{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const s=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,s=this.texture.length;r<s;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}let As=class{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,a){let l=n[r+0],c=n[r+1],u=n[r+2],h=n[r+3];const d=s[o+0],f=s[o+1],m=s[o+2],_=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=d,e[t+1]=f,e[t+2]=m,e[t+3]=_;return}if(h!==_||l!==d||c!==f||u!==m){let v=1-a;const g=l*d+c*f+u*m+h*_,b=g>=0?1:-1,p=1-g*g;if(p>Number.EPSILON){const A=Math.sqrt(p),w=Math.atan2(A,g*b);v=Math.sin(v*w)/A,a=Math.sin(a*w)/A}const y=a*b;if(l=l*v+d*y,c=c*v+f*y,u=u*v+m*y,h=h*v+_*y,v===1-a){const A=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=A,c*=A,u*=A,h*=A}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],l=n[r+1],c=n[r+2],u=n[r+3],h=s[o],d=s[o+1],f=s[o+2],m=s[o+3];return e[t]=a*m+u*h+l*f-c*d,e[t+1]=l*m+u*d+c*h-a*f,e[t+2]=c*m+u*f+a*d-l*h,e[t+3]=u*m-a*h-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(r/2),h=a(s/2),d=l(n/2),f=l(r/2),m=l(s/2);switch(o){case"XYZ":this._x=d*u*h+c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h-d*f*m;break;case"YXZ":this._x=d*u*h+c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h+d*f*m;break;case"ZXY":this._x=d*u*h-c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h-d*f*m;break;case"ZYX":this._x=d*u*h-c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h+d*f*m;break;case"YZX":this._x=d*u*h+c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h-d*f*m;break;case"XZY":this._x=d*u*h-c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],d=n+a+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(o-r)*f}else if(n>a&&n>h){const f=2*Math.sqrt(1+n-a-h);this._w=(u-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+c)/f}else if(a>h){const f=2*Math.sqrt(1+a-n-h);this._w=(s-c)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-n-a);this._w=(o-r)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ni(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-n*c,this._z=s*u+o*c+n*l-r*a,this._w=o*u-n*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*n+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=o*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(s),n*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Ce=class kz{constructor(e=0,t=0,n=0){kz.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(qL.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(qL.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*n),u=2*(a*t-s*r),h=2*(s*n-o*t);return this.x=t+l*c+o*h-a*u,this.y=n+l*u+a*c-s*h,this.z=r+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return uw.copy(this).projectOnVector(e),this.sub(uw)}reflect(e){return this.sub(uw.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ni(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const uw=new Ce,qL=new As;let Fr=class{constructor(e=new Ce(1/0,1/0,1/0),t=new Ce(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(ia.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(ia.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ia.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,ia):ia.fromBufferAttribute(s,o),ia.applyMatrix4(e.matrixWorld),this.expandByPoint(ia);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Gv.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),Gv.copy(n.boundingBox)),Gv.applyMatrix4(e.matrixWorld),this.union(Gv)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ia),ia.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Hm),Vv.subVectors(this.max,Hm),zd.subVectors(e.a,Hm),Gd.subVectors(e.b,Hm),Vd.subVectors(e.c,Hm),Rc.subVectors(Gd,zd),Ic.subVectors(Vd,Gd),Zu.subVectors(zd,Vd);let t=[0,-Rc.z,Rc.y,0,-Ic.z,Ic.y,0,-Zu.z,Zu.y,Rc.z,0,-Rc.x,Ic.z,0,-Ic.x,Zu.z,0,-Zu.x,-Rc.y,Rc.x,0,-Ic.y,Ic.x,0,-Zu.y,Zu.x,0];return!hw(t,zd,Gd,Vd,Vv)||(t=[1,0,0,0,1,0,0,0,1],!hw(t,zd,Gd,Vd,Vv))?!1:(Hv.crossVectors(Rc,Ic),t=[Hv.x,Hv.y,Hv.z],hw(t,zd,Gd,Vd,Vv))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ia).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ia).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ml[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ml[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ml[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ml[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ml[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ml[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ml[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ml[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ml),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};const Ml=[new Ce,new Ce,new Ce,new Ce,new Ce,new Ce,new Ce,new Ce],ia=new Ce,Gv=new Fr,zd=new Ce,Gd=new Ce,Vd=new Ce,Rc=new Ce,Ic=new Ce,Zu=new Ce,Hm=new Ce,Vv=new Ce,Hv=new Ce,Qu=new Ce;function hw(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){Qu.fromArray(i,s);const a=r.x*Math.abs(Qu.x)+r.y*Math.abs(Qu.y)+r.z*Math.abs(Qu.z),l=e.dot(Qu),c=t.dot(Qu),u=n.dot(Qu);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const pW=new Fr,$m=new Ce,dw=new Ce;let kr=class{constructor(e=new Ce,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):pW.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;$m.subVectors(e,this.center);const t=$m.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector($m,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(dw.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint($m.copy(e.center).add(dw)),this.expandByPoint($m.copy(e.center).sub(dw))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}};const Al=new Ce,fw=new Ce,$v=new Ce,Lc=new Ce,pw=new Ce,Wv=new Ce,mw=new Ce;let Qp=class{constructor(e=new Ce,t=new Ce(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Al)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Al.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Al.copy(this.origin).addScaledVector(this.direction,t),Al.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){fw.copy(e).add(t).multiplyScalar(.5),$v.copy(t).sub(e).normalize(),Lc.copy(this.origin).sub(fw);const s=e.distanceTo(t)*.5,o=-this.direction.dot($v),a=Lc.dot(this.direction),l=-Lc.dot($v),c=Lc.lengthSq(),u=Math.abs(1-o*o);let h,d,f,m;if(u>0)if(h=o*l-a,d=o*a-l,m=s*u,h>=0)if(d>=-m)if(d<=m){const _=1/u;h*=_,d*=_,f=h*(h+o*d+2*a)+d*(o*h+d+2*l)+c}else d=s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d<=-m?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c):d<=m?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(fw).addScaledVector($v,d),f}intersectSphere(e,t){Al.subVectors(e.center,this.origin);const n=Al.dot(this.direction),r=Al.dot(Al)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(n=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(n=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),u>=0?(s=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,Al)!==null}intersectTriangle(e,t,n,r,s){pw.subVectors(t,e),Wv.subVectors(n,e),mw.crossVectors(pw,Wv);let o=this.direction.dot(mw),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Lc.subVectors(this.origin,e);const l=a*this.direction.dot(Wv.crossVectors(Lc,Wv));if(l<0)return null;const c=a*this.direction.dot(pw.cross(Lc));if(c<0||l+c>o)return null;const u=-a*Lc.dot(mw);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},nn=class ST{constructor(e,t,n,r,s,o,a,l,c,u,h,d,f,m,_,v){ST.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c,u,h,d,f,m,_,v)}set(e,t,n,r,s,o,a,l,c,u,h,d,f,m,_,v){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=s,g[5]=o,g[9]=a,g[13]=l,g[2]=c,g[6]=u,g[10]=h,g[14]=d,g[3]=f,g[7]=m,g[11]=_,g[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ST().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Hd.setFromMatrixColumn(e,0).length(),s=1/Hd.setFromMatrixColumn(e,1).length(),o=1/Hd.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*u,f=o*h,m=a*u,_=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=f+m*c,t[5]=d-_*c,t[9]=-a*l,t[2]=_-d*c,t[6]=m+f*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*u,f=l*h,m=c*u,_=c*h;t[0]=d+_*a,t[4]=m*a-f,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=f*a-m,t[6]=_+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*u,f=l*h,m=c*u,_=c*h;t[0]=d-_*a,t[4]=-o*h,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*u,t[9]=_-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*u,f=o*h,m=a*u,_=a*h;t[0]=l*u,t[4]=m*c-f,t[8]=d*c+_,t[1]=l*h,t[5]=_*c+d,t[9]=f*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,f=o*c,m=a*l,_=a*c;t[0]=l*u,t[4]=_-d*h,t[8]=m*h+f,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*h+m,t[10]=d-_*h}else if(e.order==="XZY"){const d=o*l,f=o*c,m=a*l,_=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=d*h+_,t[5]=o*u,t[9]=f*h-m,t[2]=m*h-f,t[6]=a*u,t[10]=_*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(mW,e,gW)}lookAt(e,t,n){const r=this.elements;return co.subVectors(e,t),co.lengthSq()===0&&(co.z=1),co.normalize(),Dc.crossVectors(n,co),Dc.lengthSq()===0&&(Math.abs(n.z)===1?co.x+=1e-4:co.z+=1e-4,co.normalize(),Dc.crossVectors(n,co)),Dc.normalize(),jv.crossVectors(co,Dc),r[0]=Dc.x,r[4]=jv.x,r[8]=co.x,r[1]=Dc.y,r[5]=jv.y,r[9]=co.y,r[2]=Dc.z,r[6]=jv.z,r[10]=co.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],u=n[1],h=n[5],d=n[9],f=n[13],m=n[2],_=n[6],v=n[10],g=n[14],b=n[3],p=n[7],y=n[11],A=n[15],w=r[0],M=r[4],T=r[8],E=r[12],C=r[1],N=r[5],P=r[9],L=r[13],R=r[2],F=r[6],V=r[10],z=r[14],U=r[3],G=r[7],B=r[11],D=r[15];return s[0]=o*w+a*C+l*R+c*U,s[4]=o*M+a*N+l*F+c*G,s[8]=o*T+a*P+l*V+c*B,s[12]=o*E+a*L+l*z+c*D,s[1]=u*w+h*C+d*R+f*U,s[5]=u*M+h*N+d*F+f*G,s[9]=u*T+h*P+d*V+f*B,s[13]=u*E+h*L+d*z+f*D,s[2]=m*w+_*C+v*R+g*U,s[6]=m*M+_*N+v*F+g*G,s[10]=m*T+_*P+v*V+g*B,s[14]=m*E+_*L+v*z+g*D,s[3]=b*w+p*C+y*R+A*U,s[7]=b*M+p*N+y*F+A*G,s[11]=b*T+p*P+y*V+A*B,s[15]=b*E+p*L+y*z+A*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],f=e[14],m=e[3],_=e[7],v=e[11],g=e[15];return m*(+s*l*h-r*c*h-s*a*d+n*c*d+r*a*f-n*l*f)+_*(+t*l*f-t*c*d+s*o*d-r*o*f+r*c*u-s*l*u)+v*(+t*c*h-t*a*f-s*o*h+n*o*f+s*a*u-n*c*u)+g*(-r*a*u-t*l*h+t*a*d+r*o*h-n*o*d+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],m=e[12],_=e[13],v=e[14],g=e[15],b=h*v*c-_*d*c+_*l*f-a*v*f-h*l*g+a*d*g,p=m*d*c-u*v*c-m*l*f+o*v*f+u*l*g-o*d*g,y=u*_*c-m*h*c+m*a*f-o*_*f-u*a*g+o*h*g,A=m*h*l-u*_*l-m*a*d+o*_*d+u*a*v-o*h*v,w=t*b+n*p+r*y+s*A;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/w;return e[0]=b*M,e[1]=(_*d*s-h*v*s-_*r*f+n*v*f+h*r*g-n*d*g)*M,e[2]=(a*v*s-_*l*s+_*r*c-n*v*c-a*r*g+n*l*g)*M,e[3]=(h*l*s-a*d*s-h*r*c+n*d*c+a*r*f-n*l*f)*M,e[4]=p*M,e[5]=(u*v*s-m*d*s+m*r*f-t*v*f-u*r*g+t*d*g)*M,e[6]=(m*l*s-o*v*s-m*r*c+t*v*c+o*r*g-t*l*g)*M,e[7]=(o*d*s-u*l*s+u*r*c-t*d*c-o*r*f+t*l*f)*M,e[8]=y*M,e[9]=(m*h*s-u*_*s-m*n*f+t*_*f+u*n*g-t*h*g)*M,e[10]=(o*_*s-m*a*s+m*n*c-t*_*c-o*n*g+t*a*g)*M,e[11]=(u*a*s-o*h*s-u*n*c+t*h*c+o*n*f-t*a*f)*M,e[12]=A*M,e[13]=(u*_*r-m*h*r+m*n*d-t*_*d-u*n*v+t*h*v)*M,e[14]=(m*a*r-o*_*r-m*n*l+t*_*l+o*n*v-t*a*v)*M,e[15]=(o*h*r-u*a*r+u*n*l-t*h*l-o*n*d+t*a*d)*M,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+n,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+n,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,h=a+a,d=s*c,f=s*u,m=s*h,_=o*u,v=o*h,g=a*h,b=l*c,p=l*u,y=l*h,A=n.x,w=n.y,M=n.z;return r[0]=(1-(_+g))*A,r[1]=(f+y)*A,r[2]=(m-p)*A,r[3]=0,r[4]=(f-y)*w,r[5]=(1-(d+g))*w,r[6]=(v+b)*w,r[7]=0,r[8]=(m+p)*M,r[9]=(v-b)*M,r[10]=(1-(d+_))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=Hd.set(r[0],r[1],r[2]).length();const o=Hd.set(r[4],r[5],r[6]).length(),a=Hd.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],ra.copy(this);const c=1/s,u=1/o,h=1/a;return ra.elements[0]*=c,ra.elements[1]*=c,ra.elements[2]*=c,ra.elements[4]*=u,ra.elements[5]*=u,ra.elements[6]*=u,ra.elements[8]*=h,ra.elements[9]*=h,ra.elements[10]*=h,t.setFromRotationMatrix(ra),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o,a=Ta){const l=this.elements,c=2*s/(t-e),u=2*s/(n-r),h=(t+e)/(t-e),d=(n+r)/(n-r);let f,m;if(a===Ta)f=-(o+s)/(o-s),m=-2*o*s/(o-s);else if(a===Lp)f=-o/(o-s),m=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,s,o,a=Ta){const l=this.elements,c=1/(t-e),u=1/(n-r),h=1/(o-s),d=(t+e)*c,f=(n+r)*u;let m,_;if(a===Ta)m=(o+s)*h,_=-2*h;else if(a===Lp)m=s*h,_=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=_,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};const Hd=new Ce,ra=new nn,mW=new Ce(0,0,0),gW=new Ce(1,1,1),Dc=new Ce,jv=new Ce,co=new Ce,YL=new nn,KL=new As;let d1=class Uz{constructor(e=0,t=0,n=0,r=Uz.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(Ni(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ni(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ni(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Ni(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Ni(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Ni(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return YL.makeRotationFromQuaternion(e),this.setFromRotationMatrix(YL,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return KL.setFromEuler(this),this.setFromQuaternion(KL,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};d1.DEFAULT_ORDER="XYZ";let Vh=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},vW=0;const ZL=new Ce,$d=new As,El=new nn,Xv=new Ce,Wm=new Ce,_W=new Ce,yW=new As,QL=new Ce(1,0,0),JL=new Ce(0,1,0),eD=new Ce(0,0,1),xW={type:"added"},bW={type:"removed"};let qn=class rx extends gc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:vW++}),this.uuid=bo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=rx.DEFAULT_UP.clone();const e=new Ce,t=new d1,n=new As,r=new Ce(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new nn},normalMatrix:{value:new yn}}),this.matrix=new nn,this.matrixWorld=new nn,this.matrixAutoUpdate=rx.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=rx.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Vh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return $d.setFromAxisAngle(e,t),this.quaternion.multiply($d),this}rotateOnWorldAxis(e,t){return $d.setFromAxisAngle(e,t),this.quaternion.premultiply($d),this}rotateX(e){return this.rotateOnAxis(QL,e)}rotateY(e){return this.rotateOnAxis(JL,e)}rotateZ(e){return this.rotateOnAxis(eD,e)}translateOnAxis(e,t){return ZL.copy(e).applyQuaternion(this.quaternion),this.position.add(ZL.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(QL,e)}translateY(e){return this.translateOnAxis(JL,e)}translateZ(e){return this.translateOnAxis(eD,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(El.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Xv.copy(e):Xv.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),Wm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?El.lookAt(Wm,Xv,this.up):El.lookAt(Xv,Wm,this.up),this.quaternion.setFromRotationMatrix(El),r&&(El.extractRotation(r.matrixWorld),$d.setFromRotationMatrix(El),this.quaternion.premultiply($d.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(xW)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(bW)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),El.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),El.multiply(e.parent.matrixWorld)),e.applyMatrix4(El),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wm,e,_W),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wm,yW,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const s=t[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),d=o(e.skeletons),f=o(e.animations),m=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),h.length>0&&(n.shapes=h),d.length>0&&(n.skeletons=d),f.length>0&&(n.animations=f),m.length>0&&(n.nodes=m)}return n.object=r,n;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}};qn.DEFAULT_UP=new Ce(0,1,0);qn.DEFAULT_MATRIX_AUTO_UPDATE=!0;qn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const sa=new Ce,Tl=new Ce,gw=new Ce,Cl=new Ce,Wd=new Ce,jd=new Ce,tD=new Ce,vw=new Ce,_w=new Ce,yw=new Ce;let qv=!1,Fh=class yh{constructor(e=new Ce,t=new Ce,n=new Ce){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),sa.subVectors(e,t),r.cross(sa);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){sa.subVectors(r,t),Tl.subVectors(n,t),gw.subVectors(e,t);const o=sa.dot(sa),a=sa.dot(Tl),l=sa.dot(gw),c=Tl.dot(Tl),u=Tl.dot(gw),h=o*c-a*a;if(h===0)return s.set(0,0,0),null;const d=1/h,f=(c*l-a*u)*d,m=(o*u-a*l)*d;return s.set(1-f-m,m,f)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Cl)===null?!1:Cl.x>=0&&Cl.y>=0&&Cl.x+Cl.y<=1}static getUV(e,t,n,r,s,o,a,l){return qv===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),qv=!0),this.getInterpolation(e,t,n,r,s,o,a,l)}static getInterpolation(e,t,n,r,s,o,a,l){return this.getBarycoord(e,t,n,r,Cl)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Cl.x),l.addScaledVector(o,Cl.y),l.addScaledVector(a,Cl.z),l)}static isFrontFacing(e,t,n,r){return sa.subVectors(n,t),Tl.subVectors(e,t),sa.cross(Tl).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return sa.subVectors(this.c,this.b),Tl.subVectors(this.a,this.b),sa.cross(Tl).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return yh.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return yh.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,s){return qv===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),qv=!0),yh.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}getInterpolation(e,t,n,r,s){return yh.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return yh.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return yh.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;Wd.subVectors(r,n),jd.subVectors(s,n),vw.subVectors(e,n);const l=Wd.dot(vw),c=jd.dot(vw);if(l<=0&&c<=0)return t.copy(n);_w.subVectors(e,r);const u=Wd.dot(_w),h=jd.dot(_w);if(u>=0&&h<=u)return t.copy(r);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(Wd,o);yw.subVectors(e,s);const f=Wd.dot(yw),m=jd.dot(yw);if(m>=0&&f<=m)return t.copy(s);const _=f*c-l*m;if(_<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(n).addScaledVector(jd,a);const v=u*m-f*h;if(v<=0&&h-u>=0&&f-m>=0)return tD.subVectors(s,r),a=(h-u)/(h-u+(f-m)),t.copy(r).addScaledVector(tD,a);const g=1/(v+_+d);return o=_*g,a=d*g,t.copy(n).addScaledVector(Wd,o).addScaledVector(jd,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const Oz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nc={h:0,s:0,l:0},Yv={h:0,s:0,l:0};function xw(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}let kt=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=lr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,On.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=On.workingColorSpace){return this.r=e,this.g=t,this.b=n,On.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=On.workingColorSpace){if(e=GP(e,1),t=Ni(t,0,1),n=Ni(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=xw(o,s,e+1/3),this.g=xw(o,s,e),this.b=xw(o,s,e-1/3)}return On.toWorkingColorSpace(this,r),this}setStyle(e,t=lr){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=lr){const n=Oz[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=gp(e.r),this.g=gp(e.g),this.b=gp(e.b),this}copyLinearToSRGB(e){return this.r=lw(e.r),this.g=lw(e.g),this.b=lw(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=lr){return On.fromWorkingColorSpace(qr.copy(this),e),Math.round(Ni(qr.r*255,0,255))*65536+Math.round(Ni(qr.g*255,0,255))*256+Math.round(Ni(qr.b*255,0,255))}getHexString(e=lr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=On.workingColorSpace){On.fromWorkingColorSpace(qr.copy(this),t);const n=qr.r,r=qr.g,s=qr.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case n:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-n)/h+2;break;case s:l=(n-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=On.workingColorSpace){return On.fromWorkingColorSpace(qr.copy(this),t),e.r=qr.r,e.g=qr.g,e.b=qr.b,e}getStyle(e=lr){On.fromWorkingColorSpace(qr.copy(this),e);const t=qr.r,n=qr.g,r=qr.b;return e!==lr?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Nc),this.setHSL(Nc.h+e,Nc.s+t,Nc.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Nc),e.getHSL(Yv);const n=qg(Nc.h,Yv.h,t),r=qg(Nc.s,Yv.s,t),s=qg(Nc.l,Yv.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const qr=new kt;kt.NAMES=Oz;let SW=0,Or=class extends gc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:SW++}),this.uuid=bo(),this.name="",this.type="Material",this.blending=zh,this.side=ac,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=qx,this.blendDst=Yx,this.blendEquation=eu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new kt(0,0,0),this.blendAlpha=0,this.depthFunc=E0,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=yT,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=_h,this.stencilZFail=_h,this.stencilZPass=_h,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==zh&&(n.blending=this.blending),this.side!==ac&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==qx&&(n.blendSrc=this.blendSrc),this.blendDst!==Yx&&(n.blendDst=this.blendDst),this.blendEquation!==eu&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==E0&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==yT&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==_h&&(n.stencilFail=this.stencilFail),this.stencilZFail!==_h&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==_h&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},qo=class extends Or{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new kt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=u1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}};const jl=wW();function wW(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(n[l]=0,n[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,r[l]=24,r[l|256]=24):(n[l]=31744,n[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function Os(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=Ni(i,-65504,65504),jl.floatView[0]=i;const e=jl.uint32View[0],t=e>>23&511;return jl.baseTable[t]+((e&8388607)>>jl.shiftTable[t])}function Ag(i){const e=i>>10;return jl.uint32View[0]=jl.mantissaTable[jl.offsetTable[e]+(i&1023)]+jl.exponentTable[e],jl.floatView[0]}const MW={toHalfFloat:Os,fromHalfFloat:Ag},qi=new Ce,Kv=new xt;let En=class{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=U0,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Ea,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Kv.fromBufferAttribute(this,t),Kv.applyMatrix3(e),this.setXY(t,Kv.x,Kv.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)qi.fromBufferAttribute(this,t),qi.applyMatrix3(e),this.setXYZ(t,qi.x,qi.y,qi.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)qi.fromBufferAttribute(this,t),qi.applyMatrix4(e),this.setXYZ(t,qi.x,qi.y,qi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)qi.fromBufferAttribute(this,t),qi.applyNormalMatrix(e),this.setXYZ(t,qi.x,qi.y,qi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)qi.fromBufferAttribute(this,t),qi.transformDirection(e),this.setXYZ(t,qi.x,qi.y,qi.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=$s(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=fn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=$s(t,this.array)),t}setX(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=$s(t,this.array)),t}setY(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=$s(t,this.array)),t}setZ(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=$s(t,this.array)),t}setW(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),r=fn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),r=fn(r,this.array),s=fn(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==U0&&(e.usage=this.usage),e}};class AW extends En{constructor(e,t,n){super(new Int8Array(e),t,n)}}class EW extends En{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class TW extends En{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class CW extends En{constructor(e,t,n){super(new Int16Array(e),t,n)}}let $P=class extends En{constructor(e,t,n){super(new Uint16Array(e),t,n)}};class PW extends En{constructor(e,t,n){super(new Int32Array(e),t,n)}}let WP=class extends En{constructor(e,t,n){super(new Uint32Array(e),t,n)}};class RW extends En{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Ag(this.array[e*this.itemSize]);return this.normalized&&(t=$s(t,this.array)),t}setX(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize]=Os(t),this}getY(e){let t=Ag(this.array[e*this.itemSize+1]);return this.normalized&&(t=$s(t,this.array)),t}setY(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+1]=Os(t),this}getZ(e){let t=Ag(this.array[e*this.itemSize+2]);return this.normalized&&(t=$s(t,this.array)),t}setZ(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+2]=Os(t),this}getW(e){let t=Ag(this.array[e*this.itemSize+3]);return this.normalized&&(t=$s(t,this.array)),t}setW(e,t){return this.normalized&&(t=fn(t,this.array)),this.array[e*this.itemSize+3]=Os(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array)),this.array[e+0]=Os(t),this.array[e+1]=Os(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),r=fn(r,this.array)),this.array[e+0]=Os(t),this.array[e+1]=Os(n),this.array[e+2]=Os(r),this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),r=fn(r,this.array),s=fn(s,this.array)),this.array[e+0]=Os(t),this.array[e+1]=Os(n),this.array[e+2]=Os(r),this.array[e+3]=Os(s),this}}let Wt=class extends En{constructor(e,t,n){super(new Float32Array(e),t,n)}};class IW extends En{constructor(e,t,n){super(new Float64Array(e),t,n)}}let LW=0;const ko=new nn,bw=new qn,Xd=new Ce,uo=new Fr,jm=new Fr,xr=new Ce;let xn=class Bz extends gc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:LW++}),this.uuid=bo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Lz(e)?WP:$P)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new yn().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ko.makeRotationFromQuaternion(e),this.applyMatrix4(ko),this}rotateX(e){return ko.makeRotationX(e),this.applyMatrix4(ko),this}rotateY(e){return ko.makeRotationY(e),this.applyMatrix4(ko),this}rotateZ(e){return ko.makeRotationZ(e),this.applyMatrix4(ko),this}translate(e,t,n){return ko.makeTranslation(e,t,n),this.applyMatrix4(ko),this}scale(e,t,n){return ko.makeScale(e,t,n),this.applyMatrix4(ko),this}lookAt(e){return bw.lookAt(e),bw.updateMatrix(),this.applyMatrix4(bw.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xd).negate(),this.translate(Xd.x,Xd.y,Xd.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Wt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Fr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Ce(-1/0,-1/0,-1/0),new Ce(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];uo.setFromBufferAttribute(s),this.morphTargetsRelative?(xr.addVectors(this.boundingBox.min,uo.min),this.boundingBox.expandByPoint(xr),xr.addVectors(this.boundingBox.max,uo.max),this.boundingBox.expandByPoint(xr)):(this.boundingBox.expandByPoint(uo.min),this.boundingBox.expandByPoint(uo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new kr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Ce,1/0);return}if(e){const n=this.boundingSphere.center;if(uo.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];jm.setFromBufferAttribute(a),this.morphTargetsRelative?(xr.addVectors(uo.min,jm.min),uo.expandByPoint(xr),xr.addVectors(uo.max,jm.max),uo.expandByPoint(xr)):(uo.expandByPoint(jm.min),uo.expandByPoint(jm.max))}uo.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)xr.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(xr));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)xr.fromBufferAttribute(a,c),l&&(Xd.fromBufferAttribute(e,c),xr.add(Xd)),r=Math.max(r,n.distanceToSquared(xr))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new En(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let C=0;C<a;C++)c[C]=new Ce,u[C]=new Ce;const h=new Ce,d=new Ce,f=new Ce,m=new xt,_=new xt,v=new xt,g=new Ce,b=new Ce;function p(C,N,P){h.fromArray(r,C*3),d.fromArray(r,N*3),f.fromArray(r,P*3),m.fromArray(o,C*2),_.fromArray(o,N*2),v.fromArray(o,P*2),d.sub(h),f.sub(h),_.sub(m),v.sub(m);const L=1/(_.x*v.y-v.x*_.y);isFinite(L)&&(g.copy(d).multiplyScalar(v.y).addScaledVector(f,-_.y).multiplyScalar(L),b.copy(f).multiplyScalar(_.x).addScaledVector(d,-v.x).multiplyScalar(L),c[C].add(g),c[N].add(g),c[P].add(g),u[C].add(b),u[N].add(b),u[P].add(b))}let y=this.groups;y.length===0&&(y=[{start:0,count:n.length}]);for(let C=0,N=y.length;C<N;++C){const P=y[C],L=P.start,R=P.count;for(let F=L,V=L+R;F<V;F+=3)p(n[F+0],n[F+1],n[F+2])}const A=new Ce,w=new Ce,M=new Ce,T=new Ce;function E(C){M.fromArray(s,C*3),T.copy(M);const N=c[C];A.copy(N),A.sub(M.multiplyScalar(M.dot(N))).normalize(),w.crossVectors(T,N);const L=w.dot(u[C])<0?-1:1;l[C*4]=A.x,l[C*4+1]=A.y,l[C*4+2]=A.z,l[C*4+3]=L}for(let C=0,N=y.length;C<N;++C){const P=y[C],L=P.start,R=P.count;for(let F=L,V=L+R;F<V;F+=3)E(n[F+0]),E(n[F+1]),E(n[F+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new En(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let d=0,f=n.count;d<f;d++)n.setXYZ(d,0,0,0);const r=new Ce,s=new Ce,o=new Ce,a=new Ce,l=new Ce,c=new Ce,u=new Ce,h=new Ce;if(e)for(let d=0,f=e.count;d<f;d+=3){const m=e.getX(d+0),_=e.getX(d+1),v=e.getX(d+2);r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,v),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(n,m),l.fromBufferAttribute(n,_),c.fromBufferAttribute(n,v),a.add(u),l.add(u),c.add(u),n.setXYZ(m,a.x,a.y,a.z),n.setXYZ(_,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let d=0,f=t.count;d<f;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),n.setXYZ(d+0,u.x,u.y,u.z),n.setXYZ(d+1,u.x,u.y,u.z),n.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)xr.fromBufferAttribute(e,t),xr.normalize(),e.setXYZ(t,xr.x,xr.y,xr.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,d=new c.constructor(l.length*u);let f=0,m=0;for(let _=0,v=l.length;_<v;_++){a.isInterleavedBufferAttribute?f=l[_]*a.data.stride+a.offset:f=l[_]*u;for(let g=0;g<u;g++)d[m++]=c[f++]}return new En(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Bz,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,n);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const d=c[u],f=e(d,n);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h];u.push(f.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const nD=new nn,Ju=new Qp,Zv=new kr,iD=new Ce,qd=new Ce,Yd=new Ce,Kd=new Ce,Sw=new Ce,Qv=new Ce,Jv=new xt,e_=new xt,t_=new xt,rD=new Ce,sD=new Ce,oD=new Ce,n_=new Ce,i_=new Ce;let gi=class extends qn{constructor(e=new xn,t=new qo){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){Qv.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],h=s[l];u!==0&&(Sw.fromBufferAttribute(h,e),o?Qv.addScaledVector(Sw,u):Qv.addScaledVector(Sw.sub(t),u))}t.add(Qv)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Zv.copy(n.boundingSphere),Zv.applyMatrix4(s),Ju.copy(e.ray).recast(e.near),!(Zv.containsPoint(Ju.origin)===!1&&(Ju.intersectSphere(Zv,iD)===null||Ju.origin.distanceToSquared(iD)>(e.far-e.near)**2))&&(nD.copy(s).invert(),Ju.copy(e.ray).applyMatrix4(nD),!(n.boundingBox!==null&&Ju.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Ju)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,_=d.length;m<_;m++){const v=d[m],g=o[v.materialIndex],b=Math.max(v.start,f.start),p=Math.min(a.count,Math.min(v.start+v.count,f.start+f.count));for(let y=b,A=p;y<A;y+=3){const w=a.getX(y),M=a.getX(y+1),T=a.getX(y+2);r=r_(this,g,e,n,c,u,h,w,M,T),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=v.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),_=Math.min(a.count,f.start+f.count);for(let v=m,g=_;v<g;v+=3){const b=a.getX(v),p=a.getX(v+1),y=a.getX(v+2);r=r_(this,o,e,n,c,u,h,b,p,y),r&&(r.faceIndex=Math.floor(v/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,_=d.length;m<_;m++){const v=d[m],g=o[v.materialIndex],b=Math.max(v.start,f.start),p=Math.min(l.count,Math.min(v.start+v.count,f.start+f.count));for(let y=b,A=p;y<A;y+=3){const w=y,M=y+1,T=y+2;r=r_(this,g,e,n,c,u,h,w,M,T),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=v.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),_=Math.min(l.count,f.start+f.count);for(let v=m,g=_;v<g;v+=3){const b=v,p=v+1,y=v+2;r=r_(this,o,e,n,c,u,h,b,p,y),r&&(r.faceIndex=Math.floor(v/3),t.push(r))}}}};function DW(i,e,t,n,r,s,o,a){let l;if(e.side===Ms?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,e.side===ac,a),l===null)return null;i_.copy(a),i_.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(i_);return c<t.near||c>t.far?null:{distance:c,point:i_.clone(),object:i}}function r_(i,e,t,n,r,s,o,a,l,c){i.getVertexPosition(a,qd),i.getVertexPosition(l,Yd),i.getVertexPosition(c,Kd);const u=DW(i,e,t,n,qd,Yd,Kd,n_);if(u){r&&(Jv.fromBufferAttribute(r,a),e_.fromBufferAttribute(r,l),t_.fromBufferAttribute(r,c),u.uv=Fh.getInterpolation(n_,qd,Yd,Kd,Jv,e_,t_,new xt)),s&&(Jv.fromBufferAttribute(s,a),e_.fromBufferAttribute(s,l),t_.fromBufferAttribute(s,c),u.uv1=Fh.getInterpolation(n_,qd,Yd,Kd,Jv,e_,t_,new xt),u.uv2=u.uv1),o&&(rD.fromBufferAttribute(o,a),sD.fromBufferAttribute(o,l),oD.fromBufferAttribute(o,c),u.normal=Fh.getInterpolation(n_,qd,Yd,Kd,rD,sD,oD,new Ce),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:l,c,normal:new Ce,materialIndex:0};Fh.getNormal(qd,Yd,Kd,h.normal),u.face=h}return u}let f1=class zz extends xn{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],h=[];let d=0,f=0;m("z","y","x",-1,-1,n,t,e,o,s,0),m("z","y","x",1,-1,n,t,-e,o,s,1),m("x","z","y",1,1,e,n,t,r,o,2),m("x","z","y",1,-1,e,n,-t,r,o,3),m("x","y","z",1,-1,e,t,n,r,s,4),m("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new Wt(c,3)),this.setAttribute("normal",new Wt(u,3)),this.setAttribute("uv",new Wt(h,2));function m(_,v,g,b,p,y,A,w,M,T,E){const C=y/M,N=A/T,P=y/2,L=A/2,R=w/2,F=M+1,V=T+1;let z=0,U=0;const G=new Ce;for(let B=0;B<V;B++){const D=B*N-L;for(let O=0;O<F;O++){const j=O*C-P;G[_]=j*b,G[v]=D*p,G[g]=R,c.push(G.x,G.y,G.z),G[_]=0,G[v]=0,G[g]=w>0?1:-1,u.push(G.x,G.y,G.z),h.push(O/M),h.push(1-B/T),z+=1}}for(let B=0;B<T;B++)for(let D=0;D<M;D++){const O=d+D+F*B,j=d+D+F*(B+1),q=d+(D+1)+F*(B+1),Y=d+(D+1)+F*B;l.push(O,j,Y),l.push(j,q,Y),U+=6}a.addGroup(f,U,E),f+=U,d+=z}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zz(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Np(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function vs(i){const e={};for(let t=0;t<i.length;t++){const n=Np(i[t]);for(const r in n)e[r]=n[r]}return e}function NW(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function Gz(i){return i.getRenderTarget()===null?i.outputColorSpace:On.workingColorSpace}const jP={clone:Np,merge:vs};var FW=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,kW=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;let dl=class extends Or{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=FW,this.fragmentShader=kW,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Np(e.uniforms),this.uniformsGroups=NW(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}},p1=class extends qn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new nn,this.projectionMatrix=new nn,this.projectionMatrixInverse=new nn,this.coordinateSystem=Ta}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Ji=class extends p1{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Dp*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Gh*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Dp*2*Math.atan(Math.tan(Gh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Gh*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*n/c,r*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const Zd=-90,Qd=1;let Vz=class extends qn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Ji(Zd,Qd,e,t);r.layers=this.layers,this.add(r);const s=new Ji(Zd,Qd,e,t);s.layers=this.layers,this.add(s);const o=new Ji(Zd,Qd,e,t);o.layers=this.layers,this.add(o);const a=new Ji(Zd,Qd,e,t);a.layers=this.layers,this.add(a);const l=new Ji(Zd,Qd,e,t);l.layers=this.layers,this.add(l);const c=new Ji(Zd,Qd,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===Ta)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===Lp)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const _=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,l),e.setRenderTarget(n,4,r),e.render(t,c),n.texture.generateMipmaps=_,e.setRenderTarget(n,5,r),e.render(t,u),e.setRenderTarget(h,d,f),e.xr.enabled=m,n.texture.needsPMREMUpdate=!0}},m1=class extends Tr{constructor(e,t,n,r,s,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:lc,super(e,t,n,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Hz=class extends Na{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];t.encoding!==void 0&&(Yg("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===mu?lr:_o),this.texture=new m1(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Mi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new f1(5,5,5),s=new dl({name:"CubemapFromEquirect",uniforms:Np(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ms,blending:ec});s.uniforms.tEquirect.value=t;const o=new gi(r,s),a=t.minFilter;return t.minFilter===Mu&&(t.minFilter=Mi),new Vz(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}};const ww=new Ce,UW=new Ce,OW=new yn;let qc=class{constructor(e=new Ce(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=ww.subVectors(n,t).cross(UW.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(ww),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||OW.getNormalMatrix(e),r=this.coplanarPoint(ww).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const eh=new kr,s_=new Ce;let g1=class{constructor(e=new qc,t=new qc,n=new qc,r=new qc,s=new qc,o=new qc){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Ta){const n=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],h=r[6],d=r[7],f=r[8],m=r[9],_=r[10],v=r[11],g=r[12],b=r[13],p=r[14],y=r[15];if(n[0].setComponents(l-s,d-c,v-f,y-g).normalize(),n[1].setComponents(l+s,d+c,v+f,y+g).normalize(),n[2].setComponents(l+o,d+u,v+m,y+b).normalize(),n[3].setComponents(l-o,d-u,v-m,y-b).normalize(),n[4].setComponents(l-a,d-h,v-_,y-p).normalize(),t===Ta)n[5].setComponents(l+a,d+h,v+_,y+p).normalize();else if(t===Lp)n[5].setComponents(a,h,_,p).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),eh.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),eh.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(eh)}intersectsSprite(e){return eh.center.set(0,0,0),eh.radius=.7071067811865476,eh.applyMatrix4(e.matrixWorld),this.intersectsSphere(eh)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(s_.x=r.normal.x>0?e.max.x:e.min.x,s_.y=r.normal.y>0?e.max.y:e.min.y,s_.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(s_)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function $z(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function BW(i,e){const t=e.isWebGL2,n=new WeakMap;function r(c,u){const h=c.array,d=c.usage,f=h.byteLength,m=i.createBuffer();i.bindBuffer(u,m),i.bufferData(u,h,d),c.onUploadCallback();let _;if(h instanceof Float32Array)_=i.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)_=i.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else _=i.UNSIGNED_SHORT;else if(h instanceof Int16Array)_=i.SHORT;else if(h instanceof Uint32Array)_=i.UNSIGNED_INT;else if(h instanceof Int32Array)_=i.INT;else if(h instanceof Int8Array)_=i.BYTE;else if(h instanceof Uint8Array)_=i.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)_=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:m,type:_,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version,size:f}}function s(c,u,h){const d=u.array,f=u._updateRange,m=u.updateRanges;if(i.bindBuffer(h,c),f.count===-1&&m.length===0&&i.bufferSubData(h,0,d),m.length!==0){for(let _=0,v=m.length;_<v;_++){const g=m[_];t?i.bufferSubData(h,g.start*d.BYTES_PER_ELEMENT,d,g.start,g.count):i.bufferSubData(h,g.start*d.BYTES_PER_ELEMENT,d.subarray(g.start,g.start+g.count))}u.clearUpdateRanges()}f.count!==-1&&(t?i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=n.get(c);u&&(i.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const d=n.get(c);(!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=n.get(c);if(h===void 0)n.set(c,r(c,u));else if(h.version<c.version){if(h.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(h.buffer,c,u),h.version=c.version}}return{get:o,remove:a,update:l}}let gd=class Wz extends xn{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(r),c=a+1,u=l+1,h=e/a,d=t/l,f=[],m=[],_=[],v=[];for(let g=0;g<u;g++){const b=g*d-o;for(let p=0;p<c;p++){const y=p*h-s;m.push(y,-b,0),_.push(0,0,1),v.push(p/a),v.push(1-g/l)}}for(let g=0;g<l;g++)for(let b=0;b<a;b++){const p=b+c*g,y=b+c*(g+1),A=b+1+c*(g+1),w=b+1+c*g;f.push(p,y,w),f.push(y,A,w)}this.setIndex(f),this.setAttribute("position",new Wt(m,3)),this.setAttribute("normal",new Wt(_,3)),this.setAttribute("uv",new Wt(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wz(e.width,e.height,e.widthSegments,e.heightSegments)}};var zW=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,GW=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,VW=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,HW=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,$W=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,WW=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,jW=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,XW=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,qW=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,YW=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,KW=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,ZW=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,QW=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,JW=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,ej=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,tj=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,nj=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,ij=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,rj=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,sj=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,oj=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,aj=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,lj=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,cj=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,uj=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,hj=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,dj=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,fj=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,pj=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,mj=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,gj="gl_FragColor = linearToOutputTexel( gl_FragColor );",vj=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,_j=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,yj=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,xj=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,bj=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Sj=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,wj=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Mj=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Aj=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Ej=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Tj=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Cj=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Pj=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Rj=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Ij=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Lj=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Dj=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Nj=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Fj=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,kj=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Uj=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Oj=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Bj=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,zj=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Gj=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Vj=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Hj=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,$j=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Wj=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,jj=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Xj=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,qj=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Yj=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Kj=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Zj=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Qj=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Jj=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,eX=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,tX=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,nX=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,iX=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,rX=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,sX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,oX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,aX=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,lX=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,cX=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,uX=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,hX=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,dX=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,fX=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,pX=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,mX=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,gX=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,vX=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,_X=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,yX=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,xX=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,bX=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,SX=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,wX=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,MX=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,AX=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,EX=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,TX=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,CX=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,PX=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,RX=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,IX=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,LX=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color *= toneMappingExposure;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	return color;
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,DX=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,NX=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,FX=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,kX=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,UX=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,OX=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const BX=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,zX=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,GX=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,VX=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,HX=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$X=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,WX=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,jX=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,XX=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,qX=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,YX=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,KX=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ZX=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,QX=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,JX=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,eq=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tq=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nq=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,iq=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,rq=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,sq=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,oq=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,aq=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lq=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cq=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,uq=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hq=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dq=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fq=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,pq=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,mq=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gq=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vq=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,_q=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,cn={alphahash_fragment:zW,alphahash_pars_fragment:GW,alphamap_fragment:VW,alphamap_pars_fragment:HW,alphatest_fragment:$W,alphatest_pars_fragment:WW,aomap_fragment:jW,aomap_pars_fragment:XW,batching_pars_vertex:qW,batching_vertex:YW,begin_vertex:KW,beginnormal_vertex:ZW,bsdfs:QW,iridescence_fragment:JW,bumpmap_pars_fragment:ej,clipping_planes_fragment:tj,clipping_planes_pars_fragment:nj,clipping_planes_pars_vertex:ij,clipping_planes_vertex:rj,color_fragment:sj,color_pars_fragment:oj,color_pars_vertex:aj,color_vertex:lj,common:cj,cube_uv_reflection_fragment:uj,defaultnormal_vertex:hj,displacementmap_pars_vertex:dj,displacementmap_vertex:fj,emissivemap_fragment:pj,emissivemap_pars_fragment:mj,colorspace_fragment:gj,colorspace_pars_fragment:vj,envmap_fragment:_j,envmap_common_pars_fragment:yj,envmap_pars_fragment:xj,envmap_pars_vertex:bj,envmap_physical_pars_fragment:Dj,envmap_vertex:Sj,fog_vertex:wj,fog_pars_vertex:Mj,fog_fragment:Aj,fog_pars_fragment:Ej,gradientmap_pars_fragment:Tj,lightmap_fragment:Cj,lightmap_pars_fragment:Pj,lights_lambert_fragment:Rj,lights_lambert_pars_fragment:Ij,lights_pars_begin:Lj,lights_toon_fragment:Nj,lights_toon_pars_fragment:Fj,lights_phong_fragment:kj,lights_phong_pars_fragment:Uj,lights_physical_fragment:Oj,lights_physical_pars_fragment:Bj,lights_fragment_begin:zj,lights_fragment_maps:Gj,lights_fragment_end:Vj,logdepthbuf_fragment:Hj,logdepthbuf_pars_fragment:$j,logdepthbuf_pars_vertex:Wj,logdepthbuf_vertex:jj,map_fragment:Xj,map_pars_fragment:qj,map_particle_fragment:Yj,map_particle_pars_fragment:Kj,metalnessmap_fragment:Zj,metalnessmap_pars_fragment:Qj,morphcolor_vertex:Jj,morphnormal_vertex:eX,morphtarget_pars_vertex:tX,morphtarget_vertex:nX,normal_fragment_begin:iX,normal_fragment_maps:rX,normal_pars_fragment:sX,normal_pars_vertex:oX,normal_vertex:aX,normalmap_pars_fragment:lX,clearcoat_normal_fragment_begin:cX,clearcoat_normal_fragment_maps:uX,clearcoat_pars_fragment:hX,iridescence_pars_fragment:dX,opaque_fragment:fX,packing:pX,premultiplied_alpha_fragment:mX,project_vertex:gX,dithering_fragment:vX,dithering_pars_fragment:_X,roughnessmap_fragment:yX,roughnessmap_pars_fragment:xX,shadowmap_pars_fragment:bX,shadowmap_pars_vertex:SX,shadowmap_vertex:wX,shadowmask_pars_fragment:MX,skinbase_vertex:AX,skinning_pars_vertex:EX,skinning_vertex:TX,skinnormal_vertex:CX,specularmap_fragment:PX,specularmap_pars_fragment:RX,tonemapping_fragment:IX,tonemapping_pars_fragment:LX,transmission_fragment:DX,transmission_pars_fragment:NX,uv_pars_fragment:FX,uv_pars_vertex:kX,uv_vertex:UX,worldpos_vertex:OX,background_vert:BX,background_frag:zX,backgroundCube_vert:GX,backgroundCube_frag:VX,cube_vert:HX,cube_frag:$X,depth_vert:WX,depth_frag:jX,distanceRGBA_vert:XX,distanceRGBA_frag:qX,equirect_vert:YX,equirect_frag:KX,linedashed_vert:ZX,linedashed_frag:QX,meshbasic_vert:JX,meshbasic_frag:eq,meshlambert_vert:tq,meshlambert_frag:nq,meshmatcap_vert:iq,meshmatcap_frag:rq,meshnormal_vert:sq,meshnormal_frag:oq,meshphong_vert:aq,meshphong_frag:lq,meshphysical_vert:cq,meshphysical_frag:uq,meshtoon_vert:hq,meshtoon_frag:dq,points_vert:fq,points_frag:pq,shadow_vert:mq,shadow_frag:gq,sprite_vert:vq,sprite_frag:_q},Nt={common:{diffuse:{value:new kt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new yn},alphaMap:{value:null},alphaMapTransform:{value:new yn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new yn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new yn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new yn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new yn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new yn},normalScale:{value:new xt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new yn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new yn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new yn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new yn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new kt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new kt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new yn},alphaTest:{value:0},uvTransform:{value:new yn}},sprite:{diffuse:{value:new kt(16777215)},opacity:{value:1},center:{value:new xt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new yn},alphaMap:{value:null},alphaMapTransform:{value:new yn},alphaTest:{value:0}}},ya={basic:{uniforms:vs([Nt.common,Nt.specularmap,Nt.envmap,Nt.aomap,Nt.lightmap,Nt.fog]),vertexShader:cn.meshbasic_vert,fragmentShader:cn.meshbasic_frag},lambert:{uniforms:vs([Nt.common,Nt.specularmap,Nt.envmap,Nt.aomap,Nt.lightmap,Nt.emissivemap,Nt.bumpmap,Nt.normalmap,Nt.displacementmap,Nt.fog,Nt.lights,{emissive:{value:new kt(0)}}]),vertexShader:cn.meshlambert_vert,fragmentShader:cn.meshlambert_frag},phong:{uniforms:vs([Nt.common,Nt.specularmap,Nt.envmap,Nt.aomap,Nt.lightmap,Nt.emissivemap,Nt.bumpmap,Nt.normalmap,Nt.displacementmap,Nt.fog,Nt.lights,{emissive:{value:new kt(0)},specular:{value:new kt(1118481)},shininess:{value:30}}]),vertexShader:cn.meshphong_vert,fragmentShader:cn.meshphong_frag},standard:{uniforms:vs([Nt.common,Nt.envmap,Nt.aomap,Nt.lightmap,Nt.emissivemap,Nt.bumpmap,Nt.normalmap,Nt.displacementmap,Nt.roughnessmap,Nt.metalnessmap,Nt.fog,Nt.lights,{emissive:{value:new kt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:cn.meshphysical_vert,fragmentShader:cn.meshphysical_frag},toon:{uniforms:vs([Nt.common,Nt.aomap,Nt.lightmap,Nt.emissivemap,Nt.bumpmap,Nt.normalmap,Nt.displacementmap,Nt.gradientmap,Nt.fog,Nt.lights,{emissive:{value:new kt(0)}}]),vertexShader:cn.meshtoon_vert,fragmentShader:cn.meshtoon_frag},matcap:{uniforms:vs([Nt.common,Nt.bumpmap,Nt.normalmap,Nt.displacementmap,Nt.fog,{matcap:{value:null}}]),vertexShader:cn.meshmatcap_vert,fragmentShader:cn.meshmatcap_frag},points:{uniforms:vs([Nt.points,Nt.fog]),vertexShader:cn.points_vert,fragmentShader:cn.points_frag},dashed:{uniforms:vs([Nt.common,Nt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:cn.linedashed_vert,fragmentShader:cn.linedashed_frag},depth:{uniforms:vs([Nt.common,Nt.displacementmap]),vertexShader:cn.depth_vert,fragmentShader:cn.depth_frag},normal:{uniforms:vs([Nt.common,Nt.bumpmap,Nt.normalmap,Nt.displacementmap,{opacity:{value:1}}]),vertexShader:cn.meshnormal_vert,fragmentShader:cn.meshnormal_frag},sprite:{uniforms:vs([Nt.sprite,Nt.fog]),vertexShader:cn.sprite_vert,fragmentShader:cn.sprite_frag},background:{uniforms:{uvTransform:{value:new yn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:cn.background_vert,fragmentShader:cn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:cn.backgroundCube_vert,fragmentShader:cn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:cn.cube_vert,fragmentShader:cn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:cn.equirect_vert,fragmentShader:cn.equirect_frag},distanceRGBA:{uniforms:vs([Nt.common,Nt.displacementmap,{referencePosition:{value:new Ce},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:cn.distanceRGBA_vert,fragmentShader:cn.distanceRGBA_frag},shadow:{uniforms:vs([Nt.lights,Nt.fog,{color:{value:new kt(0)},opacity:{value:1}}]),vertexShader:cn.shadow_vert,fragmentShader:cn.shadow_frag}};ya.physical={uniforms:vs([ya.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new yn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new yn},clearcoatNormalScale:{value:new xt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new yn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new yn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new yn},sheen:{value:0},sheenColor:{value:new kt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new yn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new yn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new yn},transmissionSamplerSize:{value:new xt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new yn},attenuationDistance:{value:0},attenuationColor:{value:new kt(0)},specularColor:{value:new kt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new yn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new yn},anisotropyVector:{value:new xt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new yn}}]),vertexShader:cn.meshphysical_vert,fragmentShader:cn.meshphysical_frag};const o_={r:0,b:0,g:0};function yq(i,e,t,n,r,s,o){const a=new kt(0);let l=s===!0?0:1,c,u,h=null,d=0,f=null;function m(v,g){let b=!1,p=g.isScene===!0?g.background:null;p&&p.isTexture&&(p=(g.backgroundBlurriness>0?t:e).get(p)),p===null?_(a,l):p&&p.isColor&&(_(p,1),b=!0);const y=i.xr.getEnvironmentBlendMode();y==="additive"?n.buffers.color.setClear(0,0,0,1,o):y==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||b)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),p&&(p.isCubeTexture||p.mapping===Zp)?(u===void 0&&(u=new gi(new f1(1,1,1),new dl({name:"BackgroundCubeMaterial",uniforms:Np(ya.backgroundCube.uniforms),vertexShader:ya.backgroundCube.vertexShader,fragmentShader:ya.backgroundCube.fragmentShader,side:Ms,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(A,w,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=p,u.material.uniforms.flipEnvMap.value=p.isCubeTexture&&p.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=On.getTransfer(p.colorSpace)!==Qn,(h!==p||d!==p.version||f!==i.toneMapping)&&(u.material.needsUpdate=!0,h=p,d=p.version,f=i.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):p&&p.isTexture&&(c===void 0&&(c=new gi(new gd(2,2),new dl({name:"BackgroundMaterial",uniforms:Np(ya.background.uniforms),vertexShader:ya.background.vertexShader,fragmentShader:ya.background.fragmentShader,side:ac,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=p,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=On.getTransfer(p.colorSpace)!==Qn,p.matrixAutoUpdate===!0&&p.updateMatrix(),c.material.uniforms.uvTransform.value.copy(p.matrix),(h!==p||d!==p.version||f!==i.toneMapping)&&(c.material.needsUpdate=!0,h=p,d=p.version,f=i.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}function _(v,g){v.getRGB(o_,Gz(i)),n.buffers.color.setClear(o_.r,o_.g,o_.b,g,o)}return{getClearColor:function(){return a},setClearColor:function(v,g=1){a.set(v),l=g,_(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,_(a,l)},render:m}}function xq(i,e,t,n){const r=i.getParameter(i.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=v(null);let c=l,u=!1;function h(R,F,V,z,U){let G=!1;if(o){const B=_(z,V,F);c!==B&&(c=B,f(c.object)),G=g(R,z,V,U),G&&b(R,z,V,U)}else{const B=F.wireframe===!0;(c.geometry!==z.id||c.program!==V.id||c.wireframe!==B)&&(c.geometry=z.id,c.program=V.id,c.wireframe=B,G=!0)}U!==null&&t.update(U,i.ELEMENT_ARRAY_BUFFER),(G||u)&&(u=!1,T(R,F,V,z),U!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.get(U).buffer))}function d(){return n.isWebGL2?i.createVertexArray():s.createVertexArrayOES()}function f(R){return n.isWebGL2?i.bindVertexArray(R):s.bindVertexArrayOES(R)}function m(R){return n.isWebGL2?i.deleteVertexArray(R):s.deleteVertexArrayOES(R)}function _(R,F,V){const z=V.wireframe===!0;let U=a[R.id];U===void 0&&(U={},a[R.id]=U);let G=U[F.id];G===void 0&&(G={},U[F.id]=G);let B=G[z];return B===void 0&&(B=v(d()),G[z]=B),B}function v(R){const F=[],V=[],z=[];for(let U=0;U<r;U++)F[U]=0,V[U]=0,z[U]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:V,attributeDivisors:z,object:R,attributes:{},index:null}}function g(R,F,V,z){const U=c.attributes,G=F.attributes;let B=0;const D=V.getAttributes();for(const O in D)if(D[O].location>=0){const q=U[O];let Y=G[O];if(Y===void 0&&(O==="instanceMatrix"&&R.instanceMatrix&&(Y=R.instanceMatrix),O==="instanceColor"&&R.instanceColor&&(Y=R.instanceColor)),q===void 0||q.attribute!==Y||Y&&q.data!==Y.data)return!0;B++}return c.attributesNum!==B||c.index!==z}function b(R,F,V,z){const U={},G=F.attributes;let B=0;const D=V.getAttributes();for(const O in D)if(D[O].location>=0){let q=G[O];q===void 0&&(O==="instanceMatrix"&&R.instanceMatrix&&(q=R.instanceMatrix),O==="instanceColor"&&R.instanceColor&&(q=R.instanceColor));const Y={};Y.attribute=q,q&&q.data&&(Y.data=q.data),U[O]=Y,B++}c.attributes=U,c.attributesNum=B,c.index=z}function p(){const R=c.newAttributes;for(let F=0,V=R.length;F<V;F++)R[F]=0}function y(R){A(R,0)}function A(R,F){const V=c.newAttributes,z=c.enabledAttributes,U=c.attributeDivisors;V[R]=1,z[R]===0&&(i.enableVertexAttribArray(R),z[R]=1),U[R]!==F&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,F),U[R]=F)}function w(){const R=c.newAttributes,F=c.enabledAttributes;for(let V=0,z=F.length;V<z;V++)F[V]!==R[V]&&(i.disableVertexAttribArray(V),F[V]=0)}function M(R,F,V,z,U,G,B){B===!0?i.vertexAttribIPointer(R,F,V,U,G):i.vertexAttribPointer(R,F,V,z,U,G)}function T(R,F,V,z){if(n.isWebGL2===!1&&(R.isInstancedMesh||z.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;p();const U=z.attributes,G=V.getAttributes(),B=F.defaultAttributeValues;for(const D in G){const O=G[D];if(O.location>=0){let j=U[D];if(j===void 0&&(D==="instanceMatrix"&&R.instanceMatrix&&(j=R.instanceMatrix),D==="instanceColor"&&R.instanceColor&&(j=R.instanceColor)),j!==void 0){const q=j.normalized,Y=j.itemSize,ie=t.get(j);if(ie===void 0)continue;const ne=ie.buffer,Q=ie.type,le=ie.bytesPerElement,se=n.isWebGL2===!0&&(Q===i.INT||Q===i.UNSIGNED_INT||j.gpuType===RP);if(j.isInterleavedBufferAttribute){const oe=j.data,$=oe.stride,pe=j.offset;if(oe.isInstancedInterleavedBuffer){for(let xe=0;xe<O.locationSize;xe++)A(O.location+xe,oe.meshPerAttribute);R.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let xe=0;xe<O.locationSize;xe++)y(O.location+xe);i.bindBuffer(i.ARRAY_BUFFER,ne);for(let xe=0;xe<O.locationSize;xe++)M(O.location+xe,Y/O.locationSize,Q,q,$*le,(pe+Y/O.locationSize*xe)*le,se)}else{if(j.isInstancedBufferAttribute){for(let oe=0;oe<O.locationSize;oe++)A(O.location+oe,j.meshPerAttribute);R.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=j.meshPerAttribute*j.count)}else for(let oe=0;oe<O.locationSize;oe++)y(O.location+oe);i.bindBuffer(i.ARRAY_BUFFER,ne);for(let oe=0;oe<O.locationSize;oe++)M(O.location+oe,Y/O.locationSize,Q,q,Y*le,Y/O.locationSize*oe*le,se)}}else if(B!==void 0){const q=B[D];if(q!==void 0)switch(q.length){case 2:i.vertexAttrib2fv(O.location,q);break;case 3:i.vertexAttrib3fv(O.location,q);break;case 4:i.vertexAttrib4fv(O.location,q);break;default:i.vertexAttrib1fv(O.location,q)}}}}w()}function E(){P();for(const R in a){const F=a[R];for(const V in F){const z=F[V];for(const U in z)m(z[U].object),delete z[U];delete F[V]}delete a[R]}}function C(R){if(a[R.id]===void 0)return;const F=a[R.id];for(const V in F){const z=F[V];for(const U in z)m(z[U].object),delete z[U];delete F[V]}delete a[R.id]}function N(R){for(const F in a){const V=a[F];if(V[R.id]===void 0)continue;const z=V[R.id];for(const U in z)m(z[U].object),delete z[U];delete V[R.id]}}function P(){L(),u=!0,c!==l&&(c=l,f(c.object))}function L(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:P,resetDefaultState:L,dispose:E,releaseStatesOfGeometry:C,releaseStatesOfProgram:N,initAttributes:p,enableAttribute:y,disableUnusedAttributes:w}}function bq(i,e,t,n){const r=n.isWebGL2;let s;function o(u){s=u}function a(u,h){i.drawArrays(s,u,h),t.update(h,s,1)}function l(u,h,d){if(d===0)return;let f,m;if(r)f=i,m="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[m](s,u,h,d),t.update(h,s,d)}function c(u,h,d){if(d===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<d;m++)this.render(u[m],h[m]);else{f.multiDrawArraysWEBGL(s,u,0,h,0,d);let m=0;for(let _=0;_<d;_++)m+=h[_];t.update(m,s,1)}}this.setMode=o,this.render=a,this.renderInstances=l,this.renderMultiDraw=c}function Sq(i,e,t){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(M){if(M==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&i.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),d=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=i.getParameter(i.MAX_TEXTURE_SIZE),m=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),_=i.getParameter(i.MAX_VERTEX_ATTRIBS),v=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),g=i.getParameter(i.MAX_VARYING_VECTORS),b=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),p=d>0,y=o||e.has("OES_texture_float"),A=p&&y,w=o?i.getParameter(i.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:m,maxAttributes:_,maxVertexUniforms:v,maxVaryings:g,maxFragmentUniforms:b,vertexTextures:p,floatFragmentTextures:y,floatVertexTextures:A,maxSamples:w}}function wq(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new qc,a=new yn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||n!==0||r;return r=d,n=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=u(h,d,0)},this.setState=function(h,d,f){const m=h.clippingPlanes,_=h.clipIntersection,v=h.clipShadows,g=i.get(h);if(!r||m===null||m.length===0||s&&!v)s?u(null):c();else{const b=s?0:n,p=b*4;let y=g.clippingState||null;l.value=y,y=u(m,d,p,f);for(let A=0;A!==p;++A)y[A]=t[A];g.clippingState=y,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,d,f,m){const _=h!==null?h.length:0;let v=null;if(_!==0){if(v=l.value,m!==!0||v===null){const g=f+_*4,b=d.matrixWorldInverse;a.getNormalMatrix(b),(v===null||v.length<g)&&(v=new Float32Array(g));for(let p=0,y=f;p!==_;++p,y+=4)o.copy(h[p]).applyMatrix4(b,a),o.normal.toArray(v,y),v[y+3]=o.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,v}}function Mq(i){let e=new WeakMap;function t(o,a){return a===T0?o.mapping=lc:a===C0&&(o.mapping=wu),o}function n(o){if(o&&o.isTexture){const a=o.mapping;if(a===T0||a===C0)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new Hz(l.height/2);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}let vd=class extends p1{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};const ep=4,aD=[.125,.215,.35,.446,.526,.582],Ah=20,Mw=new vd,lD=new kt;let Aw=null,Ew=0,Tw=0;const xh=(1+Math.sqrt(5))/2,Jd=1/xh,cD=[new Ce(1,1,1),new Ce(-1,1,1),new Ce(1,1,-1),new Ce(-1,1,-1),new Ce(0,xh,Jd),new Ce(0,xh,-Jd),new Ce(Jd,0,xh),new Ce(-Jd,0,xh),new Ce(xh,Jd,0),new Ce(-xh,Jd,0)];let wT=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){Aw=this._renderer.getRenderTarget(),Ew=this._renderer.getActiveCubeFace(),Tw=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=dD(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=hD(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Aw,Ew,Tw),e.scissorTest=!1,a_(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===lc||e.mapping===wu?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Aw=this._renderer.getRenderTarget(),Ew=this._renderer.getActiveCubeFace(),Tw=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Mi,minFilter:Mi,generateMipmaps:!1,type:Ip,format:Ss,colorSpace:hl,depthBuffer:!1},r=uD(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=uD(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Aq(s)),this._blurMaterial=Eq(s,e,t)}return r}_compileMaterial(e){const t=new gi(this._lodPlanes[0],e);this._renderer.compile(t,Mw)}_sceneToCubeUV(e,t,n,r){const a=new Ji(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(lD),u.toneMapping=il,u.autoClear=!1;const f=new qo({name:"PMREM.Background",side:Ms,depthWrite:!1,depthTest:!1}),m=new gi(new f1,f);let _=!1;const v=e.background;v?v.isColor&&(f.color.copy(v),e.background=null,_=!0):(f.color.copy(lD),_=!0);for(let g=0;g<6;g++){const b=g%3;b===0?(a.up.set(0,l[g],0),a.lookAt(c[g],0,0)):b===1?(a.up.set(0,0,l[g]),a.lookAt(0,c[g],0)):(a.up.set(0,l[g],0),a.lookAt(0,0,c[g]));const p=this._cubeSize;a_(r,b*p,g>2?p:0,p,p),u.setRenderTarget(r),_&&u.render(m,a),u.render(e,a)}m.geometry.dispose(),m.material.dispose(),u.toneMapping=d,u.autoClear=h,e.background=v}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===lc||e.mapping===wu;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=dD()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=hD());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new gi(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;a_(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,Mw)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=cD[(r-1)%cD.length];this._blur(e,r-1,r,s,o)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new gi(this._lodPlanes[r],c),d=c.uniforms,f=this._sizeLods[n]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*Ah-1),_=s/m,v=isFinite(s)?1+Math.floor(u*_):Ah;v>Ah&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Ah}`);const g=[];let b=0;for(let M=0;M<Ah;++M){const T=M/_,E=Math.exp(-T*T/2);g.push(E),M===0?b+=E:M<v&&(b+=2*E)}for(let M=0;M<g.length;M++)g[M]=g[M]/b;d.envMap.value=e.texture,d.samples.value=v,d.weights.value=g,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:p}=this;d.dTheta.value=m,d.mipInt.value=p-n;const y=this._sizeLods[r],A=3*y*(r>p-ep?r-p+ep:0),w=4*(this._cubeSize-y);a_(t,A,w,3*y,2*y),l.setRenderTarget(t),l.render(h,Mw)}};function Aq(i){const e=[],t=[],n=[];let r=i;const s=i-ep+1+aD.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>i-ep?l=aD[o-i+ep-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,m=6,_=3,v=2,g=1,b=new Float32Array(_*m*f),p=new Float32Array(v*m*f),y=new Float32Array(g*m*f);for(let w=0;w<f;w++){const M=w%3*2/3-1,T=w>2?0:-1,E=[M,T,0,M+2/3,T,0,M+2/3,T+1,0,M,T,0,M+2/3,T+1,0,M,T+1,0];b.set(E,_*m*w),p.set(d,v*m*w);const C=[w,w,w,w,w,w];y.set(C,g*m*w)}const A=new xn;A.setAttribute("position",new En(b,_)),A.setAttribute("uv",new En(p,v)),A.setAttribute("faceIndex",new En(y,g)),e.push(A),r>ep&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function uD(i,e,t){const n=new Na(i,e,t);return n.texture.mapping=Zp,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function a_(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function Eq(i,e,t){const n=new Float32Array(Ah),r=new Ce(0,1,0);return new dl({name:"SphericalGaussianBlur",defines:{n:Ah,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:XP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ec,depthTest:!1,depthWrite:!1})}function hD(){return new dl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:XP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ec,depthTest:!1,depthWrite:!1})}function dD(){return new dl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:XP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ec,depthTest:!1,depthWrite:!1})}function XP(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Tq(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===T0||l===C0,u=l===lc||l===wu;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new wT(i)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{const h=a.image;if(c&&h&&h.height>0||u&&h&&r(h)){t===null&&(t=new wT(i));const d=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",s),d.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function Cq(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const r=t(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function Pq(i,e,t,n){const r={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const m in d.attributes)e.remove(d.attributes[m]);for(const m in d.morphAttributes){const _=d.morphAttributes[m];for(let v=0,g=_.length;v<g;v++)e.remove(_[v])}d.removeEventListener("dispose",o),delete r[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const m in d)e.update(d[m],i.ARRAY_BUFFER);const f=h.morphAttributes;for(const m in f){const _=f[m];for(let v=0,g=_.length;v<g;v++)e.update(_[v],i.ARRAY_BUFFER)}}function c(h){const d=[],f=h.index,m=h.attributes.position;let _=0;if(f!==null){const b=f.array;_=f.version;for(let p=0,y=b.length;p<y;p+=3){const A=b[p+0],w=b[p+1],M=b[p+2];d.push(A,w,w,M,M,A)}}else if(m!==void 0){const b=m.array;_=m.version;for(let p=0,y=b.length/3-1;p<y;p+=3){const A=p+0,w=p+1,M=p+2;d.push(A,w,w,M,M,A)}}else return;const v=new(Lz(d)?WP:$P)(d,1);v.version=_;const g=s.get(h);g&&e.remove(g),s.set(h,v)}function u(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function Rq(i,e,t,n){const r=n.isWebGL2;let s;function o(f){s=f}let a,l;function c(f){a=f.type,l=f.bytesPerElement}function u(f,m){i.drawElements(s,m,a,f*l),t.update(m,s,1)}function h(f,m,_){if(_===0)return;let v,g;if(r)v=i,g="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[g](s,m,a,f*l,_),t.update(m,s,_)}function d(f,m,_){if(_===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let g=0;g<_;g++)this.render(f[g]/l,m[g]);else{v.multiDrawElementsWEBGL(s,m,0,a,f,0,_);let g=0;for(let b=0;b<_;b++)g+=m[b];t.update(g,s,1)}}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h,this.renderMultiDraw=d}function Iq(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=a*(s/3);break;case i.LINES:t.lines+=a*(s/2);break;case i.LINE_STRIP:t.lines+=a*(s-1);break;case i.LINE_LOOP:t.lines+=a*s;break;case i.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function Lq(i,e){return i[0]-e[0]}function Dq(i,e){return Math.abs(e[1])-Math.abs(i[1])}function Nq(i,e,t){const n={},r=new Float32Array(8),s=new WeakMap,o=new Gn,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,h){const d=c.morphTargetInfluences;if(e.isWebGL2===!0){const m=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,_=m!==void 0?m.length:0;let v=s.get(u);if(v===void 0||v.count!==_){let F=function(){L.dispose(),s.delete(u),u.removeEventListener("dispose",F)};var f=F;v!==void 0&&v.texture.dispose();const p=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,A=u.morphAttributes.color!==void 0,w=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],T=u.morphAttributes.color||[];let E=0;p===!0&&(E=1),y===!0&&(E=2),A===!0&&(E=3);let C=u.attributes.position.count*E,N=1;C>e.maxTextureSize&&(N=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const P=new Float32Array(C*N*4*_),L=new Zb(P,C,N,_);L.type=Ea,L.needsUpdate=!0;const R=E*4;for(let V=0;V<_;V++){const z=w[V],U=M[V],G=T[V],B=C*N*4*V;for(let D=0;D<z.count;D++){const O=D*R;p===!0&&(o.fromBufferAttribute(z,D),P[B+O+0]=o.x,P[B+O+1]=o.y,P[B+O+2]=o.z,P[B+O+3]=0),y===!0&&(o.fromBufferAttribute(U,D),P[B+O+4]=o.x,P[B+O+5]=o.y,P[B+O+6]=o.z,P[B+O+7]=0),A===!0&&(o.fromBufferAttribute(G,D),P[B+O+8]=o.x,P[B+O+9]=o.y,P[B+O+10]=o.z,P[B+O+11]=G.itemSize===4?o.w:1)}}v={count:_,texture:L,size:new xt(C,N)},s.set(u,v),u.addEventListener("dispose",F)}let g=0;for(let p=0;p<d.length;p++)g+=d[p];const b=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(i,"morphTargetBaseInfluence",b),h.getUniforms().setValue(i,"morphTargetInfluences",d),h.getUniforms().setValue(i,"morphTargetsTexture",v.texture,t),h.getUniforms().setValue(i,"morphTargetsTextureSize",v.size)}else{const m=d===void 0?0:d.length;let _=n[u.id];if(_===void 0||_.length!==m){_=[];for(let y=0;y<m;y++)_[y]=[y,0];n[u.id]=_}for(let y=0;y<m;y++){const A=_[y];A[0]=y,A[1]=d[y]}_.sort(Dq);for(let y=0;y<8;y++)y<m&&_[y][1]?(a[y][0]=_[y][0],a[y][1]=_[y][1]):(a[y][0]=Number.MAX_SAFE_INTEGER,a[y][1]=0);a.sort(Lq);const v=u.morphAttributes.position,g=u.morphAttributes.normal;let b=0;for(let y=0;y<8;y++){const A=a[y],w=A[0],M=A[1];w!==Number.MAX_SAFE_INTEGER&&M?(v&&u.getAttribute("morphTarget"+y)!==v[w]&&u.setAttribute("morphTarget"+y,v[w]),g&&u.getAttribute("morphNormal"+y)!==g[w]&&u.setAttribute("morphNormal"+y,g[w]),r[y]=M,b+=M):(v&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),g&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),r[y]=0)}const p=u.morphTargetsRelative?1:1-b;h.getUniforms().setValue(i,"morphTargetBaseInfluence",p),h.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function Fq(i,e,t,n){let r=new WeakMap;function s(l){const c=n.render.frame,u=l.geometry,h=e.get(l,u);if(r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==c&&(d.update(),r.set(d,c))}return h}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}let qP=class extends Tr{constructor(e,t,n,r,s,o,a,l,c,u){if(u=u!==void 0?u:pu,u!==pu&&u!==rd)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===pu&&(n=Yl),n===void 0&&u===rd&&(n=fu),super(null,r,s,o,a,l,u,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Gi,this.minFilter=l!==void 0?l:Gi,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}};const jz=new Tr,Xz=new qP(1,1);Xz.compareFunction=zP;const qz=new Zb,Yz=new HP,Kz=new m1,fD=[],pD=[],mD=new Float32Array(16),gD=new Float32Array(9),vD=new Float32Array(4);function Jp(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=fD[r];if(s===void 0&&(s=new Float32Array(r),fD[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(s,a)}return s}function ur(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function hr(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function Qb(i,e){let t=pD[e];t===void 0&&(t=new Int32Array(e),pD[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function kq(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function Uq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ur(t,e))return;i.uniform2fv(this.addr,e),hr(t,e)}}function Oq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ur(t,e))return;i.uniform3fv(this.addr,e),hr(t,e)}}function Bq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ur(t,e))return;i.uniform4fv(this.addr,e),hr(t,e)}}function zq(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(ur(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),hr(t,e)}else{if(ur(t,n))return;vD.set(n),i.uniformMatrix2fv(this.addr,!1,vD),hr(t,n)}}function Gq(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(ur(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),hr(t,e)}else{if(ur(t,n))return;gD.set(n),i.uniformMatrix3fv(this.addr,!1,gD),hr(t,n)}}function Vq(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(ur(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),hr(t,e)}else{if(ur(t,n))return;mD.set(n),i.uniformMatrix4fv(this.addr,!1,mD),hr(t,n)}}function Hq(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function $q(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ur(t,e))return;i.uniform2iv(this.addr,e),hr(t,e)}}function Wq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ur(t,e))return;i.uniform3iv(this.addr,e),hr(t,e)}}function jq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ur(t,e))return;i.uniform4iv(this.addr,e),hr(t,e)}}function Xq(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function qq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ur(t,e))return;i.uniform2uiv(this.addr,e),hr(t,e)}}function Yq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ur(t,e))return;i.uniform3uiv(this.addr,e),hr(t,e)}}function Kq(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ur(t,e))return;i.uniform4uiv(this.addr,e),hr(t,e)}}function Zq(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r);const s=this.type===i.SAMPLER_2D_SHADOW?Xz:jz;t.setTexture2D(e||s,r)}function Qq(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||Yz,r)}function Jq(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||Kz,r)}function eY(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||qz,r)}function tY(i){switch(i){case 5126:return kq;case 35664:return Uq;case 35665:return Oq;case 35666:return Bq;case 35674:return zq;case 35675:return Gq;case 35676:return Vq;case 5124:case 35670:return Hq;case 35667:case 35671:return $q;case 35668:case 35672:return Wq;case 35669:case 35673:return jq;case 5125:return Xq;case 36294:return qq;case 36295:return Yq;case 36296:return Kq;case 35678:case 36198:case 36298:case 36306:case 35682:return Zq;case 35679:case 36299:case 36307:return Qq;case 35680:case 36300:case 36308:case 36293:return Jq;case 36289:case 36303:case 36311:case 36292:return eY}}function nY(i,e){i.uniform1fv(this.addr,e)}function iY(i,e){const t=Jp(e,this.size,2);i.uniform2fv(this.addr,t)}function rY(i,e){const t=Jp(e,this.size,3);i.uniform3fv(this.addr,t)}function sY(i,e){const t=Jp(e,this.size,4);i.uniform4fv(this.addr,t)}function oY(i,e){const t=Jp(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function aY(i,e){const t=Jp(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function lY(i,e){const t=Jp(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function cY(i,e){i.uniform1iv(this.addr,e)}function uY(i,e){i.uniform2iv(this.addr,e)}function hY(i,e){i.uniform3iv(this.addr,e)}function dY(i,e){i.uniform4iv(this.addr,e)}function fY(i,e){i.uniform1uiv(this.addr,e)}function pY(i,e){i.uniform2uiv(this.addr,e)}function mY(i,e){i.uniform3uiv(this.addr,e)}function gY(i,e){i.uniform4uiv(this.addr,e)}function vY(i,e,t){const n=this.cache,r=e.length,s=Qb(t,r);ur(n,s)||(i.uniform1iv(this.addr,s),hr(n,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||jz,s[o])}function _Y(i,e,t){const n=this.cache,r=e.length,s=Qb(t,r);ur(n,s)||(i.uniform1iv(this.addr,s),hr(n,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||Yz,s[o])}function yY(i,e,t){const n=this.cache,r=e.length,s=Qb(t,r);ur(n,s)||(i.uniform1iv(this.addr,s),hr(n,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||Kz,s[o])}function xY(i,e,t){const n=this.cache,r=e.length,s=Qb(t,r);ur(n,s)||(i.uniform1iv(this.addr,s),hr(n,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||qz,s[o])}function bY(i){switch(i){case 5126:return nY;case 35664:return iY;case 35665:return rY;case 35666:return sY;case 35674:return oY;case 35675:return aY;case 35676:return lY;case 5124:case 35670:return cY;case 35667:case 35671:return uY;case 35668:case 35672:return hY;case 35669:case 35673:return dY;case 5125:return fY;case 36294:return pY;case 36295:return mY;case 36296:return gY;case 35678:case 36198:case 36298:case 36306:case 35682:return vY;case 35679:case 36299:case 36307:return _Y;case 35680:case 36300:case 36308:case 36293:return yY;case 36289:case 36303:case 36311:case 36292:return xY}}let SY=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=tY(t.type)}},wY=class{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=bY(t.type)}},MY=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],n)}}};const Cw=/(\w+)(\])?(\[|\.)?/g;function _D(i,e){i.seq.push(e),i.map[e.id]=e}function AY(i,e,t){const n=i.name,r=n.length;for(Cw.lastIndex=0;;){const s=Cw.exec(n),o=Cw.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){_D(t,c===void 0?new SY(a,i,e):new wY(a,i,e));break}else{let h=t.map[a];h===void 0&&(h=new MY(a),_D(t,h)),t=h}}}let sx=class{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);AY(s,o,this)}}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&n.push(o)}return n}};function yD(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const EY=37297;let TY=0;function CY(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}function PY(i){const e=On.getPrimaries(On.workingColorSpace),t=On.getPrimaries(i);let n;switch(e===t?n="":e===k0&&t===F0?n="LinearDisplayP3ToLinearSRGB":e===F0&&t===k0&&(n="LinearSRGBToLinearDisplayP3"),i){case hl:case h1:return[n,"LinearTransferOETF"];case lr:case Kb:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",i),[n,"LinearTransferOETF"]}}function xD(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+CY(i.getShaderSource(e),o)}else return r}function RY(i,e){const t=PY(e);return`vec4 ${i}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function IY(i,e){let t;switch(e){case rz:t="Linear";break;case sz:t="Reinhard";break;case oz:t="OptimizedCineon";break;case CP:t="ACESFilmic";break;case lz:t="AgX";break;case az:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function LY(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(tp).join(`
`)}function DY(i){return[i.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(tp).join(`
`)}function NY(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function FY(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let a=1;s.type===i.FLOAT_MAT2&&(a=2),s.type===i.FLOAT_MAT3&&(a=3),s.type===i.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function tp(i){return i!==""}function bD(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function SD(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const kY=/^[ \t]*#include +<([\w\d./]+)>/gm;function MT(i){return i.replace(kY,OY)}const UY=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function OY(i,e){let t=cn[e];if(t===void 0){const n=UY.get(e);if(n!==void 0)t=cn[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return MT(t)}const BY=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function wD(i){return i.replace(BY,zY)}function zY(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function MD(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function GY(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===jb?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===jg?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===ma&&(e="SHADOWMAP_TYPE_VSM"),e}function VY(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case lc:case wu:e="ENVMAP_TYPE_CUBE";break;case Zp:e="ENVMAP_TYPE_CUBE_UV";break}return e}function HY(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case wu:e="ENVMAP_MODE_REFRACTION";break}return e}function $Y(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case u1:e="ENVMAP_BLENDING_MULTIPLY";break;case nz:e="ENVMAP_BLENDING_MIX";break;case iz:e="ENVMAP_BLENDING_ADD";break}return e}function WY(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function jY(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=GY(t),c=VY(t),u=HY(t),h=$Y(t),d=WY(t),f=t.isWebGL2?"":LY(t),m=DY(t),_=NY(s),v=r.createProgram();let g,b,p=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(tp).join(`
`),g.length>0&&(g+=`
`),b=[f,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_].filter(tp).join(`
`),b.length>0&&(b+=`
`)):(g=[MD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(tp).join(`
`),b=[f,MD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,_,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==il?"#define TONE_MAPPING":"",t.toneMapping!==il?cn.tonemapping_pars_fragment:"",t.toneMapping!==il?IY("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",cn.colorspace_pars_fragment,RY("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(tp).join(`
`)),o=MT(o),o=bD(o,t),o=SD(o,t),a=MT(a),a=bD(a,t),a=SD(a,t),o=wD(o),a=wD(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(p=`#version 300 es
`,g=[m,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,b=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===xT?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===xT?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+b);const y=p+g+o,A=p+b+a,w=yD(r,r.VERTEX_SHADER,y),M=yD(r,r.FRAGMENT_SHADER,A);r.attachShader(v,w),r.attachShader(v,M),t.index0AttributeName!==void 0?r.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(v,0,"position"),r.linkProgram(v);function T(P){if(i.debug.checkShaderErrors){const L=r.getProgramInfoLog(v).trim(),R=r.getShaderInfoLog(w).trim(),F=r.getShaderInfoLog(M).trim();let V=!0,z=!0;if(r.getProgramParameter(v,r.LINK_STATUS)===!1)if(V=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,v,w,M);else{const U=xD(r,w,"vertex"),G=xD(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(v,r.VALIDATE_STATUS)+`

Program Info Log: `+L+`
`+U+`
`+G)}else L!==""?console.warn("THREE.WebGLProgram: Program Info Log:",L):(R===""||F==="")&&(z=!1);z&&(P.diagnostics={runnable:V,programLog:L,vertexShader:{log:R,prefix:g},fragmentShader:{log:F,prefix:b}})}r.deleteShader(w),r.deleteShader(M),E=new sx(r,v),C=FY(r,v)}let E;this.getUniforms=function(){return E===void 0&&T(this),E};let C;this.getAttributes=function(){return C===void 0&&T(this),C};let N=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return N===!1&&(N=r.getProgramParameter(v,EY)),N},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(v),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=TY++,this.cacheKey=e,this.usedTimes=1,this.program=v,this.vertexShader=w,this.fragmentShader=M,this}let XY=0,qY=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new YY(e),t.set(e,n)),n}},YY=class{constructor(e){this.id=XY++,this.code=e,this.usedTimes=0}};function KY(i,e,t,n,r,s,o){const a=new Vh,l=new qY,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(E){return E===0?"uv":`uv${E}`}function v(E,C,N,P,L){const R=P.fog,F=L.geometry,V=E.isMeshStandardMaterial?P.environment:null,z=(E.isMeshStandardMaterial?t:e).get(E.envMap||V),U=z&&z.mapping===Zp?z.image.height:null,G=m[E.type];E.precision!==null&&(f=r.getMaxPrecision(E.precision),f!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",f,"instead."));const B=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,D=B!==void 0?B.length:0;let O=0;F.morphAttributes.position!==void 0&&(O=1),F.morphAttributes.normal!==void 0&&(O=2),F.morphAttributes.color!==void 0&&(O=3);let j,q,Y,ie;if(G){const K=ya[G];j=K.vertexShader,q=K.fragmentShader}else j=E.vertexShader,q=E.fragmentShader,l.update(E),Y=l.getVertexShaderID(E),ie=l.getFragmentShaderID(E);const ne=i.getRenderTarget(),Q=L.isInstancedMesh===!0,le=L.isBatchedMesh===!0,se=!!E.map,oe=!!E.matcap,$=!!z,pe=!!E.aoMap,xe=!!E.lightMap,Pe=!!E.bumpMap,ve=!!E.normalMap,Ue=!!E.displacementMap,Le=!!E.emissiveMap,Z=!!E.metalnessMap,J=!!E.roughnessMap,de=E.anisotropy>0,Ie=E.clearcoat>0,te=E.iridescence>0,X=E.sheen>0,ye=E.transmission>0,ke=de&&!!E.anisotropyMap,ge=Ie&&!!E.clearcoatMap,De=Ie&&!!E.clearcoatNormalMap,$e=Ie&&!!E.clearcoatRoughnessMap,Ae=te&&!!E.iridescenceMap,Ze=te&&!!E.iridescenceThicknessMap,nt=X&&!!E.sheenColorMap,rt=X&&!!E.sheenRoughnessMap,Oe=!!E.specularMap,qe=!!E.specularColorMap,it=!!E.specularIntensityMap,at=ye&&!!E.transmissionMap,ht=ye&&!!E.thicknessMap,Qe=!!E.gradientMap,je=!!E.alphaMap,ee=E.alphaTest>0,ze=!!E.alphaHash,Ee=!!E.extensions,Re=!!F.attributes.uv1,Xe=!!F.attributes.uv2,gt=!!F.attributes.uv3;let _t=il;return E.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(_t=i.toneMapping),{isWebGL2:u,shaderID:G,shaderType:E.type,shaderName:E.name,vertexShader:j,fragmentShader:q,defines:E.defines,customVertexShaderID:Y,customFragmentShaderID:ie,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:f,batching:le,instancing:Q,instancingColor:Q&&L.instanceColor!==null,supportsVertexTextures:d,outputColorSpace:ne===null?i.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:hl,map:se,matcap:oe,envMap:$,envMapMode:$&&z.mapping,envMapCubeUVHeight:U,aoMap:pe,lightMap:xe,bumpMap:Pe,normalMap:ve,displacementMap:d&&Ue,emissiveMap:Le,normalMapObjectSpace:ve&&E.normalMapType===Sz,normalMapTangentSpace:ve&&E.normalMapType===Lu,metalnessMap:Z,roughnessMap:J,anisotropy:de,anisotropyMap:ke,clearcoat:Ie,clearcoatMap:ge,clearcoatNormalMap:De,clearcoatRoughnessMap:$e,iridescence:te,iridescenceMap:Ae,iridescenceThicknessMap:Ze,sheen:X,sheenColorMap:nt,sheenRoughnessMap:rt,specularMap:Oe,specularColorMap:qe,specularIntensityMap:it,transmission:ye,transmissionMap:at,thicknessMap:ht,gradientMap:Qe,opaque:E.transparent===!1&&E.blending===zh,alphaMap:je,alphaTest:ee,alphaHash:ze,combine:E.combine,mapUv:se&&_(E.map.channel),aoMapUv:pe&&_(E.aoMap.channel),lightMapUv:xe&&_(E.lightMap.channel),bumpMapUv:Pe&&_(E.bumpMap.channel),normalMapUv:ve&&_(E.normalMap.channel),displacementMapUv:Ue&&_(E.displacementMap.channel),emissiveMapUv:Le&&_(E.emissiveMap.channel),metalnessMapUv:Z&&_(E.metalnessMap.channel),roughnessMapUv:J&&_(E.roughnessMap.channel),anisotropyMapUv:ke&&_(E.anisotropyMap.channel),clearcoatMapUv:ge&&_(E.clearcoatMap.channel),clearcoatNormalMapUv:De&&_(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:$e&&_(E.clearcoatRoughnessMap.channel),iridescenceMapUv:Ae&&_(E.iridescenceMap.channel),iridescenceThicknessMapUv:Ze&&_(E.iridescenceThicknessMap.channel),sheenColorMapUv:nt&&_(E.sheenColorMap.channel),sheenRoughnessMapUv:rt&&_(E.sheenRoughnessMap.channel),specularMapUv:Oe&&_(E.specularMap.channel),specularColorMapUv:qe&&_(E.specularColorMap.channel),specularIntensityMapUv:it&&_(E.specularIntensityMap.channel),transmissionMapUv:at&&_(E.transmissionMap.channel),thicknessMapUv:ht&&_(E.thicknessMap.channel),alphaMapUv:je&&_(E.alphaMap.channel),vertexTangents:!!F.attributes.tangent&&(ve||de),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,vertexUv1s:Re,vertexUv2s:Xe,vertexUv3s:gt,pointsUvs:L.isPoints===!0&&!!F.attributes.uv&&(se||je),fog:!!R,useFog:E.fog===!0,fogExp2:R&&R.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:L.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:D,morphTextureStride:O,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numSpotLightMaps:C.spotLightMap.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numSpotLightShadowsWithMaps:C.numSpotLightShadowsWithMaps,numLightProbes:C.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:E.dithering,shadowMapEnabled:i.shadowMap.enabled&&N.length>0,shadowMapType:i.shadowMap.type,toneMapping:_t,useLegacyLights:i._useLegacyLights,decodeVideoTexture:se&&E.map.isVideoTexture===!0&&On.getTransfer(E.map.colorSpace)===Qn,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===ts,flipSided:E.side===Ms,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:Ee&&E.extensions.derivatives===!0,extensionFragDepth:Ee&&E.extensions.fragDepth===!0,extensionDrawBuffers:Ee&&E.extensions.drawBuffers===!0,extensionShaderTextureLOD:Ee&&E.extensions.shaderTextureLOD===!0,extensionClipCullDistance:Ee&&E.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()}}function g(E){const C=[];if(E.shaderID?C.push(E.shaderID):(C.push(E.customVertexShaderID),C.push(E.customFragmentShaderID)),E.defines!==void 0)for(const N in E.defines)C.push(N),C.push(E.defines[N]);return E.isRawShaderMaterial===!1&&(b(C,E),p(C,E),C.push(i.outputColorSpace)),C.push(E.customProgramCacheKey),C.join()}function b(E,C){E.push(C.precision),E.push(C.outputColorSpace),E.push(C.envMapMode),E.push(C.envMapCubeUVHeight),E.push(C.mapUv),E.push(C.alphaMapUv),E.push(C.lightMapUv),E.push(C.aoMapUv),E.push(C.bumpMapUv),E.push(C.normalMapUv),E.push(C.displacementMapUv),E.push(C.emissiveMapUv),E.push(C.metalnessMapUv),E.push(C.roughnessMapUv),E.push(C.anisotropyMapUv),E.push(C.clearcoatMapUv),E.push(C.clearcoatNormalMapUv),E.push(C.clearcoatRoughnessMapUv),E.push(C.iridescenceMapUv),E.push(C.iridescenceThicknessMapUv),E.push(C.sheenColorMapUv),E.push(C.sheenRoughnessMapUv),E.push(C.specularMapUv),E.push(C.specularColorMapUv),E.push(C.specularIntensityMapUv),E.push(C.transmissionMapUv),E.push(C.thicknessMapUv),E.push(C.combine),E.push(C.fogExp2),E.push(C.sizeAttenuation),E.push(C.morphTargetsCount),E.push(C.morphAttributeCount),E.push(C.numDirLights),E.push(C.numPointLights),E.push(C.numSpotLights),E.push(C.numSpotLightMaps),E.push(C.numHemiLights),E.push(C.numRectAreaLights),E.push(C.numDirLightShadows),E.push(C.numPointLightShadows),E.push(C.numSpotLightShadows),E.push(C.numSpotLightShadowsWithMaps),E.push(C.numLightProbes),E.push(C.shadowMapType),E.push(C.toneMapping),E.push(C.numClippingPlanes),E.push(C.numClipIntersection),E.push(C.depthPacking)}function p(E,C){a.disableAll(),C.isWebGL2&&a.enable(0),C.supportsVertexTextures&&a.enable(1),C.instancing&&a.enable(2),C.instancingColor&&a.enable(3),C.matcap&&a.enable(4),C.envMap&&a.enable(5),C.normalMapObjectSpace&&a.enable(6),C.normalMapTangentSpace&&a.enable(7),C.clearcoat&&a.enable(8),C.iridescence&&a.enable(9),C.alphaTest&&a.enable(10),C.vertexColors&&a.enable(11),C.vertexAlphas&&a.enable(12),C.vertexUv1s&&a.enable(13),C.vertexUv2s&&a.enable(14),C.vertexUv3s&&a.enable(15),C.vertexTangents&&a.enable(16),C.anisotropy&&a.enable(17),C.alphaHash&&a.enable(18),C.batching&&a.enable(19),E.push(a.mask),a.disableAll(),C.fog&&a.enable(0),C.useFog&&a.enable(1),C.flatShading&&a.enable(2),C.logarithmicDepthBuffer&&a.enable(3),C.skinning&&a.enable(4),C.morphTargets&&a.enable(5),C.morphNormals&&a.enable(6),C.morphColors&&a.enable(7),C.premultipliedAlpha&&a.enable(8),C.shadowMapEnabled&&a.enable(9),C.useLegacyLights&&a.enable(10),C.doubleSided&&a.enable(11),C.flipSided&&a.enable(12),C.useDepthPacking&&a.enable(13),C.dithering&&a.enable(14),C.transmission&&a.enable(15),C.sheen&&a.enable(16),C.opaque&&a.enable(17),C.pointsUvs&&a.enable(18),C.decodeVideoTexture&&a.enable(19),E.push(a.mask)}function y(E){const C=m[E.type];let N;if(C){const P=ya[C];N=jP.clone(P.uniforms)}else N=E.uniforms;return N}function A(E,C){let N;for(let P=0,L=c.length;P<L;P++){const R=c[P];if(R.cacheKey===C){N=R,++N.usedTimes;break}}return N===void 0&&(N=new jY(i,C,E,s),c.push(N)),N}function w(E){if(--E.usedTimes===0){const C=c.indexOf(E);c[C]=c[c.length-1],c.pop(),E.destroy()}}function M(E){l.remove(E)}function T(){l.dispose()}return{getParameters:v,getProgramCacheKey:g,getUniforms:y,acquireProgram:A,releaseProgram:w,releaseShaderCache:M,programs:c,dispose:T}}function ZY(){let i=new WeakMap;function e(s){let o=i.get(s);return o===void 0&&(o={},i.set(s,o)),o}function t(s){i.delete(s)}function n(s,o,a){i.get(s)[o]=a}function r(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:r}}function QY(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function AD(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function ED(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(h,d,f,m,_,v){let g=i[e];return g===void 0?(g={id:h.id,object:h,geometry:d,material:f,groupOrder:m,renderOrder:h.renderOrder,z:_,group:v},i[e]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=f,g.groupOrder=m,g.renderOrder=h.renderOrder,g.z=_,g.group=v),e++,g}function a(h,d,f,m,_,v){const g=o(h,d,f,m,_,v);f.transmission>0?n.push(g):f.transparent===!0?r.push(g):t.push(g)}function l(h,d,f,m,_,v){const g=o(h,d,f,m,_,v);f.transmission>0?n.unshift(g):f.transparent===!0?r.unshift(g):t.unshift(g)}function c(h,d){t.length>1&&t.sort(h||QY),n.length>1&&n.sort(d||AD),r.length>1&&r.sort(d||AD)}function u(){for(let h=e,d=i.length;h<d;h++){const f=i[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function JY(){let i=new WeakMap;function e(n,r){const s=i.get(n);let o;return s===void 0?(o=new ED,i.set(n,[o])):r>=s.length?(o=new ED,s.push(o)):o=s[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function eK(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Ce,color:new kt};break;case"SpotLight":t={position:new Ce,direction:new Ce,color:new kt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Ce,color:new kt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Ce,skyColor:new kt,groundColor:new kt};break;case"RectAreaLight":t={color:new kt,position:new Ce,halfWidth:new Ce,halfHeight:new Ce};break}return i[e.id]=t,t}}}function tK(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xt};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xt};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xt,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let nK=0;function iK(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function rK(i,e){const t=new eK,n=tK(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new Ce);const s=new Ce,o=new nn,a=new nn;function l(u,h){let d=0,f=0,m=0;for(let P=0;P<9;P++)r.probe[P].set(0,0,0);let _=0,v=0,g=0,b=0,p=0,y=0,A=0,w=0,M=0,T=0,E=0;u.sort(iK);const C=h===!0?Math.PI:1;for(let P=0,L=u.length;P<L;P++){const R=u[P],F=R.color,V=R.intensity,z=R.distance,U=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)d+=F.r*V*C,f+=F.g*V*C,m+=F.b*V*C;else if(R.isLightProbe){for(let G=0;G<9;G++)r.probe[G].addScaledVector(R.sh.coefficients[G],V);E++}else if(R.isDirectionalLight){const G=t.get(R);if(G.color.copy(R.color).multiplyScalar(R.intensity*C),R.castShadow){const B=R.shadow,D=n.get(R);D.shadowBias=B.bias,D.shadowNormalBias=B.normalBias,D.shadowRadius=B.radius,D.shadowMapSize=B.mapSize,r.directionalShadow[_]=D,r.directionalShadowMap[_]=U,r.directionalShadowMatrix[_]=R.shadow.matrix,y++}r.directional[_]=G,_++}else if(R.isSpotLight){const G=t.get(R);G.position.setFromMatrixPosition(R.matrixWorld),G.color.copy(F).multiplyScalar(V*C),G.distance=z,G.coneCos=Math.cos(R.angle),G.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),G.decay=R.decay,r.spot[g]=G;const B=R.shadow;if(R.map&&(r.spotLightMap[M]=R.map,M++,B.updateMatrices(R),R.castShadow&&T++),r.spotLightMatrix[g]=B.matrix,R.castShadow){const D=n.get(R);D.shadowBias=B.bias,D.shadowNormalBias=B.normalBias,D.shadowRadius=B.radius,D.shadowMapSize=B.mapSize,r.spotShadow[g]=D,r.spotShadowMap[g]=U,w++}g++}else if(R.isRectAreaLight){const G=t.get(R);G.color.copy(F).multiplyScalar(V),G.halfWidth.set(R.width*.5,0,0),G.halfHeight.set(0,R.height*.5,0),r.rectArea[b]=G,b++}else if(R.isPointLight){const G=t.get(R);if(G.color.copy(R.color).multiplyScalar(R.intensity*C),G.distance=R.distance,G.decay=R.decay,R.castShadow){const B=R.shadow,D=n.get(R);D.shadowBias=B.bias,D.shadowNormalBias=B.normalBias,D.shadowRadius=B.radius,D.shadowMapSize=B.mapSize,D.shadowCameraNear=B.camera.near,D.shadowCameraFar=B.camera.far,r.pointShadow[v]=D,r.pointShadowMap[v]=U,r.pointShadowMatrix[v]=R.shadow.matrix,A++}r.point[v]=G,v++}else if(R.isHemisphereLight){const G=t.get(R);G.skyColor.copy(R.color).multiplyScalar(V*C),G.groundColor.copy(R.groundColor).multiplyScalar(V*C),r.hemi[p]=G,p++}}b>0&&(e.isWebGL2?i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Nt.LTC_FLOAT_1,r.rectAreaLTC2=Nt.LTC_FLOAT_2):(r.rectAreaLTC1=Nt.LTC_HALF_1,r.rectAreaLTC2=Nt.LTC_HALF_2):i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Nt.LTC_FLOAT_1,r.rectAreaLTC2=Nt.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=Nt.LTC_HALF_1,r.rectAreaLTC2=Nt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=d,r.ambient[1]=f,r.ambient[2]=m;const N=r.hash;(N.directionalLength!==_||N.pointLength!==v||N.spotLength!==g||N.rectAreaLength!==b||N.hemiLength!==p||N.numDirectionalShadows!==y||N.numPointShadows!==A||N.numSpotShadows!==w||N.numSpotMaps!==M||N.numLightProbes!==E)&&(r.directional.length=_,r.spot.length=g,r.rectArea.length=b,r.point.length=v,r.hemi.length=p,r.directionalShadow.length=y,r.directionalShadowMap.length=y,r.pointShadow.length=A,r.pointShadowMap.length=A,r.spotShadow.length=w,r.spotShadowMap.length=w,r.directionalShadowMatrix.length=y,r.pointShadowMatrix.length=A,r.spotLightMatrix.length=w+M-T,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=T,r.numLightProbes=E,N.directionalLength=_,N.pointLength=v,N.spotLength=g,N.rectAreaLength=b,N.hemiLength=p,N.numDirectionalShadows=y,N.numPointShadows=A,N.numSpotShadows=w,N.numSpotMaps=M,N.numLightProbes=E,r.version=nK++)}function c(u,h){let d=0,f=0,m=0,_=0,v=0;const g=h.matrixWorldInverse;for(let b=0,p=u.length;b<p;b++){const y=u[b];if(y.isDirectionalLight){const A=r.directional[d];A.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(g),d++}else if(y.isSpotLight){const A=r.spot[m];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),A.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(g),m++}else if(y.isRectAreaLight){const A=r.rectArea[_];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),a.identity(),o.copy(y.matrixWorld),o.premultiply(g),a.extractRotation(o),A.halfWidth.set(y.width*.5,0,0),A.halfHeight.set(0,y.height*.5,0),A.halfWidth.applyMatrix4(a),A.halfHeight.applyMatrix4(a),_++}else if(y.isPointLight){const A=r.point[f];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),f++}else if(y.isHemisphereLight){const A=r.hemi[v];A.direction.setFromMatrixPosition(y.matrixWorld),A.direction.transformDirection(g),v++}}}return{setup:l,setupView:c,state:r}}function TD(i,e){const t=new rK(i,e),n=[],r=[];function s(){n.length=0,r.length=0}function o(h){n.push(h)}function a(h){r.push(h)}function l(h){t.setup(n,h)}function c(h){t.setupView(n,h)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function sK(i,e){let t=new WeakMap;function n(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new TD(i,e),t.set(s,[l])):o>=a.length?(l=new TD(i,e),a.push(l)):l=a[o],l}function r(){t=new WeakMap}return{get:n,dispose:r}}let Jb=class extends Or{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=bz,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},eS=class extends Or{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};const oK=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,aK=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function lK(i,e,t){let n=new g1;const r=new xt,s=new xt,o=new Gn,a=new Jb({depthPacking:BP}),l=new eS,c={},u=t.maxTextureSize,h={[ac]:Ms,[Ms]:ac,[ts]:ts},d=new dl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new xt},radius:{value:4}},vertexShader:oK,fragmentShader:aK}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const m=new xn;m.setAttribute("position",new En(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new gi(m,d),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=jb;let g=this.type;this.render=function(w,M,T){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||w.length===0)return;const E=i.getRenderTarget(),C=i.getActiveCubeFace(),N=i.getActiveMipmapLevel(),P=i.state;P.setBlending(ec),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);const L=g!==ma&&this.type===ma,R=g===ma&&this.type!==ma;for(let F=0,V=w.length;F<V;F++){const z=w[F],U=z.shadow;if(U===void 0){console.warn("THREE.WebGLShadowMap:",z,"has no shadow.");continue}if(U.autoUpdate===!1&&U.needsUpdate===!1)continue;r.copy(U.mapSize);const G=U.getFrameExtents();if(r.multiply(G),s.copy(U.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/G.x),r.x=s.x*G.x,U.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/G.y),r.y=s.y*G.y,U.mapSize.y=s.y)),U.map===null||L===!0||R===!0){const D=this.type!==ma?{minFilter:Gi,magFilter:Gi}:{};U.map!==null&&U.map.dispose(),U.map=new Na(r.x,r.y,D),U.map.texture.name=z.name+".shadowMap",U.camera.updateProjectionMatrix()}i.setRenderTarget(U.map),i.clear();const B=U.getViewportCount();for(let D=0;D<B;D++){const O=U.getViewport(D);o.set(s.x*O.x,s.y*O.y,s.x*O.z,s.y*O.w),P.viewport(o),U.updateMatrices(z,D),n=U.getFrustum(),y(M,T,U.camera,z,this.type)}U.isPointLightShadow!==!0&&this.type===ma&&b(U,T),U.needsUpdate=!1}g=this.type,v.needsUpdate=!1,i.setRenderTarget(E,C,N)};function b(w,M){const T=e.update(_);d.defines.VSM_SAMPLES!==w.blurSamples&&(d.defines.VSM_SAMPLES=w.blurSamples,f.defines.VSM_SAMPLES=w.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new Na(r.x,r.y)),d.uniforms.shadow_pass.value=w.map.texture,d.uniforms.resolution.value=w.mapSize,d.uniforms.radius.value=w.radius,i.setRenderTarget(w.mapPass),i.clear(),i.renderBufferDirect(M,null,T,d,_,null),f.uniforms.shadow_pass.value=w.mapPass.texture,f.uniforms.resolution.value=w.mapSize,f.uniforms.radius.value=w.radius,i.setRenderTarget(w.map),i.clear(),i.renderBufferDirect(M,null,T,f,_,null)}function p(w,M,T,E){let C=null;const N=T.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(N!==void 0)C=N;else if(C=T.isPointLight===!0?l:a,i.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){const P=C.uuid,L=M.uuid;let R=c[P];R===void 0&&(R={},c[P]=R);let F=R[L];F===void 0&&(F=C.clone(),R[L]=F,M.addEventListener("dispose",A)),C=F}if(C.visible=M.visible,C.wireframe=M.wireframe,E===ma?C.side=M.shadowSide!==null?M.shadowSide:M.side:C.side=M.shadowSide!==null?M.shadowSide:h[M.side],C.alphaMap=M.alphaMap,C.alphaTest=M.alphaTest,C.map=M.map,C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.displacementMap=M.displacementMap,C.displacementScale=M.displacementScale,C.displacementBias=M.displacementBias,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,T.isPointLight===!0&&C.isMeshDistanceMaterial===!0){const P=i.properties.get(C);P.light=T}return C}function y(w,M,T,E,C){if(w.visible===!1)return;if(w.layers.test(M.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&C===ma)&&(!w.frustumCulled||n.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,w.matrixWorld);const L=e.update(w),R=w.material;if(Array.isArray(R)){const F=L.groups;for(let V=0,z=F.length;V<z;V++){const U=F[V],G=R[U.materialIndex];if(G&&G.visible){const B=p(w,G,E,C);w.onBeforeShadow(i,w,M,T,L,B,U),i.renderBufferDirect(T,null,L,B,w,U),w.onAfterShadow(i,w,M,T,L,B,U)}}}else if(R.visible){const F=p(w,R,E,C);w.onBeforeShadow(i,w,M,T,L,F,null),i.renderBufferDirect(T,null,L,F,w,null),w.onAfterShadow(i,w,M,T,L,F,null)}}const P=w.children;for(let L=0,R=P.length;L<R;L++)y(P[L],M,T,E,C)}function A(w){w.target.removeEventListener("dispose",A);for(const T in c){const E=c[T],C=w.target.uuid;C in E&&(E[C].dispose(),delete E[C])}}}function cK(i,e,t){const n=t.isWebGL2;function r(){let ee=!1;const ze=new Gn;let Ee=null;const Re=new Gn(0,0,0,0);return{setMask:function(Xe){Ee!==Xe&&!ee&&(i.colorMask(Xe,Xe,Xe,Xe),Ee=Xe)},setLocked:function(Xe){ee=Xe},setClear:function(Xe,gt,_t,Mt,K){K===!0&&(Xe*=Mt,gt*=Mt,_t*=Mt),ze.set(Xe,gt,_t,Mt),Re.equals(ze)===!1&&(i.clearColor(Xe,gt,_t,Mt),Re.copy(ze))},reset:function(){ee=!1,Ee=null,Re.set(-1,0,0,0)}}}function s(){let ee=!1,ze=null,Ee=null,Re=null;return{setTest:function(Xe){Xe?le(i.DEPTH_TEST):se(i.DEPTH_TEST)},setMask:function(Xe){ze!==Xe&&!ee&&(i.depthMask(Xe),ze=Xe)},setFunc:function(Xe){if(Ee!==Xe){switch(Xe){case YB:i.depthFunc(i.NEVER);break;case KB:i.depthFunc(i.ALWAYS);break;case ZB:i.depthFunc(i.LESS);break;case E0:i.depthFunc(i.LEQUAL);break;case QB:i.depthFunc(i.EQUAL);break;case JB:i.depthFunc(i.GEQUAL);break;case ez:i.depthFunc(i.GREATER);break;case tz:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Ee=Xe}},setLocked:function(Xe){ee=Xe},setClear:function(Xe){Re!==Xe&&(i.clearDepth(Xe),Re=Xe)},reset:function(){ee=!1,ze=null,Ee=null,Re=null}}}function o(){let ee=!1,ze=null,Ee=null,Re=null,Xe=null,gt=null,_t=null,Mt=null,K=null;return{setTest:function(ae){ee||(ae?le(i.STENCIL_TEST):se(i.STENCIL_TEST))},setMask:function(ae){ze!==ae&&!ee&&(i.stencilMask(ae),ze=ae)},setFunc:function(ae,ue,_e){(Ee!==ae||Re!==ue||Xe!==_e)&&(i.stencilFunc(ae,ue,_e),Ee=ae,Re=ue,Xe=_e)},setOp:function(ae,ue,_e){(gt!==ae||_t!==ue||Mt!==_e)&&(i.stencilOp(ae,ue,_e),gt=ae,_t=ue,Mt=_e)},setLocked:function(ae){ee=ae},setClear:function(ae){K!==ae&&(i.clearStencil(ae),K=ae)},reset:function(){ee=!1,ze=null,Ee=null,Re=null,Xe=null,gt=null,_t=null,Mt=null,K=null}}}const a=new r,l=new s,c=new o,u=new WeakMap,h=new WeakMap;let d={},f={},m=new WeakMap,_=[],v=null,g=!1,b=null,p=null,y=null,A=null,w=null,M=null,T=null,E=new kt(0,0,0),C=0,N=!1,P=null,L=null,R=null,F=null,V=null;const z=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let U=!1,G=0;const B=i.getParameter(i.VERSION);B.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(B)[1]),U=G>=1):B.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),U=G>=2);let D=null,O={};const j=i.getParameter(i.SCISSOR_BOX),q=i.getParameter(i.VIEWPORT),Y=new Gn().fromArray(j),ie=new Gn().fromArray(q);function ne(ee,ze,Ee,Re){const Xe=new Uint8Array(4),gt=i.createTexture();i.bindTexture(ee,gt),i.texParameteri(ee,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(ee,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let _t=0;_t<Ee;_t++)n&&(ee===i.TEXTURE_3D||ee===i.TEXTURE_2D_ARRAY)?i.texImage3D(ze,0,i.RGBA,1,1,Re,0,i.RGBA,i.UNSIGNED_BYTE,Xe):i.texImage2D(ze+_t,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Xe);return gt}const Q={};Q[i.TEXTURE_2D]=ne(i.TEXTURE_2D,i.TEXTURE_2D,1),Q[i.TEXTURE_CUBE_MAP]=ne(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Q[i.TEXTURE_2D_ARRAY]=ne(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),Q[i.TEXTURE_3D]=ne(i.TEXTURE_3D,i.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),le(i.DEPTH_TEST),l.setFunc(E0),Le(!1),Z(GE),le(i.CULL_FACE),ve(ec);function le(ee){d[ee]!==!0&&(i.enable(ee),d[ee]=!0)}function se(ee){d[ee]!==!1&&(i.disable(ee),d[ee]=!1)}function oe(ee,ze){return f[ee]!==ze?(i.bindFramebuffer(ee,ze),f[ee]=ze,n&&(ee===i.DRAW_FRAMEBUFFER&&(f[i.FRAMEBUFFER]=ze),ee===i.FRAMEBUFFER&&(f[i.DRAW_FRAMEBUFFER]=ze)),!0):!1}function $(ee,ze){let Ee=_,Re=!1;if(ee)if(Ee=m.get(ze),Ee===void 0&&(Ee=[],m.set(ze,Ee)),ee.isWebGLMultipleRenderTargets){const Xe=ee.texture;if(Ee.length!==Xe.length||Ee[0]!==i.COLOR_ATTACHMENT0){for(let gt=0,_t=Xe.length;gt<_t;gt++)Ee[gt]=i.COLOR_ATTACHMENT0+gt;Ee.length=Xe.length,Re=!0}}else Ee[0]!==i.COLOR_ATTACHMENT0&&(Ee[0]=i.COLOR_ATTACHMENT0,Re=!0);else Ee[0]!==i.BACK&&(Ee[0]=i.BACK,Re=!0);Re&&(t.isWebGL2?i.drawBuffers(Ee):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ee))}function pe(ee){return v!==ee?(i.useProgram(ee),v=ee,!0):!1}const xe={[eu]:i.FUNC_ADD,[NB]:i.FUNC_SUBTRACT,[FB]:i.FUNC_REVERSE_SUBTRACT};if(n)xe[WE]=i.MIN,xe[jE]=i.MAX;else{const ee=e.get("EXT_blend_minmax");ee!==null&&(xe[WE]=ee.MIN_EXT,xe[jE]=ee.MAX_EXT)}const Pe={[kB]:i.ZERO,[UB]:i.ONE,[OB]:i.SRC_COLOR,[qx]:i.SRC_ALPHA,[$B]:i.SRC_ALPHA_SATURATE,[VB]:i.DST_COLOR,[zB]:i.DST_ALPHA,[BB]:i.ONE_MINUS_SRC_COLOR,[Yx]:i.ONE_MINUS_SRC_ALPHA,[HB]:i.ONE_MINUS_DST_COLOR,[GB]:i.ONE_MINUS_DST_ALPHA,[WB]:i.CONSTANT_COLOR,[jB]:i.ONE_MINUS_CONSTANT_COLOR,[XB]:i.CONSTANT_ALPHA,[qB]:i.ONE_MINUS_CONSTANT_ALPHA};function ve(ee,ze,Ee,Re,Xe,gt,_t,Mt,K,ae){if(ee===ec){g===!0&&(se(i.BLEND),g=!1);return}if(g===!1&&(le(i.BLEND),g=!0),ee!==DB){if(ee!==b||ae!==N){if((p!==eu||w!==eu)&&(i.blendEquation(i.FUNC_ADD),p=eu,w=eu),ae)switch(ee){case zh:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case VE:i.blendFunc(i.ONE,i.ONE);break;case HE:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case $E:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}else switch(ee){case zh:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case VE:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case HE:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case $E:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}y=null,A=null,M=null,T=null,E.set(0,0,0),C=0,b=ee,N=ae}return}Xe=Xe||ze,gt=gt||Ee,_t=_t||Re,(ze!==p||Xe!==w)&&(i.blendEquationSeparate(xe[ze],xe[Xe]),p=ze,w=Xe),(Ee!==y||Re!==A||gt!==M||_t!==T)&&(i.blendFuncSeparate(Pe[Ee],Pe[Re],Pe[gt],Pe[_t]),y=Ee,A=Re,M=gt,T=_t),(Mt.equals(E)===!1||K!==C)&&(i.blendColor(Mt.r,Mt.g,Mt.b,K),E.copy(Mt),C=K),b=ee,N=!1}function Ue(ee,ze){ee.side===ts?se(i.CULL_FACE):le(i.CULL_FACE);let Ee=ee.side===Ms;ze&&(Ee=!Ee),Le(Ee),ee.blending===zh&&ee.transparent===!1?ve(ec):ve(ee.blending,ee.blendEquation,ee.blendSrc,ee.blendDst,ee.blendEquationAlpha,ee.blendSrcAlpha,ee.blendDstAlpha,ee.blendColor,ee.blendAlpha,ee.premultipliedAlpha),l.setFunc(ee.depthFunc),l.setTest(ee.depthTest),l.setMask(ee.depthWrite),a.setMask(ee.colorWrite);const Re=ee.stencilWrite;c.setTest(Re),Re&&(c.setMask(ee.stencilWriteMask),c.setFunc(ee.stencilFunc,ee.stencilRef,ee.stencilFuncMask),c.setOp(ee.stencilFail,ee.stencilZFail,ee.stencilZPass)),de(ee.polygonOffset,ee.polygonOffsetFactor,ee.polygonOffsetUnits),ee.alphaToCoverage===!0?le(i.SAMPLE_ALPHA_TO_COVERAGE):se(i.SAMPLE_ALPHA_TO_COVERAGE)}function Le(ee){P!==ee&&(ee?i.frontFace(i.CW):i.frontFace(i.CCW),P=ee)}function Z(ee){ee!==RB?(le(i.CULL_FACE),ee!==L&&(ee===GE?i.cullFace(i.BACK):ee===IB?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):se(i.CULL_FACE),L=ee}function J(ee){ee!==R&&(U&&i.lineWidth(ee),R=ee)}function de(ee,ze,Ee){ee?(le(i.POLYGON_OFFSET_FILL),(F!==ze||V!==Ee)&&(i.polygonOffset(ze,Ee),F=ze,V=Ee)):se(i.POLYGON_OFFSET_FILL)}function Ie(ee){ee?le(i.SCISSOR_TEST):se(i.SCISSOR_TEST)}function te(ee){ee===void 0&&(ee=i.TEXTURE0+z-1),D!==ee&&(i.activeTexture(ee),D=ee)}function X(ee,ze,Ee){Ee===void 0&&(D===null?Ee=i.TEXTURE0+z-1:Ee=D);let Re=O[Ee];Re===void 0&&(Re={type:void 0,texture:void 0},O[Ee]=Re),(Re.type!==ee||Re.texture!==ze)&&(D!==Ee&&(i.activeTexture(Ee),D=Ee),i.bindTexture(ee,ze||Q[ee]),Re.type=ee,Re.texture=ze)}function ye(){const ee=O[D];ee!==void 0&&ee.type!==void 0&&(i.bindTexture(ee.type,null),ee.type=void 0,ee.texture=void 0)}function ke(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ge(){try{i.compressedTexImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function De(){try{i.texSubImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function $e(){try{i.texSubImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ae(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ze(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function nt(){try{i.texStorage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function rt(){try{i.texStorage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Oe(){try{i.texImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function qe(){try{i.texImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function it(ee){Y.equals(ee)===!1&&(i.scissor(ee.x,ee.y,ee.z,ee.w),Y.copy(ee))}function at(ee){ie.equals(ee)===!1&&(i.viewport(ee.x,ee.y,ee.z,ee.w),ie.copy(ee))}function ht(ee,ze){let Ee=h.get(ze);Ee===void 0&&(Ee=new WeakMap,h.set(ze,Ee));let Re=Ee.get(ee);Re===void 0&&(Re=i.getUniformBlockIndex(ze,ee.name),Ee.set(ee,Re))}function Qe(ee,ze){const Re=h.get(ze).get(ee);u.get(ze)!==Re&&(i.uniformBlockBinding(ze,Re,ee.__bindingPointIndex),u.set(ze,Re))}function je(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),n===!0&&(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),d={},D=null,O={},f={},m=new WeakMap,_=[],v=null,g=!1,b=null,p=null,y=null,A=null,w=null,M=null,T=null,E=new kt(0,0,0),C=0,N=!1,P=null,L=null,R=null,F=null,V=null,Y.set(0,0,i.canvas.width,i.canvas.height),ie.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:le,disable:se,bindFramebuffer:oe,drawBuffers:$,useProgram:pe,setBlending:ve,setMaterial:Ue,setFlipSided:Le,setCullFace:Z,setLineWidth:J,setPolygonOffset:de,setScissorTest:Ie,activeTexture:te,bindTexture:X,unbindTexture:ye,compressedTexImage2D:ke,compressedTexImage3D:ge,texImage2D:Oe,texImage3D:qe,updateUBOMapping:ht,uniformBlockBinding:Qe,texStorage2D:nt,texStorage3D:rt,texSubImage2D:De,texSubImage3D:$e,compressedTexSubImage2D:Ae,compressedTexSubImage3D:Ze,scissor:it,viewport:at,reset:je}}function uK(i,e,t,n,r,s,o){const a=r.isWebGL2,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(Z,J){return f?new OffscreenCanvas(Z,J):O0("canvas")}function _(Z,J,de,Ie){let te=1;if((Z.width>Ie||Z.height>Ie)&&(te=Ie/Math.max(Z.width,Z.height)),te<1||J===!0)if(typeof HTMLImageElement<"u"&&Z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Z instanceof ImageBitmap){const X=J?Qx:Math.floor,ye=X(te*Z.width),ke=X(te*Z.height);h===void 0&&(h=m(ye,ke));const ge=de?m(ye,ke):h;return ge.width=ye,ge.height=ke,ge.getContext("2d").drawImage(Z,0,0,ye,ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Z.width+"x"+Z.height+") to ("+ye+"x"+ke+")."),ge}else return"data"in Z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Z.width+"x"+Z.height+")."),Z;return Z}function v(Z){return bT(Z.width)&&bT(Z.height)}function g(Z){return a?!1:Z.wrapS!==ns||Z.wrapT!==ns||Z.minFilter!==Gi&&Z.minFilter!==Mi}function b(Z,J){return Z.generateMipmaps&&J&&Z.minFilter!==Gi&&Z.minFilter!==Mi}function p(Z){i.generateMipmap(Z)}function y(Z,J,de,Ie,te=!1){if(a===!1)return J;if(Z!==null){if(i[Z]!==void 0)return i[Z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Z+"'")}let X=J;if(J===i.RED&&(de===i.FLOAT&&(X=i.R32F),de===i.HALF_FLOAT&&(X=i.R16F),de===i.UNSIGNED_BYTE&&(X=i.R8)),J===i.RED_INTEGER&&(de===i.UNSIGNED_BYTE&&(X=i.R8UI),de===i.UNSIGNED_SHORT&&(X=i.R16UI),de===i.UNSIGNED_INT&&(X=i.R32UI),de===i.BYTE&&(X=i.R8I),de===i.SHORT&&(X=i.R16I),de===i.INT&&(X=i.R32I)),J===i.RG&&(de===i.FLOAT&&(X=i.RG32F),de===i.HALF_FLOAT&&(X=i.RG16F),de===i.UNSIGNED_BYTE&&(X=i.RG8)),J===i.RGBA){const ye=te?N0:On.getTransfer(Ie);de===i.FLOAT&&(X=i.RGBA32F),de===i.HALF_FLOAT&&(X=i.RGBA16F),de===i.UNSIGNED_BYTE&&(X=ye===Qn?i.SRGB8_ALPHA8:i.RGBA8),de===i.UNSIGNED_SHORT_4_4_4_4&&(X=i.RGBA4),de===i.UNSIGNED_SHORT_5_5_5_1&&(X=i.RGB5_A1)}return(X===i.R16F||X===i.R32F||X===i.RG16F||X===i.RG32F||X===i.RGBA16F||X===i.RGBA32F)&&e.get("EXT_color_buffer_float"),X}function A(Z,J,de){return b(Z,de)===!0||Z.isFramebufferTexture&&Z.minFilter!==Gi&&Z.minFilter!==Mi?Math.log2(Math.max(J.width,J.height))+1:Z.mipmaps!==void 0&&Z.mipmaps.length>0?Z.mipmaps.length:Z.isCompressedTexture&&Array.isArray(Z.image)?J.mipmaps.length:1}function w(Z){return Z===Gi||Z===Kx||Z===Xg?i.NEAREST:i.LINEAR}function M(Z){const J=Z.target;J.removeEventListener("dispose",M),E(J),J.isVideoTexture&&u.delete(J)}function T(Z){const J=Z.target;J.removeEventListener("dispose",T),N(J)}function E(Z){const J=n.get(Z);if(J.__webglInit===void 0)return;const de=Z.source,Ie=d.get(de);if(Ie){const te=Ie[J.__cacheKey];te.usedTimes--,te.usedTimes===0&&C(Z),Object.keys(Ie).length===0&&d.delete(de)}n.remove(Z)}function C(Z){const J=n.get(Z);i.deleteTexture(J.__webglTexture);const de=Z.source,Ie=d.get(de);delete Ie[J.__cacheKey],o.memory.textures--}function N(Z){const J=Z.texture,de=n.get(Z),Ie=n.get(J);if(Ie.__webglTexture!==void 0&&(i.deleteTexture(Ie.__webglTexture),o.memory.textures--),Z.depthTexture&&Z.depthTexture.dispose(),Z.isWebGLCubeRenderTarget)for(let te=0;te<6;te++){if(Array.isArray(de.__webglFramebuffer[te]))for(let X=0;X<de.__webglFramebuffer[te].length;X++)i.deleteFramebuffer(de.__webglFramebuffer[te][X]);else i.deleteFramebuffer(de.__webglFramebuffer[te]);de.__webglDepthbuffer&&i.deleteRenderbuffer(de.__webglDepthbuffer[te])}else{if(Array.isArray(de.__webglFramebuffer))for(let te=0;te<de.__webglFramebuffer.length;te++)i.deleteFramebuffer(de.__webglFramebuffer[te]);else i.deleteFramebuffer(de.__webglFramebuffer);if(de.__webglDepthbuffer&&i.deleteRenderbuffer(de.__webglDepthbuffer),de.__webglMultisampledFramebuffer&&i.deleteFramebuffer(de.__webglMultisampledFramebuffer),de.__webglColorRenderbuffer)for(let te=0;te<de.__webglColorRenderbuffer.length;te++)de.__webglColorRenderbuffer[te]&&i.deleteRenderbuffer(de.__webglColorRenderbuffer[te]);de.__webglDepthRenderbuffer&&i.deleteRenderbuffer(de.__webglDepthRenderbuffer)}if(Z.isWebGLMultipleRenderTargets)for(let te=0,X=J.length;te<X;te++){const ye=n.get(J[te]);ye.__webglTexture&&(i.deleteTexture(ye.__webglTexture),o.memory.textures--),n.remove(J[te])}n.remove(J),n.remove(Z)}let P=0;function L(){P=0}function R(){const Z=P;return Z>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Z+" texture units while this GPU supports only "+r.maxTextures),P+=1,Z}function F(Z){const J=[];return J.push(Z.wrapS),J.push(Z.wrapT),J.push(Z.wrapR||0),J.push(Z.magFilter),J.push(Z.minFilter),J.push(Z.anisotropy),J.push(Z.internalFormat),J.push(Z.format),J.push(Z.type),J.push(Z.generateMipmaps),J.push(Z.premultiplyAlpha),J.push(Z.flipY),J.push(Z.unpackAlignment),J.push(Z.colorSpace),J.join()}function V(Z,J){const de=n.get(Z);if(Z.isVideoTexture&&Ue(Z),Z.isRenderTargetTexture===!1&&Z.version>0&&de.__version!==Z.version){const Ie=Z.image;if(Ie===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ie.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Y(de,Z,J);return}}t.bindTexture(i.TEXTURE_2D,de.__webglTexture,i.TEXTURE0+J)}function z(Z,J){const de=n.get(Z);if(Z.version>0&&de.__version!==Z.version){Y(de,Z,J);return}t.bindTexture(i.TEXTURE_2D_ARRAY,de.__webglTexture,i.TEXTURE0+J)}function U(Z,J){const de=n.get(Z);if(Z.version>0&&de.__version!==Z.version){Y(de,Z,J);return}t.bindTexture(i.TEXTURE_3D,de.__webglTexture,i.TEXTURE0+J)}function G(Z,J){const de=n.get(Z);if(Z.version>0&&de.__version!==Z.version){ie(de,Z,J);return}t.bindTexture(i.TEXTURE_CUBE_MAP,de.__webglTexture,i.TEXTURE0+J)}const B={[P0]:i.REPEAT,[ns]:i.CLAMP_TO_EDGE,[R0]:i.MIRRORED_REPEAT},D={[Gi]:i.NEAREST,[Kx]:i.NEAREST_MIPMAP_NEAREST,[Xg]:i.NEAREST_MIPMAP_LINEAR,[Mi]:i.LINEAR,[PP]:i.LINEAR_MIPMAP_NEAREST,[Mu]:i.LINEAR_MIPMAP_LINEAR},O={[wz]:i.NEVER,[Pz]:i.ALWAYS,[Mz]:i.LESS,[zP]:i.LEQUAL,[Az]:i.EQUAL,[Cz]:i.GEQUAL,[Ez]:i.GREATER,[Tz]:i.NOTEQUAL};function j(Z,J,de){if(de?(i.texParameteri(Z,i.TEXTURE_WRAP_S,B[J.wrapS]),i.texParameteri(Z,i.TEXTURE_WRAP_T,B[J.wrapT]),(Z===i.TEXTURE_3D||Z===i.TEXTURE_2D_ARRAY)&&i.texParameteri(Z,i.TEXTURE_WRAP_R,B[J.wrapR]),i.texParameteri(Z,i.TEXTURE_MAG_FILTER,D[J.magFilter]),i.texParameteri(Z,i.TEXTURE_MIN_FILTER,D[J.minFilter])):(i.texParameteri(Z,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(Z,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(Z===i.TEXTURE_3D||Z===i.TEXTURE_2D_ARRAY)&&i.texParameteri(Z,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),(J.wrapS!==ns||J.wrapT!==ns)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(Z,i.TEXTURE_MAG_FILTER,w(J.magFilter)),i.texParameteri(Z,i.TEXTURE_MIN_FILTER,w(J.minFilter)),J.minFilter!==Gi&&J.minFilter!==Mi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),J.compareFunction&&(i.texParameteri(Z,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(Z,i.TEXTURE_COMPARE_FUNC,O[J.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const Ie=e.get("EXT_texture_filter_anisotropic");if(J.magFilter===Gi||J.minFilter!==Xg&&J.minFilter!==Mu||J.type===Ea&&e.has("OES_texture_float_linear")===!1||a===!1&&J.type===Ip&&e.has("OES_texture_half_float_linear")===!1)return;(J.anisotropy>1||n.get(J).__currentAnisotropy)&&(i.texParameterf(Z,Ie.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(J.anisotropy,r.getMaxAnisotropy())),n.get(J).__currentAnisotropy=J.anisotropy)}}function q(Z,J){let de=!1;Z.__webglInit===void 0&&(Z.__webglInit=!0,J.addEventListener("dispose",M));const Ie=J.source;let te=d.get(Ie);te===void 0&&(te={},d.set(Ie,te));const X=F(J);if(X!==Z.__cacheKey){te[X]===void 0&&(te[X]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,de=!0),te[X].usedTimes++;const ye=te[Z.__cacheKey];ye!==void 0&&(te[Z.__cacheKey].usedTimes--,ye.usedTimes===0&&C(J)),Z.__cacheKey=X,Z.__webglTexture=te[X].texture}return de}function Y(Z,J,de){let Ie=i.TEXTURE_2D;(J.isDataArrayTexture||J.isCompressedArrayTexture)&&(Ie=i.TEXTURE_2D_ARRAY),J.isData3DTexture&&(Ie=i.TEXTURE_3D);const te=q(Z,J),X=J.source;t.bindTexture(Ie,Z.__webglTexture,i.TEXTURE0+de);const ye=n.get(X);if(X.version!==ye.__version||te===!0){t.activeTexture(i.TEXTURE0+de);const ke=On.getPrimaries(On.workingColorSpace),ge=J.colorSpace===_o?null:On.getPrimaries(J.colorSpace),De=J.colorSpace===_o||ke===ge?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,J.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,J.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,J.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,De);const $e=g(J)&&v(J.image)===!1;let Ae=_(J.image,$e,!1,r.maxTextureSize);Ae=Le(J,Ae);const Ze=v(Ae)||a,nt=s.convert(J.format,J.colorSpace);let rt=s.convert(J.type),Oe=y(J.internalFormat,nt,rt,J.colorSpace,J.isVideoTexture);j(Ie,J,Ze);let qe;const it=J.mipmaps,at=a&&J.isVideoTexture!==!0&&Oe!==kP,ht=ye.__version===void 0||te===!0,Qe=A(J,Ae,Ze);if(J.isDepthTexture)Oe=i.DEPTH_COMPONENT,a?J.type===Ea?Oe=i.DEPTH_COMPONENT32F:J.type===Yl?Oe=i.DEPTH_COMPONENT24:J.type===fu?Oe=i.DEPTH24_STENCIL8:Oe=i.DEPTH_COMPONENT16:J.type===Ea&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),J.format===pu&&Oe===i.DEPTH_COMPONENT&&J.type!==qb&&J.type!==Yl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),J.type=Yl,rt=s.convert(J.type)),J.format===rd&&Oe===i.DEPTH_COMPONENT&&(Oe=i.DEPTH_STENCIL,J.type!==fu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),J.type=fu,rt=s.convert(J.type))),ht&&(at?t.texStorage2D(i.TEXTURE_2D,1,Oe,Ae.width,Ae.height):t.texImage2D(i.TEXTURE_2D,0,Oe,Ae.width,Ae.height,0,nt,rt,null));else if(J.isDataTexture)if(it.length>0&&Ze){at&&ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Oe,it[0].width,it[0].height);for(let je=0,ee=it.length;je<ee;je++)qe=it[je],at?t.texSubImage2D(i.TEXTURE_2D,je,0,0,qe.width,qe.height,nt,rt,qe.data):t.texImage2D(i.TEXTURE_2D,je,Oe,qe.width,qe.height,0,nt,rt,qe.data);J.generateMipmaps=!1}else at?(ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Oe,Ae.width,Ae.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,Ae.width,Ae.height,nt,rt,Ae.data)):t.texImage2D(i.TEXTURE_2D,0,Oe,Ae.width,Ae.height,0,nt,rt,Ae.data);else if(J.isCompressedTexture)if(J.isCompressedArrayTexture){at&&ht&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Qe,Oe,it[0].width,it[0].height,Ae.depth);for(let je=0,ee=it.length;je<ee;je++)qe=it[je],J.format!==Ss?nt!==null?at?t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,je,0,0,0,qe.width,qe.height,Ae.depth,nt,qe.data,0,0):t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,je,Oe,qe.width,qe.height,Ae.depth,0,qe.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):at?t.texSubImage3D(i.TEXTURE_2D_ARRAY,je,0,0,0,qe.width,qe.height,Ae.depth,nt,rt,qe.data):t.texImage3D(i.TEXTURE_2D_ARRAY,je,Oe,qe.width,qe.height,Ae.depth,0,nt,rt,qe.data)}else{at&&ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Oe,it[0].width,it[0].height);for(let je=0,ee=it.length;je<ee;je++)qe=it[je],J.format!==Ss?nt!==null?at?t.compressedTexSubImage2D(i.TEXTURE_2D,je,0,0,qe.width,qe.height,nt,qe.data):t.compressedTexImage2D(i.TEXTURE_2D,je,Oe,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):at?t.texSubImage2D(i.TEXTURE_2D,je,0,0,qe.width,qe.height,nt,rt,qe.data):t.texImage2D(i.TEXTURE_2D,je,Oe,qe.width,qe.height,0,nt,rt,qe.data)}else if(J.isDataArrayTexture)at?(ht&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Qe,Oe,Ae.width,Ae.height,Ae.depth),t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Ae.width,Ae.height,Ae.depth,nt,rt,Ae.data)):t.texImage3D(i.TEXTURE_2D_ARRAY,0,Oe,Ae.width,Ae.height,Ae.depth,0,nt,rt,Ae.data);else if(J.isData3DTexture)at?(ht&&t.texStorage3D(i.TEXTURE_3D,Qe,Oe,Ae.width,Ae.height,Ae.depth),t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Ae.width,Ae.height,Ae.depth,nt,rt,Ae.data)):t.texImage3D(i.TEXTURE_3D,0,Oe,Ae.width,Ae.height,Ae.depth,0,nt,rt,Ae.data);else if(J.isFramebufferTexture){if(ht)if(at)t.texStorage2D(i.TEXTURE_2D,Qe,Oe,Ae.width,Ae.height);else{let je=Ae.width,ee=Ae.height;for(let ze=0;ze<Qe;ze++)t.texImage2D(i.TEXTURE_2D,ze,Oe,je,ee,0,nt,rt,null),je>>=1,ee>>=1}}else if(it.length>0&&Ze){at&&ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Oe,it[0].width,it[0].height);for(let je=0,ee=it.length;je<ee;je++)qe=it[je],at?t.texSubImage2D(i.TEXTURE_2D,je,0,0,nt,rt,qe):t.texImage2D(i.TEXTURE_2D,je,Oe,nt,rt,qe);J.generateMipmaps=!1}else at?(ht&&t.texStorage2D(i.TEXTURE_2D,Qe,Oe,Ae.width,Ae.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,nt,rt,Ae)):t.texImage2D(i.TEXTURE_2D,0,Oe,nt,rt,Ae);b(J,Ze)&&p(Ie),ye.__version=X.version,J.onUpdate&&J.onUpdate(J)}Z.__version=J.version}function ie(Z,J,de){if(J.image.length!==6)return;const Ie=q(Z,J),te=J.source;t.bindTexture(i.TEXTURE_CUBE_MAP,Z.__webglTexture,i.TEXTURE0+de);const X=n.get(te);if(te.version!==X.__version||Ie===!0){t.activeTexture(i.TEXTURE0+de);const ye=On.getPrimaries(On.workingColorSpace),ke=J.colorSpace===_o?null:On.getPrimaries(J.colorSpace),ge=J.colorSpace===_o||ye===ke?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,J.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,J.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,J.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,ge);const De=J.isCompressedTexture||J.image[0].isCompressedTexture,$e=J.image[0]&&J.image[0].isDataTexture,Ae=[];for(let je=0;je<6;je++)!De&&!$e?Ae[je]=_(J.image[je],!1,!0,r.maxCubemapSize):Ae[je]=$e?J.image[je].image:J.image[je],Ae[je]=Le(J,Ae[je]);const Ze=Ae[0],nt=v(Ze)||a,rt=s.convert(J.format,J.colorSpace),Oe=s.convert(J.type),qe=y(J.internalFormat,rt,Oe,J.colorSpace),it=a&&J.isVideoTexture!==!0,at=X.__version===void 0||Ie===!0;let ht=A(J,Ze,nt);j(i.TEXTURE_CUBE_MAP,J,nt);let Qe;if(De){it&&at&&t.texStorage2D(i.TEXTURE_CUBE_MAP,ht,qe,Ze.width,Ze.height);for(let je=0;je<6;je++){Qe=Ae[je].mipmaps;for(let ee=0;ee<Qe.length;ee++){const ze=Qe[ee];J.format!==Ss?rt!==null?it?t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee,0,0,ze.width,ze.height,rt,ze.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee,qe,ze.width,ze.height,0,ze.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee,0,0,ze.width,ze.height,rt,Oe,ze.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee,qe,ze.width,ze.height,0,rt,Oe,ze.data)}}}else{Qe=J.mipmaps,it&&at&&(Qe.length>0&&ht++,t.texStorage2D(i.TEXTURE_CUBE_MAP,ht,qe,Ae[0].width,Ae[0].height));for(let je=0;je<6;je++)if($e){it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,0,0,Ae[je].width,Ae[je].height,rt,Oe,Ae[je].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,qe,Ae[je].width,Ae[je].height,0,rt,Oe,Ae[je].data);for(let ee=0;ee<Qe.length;ee++){const Ee=Qe[ee].image[je].image;it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee+1,0,0,Ee.width,Ee.height,rt,Oe,Ee.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee+1,qe,Ee.width,Ee.height,0,rt,Oe,Ee.data)}}else{it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,0,0,rt,Oe,Ae[je]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,qe,rt,Oe,Ae[je]);for(let ee=0;ee<Qe.length;ee++){const ze=Qe[ee];it?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee+1,0,0,rt,Oe,ze.image[je]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+je,ee+1,qe,rt,Oe,ze.image[je])}}}b(J,nt)&&p(i.TEXTURE_CUBE_MAP),X.__version=te.version,J.onUpdate&&J.onUpdate(J)}Z.__version=J.version}function ne(Z,J,de,Ie,te,X){const ye=s.convert(de.format,de.colorSpace),ke=s.convert(de.type),ge=y(de.internalFormat,ye,ke,de.colorSpace);if(!n.get(J).__hasExternalTextures){const $e=Math.max(1,J.width>>X),Ae=Math.max(1,J.height>>X);te===i.TEXTURE_3D||te===i.TEXTURE_2D_ARRAY?t.texImage3D(te,X,ge,$e,Ae,J.depth,0,ye,ke,null):t.texImage2D(te,X,ge,$e,Ae,0,ye,ke,null)}t.bindFramebuffer(i.FRAMEBUFFER,Z),ve(J)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,Ie,te,n.get(de).__webglTexture,0,Pe(J)):(te===i.TEXTURE_2D||te>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&te<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,Ie,te,n.get(de).__webglTexture,X),t.bindFramebuffer(i.FRAMEBUFFER,null)}function Q(Z,J,de){if(i.bindRenderbuffer(i.RENDERBUFFER,Z),J.depthBuffer&&!J.stencilBuffer){let Ie=a===!0?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT16;if(de||ve(J)){const te=J.depthTexture;te&&te.isDepthTexture&&(te.type===Ea?Ie=i.DEPTH_COMPONENT32F:te.type===Yl&&(Ie=i.DEPTH_COMPONENT24));const X=Pe(J);ve(J)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,X,Ie,J.width,J.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,X,Ie,J.width,J.height)}else i.renderbufferStorage(i.RENDERBUFFER,Ie,J.width,J.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,Z)}else if(J.depthBuffer&&J.stencilBuffer){const Ie=Pe(J);de&&ve(J)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Ie,i.DEPTH24_STENCIL8,J.width,J.height):ve(J)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Ie,i.DEPTH24_STENCIL8,J.width,J.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,J.width,J.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,Z)}else{const Ie=J.isWebGLMultipleRenderTargets===!0?J.texture:[J.texture];for(let te=0;te<Ie.length;te++){const X=Ie[te],ye=s.convert(X.format,X.colorSpace),ke=s.convert(X.type),ge=y(X.internalFormat,ye,ke,X.colorSpace),De=Pe(J);de&&ve(J)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,De,ge,J.width,J.height):ve(J)?l.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,De,ge,J.width,J.height):i.renderbufferStorage(i.RENDERBUFFER,ge,J.width,J.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function le(Z,J){if(J&&J.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,Z),!(J.depthTexture&&J.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(J.depthTexture).__webglTexture||J.depthTexture.image.width!==J.width||J.depthTexture.image.height!==J.height)&&(J.depthTexture.image.width=J.width,J.depthTexture.image.height=J.height,J.depthTexture.needsUpdate=!0),V(J.depthTexture,0);const Ie=n.get(J.depthTexture).__webglTexture,te=Pe(J);if(J.depthTexture.format===pu)ve(J)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Ie,0,te):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Ie,0);else if(J.depthTexture.format===rd)ve(J)?l.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Ie,0,te):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Ie,0);else throw new Error("Unknown depthTexture format")}function se(Z){const J=n.get(Z),de=Z.isWebGLCubeRenderTarget===!0;if(Z.depthTexture&&!J.__autoAllocateDepthBuffer){if(de)throw new Error("target.depthTexture not supported in Cube render targets");le(J.__webglFramebuffer,Z)}else if(de){J.__webglDepthbuffer=[];for(let Ie=0;Ie<6;Ie++)t.bindFramebuffer(i.FRAMEBUFFER,J.__webglFramebuffer[Ie]),J.__webglDepthbuffer[Ie]=i.createRenderbuffer(),Q(J.__webglDepthbuffer[Ie],Z,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,J.__webglFramebuffer),J.__webglDepthbuffer=i.createRenderbuffer(),Q(J.__webglDepthbuffer,Z,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}function oe(Z,J,de){const Ie=n.get(Z);J!==void 0&&ne(Ie.__webglFramebuffer,Z,Z.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),de!==void 0&&se(Z)}function $(Z){const J=Z.texture,de=n.get(Z),Ie=n.get(J);Z.addEventListener("dispose",T),Z.isWebGLMultipleRenderTargets!==!0&&(Ie.__webglTexture===void 0&&(Ie.__webglTexture=i.createTexture()),Ie.__version=J.version,o.memory.textures++);const te=Z.isWebGLCubeRenderTarget===!0,X=Z.isWebGLMultipleRenderTargets===!0,ye=v(Z)||a;if(te){de.__webglFramebuffer=[];for(let ke=0;ke<6;ke++)if(a&&J.mipmaps&&J.mipmaps.length>0){de.__webglFramebuffer[ke]=[];for(let ge=0;ge<J.mipmaps.length;ge++)de.__webglFramebuffer[ke][ge]=i.createFramebuffer()}else de.__webglFramebuffer[ke]=i.createFramebuffer()}else{if(a&&J.mipmaps&&J.mipmaps.length>0){de.__webglFramebuffer=[];for(let ke=0;ke<J.mipmaps.length;ke++)de.__webglFramebuffer[ke]=i.createFramebuffer()}else de.__webglFramebuffer=i.createFramebuffer();if(X)if(r.drawBuffers){const ke=Z.texture;for(let ge=0,De=ke.length;ge<De;ge++){const $e=n.get(ke[ge]);$e.__webglTexture===void 0&&($e.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&Z.samples>0&&ve(Z)===!1){const ke=X?J:[J];de.__webglMultisampledFramebuffer=i.createFramebuffer(),de.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,de.__webglMultisampledFramebuffer);for(let ge=0;ge<ke.length;ge++){const De=ke[ge];de.__webglColorRenderbuffer[ge]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,de.__webglColorRenderbuffer[ge]);const $e=s.convert(De.format,De.colorSpace),Ae=s.convert(De.type),Ze=y(De.internalFormat,$e,Ae,De.colorSpace,Z.isXRRenderTarget===!0),nt=Pe(Z);i.renderbufferStorageMultisample(i.RENDERBUFFER,nt,Ze,Z.width,Z.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+ge,i.RENDERBUFFER,de.__webglColorRenderbuffer[ge])}i.bindRenderbuffer(i.RENDERBUFFER,null),Z.depthBuffer&&(de.__webglDepthRenderbuffer=i.createRenderbuffer(),Q(de.__webglDepthRenderbuffer,Z,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(te){t.bindTexture(i.TEXTURE_CUBE_MAP,Ie.__webglTexture),j(i.TEXTURE_CUBE_MAP,J,ye);for(let ke=0;ke<6;ke++)if(a&&J.mipmaps&&J.mipmaps.length>0)for(let ge=0;ge<J.mipmaps.length;ge++)ne(de.__webglFramebuffer[ke][ge],Z,J,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+ke,ge);else ne(de.__webglFramebuffer[ke],Z,J,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0);b(J,ye)&&p(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(X){const ke=Z.texture;for(let ge=0,De=ke.length;ge<De;ge++){const $e=ke[ge],Ae=n.get($e);t.bindTexture(i.TEXTURE_2D,Ae.__webglTexture),j(i.TEXTURE_2D,$e,ye),ne(de.__webglFramebuffer,Z,$e,i.COLOR_ATTACHMENT0+ge,i.TEXTURE_2D,0),b($e,ye)&&p(i.TEXTURE_2D)}t.unbindTexture()}else{let ke=i.TEXTURE_2D;if((Z.isWebGL3DRenderTarget||Z.isWebGLArrayRenderTarget)&&(a?ke=Z.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(ke,Ie.__webglTexture),j(ke,J,ye),a&&J.mipmaps&&J.mipmaps.length>0)for(let ge=0;ge<J.mipmaps.length;ge++)ne(de.__webglFramebuffer[ge],Z,J,i.COLOR_ATTACHMENT0,ke,ge);else ne(de.__webglFramebuffer,Z,J,i.COLOR_ATTACHMENT0,ke,0);b(J,ye)&&p(ke),t.unbindTexture()}Z.depthBuffer&&se(Z)}function pe(Z){const J=v(Z)||a,de=Z.isWebGLMultipleRenderTargets===!0?Z.texture:[Z.texture];for(let Ie=0,te=de.length;Ie<te;Ie++){const X=de[Ie];if(b(X,J)){const ye=Z.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,ke=n.get(X).__webglTexture;t.bindTexture(ye,ke),p(ye),t.unbindTexture()}}}function xe(Z){if(a&&Z.samples>0&&ve(Z)===!1){const J=Z.isWebGLMultipleRenderTargets?Z.texture:[Z.texture],de=Z.width,Ie=Z.height;let te=i.COLOR_BUFFER_BIT;const X=[],ye=Z.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,ke=n.get(Z),ge=Z.isWebGLMultipleRenderTargets===!0;if(ge)for(let De=0;De<J.length;De++)t.bindFramebuffer(i.FRAMEBUFFER,ke.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+De,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,ke.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+De,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,ke.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,ke.__webglFramebuffer);for(let De=0;De<J.length;De++){X.push(i.COLOR_ATTACHMENT0+De),Z.depthBuffer&&X.push(ye);const $e=ke.__ignoreDepthValues!==void 0?ke.__ignoreDepthValues:!1;if($e===!1&&(Z.depthBuffer&&(te|=i.DEPTH_BUFFER_BIT),Z.stencilBuffer&&(te|=i.STENCIL_BUFFER_BIT)),ge&&i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,ke.__webglColorRenderbuffer[De]),$e===!0&&(i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[ye]),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[ye])),ge){const Ae=n.get(J[De]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Ae,0)}i.blitFramebuffer(0,0,de,Ie,0,0,de,Ie,te,i.NEAREST),c&&i.invalidateFramebuffer(i.READ_FRAMEBUFFER,X)}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),ge)for(let De=0;De<J.length;De++){t.bindFramebuffer(i.FRAMEBUFFER,ke.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+De,i.RENDERBUFFER,ke.__webglColorRenderbuffer[De]);const $e=n.get(J[De]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,ke.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+De,i.TEXTURE_2D,$e,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,ke.__webglMultisampledFramebuffer)}}function Pe(Z){return Math.min(r.maxSamples,Z.samples)}function ve(Z){const J=n.get(Z);return a&&Z.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&J.__useRenderToTexture!==!1}function Ue(Z){const J=o.render.frame;u.get(Z)!==J&&(u.set(Z,J),Z.update())}function Le(Z,J){const de=Z.colorSpace,Ie=Z.format,te=Z.type;return Z.isCompressedTexture===!0||Z.isVideoTexture===!0||Z.format===Zx||de!==hl&&de!==_o&&(On.getTransfer(de)===Qn?a===!1?e.has("EXT_sRGB")===!0&&Ie===Ss?(Z.format=Zx,Z.minFilter=Mi,Z.generateMipmaps=!1):J=VP.sRGBToLinear(J):(Ie!==Ss||te!==rl)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",de)),J}this.allocateTextureUnit=R,this.resetTextureUnits=L,this.setTexture2D=V,this.setTexture2DArray=z,this.setTexture3D=U,this.setTextureCube=G,this.rebindTextures=oe,this.setupRenderTarget=$,this.updateRenderTargetMipmap=pe,this.updateMultisampleRenderTarget=xe,this.setupDepthRenderbuffer=se,this.setupFrameBufferTexture=ne,this.useMultisampledRTT=ve}function Zz(i,e,t){const n=t.isWebGL2;function r(s,o=_o){let a;const l=On.getTransfer(o);if(s===rl)return i.UNSIGNED_BYTE;if(s===IP)return i.UNSIGNED_SHORT_4_4_4_4;if(s===LP)return i.UNSIGNED_SHORT_5_5_5_1;if(s===uz)return i.BYTE;if(s===hz)return i.SHORT;if(s===qb)return i.UNSIGNED_SHORT;if(s===RP)return i.INT;if(s===Yl)return i.UNSIGNED_INT;if(s===Ea)return i.FLOAT;if(s===Ip)return n?i.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===dz)return i.ALPHA;if(s===Ss)return i.RGBA;if(s===fz)return i.LUMINANCE;if(s===pz)return i.LUMINANCE_ALPHA;if(s===pu)return i.DEPTH_COMPONENT;if(s===rd)return i.DEPTH_STENCIL;if(s===Zx)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===mz)return i.RED;if(s===DP)return i.RED_INTEGER;if(s===gz)return i.RG;if(s===NP)return i.RG_INTEGER;if(s===FP)return i.RGBA_INTEGER;if(s===Zy||s===Qy||s===Jy||s===ex)if(l===Qn)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===Zy)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===Qy)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===Jy)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===ex)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===Zy)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===Qy)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===Jy)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===ex)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===qE||s===YE||s===KE||s===ZE)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===qE)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===YE)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===KE)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===ZE)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===kP)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===QE||s===JE)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===QE)return l===Qn?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===JE)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===eT||s===tT||s===nT||s===iT||s===rT||s===sT||s===oT||s===aT||s===lT||s===cT||s===uT||s===hT||s===dT||s===fT)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===eT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===tT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===nT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===iT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===rT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===sT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===oT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===aT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===lT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===cT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===uT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===hT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===dT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===fT)return l===Qn?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===tx||s===pT||s===mT)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===tx)return l===Qn?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===pT)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===mT)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===vz||s===gT||s===vT||s===_T)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===tx)return a.COMPRESSED_RED_RGTC1_EXT;if(s===gT)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===vT)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===_T)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===fu?n?i.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[s]!==void 0?i[s]:null}return{convert:r}}let Qz=class extends Ji{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Kl=class extends qn{constructor(){super(),this.isGroup=!0,this.type="Group"}};const hK={type:"move"};let Pw=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Kl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Kl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ce,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ce),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Kl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ce,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ce),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const _ of e.hand.values()){const v=t.getJointPose(_,n),g=this._getHandJoint(c,_);v!==null&&(g.matrix.fromArray(v.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=v.radius),g.visible=v!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),f=.02,m=.005;c.inputState.pinching&&d>f+m?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=f-m&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(hK)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Kl;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}},dK=class extends gc{constructor(e,t){super();const n=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,h=null,d=null,f=null,m=null;const _=t.getContextAttributes();let v=null,g=null;const b=[],p=[],y=new xt;let A=null;const w=new Ji;w.layers.enable(1),w.viewport=new Gn;const M=new Ji;M.layers.enable(2),M.viewport=new Gn;const T=[w,M],E=new Qz;E.layers.enable(1),E.layers.enable(2);let C=null,N=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let q=b[j];return q===void 0&&(q=new Pw,b[j]=q),q.getTargetRaySpace()},this.getControllerGrip=function(j){let q=b[j];return q===void 0&&(q=new Pw,b[j]=q),q.getGripSpace()},this.getHand=function(j){let q=b[j];return q===void 0&&(q=new Pw,b[j]=q),q.getHandSpace()};function P(j){const q=p.indexOf(j.inputSource);if(q===-1)return;const Y=b[q];Y!==void 0&&(Y.update(j.inputSource,j.frame,c||o),Y.dispatchEvent({type:j.type,data:j.inputSource}))}function L(){r.removeEventListener("select",P),r.removeEventListener("selectstart",P),r.removeEventListener("selectend",P),r.removeEventListener("squeeze",P),r.removeEventListener("squeezestart",P),r.removeEventListener("squeezeend",P),r.removeEventListener("end",L),r.removeEventListener("inputsourceschange",R);for(let j=0;j<b.length;j++){const q=p[j];q!==null&&(p[j]=null,b[j].disconnect(q))}C=null,N=null,e.setRenderTarget(v),f=null,d=null,h=null,r=null,g=null,O.stop(),n.isPresenting=!1,e.setPixelRatio(A),e.setSize(y.width,y.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){s=j,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){a=j,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(j){c=j},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=async function(j){if(r=j,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",P),r.addEventListener("selectstart",P),r.addEventListener("selectend",P),r.addEventListener("squeeze",P),r.addEventListener("squeezestart",P),r.addEventListener("squeezeend",P),r.addEventListener("end",L),r.addEventListener("inputsourceschange",R),_.xrCompatible!==!0&&await t.makeXRCompatible(),A=e.getPixelRatio(),e.getSize(y),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const q={antialias:r.renderState.layers===void 0?_.antialias:!0,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(r,t,q),r.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),g=new Na(f.framebufferWidth,f.framebufferHeight,{format:Ss,type:rl,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil})}else{let q=null,Y=null,ie=null;_.depth&&(ie=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,q=_.stencil?rd:pu,Y=_.stencil?fu:Yl);const ne={colorFormat:t.RGBA8,depthFormat:ie,scaleFactor:s};h=new XRWebGLBinding(r,t),d=h.createProjectionLayer(ne),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),g=new Na(d.textureWidth,d.textureHeight,{format:Ss,type:rl,depthTexture:new qP(d.textureWidth,d.textureHeight,Y,void 0,void 0,void 0,void 0,void 0,void 0,q),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0});const Q=e.properties.get(g);Q.__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),O.setContext(r),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function R(j){for(let q=0;q<j.removed.length;q++){const Y=j.removed[q],ie=p.indexOf(Y);ie>=0&&(p[ie]=null,b[ie].disconnect(Y))}for(let q=0;q<j.added.length;q++){const Y=j.added[q];let ie=p.indexOf(Y);if(ie===-1){for(let Q=0;Q<b.length;Q++)if(Q>=p.length){p.push(Y),ie=Q;break}else if(p[Q]===null){p[Q]=Y,ie=Q;break}if(ie===-1)break}const ne=b[ie];ne&&ne.connect(Y)}}const F=new Ce,V=new Ce;function z(j,q,Y){F.setFromMatrixPosition(q.matrixWorld),V.setFromMatrixPosition(Y.matrixWorld);const ie=F.distanceTo(V),ne=q.projectionMatrix.elements,Q=Y.projectionMatrix.elements,le=ne[14]/(ne[10]-1),se=ne[14]/(ne[10]+1),oe=(ne[9]+1)/ne[5],$=(ne[9]-1)/ne[5],pe=(ne[8]-1)/ne[0],xe=(Q[8]+1)/Q[0],Pe=le*pe,ve=le*xe,Ue=ie/(-pe+xe),Le=Ue*-pe;q.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(Le),j.translateZ(Ue),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert();const Z=le+Ue,J=se+Ue,de=Pe-Le,Ie=ve+(ie-Le),te=oe*se/J*Z,X=$*se/J*Z;j.projectionMatrix.makePerspective(de,Ie,te,X,Z,J),j.projectionMatrixInverse.copy(j.projectionMatrix).invert()}function U(j,q){q===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices(q.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(r===null)return;E.near=M.near=w.near=j.near,E.far=M.far=w.far=j.far,(C!==E.near||N!==E.far)&&(r.updateRenderState({depthNear:E.near,depthFar:E.far}),C=E.near,N=E.far);const q=j.parent,Y=E.cameras;U(E,q);for(let ie=0;ie<Y.length;ie++)U(Y[ie],q);Y.length===2?z(E,w,M):E.projectionMatrix.copy(w.projectionMatrix),G(j,E,q)};function G(j,q,Y){Y===null?j.matrix.copy(q.matrixWorld):(j.matrix.copy(Y.matrixWorld),j.matrix.invert(),j.matrix.multiply(q.matrixWorld)),j.matrix.decompose(j.position,j.quaternion,j.scale),j.updateMatrixWorld(!0),j.projectionMatrix.copy(q.projectionMatrix),j.projectionMatrixInverse.copy(q.projectionMatrixInverse),j.isPerspectiveCamera&&(j.fov=Dp*2*Math.atan(1/j.projectionMatrix.elements[5]),j.zoom=1)}this.getCamera=function(){return E},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(j){l=j,d!==null&&(d.fixedFoveation=j),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=j)};let B=null;function D(j,q){if(u=q.getViewerPose(c||o),m=q,u!==null){const Y=u.views;f!==null&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let ie=!1;Y.length!==E.cameras.length&&(E.cameras.length=0,ie=!0);for(let ne=0;ne<Y.length;ne++){const Q=Y[ne];let le=null;if(f!==null)le=f.getViewport(Q);else{const oe=h.getViewSubImage(d,Q);le=oe.viewport,ne===0&&(e.setRenderTargetTextures(g,oe.colorTexture,d.ignoreDepthValues?void 0:oe.depthStencilTexture),e.setRenderTarget(g))}let se=T[ne];se===void 0&&(se=new Ji,se.layers.enable(ne),se.viewport=new Gn,T[ne]=se),se.matrix.fromArray(Q.transform.matrix),se.matrix.decompose(se.position,se.quaternion,se.scale),se.projectionMatrix.fromArray(Q.projectionMatrix),se.projectionMatrixInverse.copy(se.projectionMatrix).invert(),se.viewport.set(le.x,le.y,le.width,le.height),ne===0&&(E.matrix.copy(se.matrix),E.matrix.decompose(E.position,E.quaternion,E.scale)),ie===!0&&E.cameras.push(se)}}for(let Y=0;Y<b.length;Y++){const ie=p[Y],ne=b[Y];ie!==null&&ne!==void 0&&ne.update(ie,q,c||o)}B&&B(j,q),q.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:q}),m=null}const O=new $z;O.setAnimationLoop(D),this.setAnimationLoop=function(j){B=j},this.dispose=function(){}}};function fK(i,e){function t(v,g){v.matrixAutoUpdate===!0&&v.updateMatrix(),g.value.copy(v.matrix)}function n(v,g){g.color.getRGB(v.fogColor.value,Gz(i)),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function r(v,g,b,p,y){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(v,g):g.isMeshToonMaterial?(s(v,g),h(v,g)):g.isMeshPhongMaterial?(s(v,g),u(v,g)):g.isMeshStandardMaterial?(s(v,g),d(v,g),g.isMeshPhysicalMaterial&&f(v,g,y)):g.isMeshMatcapMaterial?(s(v,g),m(v,g)):g.isMeshDepthMaterial?s(v,g):g.isMeshDistanceMaterial?(s(v,g),_(v,g)):g.isMeshNormalMaterial?s(v,g):g.isLineBasicMaterial?(o(v,g),g.isLineDashedMaterial&&a(v,g)):g.isPointsMaterial?l(v,g,b,p):g.isSpriteMaterial?c(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function s(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.bumpMap&&(v.bumpMap.value=g.bumpMap,t(g.bumpMap,v.bumpMapTransform),v.bumpScale.value=g.bumpScale,g.side===Ms&&(v.bumpScale.value*=-1)),g.normalMap&&(v.normalMap.value=g.normalMap,t(g.normalMap,v.normalMapTransform),v.normalScale.value.copy(g.normalScale),g.side===Ms&&v.normalScale.value.negate()),g.displacementMap&&(v.displacementMap.value=g.displacementMap,t(g.displacementMap,v.displacementMapTransform),v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,v.emissiveMapTransform)),g.specularMap&&(v.specularMap.value=g.specularMap,t(g.specularMap,v.specularMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);const b=e.get(g).envMap;if(b&&(v.envMap.value=b,v.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap){v.lightMap.value=g.lightMap;const p=i._useLegacyLights===!0?Math.PI:1;v.lightMapIntensity.value=g.lightMapIntensity*p,t(g.lightMap,v.lightMapTransform)}g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,v.aoMapTransform))}function o(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform))}function a(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function l(v,g,b,p){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*b,v.scale.value=p*.5,g.map&&(v.map.value=g.map,t(g.map,v.uvTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function c(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function u(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function h(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function d(v,g){v.metalness.value=g.metalness,g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,v.metalnessMapTransform)),v.roughness.value=g.roughness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,v.roughnessMapTransform)),e.get(g).envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function f(v,g,b){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,v.sheenColorMapTransform)),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,v.sheenRoughnessMapTransform))),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,v.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(v.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===Ms&&v.clearcoatNormalScale.value.negate())),g.iridescence>0&&(v.iridescence.value=g.iridescence,v.iridescenceIOR.value=g.iridescenceIOR,v.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(v.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,v.iridescenceMapTransform)),g.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=b.texture,v.transmissionSamplerSize.value.set(b.width,b.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,v.transmissionMapTransform)),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(v.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(v.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,v.specularColorMapTransform)),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,v.specularIntensityMapTransform))}function m(v,g){g.matcap&&(v.matcap.value=g.matcap)}function _(v,g){const b=e.get(g).light;v.referencePosition.value.setFromMatrixPosition(b.matrixWorld),v.nearDistance.value=b.shadow.camera.near,v.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function pK(i,e,t,n){let r={},s={},o=[];const a=t.isWebGL2?i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(b,p){const y=p.program;n.uniformBlockBinding(b,y)}function c(b,p){let y=r[b.id];y===void 0&&(m(b),y=u(b),r[b.id]=y,b.addEventListener("dispose",v));const A=p.program;n.updateUBOMapping(b,A);const w=e.render.frame;s[b.id]!==w&&(d(b),s[b.id]=w)}function u(b){const p=h();b.__bindingPointIndex=p;const y=i.createBuffer(),A=b.__size,w=b.usage;return i.bindBuffer(i.UNIFORM_BUFFER,y),i.bufferData(i.UNIFORM_BUFFER,A,w),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,p,y),y}function h(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(b){const p=r[b.id],y=b.uniforms,A=b.__cache;i.bindBuffer(i.UNIFORM_BUFFER,p);for(let w=0,M=y.length;w<M;w++){const T=Array.isArray(y[w])?y[w]:[y[w]];for(let E=0,C=T.length;E<C;E++){const N=T[E];if(f(N,w,E,A)===!0){const P=N.__offset,L=Array.isArray(N.value)?N.value:[N.value];let R=0;for(let F=0;F<L.length;F++){const V=L[F],z=_(V);typeof V=="number"||typeof V=="boolean"?(N.__data[0]=V,i.bufferSubData(i.UNIFORM_BUFFER,P+R,N.__data)):V.isMatrix3?(N.__data[0]=V.elements[0],N.__data[1]=V.elements[1],N.__data[2]=V.elements[2],N.__data[3]=0,N.__data[4]=V.elements[3],N.__data[5]=V.elements[4],N.__data[6]=V.elements[5],N.__data[7]=0,N.__data[8]=V.elements[6],N.__data[9]=V.elements[7],N.__data[10]=V.elements[8],N.__data[11]=0):(V.toArray(N.__data,R),R+=z.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,P,N.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function f(b,p,y,A){const w=b.value,M=p+"_"+y;if(A[M]===void 0)return typeof w=="number"||typeof w=="boolean"?A[M]=w:A[M]=w.clone(),!0;{const T=A[M];if(typeof w=="number"||typeof w=="boolean"){if(T!==w)return A[M]=w,!0}else if(T.equals(w)===!1)return T.copy(w),!0}return!1}function m(b){const p=b.uniforms;let y=0;const A=16;for(let M=0,T=p.length;M<T;M++){const E=Array.isArray(p[M])?p[M]:[p[M]];for(let C=0,N=E.length;C<N;C++){const P=E[C],L=Array.isArray(P.value)?P.value:[P.value];for(let R=0,F=L.length;R<F;R++){const V=L[R],z=_(V),U=y%A;U!==0&&A-U<z.boundary&&(y+=A-U),P.__data=new Float32Array(z.storage/Float32Array.BYTES_PER_ELEMENT),P.__offset=y,y+=z.storage}}}const w=y%A;return w>0&&(y+=A-w),b.__size=y,b.__cache={},this}function _(b){const p={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(p.boundary=4,p.storage=4):b.isVector2?(p.boundary=8,p.storage=8):b.isVector3||b.isColor?(p.boundary=16,p.storage=12):b.isVector4?(p.boundary=16,p.storage=16):b.isMatrix3?(p.boundary=48,p.storage=48):b.isMatrix4?(p.boundary=64,p.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),p}function v(b){const p=b.target;p.removeEventListener("dispose",v);const y=o.indexOf(p.__bindingPointIndex);o.splice(y,1),i.deleteBuffer(r[p.id]),delete r[p.id],delete s[p.id]}function g(){for(const b in r)i.deleteBuffer(r[b]);o=[],r={},s={}}return{bind:l,update:c,dispose:g}}let YP=class{constructor(e={}){const{canvas:t=Dz(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let d;n!==null?d=n.getContextAttributes().alpha:d=o;const f=new Uint32Array(4),m=new Int32Array(4);let _=null,v=null;const g=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=lr,this._useLegacyLights=!1,this.toneMapping=il,this.toneMappingExposure=1;const p=this;let y=!1,A=0,w=0,M=null,T=-1,E=null;const C=new Gn,N=new Gn;let P=null;const L=new kt(0);let R=0,F=t.width,V=t.height,z=1,U=null,G=null;const B=new Gn(0,0,F,V),D=new Gn(0,0,F,V);let O=!1;const j=new g1;let q=!1,Y=!1,ie=null;const ne=new nn,Q=new xt,le=new Ce,se={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function oe(){return M===null?z:1}let $=n;function pe(H,fe){for(let Me=0;Me<H.length;Me++){const Se=H[Me],Te=t.getContext(Se,fe);if(Te!==null)return Te}return null}try{const H={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Wb}`),t.addEventListener("webglcontextlost",je,!1),t.addEventListener("webglcontextrestored",ee,!1),t.addEventListener("webglcontextcreationerror",ze,!1),$===null){const fe=["webgl2","webgl","experimental-webgl"];if(p.isWebGL1Renderer===!0&&fe.shift(),$=pe(fe,H),$===null)throw pe(fe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&$ instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),$.getShaderPrecisionFormat===void 0&&($.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H}let xe,Pe,ve,Ue,Le,Z,J,de,Ie,te,X,ye,ke,ge,De,$e,Ae,Ze,nt,rt,Oe,qe,it,at;function ht(){xe=new Cq($),Pe=new Sq($,xe,e),xe.init(Pe),qe=new Zz($,xe,Pe),ve=new cK($,xe,Pe),Ue=new Iq($),Le=new ZY,Z=new uK($,xe,ve,Le,Pe,qe,Ue),J=new Mq(p),de=new Tq(p),Ie=new BW($,Pe),it=new xq($,xe,Ie,Pe),te=new Pq($,Ie,Ue,it),X=new Fq($,te,Ie,Ue),nt=new Nq($,Pe,Z),$e=new wq(Le),ye=new KY(p,J,de,xe,Pe,it,$e),ke=new fK(p,Le),ge=new JY,De=new sK(xe,Pe),Ze=new yq(p,J,de,ve,X,d,l),Ae=new lK(p,X,Pe),at=new pK($,Ue,Pe,ve),rt=new bq($,xe,Ue,Pe),Oe=new Rq($,xe,Ue,Pe),Ue.programs=ye.programs,p.capabilities=Pe,p.extensions=xe,p.properties=Le,p.renderLists=ge,p.shadowMap=Ae,p.state=ve,p.info=Ue}ht();const Qe=new dK(p,$);this.xr=Qe,this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.forceContextLoss=function(){const H=xe.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){const H=xe.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(H){H!==void 0&&(z=H,this.setSize(F,V,!1))},this.getSize=function(H){return H.set(F,V)},this.setSize=function(H,fe,Me=!0){if(Qe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}F=H,V=fe,t.width=Math.floor(H*z),t.height=Math.floor(fe*z),Me===!0&&(t.style.width=H+"px",t.style.height=fe+"px"),this.setViewport(0,0,H,fe)},this.getDrawingBufferSize=function(H){return H.set(F*z,V*z).floor()},this.setDrawingBufferSize=function(H,fe,Me){F=H,V=fe,z=Me,t.width=Math.floor(H*Me),t.height=Math.floor(fe*Me),this.setViewport(0,0,H,fe)},this.getCurrentViewport=function(H){return H.copy(C)},this.getViewport=function(H){return H.copy(B)},this.setViewport=function(H,fe,Me,Se){H.isVector4?B.set(H.x,H.y,H.z,H.w):B.set(H,fe,Me,Se),ve.viewport(C.copy(B).multiplyScalar(z).floor())},this.getScissor=function(H){return H.copy(D)},this.setScissor=function(H,fe,Me,Se){H.isVector4?D.set(H.x,H.y,H.z,H.w):D.set(H,fe,Me,Se),ve.scissor(N.copy(D).multiplyScalar(z).floor())},this.getScissorTest=function(){return O},this.setScissorTest=function(H){ve.setScissorTest(O=H)},this.setOpaqueSort=function(H){U=H},this.setTransparentSort=function(H){G=H},this.getClearColor=function(H){return H.copy(Ze.getClearColor())},this.setClearColor=function(){Ze.setClearColor.apply(Ze,arguments)},this.getClearAlpha=function(){return Ze.getClearAlpha()},this.setClearAlpha=function(){Ze.setClearAlpha.apply(Ze,arguments)},this.clear=function(H=!0,fe=!0,Me=!0){let Se=0;if(H){let Te=!1;if(M!==null){const et=M.texture.format;Te=et===FP||et===NP||et===DP}if(Te){const et=M.texture.type,dt=et===rl||et===Yl||et===qb||et===fu||et===IP||et===LP,yt=Ze.getClearColor(),Ye=Ze.getClearAlpha(),We=yt.r,st=yt.g,ct=yt.b;dt?(f[0]=We,f[1]=st,f[2]=ct,f[3]=Ye,$.clearBufferuiv($.COLOR,0,f)):(m[0]=We,m[1]=st,m[2]=ct,m[3]=Ye,$.clearBufferiv($.COLOR,0,m))}else Se|=$.COLOR_BUFFER_BIT}fe&&(Se|=$.DEPTH_BUFFER_BIT),Me&&(Se|=$.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),$.clear(Se)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",je,!1),t.removeEventListener("webglcontextrestored",ee,!1),t.removeEventListener("webglcontextcreationerror",ze,!1),ge.dispose(),De.dispose(),Le.dispose(),J.dispose(),de.dispose(),X.dispose(),it.dispose(),at.dispose(),ye.dispose(),Qe.dispose(),Qe.removeEventListener("sessionstart",K),Qe.removeEventListener("sessionend",ae),ie&&(ie.dispose(),ie=null),ue.stop()};function je(H){H.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function ee(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const H=Ue.autoReset,fe=Ae.enabled,Me=Ae.autoUpdate,Se=Ae.needsUpdate,Te=Ae.type;ht(),Ue.autoReset=H,Ae.enabled=fe,Ae.autoUpdate=Me,Ae.needsUpdate=Se,Ae.type=Te}function ze(H){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",H.statusMessage)}function Ee(H){const fe=H.target;fe.removeEventListener("dispose",Ee),Re(fe)}function Re(H){Xe(H),Le.remove(H)}function Xe(H){const fe=Le.get(H).programs;fe!==void 0&&(fe.forEach(function(Me){ye.releaseProgram(Me)}),H.isShaderMaterial&&ye.releaseShaderCache(H))}this.renderBufferDirect=function(H,fe,Me,Se,Te,et){fe===null&&(fe=se);const dt=Te.isMesh&&Te.matrixWorld.determinant()<0,yt=zt(H,fe,Me,Se,Te);ve.setMaterial(Se,dt);let Ye=Me.index,We=1;if(Se.wireframe===!0){if(Ye=te.getWireframeAttribute(Me),Ye===void 0)return;We=2}const st=Me.drawRange,ct=Me.attributes.position;let Lt=st.start*We,Dt=(st.start+st.count)*We;et!==null&&(Lt=Math.max(Lt,et.start*We),Dt=Math.min(Dt,(et.start+et.count)*We)),Ye!==null?(Lt=Math.max(Lt,0),Dt=Math.min(Dt,Ye.count)):ct!=null&&(Lt=Math.max(Lt,0),Dt=Math.min(Dt,ct.count));const It=Dt-Lt;if(It<0||It===1/0)return;it.setup(Te,Se,yt,Me,Ye);let Ot,St=rt;if(Ye!==null&&(Ot=Ie.get(Ye),St=Oe,St.setIndex(Ot)),Te.isMesh)Se.wireframe===!0?(ve.setLineWidth(Se.wireframeLinewidth*oe()),St.setMode($.LINES)):St.setMode($.TRIANGLES);else if(Te.isLine){let vt=Se.linewidth;vt===void 0&&(vt=1),ve.setLineWidth(vt*oe()),Te.isLineSegments?St.setMode($.LINES):Te.isLineLoop?St.setMode($.LINE_LOOP):St.setMode($.LINE_STRIP)}else Te.isPoints?St.setMode($.POINTS):Te.isSprite&&St.setMode($.TRIANGLES);if(Te.isBatchedMesh)St.renderMultiDraw(Te._multiDrawStarts,Te._multiDrawCounts,Te._multiDrawCount);else if(Te.isInstancedMesh)St.renderInstances(Lt,It,Te.count);else if(Me.isInstancedBufferGeometry){const vt=Me._maxInstanceCount!==void 0?Me._maxInstanceCount:1/0,$t=Math.min(Me.instanceCount,vt);St.renderInstances(Lt,It,$t)}else St.render(Lt,It)};function gt(H,fe,Me){H.transparent===!0&&H.side===ts&&H.forceSinglePass===!1?(H.side=Ms,H.needsUpdate=!0,lt(H,fe,Me),H.side=ac,H.needsUpdate=!0,lt(H,fe,Me),H.side=ts):lt(H,fe,Me)}this.compile=function(H,fe,Me=null){Me===null&&(Me=H),v=De.get(Me),v.init(),b.push(v),Me.traverseVisible(function(Te){Te.isLight&&Te.layers.test(fe.layers)&&(v.pushLight(Te),Te.castShadow&&v.pushShadow(Te))}),H!==Me&&H.traverseVisible(function(Te){Te.isLight&&Te.layers.test(fe.layers)&&(v.pushLight(Te),Te.castShadow&&v.pushShadow(Te))}),v.setupLights(p._useLegacyLights);const Se=new Set;return H.traverse(function(Te){const et=Te.material;if(et)if(Array.isArray(et))for(let dt=0;dt<et.length;dt++){const yt=et[dt];gt(yt,Me,Te),Se.add(yt)}else gt(et,Me,Te),Se.add(et)}),b.pop(),v=null,Se},this.compileAsync=function(H,fe,Me=null){const Se=this.compile(H,fe,Me);return new Promise(Te=>{function et(){if(Se.forEach(function(dt){Le.get(dt).currentProgram.isReady()&&Se.delete(dt)}),Se.size===0){Te(H);return}setTimeout(et,10)}xe.get("KHR_parallel_shader_compile")!==null?et():setTimeout(et,10)})};let _t=null;function Mt(H){_t&&_t(H)}function K(){ue.stop()}function ae(){ue.start()}const ue=new $z;ue.setAnimationLoop(Mt),typeof self<"u"&&ue.setContext(self),this.setAnimationLoop=function(H){_t=H,Qe.setAnimationLoop(H),H===null?ue.stop():ue.start()},Qe.addEventListener("sessionstart",K),Qe.addEventListener("sessionend",ae),this.render=function(H,fe){if(fe!==void 0&&fe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),fe.parent===null&&fe.matrixWorldAutoUpdate===!0&&fe.updateMatrixWorld(),Qe.enabled===!0&&Qe.isPresenting===!0&&(Qe.cameraAutoUpdate===!0&&Qe.updateCamera(fe),fe=Qe.getCamera()),H.isScene===!0&&H.onBeforeRender(p,H,fe,M),v=De.get(H,b.length),v.init(),b.push(v),ne.multiplyMatrices(fe.projectionMatrix,fe.matrixWorldInverse),j.setFromProjectionMatrix(ne),Y=this.localClippingEnabled,q=$e.init(this.clippingPlanes,Y),_=ge.get(H,g.length),_.init(),g.push(_),_e(H,fe,0,p.sortObjects),_.finish(),p.sortObjects===!0&&_.sort(U,G),this.info.render.frame++,q===!0&&$e.beginShadows();const Me=v.state.shadowsArray;if(Ae.render(Me,H,fe),q===!0&&$e.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ze.render(_,H),v.setupLights(p._useLegacyLights),fe.isArrayCamera){const Se=fe.cameras;for(let Te=0,et=Se.length;Te<et;Te++){const dt=Se[Te];be(_,H,dt,dt.viewport)}}else be(_,H,fe);M!==null&&(Z.updateMultisampleRenderTarget(M),Z.updateRenderTargetMipmap(M)),H.isScene===!0&&H.onAfterRender(p,H,fe),it.resetDefaultState(),T=-1,E=null,b.pop(),b.length>0?v=b[b.length-1]:v=null,g.pop(),g.length>0?_=g[g.length-1]:_=null};function _e(H,fe,Me,Se){if(H.visible===!1)return;if(H.layers.test(fe.layers)){if(H.isGroup)Me=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(fe);else if(H.isLight)v.pushLight(H),H.castShadow&&v.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||j.intersectsSprite(H)){Se&&le.setFromMatrixPosition(H.matrixWorld).applyMatrix4(ne);const dt=X.update(H),yt=H.material;yt.visible&&_.push(H,dt,yt,Me,le.z,null)}}else if((H.isMesh||H.isLine||H.isPoints)&&(!H.frustumCulled||j.intersectsObject(H))){const dt=X.update(H),yt=H.material;if(Se&&(H.boundingSphere!==void 0?(H.boundingSphere===null&&H.computeBoundingSphere(),le.copy(H.boundingSphere.center)):(dt.boundingSphere===null&&dt.computeBoundingSphere(),le.copy(dt.boundingSphere.center)),le.applyMatrix4(H.matrixWorld).applyMatrix4(ne)),Array.isArray(yt)){const Ye=dt.groups;for(let We=0,st=Ye.length;We<st;We++){const ct=Ye[We],Lt=yt[ct.materialIndex];Lt&&Lt.visible&&_.push(H,dt,Lt,Me,le.z,ct)}}else yt.visible&&_.push(H,dt,yt,Me,le.z,null)}}const et=H.children;for(let dt=0,yt=et.length;dt<yt;dt++)_e(et[dt],fe,Me,Se)}function be(H,fe,Me,Se){const Te=H.opaque,et=H.transmissive,dt=H.transparent;v.setupLightsView(Me),q===!0&&$e.setGlobalState(p.clippingPlanes,Me),et.length>0&&Ne(Te,et,fe,Me),Se&&ve.viewport(C.copy(Se)),Te.length>0&&Be(Te,fe,Me),et.length>0&&Be(et,fe,Me),dt.length>0&&Be(dt,fe,Me),ve.buffers.depth.setTest(!0),ve.buffers.depth.setMask(!0),ve.buffers.color.setMask(!0),ve.setPolygonOffset(!1)}function Ne(H,fe,Me,Se){if((Me.isScene===!0?Me.overrideMaterial:null)!==null)return;const et=Pe.isWebGL2;ie===null&&(ie=new Na(1,1,{generateMipmaps:!0,type:xe.has("EXT_color_buffer_half_float")?Ip:rl,minFilter:Mu,samples:et?4:0})),p.getDrawingBufferSize(Q),et?ie.setSize(Q.x,Q.y):ie.setSize(Qx(Q.x),Qx(Q.y));const dt=p.getRenderTarget();p.setRenderTarget(ie),p.getClearColor(L),R=p.getClearAlpha(),R<1&&p.setClearColor(16777215,.5),p.clear();const yt=p.toneMapping;p.toneMapping=il,Be(H,Me,Se),Z.updateMultisampleRenderTarget(ie),Z.updateRenderTargetMipmap(ie);let Ye=!1;for(let We=0,st=fe.length;We<st;We++){const ct=fe[We],Lt=ct.object,Dt=ct.geometry,It=ct.material,Ot=ct.group;if(It.side===ts&&Lt.layers.test(Se.layers)){const St=It.side;It.side=Ms,It.needsUpdate=!0,He(Lt,Me,Se,Dt,It,Ot),It.side=St,It.needsUpdate=!0,Ye=!0}}Ye===!0&&(Z.updateMultisampleRenderTarget(ie),Z.updateRenderTargetMipmap(ie)),p.setRenderTarget(dt),p.setClearColor(L,R),p.toneMapping=yt}function Be(H,fe,Me){const Se=fe.isScene===!0?fe.overrideMaterial:null;for(let Te=0,et=H.length;Te<et;Te++){const dt=H[Te],yt=dt.object,Ye=dt.geometry,We=Se===null?dt.material:Se,st=dt.group;yt.layers.test(Me.layers)&&He(yt,fe,Me,Ye,We,st)}}function He(H,fe,Me,Se,Te,et){H.onBeforeRender(p,fe,Me,Se,Te,et),H.modelViewMatrix.multiplyMatrices(Me.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),Te.onBeforeRender(p,fe,Me,Se,H,et),Te.transparent===!0&&Te.side===ts&&Te.forceSinglePass===!1?(Te.side=Ms,Te.needsUpdate=!0,p.renderBufferDirect(Me,fe,Se,Te,H,et),Te.side=ac,Te.needsUpdate=!0,p.renderBufferDirect(Me,fe,Se,Te,H,et),Te.side=ts):p.renderBufferDirect(Me,fe,Se,Te,H,et),H.onAfterRender(p,fe,Me,Se,Te,et)}function lt(H,fe,Me){fe.isScene!==!0&&(fe=se);const Se=Le.get(H),Te=v.state.lights,et=v.state.shadowsArray,dt=Te.state.version,yt=ye.getParameters(H,Te.state,et,fe,Me),Ye=ye.getProgramCacheKey(yt);let We=Se.programs;Se.environment=H.isMeshStandardMaterial?fe.environment:null,Se.fog=fe.fog,Se.envMap=(H.isMeshStandardMaterial?de:J).get(H.envMap||Se.environment),We===void 0&&(H.addEventListener("dispose",Ee),We=new Map,Se.programs=We);let st=We.get(Ye);if(st!==void 0){if(Se.currentProgram===st&&Se.lightsStateVersion===dt)return wt(H,yt),st}else yt.uniforms=ye.getUniforms(H),H.onBuild(Me,yt,p),H.onBeforeCompile(yt,p),st=ye.acquireProgram(yt,Ye),We.set(Ye,st),Se.uniforms=yt.uniforms;const ct=Se.uniforms;return(!H.isShaderMaterial&&!H.isRawShaderMaterial||H.clipping===!0)&&(ct.clippingPlanes=$e.uniform),wt(H,yt),Se.needsLights=bt(H),Se.lightsStateVersion=dt,Se.needsLights&&(ct.ambientLightColor.value=Te.state.ambient,ct.lightProbe.value=Te.state.probe,ct.directionalLights.value=Te.state.directional,ct.directionalLightShadows.value=Te.state.directionalShadow,ct.spotLights.value=Te.state.spot,ct.spotLightShadows.value=Te.state.spotShadow,ct.rectAreaLights.value=Te.state.rectArea,ct.ltc_1.value=Te.state.rectAreaLTC1,ct.ltc_2.value=Te.state.rectAreaLTC2,ct.pointLights.value=Te.state.point,ct.pointLightShadows.value=Te.state.pointShadow,ct.hemisphereLights.value=Te.state.hemi,ct.directionalShadowMap.value=Te.state.directionalShadowMap,ct.directionalShadowMatrix.value=Te.state.directionalShadowMatrix,ct.spotShadowMap.value=Te.state.spotShadowMap,ct.spotLightMatrix.value=Te.state.spotLightMatrix,ct.spotLightMap.value=Te.state.spotLightMap,ct.pointShadowMap.value=Te.state.pointShadowMap,ct.pointShadowMatrix.value=Te.state.pointShadowMatrix),Se.currentProgram=st,Se.uniformsList=null,st}function mt(H){if(H.uniformsList===null){const fe=H.currentProgram.getUniforms();H.uniformsList=sx.seqWithValue(fe.seq,H.uniforms)}return H.uniformsList}function wt(H,fe){const Me=Le.get(H);Me.outputColorSpace=fe.outputColorSpace,Me.batching=fe.batching,Me.instancing=fe.instancing,Me.instancingColor=fe.instancingColor,Me.skinning=fe.skinning,Me.morphTargets=fe.morphTargets,Me.morphNormals=fe.morphNormals,Me.morphColors=fe.morphColors,Me.morphTargetsCount=fe.morphTargetsCount,Me.numClippingPlanes=fe.numClippingPlanes,Me.numIntersection=fe.numClipIntersection,Me.vertexAlphas=fe.vertexAlphas,Me.vertexTangents=fe.vertexTangents,Me.toneMapping=fe.toneMapping}function zt(H,fe,Me,Se,Te){fe.isScene!==!0&&(fe=se),Z.resetTextureUnits();const et=fe.fog,dt=Se.isMeshStandardMaterial?fe.environment:null,yt=M===null?p.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:hl,Ye=(Se.isMeshStandardMaterial?de:J).get(Se.envMap||dt),We=Se.vertexColors===!0&&!!Me.attributes.color&&Me.attributes.color.itemSize===4,st=!!Me.attributes.tangent&&(!!Se.normalMap||Se.anisotropy>0),ct=!!Me.morphAttributes.position,Lt=!!Me.morphAttributes.normal,Dt=!!Me.morphAttributes.color;let It=il;Se.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(It=p.toneMapping);const Ot=Me.morphAttributes.position||Me.morphAttributes.normal||Me.morphAttributes.color,St=Ot!==void 0?Ot.length:0,vt=Le.get(Se),$t=v.state.lights;if(q===!0&&(Y===!0||H!==E)){const hn=H===E&&Se.id===T;$e.setState(Se,H,hn)}let Rt=!1;Se.version===vt.__version?(vt.needsLights&&vt.lightsStateVersion!==$t.state.version||vt.outputColorSpace!==yt||Te.isBatchedMesh&&vt.batching===!1||!Te.isBatchedMesh&&vt.batching===!0||Te.isInstancedMesh&&vt.instancing===!1||!Te.isInstancedMesh&&vt.instancing===!0||Te.isSkinnedMesh&&vt.skinning===!1||!Te.isSkinnedMesh&&vt.skinning===!0||Te.isInstancedMesh&&vt.instancingColor===!0&&Te.instanceColor===null||Te.isInstancedMesh&&vt.instancingColor===!1&&Te.instanceColor!==null||vt.envMap!==Ye||Se.fog===!0&&vt.fog!==et||vt.numClippingPlanes!==void 0&&(vt.numClippingPlanes!==$e.numPlanes||vt.numIntersection!==$e.numIntersection)||vt.vertexAlphas!==We||vt.vertexTangents!==st||vt.morphTargets!==ct||vt.morphNormals!==Lt||vt.morphColors!==Dt||vt.toneMapping!==It||Pe.isWebGL2===!0&&vt.morphTargetsCount!==St)&&(Rt=!0):(Rt=!0,vt.__version=Se.version);let vn=vt.currentProgram;Rt===!0&&(vn=lt(Se,fe,Te));let vi=!1,$n=!1,Pn=!1;const Jt=vn.getUniforms(),Wn=vt.uniforms;if(ve.useProgram(vn.program)&&(vi=!0,$n=!0,Pn=!0),Se.id!==T&&(T=Se.id,$n=!0),vi||E!==H){Jt.setValue($,"projectionMatrix",H.projectionMatrix),Jt.setValue($,"viewMatrix",H.matrixWorldInverse);const hn=Jt.map.cameraPosition;hn!==void 0&&hn.setValue($,le.setFromMatrixPosition(H.matrixWorld)),Pe.logarithmicDepthBuffer&&Jt.setValue($,"logDepthBufFC",2/(Math.log(H.far+1)/Math.LN2)),(Se.isMeshPhongMaterial||Se.isMeshToonMaterial||Se.isMeshLambertMaterial||Se.isMeshBasicMaterial||Se.isMeshStandardMaterial||Se.isShaderMaterial)&&Jt.setValue($,"isOrthographic",H.isOrthographicCamera===!0),E!==H&&(E=H,$n=!0,Pn=!0)}if(Te.isSkinnedMesh){Jt.setOptional($,Te,"bindMatrix"),Jt.setOptional($,Te,"bindMatrixInverse");const hn=Te.skeleton;hn&&(Pe.floatVertexTextures?(hn.boneTexture===null&&hn.computeBoneTexture(),Jt.setValue($,"boneTexture",hn.boneTexture,Z)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}Te.isBatchedMesh&&(Jt.setOptional($,Te,"batchingTexture"),Jt.setValue($,"batchingTexture",Te._matricesTexture,Z));const $i=Me.morphAttributes;if(($i.position!==void 0||$i.normal!==void 0||$i.color!==void 0&&Pe.isWebGL2===!0)&&nt.update(Te,Me,vn),($n||vt.receiveShadow!==Te.receiveShadow)&&(vt.receiveShadow=Te.receiveShadow,Jt.setValue($,"receiveShadow",Te.receiveShadow)),Se.isMeshGouraudMaterial&&Se.envMap!==null&&(Wn.envMap.value=Ye,Wn.flipEnvMap.value=Ye.isCubeTexture&&Ye.isRenderTargetTexture===!1?-1:1),$n&&(Jt.setValue($,"toneMappingExposure",p.toneMappingExposure),vt.needsLights&&Et(Wn,Pn),et&&Se.fog===!0&&ke.refreshFogUniforms(Wn,et),ke.refreshMaterialUniforms(Wn,Se,z,V,ie),sx.upload($,mt(vt),Wn,Z)),Se.isShaderMaterial&&Se.uniformsNeedUpdate===!0&&(sx.upload($,mt(vt),Wn,Z),Se.uniformsNeedUpdate=!1),Se.isSpriteMaterial&&Jt.setValue($,"center",Te.center),Jt.setValue($,"modelViewMatrix",Te.modelViewMatrix),Jt.setValue($,"normalMatrix",Te.normalMatrix),Jt.setValue($,"modelMatrix",Te.matrixWorld),Se.isShaderMaterial||Se.isRawShaderMaterial){const hn=Se.uniformsGroups;for(let Yn=0,Wi=hn.length;Yn<Wi;Yn++)if(Pe.isWebGL2){const pr=hn[Yn];at.update(pr,vn),at.bind(pr,vn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return vn}function Et(H,fe){H.ambientLightColor.needsUpdate=fe,H.lightProbe.needsUpdate=fe,H.directionalLights.needsUpdate=fe,H.directionalLightShadows.needsUpdate=fe,H.pointLights.needsUpdate=fe,H.pointLightShadows.needsUpdate=fe,H.spotLights.needsUpdate=fe,H.spotLightShadows.needsUpdate=fe,H.rectAreaLights.needsUpdate=fe,H.hemisphereLights.needsUpdate=fe}function bt(H){return H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&H.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(H,fe,Me){Le.get(H.texture).__webglTexture=fe,Le.get(H.depthTexture).__webglTexture=Me;const Se=Le.get(H);Se.__hasExternalTextures=!0,Se.__hasExternalTextures&&(Se.__autoAllocateDepthBuffer=Me===void 0,Se.__autoAllocateDepthBuffer||xe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Se.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(H,fe){const Me=Le.get(H);Me.__webglFramebuffer=fe,Me.__useDefaultFramebuffer=fe===void 0},this.setRenderTarget=function(H,fe=0,Me=0){M=H,A=fe,w=Me;let Se=!0,Te=null,et=!1,dt=!1;if(H){const Ye=Le.get(H);Ye.__useDefaultFramebuffer!==void 0?(ve.bindFramebuffer($.FRAMEBUFFER,null),Se=!1):Ye.__webglFramebuffer===void 0?Z.setupRenderTarget(H):Ye.__hasExternalTextures&&Z.rebindTextures(H,Le.get(H.texture).__webglTexture,Le.get(H.depthTexture).__webglTexture);const We=H.texture;(We.isData3DTexture||We.isDataArrayTexture||We.isCompressedArrayTexture)&&(dt=!0);const st=Le.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(Array.isArray(st[fe])?Te=st[fe][Me]:Te=st[fe],et=!0):Pe.isWebGL2&&H.samples>0&&Z.useMultisampledRTT(H)===!1?Te=Le.get(H).__webglMultisampledFramebuffer:Array.isArray(st)?Te=st[Me]:Te=st,C.copy(H.viewport),N.copy(H.scissor),P=H.scissorTest}else C.copy(B).multiplyScalar(z).floor(),N.copy(D).multiplyScalar(z).floor(),P=O;if(ve.bindFramebuffer($.FRAMEBUFFER,Te)&&Pe.drawBuffers&&Se&&ve.drawBuffers(H,Te),ve.viewport(C),ve.scissor(N),ve.setScissorTest(P),et){const Ye=Le.get(H.texture);$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Ye.__webglTexture,Me)}else if(dt){const Ye=Le.get(H.texture),We=fe||0;$.framebufferTextureLayer($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,Ye.__webglTexture,Me||0,We)}T=-1},this.readRenderTargetPixels=function(H,fe,Me,Se,Te,et,dt){if(!(H&&H.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let yt=Le.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&dt!==void 0&&(yt=yt[dt]),yt){ve.bindFramebuffer($.FRAMEBUFFER,yt);try{const Ye=H.texture,We=Ye.format,st=Ye.type;if(We!==Ss&&qe.convert(We)!==$.getParameter($.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ct=st===Ip&&(xe.has("EXT_color_buffer_half_float")||Pe.isWebGL2&&xe.has("EXT_color_buffer_float"));if(st!==rl&&qe.convert(st)!==$.getParameter($.IMPLEMENTATION_COLOR_READ_TYPE)&&!(st===Ea&&(Pe.isWebGL2||xe.has("OES_texture_float")||xe.has("WEBGL_color_buffer_float")))&&!ct){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}fe>=0&&fe<=H.width-Se&&Me>=0&&Me<=H.height-Te&&$.readPixels(fe,Me,Se,Te,qe.convert(We),qe.convert(st),et)}finally{const Ye=M!==null?Le.get(M).__webglFramebuffer:null;ve.bindFramebuffer($.FRAMEBUFFER,Ye)}}},this.copyFramebufferToTexture=function(H,fe,Me=0){const Se=Math.pow(2,-Me),Te=Math.floor(fe.image.width*Se),et=Math.floor(fe.image.height*Se);Z.setTexture2D(fe,0),$.copyTexSubImage2D($.TEXTURE_2D,Me,0,0,H.x,H.y,Te,et),ve.unbindTexture()},this.copyTextureToTexture=function(H,fe,Me,Se=0){const Te=fe.image.width,et=fe.image.height,dt=qe.convert(Me.format),yt=qe.convert(Me.type);Z.setTexture2D(Me,0),$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,Me.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Me.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,Me.unpackAlignment),fe.isDataTexture?$.texSubImage2D($.TEXTURE_2D,Se,H.x,H.y,Te,et,dt,yt,fe.image.data):fe.isCompressedTexture?$.compressedTexSubImage2D($.TEXTURE_2D,Se,H.x,H.y,fe.mipmaps[0].width,fe.mipmaps[0].height,dt,fe.mipmaps[0].data):$.texSubImage2D($.TEXTURE_2D,Se,H.x,H.y,dt,yt,fe.image),Se===0&&Me.generateMipmaps&&$.generateMipmap($.TEXTURE_2D),ve.unbindTexture()},this.copyTextureToTexture3D=function(H,fe,Me,Se,Te=0){if(p.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const et=H.max.x-H.min.x+1,dt=H.max.y-H.min.y+1,yt=H.max.z-H.min.z+1,Ye=qe.convert(Se.format),We=qe.convert(Se.type);let st;if(Se.isData3DTexture)Z.setTexture3D(Se,0),st=$.TEXTURE_3D;else if(Se.isDataArrayTexture||Se.isCompressedArrayTexture)Z.setTexture2DArray(Se,0),st=$.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,Se.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Se.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,Se.unpackAlignment);const ct=$.getParameter($.UNPACK_ROW_LENGTH),Lt=$.getParameter($.UNPACK_IMAGE_HEIGHT),Dt=$.getParameter($.UNPACK_SKIP_PIXELS),It=$.getParameter($.UNPACK_SKIP_ROWS),Ot=$.getParameter($.UNPACK_SKIP_IMAGES),St=Me.isCompressedTexture?Me.mipmaps[Te]:Me.image;$.pixelStorei($.UNPACK_ROW_LENGTH,St.width),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,St.height),$.pixelStorei($.UNPACK_SKIP_PIXELS,H.min.x),$.pixelStorei($.UNPACK_SKIP_ROWS,H.min.y),$.pixelStorei($.UNPACK_SKIP_IMAGES,H.min.z),Me.isDataTexture||Me.isData3DTexture?$.texSubImage3D(st,Te,fe.x,fe.y,fe.z,et,dt,yt,Ye,We,St.data):Me.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),$.compressedTexSubImage3D(st,Te,fe.x,fe.y,fe.z,et,dt,yt,Ye,St.data)):$.texSubImage3D(st,Te,fe.x,fe.y,fe.z,et,dt,yt,Ye,We,St),$.pixelStorei($.UNPACK_ROW_LENGTH,ct),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,Lt),$.pixelStorei($.UNPACK_SKIP_PIXELS,Dt),$.pixelStorei($.UNPACK_SKIP_ROWS,It),$.pixelStorei($.UNPACK_SKIP_IMAGES,Ot),Te===0&&Se.generateMipmaps&&$.generateMipmap(st),ve.unbindTexture()},this.initTexture=function(H){H.isCubeTexture?Z.setTextureCube(H,0):H.isData3DTexture?Z.setTexture3D(H,0):H.isDataArrayTexture||H.isCompressedArrayTexture?Z.setTexture2DArray(H,0):Z.setTexture2D(H,0),ve.unbindTexture()},this.resetState=function(){A=0,w=0,M=null,ve.reset(),it.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ta}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Kb?"display-p3":"srgb",t.unpackColorSpace=On.workingColorSpace===h1?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===lr?mu:OP}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===mu?lr:hl}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}},Jz=class extends YP{};Jz.prototype.isWebGL1Renderer=!0;class tS{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new kt(e),this.density=t}clone(){return new tS(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}let e6=class t6{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new kt(e),this.near=t,this.far=n}clone(){return new t6(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}},KP=class extends qn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}};class nS{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=U0,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=bo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=bo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=bo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ps=new Ce;class sd{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)ps.fromBufferAttribute(this,t),ps.applyMatrix4(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ps.fromBufferAttribute(this,t),ps.applyNormalMatrix(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ps.fromBufferAttribute(this,t),ps.transformDirection(e),this.setXYZ(t,ps.x,ps.y,ps.z);return this}setX(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=fn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=$s(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=$s(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=$s(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=$s(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),r=fn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=fn(t,this.array),n=fn(n,this.array),r=fn(r,this.array),s=fn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new En(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new sd(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ZP extends Or{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new kt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let ef;const Xm=new Ce,tf=new Ce,nf=new Ce,rf=new xt,qm=new xt,n6=new nn,l_=new Ce,Ym=new Ce,c_=new Ce,CD=new xt,Rw=new xt,PD=new xt;class i6 extends qn{constructor(e=new ZP){if(super(),this.isSprite=!0,this.type="Sprite",ef===void 0){ef=new xn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new nS(t,5);ef.setIndex([0,1,2,0,2,3]),ef.setAttribute("position",new sd(n,3,0,!1)),ef.setAttribute("uv",new sd(n,2,3,!1))}this.geometry=ef,this.material=e,this.center=new xt(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),tf.setFromMatrixScale(this.matrixWorld),n6.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),nf.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&tf.multiplyScalar(-nf.z);const n=this.material.rotation;let r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));const o=this.center;u_(l_.set(-.5,-.5,0),nf,o,tf,r,s),u_(Ym.set(.5,-.5,0),nf,o,tf,r,s),u_(c_.set(.5,.5,0),nf,o,tf,r,s),CD.set(0,0),Rw.set(1,0),PD.set(1,1);let a=e.ray.intersectTriangle(l_,Ym,c_,!1,Xm);if(a===null&&(u_(Ym.set(-.5,.5,0),nf,o,tf,r,s),Rw.set(0,1),a=e.ray.intersectTriangle(l_,c_,Ym,!1,Xm),a===null))return;const l=e.ray.origin.distanceTo(Xm);l<e.near||l>e.far||t.push({distance:l,point:Xm.clone(),uv:Fh.getInterpolation(Xm,l_,Ym,c_,CD,Rw,PD,new xt),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function u_(i,e,t,n,r,s){rf.subVectors(i,t).addScalar(.5).multiply(n),r!==void 0?(qm.x=s*rf.x-r*rf.y,qm.y=r*rf.x+s*rf.y):qm.copy(rf),i.copy(e),i.x+=qm.x,i.y+=qm.y,i.applyMatrix4(n6)}const h_=new Ce,RD=new Ce;class r6 extends qn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,r=t.length;n<r;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let s=t[n].distance;if(t[n].object.visible&&(s-=s*t[n].hysteresis),e<s)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){h_.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(h_);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){h_.setFromMatrixPosition(e.matrixWorld),RD.setFromMatrixPosition(this.matrixWorld);const n=h_.distanceTo(RD)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s;r++){let o=t[r].distance;if(t[r].object.visible&&(o-=o*t[r].hysteresis),n>=o)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let r=0,s=n.length;r<s;r++){const o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const ID=new Ce,LD=new Gn,DD=new Gn,mK=new Ce,ND=new nn,d_=new Ce,Iw=new kr,FD=new nn,Lw=new Qp;class s6 extends gi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=XE,this.bindMatrix=new nn,this.bindMatrixInverse=new nn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Fr),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,d_),this.boundingBox.expandByPoint(d_)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new kr),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,d_),this.boundingSphere.expandByPoint(d_)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Iw.copy(this.boundingSphere),Iw.applyMatrix4(r),e.ray.intersectsSphere(Iw)!==!1&&(FD.copy(r).invert(),Lw.copy(e.ray).applyMatrix4(FD),!(this.boundingBox!==null&&Lw.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Lw)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Gn,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===XE?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===cz?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;LD.fromBufferAttribute(r.attributes.skinIndex,e),DD.fromBufferAttribute(r.attributes.skinWeight,e),ID.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=DD.getComponent(s);if(o!==0){const a=LD.getComponent(s);ND.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(mK.copy(ID).applyMatrix4(ND),o)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class QP extends qn{constructor(){super(),this.isBone=!0,this.type="Bone"}}let Hh=class extends Tr{constructor(e=null,t=1,n=1,r,s,o,a,l,c=Gi,u=Gi,h,d){super(null,o,a,l,c,u,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const kD=new nn,gK=new nn;class iS{constructor(e=[],t=[]){this.uuid=bo(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new nn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new nn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:gK;kD.multiplyMatrices(a,t[s]),kD.toArray(n,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new iS(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Hh(t,e,e,Ss,Ea);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const s=e.bones[n];let o=t[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new QP),this.bones.push(o),this.boneInverses.push(new nn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=n[r];e.boneInverses.push(a.toArray())}return e}}class od extends En{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const sf=new nn,UD=new nn,f_=[],OD=new Fr,vK=new nn,Km=new gi,Zm=new kr;class o6 extends gi{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new od(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<n;r++)this.setMatrixAt(r,vK)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Fr),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,sf),OD.copy(e.boundingBox).applyMatrix4(sf),this.boundingBox.union(OD)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new kr),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,sf),Zm.copy(e.boundingSphere).applyMatrix4(sf),this.boundingSphere.union(Zm)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(Km.geometry=this.geometry,Km.material=this.material,Km.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Zm.copy(this.boundingSphere),Zm.applyMatrix4(n),e.ray.intersectsSphere(Zm)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,sf),UD.multiplyMatrices(n,sf),Km.matrixWorld=UD,Km.raycast(e,f_);for(let o=0,a=f_.length;o<a;o++){const l=f_[o];l.instanceId=s,l.object=this,t.push(l)}f_.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new od(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function _K(i,e){return i.z-e.z}function yK(i,e){return e.z-i.z}class xK{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const n=this.pool,r=this.list;this.index>=n.length&&n.push({start:-1,count:-1,z:-1});const s=n[this.index];r.push(s),this.index++,s.start=e.start,s.count=e.count,s.z=t}reset(){this.list.length=0,this.index=0}}const of="batchId",Fc=new nn,BD=new nn,bK=new nn,zD=new nn,Dw=new g1,p_=new Fr,th=new kr,Qm=new Ce,Nw=new xK,Yr=new gi,m_=[];function SK(i,e,t=0){const n=e.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==e.array.constructor){const r=i.count;for(let s=0;s<r;s++)for(let o=0;o<n;o++)e.setComponent(s+t,o,i.getComponent(s,o))}else e.array.set(i.array,t*n);e.needsUpdate=!0}class a6 extends gi{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,n=t*2,r){super(new xn,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new Hh(t,e,e,Ss,Ea);this._matricesTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxGeometryCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const a in e.attributes){const l=e.getAttribute(a),{array:c,itemSize:u,normalized:h}=l,d=new c.constructor(n*u),f=new l.constructor(d,u,h);f.setUsage(l.usage),t.setAttribute(a,f)}if(e.getIndex()!==null){const a=n>65536?new Uint32Array(s):new Uint16Array(s);t.setIndex(new En(a,1))}const o=r>65536?new Uint32Array(n):new Uint16Array(n);t.setAttribute(of,new En(o,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(of))throw new Error(`BatchedMesh: Geometry cannot use attribute "${of}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(n===of)continue;if(!e.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),s=t.getAttribute(n);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Fr);const e=this._geometryCount,t=this.boundingBox,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)n[r]!==!1&&(this.getMatrixAt(r,Fc),this.getBoundingBoxAt(r,p_).applyMatrix4(Fc),t.union(p_))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new kr);const e=this._geometryCount,t=this.boundingSphere,n=this._active;t.makeEmpty();for(let r=0;r<e;r++)n[r]!==!1&&(this.getMatrixAt(r,Fc),this.getBoundingSphereAt(r,th).applyMatrix4(Fc),t.union(th))}addGeometry(e,t=-1,n=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const r={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let s=null;const o=this._reservedRanges,a=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(s=o[o.length-1]),t===-1?r.vertexCount=e.getAttribute("position").count:r.vertexCount=t,s===null?r.vertexStart=0:r.vertexStart=s.vertexStart+s.vertexCount;const c=e.getIndex(),u=c!==null;if(u&&(n===-1?r.indexCount=c.count:r.indexCount=n,s===null?r.indexStart=0:r.indexStart=s.indexStart+s.indexCount),r.indexStart!==-1&&r.indexStart+r.indexCount>this._maxIndexCount||r.vertexStart+r.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._visibility,d=this._active,f=this._matricesTexture,m=this._matricesTexture.image.data;h.push(!0),d.push(!0);const _=this._geometryCount;this._geometryCount++,bK.toArray(m,_*16),f.needsUpdate=!0,o.push(r),a.push({start:u?r.indexStart:r.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new Fr,sphereInitialized:!1,sphere:new kr});const v=this.geometry.getAttribute(of);for(let g=0;g<r.vertexCount;g++)v.setX(r.vertexStart+g,_);return v.needsUpdate=!0,this.setGeometryAt(_,e),_}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=n.getIndex()!==null,s=n.getIndex(),o=t.getIndex(),a=this._reservedRanges[e];if(r&&o.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.vertexCount;for(const f in n.attributes){if(f===of)continue;const m=t.getAttribute(f),_=n.getAttribute(f);SK(m,_,l);const v=m.itemSize;for(let g=m.count,b=c;g<b;g++){const p=l+g;for(let y=0;y<v;y++)_.setComponent(p,y,0)}_.needsUpdate=!0}if(r){const f=a.indexStart;for(let m=0;m<o.count;m++)s.setX(f+m,l+o.getX(m));for(let m=o.count,_=a.indexCount;m<_;m++)s.setX(f+m,l);s.needsUpdate=!0}const u=this._bounds[e];t.boundingBox!==null?(u.box.copy(t.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,t.boundingSphere!==null?(u.sphere.copy(t.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;const h=this._drawRanges[e],d=t.getAttribute("position");return h.count=r?o.count:d.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1?this:(t[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(this._active[e]===!1)return this;const r=this._bounds[e],s=r.box,o=this.geometry;if(r.boxInitialized===!1){s.makeEmpty();const a=o.index,l=o.attributes.position,c=this._drawRanges[e];for(let u=c.start,h=c.start+c.count;u<h;u++){let d=u;a&&(d=a.getX(d)),s.expandByPoint(Qm.fromBufferAttribute(l,d))}r.boxInitialized=!0}return t.copy(s),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return this;const r=this._bounds[e],s=r.sphere,o=this.geometry;if(r.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(e,p_),p_.getCenter(s.center);const a=o.index,l=o.attributes.position,c=this._drawRanges[e];let u=0;for(let h=c.start,d=c.start+c.count;h<d;h++){let f=h;a&&(f=a.getX(f)),Qm.fromBufferAttribute(l,f),u=Math.max(u,s.center.distanceToSquared(Qm))}s.radius=Math.sqrt(u),r.sphereInitialized=!0}return t.copy(s),t}setMatrixAt(e,t){const n=this._active,r=this._matricesTexture,s=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||n[e]===!1?this:(t.toArray(s,e*16),r.needsUpdate=!0,this)}getMatrixAt(e,t){const n=this._active,r=this._matricesTexture.image.data,s=this._geometryCount;return e>=s||n[e]===!1?null:t.fromArray(r,e*16)}setVisibleAt(e,t){const n=this._visibility,r=this._active,s=this._geometryCount;return e>=s||r[e]===!1||n[e]===t?this:(n[e]=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._visibility,n=this._active,r=this._geometryCount;return e>=r||n[e]===!1?!1:t[e]}raycast(e,t){const n=this._visibility,r=this._active,s=this._drawRanges,o=this._geometryCount,a=this.matrixWorld,l=this.geometry;Yr.material=this.material,Yr.geometry.index=l.index,Yr.geometry.attributes=l.attributes,Yr.geometry.boundingBox===null&&(Yr.geometry.boundingBox=new Fr),Yr.geometry.boundingSphere===null&&(Yr.geometry.boundingSphere=new kr);for(let c=0;c<o;c++){if(!n[c]||!r[c])continue;const u=s[c];Yr.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(c,Yr.matrixWorld).premultiply(a),this.getBoundingBoxAt(c,Yr.geometry.boundingBox),this.getBoundingSphereAt(c,Yr.geometry.boundingSphere),Yr.raycast(e,m_);for(let h=0,d=m_.length;h<d;h++){const f=m_[h];f.object=this,f.batchId=c,t.push(f)}m_.length=0}Yr.material=null,Yr.geometry.index=null,Yr.geometry.attributes={},Yr.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,n,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=r.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._visibility,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._drawRanges,d=this.perObjectFrustumCulled;d&&(zD.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),Dw.setFromProjectionMatrix(zD,e.isWebGPURenderer?Lp:Ta));let f=0;if(this.sortObjects){BD.copy(this.matrixWorld).invert(),Qm.setFromMatrixPosition(n.matrixWorld).applyMatrix4(BD);for(let v=0,g=l.length;v<g;v++)if(l[v]){this.getMatrixAt(v,Fc),this.getBoundingSphereAt(v,th).applyMatrix4(Fc);let b=!1;if(d&&(b=!Dw.intersectsSphere(th)),!b){const p=Qm.distanceTo(th.center);Nw.push(h[v],p)}}const m=Nw.list,_=this.customSort;_===null?m.sort(s.transparent?yK:_K):_.call(this,m,n);for(let v=0,g=m.length;v<g;v++){const b=m[v];c[f]=b.start*a,u[f]=b.count,f++}Nw.reset()}else for(let m=0,_=l.length;m<_;m++)if(l[m]){let v=!1;if(d&&(this.getMatrixAt(m,Fc),this.getBoundingSphereAt(m,th).applyMatrix4(Fc),v=!Dw.intersectsSphere(th)),!v){const g=h[m];c[f]=g.start*a,u[f]=g.count,f++}}this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,s,o){this.onBeforeRender(e,null,r,s,o)}}let Is=class extends Or{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new kt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}};const GD=new Ce,VD=new Ce,HD=new nn,Fw=new Qp,g_=new kr;let Au=class extends qn{constructor(e=new xn,t=new Is){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)GD.fromBufferAttribute(t,r-1),VD.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=GD.distanceTo(VD);e.setAttribute("lineDistance",new Wt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),g_.copy(n.boundingSphere),g_.applyMatrix4(r),g_.radius+=s,e.ray.intersectsSphere(g_)===!1)return;HD.copy(r).invert(),Fw.copy(e.ray).applyMatrix4(HD);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new Ce,u=new Ce,h=new Ce,d=new Ce,f=this.isLineSegments?2:1,m=n.index,v=n.attributes.position;if(m!==null){const g=Math.max(0,o.start),b=Math.min(m.count,o.start+o.count);for(let p=g,y=b-1;p<y;p+=f){const A=m.getX(p),w=m.getX(p+1);if(c.fromBufferAttribute(v,A),u.fromBufferAttribute(v,w),Fw.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const T=e.ray.origin.distanceTo(d);T<e.near||T>e.far||t.push({distance:T,point:h.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this})}}else{const g=Math.max(0,o.start),b=Math.min(v.count,o.start+o.count);for(let p=g,y=b-1;p<y;p+=f){if(c.fromBufferAttribute(v,p),u.fromBufferAttribute(v,p+1),Fw.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const w=e.ray.origin.distanceTo(d);w<e.near||w>e.far||t.push({distance:w,point:h.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};const $D=new Ce,WD=new Ce;let ml=class extends Au{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,s=t.count;r<s;r+=2)$D.fromBufferAttribute(t,r),WD.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+$D.distanceTo(WD);e.setAttribute("lineDistance",new Wt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}};class l6 extends Au{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}let JP=class extends Or{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new kt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}};const jD=new nn,AT=new Qp,v_=new kr,__=new Ce;let c6=class extends qn{constructor(e=new xn,t=new JP){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),v_.copy(n.boundingSphere),v_.applyMatrix4(r),v_.radius+=s,e.ray.intersectsSphere(v_)===!1)return;jD.copy(r).invert(),AT.copy(e.ray).applyMatrix4(jD);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=n.index,h=n.attributes.position;if(c!==null){const d=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let m=d,_=f;m<_;m++){const v=c.getX(m);__.fromBufferAttribute(h,v),XD(__,v,l,r,e,t,this)}}else{const d=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let m=d,_=f;m<_;m++)__.fromBufferAttribute(h,m),XD(__,m,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};function XD(i,e,t,n,r,s,o){const a=AT.distanceSqToPoint(i);if(a<t){const l=new Ce;AT.closestPointToPoint(i,l),l.applyMatrix4(n);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class wK extends Tr{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Mi,this.magFilter=s!==void 0?s:Mi,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class MK extends Tr{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Gi,this.minFilter=Gi,this.generateMipmaps=!1,this.needsUpdate=!0}}class rS extends Tr{constructor(e,t,n,r,s,o,a,l,c,u,h,d){super(null,o,a,l,c,u,r,s,h,d),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class AK extends rS{constructor(e,t,n,r,s,o){super(e,t,n,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=ns}}class EK extends rS{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,lc),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}let u6=class extends Tr{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}};class Fa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=n[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,n[r]===o)return r/(s-1);const u=n[r],d=n[r+1]-u,f=(o-u)/d;return(r+f)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new xt:new Ce);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new Ce,r=[],s=[],o=[],a=new Ce,l=new nn;for(let f=0;f<=e;f++){const m=f/e;r[f]=this.getTangentAt(m,new Ce)}s[0]=new Ce,o[0]=new Ce;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=c&&(c=u,n.set(1,0,0)),h<=c&&(c=h,n.set(0,1,0)),d<=c&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(r[f-1],r[f]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(Ni(r[f-1].dot(r[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(a,m))}o[f].crossVectors(r[f],s[f])}if(t===!0){let f=Math.acos(Ni(s[0].dot(s[e]),-1,1));f/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(f=-f);for(let m=1;m<=e;m++)s[m].applyMatrix4(l.makeRotationAxis(r[m],f*m)),o[m].crossVectors(r[m],s[m])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class sS extends Fa{constructor(e=0,t=0,n=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const n=t||new xt,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*u-f*h+this.aX,c=d*h+f*u+this.aY}return n.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class h6 extends sS{constructor(e,t,n,r,s,o){super(e,t,n,n,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function eR(){let i=0,e=0,t=0,n=0;function r(s,o,a,l){i=s,e=a,t=-3*s+3*o-2*a-l,n=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,u,h){let d=(o-s)/c-(a-s)/(c+u)+(a-o)/u,f=(a-o)/u-(l-o)/(u+h)+(l-a)/h;d*=u,f*=u,r(o,a,d,f)},calc:function(s){const o=s*s,a=o*s;return i+e*s+t*o+n*a}}}const y_=new Ce,kw=new eR,Uw=new eR,Ow=new eR;class d6 extends Fa{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new Ce){const n=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,u;this.closed||a>0?c=r[(a-1)%s]:(y_.subVectors(r[0],r[1]).add(r[0]),c=y_);const h=r[a%s],d=r[(a+1)%s];if(this.closed||a+2<s?u=r[(a+2)%s]:(y_.subVectors(r[s-1],r[s-2]).add(r[s-1]),u=y_),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let m=Math.pow(c.distanceToSquared(h),f),_=Math.pow(h.distanceToSquared(d),f),v=Math.pow(d.distanceToSquared(u),f);_<1e-4&&(_=1),m<1e-4&&(m=_),v<1e-4&&(v=_),kw.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,m,_,v),Uw.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,m,_,v),Ow.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,m,_,v)}else this.curveType==="catmullrom"&&(kw.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),Uw.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),Ow.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return n.set(kw.calc(l),Uw.calc(l),Ow.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new Ce().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function qD(i,e,t,n,r){const s=(n-e)*.5,o=(r-t)*.5,a=i*i,l=i*a;return(2*t-2*n+s+o)*l+(-3*t+3*n-2*s-o)*a+s*i+t}function TK(i,e){const t=1-i;return t*t*e}function CK(i,e){return 2*(1-i)*i*e}function PK(i,e){return i*i*e}function Kg(i,e,t,n){return TK(i,e)+CK(i,t)+PK(i,n)}function RK(i,e){const t=1-i;return t*t*t*e}function IK(i,e){const t=1-i;return 3*t*t*i*e}function LK(i,e){return 3*(1-i)*i*i*e}function DK(i,e){return i*i*i*e}function Zg(i,e,t,n,r){return RK(i,e)+IK(i,t)+LK(i,n)+DK(i,r)}class tR extends Fa{constructor(e=new xt,t=new xt,n=new xt,r=new xt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new xt){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(Zg(e,r.x,s.x,o.x,a.x),Zg(e,r.y,s.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class f6 extends Fa{constructor(e=new Ce,t=new Ce,n=new Ce,r=new Ce){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Ce){const n=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(Zg(e,r.x,s.x,o.x,a.x),Zg(e,r.y,s.y,o.y,a.y),Zg(e,r.z,s.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class nR extends Fa{constructor(e=new xt,t=new xt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new xt){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new xt){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class p6 extends Fa{constructor(e=new Ce,t=new Ce){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Ce){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ce){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class iR extends Fa{constructor(e=new xt,t=new xt,n=new xt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new xt){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(Kg(e,r.x,s.x,o.x),Kg(e,r.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class rR extends Fa{constructor(e=new Ce,t=new Ce,n=new Ce){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ce){const n=t,r=this.v0,s=this.v1,o=this.v2;return n.set(Kg(e,r.x,s.x,o.x),Kg(e,r.y,s.y,o.y),Kg(e,r.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class sR extends Fa{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new xt){const n=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return n.set(qD(a,l.x,c.x,u.x,h.x),qD(a,l.y,c.y,u.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(new xt().fromArray(r))}return this}}var Jx=Object.freeze({__proto__:null,ArcCurve:h6,CatmullRomCurve3:d6,CubicBezierCurve:tR,CubicBezierCurve3:f6,EllipseCurve:sS,LineCurve:nR,LineCurve3:p6,QuadraticBezierCurve:iR,QuadraticBezierCurve3:rR,SplineCurve:sR});class m6 extends Fa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Jx[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=n){const o=r[s]-n,a=this.curves[s],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const u=l[c];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(new Jx[r.type]().fromJSON(r))}return this}}class B0 extends m6{constructor(e){super(),this.type="Path",this.currentPoint=new xt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new nR(this.currentPoint.clone(),new xt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const s=new iR(this.currentPoint.clone(),new xt(e,t),new xt(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,s,o){const a=new tR(this.currentPoint.clone(),new xt(e,t),new xt(n,r),new xt(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new sR(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,n,r,s,o),this}absarc(e,t,n,r,s,o){return this.absellipse(e,t,n,n,r,s,o),this}ellipse(e,t,n,r,s,o,a,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,r,s,o,a,l),this}absellipse(e,t,n,r,s,o,a,l){const c=new sS(e,t,n,r,s,o,a,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class v1 extends xn{constructor(e=[new xt(0,-.5),new xt(.5,0),new xt(0,.5)],t=12,n=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Ni(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],c=[],u=1/t,h=new Ce,d=new xt,f=new Ce,m=new Ce,_=new Ce;let v=0,g=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:v=e[b+1].x-e[b].x,g=e[b+1].y-e[b].y,f.x=g*1,f.y=-v,f.z=g*0,_.copy(f),f.normalize(),l.push(f.x,f.y,f.z);break;case e.length-1:l.push(_.x,_.y,_.z);break;default:v=e[b+1].x-e[b].x,g=e[b+1].y-e[b].y,f.x=g*1,f.y=-v,f.z=g*0,m.copy(f),f.x+=_.x,f.y+=_.y,f.z+=_.z,f.normalize(),l.push(f.x,f.y,f.z),_.copy(m)}for(let b=0;b<=t;b++){const p=n+b*u*r,y=Math.sin(p),A=Math.cos(p);for(let w=0;w<=e.length-1;w++){h.x=e[w].x*y,h.y=e[w].y,h.z=e[w].x*A,o.push(h.x,h.y,h.z),d.x=b/t,d.y=w/(e.length-1),a.push(d.x,d.y);const M=l[3*w+0]*y,T=l[3*w+1],E=l[3*w+0]*A;c.push(M,T,E)}}for(let b=0;b<t;b++)for(let p=0;p<e.length-1;p++){const y=p+b*e.length,A=y,w=y+e.length,M=y+e.length+1,T=y+1;s.push(A,w,T),s.push(M,T,w)}this.setIndex(s),this.setAttribute("position",new Wt(o,3)),this.setAttribute("uv",new Wt(a,2)),this.setAttribute("normal",new Wt(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new v1(e.points,e.segments,e.phiStart,e.phiLength)}}class oS extends v1{constructor(e=1,t=1,n=4,r=8){const s=new B0;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:r}}static fromJSON(e){return new oS(e.radius,e.length,e.capSegments,e.radialSegments)}}class aS extends xn{constructor(e=1,t=32,n=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],l=[],c=new Ce,u=new xt;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=t;h++,d+=3){const f=n+h/t*r;c.x=e*Math.cos(f),c.y=e*Math.sin(f),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[d]/e+1)/2,u.y=(o[d+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=t;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Wt(o,3)),this.setAttribute("normal",new Wt(a,3)),this.setAttribute("uv",new Wt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new aS(e.radius,e.segments,e.thetaStart,e.thetaLength)}}let lS=class g6 extends xn{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],h=[],d=[],f=[];let m=0;const _=[],v=n/2;let g=0;b(),o===!1&&(e>0&&p(!0),t>0&&p(!1)),this.setIndex(u),this.setAttribute("position",new Wt(h,3)),this.setAttribute("normal",new Wt(d,3)),this.setAttribute("uv",new Wt(f,2));function b(){const y=new Ce,A=new Ce;let w=0;const M=(t-e)/n;for(let T=0;T<=s;T++){const E=[],C=T/s,N=C*(t-e)+e;for(let P=0;P<=r;P++){const L=P/r,R=L*l+a,F=Math.sin(R),V=Math.cos(R);A.x=N*F,A.y=-C*n+v,A.z=N*V,h.push(A.x,A.y,A.z),y.set(F,M,V).normalize(),d.push(y.x,y.y,y.z),f.push(L,1-C),E.push(m++)}_.push(E)}for(let T=0;T<r;T++)for(let E=0;E<s;E++){const C=_[E][T],N=_[E+1][T],P=_[E+1][T+1],L=_[E][T+1];u.push(C,N,L),u.push(N,P,L),w+=6}c.addGroup(g,w,0),g+=w}function p(y){const A=m,w=new xt,M=new Ce;let T=0;const E=y===!0?e:t,C=y===!0?1:-1;for(let P=1;P<=r;P++)h.push(0,v*C,0),d.push(0,C,0),f.push(.5,.5),m++;const N=m;for(let P=0;P<=r;P++){const R=P/r*l+a,F=Math.cos(R),V=Math.sin(R);M.x=E*V,M.y=v*C,M.z=E*F,h.push(M.x,M.y,M.z),d.push(0,C,0),w.x=F*.5+.5,w.y=V*.5*C+.5,f.push(w.x,w.y),m++}for(let P=0;P<r;P++){const L=A+P,R=N+P;y===!0?u.push(R,R+1,L):u.push(R+1,R,L),T+=3}c.addGroup(g,T,y===!0?1:2),g+=T}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new g6(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},v6=class _6 extends lS{constructor(e=1,t=1,n=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,n,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new _6(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},em=class y6 extends xn{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const s=[],o=[];a(r),c(n),u(),this.setAttribute("position",new Wt(s,3)),this.setAttribute("normal",new Wt(s.slice(),3)),this.setAttribute("uv",new Wt(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const p=new Ce,y=new Ce,A=new Ce;for(let w=0;w<t.length;w+=3)f(t[w+0],p),f(t[w+1],y),f(t[w+2],A),l(p,y,A,b)}function l(b,p,y,A){const w=A+1,M=[];for(let T=0;T<=w;T++){M[T]=[];const E=b.clone().lerp(y,T/w),C=p.clone().lerp(y,T/w),N=w-T;for(let P=0;P<=N;P++)P===0&&T===w?M[T][P]=E:M[T][P]=E.clone().lerp(C,P/N)}for(let T=0;T<w;T++)for(let E=0;E<2*(w-T)-1;E++){const C=Math.floor(E/2);E%2===0?(d(M[T][C+1]),d(M[T+1][C]),d(M[T][C])):(d(M[T][C+1]),d(M[T+1][C+1]),d(M[T+1][C]))}}function c(b){const p=new Ce;for(let y=0;y<s.length;y+=3)p.x=s[y+0],p.y=s[y+1],p.z=s[y+2],p.normalize().multiplyScalar(b),s[y+0]=p.x,s[y+1]=p.y,s[y+2]=p.z}function u(){const b=new Ce;for(let p=0;p<s.length;p+=3){b.x=s[p+0],b.y=s[p+1],b.z=s[p+2];const y=v(b)/2/Math.PI+.5,A=g(b)/Math.PI+.5;o.push(y,1-A)}m(),h()}function h(){for(let b=0;b<o.length;b+=6){const p=o[b+0],y=o[b+2],A=o[b+4],w=Math.max(p,y,A),M=Math.min(p,y,A);w>.9&&M<.1&&(p<.2&&(o[b+0]+=1),y<.2&&(o[b+2]+=1),A<.2&&(o[b+4]+=1))}}function d(b){s.push(b.x,b.y,b.z)}function f(b,p){const y=b*3;p.x=e[y+0],p.y=e[y+1],p.z=e[y+2]}function m(){const b=new Ce,p=new Ce,y=new Ce,A=new Ce,w=new xt,M=new xt,T=new xt;for(let E=0,C=0;E<s.length;E+=9,C+=6){b.set(s[E+0],s[E+1],s[E+2]),p.set(s[E+3],s[E+4],s[E+5]),y.set(s[E+6],s[E+7],s[E+8]),w.set(o[C+0],o[C+1]),M.set(o[C+2],o[C+3]),T.set(o[C+4],o[C+5]),A.copy(b).add(p).add(y).divideScalar(3);const N=v(A);_(w,C+0,b,N),_(M,C+2,p,N),_(T,C+4,y,N)}}function _(b,p,y,A){A<0&&b.x===1&&(o[p]=b.x-1),y.x===0&&y.z===0&&(o[p]=A/2/Math.PI+.5)}function v(b){return Math.atan2(b.z,-b.x)}function g(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new y6(e.vertices,e.indices,e.radius,e.details)}};class cS extends em{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new cS(e.radius,e.detail)}}const x_=new Ce,b_=new Ce,Bw=new Ce,S_=new Fh;class x6 extends xn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(Gh*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},f=[];for(let m=0;m<l;m+=3){o?(c[0]=o.getX(m),c[1]=o.getX(m+1),c[2]=o.getX(m+2)):(c[0]=m,c[1]=m+1,c[2]=m+2);const{a:_,b:v,c:g}=S_;if(_.fromBufferAttribute(a,c[0]),v.fromBufferAttribute(a,c[1]),g.fromBufferAttribute(a,c[2]),S_.getNormal(Bw),h[0]=`${Math.round(_.x*r)},${Math.round(_.y*r)},${Math.round(_.z*r)}`,h[1]=`${Math.round(v.x*r)},${Math.round(v.y*r)},${Math.round(v.z*r)}`,h[2]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let b=0;b<3;b++){const p=(b+1)%3,y=h[b],A=h[p],w=S_[u[b]],M=S_[u[p]],T=`${y}_${A}`,E=`${A}_${y}`;E in d&&d[E]?(Bw.dot(d[E].normal)<=s&&(f.push(w.x,w.y,w.z),f.push(M.x,M.y,M.z)),d[E]=null):T in d||(d[T]={index0:c[b],index1:c[p],normal:Bw.clone()})}}for(const m in d)if(d[m]){const{index0:_,index1:v}=d[m];x_.fromBufferAttribute(a,_),b_.fromBufferAttribute(a,v),f.push(x_.x,x_.y,x_.z),f.push(b_.x,b_.y,b_.z)}this.setAttribute("position",new Wt(f,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class $h extends B0{constructor(e){super(e),this.uuid=bo(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(new B0().fromJSON(r))}return this}}const NK={triangulate:function(i,e,t=2){const n=e&&e.length,r=n?e[0]*t:i.length;let s=b6(i,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,h,d,f;if(n&&(s=BK(i,e,s,t)),i.length>80*t){a=c=i[0],l=u=i[1];for(let m=t;m<r;m+=t)h=i[m],d=i[m+1],h<a&&(a=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-a,u-l),f=f!==0?32767/f:0}return z0(s,o,t,a,l,f,0),o}};function b6(i,e,t,n,r){let s,o;if(r===KK(i,e,t,n)>0)for(s=e;s<t;s+=n)o=YD(s,i[s],i[s+1],o);else for(s=t-n;s>=e;s-=n)o=YD(s,i[s],i[s+1],o);return o&&uS(o,o.next)&&(V0(o),o=o.next),o}function ad(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(uS(t,t.next)||Ai(t.prev,t,t.next)===0)){if(V0(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function z0(i,e,t,n,r,s,o){if(!i)return;!o&&s&&$K(i,n,r,s);let a=i,l,c;for(;i.prev!==i.next;){if(l=i.prev,c=i.next,s?kK(i,n,r,s):FK(i)){e.push(l.i/t|0),e.push(i.i/t|0),e.push(c.i/t|0),V0(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=UK(ad(i),e,t),z0(i,e,t,n,r,s,2)):o===2&&OK(i,e,t,n,r,s):z0(ad(i),e,t,n,r,s,1);break}}}function FK(i){const e=i.prev,t=i,n=i.next;if(Ai(e,t,n)>=0)return!1;const r=e.x,s=t.x,o=n.x,a=e.y,l=t.y,c=n.y,u=r<s?r<o?r:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,d=r>s?r>o?r:o:s>o?s:o,f=a>l?a>c?a:c:l>c?l:c;let m=n.next;for(;m!==e;){if(m.x>=u&&m.x<=d&&m.y>=h&&m.y<=f&&np(r,a,s,l,o,c,m.x,m.y)&&Ai(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function kK(i,e,t,n){const r=i.prev,s=i,o=i.next;if(Ai(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,d=o.y,f=a<l?a<c?a:c:l<c?l:c,m=u<h?u<d?u:d:h<d?h:d,_=a>l?a>c?a:c:l>c?l:c,v=u>h?u>d?u:d:h>d?h:d,g=ET(f,m,e,t,n),b=ET(_,v,e,t,n);let p=i.prevZ,y=i.nextZ;for(;p&&p.z>=g&&y&&y.z<=b;){if(p.x>=f&&p.x<=_&&p.y>=m&&p.y<=v&&p!==r&&p!==o&&np(a,u,l,h,c,d,p.x,p.y)&&Ai(p.prev,p,p.next)>=0||(p=p.prevZ,y.x>=f&&y.x<=_&&y.y>=m&&y.y<=v&&y!==r&&y!==o&&np(a,u,l,h,c,d,y.x,y.y)&&Ai(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;p&&p.z>=g;){if(p.x>=f&&p.x<=_&&p.y>=m&&p.y<=v&&p!==r&&p!==o&&np(a,u,l,h,c,d,p.x,p.y)&&Ai(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;y&&y.z<=b;){if(y.x>=f&&y.x<=_&&y.y>=m&&y.y<=v&&y!==r&&y!==o&&np(a,u,l,h,c,d,y.x,y.y)&&Ai(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function UK(i,e,t){let n=i;do{const r=n.prev,s=n.next.next;!uS(r,s)&&S6(r,n,n.next,s)&&G0(r,s)&&G0(s,r)&&(e.push(r.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),V0(n),V0(n.next),n=i=s),n=n.next}while(n!==i);return ad(n)}function OK(i,e,t,n,r,s){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&XK(o,a)){let l=w6(o,a);o=ad(o,o.next),l=ad(l,l.next),z0(o,e,t,n,r,s,0),z0(l,e,t,n,r,s,0);return}a=a.next}o=o.next}while(o!==i)}function BK(i,e,t,n){const r=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*n,l=s<o-1?e[s+1]*n:i.length,c=b6(i,a,l,n,!1),c===c.next&&(c.steiner=!0),r.push(jK(c));for(r.sort(zK),s=0;s<r.length;s++)t=GK(r[s],t);return t}function zK(i,e){return i.x-e.x}function GK(i,e){const t=VK(i,e);if(!t)return e;const n=w6(t,i);return ad(n,n.next),ad(t,t.next)}function VK(i,e){let t=e,n=-1/0,r;const s=i.x,o=i.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const d=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=s&&d>n&&(n=d,r=t.x<t.next.x?t:t.next,d===s))return r}t=t.next}while(t!==e);if(!r)return null;const a=r,l=r.x,c=r.y;let u=1/0,h;t=r;do s>=t.x&&t.x>=l&&s!==t.x&&np(o<c?s:n,o,l,c,o<c?n:s,o,t.x,t.y)&&(h=Math.abs(o-t.y)/(s-t.x),G0(t,i)&&(h<u||h===u&&(t.x>r.x||t.x===r.x&&HK(r,t)))&&(r=t,u=h)),t=t.next;while(t!==a);return r}function HK(i,e){return Ai(i.prev,i,e.prev)<0&&Ai(e.next,i,i.next)<0}function $K(i,e,t,n){let r=i;do r.z===0&&(r.z=ET(r.x,r.y,e,t,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,WK(r)}function WK(i){let e,t,n,r,s,o,a,l,c=1;do{for(t=i,i=null,s=null,o=0;t;){for(o++,n=t,a=0,e=0;e<c&&(a++,n=n.nextZ,!!n);e++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||t.z<=n.z)?(r=t,t=t.nextZ,a--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:i=r,r.prevZ=s,s=r;t=n}s.nextZ=null,c*=2}while(o>1);return i}function ET(i,e,t,n,r){return i=(i-t)*r|0,e=(e-n)*r|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function jK(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function np(i,e,t,n,r,s,o,a){return(r-o)*(e-a)>=(i-o)*(s-a)&&(i-o)*(n-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(n-a)}function XK(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!qK(i,e)&&(G0(i,e)&&G0(e,i)&&YK(i,e)&&(Ai(i.prev,i,e.prev)||Ai(i,e.prev,e))||uS(i,e)&&Ai(i.prev,i,i.next)>0&&Ai(e.prev,e,e.next)>0)}function Ai(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function uS(i,e){return i.x===e.x&&i.y===e.y}function S6(i,e,t,n){const r=M_(Ai(i,e,t)),s=M_(Ai(i,e,n)),o=M_(Ai(t,n,i)),a=M_(Ai(t,n,e));return!!(r!==s&&o!==a||r===0&&w_(i,t,e)||s===0&&w_(i,n,e)||o===0&&w_(t,i,n)||a===0&&w_(t,e,n))}function w_(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function M_(i){return i>0?1:i<0?-1:0}function qK(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&S6(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function G0(i,e){return Ai(i.prev,i,i.next)<0?Ai(i,e,i.next)>=0&&Ai(i,i.prev,e)>=0:Ai(i,e,i.prev)<0||Ai(i,i.next,e)<0}function YK(i,e){let t=i,n=!1;const r=(i.x+e.x)/2,s=(i.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function w6(i,e){const t=new TT(i.i,i.x,i.y),n=new TT(e.i,e.x,e.y),r=i.next,s=e.prev;return i.next=e,e.prev=i,t.next=r,r.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function YD(i,e,t,n){const r=new TT(i,e,t);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function V0(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function TT(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function KK(i,e,t,n){let r=0;for(let s=e,o=t-n;s<t;s+=n)r+=(i[o]-i[s])*(i[s+1]+i[o+1]),o=s;return r}class sl{static area(e){const t=e.length;let n=0;for(let r=t-1,s=0;s<t;r=s++)n+=e[r].x*e[s].y-e[s].x*e[r].y;return n*.5}static isClockWise(e){return sl.area(e)<0}static triangulateShape(e,t){const n=[],r=[],s=[];KD(e),ZD(n,e);let o=e.length;t.forEach(KD);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,ZD(n,t[l]);const a=NK.triangulate(n,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function KD(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function ZD(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class hS extends xn{constructor(e=new $h([new xt(.5,.5),new xt(-.5,.5),new xt(-.5,-.5),new xt(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new Wt(r,3)),this.setAttribute("uv",new Wt(s,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1;let d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,f=t.bevelThickness!==void 0?t.bevelThickness:.2,m=t.bevelSize!==void 0?t.bevelSize:f-.1,_=t.bevelOffset!==void 0?t.bevelOffset:0,v=t.bevelSegments!==void 0?t.bevelSegments:3;const g=t.extrudePath,b=t.UVGenerator!==void 0?t.UVGenerator:ZK;let p,y=!1,A,w,M,T;g&&(p=g.getSpacedPoints(u),y=!0,d=!1,A=g.computeFrenetFrames(u,!1),w=new Ce,M=new Ce,T=new Ce),d||(v=0,f=0,m=0,_=0);const E=a.extractPoints(c);let C=E.shape;const N=E.holes;if(!sl.isClockWise(C)){C=C.reverse();for(let $=0,pe=N.length;$<pe;$++){const xe=N[$];sl.isClockWise(xe)&&(N[$]=xe.reverse())}}const L=sl.triangulateShape(C,N),R=C;for(let $=0,pe=N.length;$<pe;$++){const xe=N[$];C=C.concat(xe)}function F($,pe,xe){return pe||console.error("THREE.ExtrudeGeometry: vec does not exist"),$.clone().addScaledVector(pe,xe)}const V=C.length,z=L.length;function U($,pe,xe){let Pe,ve,Ue;const Le=$.x-pe.x,Z=$.y-pe.y,J=xe.x-$.x,de=xe.y-$.y,Ie=Le*Le+Z*Z,te=Le*de-Z*J;if(Math.abs(te)>Number.EPSILON){const X=Math.sqrt(Ie),ye=Math.sqrt(J*J+de*de),ke=pe.x-Z/X,ge=pe.y+Le/X,De=xe.x-de/ye,$e=xe.y+J/ye,Ae=((De-ke)*de-($e-ge)*J)/(Le*de-Z*J);Pe=ke+Le*Ae-$.x,ve=ge+Z*Ae-$.y;const Ze=Pe*Pe+ve*ve;if(Ze<=2)return new xt(Pe,ve);Ue=Math.sqrt(Ze/2)}else{let X=!1;Le>Number.EPSILON?J>Number.EPSILON&&(X=!0):Le<-Number.EPSILON?J<-Number.EPSILON&&(X=!0):Math.sign(Z)===Math.sign(de)&&(X=!0),X?(Pe=-Z,ve=Le,Ue=Math.sqrt(Ie)):(Pe=Le,ve=Z,Ue=Math.sqrt(Ie/2))}return new xt(Pe/Ue,ve/Ue)}const G=[];for(let $=0,pe=R.length,xe=pe-1,Pe=$+1;$<pe;$++,xe++,Pe++)xe===pe&&(xe=0),Pe===pe&&(Pe=0),G[$]=U(R[$],R[xe],R[Pe]);const B=[];let D,O=G.concat();for(let $=0,pe=N.length;$<pe;$++){const xe=N[$];D=[];for(let Pe=0,ve=xe.length,Ue=ve-1,Le=Pe+1;Pe<ve;Pe++,Ue++,Le++)Ue===ve&&(Ue=0),Le===ve&&(Le=0),D[Pe]=U(xe[Pe],xe[Ue],xe[Le]);B.push(D),O=O.concat(D)}for(let $=0;$<v;$++){const pe=$/v,xe=f*Math.cos(pe*Math.PI/2),Pe=m*Math.sin(pe*Math.PI/2)+_;for(let ve=0,Ue=R.length;ve<Ue;ve++){const Le=F(R[ve],G[ve],Pe);ne(Le.x,Le.y,-xe)}for(let ve=0,Ue=N.length;ve<Ue;ve++){const Le=N[ve];D=B[ve];for(let Z=0,J=Le.length;Z<J;Z++){const de=F(Le[Z],D[Z],Pe);ne(de.x,de.y,-xe)}}}const j=m+_;for(let $=0;$<V;$++){const pe=d?F(C[$],O[$],j):C[$];y?(M.copy(A.normals[0]).multiplyScalar(pe.x),w.copy(A.binormals[0]).multiplyScalar(pe.y),T.copy(p[0]).add(M).add(w),ne(T.x,T.y,T.z)):ne(pe.x,pe.y,0)}for(let $=1;$<=u;$++)for(let pe=0;pe<V;pe++){const xe=d?F(C[pe],O[pe],j):C[pe];y?(M.copy(A.normals[$]).multiplyScalar(xe.x),w.copy(A.binormals[$]).multiplyScalar(xe.y),T.copy(p[$]).add(M).add(w),ne(T.x,T.y,T.z)):ne(xe.x,xe.y,h/u*$)}for(let $=v-1;$>=0;$--){const pe=$/v,xe=f*Math.cos(pe*Math.PI/2),Pe=m*Math.sin(pe*Math.PI/2)+_;for(let ve=0,Ue=R.length;ve<Ue;ve++){const Le=F(R[ve],G[ve],Pe);ne(Le.x,Le.y,h+xe)}for(let ve=0,Ue=N.length;ve<Ue;ve++){const Le=N[ve];D=B[ve];for(let Z=0,J=Le.length;Z<J;Z++){const de=F(Le[Z],D[Z],Pe);y?ne(de.x,de.y+p[u-1].y,p[u-1].x+xe):ne(de.x,de.y,h+xe)}}}q(),Y();function q(){const $=r.length/3;if(d){let pe=0,xe=V*pe;for(let Pe=0;Pe<z;Pe++){const ve=L[Pe];Q(ve[2]+xe,ve[1]+xe,ve[0]+xe)}pe=u+v*2,xe=V*pe;for(let Pe=0;Pe<z;Pe++){const ve=L[Pe];Q(ve[0]+xe,ve[1]+xe,ve[2]+xe)}}else{for(let pe=0;pe<z;pe++){const xe=L[pe];Q(xe[2],xe[1],xe[0])}for(let pe=0;pe<z;pe++){const xe=L[pe];Q(xe[0]+V*u,xe[1]+V*u,xe[2]+V*u)}}n.addGroup($,r.length/3-$,0)}function Y(){const $=r.length/3;let pe=0;ie(R,pe),pe+=R.length;for(let xe=0,Pe=N.length;xe<Pe;xe++){const ve=N[xe];ie(ve,pe),pe+=ve.length}n.addGroup($,r.length/3-$,1)}function ie($,pe){let xe=$.length;for(;--xe>=0;){const Pe=xe;let ve=xe-1;ve<0&&(ve=$.length-1);for(let Ue=0,Le=u+v*2;Ue<Le;Ue++){const Z=V*Ue,J=V*(Ue+1),de=pe+Pe+Z,Ie=pe+ve+Z,te=pe+ve+J,X=pe+Pe+J;le(de,Ie,te,X)}}}function ne($,pe,xe){l.push($),l.push(pe),l.push(xe)}function Q($,pe,xe){se($),se(pe),se(xe);const Pe=r.length/3,ve=b.generateTopUV(n,r,Pe-3,Pe-2,Pe-1);oe(ve[0]),oe(ve[1]),oe(ve[2])}function le($,pe,xe,Pe){se($),se(pe),se(Pe),se(pe),se(xe),se(Pe);const ve=r.length/3,Ue=b.generateSideWallUV(n,r,ve-6,ve-3,ve-2,ve-1);oe(Ue[0]),oe(Ue[1]),oe(Ue[3]),oe(Ue[1]),oe(Ue[2]),oe(Ue[3])}function se($){r.push(l[$*3+0]),r.push(l[$*3+1]),r.push(l[$*3+2])}function oe($){s.push($.x),s.push($.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return QK(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=t[e.shapes[s]];n.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new Jx[r.type]().fromJSON(r)),new hS(n,e.options)}}const ZK={generateTopUV:function(i,e,t,n,r){const s=e[t*3],o=e[t*3+1],a=e[n*3],l=e[n*3+1],c=e[r*3],u=e[r*3+1];return[new xt(s,o),new xt(a,l),new xt(c,u)]},generateSideWallUV:function(i,e,t,n,r,s){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[n*3],u=e[n*3+1],h=e[n*3+2],d=e[r*3],f=e[r*3+1],m=e[r*3+2],_=e[s*3],v=e[s*3+1],g=e[s*3+2];return Math.abs(a-u)<Math.abs(o-c)?[new xt(o,1-l),new xt(c,1-h),new xt(d,1-m),new xt(_,1-g)]:[new xt(a,1-l),new xt(u,1-h),new xt(f,1-m),new xt(v,1-g)]}};function QK(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,r=i.length;n<r;n++){const s=i[n];t.shapes.push(s.uuid)}else t.shapes.push(i.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}let M6=class A6 extends em{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new A6(e.radius,e.detail)}},oR=class E6 extends em{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new E6(e.radius,e.detail)}};class dS extends xn{constructor(e=.5,t=1,n=32,r=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:o},n=Math.max(3,n),r=Math.max(1,r);const a=[],l=[],c=[],u=[];let h=e;const d=(t-e)/r,f=new Ce,m=new xt;for(let _=0;_<=r;_++){for(let v=0;v<=n;v++){const g=s+v/n*o;f.x=h*Math.cos(g),f.y=h*Math.sin(g),l.push(f.x,f.y,f.z),c.push(0,0,1),m.x=(f.x/t+1)/2,m.y=(f.y/t+1)/2,u.push(m.x,m.y)}h+=d}for(let _=0;_<r;_++){const v=_*(n+1);for(let g=0;g<n;g++){const b=g+v,p=b,y=b+n+1,A=b+n+2,w=b+1;a.push(p,y,w),a.push(y,A,w)}}this.setIndex(a),this.setAttribute("position",new Wt(l,3)),this.setAttribute("normal",new Wt(c,3)),this.setAttribute("uv",new Wt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dS(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class fS extends xn{constructor(e=new $h([new xt(0,.5),new xt(-.5,-.5),new xt(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new Wt(r,3)),this.setAttribute("normal",new Wt(s,3)),this.setAttribute("uv",new Wt(o,2));function c(u){const h=r.length/3,d=u.extractPoints(t);let f=d.shape;const m=d.holes;sl.isClockWise(f)===!1&&(f=f.reverse());for(let v=0,g=m.length;v<g;v++){const b=m[v];sl.isClockWise(b)===!0&&(m[v]=b.reverse())}const _=sl.triangulateShape(f,m);for(let v=0,g=m.length;v<g;v++){const b=m[v];f=f.concat(b)}for(let v=0,g=f.length;v<g;v++){const b=f[v];r.push(b.x,b.y,0),s.push(0,0,1),o.push(b.x,b.y)}for(let v=0,g=_.length;v<g;v++){const b=_[v],p=b[0]+h,y=b[1]+h,A=b[2]+h;n.push(p,y,A),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return JK(t,e)}static fromJSON(e,t){const n=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=t[e.shapes[r]];n.push(o)}return new fS(n,e.curveSegments)}}function JK(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const r=i[t];e.shapes.push(r.uuid)}else e.shapes.push(i.uuid);return e}class _1 extends xn{constructor(e=1,t=32,n=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let c=0;const u=[],h=new Ce,d=new Ce,f=[],m=[],_=[],v=[];for(let g=0;g<=n;g++){const b=[],p=g/n;let y=0;g===0&&o===0?y=.5/t:g===n&&l===Math.PI&&(y=-.5/t);for(let A=0;A<=t;A++){const w=A/t;h.x=-e*Math.cos(r+w*s)*Math.sin(o+p*a),h.y=e*Math.cos(o+p*a),h.z=e*Math.sin(r+w*s)*Math.sin(o+p*a),m.push(h.x,h.y,h.z),d.copy(h).normalize(),_.push(d.x,d.y,d.z),v.push(w+y,1-p),b.push(c++)}u.push(b)}for(let g=0;g<n;g++)for(let b=0;b<t;b++){const p=u[g][b+1],y=u[g][b],A=u[g+1][b],w=u[g+1][b+1];(g!==0||o>0)&&f.push(p,y,w),(g!==n-1||l<Math.PI)&&f.push(y,A,w)}this.setIndex(f),this.setAttribute("position",new Wt(m,3)),this.setAttribute("normal",new Wt(_,3)),this.setAttribute("uv",new Wt(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _1(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}let T6=class C6 extends em{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new C6(e.radius,e.detail)}},P6=class R6 extends xn{constructor(e=1,t=.4,n=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new Ce,h=new Ce,d=new Ce;for(let f=0;f<=n;f++)for(let m=0;m<=r;m++){const _=m/r*s,v=f/n*Math.PI*2;h.x=(e+t*Math.cos(v))*Math.cos(_),h.y=(e+t*Math.cos(v))*Math.sin(_),h.z=t*Math.sin(v),a.push(h.x,h.y,h.z),u.x=e*Math.cos(_),u.y=e*Math.sin(_),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(m/r),c.push(f/n)}for(let f=1;f<=n;f++)for(let m=1;m<=r;m++){const _=(r+1)*f+m-1,v=(r+1)*(f-1)+m-1,g=(r+1)*(f-1)+m,b=(r+1)*f+m;o.push(_,v,b),o.push(v,g,b)}this.setIndex(o),this.setAttribute("position",new Wt(a,3)),this.setAttribute("normal",new Wt(l,3)),this.setAttribute("uv",new Wt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new R6(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}};class pS extends xn{constructor(e=1,t=.4,n=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:s,q:o},n=Math.floor(n),r=Math.floor(r);const a=[],l=[],c=[],u=[],h=new Ce,d=new Ce,f=new Ce,m=new Ce,_=new Ce,v=new Ce,g=new Ce;for(let p=0;p<=n;++p){const y=p/n*s*Math.PI*2;b(y,s,o,e,f),b(y+.01,s,o,e,m),v.subVectors(m,f),g.addVectors(m,f),_.crossVectors(v,g),g.crossVectors(_,v),_.normalize(),g.normalize();for(let A=0;A<=r;++A){const w=A/r*Math.PI*2,M=-t*Math.cos(w),T=t*Math.sin(w);h.x=f.x+(M*g.x+T*_.x),h.y=f.y+(M*g.y+T*_.y),h.z=f.z+(M*g.z+T*_.z),l.push(h.x,h.y,h.z),d.subVectors(h,f).normalize(),c.push(d.x,d.y,d.z),u.push(p/n),u.push(A/r)}}for(let p=1;p<=n;p++)for(let y=1;y<=r;y++){const A=(r+1)*(p-1)+(y-1),w=(r+1)*p+(y-1),M=(r+1)*p+y,T=(r+1)*(p-1)+y;a.push(A,w,T),a.push(w,M,T)}this.setIndex(a),this.setAttribute("position",new Wt(l,3)),this.setAttribute("normal",new Wt(c,3)),this.setAttribute("uv",new Wt(u,2));function b(p,y,A,w,M){const T=Math.cos(p),E=Math.sin(p),C=A/y*p,N=Math.cos(C);M.x=w*(2+N)*.5*T,M.y=w*(2+N)*E*.5,M.z=w*Math.sin(C)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pS(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class mS extends xn{constructor(e=new rR(new Ce(-1,-1,0),new Ce(-1,1,0),new Ce(1,1,0)),t=64,n=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new Ce,l=new Ce,c=new xt;let u=new Ce;const h=[],d=[],f=[],m=[];_(),this.setIndex(m),this.setAttribute("position",new Wt(h,3)),this.setAttribute("normal",new Wt(d,3)),this.setAttribute("uv",new Wt(f,2));function _(){for(let p=0;p<t;p++)v(p);v(s===!1?t:0),b(),g()}function v(p){u=e.getPointAt(p/t,u);const y=o.normals[p],A=o.binormals[p];for(let w=0;w<=r;w++){const M=w/r*Math.PI*2,T=Math.sin(M),E=-Math.cos(M);l.x=E*y.x+T*A.x,l.y=E*y.y+T*A.y,l.z=E*y.z+T*A.z,l.normalize(),d.push(l.x,l.y,l.z),a.x=u.x+n*l.x,a.y=u.y+n*l.y,a.z=u.z+n*l.z,h.push(a.x,a.y,a.z)}}function g(){for(let p=1;p<=t;p++)for(let y=1;y<=r;y++){const A=(r+1)*(p-1)+(y-1),w=(r+1)*p+(y-1),M=(r+1)*p+y,T=(r+1)*(p-1)+y;m.push(A,w,T),m.push(w,M,T)}}function b(){for(let p=0;p<=t;p++)for(let y=0;y<=r;y++)c.x=p/t,c.y=y/r,f.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new mS(new Jx[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class I6 extends xn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,r=new Ce,s=new Ce;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,f=h.count;for(let m=d,_=d+f;m<_;m+=3)for(let v=0;v<3;v++){const g=a.getX(m+v),b=a.getX(m+(v+1)%3);r.fromBufferAttribute(o,g),s.fromBufferAttribute(o,b),QD(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const u=3*a+c,h=3*a+(c+1)%3;r.fromBufferAttribute(o,u),s.fromBufferAttribute(o,h),QD(r,s,n)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Wt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function QD(i,e,t){const n=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(n)===!0||t.has(r)===!0?!1:(t.add(n),t.add(r),!0)}var JD=Object.freeze({__proto__:null,BoxGeometry:f1,CapsuleGeometry:oS,CircleGeometry:aS,ConeGeometry:v6,CylinderGeometry:lS,DodecahedronGeometry:cS,EdgesGeometry:x6,ExtrudeGeometry:hS,IcosahedronGeometry:M6,LatheGeometry:v1,OctahedronGeometry:oR,PlaneGeometry:gd,PolyhedronGeometry:em,RingGeometry:dS,ShapeGeometry:fS,SphereGeometry:_1,TetrahedronGeometry:T6,TorusGeometry:P6,TorusKnotGeometry:pS,TubeGeometry:mS,WireframeGeometry:I6});class L6 extends Or{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new kt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class D6 extends dl{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class H0 extends Or{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new kt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eb extends H0{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new xt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ni(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new kt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new kt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new kt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class N6 extends Or{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new kt(16777215),this.specular=new kt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=u1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class F6 extends Or{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new kt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class k6 extends Or{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class U6 extends Or{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new kt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=u1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class O6 extends Or{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new kt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Lu,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class B6 extends Is{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function kh(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function z6(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function G6(i){function e(r,s){return i[r]-i[s]}const t=i.length,n=new Array(t);for(let r=0;r!==t;++r)n[r]=r;return n.sort(e),n}function CT(i,e,t){const n=i.length,r=new i.constructor(n);for(let s=0,o=0;o!==n;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=i[a+l]}return r}function aR(i,e,t,n){let r=1,s=i[0];for(;s!==void 0&&s[n]===void 0;)s=i[r++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),t.push.apply(t,o)),s=i[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=i[r++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),t.push(o)),s=i[r++];while(s!==void 0)}function eZ(i,e,t,n,r=30){const s=i.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let f=0;f<c.times.length;++f){const m=c.times[f]*r;if(!(m<t||m>=n)){h.push(c.times[f]);for(let _=0;_<u;++_)d.push(c.values[f*u+_])}}h.length!==0&&(c.times=kh(h,c.times.constructor),c.values=kh(d,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s}function tZ(i,e=0,t=i,n=30){n<=0&&(n=30);const r=t.tracks.length,s=e/n;for(let o=0;o<r;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(g){return g.name===a.name&&g.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const m=a.times.length-1;let _;if(s<=a.times[0]){const g=u,b=h-u;_=a.values.slice(g,b)}else if(s>=a.times[m]){const g=m*h+u,b=g+h-u;_=a.values.slice(g,b)}else{const g=a.createInterpolant(),b=u,p=h-u;g.evaluate(s),_=g.resultBuffer.slice(b,p)}l==="quaternion"&&new As().fromArray(_).normalize().conjugate().toArray(_);const v=c.times.length;for(let g=0;g<v;++g){const b=g*f+d;if(l==="quaternion")As.multiplyQuaternionsFlat(c.values,b,_,0,c.values,b);else{const p=f-d*2;for(let y=0;y<p;++y)c.values[b+y]-=_[y]}}}return i.blendMode=UP,i}const nZ={convertArray:kh,isTypedArray:z6,getKeyframeOrder:G6,sortedArray:CT,flattenJSON:aR,subclip:eZ,makeClipAdditive:tZ};class y1{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],s=t[n-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=n+2;;){if(r===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=r,r=t[++n],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(n=2,s=a);for(let l=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(r=s,s=t[--n-1],e>=s)break t}o=n,n=0;break n}break e}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(r=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=n[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class V6 extends y1{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Lh,endingEnd:Lh}}intervalChanged_(e,t,n){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case Dh:s=e,a=2*t-n;break;case D0:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Dh:o=e,l=2*n-t;break;case D0:o=1,l=n+r[1]-r[0];break;default:o=e-1,l=t}const c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,f=this._weightNext,m=(n-t)/(r-t),_=m*m,v=_*m,g=-d*v+2*d*_-d*m,b=(1+d)*v+(-1.5-2*d)*_+(-.5+d)*m+1,p=(-1-f)*v+(1.5+f)*_+.5*m,y=f*v-f*_;for(let A=0;A!==a;++A)s[A]=g*o[u+A]+b*o[c+A]+p*o[l+A]+y*o[h+A];return s}}class lR extends y1{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(n-t)/(r-t),h=1-u;for(let d=0;d!==a;++d)s[d]=o[c+d]*h+o[l+d]*u;return s}}class H6 extends y1{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class ka{constructor(e,t,n,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=kh(t,this.TimeBufferType),this.values=kh(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:kh(e.times,Array),values:kh(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(n.interpolation=r)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new H6(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new lR(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new V6(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case I0:t=this.InterpolantFactoryMethodDiscrete;break;case L0:t=this.InterpolantFactoryMethodLinear;break;case nx:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return I0;case this.InterpolantFactoryMethodLinear:return L0;case this.InterpolantFactoryMethodSmooth:return nx}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let s=0,o=r-1;for(;s!==r&&n[s]<e;)++s;for(;o!==-1&&n[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&z6(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===nx,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(r)l=!0;else{const h=a*n,d=h-n,f=h+n;for(let m=0;m!==n;++m){const _=t[h+m];if(_!==t[d+m]||_!==t[f+m]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const h=a*n,d=o*n;for(let f=0;f!==n;++f)t[d+f]=t[h+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*n,l=o*n,c=0;c!==n;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}ka.prototype.TimeBufferType=Float32Array;ka.prototype.ValueBufferType=Float32Array;ka.prototype.DefaultInterpolation=L0;class _d extends ka{}_d.prototype.ValueTypeName="bool";_d.prototype.ValueBufferType=Array;_d.prototype.DefaultInterpolation=I0;_d.prototype.InterpolantFactoryMethodLinear=void 0;_d.prototype.InterpolantFactoryMethodSmooth=void 0;class cR extends ka{}cR.prototype.ValueTypeName="color";class $0 extends ka{}$0.prototype.ValueTypeName="number";class $6 extends y1{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)As.slerpFlat(s,0,o,c-a,o,c,l);return s}}class tm extends ka{InterpolantFactoryMethodLinear(e){return new $6(this.times,this.values,this.getValueSize(),e)}}tm.prototype.ValueTypeName="quaternion";tm.prototype.DefaultInterpolation=L0;tm.prototype.InterpolantFactoryMethodSmooth=void 0;class yd extends ka{}yd.prototype.ValueTypeName="string";yd.prototype.ValueBufferType=Array;yd.prototype.DefaultInterpolation=I0;yd.prototype.InterpolantFactoryMethodLinear=void 0;yd.prototype.InterpolantFactoryMethodSmooth=void 0;class W0 extends ka{}W0.prototype.ValueTypeName="vector";class j0{constructor(e,t=-1,n,r=Yb){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=bo(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(rZ(n[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=n.length;s!==o;++s)t.push(ka.toJSON(n[s]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=G6(l);l=CT(l,1,u),c=CT(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new $0(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=r[h];d||(r[h]=d=[]),d.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(h,d,f,m,_){if(f.length!==0){const v=[],g=[];aR(f,v,g,m),v.length!==0&&_.push(new h(d,v,g))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let m;for(m=0;m<d.length;m++)if(d[m].morphTargets)for(let _=0;_<d[m].morphTargets.length;_++)f[d[m].morphTargets[_]]=-1;for(const _ in f){const v=[],g=[];for(let b=0;b!==d[m].morphTargets.length;++b){const p=d[m];v.push(p.time),g.push(p.morphTarget===_?1:0)}r.push(new $0(".morphTargetInfluence["+_+"]",v,g))}l=f.length*o}else{const f=".bones["+t[h].name+"]";n(W0,f+".position",d,"pos",r),n(tm,f+".quaternion",d,"rot",r),n(W0,f+".scale",d,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,r=e.length;n!==r;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function iZ(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return $0;case"vector":case"vector2":case"vector3":case"vector4":return W0;case"color":return cR;case"quaternion":return tm;case"bool":case"boolean":return _d;case"string":return yd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function rZ(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=iZ(i.type);if(i.times===void 0){const t=[],n=[];aR(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const Zl={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class uR{constructor(e,t,n){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const f=c[h],m=c[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return m}return null}}}const W6=new uR;class Qs{constructor(e){this.manager=e!==void 0?e:W6,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,s){n.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Qs.DEFAULT_MATERIAL_NAME="__DEFAULT";const Pl={};class sZ extends Error{constructor(e,t){super(e),this.response=t}}class cc extends Qs{constructor(e){super(e)}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Zl.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(Pl[e]!==void 0){Pl[e].push({onLoad:t,onProgress:n,onError:r});return}Pl[e]=[],Pl[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Pl[e],h=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),f=d?parseInt(d):0,m=f!==0;let _=0;const v=new ReadableStream({start(g){b();function b(){h.read().then(({done:p,value:y})=>{if(p)g.close();else{_+=y.byteLength;const A=new ProgressEvent("progress",{lengthComputable:m,loaded:_,total:f});for(let w=0,M=u.length;w<M;w++){const T=u[w];T.onProgress&&T.onProgress(A)}g.enqueue(y),b()}})}}});return new Response(v)}else throw new sZ(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),d=h&&h[1]?h[1].toLowerCase():void 0,f=new TextDecoder(d);return c.arrayBuffer().then(m=>f.decode(m))}}}).then(c=>{Zl.add(e,c);const u=Pl[e];delete Pl[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=Pl[e];if(u===void 0)throw this.manager.itemError(e),c;delete Pl[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class oZ extends Qs{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new cc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=j0.parse(e[n]);t.push(r)}return t}}class aZ extends Qs{constructor(e){super(e)}load(e,t,n,r){const s=this,o=[],a=new rS,l=new cc(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(e[h],function(d){const f=s.parse(d,!0);o[h]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(a.minFilter=Mi),a.image=o,a.format=f.format,a.needsUpdate=!0,t&&t(a))},n,r)}if(Array.isArray(e))for(let h=0,d=e.length;h<d;++h)u(h);else l.load(e,function(h){const d=s.parse(h,!0);if(d.isCubemap){const f=d.mipmaps.length/d.mipmapCount;for(let m=0;m<f;m++){o[m]={mipmaps:[]};for(let _=0;_<d.mipmapCount;_++)o[m].mipmaps.push(d.mipmaps[m*d.mipmapCount+_]),o[m].format=d.format,o[m].width=d.width,o[m].height=d.height}a.image=o}else a.image.width=d.width,a.image.height=d.height,a.mipmaps=d.mipmaps;d.mipmapCount===1&&(a.minFilter=Mi),a.format=d.format,a.needsUpdate=!0,t&&t(a)},n,r);return a}}class X0 extends Qs{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Zl.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=O0("img");function l(){u(),Zl.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(h){u(),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class lZ extends Qs{constructor(e){super(e)}load(e,t,n,r){const s=new m1;s.colorSpace=lr;const o=new X0(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(u){s.images[c]=u,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class cZ extends Qs{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new Hh,a=new cc(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){let c;try{c=s.parse(l)}catch(u){if(r!==void 0)r(u);else{console.error(u);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:ns,o.wrapT=c.wrapT!==void 0?c.wrapT:ns,o.magFilter=c.magFilter!==void 0?c.magFilter:Mi,o.minFilter=c.minFilter!==void 0?c.minFilter:Mi,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0?o.colorSpace=c.colorSpace:c.encoding!==void 0&&(o.encoding=c.encoding),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=Mu),c.mipmapCount===1&&(o.minFilter=Mi),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},n,r),o}}class uZ extends Qs{constructor(e){super(e)}load(e,t,n,r){const s=new Tr,o=new X0(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},n,r),s}}let Du=class extends qn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new kt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};class j6 extends Du{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(qn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new kt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const zw=new nn,eN=new Ce,tN=new Ce;let hR=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new xt(512,512),this.map=null,this.mapPass=null,this.matrix=new nn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new g1,this._frameExtents=new xt(1,1),this._viewportCount=1,this._viewports=[new Gn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;eN.setFromMatrixPosition(e.matrixWorld),t.position.copy(eN),tN.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(tN),t.updateMatrixWorld(),zw.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zw),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(zw)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}};class hZ extends hR{constructor(){super(new Ji(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=Dp*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(n!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class X6 extends Du{constructor(e,t,n=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(qn.DEFAULT_UP),this.updateMatrix(),this.target=new qn,this.distance=n,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new hZ}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const nN=new nn,Jm=new Ce,Gw=new Ce;class dZ extends hR{constructor(){super(new Ji(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new xt(4,2),this._viewportCount=6,this._viewports=[new Gn(2,1,1,1),new Gn(0,1,1,1),new Gn(3,1,1,1),new Gn(1,1,1,1),new Gn(3,0,1,1),new Gn(1,0,1,1)],this._cubeDirections=[new Ce(1,0,0),new Ce(-1,0,0),new Ce(0,0,1),new Ce(0,0,-1),new Ce(0,1,0),new Ce(0,-1,0)],this._cubeUps=[new Ce(0,1,0),new Ce(0,1,0),new Ce(0,1,0),new Ce(0,1,0),new Ce(0,0,1),new Ce(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),Jm.setFromMatrixPosition(e.matrixWorld),n.position.copy(Jm),Gw.copy(n.position),Gw.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Gw),n.updateMatrixWorld(),r.makeTranslation(-Jm.x,-Jm.y,-Jm.z),nN.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nN)}}class q6 extends Du{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new dZ}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}let fZ=class extends hR{constructor(){super(new vd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},dR=class extends Du{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(qn.DEFAULT_UP),this.updateMatrix(),this.target=new qn,this.shadow=new fZ}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},fR=class extends Du{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}};class Y6 extends Du{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class K6{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Ce)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const n=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-r*r)}}class Z6 extends Du{constructor(e=new K6,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class gS extends Qs{constructor(e){super(e),this.textures={}}load(e,t,n,r){const s=this,o=new cc(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const r=gS.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new kt().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=n(o.value);break;case"c":r.uniforms[s].value=new kt().setHex(o.value);break;case"v2":r.uniforms[s].value=new xt().fromArray(o.value);break;case"v3":r.uniforms[s].value=new Ce().fromArray(o.value);break;case"v4":r.uniforms[s].value=new Gn().fromArray(o.value);break;case"m3":r.uniforms[s].value=new yn().fromArray(o.value);break;case"m4":r.uniforms[s].value=new nn().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=n(e.map)),e.matcap!==void 0&&(r.matcap=n(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new xt().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new xt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:L6,SpriteMaterial:ZP,RawShaderMaterial:D6,ShaderMaterial:dl,PointsMaterial:JP,MeshPhysicalMaterial:eb,MeshStandardMaterial:H0,MeshPhongMaterial:N6,MeshToonMaterial:F6,MeshNormalMaterial:k6,MeshLambertMaterial:U6,MeshDepthMaterial:Jb,MeshDistanceMaterial:eS,MeshBasicMaterial:qo,MeshMatcapMaterial:O6,LineDashedMaterial:B6,LineBasicMaterial:Is,Material:Or};return new t[e]}}class PT{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class pR extends xn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Q6 extends Qs{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new cc(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):console.error(l),s.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(f,m){if(t[m]!==void 0)return t[m];const v=f.interleavedBuffers[m],g=s(f,v.buffer),b=Jf(v.type,g),p=new nS(b,v.stride);return p.uuid=v.uuid,t[m]=p,p}function s(f,m){if(n[m]!==void 0)return n[m];const v=f.arrayBuffers[m],g=new Uint32Array(v).buffer;return n[m]=g,g}const o=e.isInstancedBufferGeometry?new pR:new xn,a=e.data.index;if(a!==void 0){const f=Jf(a.type,a.array);o.setIndex(new En(f,1))}const l=e.data.attributes;for(const f in l){const m=l[f];let _;if(m.isInterleavedBufferAttribute){const v=r(e.data,m.data);_=new sd(v,m.itemSize,m.offset,m.normalized)}else{const v=Jf(m.type,m.array),g=m.isInstancedBufferAttribute?od:En;_=new g(v,m.itemSize,m.normalized)}m.name!==void 0&&(_.name=m.name),m.usage!==void 0&&_.setUsage(m.usage),o.setAttribute(f,_)}const c=e.data.morphAttributes;if(c)for(const f in c){const m=c[f],_=[];for(let v=0,g=m.length;v<g;v++){const b=m[v];let p;if(b.isInterleavedBufferAttribute){const y=r(e.data,b.data);p=new sd(y,b.itemSize,b.offset,b.normalized)}else{const y=Jf(b.type,b.array);p=new En(y,b.itemSize,b.normalized)}b.name!==void 0&&(p.name=b.name),_.push(p)}o.morphAttributes[f]=_}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let f=0,m=h.length;f!==m;++f){const _=h[f];o.addGroup(_.start,_.count,_.materialIndex)}const d=e.data.boundingSphere;if(d!==void 0){const f=new Ce;d.center!==void 0&&f.fromArray(d.center),o.boundingSphere=new kr(f,d.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class pZ extends Qs{constructor(e){super(e)}load(e,t,n,r){const s=this,o=this.path===""?PT.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new cc(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){r!==void 0&&r(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,t)},n,r)}async loadAsync(e,t){const n=this,r=this.path===""?PT.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new cc(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(a)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,s,l,a,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),t!==void 0){let h=!1;for(const d in o)if(o[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(e){const t={};if(e!==void 0)for(let n=0,r=e.length;n<r;n++){const s=new $h().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new iS().fromJSON(e[s],r);n[a.uuid]=a}return n}parseGeometries(e,t){const n={};if(e!==void 0){const r=new Q6;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;default:l.type in JD?a=JD[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),n[l.uuid]=a}}return n}parseMaterials(e,t){const n={},r={};if(e!==void 0){const s=new gS;s.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];n[l.uuid]===void 0&&(n[l.uuid]=s.parse(l)),r[l.uuid]=n[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const r=e[n],s=j0.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const n=this,r={};let s;function o(l){return n.manager.itemStart(l),s.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return o(u)}else return l.data?{data:Jf(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new uR(t);s=new X0(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],d=h.url;if(Array.isArray(d)){const f=[];for(let m=0,_=d.length;m<_;m++){const v=d[m],g=a(v);g!==null&&(g instanceof HTMLImageElement?f.push(g):f.push(new Hh(g.data,g.width,g.height)))}r[h.uuid]=new Nh(f)}else{const f=a(h.url);r[h.uuid]=new Nh(f)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:Jf(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new X0(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h],m=await s(f);m!==null&&(m instanceof HTMLImageElement?u.push(m):u.push(new Hh(m.data,m.width,m.height)))}n[l.uuid]=new Nh(u)}else{const u=await s(l.url);n[l.uuid]=new Nh(u)}}}return n}parseTextures(e,t){function n(s,o){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let u;Array.isArray(c)?(u=new m1,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Hh:u=new Tr,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=a.uuid,a.name!==void 0&&(u.name=a.name),a.mapping!==void 0&&(u.mapping=n(a.mapping,mZ)),a.channel!==void 0&&(u.channel=a.channel),a.offset!==void 0&&u.offset.fromArray(a.offset),a.repeat!==void 0&&u.repeat.fromArray(a.repeat),a.center!==void 0&&u.center.fromArray(a.center),a.rotation!==void 0&&(u.rotation=a.rotation),a.wrap!==void 0&&(u.wrapS=n(a.wrap[0],iN),u.wrapT=n(a.wrap[1],iN)),a.format!==void 0&&(u.format=a.format),a.internalFormat!==void 0&&(u.internalFormat=a.internalFormat),a.type!==void 0&&(u.type=a.type),a.colorSpace!==void 0&&(u.colorSpace=a.colorSpace),a.encoding!==void 0&&(u.encoding=a.encoding),a.minFilter!==void 0&&(u.minFilter=n(a.minFilter,rN)),a.magFilter!==void 0&&(u.magFilter=n(a.magFilter,rN)),a.anisotropy!==void 0&&(u.anisotropy=a.anisotropy),a.flipY!==void 0&&(u.flipY=a.flipY),a.generateMipmaps!==void 0&&(u.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(u.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(u.compareFunction=a.compareFunction),a.userData!==void 0&&(u.userData=a.userData),r[a.uuid]=u}return r}parseObject(e,t,n,r,s){let o;function a(d){return t[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),t[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const f=[];for(let m=0,_=d.length;m<_;m++){const v=d[m];n[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),f.push(n[v])}return f}return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),n[d]}}function c(d){return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),r[d]}let u,h;switch(e.type){case"Scene":o=new KP,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new kt(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new e6(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new tS(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":o=new Ji(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new vd(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new fR(e.color,e.intensity);break;case"DirectionalLight":o=new dR(e.color,e.intensity);break;case"PointLight":o=new q6(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new Y6(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new X6(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new j6(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new Z6().fromJSON(e);break;case"SkinnedMesh":u=a(e.geometry),h=l(e.material),o=new s6(u,h),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),h=l(e.material),o=new gi(u,h);break;case"InstancedMesh":u=a(e.geometry),h=l(e.material);const d=e.count,f=e.instanceMatrix,m=e.instanceColor;o=new o6(u,h,d),o.instanceMatrix=new od(new Float32Array(f.array),16),m!==void 0&&(o.instanceColor=new od(new Float32Array(m.array),m.itemSize));break;case"BatchedMesh":u=a(e.geometry),h=l(e.material),o=new a6(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,h),o.geometry=u,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._visibility=e.visibility,o._active=e.active,o._bounds=e.bounds.map(_=>{const v=new Fr;v.min.fromArray(_.boxMin),v.max.fromArray(_.boxMax);const g=new kr;return g.radius=_.sphereRadius,g.center.fromArray(_.sphereCenter),{boxInitialized:_.boxInitialized,box:v,sphereInitialized:_.sphereInitialized,sphere:g}}),o._maxGeometryCount=e.maxGeometryCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._geometryCount=e.geometryCount,o._matricesTexture=c(e.matricesTexture.uuid);break;case"LOD":o=new r6;break;case"Line":o=new Au(a(e.geometry),l(e.material));break;case"LineLoop":o=new l6(a(e.geometry),l(e.material));break;case"LineSegments":o=new ml(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new c6(a(e.geometry),l(e.material));break;case"Sprite":o=new i6(l(e.material));break;case"Group":o=new Kl;break;case"Bone":o=new QP;break;default:o=new qn}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let f=0;f<d.length;f++)o.add(this.parseObject(d[f],t,n,r,s))}if(e.animations!==void 0){const d=e.animations;for(let f=0;f<d.length;f++){const m=d[f];o.animations.push(s[m])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const d=e.levels;for(let f=0;f<d.length;f++){const m=d[f],_=o.getObjectByProperty("uuid",m.object);_!==void 0&&o.addLevel(_,m.distance,m.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const r=t[n.skeleton];r===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(r,n.bindMatrix)}})}}const mZ={UVMapping:Xb,CubeReflectionMapping:lc,CubeRefractionMapping:wu,EquirectangularReflectionMapping:T0,EquirectangularRefractionMapping:C0,CubeUVReflectionMapping:Zp},iN={RepeatWrapping:P0,ClampToEdgeWrapping:ns,MirroredRepeatWrapping:R0},rN={NearestFilter:Gi,NearestMipmapNearestFilter:Kx,NearestMipmapLinearFilter:Xg,LinearFilter:Mi,LinearMipmapNearestFilter:PP,LinearMipmapLinearFilter:Mu};class gZ extends Qs{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Zl.get(e);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(c=>{t&&t(c),s.manager.itemEnd(e)}).catch(c=>{r&&r(c)});return}return setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Zl.add(e,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){r&&r(c),Zl.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Zl.add(e,l),s.manager.itemStart(e)}}let A_;class mR{static getContext(){return A_===void 0&&(A_=new(window.AudioContext||window.webkitAudioContext)),A_}static setContext(e){A_=e}}class vZ extends Qs{constructor(e){super(e)}load(e,t,n,r){const s=this,o=new cc(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);mR.getContext().decodeAudioData(c,function(h){t(h)}).catch(a)}catch(c){a(c)}},n,r);function a(l){r?r(l):console.error(l),s.manager.itemError(e)}}}const sN=new nn,oN=new nn,nh=new nn;let _Z=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ji,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ji,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,nh.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(Gh*t.fov*.5)/t.zoom;let a,l;oN.elements[12]=-r,sN.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,nh.elements[0]=2*t.near/(l-a),nh.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(nh),a=-o*t.aspect-s,l=o*t.aspect-s,nh.elements[0]=2*t.near/(l-a),nh.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(nh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(oN),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(sN)}};class gR{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=aN(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=aN();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function aN(){return(typeof performance>"u"?Date:performance).now()}const ih=new Ce,lN=new As,yZ=new Ce,rh=new Ce;class xZ extends qn{constructor(){super(),this.type="AudioListener",this.context=mR.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new gR}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ih,lN,yZ),rh.set(0,0,-1).applyQuaternion(lN),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ih.x,r),t.positionY.linearRampToValueAtTime(ih.y,r),t.positionZ.linearRampToValueAtTime(ih.z,r),t.forwardX.linearRampToValueAtTime(rh.x,r),t.forwardY.linearRampToValueAtTime(rh.y,r),t.forwardZ.linearRampToValueAtTime(rh.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(ih.x,ih.y,ih.z),t.setOrientation(rh.x,rh.y,rh.z,n.x,n.y,n.z)}}class J6 extends qn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const sh=new Ce,cN=new As,bZ=new Ce,oh=new Ce;class SZ extends J6{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(sh,cN,bZ),oh.set(0,0,1).applyQuaternion(cN);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(sh.x,n),t.positionY.linearRampToValueAtTime(sh.y,n),t.positionZ.linearRampToValueAtTime(sh.z,n),t.orientationX.linearRampToValueAtTime(oh.x,n),t.orientationY.linearRampToValueAtTime(oh.y,n),t.orientationZ.linearRampToValueAtTime(oh.z,n)}else t.setPosition(sh.x,sh.y,sh.z),t.setOrientation(oh.x,oh.y,oh.z)}}class wZ{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class e8{constructor(e,t,n){this.binding=e,this.valueSize=n;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)n[s+a]=n[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(n,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(n,r,l,1-s,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(n[l]!==n[l+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let s=n,o=r;s!==o;++s)t[s]=t[r+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[n+o]}_slerp(e,t,n,r){As.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,s){const o=this._workIndex*s;As.multiplyQuaternionsFlat(e,o,e,t,e,n),As.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[n+a]*r}}_lerpAdditive(e,t,n,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[n+o]*r}}}const vR="\\[\\]\\.:\\/",MZ=new RegExp("["+vR+"]","g"),_R="[^"+vR+"]",AZ="[^"+vR.replace("\\.","")+"]",EZ=/((?:WC+[\/:])*)/.source.replace("WC",_R),TZ=/(WCOD+)?/.source.replace("WCOD",AZ),CZ=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_R),PZ=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_R),RZ=new RegExp("^"+EZ+TZ+CZ+PZ+"$"),IZ=["material","materials","bones","map"];class LZ{constructor(e,t,n){const r=n||Tn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Tn{constructor(e,t,n){this.path=t,this.parsedPath=n||Tn.parseTrackName(t),this.node=Tn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Tn.Composite(e,t,n):new Tn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(MZ,"")}static parseTrackName(e){const t=RZ.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=n.nodeName.substring(r+1);IZ.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=n(a.children);if(l)return l}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,s=n.length;r!==s;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=Tn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Tn.Composite=LZ;Tn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Tn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Tn.prototype.GetterByBindingType=[Tn.prototype._getValue_direct,Tn.prototype._getValue_array,Tn.prototype._getValue_arrayElement,Tn.prototype._getValue_toArray];Tn.prototype.SetterByBindingTypeAndVersioning=[[Tn.prototype._setValue_direct,Tn.prototype._setValue_direct_setNeedsUpdate,Tn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Tn.prototype._setValue_array,Tn.prototype._setValue_array_setNeedsUpdate,Tn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Tn.prototype._setValue_arrayElement,Tn.prototype._setValue_arrayElement_setNeedsUpdate,Tn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Tn.prototype._setValue_fromArray,Tn.prototype._setValue_fromArray_setNeedsUpdate,Tn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class DZ{constructor(){this.isAnimationObjectGroup=!0,this.uuid=bo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],f=d.uuid;let m=t[f];if(m===void 0){m=l++,t[f]=m,e.push(d);for(let _=0,v=o;_!==v;++_)s[_].push(new Tn(d,n[_],r[_]))}else if(m<c){a=e[m];const _=--c,v=e[_];t[v.uuid]=m,e[m]=v,t[f]=_,e[_]=d;for(let g=0,b=o;g!==b;++g){const p=s[g],y=p[_];let A=p[m];p[m]=y,A===void 0&&(A=new Tn(d,n[g],r[g])),p[_]=A}}else e[m]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,u=t[c];if(u!==void 0&&u>=s){const h=s++,d=e[h];t[d.uuid]=u,e[u]=d,t[c]=h,e[h]=l;for(let f=0,m=r;f!==m;++f){const _=n[f],v=_[h],g=_[u];_[u]=v,_[h]=g}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],u=c.uuid,h=t[u];if(h!==void 0)if(delete t[u],h<s){const d=--s,f=e[d],m=--o,_=e[m];t[f.uuid]=h,e[h]=f,t[_.uuid]=d,e[d]=_,e.pop();for(let v=0,g=r;v!==g;++v){const b=n[v],p=b[d],y=b[m];b[h]=p,b[d]=y,b.pop()}}else{const d=--o,f=e[d];d>0&&(t[f.uuid]=h),e[h]=f,e.pop();for(let m=0,_=r;m!==_;++m){const v=n[m];v[h]=v[d],v.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);r=s.length,n[e]=r,o.push(e),a.push(t),s.push(h);for(let d=u,f=l.length;d!==f;++d){const m=l[d];h[d]=new Tn(m,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=n,o[n]=l,o.pop(),s[n]=s[a],s.pop(),r[n]=r[a],r.pop()}}}class t8{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:Lh,endingEnd:Lh};for(let c=0;c!==o;++c){const u=s[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=yz,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*n;l<0||n===0?t=0:(this._startTime=null,t=n*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case UP:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);break;case Yb:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,s=this._loopCount;const o=n===xz;if(e===0)return s===-1?r:o&&(s&1)===1?t-r:r;if(n===_z){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=Dh,r.endingEnd=Dh):(e?r.endingStart=this.zeroSlopeAtStart?Dh:Lh:r.endingStart=D0,t?r.endingEnd=this.zeroSlopeAtEnd?Dh:Lh:r.endingEnd=D0)}_scheduleFading(e,t,n){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=n,this}}const NZ=new Float32Array(1);class FZ extends gc{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=r[h],f=d.name;let m=u[f];if(m!==void 0)++m.referenceCount,o[h]=m;else{if(m=o[h],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,l,f));continue}const _=t&&t._propertyBindings[h].binding.parsedPath;m=new e8(Tn.create(n,f,_),d.ValueTypeName,d.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,l,f),o[h]=m}a[h].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,n)}const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=a.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,a=o[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new lR(new Float32Array(2),new Float32Array(2),1,NZ),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?j0.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(n===void 0&&(o!==null?n=o.blendMode:n=Yb),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===n)return h;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const u=new t8(this,o,t,n);return this._bindAction(u,c),this._addInactiveAction(u,a,s),u}existingAction(e,t){const n=t||this._root,r=n.uuid,s=typeof e=="string"?j0.findByName(n,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==n;++c)t[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const u=c._cacheIndex,h=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}let kZ=class n8{constructor(e){this.value=e}clone(){return new n8(this.value.clone===void 0?this.value:this.value.clone())}},UZ=0;class OZ extends gc{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:UZ++}),this.name="",this.usage=U0,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,r=t.length;n<r;n++){const s=Array.isArray(t[n])?t[n]:[t[n]];for(let o=0;o<s.length;o++)this.uniforms.push(s[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class BZ extends nS{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class zZ{constructor(e,t,n,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class i8{constructor(e,t,n=0,r=1/0){this.ray=new Qp(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Vh,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return RT(e,this,n,t),n.sort(uN),n}intersectObjects(e,t=!0,n=[]){for(let r=0,s=e.length;r<s;r++)RT(e[r],this,n,t);return n.sort(uN),n}}function uN(i,e){return i.distance-e.distance}function RT(i,e,t,n){if(i.layers.test(e.layers)&&i.raycast(e,t),n===!0){const r=i.children;for(let s=0,o=r.length;s<o;s++)RT(r[s],e,t,!0)}}class GZ{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Ni(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class VZ{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const hN=new xt;class HZ{constructor(e=new xt(1/0,1/0),t=new xt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=hN.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,hN).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const dN=new Ce,E_=new Ce;class $Z{constructor(e=new Ce,t=new Ce){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){dN.subVectors(e,this.start),E_.subVectors(this.end,this.start);const n=E_.dot(E_);let s=E_.dot(dN)/n;return t&&(s=Ni(s,0,1)),s}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const fN=new Ce;class WZ extends qn{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new xn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,u=a/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new Wt(r,3));const s=new Is({fog:!1,toneMapped:!1});this.cone=new ml(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),fN.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(fN),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const kc=new Ce,T_=new nn,Vw=new nn;class jZ extends ml{constructor(e){const t=r8(e),n=new xn,r=[],s=[],o=new kt(0,0,1),a=new kt(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}n.setAttribute("position",new Wt(r,3)),n.setAttribute("color",new Wt(s,3));const l=new Is({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Vw.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(T_.multiplyMatrices(Vw,a.matrixWorld),kc.setFromMatrixPosition(T_),r.setXYZ(o,kc.x,kc.y,kc.z),T_.multiplyMatrices(Vw,a.parent.matrixWorld),kc.setFromMatrixPosition(T_),r.setXYZ(o+1,kc.x,kc.y,kc.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function r8(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,r8(i.children[t]));return e}class XZ extends gi{constructor(e,t,n){const r=new _1(t,4,2),s=new qo({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const qZ=new Ce,pN=new kt,mN=new kt;class YZ extends qn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new oR(t);r.rotateY(Math.PI*.5),this.material=new qo({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new En(o,3)),this.add(new gi(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");pN.copy(this.light.color),mN.copy(this.light.groundColor);for(let n=0,r=t.count;n<r;n++){const s=n<r/2?pN:mN;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(qZ.setFromMatrixPosition(this.light.matrixWorld).negate())}}class KZ extends ml{constructor(e=10,t=10,n=4473924,r=8947848){n=new kt(n),r=new kt(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let d=0,f=0,m=-a;d<=t;d++,m+=o){l.push(-a,0,m,a,0,m),l.push(m,0,-a,m,0,a);const _=d===s?n:r;_.toArray(c,f),f+=3,_.toArray(c,f),f+=3,_.toArray(c,f),f+=3,_.toArray(c,f),f+=3}const u=new xn;u.setAttribute("position",new Wt(l,3)),u.setAttribute("color",new Wt(c,3));const h=new Is({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class ZZ extends ml{constructor(e=10,t=16,n=8,r=64,s=4473924,o=8947848){s=new kt(s),o=new kt(o);const a=[],l=[];if(t>1)for(let h=0;h<t;h++){const d=h/t*(Math.PI*2),f=Math.sin(d)*e,m=Math.cos(d)*e;a.push(0,0,0),a.push(f,0,m);const _=h&1?s:o;l.push(_.r,_.g,_.b),l.push(_.r,_.g,_.b)}for(let h=0;h<n;h++){const d=h&1?s:o,f=e-e/n*h;for(let m=0;m<r;m++){let _=m/r*(Math.PI*2),v=Math.sin(_)*f,g=Math.cos(_)*f;a.push(v,0,g),l.push(d.r,d.g,d.b),_=(m+1)/r*(Math.PI*2),v=Math.sin(_)*f,g=Math.cos(_)*f,a.push(v,0,g),l.push(d.r,d.g,d.b)}}const c=new xn;c.setAttribute("position",new Wt(a,3)),c.setAttribute("color",new Wt(l,3));const u=new Is({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const gN=new Ce,C_=new Ce,vN=new Ce;class QZ extends qn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new xn;r.setAttribute("position",new Wt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Is({fog:!1,toneMapped:!1});this.lightPlane=new Au(r,s),this.add(this.lightPlane),r=new xn,r.setAttribute("position",new Wt([0,0,0,0,0,1],3)),this.targetLine=new Au(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),gN.setFromMatrixPosition(this.light.matrixWorld),C_.setFromMatrixPosition(this.light.target.matrixWorld),vN.subVectors(C_,gN),this.lightPlane.lookAt(C_),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(C_),this.targetLine.scale.z=vN.length()}}const P_=new Ce,Ri=new p1;class JZ extends ml{constructor(e){const t=new xn,n=new Is({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(m,_){l(m),l(_)}function l(m){r.push(0,0,0),s.push(0,0,0),o[m]===void 0&&(o[m]=[]),o[m].push(r.length/3-1)}t.setAttribute("position",new Wt(r,3)),t.setAttribute("color",new Wt(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new kt(16755200),u=new kt(16711680),h=new kt(43775),d=new kt(16777215),f=new kt(3355443);this.setColors(c,u,h,d,f)}setColors(e,t,n,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,r=1;Ri.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Oi("c",t,e,Ri,0,0,-1),Oi("t",t,e,Ri,0,0,1),Oi("n1",t,e,Ri,-n,-r,-1),Oi("n2",t,e,Ri,n,-r,-1),Oi("n3",t,e,Ri,-n,r,-1),Oi("n4",t,e,Ri,n,r,-1),Oi("f1",t,e,Ri,-n,-r,1),Oi("f2",t,e,Ri,n,-r,1),Oi("f3",t,e,Ri,-n,r,1),Oi("f4",t,e,Ri,n,r,1),Oi("u1",t,e,Ri,n*.7,r*1.1,-1),Oi("u2",t,e,Ri,-n*.7,r*1.1,-1),Oi("u3",t,e,Ri,0,r*2,-1),Oi("cf1",t,e,Ri,-n,0,1),Oi("cf2",t,e,Ri,n,0,1),Oi("cf3",t,e,Ri,0,-r,1),Oi("cf4",t,e,Ri,0,r,1),Oi("cn1",t,e,Ri,-n,0,-1),Oi("cn2",t,e,Ri,n,0,-1),Oi("cn3",t,e,Ri,0,-r,-1),Oi("cn4",t,e,Ri,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Oi(i,e,t,n,r,s,o){P_.set(r,s,o).unproject(n);const a=e[i];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],P_.x,P_.y,P_.z)}}const R_=new Fr;class eQ extends ml{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new xn;s.setIndex(new En(n,1)),s.setAttribute("position",new En(r,3)),super(s,new Is({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&R_.setFromObject(this.object),R_.isEmpty())return;const t=R_.min,n=R_.max,r=this.geometry.attributes.position,s=r.array;s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=t.x,s[4]=n.y,s[5]=n.z,s[6]=t.x,s[7]=t.y,s[8]=n.z,s[9]=n.x,s[10]=t.y,s[11]=n.z,s[12]=n.x,s[13]=n.y,s[14]=t.z,s[15]=t.x,s[16]=n.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=n.x,s[22]=t.y,s[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class tQ extends ml{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new xn;s.setIndex(new En(n,1)),s.setAttribute("position",new Wt(r,3)),super(s,new Is({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class nQ extends Au{constructor(e,t=1,n=16776960){const r=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new xn;o.setAttribute("position",new Wt(s,3)),o.computeBoundingSphere(),super(o,new Is({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new xn;l.setAttribute("position",new Wt(a,3)),l.computeBoundingSphere(),this.add(new gi(l,new qo({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _N=new Ce;let I_,Hw;class iQ extends qn{constructor(e=new Ce(0,0,1),t=new Ce(0,0,0),n=1,r=16776960,s=n*.2,o=s*.2){super(),this.type="ArrowHelper",I_===void 0&&(I_=new xn,I_.setAttribute("position",new Wt([0,0,0,0,1,0],3)),Hw=new lS(0,.5,1,5,1),Hw.translate(0,-.5,0)),this.position.copy(t),this.line=new Au(I_,new Is({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new gi(Hw,new qo({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{_N.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(_N,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class rQ extends ml{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new xn;r.setAttribute("position",new Wt(t,3)),r.setAttribute("color",new Wt(n,3));const s=new Is({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,n){const r=new kt,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(n),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class sQ{constructor(){this.type="ShapePath",this.color=new kt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new B0,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,s,o){return this.currentPath.bezierCurveTo(e,t,n,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(g){const b=[];for(let p=0,y=g.length;p<y;p++){const A=g[p],w=new $h;w.curves=A.curves,b.push(w)}return b}function n(g,b){const p=b.length;let y=!1;for(let A=p-1,w=0;w<p;A=w++){let M=b[A],T=b[w],E=T.x-M.x,C=T.y-M.y;if(Math.abs(C)>Number.EPSILON){if(C<0&&(M=b[w],E=-E,T=b[A],C=-C),g.y<M.y||g.y>T.y)continue;if(g.y===M.y){if(g.x===M.x)return!0}else{const N=C*(g.x-M.x)-E*(g.y-M.y);if(N===0)return!0;if(N<0)continue;y=!y}}else{if(g.y!==M.y)continue;if(T.x<=g.x&&g.x<=M.x||M.x<=g.x&&g.x<=T.x)return!0}}return y}const r=sl.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,a,l;const c=[];if(s.length===1)return a=s[0],l=new $h,l.curves=a.curves,c.push(l),c;let u=!r(s[0].getPoints());u=e?!u:u;const h=[],d=[];let f=[],m=0,_;d[m]=void 0,f[m]=[];for(let g=0,b=s.length;g<b;g++)a=s[g],_=a.getPoints(),o=r(_),o=e?!o:o,o?(!u&&d[m]&&m++,d[m]={s:new $h,p:_},d[m].s.curves=a.curves,u&&m++,f[m]=[]):f[m].push({h:a,p:_[0]});if(!d[0])return t(s);if(d.length>1){let g=!1,b=0;for(let p=0,y=d.length;p<y;p++)h[p]=[];for(let p=0,y=d.length;p<y;p++){const A=f[p];for(let w=0;w<A.length;w++){const M=A[w];let T=!0;for(let E=0;E<d.length;E++)n(M.p,d[E].p)&&(p!==E&&b++,T?(T=!1,h[E].push(M)):g=!0);T&&h[p].push(M)}}b>0&&g===!1&&(f=h)}let v;for(let g=0,b=d.length;g<b;g++){l=d[g].s,c.push(l),v=f[g];for(let p=0,y=v.length;p<y;p++)l.holes.push(v[p].h)}return c}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Wb}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Wb);const oQ=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:CP,AddEquation:eu,AddOperation:iz,AdditiveAnimationBlendMode:UP,AdditiveBlending:VE,AgXToneMapping:lz,AlphaFormat:dz,AlwaysCompare:Pz,AlwaysDepth:KB,AlwaysStencilFunc:yT,AmbientLight:fR,AnimationAction:t8,AnimationClip:j0,AnimationLoader:oZ,AnimationMixer:FZ,AnimationObjectGroup:DZ,AnimationUtils:nZ,ArcCurve:h6,ArrayCamera:Qz,ArrowHelper:iQ,AttachedBindMode:XE,Audio:J6,AudioAnalyser:wZ,AudioContext:mR,AudioListener:xZ,AudioLoader:vZ,AxesHelper:rQ,BackSide:Ms,BasicDepthPacking:bz,BasicShadowMap:LB,BatchedMesh:a6,Bone:QP,BooleanKeyframeTrack:_d,Box2:HZ,Box3:Fr,Box3Helper:tQ,BoxGeometry:f1,BoxHelper:eQ,BufferAttribute:En,BufferGeometry:xn,BufferGeometryLoader:Q6,ByteType:uz,Cache:Zl,Camera:p1,CameraHelper:JZ,CanvasTexture:u6,CapsuleGeometry:oS,CatmullRomCurve3:d6,CineonToneMapping:oz,CircleGeometry:aS,ClampToEdgeWrapping:ns,Clock:gR,Color:kt,ColorKeyframeTrack:cR,ColorManagement:On,CompressedArrayTexture:AK,CompressedCubeTexture:EK,CompressedTexture:rS,CompressedTextureLoader:aZ,ConeGeometry:v6,ConstantAlphaFactor:XB,ConstantColorFactor:WB,CubeCamera:Vz,CubeReflectionMapping:lc,CubeRefractionMapping:wu,CubeTexture:m1,CubeTextureLoader:lZ,CubeUVReflectionMapping:Zp,CubicBezierCurve:tR,CubicBezierCurve3:f6,CubicInterpolant:V6,CullFaceBack:GE,CullFaceFront:IB,CullFaceFrontBack:m9,CullFaceNone:RB,Curve:Fa,CurvePath:m6,CustomBlending:DB,CustomToneMapping:az,CylinderGeometry:lS,Cylindrical:VZ,Data3DTexture:HP,DataArrayTexture:Zb,DataTexture:Hh,DataTextureLoader:cZ,DataUtils:MW,DecrementStencilOp:T9,DecrementWrapStencilOp:P9,DefaultLoadingManager:W6,DepthFormat:pu,DepthStencilFormat:rd,DepthTexture:qP,DetachedBindMode:cz,DirectionalLight:dR,DirectionalLightHelper:QZ,DiscreteInterpolant:H6,DisplayP3ColorSpace:Kb,DodecahedronGeometry:cS,DoubleSide:ts,DstAlphaFactor:zB,DstColorFactor:VB,DynamicCopyUsage:$9,DynamicDrawUsage:O9,DynamicReadUsage:G9,EdgesGeometry:x6,EllipseCurve:sS,EqualCompare:Az,EqualDepth:QB,EqualStencilFunc:D9,EquirectangularReflectionMapping:T0,EquirectangularRefractionMapping:C0,Euler:d1,EventDispatcher:gc,ExtrudeGeometry:hS,FileLoader:cc,Float16BufferAttribute:RW,Float32BufferAttribute:Wt,Float64BufferAttribute:IW,FloatType:Ea,Fog:e6,FogExp2:tS,FramebufferTexture:MK,FrontSide:ac,Frustum:g1,GLBufferAttribute:zZ,GLSL1:j9,GLSL3:xT,GreaterCompare:Ez,GreaterDepth:ez,GreaterEqualCompare:Cz,GreaterEqualDepth:JB,GreaterEqualStencilFunc:U9,GreaterStencilFunc:F9,GridHelper:KZ,Group:Kl,HalfFloatType:Ip,HemisphereLight:j6,HemisphereLightHelper:YZ,IcosahedronGeometry:M6,ImageBitmapLoader:gZ,ImageLoader:X0,ImageUtils:VP,IncrementStencilOp:E9,IncrementWrapStencilOp:C9,InstancedBufferAttribute:od,InstancedBufferGeometry:pR,InstancedInterleavedBuffer:BZ,InstancedMesh:o6,Int16BufferAttribute:CW,Int32BufferAttribute:PW,Int8BufferAttribute:AW,IntType:RP,InterleavedBuffer:nS,InterleavedBufferAttribute:sd,Interpolant:y1,InterpolateDiscrete:I0,InterpolateLinear:L0,InterpolateSmooth:nx,InvertStencilOp:R9,KeepStencilOp:_h,KeyframeTrack:ka,LOD:r6,LatheGeometry:v1,Layers:Vh,LessCompare:Mz,LessDepth:ZB,LessEqualCompare:zP,LessEqualDepth:E0,LessEqualStencilFunc:N9,LessStencilFunc:L9,Light:Du,LightProbe:Z6,Line:Au,Line3:$Z,LineBasicMaterial:Is,LineCurve:nR,LineCurve3:p6,LineDashedMaterial:B6,LineLoop:l6,LineSegments:ml,LinearDisplayP3ColorSpace:h1,LinearEncoding:OP,LinearFilter:Mi,LinearInterpolant:lR,LinearMipMapLinearFilter:x9,LinearMipMapNearestFilter:y9,LinearMipmapLinearFilter:Mu,LinearMipmapNearestFilter:PP,LinearSRGBColorSpace:hl,LinearToneMapping:rz,LinearTransfer:N0,Loader:Qs,LoaderUtils:PT,LoadingManager:uR,LoopOnce:_z,LoopPingPong:xz,LoopRepeat:yz,LuminanceAlphaFormat:pz,LuminanceFormat:fz,MOUSE:f9,Material:Or,MaterialLoader:gS,MathUtils:Mg,Matrix3:yn,Matrix4:nn,MaxEquation:jE,Mesh:gi,MeshBasicMaterial:qo,MeshDepthMaterial:Jb,MeshDistanceMaterial:eS,MeshLambertMaterial:U6,MeshMatcapMaterial:O6,MeshNormalMaterial:k6,MeshPhongMaterial:N6,MeshPhysicalMaterial:eb,MeshStandardMaterial:H0,MeshToonMaterial:F6,MinEquation:WE,MirroredRepeatWrapping:R0,MixOperation:nz,MultiplyBlending:$E,MultiplyOperation:u1,NearestFilter:Gi,NearestMipMapLinearFilter:_9,NearestMipMapNearestFilter:v9,NearestMipmapLinearFilter:Xg,NearestMipmapNearestFilter:Kx,NeverCompare:wz,NeverDepth:YB,NeverStencilFunc:I9,NoBlending:ec,NoColorSpace:_o,NoToneMapping:il,NormalAnimationBlendMode:Yb,NormalBlending:zh,NotEqualCompare:Tz,NotEqualDepth:tz,NotEqualStencilFunc:k9,NumberKeyframeTrack:$0,Object3D:qn,ObjectLoader:pZ,ObjectSpaceNormalMap:Sz,OctahedronGeometry:oR,OneFactor:UB,OneMinusConstantAlphaFactor:qB,OneMinusConstantColorFactor:jB,OneMinusDstAlphaFactor:GB,OneMinusDstColorFactor:HB,OneMinusSrcAlphaFactor:Yx,OneMinusSrcColorFactor:BB,OrthographicCamera:vd,P3Primaries:k0,PCFShadowMap:jb,PCFSoftShadowMap:jg,PMREMGenerator:wT,Path:B0,PerspectiveCamera:Ji,Plane:qc,PlaneGeometry:gd,PlaneHelper:nQ,PointLight:q6,PointLightHelper:XZ,Points:c6,PointsMaterial:JP,PolarGridHelper:ZZ,PolyhedronGeometry:em,PositionalAudio:SZ,PropertyBinding:Tn,PropertyMixer:e8,QuadraticBezierCurve:iR,QuadraticBezierCurve3:rR,Quaternion:As,QuaternionKeyframeTrack:tm,QuaternionLinearInterpolant:$6,RED_GREEN_RGTC2_Format:vT,RED_RGTC1_Format:vz,REVISION:Wb,RGBADepthPacking:BP,RGBAFormat:Ss,RGBAIntegerFormat:FP,RGBA_ASTC_10x10_Format:hT,RGBA_ASTC_10x5_Format:lT,RGBA_ASTC_10x6_Format:cT,RGBA_ASTC_10x8_Format:uT,RGBA_ASTC_12x10_Format:dT,RGBA_ASTC_12x12_Format:fT,RGBA_ASTC_4x4_Format:eT,RGBA_ASTC_5x4_Format:tT,RGBA_ASTC_5x5_Format:nT,RGBA_ASTC_6x5_Format:iT,RGBA_ASTC_6x6_Format:rT,RGBA_ASTC_8x5_Format:sT,RGBA_ASTC_8x6_Format:oT,RGBA_ASTC_8x8_Format:aT,RGBA_BPTC_Format:tx,RGBA_ETC2_EAC_Format:JE,RGBA_PVRTC_2BPPV1_Format:ZE,RGBA_PVRTC_4BPPV1_Format:KE,RGBA_S3TC_DXT1_Format:Qy,RGBA_S3TC_DXT3_Format:Jy,RGBA_S3TC_DXT5_Format:ex,RGB_BPTC_SIGNED_Format:pT,RGB_BPTC_UNSIGNED_Format:mT,RGB_ETC1_Format:kP,RGB_ETC2_Format:QE,RGB_PVRTC_2BPPV1_Format:YE,RGB_PVRTC_4BPPV1_Format:qE,RGB_S3TC_DXT1_Format:Zy,RGFormat:gz,RGIntegerFormat:NP,RawShaderMaterial:D6,Ray:Qp,Raycaster:i8,Rec709Primaries:F0,RectAreaLight:Y6,RedFormat:mz,RedIntegerFormat:DP,ReinhardToneMapping:sz,RenderTarget:Fz,RepeatWrapping:P0,ReplaceStencilOp:A9,ReverseSubtractEquation:FB,RingGeometry:dS,SIGNED_RED_GREEN_RGTC2_Format:_T,SIGNED_RED_RGTC1_Format:gT,SRGBColorSpace:lr,SRGBTransfer:Qn,Scene:KP,ShaderChunk:cn,ShaderLib:ya,ShaderMaterial:dl,ShadowMaterial:L6,Shape:$h,ShapeGeometry:fS,ShapePath:sQ,ShapeUtils:sl,ShortType:hz,Skeleton:iS,SkeletonHelper:jZ,SkinnedMesh:s6,Source:Nh,Sphere:kr,SphereGeometry:_1,Spherical:GZ,SphericalHarmonics3:K6,SplineCurve:sR,SpotLight:X6,SpotLightHelper:WZ,Sprite:i6,SpriteMaterial:ZP,SrcAlphaFactor:qx,SrcAlphaSaturateFactor:$B,SrcColorFactor:OB,StaticCopyUsage:H9,StaticDrawUsage:U0,StaticReadUsage:z9,StereoCamera:_Z,StreamCopyUsage:W9,StreamDrawUsage:B9,StreamReadUsage:V9,StringKeyframeTrack:yd,SubtractEquation:NB,SubtractiveBlending:HE,TOUCH:p9,TangentSpaceNormalMap:Lu,TetrahedronGeometry:T6,Texture:Tr,TextureLoader:uZ,TorusGeometry:P6,TorusKnotGeometry:pS,Triangle:Fh,TriangleFanDrawMode:w9,TriangleStripDrawMode:S9,TrianglesDrawMode:b9,TubeGeometry:mS,TwoPassDoubleSide:g9,UVMapping:Xb,Uint16BufferAttribute:$P,Uint32BufferAttribute:WP,Uint8BufferAttribute:EW,Uint8ClampedBufferAttribute:TW,Uniform:kZ,UniformsGroup:OZ,UniformsLib:Nt,UniformsUtils:jP,UnsignedByteType:rl,UnsignedInt248Type:fu,UnsignedIntType:Yl,UnsignedShort4444Type:IP,UnsignedShort5551Type:LP,UnsignedShortType:qb,VSMShadowMap:ma,Vector2:xt,Vector3:Ce,Vector4:Gn,VectorKeyframeTrack:W0,VideoTexture:wK,WebGL1Renderer:Jz,WebGL3DRenderTarget:dW,WebGLArrayRenderTarget:hW,WebGLCoordinateSystem:Ta,WebGLCubeRenderTarget:Hz,WebGLMultipleRenderTargets:fW,WebGLRenderTarget:Na,WebGLRenderer:YP,WebGLUtils:Zz,WebGPUCoordinateSystem:Lp,WireframeGeometry:I6,WrapAroundEnding:D0,ZeroCurvatureEnding:Lh,ZeroFactor:kB,ZeroSlopeEnding:Dh,ZeroStencilOp:M9,_SRGBAFormat:Zx,createCanvasElement:Dz,sRGBEncoding:mu},Symbol.toStringTag,{value:"Module"}));var s8={exports:{}},xd={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */xd.ConcurrentRoot=1;xd.ContinuousEventPriority=4;xd.DefaultEventPriority=16;xd.DiscreteEventPriority=1;xd.IdleEventPriority=536870912;xd.LegacyRoot=0;s8.exports=xd;var ip=s8.exports;function aQ(i){let e;const t=new Set,n=(c,u)=>{const h=typeof c=="function"?c(e):c;if(h!==e){const d=e;e=u?h:Object.assign({},e,h),t.forEach(f=>f(e,d))}},r=()=>e,s=(c,u=r,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(e);function f(){const m=u(e);if(!h(d,m)){const _=d;c(d=m,_)}}return t.add(f),()=>t.delete(f)},l={setState:n,getState:r,subscribe:(c,u,h)=>u||h?s(c,u,h):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=i(n,r,l),l}const lQ=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),yN=lQ?Ge.useEffect:Ge.useLayoutEffect;function cQ(i){const e=typeof i=="function"?aQ(i):i,t=(n=e.getState,r=Object.is)=>{const[,s]=Ge.useReducer(v=>v+1,0),o=e.getState(),a=Ge.useRef(o),l=Ge.useRef(n),c=Ge.useRef(r),u=Ge.useRef(!1),h=Ge.useRef();h.current===void 0&&(h.current=n(o));let d,f=!1;(a.current!==o||l.current!==n||c.current!==r||u.current)&&(d=n(o),f=!r(h.current,d)),yN(()=>{f&&(h.current=d),a.current=o,l.current=n,c.current=r,u.current=!1});const m=Ge.useRef(o);yN(()=>{const v=()=>{try{const b=e.getState(),p=l.current(b);c.current(h.current,p)||(a.current=b,h.current=p,s())}catch{u.current=!0,s()}},g=e.subscribe(v);return e.getState()!==m.current&&v(),g},[]);const _=f?d:h.current;return Ge.useDebugValue(_),_};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const r=n.length<=0;return{value:n.shift(),done:r}}}},t}const uQ=i=>typeof i=="object"&&typeof i.then=="function",L_=[];function hQ(i,e,t=(n,r)=>n===r){if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let r=0;r<n;r++)if(!t(i[r],e[r]))return!1;return!0}function dQ(i,e=null,t=!1,n={}){e===null&&(e=[i]);for(const s of L_)if(hQ(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const r={keys:e,equal:n.equal,remove:()=>{const s=L_.indexOf(r);s!==-1&&L_.splice(s,1)},promise:(uQ(i)?i:i(...e)).then(s=>{r.response=s,n.lifespan&&n.lifespan>0&&(r.timeout=setTimeout(r.remove,n.lifespan))}).catch(s=>r.error=s)};if(L_.push(r),!t)throw r.promise}const fQ=(i,e,t)=>dQ(i,e,!1,t);var o8={exports:{}},a8={exports:{}},l8={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(U,G){var B=U.length;U.push(G);e:for(;0<B;){var D=B-1>>>1,O=U[D];if(0<r(O,G))U[D]=G,U[B]=O,B=D;else break e}}function t(U){return U.length===0?null:U[0]}function n(U){if(U.length===0)return null;var G=U[0],B=U.pop();if(B!==G){U[0]=B;e:for(var D=0,O=U.length,j=O>>>1;D<j;){var q=2*(D+1)-1,Y=U[q],ie=q+1,ne=U[ie];if(0>r(Y,B))ie<O&&0>r(ne,Y)?(U[D]=ne,U[ie]=B,D=ie):(U[D]=Y,U[q]=B,D=q);else if(ie<O&&0>r(ne,B))U[D]=ne,U[ie]=B,D=ie;else break e}}return G}function r(U,G){var B=U.sortIndex-G.sortIndex;return B!==0?B:U.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;i.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();i.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,d=3,f=!1,m=!1,_=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function p(U){for(var G=t(c);G!==null;){if(G.callback===null)n(c);else if(G.startTime<=U)n(c),G.sortIndex=G.expirationTime,e(l,G);else break;G=t(c)}}function y(U){if(_=!1,p(U),!m)if(t(l)!==null)m=!0,V(A);else{var G=t(c);G!==null&&z(y,G.startTime-U)}}function A(U,G){m=!1,_&&(_=!1,g(T),T=-1),f=!0;var B=d;try{for(p(G),h=t(l);h!==null&&(!(h.expirationTime>G)||U&&!N());){var D=h.callback;if(typeof D=="function"){h.callback=null,d=h.priorityLevel;var O=D(h.expirationTime<=G);G=i.unstable_now(),typeof O=="function"?h.callback=O:h===t(l)&&n(l),p(G)}else n(l);h=t(l)}if(h!==null)var j=!0;else{var q=t(c);q!==null&&z(y,q.startTime-G),j=!1}return j}finally{h=null,d=B,f=!1}}var w=!1,M=null,T=-1,E=5,C=-1;function N(){return!(i.unstable_now()-C<E)}function P(){if(M!==null){var U=i.unstable_now();C=U;var G=!0;try{G=M(!0,U)}finally{G?L():(w=!1,M=null)}}else w=!1}var L;if(typeof b=="function")L=function(){b(P)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,F=R.port2;R.port1.onmessage=P,L=function(){F.postMessage(null)}}else L=function(){v(P,0)};function V(U){M=U,w||(w=!0,L())}function z(U,G){T=v(function(){U(i.unstable_now())},G)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(U){U.callback=null},i.unstable_continueExecution=function(){m||f||(m=!0,V(A))},i.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<U?Math.floor(1e3/U):5},i.unstable_getCurrentPriorityLevel=function(){return d},i.unstable_getFirstCallbackNode=function(){return t(l)},i.unstable_next=function(U){switch(d){case 1:case 2:case 3:var G=3;break;default:G=d}var B=d;d=G;try{return U()}finally{d=B}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(U,G){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var B=d;d=U;try{return G()}finally{d=B}},i.unstable_scheduleCallback=function(U,G,B){var D=i.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?D+B:D):B=D,U){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=B+O,U={id:u++,callback:G,priorityLevel:U,startTime:B,expirationTime:O,sortIndex:-1},B>D?(U.sortIndex=B,e(c,U),t(l)===null&&U===t(c)&&(_?(g(T),T=-1):_=!0,z(y,B-D))):(U.sortIndex=O,e(l,U),m||f||(m=!0,V(A))),U},i.unstable_shouldYield=N,i.unstable_wrapCallback=function(U){var G=d;return function(){var B=d;d=G;try{return U.apply(this,arguments)}finally{d=B}}}})(l8);a8.exports=l8;var IT=a8.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pQ=function(e){var t={},n=Ge,r=IT,s=Object.assign;function o(x){for(var S="https://reactjs.org/docs/error-decoder.html?invariant="+x,I=1;I<arguments.length;I++)S+="&args[]="+encodeURIComponent(arguments[I]);return"Minified React error #"+x+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),m=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),A=Symbol.iterator;function w(x){return x===null||typeof x!="object"?null:(x=A&&x[A]||x["@@iterator"],typeof x=="function"?x:null)}function M(x){if(x==null)return null;if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x;switch(x){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case v:return"Suspense";case g:return"SuspenseList"}if(typeof x=="object")switch(x.$$typeof){case m:return(x.displayName||"Context")+".Consumer";case f:return(x._context.displayName||"Context")+".Provider";case _:var S=x.render;return x=x.displayName,x||(x=S.displayName||S.name||"",x=x!==""?"ForwardRef("+x+")":"ForwardRef"),x;case b:return S=x.displayName||null,S!==null?S:M(x.type)||"Memo";case p:S=x._payload,x=x._init;try{return M(x(S))}catch{}}return null}function T(x){var S=x.type;switch(x.tag){case 24:return"Cache";case 9:return(S.displayName||"Context")+".Consumer";case 10:return(S._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return x=S.render,x=x.displayName||x.name||"",S.displayName||(x!==""?"ForwardRef("+x+")":"ForwardRef");case 7:return"Fragment";case 5:return S;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return M(S);case 8:return S===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof S=="function")return S.displayName||S.name||null;if(typeof S=="string")return S}return null}function E(x){var S=x,I=x;if(x.alternate)for(;S.return;)S=S.return;else{x=S;do S=x,S.flags&4098&&(I=S.return),x=S.return;while(x)}return S.tag===3?I:null}function C(x){if(E(x)!==x)throw Error(o(188))}function N(x){var S=x.alternate;if(!S){if(S=E(x),S===null)throw Error(o(188));return S!==x?null:x}for(var I=x,k=S;;){var W=I.return;if(W===null)break;var re=W.alternate;if(re===null){if(k=W.return,k!==null){I=k;continue}break}if(W.child===re.child){for(re=W.child;re;){if(re===I)return C(W),x;if(re===k)return C(W),S;re=re.sibling}throw Error(o(188))}if(I.return!==k.return)I=W,k=re;else{for(var Fe=!1,Ke=W.child;Ke;){if(Ke===I){Fe=!0,I=W,k=re;break}if(Ke===k){Fe=!0,k=W,I=re;break}Ke=Ke.sibling}if(!Fe){for(Ke=re.child;Ke;){if(Ke===I){Fe=!0,I=re,k=W;break}if(Ke===k){Fe=!0,k=re,I=W;break}Ke=Ke.sibling}if(!Fe)throw Error(o(189))}}if(I.alternate!==k)throw Error(o(190))}if(I.tag!==3)throw Error(o(188));return I.stateNode.current===I?x:S}function P(x){return x=N(x),x!==null?L(x):null}function L(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){var S=L(x);if(S!==null)return S;x=x.sibling}return null}function R(x){if(x.tag===5||x.tag===6)return x;for(x=x.child;x!==null;){if(x.tag!==4){var S=R(x);if(S!==null)return S}x=x.sibling}return null}var F=Array.isArray,V=e.getPublicInstance,z=e.getRootHostContext,U=e.getChildHostContext,G=e.prepareForCommit,B=e.resetAfterCommit,D=e.createInstance,O=e.appendInitialChild,j=e.finalizeInitialChildren,q=e.prepareUpdate,Y=e.shouldSetTextContent,ie=e.createTextInstance,ne=e.scheduleTimeout,Q=e.cancelTimeout,le=e.noTimeout,se=e.isPrimaryRenderer,oe=e.supportsMutation,$=e.supportsPersistence,pe=e.supportsHydration,xe=e.getInstanceFromNode,Pe=e.preparePortalMount,ve=e.getCurrentEventPriority,Ue=e.detachDeletedInstance,Le=e.supportsMicrotasks,Z=e.scheduleMicrotask,J=e.supportsTestSelectors,de=e.findFiberRoot,Ie=e.getBoundingRect,te=e.getTextContent,X=e.isHiddenSubtree,ye=e.matchAccessibilityRole,ke=e.setFocusIfFocusable,ge=e.setupIntersectionObserver,De=e.appendChild,$e=e.appendChildToContainer,Ae=e.commitTextUpdate,Ze=e.commitMount,nt=e.commitUpdate,rt=e.insertBefore,Oe=e.insertInContainerBefore,qe=e.removeChild,it=e.removeChildFromContainer,at=e.resetTextContent,ht=e.hideInstance,Qe=e.hideTextInstance,je=e.unhideInstance,ee=e.unhideTextInstance,ze=e.clearContainer,Ee=e.cloneInstance,Re=e.createContainerChildSet,Xe=e.appendChildToContainerChildSet,gt=e.finalizeContainerChildren,_t=e.replaceContainerChildren,Mt=e.cloneHiddenInstance,K=e.cloneHiddenTextInstance,ae=e.canHydrateInstance,ue=e.canHydrateTextInstance,_e=e.canHydrateSuspenseInstance,be=e.isSuspenseInstancePending,Ne=e.isSuspenseInstanceFallback,Be=e.registerSuspenseInstanceRetry,He=e.getNextHydratableSibling,lt=e.getFirstHydratableChild,mt=e.getFirstHydratableChildWithinContainer,wt=e.getFirstHydratableChildWithinSuspenseInstance,zt=e.hydrateInstance,Et=e.hydrateTextInstance,bt=e.hydrateSuspenseInstance,H=e.getNextHydratableInstanceAfterSuspenseInstance,fe=e.commitHydratedContainer,Me=e.commitHydratedSuspenseInstance,Se=e.clearSuspenseBoundary,Te=e.clearSuspenseBoundaryFromContainer,et=e.shouldDeleteUnhydratedTailInstances,dt=e.didNotMatchHydratedContainerTextInstance,yt=e.didNotMatchHydratedTextInstance,Ye;function We(x){if(Ye===void 0)try{throw Error()}catch(I){var S=I.stack.trim().match(/\n( *(at )?)/);Ye=S&&S[1]||""}return`
`+Ye+x}var st=!1;function ct(x,S){if(!x||st)return"";st=!0;var I=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(S)if(S=function(){throw Error()},Object.defineProperty(S.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(S,[])}catch(Pt){var k=Pt}Reflect.construct(x,[],S)}else{try{S.call()}catch(Pt){k=Pt}x.call(S.prototype)}else{try{throw Error()}catch(Pt){k=Pt}x()}}catch(Pt){if(Pt&&k&&typeof Pt.stack=="string"){for(var W=Pt.stack.split(`
`),re=k.stack.split(`
`),Fe=W.length-1,Ke=re.length-1;1<=Fe&&0<=Ke&&W[Fe]!==re[Ke];)Ke--;for(;1<=Fe&&0<=Ke;Fe--,Ke--)if(W[Fe]!==re[Ke]){if(Fe!==1||Ke!==1)do if(Fe--,Ke--,0>Ke||W[Fe]!==re[Ke]){var ft=`
`+W[Fe].replace(" at new "," at ");return x.displayName&&ft.includes("<anonymous>")&&(ft=ft.replace("<anonymous>",x.displayName)),ft}while(1<=Fe&&0<=Ke);break}}}finally{st=!1,Error.prepareStackTrace=I}return(x=x?x.displayName||x.name:"")?We(x):""}var Lt=Object.prototype.hasOwnProperty,Dt=[],It=-1;function Ot(x){return{current:x}}function St(x){0>It||(x.current=Dt[It],Dt[It]=null,It--)}function vt(x,S){It++,Dt[It]=x.current,x.current=S}var $t={},Rt=Ot($t),vn=Ot(!1),vi=$t;function $n(x,S){var I=x.type.contextTypes;if(!I)return $t;var k=x.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===S)return k.__reactInternalMemoizedMaskedChildContext;var W={},re;for(re in I)W[re]=S[re];return k&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=S,x.__reactInternalMemoizedMaskedChildContext=W),W}function Pn(x){return x=x.childContextTypes,x!=null}function Jt(){St(vn),St(Rt)}function Wn(x,S,I){if(Rt.current!==$t)throw Error(o(168));vt(Rt,S),vt(vn,I)}function $i(x,S,I){var k=x.stateNode;if(S=S.childContextTypes,typeof k.getChildContext!="function")return I;k=k.getChildContext();for(var W in k)if(!(W in S))throw Error(o(108,T(x)||"Unknown",W));return s({},I,k)}function hn(x){return x=(x=x.stateNode)&&x.__reactInternalMemoizedMergedChildContext||$t,vi=Rt.current,vt(Rt,x),vt(vn,vn.current),!0}function Yn(x,S,I){var k=x.stateNode;if(!k)throw Error(o(169));I?(x=$i(x,S,vi),k.__reactInternalMemoizedMergedChildContext=x,St(vn),St(Rt),vt(Rt,x)):St(vn),vt(vn,I)}var Wi=Math.clz32?Math.clz32:Oa,pr=Math.log,Js=Math.LN2;function Oa(x){return x>>>=0,x===0?32:31-(pr(x)/Js|0)|0}var ss=64,os=4194304;function as(x){switch(x&-x){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return x&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return x}}function eo(x,S){var I=x.pendingLanes;if(I===0)return 0;var k=0,W=x.suspendedLanes,re=x.pingedLanes,Fe=I&268435455;if(Fe!==0){var Ke=Fe&~W;Ke!==0?k=as(Ke):(re&=Fe,re!==0&&(k=as(re)))}else Fe=I&~W,Fe!==0?k=as(Fe):re!==0&&(k=as(re));if(k===0)return 0;if(S!==0&&S!==k&&!(S&W)&&(W=k&-k,re=S&-S,W>=re||W===16&&(re&4194240)!==0))return S;if(k&4&&(k|=I&16),S=x.entangledLanes,S!==0)for(x=x.entanglements,S&=k;0<S;)I=31-Wi(S),W=1<<I,k|=x[I],S&=~W;return k}function Ba(x,S){switch(x){case 1:case 2:case 4:return S+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Qo(x,S){for(var I=x.suspendedLanes,k=x.pingedLanes,W=x.expirationTimes,re=x.pendingLanes;0<re;){var Fe=31-Wi(re),Ke=1<<Fe,ft=W[Fe];ft===-1?(!(Ke&I)||Ke&k)&&(W[Fe]=Ba(Ke,S)):ft<=S&&(x.expiredLanes|=Ke),re&=~Ke}}function mr(x){return x=x.pendingLanes&-1073741825,x!==0?x:x&1073741824?1073741824:0}function Jo(x){for(var S=[],I=0;31>I;I++)S.push(x);return S}function to(x,S,I){x.pendingLanes|=S,S!==536870912&&(x.suspendedLanes=0,x.pingedLanes=0),x=x.eventTimes,S=31-Wi(S),x[S]=I}function ir(x,S){var I=x.pendingLanes&~S;x.pendingLanes=S,x.suspendedLanes=0,x.pingedLanes=0,x.expiredLanes&=S,x.mutableReadLanes&=S,x.entangledLanes&=S,S=x.entanglements;var k=x.eventTimes;for(x=x.expirationTimes;0<I;){var W=31-Wi(I),re=1<<W;S[W]=0,k[W]=-1,x[W]=-1,I&=~re}}function zr(x,S){var I=x.entangledLanes|=S;for(x=x.entanglements;I;){var k=31-Wi(I),W=1<<k;W&S|x[k]&S&&(x[k]|=S),I&=~W}}var ln=0;function vl(x){return x&=-x,1<x?4<x?x&268435455?16:536870912:4:1}var _l=r.unstable_scheduleCallback,Ad=r.unstable_cancelCallback,fm=r.unstable_shouldYield,F1=r.unstable_requestPaint,_i=r.unstable_now,Uu=r.unstable_ImmediatePriority,k1=r.unstable_UserBlockingPriority,ls=r.unstable_NormalPriority,pm=r.unstable_IdlePriority,Ou=null,no=null;function mm(x){if(no&&typeof no.onCommitFiberRoot=="function")try{no.onCommitFiberRoot(Ou,x,void 0,(x.current.flags&128)===128)}catch{}}function U1(x,S){return x===S&&(x!==0||1/x===1/S)||x!==x&&S!==S}var io=typeof Object.is=="function"?Object.is:U1,cs=null,za=!1,Co=!1;function gm(x){cs===null?cs=[x]:cs.push(x)}function vm(x){za=!0,gm(x)}function Ds(){if(!Co&&cs!==null){Co=!0;var x=0,S=ln;try{var I=cs;for(ln=1;x<I.length;x++){var k=I[x];do k=k(!0);while(k!==null)}cs=null,za=!1}catch(W){throw cs!==null&&(cs=cs.slice(x+1)),_l(Uu,Ds),W}finally{ln=S,Co=!1}}return null}var Bu=a.ReactCurrentBatchConfig;function zu(x,S){if(io(x,S))return!0;if(typeof x!="object"||x===null||typeof S!="object"||S===null)return!1;var I=Object.keys(x),k=Object.keys(S);if(I.length!==k.length)return!1;for(k=0;k<I.length;k++){var W=I[k];if(!Lt.call(S,W)||!io(x[W],S[W]))return!1}return!0}function Gu(x){switch(x.tag){case 5:return We(x.type);case 16:return We("Lazy");case 13:return We("Suspense");case 19:return We("SuspenseList");case 0:case 2:case 15:return x=ct(x.type,!1),x;case 11:return x=ct(x.type.render,!1),x;case 1:return x=ct(x.type,!0),x;default:return""}}function us(x,S){if(x&&x.defaultProps){S=s({},S),x=x.defaultProps;for(var I in x)S[I]===void 0&&(S[I]=x[I]);return S}return S}var gr=Ot(null),Ed=null,ea=null,xc=null;function Td(){xc=ea=Ed=null}function O1(x,S,I){se?(vt(gr,S._currentValue),S._currentValue=I):(vt(gr,S._currentValue2),S._currentValue2=I)}function vr(x){var S=gr.current;St(gr),se?x._currentValue=S:x._currentValue2=S}function hs(x,S,I){for(;x!==null;){var k=x.alternate;if((x.childLanes&S)!==S?(x.childLanes|=S,k!==null&&(k.childLanes|=S)):k!==null&&(k.childLanes&S)!==S&&(k.childLanes|=S),x===I)break;x=x.return}}function Fi(x,S){Ed=x,xc=ea=null,x=x.dependencies,x!==null&&x.firstContext!==null&&(x.lanes&S&&(ao=!0),x.firstContext=null)}function ki(x){var S=se?x._currentValue:x._currentValue2;if(xc!==x)if(x={context:x,memoizedValue:S,next:null},ea===null){if(Ed===null)throw Error(o(308));ea=x,Ed.dependencies={lanes:0,firstContext:x}}else ea=ea.next=x;return S}var ro=null,bc=!1;function VS(x){x.updateQueue={baseState:x.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function l3(x,S){x=x.updateQueue,S.updateQueue===x&&(S.updateQueue={baseState:x.baseState,firstBaseUpdate:x.firstBaseUpdate,lastBaseUpdate:x.lastBaseUpdate,shared:x.shared,effects:x.effects})}function yl(x,S){return{eventTime:x,lane:S,tag:0,payload:null,callback:null,next:null}}function Sc(x,S){var I=x.updateQueue;I!==null&&(I=I.shared,ji!==null&&x.mode&1&&!(_n&2)?(x=I.interleaved,x===null?(S.next=S,ro===null?ro=[I]:ro.push(I)):(S.next=x.next,x.next=S),I.interleaved=S):(x=I.pending,x===null?S.next=S:(S.next=x.next,x.next=S),I.pending=S))}function B1(x,S,I){if(S=S.updateQueue,S!==null&&(S=S.shared,(I&4194240)!==0)){var k=S.lanes;k&=x.pendingLanes,I|=k,S.lanes=I,zr(x,I)}}function c3(x,S){var I=x.updateQueue,k=x.alternate;if(k!==null&&(k=k.updateQueue,I===k)){var W=null,re=null;if(I=I.firstBaseUpdate,I!==null){do{var Fe={eventTime:I.eventTime,lane:I.lane,tag:I.tag,payload:I.payload,callback:I.callback,next:null};re===null?W=re=Fe:re=re.next=Fe,I=I.next}while(I!==null);re===null?W=re=S:re=re.next=S}else W=re=S;I={baseState:k.baseState,firstBaseUpdate:W,lastBaseUpdate:re,shared:k.shared,effects:k.effects},x.updateQueue=I;return}x=I.lastBaseUpdate,x===null?I.firstBaseUpdate=S:x.next=S,I.lastBaseUpdate=S}function z1(x,S,I,k){var W=x.updateQueue;bc=!1;var re=W.firstBaseUpdate,Fe=W.lastBaseUpdate,Ke=W.shared.pending;if(Ke!==null){W.shared.pending=null;var ft=Ke,Pt=ft.next;ft.next=null,Fe===null?re=Pt:Fe.next=Pt,Fe=ft;var Vt=x.alternate;Vt!==null&&(Vt=Vt.updateQueue,Ke=Vt.lastBaseUpdate,Ke!==Fe&&(Ke===null?Vt.firstBaseUpdate=Pt:Ke.next=Pt,Vt.lastBaseUpdate=ft))}if(re!==null){var on=W.baseState;Fe=0,Vt=Pt=ft=null,Ke=re;do{var Qt=Ke.lane,Kn=Ke.eventTime;if((k&Qt)===Qt){Vt!==null&&(Vt=Vt.next={eventTime:Kn,lane:0,tag:Ke.tag,payload:Ke.payload,callback:Ke.callback,next:null});e:{var Xt=x,$r=Ke;switch(Qt=S,Kn=I,$r.tag){case 1:if(Xt=$r.payload,typeof Xt=="function"){on=Xt.call(Kn,on,Qt);break e}on=Xt;break e;case 3:Xt.flags=Xt.flags&-65537|128;case 0:if(Xt=$r.payload,Qt=typeof Xt=="function"?Xt.call(Kn,on,Qt):Xt,Qt==null)break e;on=s({},on,Qt);break e;case 2:bc=!0}}Ke.callback!==null&&Ke.lane!==0&&(x.flags|=64,Qt=W.effects,Qt===null?W.effects=[Ke]:Qt.push(Ke))}else Kn={eventTime:Kn,lane:Qt,tag:Ke.tag,payload:Ke.payload,callback:Ke.callback,next:null},Vt===null?(Pt=Vt=Kn,ft=on):Vt=Vt.next=Kn,Fe|=Qt;if(Ke=Ke.next,Ke===null){if(Ke=W.shared.pending,Ke===null)break;Qt=Ke,Ke=Qt.next,Qt.next=null,W.lastBaseUpdate=Qt,W.shared.pending=null}}while(!0);if(Vt===null&&(ft=on),W.baseState=ft,W.firstBaseUpdate=Pt,W.lastBaseUpdate=Vt,S=W.shared.interleaved,S!==null){W=S;do Fe|=W.lane,W=W.next;while(W!==S)}else re===null&&(W.shared.lanes=0);kd|=Fe,x.lanes=Fe,x.memoizedState=on}}function u3(x,S,I){if(x=S.effects,S.effects=null,x!==null)for(S=0;S<x.length;S++){var k=x[S],W=k.callback;if(W!==null){if(k.callback=null,k=I,typeof W!="function")throw Error(o(191,W));W.call(k)}}}var h3=new n.Component().refs;function HS(x,S,I,k){S=x.memoizedState,I=I(k,S),I=I==null?S:s({},S,I),x.memoizedState=I,x.lanes===0&&(x.updateQueue.baseState=I)}var G1={isMounted:function(x){return(x=x._reactInternals)?E(x)===x:!1},enqueueSetState:function(x,S,I){x=x._reactInternals;var k=fs(),W=Ac(x),re=yl(k,W);re.payload=S,I!=null&&(re.callback=I),Sc(x,re),S=Do(x,W,k),S!==null&&B1(S,x,W)},enqueueReplaceState:function(x,S,I){x=x._reactInternals;var k=fs(),W=Ac(x),re=yl(k,W);re.tag=1,re.payload=S,I!=null&&(re.callback=I),Sc(x,re),S=Do(x,W,k),S!==null&&B1(S,x,W)},enqueueForceUpdate:function(x,S){x=x._reactInternals;var I=fs(),k=Ac(x),W=yl(I,k);W.tag=2,S!=null&&(W.callback=S),Sc(x,W),S=Do(x,k,I),S!==null&&B1(S,x,k)}};function d3(x,S,I,k,W,re,Fe){return x=x.stateNode,typeof x.shouldComponentUpdate=="function"?x.shouldComponentUpdate(k,re,Fe):S.prototype&&S.prototype.isPureReactComponent?!zu(I,k)||!zu(W,re):!0}function f3(x,S,I){var k=!1,W=$t,re=S.contextType;return typeof re=="object"&&re!==null?re=ki(re):(W=Pn(S)?vi:Rt.current,k=S.contextTypes,re=(k=k!=null)?$n(x,W):$t),S=new S(I,re),x.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=G1,x.stateNode=S,S._reactInternals=x,k&&(x=x.stateNode,x.__reactInternalMemoizedUnmaskedChildContext=W,x.__reactInternalMemoizedMaskedChildContext=re),S}function p3(x,S,I,k){x=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(I,k),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(I,k),S.state!==x&&G1.enqueueReplaceState(S,S.state,null)}function $S(x,S,I,k){var W=x.stateNode;W.props=I,W.state=x.memoizedState,W.refs=h3,VS(x);var re=S.contextType;typeof re=="object"&&re!==null?W.context=ki(re):(re=Pn(S)?vi:Rt.current,W.context=$n(x,re)),W.state=x.memoizedState,re=S.getDerivedStateFromProps,typeof re=="function"&&(HS(x,S,re,I),W.state=x.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof W.getSnapshotBeforeUpdate=="function"||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(S=W.state,typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount(),S!==W.state&&G1.enqueueReplaceState(W,W.state,null),z1(x,I,W,k),W.state=x.memoizedState),typeof W.componentDidMount=="function"&&(x.flags|=4194308)}var Cd=[],Pd=0,V1=null,H1=0,Po=[],Ro=0,Vu=null,xl=1,bl="";function Hu(x,S){Cd[Pd++]=H1,Cd[Pd++]=V1,V1=x,H1=S}function m3(x,S,I){Po[Ro++]=xl,Po[Ro++]=bl,Po[Ro++]=Vu,Vu=x;var k=xl;x=bl;var W=32-Wi(k)-1;k&=~(1<<W),I+=1;var re=32-Wi(S)+W;if(30<re){var Fe=W-W%5;re=(k&(1<<Fe)-1).toString(32),k>>=Fe,W-=Fe,xl=1<<32-Wi(S)+W|I<<W|k,bl=re+x}else xl=1<<re|I<<W|k,bl=x}function WS(x){x.return!==null&&(Hu(x,1),m3(x,1,0))}function jS(x){for(;x===V1;)V1=Cd[--Pd],Cd[Pd]=null,H1=Cd[--Pd],Cd[Pd]=null;for(;x===Vu;)Vu=Po[--Ro],Po[Ro]=null,bl=Po[--Ro],Po[Ro]=null,xl=Po[--Ro],Po[Ro]=null}var so=null,oo=null,ci=!1,_m=!1,ta=null;function g3(x,S){var I=No(5,null,null,0);I.elementType="DELETED",I.stateNode=S,I.return=x,S=x.deletions,S===null?(x.deletions=[I],x.flags|=16):S.push(I)}function v3(x,S){switch(x.tag){case 5:return S=ae(S,x.type,x.pendingProps),S!==null?(x.stateNode=S,so=x,oo=lt(S),!0):!1;case 6:return S=ue(S,x.pendingProps),S!==null?(x.stateNode=S,so=x,oo=null,!0):!1;case 13:if(S=_e(S),S!==null){var I=Vu!==null?{id:xl,overflow:bl}:null;return x.memoizedState={dehydrated:S,treeContext:I,retryLane:1073741824},I=No(18,null,null,0),I.stateNode=S,I.return=x,x.child=I,so=x,oo=null,!0}return!1;default:return!1}}function XS(x){return(x.mode&1)!==0&&(x.flags&128)===0}function qS(x){if(ci){var S=oo;if(S){var I=S;if(!v3(x,S)){if(XS(x))throw Error(o(418));S=He(I);var k=so;S&&v3(x,S)?g3(k,I):(x.flags=x.flags&-4097|2,ci=!1,so=x)}}else{if(XS(x))throw Error(o(418));x.flags=x.flags&-4097|2,ci=!1,so=x}}}function _3(x){for(x=x.return;x!==null&&x.tag!==5&&x.tag!==3&&x.tag!==13;)x=x.return;so=x}function ym(x){if(!pe||x!==so)return!1;if(!ci)return _3(x),ci=!0,!1;if(x.tag!==3&&(x.tag!==5||et(x.type)&&!Y(x.type,x.memoizedProps))){var S=oo;if(S){if(XS(x)){for(x=oo;x;)x=He(x);throw Error(o(418))}for(;S;)g3(x,S),S=He(S)}}if(_3(x),x.tag===13){if(!pe)throw Error(o(316));if(x=x.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(o(317));oo=H(x)}else oo=so?He(x.stateNode):null;return!0}function Rd(){pe&&(oo=so=null,_m=ci=!1)}function YS(x){ta===null?ta=[x]:ta.push(x)}function xm(x,S,I){if(x=I.ref,x!==null&&typeof x!="function"&&typeof x!="object"){if(I._owner){if(I=I._owner,I){if(I.tag!==1)throw Error(o(309));var k=I.stateNode}if(!k)throw Error(o(147,x));var W=k,re=""+x;return S!==null&&S.ref!==null&&typeof S.ref=="function"&&S.ref._stringRef===re?S.ref:(S=function(Fe){var Ke=W.refs;Ke===h3&&(Ke=W.refs={}),Fe===null?delete Ke[re]:Ke[re]=Fe},S._stringRef=re,S)}if(typeof x!="string")throw Error(o(284));if(!I._owner)throw Error(o(290,x))}return x}function $1(x,S){throw x=Object.prototype.toString.call(S),Error(o(31,x==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":x))}function y3(x){var S=x._init;return S(x._payload)}function x3(x){function S(ot,Je){if(x){var ut=ot.deletions;ut===null?(ot.deletions=[Je],ot.flags|=16):ut.push(Je)}}function I(ot,Je){if(!x)return null;for(;Je!==null;)S(ot,Je),Je=Je.sibling;return null}function k(ot,Je){for(ot=new Map;Je!==null;)Je.key!==null?ot.set(Je.key,Je):ot.set(Je.index,Je),Je=Je.sibling;return ot}function W(ot,Je){return ot=Tc(ot,Je),ot.index=0,ot.sibling=null,ot}function re(ot,Je,ut){return ot.index=ut,x?(ut=ot.alternate,ut!==null?(ut=ut.index,ut<Je?(ot.flags|=2,Je):ut):(ot.flags|=2,Je)):(ot.flags|=1048576,Je)}function Fe(ot){return x&&ot.alternate===null&&(ot.flags|=2),ot}function Ke(ot,Je,ut,Bt){return Je===null||Je.tag!==6?(Je=L2(ut,ot.mode,Bt),Je.return=ot,Je):(Je=W(Je,ut),Je.return=ot,Je)}function ft(ot,Je,ut,Bt){var jt=ut.type;return jt===u?Vt(ot,Je,ut.props.children,Bt,ut.key):Je!==null&&(Je.elementType===jt||typeof jt=="object"&&jt!==null&&jt.$$typeof===p&&y3(jt)===Je.type)?(Bt=W(Je,ut.props),Bt.ref=xm(ot,Je,ut),Bt.return=ot,Bt):(Bt=bv(ut.type,ut.key,ut.props,null,ot.mode,Bt),Bt.ref=xm(ot,Je,ut),Bt.return=ot,Bt)}function Pt(ot,Je,ut,Bt){return Je===null||Je.tag!==4||Je.stateNode.containerInfo!==ut.containerInfo||Je.stateNode.implementation!==ut.implementation?(Je=D2(ut,ot.mode,Bt),Je.return=ot,Je):(Je=W(Je,ut.children||[]),Je.return=ot,Je)}function Vt(ot,Je,ut,Bt,jt){return Je===null||Je.tag!==7?(Je=Ku(ut,ot.mode,Bt,jt),Je.return=ot,Je):(Je=W(Je,ut),Je.return=ot,Je)}function on(ot,Je,ut){if(typeof Je=="string"&&Je!==""||typeof Je=="number")return Je=L2(""+Je,ot.mode,ut),Je.return=ot,Je;if(typeof Je=="object"&&Je!==null){switch(Je.$$typeof){case l:return ut=bv(Je.type,Je.key,Je.props,null,ot.mode,ut),ut.ref=xm(ot,null,Je),ut.return=ot,ut;case c:return Je=D2(Je,ot.mode,ut),Je.return=ot,Je;case p:var Bt=Je._init;return on(ot,Bt(Je._payload),ut)}if(F(Je)||w(Je))return Je=Ku(Je,ot.mode,ut,null),Je.return=ot,Je;$1(ot,Je)}return null}function Qt(ot,Je,ut,Bt){var jt=Je!==null?Je.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number")return jt!==null?null:Ke(ot,Je,""+ut,Bt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case l:return ut.key===jt?ft(ot,Je,ut,Bt):null;case c:return ut.key===jt?Pt(ot,Je,ut,Bt):null;case p:return jt=ut._init,Qt(ot,Je,jt(ut._payload),Bt)}if(F(ut)||w(ut))return jt!==null?null:Vt(ot,Je,ut,Bt,null);$1(ot,ut)}return null}function Kn(ot,Je,ut,Bt,jt){if(typeof Bt=="string"&&Bt!==""||typeof Bt=="number")return ot=ot.get(ut)||null,Ke(Je,ot,""+Bt,jt);if(typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case l:return ot=ot.get(Bt.key===null?ut:Bt.key)||null,ft(Je,ot,Bt,jt);case c:return ot=ot.get(Bt.key===null?ut:Bt.key)||null,Pt(Je,ot,Bt,jt);case p:var pn=Bt._init;return Kn(ot,Je,ut,pn(Bt._payload),jt)}if(F(Bt)||w(Bt))return ot=ot.get(ut)||null,Vt(Je,ot,Bt,jt,null);$1(Je,Bt)}return null}function Xt(ot,Je,ut,Bt){for(var jt=null,pn=null,an=Je,Rn=Je=0,yr=null;an!==null&&Rn<ut.length;Rn++){an.index>Rn?(yr=an,an=null):yr=an.sibling;var In=Qt(ot,an,ut[Rn],Bt);if(In===null){an===null&&(an=yr);break}x&&an&&In.alternate===null&&S(ot,an),Je=re(In,Je,Rn),pn===null?jt=In:pn.sibling=In,pn=In,an=yr}if(Rn===ut.length)return I(ot,an),ci&&Hu(ot,Rn),jt;if(an===null){for(;Rn<ut.length;Rn++)an=on(ot,ut[Rn],Bt),an!==null&&(Je=re(an,Je,Rn),pn===null?jt=an:pn.sibling=an,pn=an);return ci&&Hu(ot,Rn),jt}for(an=k(ot,an);Rn<ut.length;Rn++)yr=Kn(an,ot,Rn,ut[Rn],Bt),yr!==null&&(x&&yr.alternate!==null&&an.delete(yr.key===null?Rn:yr.key),Je=re(yr,Je,Rn),pn===null?jt=yr:pn.sibling=yr,pn=yr);return x&&an.forEach(function(Cc){return S(ot,Cc)}),ci&&Hu(ot,Rn),jt}function $r(ot,Je,ut,Bt){var jt=w(ut);if(typeof jt!="function")throw Error(o(150));if(ut=jt.call(ut),ut==null)throw Error(o(151));for(var pn=jt=null,an=Je,Rn=Je=0,yr=null,In=ut.next();an!==null&&!In.done;Rn++,In=ut.next()){an.index>Rn?(yr=an,an=null):yr=an.sibling;var Cc=Qt(ot,an,In.value,Bt);if(Cc===null){an===null&&(an=yr);break}x&&an&&Cc.alternate===null&&S(ot,an),Je=re(Cc,Je,Rn),pn===null?jt=Cc:pn.sibling=Cc,pn=Cc,an=yr}if(In.done)return I(ot,an),ci&&Hu(ot,Rn),jt;if(an===null){for(;!In.done;Rn++,In=ut.next())In=on(ot,In.value,Bt),In!==null&&(Je=re(In,Je,Rn),pn===null?jt=In:pn.sibling=In,pn=In);return ci&&Hu(ot,Rn),jt}for(an=k(ot,an);!In.done;Rn++,In=ut.next())In=Kn(an,ot,Rn,In.value,Bt),In!==null&&(x&&In.alternate!==null&&an.delete(In.key===null?Rn:In.key),Je=re(In,Je,Rn),pn===null?jt=In:pn.sibling=In,pn=In);return x&&an.forEach(function(BH){return S(ot,BH)}),ci&&Hu(ot,Rn),jt}function Fo(ot,Je,ut,Bt){if(typeof ut=="object"&&ut!==null&&ut.type===u&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case l:e:{for(var jt=ut.key,pn=Je;pn!==null;){if(pn.key===jt){if(jt=ut.type,jt===u){if(pn.tag===7){I(ot,pn.sibling),Je=W(pn,ut.props.children),Je.return=ot,ot=Je;break e}}else if(pn.elementType===jt||typeof jt=="object"&&jt!==null&&jt.$$typeof===p&&y3(jt)===pn.type){I(ot,pn.sibling),Je=W(pn,ut.props),Je.ref=xm(ot,pn,ut),Je.return=ot,ot=Je;break e}I(ot,pn);break}else S(ot,pn);pn=pn.sibling}ut.type===u?(Je=Ku(ut.props.children,ot.mode,Bt,ut.key),Je.return=ot,ot=Je):(Bt=bv(ut.type,ut.key,ut.props,null,ot.mode,Bt),Bt.ref=xm(ot,Je,ut),Bt.return=ot,ot=Bt)}return Fe(ot);case c:e:{for(pn=ut.key;Je!==null;){if(Je.key===pn)if(Je.tag===4&&Je.stateNode.containerInfo===ut.containerInfo&&Je.stateNode.implementation===ut.implementation){I(ot,Je.sibling),Je=W(Je,ut.children||[]),Je.return=ot,ot=Je;break e}else{I(ot,Je);break}else S(ot,Je);Je=Je.sibling}Je=D2(ut,ot.mode,Bt),Je.return=ot,ot=Je}return Fe(ot);case p:return pn=ut._init,Fo(ot,Je,pn(ut._payload),Bt)}if(F(ut))return Xt(ot,Je,ut,Bt);if(w(ut))return $r(ot,Je,ut,Bt);$1(ot,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"?(ut=""+ut,Je!==null&&Je.tag===6?(I(ot,Je.sibling),Je=W(Je,ut),Je.return=ot,ot=Je):(I(ot,Je),Je=L2(ut,ot.mode,Bt),Je.return=ot,ot=Je),Fe(ot)):I(ot,Je)}return Fo}var Id=x3(!0),b3=x3(!1),bm={},Io=Ot(bm),Sm=Ot(bm),Ld=Ot(bm);function Ga(x){if(x===bm)throw Error(o(174));return x}function KS(x,S){vt(Ld,S),vt(Sm,x),vt(Io,bm),x=z(S),St(Io),vt(Io,x)}function Dd(){St(Io),St(Sm),St(Ld)}function S3(x){var S=Ga(Ld.current),I=Ga(Io.current);S=U(I,x.type,S),I!==S&&(vt(Sm,x),vt(Io,S))}function ZS(x){Sm.current===x&&(St(Io),St(Sm))}var yi=Ot(0);function W1(x){for(var S=x;S!==null;){if(S.tag===13){var I=S.memoizedState;if(I!==null&&(I=I.dehydrated,I===null||be(I)||Ne(I)))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if(S.flags&128)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===x)break;for(;S.sibling===null;){if(S.return===null||S.return===x)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}var QS=[];function JS(){for(var x=0;x<QS.length;x++){var S=QS[x];se?S._workInProgressVersionPrimary=null:S._workInProgressVersionSecondary=null}QS.length=0}var j1=a.ReactCurrentDispatcher,Lo=a.ReactCurrentBatchConfig,Nd=0,Pi=null,Gr=null,_r=null,X1=!1,wm=!1,Mm=0,uH=0;function Vr(){throw Error(o(321))}function e2(x,S){if(S===null)return!1;for(var I=0;I<S.length&&I<x.length;I++)if(!io(x[I],S[I]))return!1;return!0}function t2(x,S,I,k,W,re){if(Nd=re,Pi=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,j1.current=x===null||x.memoizedState===null?pH:mH,x=I(k,W),wm){re=0;do{if(wm=!1,Mm=0,25<=re)throw Error(o(301));re+=1,_r=Gr=null,S.updateQueue=null,j1.current=gH,x=I(k,W)}while(wm)}if(j1.current=Q1,S=Gr!==null&&Gr.next!==null,Nd=0,_r=Gr=Pi=null,X1=!1,S)throw Error(o(300));return x}function n2(){var x=Mm!==0;return Mm=0,x}function Sl(){var x={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _r===null?Pi.memoizedState=_r=x:_r=_r.next=x,_r}function Va(){if(Gr===null){var x=Pi.alternate;x=x!==null?x.memoizedState:null}else x=Gr.next;var S=_r===null?Pi.memoizedState:_r.next;if(S!==null)_r=S,Gr=x;else{if(x===null)throw Error(o(310));Gr=x,x={memoizedState:Gr.memoizedState,baseState:Gr.baseState,baseQueue:Gr.baseQueue,queue:Gr.queue,next:null},_r===null?Pi.memoizedState=_r=x:_r=_r.next=x}return _r}function $u(x,S){return typeof S=="function"?S(x):S}function q1(x){var S=Va(),I=S.queue;if(I===null)throw Error(o(311));I.lastRenderedReducer=x;var k=Gr,W=k.baseQueue,re=I.pending;if(re!==null){if(W!==null){var Fe=W.next;W.next=re.next,re.next=Fe}k.baseQueue=W=re,I.pending=null}if(W!==null){re=W.next,k=k.baseState;var Ke=Fe=null,ft=null,Pt=re;do{var Vt=Pt.lane;if((Nd&Vt)===Vt)ft!==null&&(ft=ft.next={lane:0,action:Pt.action,hasEagerState:Pt.hasEagerState,eagerState:Pt.eagerState,next:null}),k=Pt.hasEagerState?Pt.eagerState:x(k,Pt.action);else{var on={lane:Vt,action:Pt.action,hasEagerState:Pt.hasEagerState,eagerState:Pt.eagerState,next:null};ft===null?(Ke=ft=on,Fe=k):ft=ft.next=on,Pi.lanes|=Vt,kd|=Vt}Pt=Pt.next}while(Pt!==null&&Pt!==re);ft===null?Fe=k:ft.next=Ke,io(k,S.memoizedState)||(ao=!0),S.memoizedState=k,S.baseState=Fe,S.baseQueue=ft,I.lastRenderedState=k}if(x=I.interleaved,x!==null){W=x;do re=W.lane,Pi.lanes|=re,kd|=re,W=W.next;while(W!==x)}else W===null&&(I.lanes=0);return[S.memoizedState,I.dispatch]}function Y1(x){var S=Va(),I=S.queue;if(I===null)throw Error(o(311));I.lastRenderedReducer=x;var k=I.dispatch,W=I.pending,re=S.memoizedState;if(W!==null){I.pending=null;var Fe=W=W.next;do re=x(re,Fe.action),Fe=Fe.next;while(Fe!==W);io(re,S.memoizedState)||(ao=!0),S.memoizedState=re,S.baseQueue===null&&(S.baseState=re),I.lastRenderedState=re}return[re,k]}function w3(){}function M3(x,S){var I=Pi,k=Va(),W=S(),re=!io(k.memoizedState,W);if(re&&(k.memoizedState=W,ao=!0),k=k.queue,Em(T3.bind(null,I,k,x),[x]),k.getSnapshot!==S||re||_r!==null&&_r.memoizedState.tag&1){if(I.flags|=2048,Am(9,E3.bind(null,I,k,W,S),void 0,null),ji===null)throw Error(o(349));Nd&30||A3(I,S,W)}return W}function A3(x,S,I){x.flags|=16384,x={getSnapshot:S,value:I},S=Pi.updateQueue,S===null?(S={lastEffect:null,stores:null},Pi.updateQueue=S,S.stores=[x]):(I=S.stores,I===null?S.stores=[x]:I.push(x))}function E3(x,S,I,k){S.value=I,S.getSnapshot=k,C3(S)&&Do(x,1,-1)}function T3(x,S,I){return I(function(){C3(S)&&Do(x,1,-1)})}function C3(x){var S=x.getSnapshot;x=x.value;try{var I=S();return!io(x,I)}catch{return!0}}function i2(x){var S=Sl();return typeof x=="function"&&(x=x()),S.memoizedState=S.baseState=x,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$u,lastRenderedState:x},S.queue=x,x=x.dispatch=fH.bind(null,Pi,x),[S.memoizedState,x]}function Am(x,S,I,k){return x={tag:x,create:S,destroy:I,deps:k,next:null},S=Pi.updateQueue,S===null?(S={lastEffect:null,stores:null},Pi.updateQueue=S,S.lastEffect=x.next=x):(I=S.lastEffect,I===null?S.lastEffect=x.next=x:(k=I.next,I.next=x,x.next=k,S.lastEffect=x)),x}function P3(){return Va().memoizedState}function K1(x,S,I,k){var W=Sl();Pi.flags|=x,W.memoizedState=Am(1|S,I,void 0,k===void 0?null:k)}function Z1(x,S,I,k){var W=Va();k=k===void 0?null:k;var re=void 0;if(Gr!==null){var Fe=Gr.memoizedState;if(re=Fe.destroy,k!==null&&e2(k,Fe.deps)){W.memoizedState=Am(S,I,re,k);return}}Pi.flags|=x,W.memoizedState=Am(1|S,I,re,k)}function r2(x,S){return K1(8390656,8,x,S)}function Em(x,S){return Z1(2048,8,x,S)}function R3(x,S){return Z1(4,2,x,S)}function I3(x,S){return Z1(4,4,x,S)}function L3(x,S){if(typeof S=="function")return x=x(),S(x),function(){S(null)};if(S!=null)return x=x(),S.current=x,function(){S.current=null}}function D3(x,S,I){return I=I!=null?I.concat([x]):null,Z1(4,4,L3.bind(null,S,x),I)}function s2(){}function N3(x,S){var I=Va();S=S===void 0?null:S;var k=I.memoizedState;return k!==null&&S!==null&&e2(S,k[1])?k[0]:(I.memoizedState=[x,S],x)}function F3(x,S){var I=Va();S=S===void 0?null:S;var k=I.memoizedState;return k!==null&&S!==null&&e2(S,k[1])?k[0]:(x=x(),I.memoizedState=[x,S],x)}function hH(x,S){var I=ln;ln=I!==0&&4>I?I:4,x(!0);var k=Lo.transition;Lo.transition={};try{x(!1),S()}finally{ln=I,Lo.transition=k}}function k3(){return Va().memoizedState}function dH(x,S,I){var k=Ac(x);I={lane:k,action:I,hasEagerState:!1,eagerState:null,next:null},U3(x)?O3(S,I):(B3(x,S,I),I=fs(),x=Do(x,k,I),x!==null&&z3(x,S,k))}function fH(x,S,I){var k=Ac(x),W={lane:k,action:I,hasEagerState:!1,eagerState:null,next:null};if(U3(x))O3(S,W);else{B3(x,S,W);var re=x.alternate;if(x.lanes===0&&(re===null||re.lanes===0)&&(re=S.lastRenderedReducer,re!==null))try{var Fe=S.lastRenderedState,Ke=re(Fe,I);if(W.hasEagerState=!0,W.eagerState=Ke,io(Ke,Fe))return}catch{}finally{}I=fs(),x=Do(x,k,I),x!==null&&z3(x,S,k)}}function U3(x){var S=x.alternate;return x===Pi||S!==null&&S===Pi}function O3(x,S){wm=X1=!0;var I=x.pending;I===null?S.next=S:(S.next=I.next,I.next=S),x.pending=S}function B3(x,S,I){ji!==null&&x.mode&1&&!(_n&2)?(x=S.interleaved,x===null?(I.next=I,ro===null?ro=[S]:ro.push(S)):(I.next=x.next,x.next=I),S.interleaved=I):(x=S.pending,x===null?I.next=I:(I.next=x.next,x.next=I),S.pending=I)}function z3(x,S,I){if(I&4194240){var k=S.lanes;k&=x.pendingLanes,I|=k,S.lanes=I,zr(x,I)}}var Q1={readContext:ki,useCallback:Vr,useContext:Vr,useEffect:Vr,useImperativeHandle:Vr,useInsertionEffect:Vr,useLayoutEffect:Vr,useMemo:Vr,useReducer:Vr,useRef:Vr,useState:Vr,useDebugValue:Vr,useDeferredValue:Vr,useTransition:Vr,useMutableSource:Vr,useSyncExternalStore:Vr,useId:Vr,unstable_isNewReconciler:!1},pH={readContext:ki,useCallback:function(x,S){return Sl().memoizedState=[x,S===void 0?null:S],x},useContext:ki,useEffect:r2,useImperativeHandle:function(x,S,I){return I=I!=null?I.concat([x]):null,K1(4194308,4,L3.bind(null,S,x),I)},useLayoutEffect:function(x,S){return K1(4194308,4,x,S)},useInsertionEffect:function(x,S){return K1(4,2,x,S)},useMemo:function(x,S){var I=Sl();return S=S===void 0?null:S,x=x(),I.memoizedState=[x,S],x},useReducer:function(x,S,I){var k=Sl();return S=I!==void 0?I(S):S,k.memoizedState=k.baseState=S,x={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:x,lastRenderedState:S},k.queue=x,x=x.dispatch=dH.bind(null,Pi,x),[k.memoizedState,x]},useRef:function(x){var S=Sl();return x={current:x},S.memoizedState=x},useState:i2,useDebugValue:s2,useDeferredValue:function(x){var S=i2(x),I=S[0],k=S[1];return r2(function(){var W=Lo.transition;Lo.transition={};try{k(x)}finally{Lo.transition=W}},[x]),I},useTransition:function(){var x=i2(!1),S=x[0];return x=hH.bind(null,x[1]),Sl().memoizedState=x,[S,x]},useMutableSource:function(){},useSyncExternalStore:function(x,S,I){var k=Pi,W=Sl();if(ci){if(I===void 0)throw Error(o(407));I=I()}else{if(I=S(),ji===null)throw Error(o(349));Nd&30||A3(k,S,I)}W.memoizedState=I;var re={value:I,getSnapshot:S};return W.queue=re,r2(T3.bind(null,k,re,x),[x]),k.flags|=2048,Am(9,E3.bind(null,k,re,I,S),void 0,null),I},useId:function(){var x=Sl(),S=ji.identifierPrefix;if(ci){var I=bl,k=xl;I=(k&~(1<<32-Wi(k)-1)).toString(32)+I,S=":"+S+"R"+I,I=Mm++,0<I&&(S+="H"+I.toString(32)),S+=":"}else I=uH++,S=":"+S+"r"+I.toString(32)+":";return x.memoizedState=S},unstable_isNewReconciler:!1},mH={readContext:ki,useCallback:N3,useContext:ki,useEffect:Em,useImperativeHandle:D3,useInsertionEffect:R3,useLayoutEffect:I3,useMemo:F3,useReducer:q1,useRef:P3,useState:function(){return q1($u)},useDebugValue:s2,useDeferredValue:function(x){var S=q1($u),I=S[0],k=S[1];return Em(function(){var W=Lo.transition;Lo.transition={};try{k(x)}finally{Lo.transition=W}},[x]),I},useTransition:function(){var x=q1($u)[0],S=Va().memoizedState;return[x,S]},useMutableSource:w3,useSyncExternalStore:M3,useId:k3,unstable_isNewReconciler:!1},gH={readContext:ki,useCallback:N3,useContext:ki,useEffect:Em,useImperativeHandle:D3,useInsertionEffect:R3,useLayoutEffect:I3,useMemo:F3,useReducer:Y1,useRef:P3,useState:function(){return Y1($u)},useDebugValue:s2,useDeferredValue:function(x){var S=Y1($u),I=S[0],k=S[1];return Em(function(){var W=Lo.transition;Lo.transition={};try{k(x)}finally{Lo.transition=W}},[x]),I},useTransition:function(){var x=Y1($u)[0],S=Va().memoizedState;return[x,S]},useMutableSource:w3,useSyncExternalStore:M3,useId:k3,unstable_isNewReconciler:!1};function o2(x,S){try{var I="",k=S;do I+=Gu(k),k=k.return;while(k);var W=I}catch(re){W=`
Error generating stack: `+re.message+`
`+re.stack}return{value:x,source:S,stack:W}}function a2(x,S){try{console.error(S.value)}catch(I){setTimeout(function(){throw I})}}var vH=typeof WeakMap=="function"?WeakMap:Map;function G3(x,S,I){I=yl(-1,I),I.tag=3,I.payload={element:null};var k=S.value;return I.callback=function(){pv||(pv=!0,A2=k),a2(x,S)},I}function V3(x,S,I){I=yl(-1,I),I.tag=3;var k=x.type.getDerivedStateFromError;if(typeof k=="function"){var W=S.value;I.payload=function(){return k(W)},I.callback=function(){a2(x,S)}}var re=x.stateNode;return re!==null&&typeof re.componentDidCatch=="function"&&(I.callback=function(){a2(x,S),typeof k!="function"&&(wc===null?wc=new Set([this]):wc.add(this));var Fe=S.stack;this.componentDidCatch(S.value,{componentStack:Fe!==null?Fe:""})}),I}function H3(x,S,I){var k=x.pingCache;if(k===null){k=x.pingCache=new vH;var W=new Set;k.set(S,W)}else W=k.get(S),W===void 0&&(W=new Set,k.set(S,W));W.has(I)||(W.add(I),x=IH.bind(null,x,S,I),S.then(x,x))}function $3(x){do{var S;if((S=x.tag===13)&&(S=x.memoizedState,S=S!==null?S.dehydrated!==null:!0),S)return x;x=x.return}while(x!==null);return null}function W3(x,S,I,k,W){return x.mode&1?(x.flags|=65536,x.lanes=W,x):(x===S?x.flags|=65536:(x.flags|=128,I.flags|=131072,I.flags&=-52805,I.tag===1&&(I.alternate===null?I.tag=17:(S=yl(-1,1),S.tag=2,Sc(I,S))),I.lanes|=1),x)}function Ha(x){x.flags|=4}function j3(x,S){if(x!==null&&x.child===S.child)return!0;if(S.flags&16)return!1;for(x=S.child;x!==null;){if(x.flags&12854||x.subtreeFlags&12854)return!1;x=x.sibling}return!0}var Tm,Cm,J1,ev;if(oe)Tm=function(x,S){for(var I=S.child;I!==null;){if(I.tag===5||I.tag===6)O(x,I.stateNode);else if(I.tag!==4&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===S)break;for(;I.sibling===null;){if(I.return===null||I.return===S)return;I=I.return}I.sibling.return=I.return,I=I.sibling}},Cm=function(){},J1=function(x,S,I,k,W){if(x=x.memoizedProps,x!==k){var re=S.stateNode,Fe=Ga(Io.current);I=q(re,I,x,k,W,Fe),(S.updateQueue=I)&&Ha(S)}},ev=function(x,S,I,k){I!==k&&Ha(S)};else if($){Tm=function(x,S,I,k){for(var W=S.child;W!==null;){if(W.tag===5){var re=W.stateNode;I&&k&&(re=Mt(re,W.type,W.memoizedProps,W)),O(x,re)}else if(W.tag===6)re=W.stateNode,I&&k&&(re=K(re,W.memoizedProps,W)),O(x,re);else if(W.tag!==4){if(W.tag===22&&W.memoizedState!==null)re=W.child,re!==null&&(re.return=W),Tm(x,W,!0,!0);else if(W.child!==null){W.child.return=W,W=W.child;continue}}if(W===S)break;for(;W.sibling===null;){if(W.return===null||W.return===S)return;W=W.return}W.sibling.return=W.return,W=W.sibling}};var X3=function(x,S,I,k){for(var W=S.child;W!==null;){if(W.tag===5){var re=W.stateNode;I&&k&&(re=Mt(re,W.type,W.memoizedProps,W)),Xe(x,re)}else if(W.tag===6)re=W.stateNode,I&&k&&(re=K(re,W.memoizedProps,W)),Xe(x,re);else if(W.tag!==4){if(W.tag===22&&W.memoizedState!==null)re=W.child,re!==null&&(re.return=W),X3(x,W,!0,!0);else if(W.child!==null){W.child.return=W,W=W.child;continue}}if(W===S)break;for(;W.sibling===null;){if(W.return===null||W.return===S)return;W=W.return}W.sibling.return=W.return,W=W.sibling}};Cm=function(x,S){var I=S.stateNode;if(!j3(x,S)){x=I.containerInfo;var k=Re(x);X3(k,S,!1,!1),I.pendingChildren=k,Ha(S),gt(x,k)}},J1=function(x,S,I,k,W){var re=x.stateNode,Fe=x.memoizedProps;if((x=j3(x,S))&&Fe===k)S.stateNode=re;else{var Ke=S.stateNode,ft=Ga(Io.current),Pt=null;Fe!==k&&(Pt=q(Ke,I,Fe,k,W,ft)),x&&Pt===null?S.stateNode=re:(re=Ee(re,Pt,I,Fe,k,S,x,Ke),j(re,I,k,W,ft)&&Ha(S),S.stateNode=re,x?Ha(S):Tm(re,S,!1,!1))}},ev=function(x,S,I,k){I!==k?(x=Ga(Ld.current),I=Ga(Io.current),S.stateNode=ie(k,x,I,S),Ha(S)):S.stateNode=x.stateNode}}else Cm=function(){},J1=function(){},ev=function(){};function Pm(x,S){if(!ci)switch(x.tailMode){case"hidden":S=x.tail;for(var I=null;S!==null;)S.alternate!==null&&(I=S),S=S.sibling;I===null?x.tail=null:I.sibling=null;break;case"collapsed":I=x.tail;for(var k=null;I!==null;)I.alternate!==null&&(k=I),I=I.sibling;k===null?S||x.tail===null?x.tail=null:x.tail.sibling=null:k.sibling=null}}function Hr(x){var S=x.alternate!==null&&x.alternate.child===x.child,I=0,k=0;if(S)for(var W=x.child;W!==null;)I|=W.lanes|W.childLanes,k|=W.subtreeFlags&14680064,k|=W.flags&14680064,W.return=x,W=W.sibling;else for(W=x.child;W!==null;)I|=W.lanes|W.childLanes,k|=W.subtreeFlags,k|=W.flags,W.return=x,W=W.sibling;return x.subtreeFlags|=k,x.childLanes=I,S}function _H(x,S,I){var k=S.pendingProps;switch(jS(S),S.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hr(S),null;case 1:return Pn(S.type)&&Jt(),Hr(S),null;case 3:return k=S.stateNode,Dd(),St(vn),St(Rt),JS(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(x===null||x.child===null)&&(ym(S)?Ha(S):x===null||x.memoizedState.isDehydrated&&!(S.flags&256)||(S.flags|=1024,ta!==null&&(C2(ta),ta=null))),Cm(x,S),Hr(S),null;case 5:ZS(S),I=Ga(Ld.current);var W=S.type;if(x!==null&&S.stateNode!=null)J1(x,S,W,k,I),x.ref!==S.ref&&(S.flags|=512,S.flags|=2097152);else{if(!k){if(S.stateNode===null)throw Error(o(166));return Hr(S),null}if(x=Ga(Io.current),ym(S)){if(!pe)throw Error(o(175));x=zt(S.stateNode,S.type,S.memoizedProps,I,x,S,!_m),S.updateQueue=x,x!==null&&Ha(S)}else{var re=D(W,k,I,x,S);Tm(re,S,!1,!1),S.stateNode=re,j(re,W,k,I,x)&&Ha(S)}S.ref!==null&&(S.flags|=512,S.flags|=2097152)}return Hr(S),null;case 6:if(x&&S.stateNode!=null)ev(x,S,x.memoizedProps,k);else{if(typeof k!="string"&&S.stateNode===null)throw Error(o(166));if(x=Ga(Ld.current),I=Ga(Io.current),ym(S)){if(!pe)throw Error(o(176));if(x=S.stateNode,k=S.memoizedProps,(I=Et(x,k,S,!_m))&&(W=so,W!==null))switch(re=(W.mode&1)!==0,W.tag){case 3:dt(W.stateNode.containerInfo,x,k,re);break;case 5:yt(W.type,W.memoizedProps,W.stateNode,x,k,re)}I&&Ha(S)}else S.stateNode=ie(k,x,I,S)}return Hr(S),null;case 13:if(St(yi),k=S.memoizedState,ci&&oo!==null&&S.mode&1&&!(S.flags&128)){for(x=oo;x;)x=He(x);return Rd(),S.flags|=98560,S}if(k!==null&&k.dehydrated!==null){if(k=ym(S),x===null){if(!k)throw Error(o(318));if(!pe)throw Error(o(344));if(x=S.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(o(317));bt(x,S)}else Rd(),!(S.flags&128)&&(S.memoizedState=null),S.flags|=4;return Hr(S),null}return ta!==null&&(C2(ta),ta=null),S.flags&128?(S.lanes=I,S):(k=k!==null,I=!1,x===null?ym(S):I=x.memoizedState!==null,k&&!I&&(S.child.flags|=8192,S.mode&1&&(x===null||yi.current&1?rr===0&&(rr=3):R2())),S.updateQueue!==null&&(S.flags|=4),Hr(S),null);case 4:return Dd(),Cm(x,S),x===null&&Pe(S.stateNode.containerInfo),Hr(S),null;case 10:return vr(S.type._context),Hr(S),null;case 17:return Pn(S.type)&&Jt(),Hr(S),null;case 19:if(St(yi),W=S.memoizedState,W===null)return Hr(S),null;if(k=(S.flags&128)!==0,re=W.rendering,re===null)if(k)Pm(W,!1);else{if(rr!==0||x!==null&&x.flags&128)for(x=S.child;x!==null;){if(re=W1(x),re!==null){for(S.flags|=128,Pm(W,!1),x=re.updateQueue,x!==null&&(S.updateQueue=x,S.flags|=4),S.subtreeFlags=0,x=I,k=S.child;k!==null;)I=k,W=x,I.flags&=14680066,re=I.alternate,re===null?(I.childLanes=0,I.lanes=W,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=re.childLanes,I.lanes=re.lanes,I.child=re.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=re.memoizedProps,I.memoizedState=re.memoizedState,I.updateQueue=re.updateQueue,I.type=re.type,W=re.dependencies,I.dependencies=W===null?null:{lanes:W.lanes,firstContext:W.firstContext}),k=k.sibling;return vt(yi,yi.current&1|2),S.child}x=x.sibling}W.tail!==null&&_i()>M2&&(S.flags|=128,k=!0,Pm(W,!1),S.lanes=4194304)}else{if(!k)if(x=W1(re),x!==null){if(S.flags|=128,k=!0,x=x.updateQueue,x!==null&&(S.updateQueue=x,S.flags|=4),Pm(W,!0),W.tail===null&&W.tailMode==="hidden"&&!re.alternate&&!ci)return Hr(S),null}else 2*_i()-W.renderingStartTime>M2&&I!==1073741824&&(S.flags|=128,k=!0,Pm(W,!1),S.lanes=4194304);W.isBackwards?(re.sibling=S.child,S.child=re):(x=W.last,x!==null?x.sibling=re:S.child=re,W.last=re)}return W.tail!==null?(S=W.tail,W.rendering=S,W.tail=S.sibling,W.renderingStartTime=_i(),S.sibling=null,x=yi.current,vt(yi,k?x&1|2:x&1),S):(Hr(S),null);case 22:case 23:return P2(),k=S.memoizedState!==null,x!==null&&x.memoizedState!==null!==k&&(S.flags|=8192),k&&S.mode&1?lo&1073741824&&(Hr(S),oe&&S.subtreeFlags&6&&(S.flags|=8192)):Hr(S),null;case 24:return null;case 25:return null}throw Error(o(156,S.tag))}var yH=a.ReactCurrentOwner,ao=!1;function ds(x,S,I,k){S.child=x===null?b3(S,null,I,k):Id(S,x.child,I,k)}function q3(x,S,I,k,W){I=I.render;var re=S.ref;return Fi(S,W),k=t2(x,S,I,k,re,W),I=n2(),x!==null&&!ao?(S.updateQueue=x.updateQueue,S.flags&=-2053,x.lanes&=~W,wl(x,S,W)):(ci&&I&&WS(S),S.flags|=1,ds(x,S,k,W),S.child)}function Y3(x,S,I,k,W){if(x===null){var re=I.type;return typeof re=="function"&&!I2(re)&&re.defaultProps===void 0&&I.compare===null&&I.defaultProps===void 0?(S.tag=15,S.type=re,K3(x,S,re,k,W)):(x=bv(I.type,null,k,S,S.mode,W),x.ref=S.ref,x.return=S,S.child=x)}if(re=x.child,!(x.lanes&W)){var Fe=re.memoizedProps;if(I=I.compare,I=I!==null?I:zu,I(Fe,k)&&x.ref===S.ref)return wl(x,S,W)}return S.flags|=1,x=Tc(re,k),x.ref=S.ref,x.return=S,S.child=x}function K3(x,S,I,k,W){if(x!==null&&zu(x.memoizedProps,k)&&x.ref===S.ref)if(ao=!1,(x.lanes&W)!==0)x.flags&131072&&(ao=!0);else return S.lanes=x.lanes,wl(x,S,W);return l2(x,S,I,k,W)}function Z3(x,S,I){var k=S.pendingProps,W=k.children,re=x!==null?x.memoizedState:null;if(k.mode==="hidden")if(!(S.mode&1))S.memoizedState={baseLanes:0,cachePool:null},vt(Fd,lo),lo|=I;else if(I&1073741824)S.memoizedState={baseLanes:0,cachePool:null},k=re!==null?re.baseLanes:I,vt(Fd,lo),lo|=k;else return x=re!==null?re.baseLanes|I:I,S.lanes=S.childLanes=1073741824,S.memoizedState={baseLanes:x,cachePool:null},S.updateQueue=null,vt(Fd,lo),lo|=x,null;else re!==null?(k=re.baseLanes|I,S.memoizedState=null):k=I,vt(Fd,lo),lo|=k;return ds(x,S,W,I),S.child}function Q3(x,S){var I=S.ref;(x===null&&I!==null||x!==null&&x.ref!==I)&&(S.flags|=512,S.flags|=2097152)}function l2(x,S,I,k,W){var re=Pn(I)?vi:Rt.current;return re=$n(S,re),Fi(S,W),I=t2(x,S,I,k,re,W),k=n2(),x!==null&&!ao?(S.updateQueue=x.updateQueue,S.flags&=-2053,x.lanes&=~W,wl(x,S,W)):(ci&&k&&WS(S),S.flags|=1,ds(x,S,I,W),S.child)}function J3(x,S,I,k,W){if(Pn(I)){var re=!0;hn(S)}else re=!1;if(Fi(S,W),S.stateNode===null)x!==null&&(x.alternate=null,S.alternate=null,S.flags|=2),f3(S,I,k),$S(S,I,k,W),k=!0;else if(x===null){var Fe=S.stateNode,Ke=S.memoizedProps;Fe.props=Ke;var ft=Fe.context,Pt=I.contextType;typeof Pt=="object"&&Pt!==null?Pt=ki(Pt):(Pt=Pn(I)?vi:Rt.current,Pt=$n(S,Pt));var Vt=I.getDerivedStateFromProps,on=typeof Vt=="function"||typeof Fe.getSnapshotBeforeUpdate=="function";on||typeof Fe.UNSAFE_componentWillReceiveProps!="function"&&typeof Fe.componentWillReceiveProps!="function"||(Ke!==k||ft!==Pt)&&p3(S,Fe,k,Pt),bc=!1;var Qt=S.memoizedState;Fe.state=Qt,z1(S,k,Fe,W),ft=S.memoizedState,Ke!==k||Qt!==ft||vn.current||bc?(typeof Vt=="function"&&(HS(S,I,Vt,k),ft=S.memoizedState),(Ke=bc||d3(S,I,Ke,k,Qt,ft,Pt))?(on||typeof Fe.UNSAFE_componentWillMount!="function"&&typeof Fe.componentWillMount!="function"||(typeof Fe.componentWillMount=="function"&&Fe.componentWillMount(),typeof Fe.UNSAFE_componentWillMount=="function"&&Fe.UNSAFE_componentWillMount()),typeof Fe.componentDidMount=="function"&&(S.flags|=4194308)):(typeof Fe.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=k,S.memoizedState=ft),Fe.props=k,Fe.state=ft,Fe.context=Pt,k=Ke):(typeof Fe.componentDidMount=="function"&&(S.flags|=4194308),k=!1)}else{Fe=S.stateNode,l3(x,S),Ke=S.memoizedProps,Pt=S.type===S.elementType?Ke:us(S.type,Ke),Fe.props=Pt,on=S.pendingProps,Qt=Fe.context,ft=I.contextType,typeof ft=="object"&&ft!==null?ft=ki(ft):(ft=Pn(I)?vi:Rt.current,ft=$n(S,ft));var Kn=I.getDerivedStateFromProps;(Vt=typeof Kn=="function"||typeof Fe.getSnapshotBeforeUpdate=="function")||typeof Fe.UNSAFE_componentWillReceiveProps!="function"&&typeof Fe.componentWillReceiveProps!="function"||(Ke!==on||Qt!==ft)&&p3(S,Fe,k,ft),bc=!1,Qt=S.memoizedState,Fe.state=Qt,z1(S,k,Fe,W);var Xt=S.memoizedState;Ke!==on||Qt!==Xt||vn.current||bc?(typeof Kn=="function"&&(HS(S,I,Kn,k),Xt=S.memoizedState),(Pt=bc||d3(S,I,Pt,k,Qt,Xt,ft)||!1)?(Vt||typeof Fe.UNSAFE_componentWillUpdate!="function"&&typeof Fe.componentWillUpdate!="function"||(typeof Fe.componentWillUpdate=="function"&&Fe.componentWillUpdate(k,Xt,ft),typeof Fe.UNSAFE_componentWillUpdate=="function"&&Fe.UNSAFE_componentWillUpdate(k,Xt,ft)),typeof Fe.componentDidUpdate=="function"&&(S.flags|=4),typeof Fe.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof Fe.componentDidUpdate!="function"||Ke===x.memoizedProps&&Qt===x.memoizedState||(S.flags|=4),typeof Fe.getSnapshotBeforeUpdate!="function"||Ke===x.memoizedProps&&Qt===x.memoizedState||(S.flags|=1024),S.memoizedProps=k,S.memoizedState=Xt),Fe.props=k,Fe.state=Xt,Fe.context=ft,k=Pt):(typeof Fe.componentDidUpdate!="function"||Ke===x.memoizedProps&&Qt===x.memoizedState||(S.flags|=4),typeof Fe.getSnapshotBeforeUpdate!="function"||Ke===x.memoizedProps&&Qt===x.memoizedState||(S.flags|=1024),k=!1)}return c2(x,S,I,k,re,W)}function c2(x,S,I,k,W,re){Q3(x,S);var Fe=(S.flags&128)!==0;if(!k&&!Fe)return W&&Yn(S,I,!1),wl(x,S,re);k=S.stateNode,yH.current=S;var Ke=Fe&&typeof I.getDerivedStateFromError!="function"?null:k.render();return S.flags|=1,x!==null&&Fe?(S.child=Id(S,x.child,null,re),S.child=Id(S,null,Ke,re)):ds(x,S,Ke,re),S.memoizedState=k.state,W&&Yn(S,I,!0),S.child}function eI(x){var S=x.stateNode;S.pendingContext?Wn(x,S.pendingContext,S.pendingContext!==S.context):S.context&&Wn(x,S.context,!1),KS(x,S.containerInfo)}function tI(x,S,I,k,W){return Rd(),YS(W),S.flags|=256,ds(x,S,I,k),S.child}var tv={dehydrated:null,treeContext:null,retryLane:0};function nv(x){return{baseLanes:x,cachePool:null}}function nI(x,S,I){var k=S.pendingProps,W=yi.current,re=!1,Fe=(S.flags&128)!==0,Ke;if((Ke=Fe)||(Ke=x!==null&&x.memoizedState===null?!1:(W&2)!==0),Ke?(re=!0,S.flags&=-129):(x===null||x.memoizedState!==null)&&(W|=1),vt(yi,W&1),x===null)return qS(S),x=S.memoizedState,x!==null&&(x=x.dehydrated,x!==null)?(S.mode&1?Ne(x)?S.lanes=8:S.lanes=1073741824:S.lanes=1,null):(W=k.children,x=k.fallback,re?(k=S.mode,re=S.child,W={mode:"hidden",children:W},!(k&1)&&re!==null?(re.childLanes=0,re.pendingProps=W):re=Sv(W,k,0,null),x=Ku(x,k,I,null),re.return=S,x.return=S,re.sibling=x,S.child=re,S.child.memoizedState=nv(I),S.memoizedState=tv,x):u2(S,W));if(W=x.memoizedState,W!==null){if(Ke=W.dehydrated,Ke!==null){if(Fe)return S.flags&256?(S.flags&=-257,iv(x,S,I,Error(o(422)))):S.memoizedState!==null?(S.child=x.child,S.flags|=128,null):(re=k.fallback,W=S.mode,k=Sv({mode:"visible",children:k.children},W,0,null),re=Ku(re,W,I,null),re.flags|=2,k.return=S,re.return=S,k.sibling=re,S.child=k,S.mode&1&&Id(S,x.child,null,I),S.child.memoizedState=nv(I),S.memoizedState=tv,re);if(!(S.mode&1))S=iv(x,S,I,null);else if(Ne(Ke))S=iv(x,S,I,Error(o(419)));else if(k=(I&x.childLanes)!==0,ao||k){if(k=ji,k!==null){switch(I&-I){case 4:re=2;break;case 16:re=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:re=32;break;case 536870912:re=268435456;break;default:re=0}k=re&(k.suspendedLanes|I)?0:re,k!==0&&k!==W.retryLane&&(W.retryLane=k,Do(x,k,-1))}R2(),S=iv(x,S,I,Error(o(421)))}else be(Ke)?(S.flags|=128,S.child=x.child,S=LH.bind(null,x),Be(Ke,S),S=null):(I=W.treeContext,pe&&(oo=wt(Ke),so=S,ci=!0,ta=null,_m=!1,I!==null&&(Po[Ro++]=xl,Po[Ro++]=bl,Po[Ro++]=Vu,xl=I.id,bl=I.overflow,Vu=S)),S=u2(S,S.pendingProps.children),S.flags|=4096);return S}return re?(k=rI(x,S,k.children,k.fallback,I),re=S.child,W=x.child.memoizedState,re.memoizedState=W===null?nv(I):{baseLanes:W.baseLanes|I,cachePool:null},re.childLanes=x.childLanes&~I,S.memoizedState=tv,k):(I=iI(x,S,k.children,I),S.memoizedState=null,I)}return re?(k=rI(x,S,k.children,k.fallback,I),re=S.child,W=x.child.memoizedState,re.memoizedState=W===null?nv(I):{baseLanes:W.baseLanes|I,cachePool:null},re.childLanes=x.childLanes&~I,S.memoizedState=tv,k):(I=iI(x,S,k.children,I),S.memoizedState=null,I)}function u2(x,S){return S=Sv({mode:"visible",children:S},x.mode,0,null),S.return=x,x.child=S}function iI(x,S,I,k){var W=x.child;return x=W.sibling,I=Tc(W,{mode:"visible",children:I}),!(S.mode&1)&&(I.lanes=k),I.return=S,I.sibling=null,x!==null&&(k=S.deletions,k===null?(S.deletions=[x],S.flags|=16):k.push(x)),S.child=I}function rI(x,S,I,k,W){var re=S.mode;x=x.child;var Fe=x.sibling,Ke={mode:"hidden",children:I};return!(re&1)&&S.child!==x?(I=S.child,I.childLanes=0,I.pendingProps=Ke,S.deletions=null):(I=Tc(x,Ke),I.subtreeFlags=x.subtreeFlags&14680064),Fe!==null?k=Tc(Fe,k):(k=Ku(k,re,W,null),k.flags|=2),k.return=S,I.return=S,I.sibling=k,S.child=I,k}function iv(x,S,I,k){return k!==null&&YS(k),Id(S,x.child,null,I),x=u2(S,S.pendingProps.children),x.flags|=2,S.memoizedState=null,x}function sI(x,S,I){x.lanes|=S;var k=x.alternate;k!==null&&(k.lanes|=S),hs(x.return,S,I)}function h2(x,S,I,k,W){var re=x.memoizedState;re===null?x.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:k,tail:I,tailMode:W}:(re.isBackwards=S,re.rendering=null,re.renderingStartTime=0,re.last=k,re.tail=I,re.tailMode=W)}function oI(x,S,I){var k=S.pendingProps,W=k.revealOrder,re=k.tail;if(ds(x,S,k.children,I),k=yi.current,k&2)k=k&1|2,S.flags|=128;else{if(x!==null&&x.flags&128)e:for(x=S.child;x!==null;){if(x.tag===13)x.memoizedState!==null&&sI(x,I,S);else if(x.tag===19)sI(x,I,S);else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===S)break e;for(;x.sibling===null;){if(x.return===null||x.return===S)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}k&=1}if(vt(yi,k),!(S.mode&1))S.memoizedState=null;else switch(W){case"forwards":for(I=S.child,W=null;I!==null;)x=I.alternate,x!==null&&W1(x)===null&&(W=I),I=I.sibling;I=W,I===null?(W=S.child,S.child=null):(W=I.sibling,I.sibling=null),h2(S,!1,W,I,re);break;case"backwards":for(I=null,W=S.child,S.child=null;W!==null;){if(x=W.alternate,x!==null&&W1(x)===null){S.child=W;break}x=W.sibling,W.sibling=I,I=W,W=x}h2(S,!0,I,null,re);break;case"together":h2(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function wl(x,S,I){if(x!==null&&(S.dependencies=x.dependencies),kd|=S.lanes,!(I&S.childLanes))return null;if(x!==null&&S.child!==x.child)throw Error(o(153));if(S.child!==null){for(x=S.child,I=Tc(x,x.pendingProps),S.child=I,I.return=S;x.sibling!==null;)x=x.sibling,I=I.sibling=Tc(x,x.pendingProps),I.return=S;I.sibling=null}return S.child}function xH(x,S,I){switch(S.tag){case 3:eI(S),Rd();break;case 5:S3(S);break;case 1:Pn(S.type)&&hn(S);break;case 4:KS(S,S.stateNode.containerInfo);break;case 10:O1(S,S.type._context,S.memoizedProps.value);break;case 13:var k=S.memoizedState;if(k!==null)return k.dehydrated!==null?(vt(yi,yi.current&1),S.flags|=128,null):I&S.child.childLanes?nI(x,S,I):(vt(yi,yi.current&1),x=wl(x,S,I),x!==null?x.sibling:null);vt(yi,yi.current&1);break;case 19:if(k=(I&S.childLanes)!==0,x.flags&128){if(k)return oI(x,S,I);S.flags|=128}var W=S.memoizedState;if(W!==null&&(W.rendering=null,W.tail=null,W.lastEffect=null),vt(yi,yi.current),k)break;return null;case 22:case 23:return S.lanes=0,Z3(x,S,I)}return wl(x,S,I)}function bH(x,S){switch(jS(S),S.tag){case 1:return Pn(S.type)&&Jt(),x=S.flags,x&65536?(S.flags=x&-65537|128,S):null;case 3:return Dd(),St(vn),St(Rt),JS(),x=S.flags,x&65536&&!(x&128)?(S.flags=x&-65537|128,S):null;case 5:return ZS(S),null;case 13:if(St(yi),x=S.memoizedState,x!==null&&x.dehydrated!==null){if(S.alternate===null)throw Error(o(340));Rd()}return x=S.flags,x&65536?(S.flags=x&-65537|128,S):null;case 19:return St(yi),null;case 4:return Dd(),null;case 10:return vr(S.type._context),null;case 22:case 23:return P2(),null;case 24:return null;default:return null}}var rv=!1,Wu=!1,SH=typeof WeakSet=="function"?WeakSet:Set,Ut=null;function sv(x,S){var I=x.ref;if(I!==null)if(typeof I=="function")try{I(null)}catch(k){ks(x,S,k)}else I.current=null}function d2(x,S,I){try{I()}catch(k){ks(x,S,k)}}var aI=!1;function wH(x,S){for(G(x.containerInfo),Ut=S;Ut!==null;)if(x=Ut,S=x.child,(x.subtreeFlags&1028)!==0&&S!==null)S.return=x,Ut=S;else for(;Ut!==null;){x=Ut;try{var I=x.alternate;if(x.flags&1024)switch(x.tag){case 0:case 11:case 15:break;case 1:if(I!==null){var k=I.memoizedProps,W=I.memoizedState,re=x.stateNode,Fe=re.getSnapshotBeforeUpdate(x.elementType===x.type?k:us(x.type,k),W);re.__reactInternalSnapshotBeforeUpdate=Fe}break;case 3:oe&&ze(x.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Ke){ks(x,x.return,Ke)}if(S=x.sibling,S!==null){S.return=x.return,Ut=S;break}Ut=x.return}return I=aI,aI=!1,I}function ju(x,S,I){var k=S.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var W=k=k.next;do{if((W.tag&x)===x){var re=W.destroy;W.destroy=void 0,re!==void 0&&d2(S,I,re)}W=W.next}while(W!==k)}}function Rm(x,S){if(S=S.updateQueue,S=S!==null?S.lastEffect:null,S!==null){var I=S=S.next;do{if((I.tag&x)===x){var k=I.create;I.destroy=k()}I=I.next}while(I!==S)}}function f2(x){var S=x.ref;if(S!==null){var I=x.stateNode;switch(x.tag){case 5:x=V(I);break;default:x=I}typeof S=="function"?S(x):S.current=x}}function lI(x,S,I){if(no&&typeof no.onCommitFiberUnmount=="function")try{no.onCommitFiberUnmount(Ou,S)}catch{}switch(S.tag){case 0:case 11:case 14:case 15:if(x=S.updateQueue,x!==null&&(x=x.lastEffect,x!==null)){var k=x=x.next;do{var W=k,re=W.destroy;W=W.tag,re!==void 0&&(W&2||W&4)&&d2(S,I,re),k=k.next}while(k!==x)}break;case 1:if(sv(S,I),x=S.stateNode,typeof x.componentWillUnmount=="function")try{x.props=S.memoizedProps,x.state=S.memoizedState,x.componentWillUnmount()}catch(Fe){ks(S,I,Fe)}break;case 5:sv(S,I);break;case 4:oe?pI(x,S,I):$&&$&&(S=S.stateNode.containerInfo,I=Re(S),_t(S,I))}}function cI(x,S,I){for(var k=S;;)if(lI(x,k,I),k.child===null||oe&&k.tag===4){if(k===S)break;for(;k.sibling===null;){if(k.return===null||k.return===S)return;k=k.return}k.sibling.return=k.return,k=k.sibling}else k.child.return=k,k=k.child}function uI(x){var S=x.alternate;S!==null&&(x.alternate=null,uI(S)),x.child=null,x.deletions=null,x.sibling=null,x.tag===5&&(S=x.stateNode,S!==null&&Ue(S)),x.stateNode=null,x.return=null,x.dependencies=null,x.memoizedProps=null,x.memoizedState=null,x.pendingProps=null,x.stateNode=null,x.updateQueue=null}function hI(x){return x.tag===5||x.tag===3||x.tag===4}function dI(x){e:for(;;){for(;x.sibling===null;){if(x.return===null||hI(x.return))return null;x=x.return}for(x.sibling.return=x.return,x=x.sibling;x.tag!==5&&x.tag!==6&&x.tag!==18;){if(x.flags&2||x.child===null||x.tag===4)continue e;x.child.return=x,x=x.child}if(!(x.flags&2))return x.stateNode}}function fI(x){if(oe){e:{for(var S=x.return;S!==null;){if(hI(S))break e;S=S.return}throw Error(o(160))}var I=S;switch(I.tag){case 5:S=I.stateNode,I.flags&32&&(at(S),I.flags&=-33),I=dI(x),m2(x,I,S);break;case 3:case 4:S=I.stateNode.containerInfo,I=dI(x),p2(x,I,S);break;default:throw Error(o(161))}}}function p2(x,S,I){var k=x.tag;if(k===5||k===6)x=x.stateNode,S?Oe(I,x,S):$e(I,x);else if(k!==4&&(x=x.child,x!==null))for(p2(x,S,I),x=x.sibling;x!==null;)p2(x,S,I),x=x.sibling}function m2(x,S,I){var k=x.tag;if(k===5||k===6)x=x.stateNode,S?rt(I,x,S):De(I,x);else if(k!==4&&(x=x.child,x!==null))for(m2(x,S,I),x=x.sibling;x!==null;)m2(x,S,I),x=x.sibling}function pI(x,S,I){for(var k=S,W=!1,re,Fe;;){if(!W){W=k.return;e:for(;;){if(W===null)throw Error(o(160));switch(re=W.stateNode,W.tag){case 5:Fe=!1;break e;case 3:re=re.containerInfo,Fe=!0;break e;case 4:re=re.containerInfo,Fe=!0;break e}W=W.return}W=!0}if(k.tag===5||k.tag===6)cI(x,k,I),Fe?it(re,k.stateNode):qe(re,k.stateNode);else if(k.tag===18)Fe?Te(re,k.stateNode):Se(re,k.stateNode);else if(k.tag===4){if(k.child!==null){re=k.stateNode.containerInfo,Fe=!0,k.child.return=k,k=k.child;continue}}else if(lI(x,k,I),k.child!==null){k.child.return=k,k=k.child;continue}if(k===S)break;for(;k.sibling===null;){if(k.return===null||k.return===S)return;k=k.return,k.tag===4&&(W=!1)}k.sibling.return=k.return,k=k.sibling}}function g2(x,S){if(oe){switch(S.tag){case 0:case 11:case 14:case 15:ju(3,S,S.return),Rm(3,S),ju(5,S,S.return);return;case 1:return;case 5:var I=S.stateNode;if(I!=null){var k=S.memoizedProps;x=x!==null?x.memoizedProps:k;var W=S.type,re=S.updateQueue;S.updateQueue=null,re!==null&&nt(I,re,W,x,k,S)}return;case 6:if(S.stateNode===null)throw Error(o(162));I=S.memoizedProps,Ae(S.stateNode,x!==null?x.memoizedProps:I,I);return;case 3:pe&&x!==null&&x.memoizedState.isDehydrated&&fe(S.stateNode.containerInfo);return;case 12:return;case 13:ov(S);return;case 19:ov(S);return;case 17:return}throw Error(o(163))}switch(S.tag){case 0:case 11:case 14:case 15:ju(3,S,S.return),Rm(3,S),ju(5,S,S.return);return;case 12:return;case 13:ov(S);return;case 19:ov(S);return;case 3:pe&&x!==null&&x.memoizedState.isDehydrated&&fe(S.stateNode.containerInfo);break;case 22:case 23:return}e:if($){switch(S.tag){case 1:case 5:case 6:break e;case 3:case 4:S=S.stateNode,_t(S.containerInfo,S.pendingChildren);break e}throw Error(o(163))}}function ov(x){var S=x.updateQueue;if(S!==null){x.updateQueue=null;var I=x.stateNode;I===null&&(I=x.stateNode=new SH),S.forEach(function(k){var W=DH.bind(null,x,k);I.has(k)||(I.add(k),k.then(W,W))})}}function MH(x,S){for(Ut=S;Ut!==null;){S=Ut;var I=S.deletions;if(I!==null)for(var k=0;k<I.length;k++){var W=I[k];try{var re=x;oe?pI(re,W,S):cI(re,W,S);var Fe=W.alternate;Fe!==null&&(Fe.return=null),W.return=null}catch(jt){ks(W,S,jt)}}if(I=S.child,S.subtreeFlags&12854&&I!==null)I.return=S,Ut=I;else for(;Ut!==null;){S=Ut;try{var Ke=S.flags;if(Ke&32&&oe&&at(S.stateNode),Ke&512){var ft=S.alternate;if(ft!==null){var Pt=ft.ref;Pt!==null&&(typeof Pt=="function"?Pt(null):Pt.current=null)}}if(Ke&8192)switch(S.tag){case 13:if(S.memoizedState!==null){var Vt=S.alternate;(Vt===null||Vt.memoizedState===null)&&(w2=_i())}break;case 22:var on=S.memoizedState!==null,Qt=S.alternate,Kn=Qt!==null&&Qt.memoizedState!==null;if(I=S,oe){e:if(k=I,W=on,re=null,oe)for(var Xt=k;;){if(Xt.tag===5){if(re===null){re=Xt;var $r=Xt.stateNode;W?ht($r):je(Xt.stateNode,Xt.memoizedProps)}}else if(Xt.tag===6){if(re===null){var Fo=Xt.stateNode;W?Qe(Fo):ee(Fo,Xt.memoizedProps)}}else if((Xt.tag!==22&&Xt.tag!==23||Xt.memoizedState===null||Xt===k)&&Xt.child!==null){Xt.child.return=Xt,Xt=Xt.child;continue}if(Xt===k)break;for(;Xt.sibling===null;){if(Xt.return===null||Xt.return===k)break e;re===Xt&&(re=null),Xt=Xt.return}re===Xt&&(re=null),Xt.sibling.return=Xt.return,Xt=Xt.sibling}}if(on&&!Kn&&I.mode&1){Ut=I;for(var ot=I.child;ot!==null;){for(I=Ut=ot;Ut!==null;){k=Ut;var Je=k.child;switch(k.tag){case 0:case 11:case 14:case 15:ju(4,k,k.return);break;case 1:sv(k,k.return);var ut=k.stateNode;if(typeof ut.componentWillUnmount=="function"){var Bt=k.return;try{ut.props=k.memoizedProps,ut.state=k.memoizedState,ut.componentWillUnmount()}catch(jt){ks(k,Bt,jt)}}break;case 5:sv(k,k.return);break;case 22:if(k.memoizedState!==null){vI(I);continue}}Je!==null?(Je.return=k,Ut=Je):vI(I)}ot=ot.sibling}}}switch(Ke&4102){case 2:fI(S),S.flags&=-3;break;case 6:fI(S),S.flags&=-3,g2(S.alternate,S);break;case 4096:S.flags&=-4097;break;case 4100:S.flags&=-4097,g2(S.alternate,S);break;case 4:g2(S.alternate,S)}}catch(jt){ks(S,S.return,jt)}if(I=S.sibling,I!==null){I.return=S.return,Ut=I;break}Ut=S.return}}}function AH(x,S,I){Ut=x,mI(x)}function mI(x,S,I){for(var k=(x.mode&1)!==0;Ut!==null;){var W=Ut,re=W.child;if(W.tag===22&&k){var Fe=W.memoizedState!==null||rv;if(!Fe){var Ke=W.alternate,ft=Ke!==null&&Ke.memoizedState!==null||Wu;Ke=rv;var Pt=Wu;if(rv=Fe,(Wu=ft)&&!Pt)for(Ut=W;Ut!==null;)Fe=Ut,ft=Fe.child,Fe.tag===22&&Fe.memoizedState!==null?_I(W):ft!==null?(ft.return=Fe,Ut=ft):_I(W);for(;re!==null;)Ut=re,mI(re),re=re.sibling;Ut=W,rv=Ke,Wu=Pt}gI(x)}else W.subtreeFlags&8772&&re!==null?(re.return=W,Ut=re):gI(x)}}function gI(x){for(;Ut!==null;){var S=Ut;if(S.flags&8772){var I=S.alternate;try{if(S.flags&8772)switch(S.tag){case 0:case 11:case 15:Wu||Rm(5,S);break;case 1:var k=S.stateNode;if(S.flags&4&&!Wu)if(I===null)k.componentDidMount();else{var W=S.elementType===S.type?I.memoizedProps:us(S.type,I.memoizedProps);k.componentDidUpdate(W,I.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var re=S.updateQueue;re!==null&&u3(S,re,k);break;case 3:var Fe=S.updateQueue;if(Fe!==null){if(I=null,S.child!==null)switch(S.child.tag){case 5:I=V(S.child.stateNode);break;case 1:I=S.child.stateNode}u3(S,Fe,I)}break;case 5:var Ke=S.stateNode;I===null&&S.flags&4&&Ze(Ke,S.type,S.memoizedProps,S);break;case 6:break;case 4:break;case 12:break;case 13:if(pe&&S.memoizedState===null){var ft=S.alternate;if(ft!==null){var Pt=ft.memoizedState;if(Pt!==null){var Vt=Pt.dehydrated;Vt!==null&&Me(Vt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}Wu||S.flags&512&&f2(S)}catch(on){ks(S,S.return,on)}}if(S===x){Ut=null;break}if(I=S.sibling,I!==null){I.return=S.return,Ut=I;break}Ut=S.return}}function vI(x){for(;Ut!==null;){var S=Ut;if(S===x){Ut=null;break}var I=S.sibling;if(I!==null){I.return=S.return,Ut=I;break}Ut=S.return}}function _I(x){for(;Ut!==null;){var S=Ut;try{switch(S.tag){case 0:case 11:case 15:var I=S.return;try{Rm(4,S)}catch(ft){ks(S,I,ft)}break;case 1:var k=S.stateNode;if(typeof k.componentDidMount=="function"){var W=S.return;try{k.componentDidMount()}catch(ft){ks(S,W,ft)}}var re=S.return;try{f2(S)}catch(ft){ks(S,re,ft)}break;case 5:var Fe=S.return;try{f2(S)}catch(ft){ks(S,Fe,ft)}}}catch(ft){ks(S,S.return,ft)}if(S===x){Ut=null;break}var Ke=S.sibling;if(Ke!==null){Ke.return=S.return,Ut=Ke;break}Ut=S.return}}var av=0,lv=1,cv=2,uv=3,hv=4;if(typeof Symbol=="function"&&Symbol.for){var Im=Symbol.for;av=Im("selector.component"),lv=Im("selector.has_pseudo_class"),cv=Im("selector.role"),uv=Im("selector.test_id"),hv=Im("selector.text")}function v2(x){var S=xe(x);if(S!=null){if(typeof S.memoizedProps["data-testname"]!="string")throw Error(o(364));return S}if(x=de(x),x===null)throw Error(o(362));return x.stateNode.current}function _2(x,S){switch(S.$$typeof){case av:if(x.type===S.value)return!0;break;case lv:e:{S=S.value,x=[x,0];for(var I=0;I<x.length;){var k=x[I++],W=x[I++],re=S[W];if(k.tag!==5||!X(k)){for(;re!=null&&_2(k,re);)W++,re=S[W];if(W===S.length){S=!0;break e}else for(k=k.child;k!==null;)x.push(k,W),k=k.sibling}}S=!1}return S;case cv:if(x.tag===5&&ye(x.stateNode,S.value))return!0;break;case hv:if((x.tag===5||x.tag===6)&&(x=te(x),x!==null&&0<=x.indexOf(S.value)))return!0;break;case uv:if(x.tag===5&&(x=x.memoizedProps["data-testname"],typeof x=="string"&&x.toLowerCase()===S.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function y2(x){switch(x.$$typeof){case av:return"<"+(M(x.value)||"Unknown")+">";case lv:return":has("+(y2(x)||"")+")";case cv:return'[role="'+x.value+'"]';case hv:return'"'+x.value+'"';case uv:return'[data-testname="'+x.value+'"]';default:throw Error(o(365))}}function yI(x,S){var I=[];x=[x,0];for(var k=0;k<x.length;){var W=x[k++],re=x[k++],Fe=S[re];if(W.tag!==5||!X(W)){for(;Fe!=null&&_2(W,Fe);)re++,Fe=S[re];if(re===S.length)I.push(W);else for(W=W.child;W!==null;)x.push(W,re),W=W.sibling}}return I}function x2(x,S){if(!J)throw Error(o(363));x=v2(x),x=yI(x,S),S=[],x=Array.from(x);for(var I=0;I<x.length;){var k=x[I++];if(k.tag===5)X(k)||S.push(k.stateNode);else for(k=k.child;k!==null;)x.push(k),k=k.sibling}return S}var EH=Math.ceil,dv=a.ReactCurrentDispatcher,b2=a.ReactCurrentOwner,Ui=a.ReactCurrentBatchConfig,_n=0,ji=null,Xi=null,Cr=0,lo=0,Fd=Ot(0),rr=0,Lm=null,kd=0,fv=0,S2=0,Dm=null,Ns=null,w2=0,M2=1/0;function Ud(){M2=_i()+500}var pv=!1,A2=null,wc=null,mv=!1,Mc=null,gv=0,Nm=0,E2=null,vv=-1,_v=0;function fs(){return _n&6?_i():vv!==-1?vv:vv=_i()}function Ac(x){return x.mode&1?_n&2&&Cr!==0?Cr&-Cr:Bu.transition!==null?(_v===0&&(x=ss,ss<<=1,!(ss&4194240)&&(ss=64),_v=x),_v):(x=ln,x!==0?x:ve()):1}function Do(x,S,I){if(50<Nm)throw Nm=0,E2=null,Error(o(185));var k=yv(x,S);return k===null?null:(to(k,S,I),(!(_n&2)||k!==ji)&&(k===ji&&(!(_n&2)&&(fv|=S),rr===4&&Ec(k,Cr)),Fs(k,I),S===1&&_n===0&&!(x.mode&1)&&(Ud(),za&&Ds())),k)}function yv(x,S){x.lanes|=S;var I=x.alternate;for(I!==null&&(I.lanes|=S),I=x,x=x.return;x!==null;)x.childLanes|=S,I=x.alternate,I!==null&&(I.childLanes|=S),I=x,x=x.return;return I.tag===3?I.stateNode:null}function Fs(x,S){var I=x.callbackNode;Qo(x,S);var k=eo(x,x===ji?Cr:0);if(k===0)I!==null&&Ad(I),x.callbackNode=null,x.callbackPriority=0;else if(S=k&-k,x.callbackPriority!==S){if(I!=null&&Ad(I),S===1)x.tag===0?vm(bI.bind(null,x)):gm(bI.bind(null,x)),Le?Z(function(){_n===0&&Ds()}):_l(Uu,Ds),I=null;else{switch(vl(k)){case 1:I=Uu;break;case 4:I=k1;break;case 16:I=ls;break;case 536870912:I=pm;break;default:I=ls}I=RI(I,xI.bind(null,x))}x.callbackPriority=S,x.callbackNode=I}}function xI(x,S){if(vv=-1,_v=0,_n&6)throw Error(o(327));var I=x.callbackNode;if(Yu()&&x.callbackNode!==I)return null;var k=eo(x,x===ji?Cr:0);if(k===0)return null;if(k&30||k&x.expiredLanes||S)S=xv(x,k);else{S=k;var W=_n;_n|=2;var re=MI();(ji!==x||Cr!==S)&&(Ud(),Xu(x,S));do try{PH();break}catch(Ke){wI(x,Ke)}while(!0);Td(),dv.current=re,_n=W,Xi!==null?S=0:(ji=null,Cr=0,S=rr)}if(S!==0){if(S===2&&(W=mr(x),W!==0&&(k=W,S=T2(x,W))),S===1)throw I=Lm,Xu(x,0),Ec(x,k),Fs(x,_i()),I;if(S===6)Ec(x,k);else{if(W=x.current.alternate,!(k&30)&&!TH(W)&&(S=xv(x,k),S===2&&(re=mr(x),re!==0&&(k=re,S=T2(x,re))),S===1))throw I=Lm,Xu(x,0),Ec(x,k),Fs(x,_i()),I;switch(x.finishedWork=W,x.finishedLanes=k,S){case 0:case 1:throw Error(o(345));case 2:qu(x,Ns);break;case 3:if(Ec(x,k),(k&130023424)===k&&(S=w2+500-_i(),10<S)){if(eo(x,0)!==0)break;if(W=x.suspendedLanes,(W&k)!==k){fs(),x.pingedLanes|=x.suspendedLanes&W;break}x.timeoutHandle=ne(qu.bind(null,x,Ns),S);break}qu(x,Ns);break;case 4:if(Ec(x,k),(k&4194240)===k)break;for(S=x.eventTimes,W=-1;0<k;){var Fe=31-Wi(k);re=1<<Fe,Fe=S[Fe],Fe>W&&(W=Fe),k&=~re}if(k=W,k=_i()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*EH(k/1960))-k,10<k){x.timeoutHandle=ne(qu.bind(null,x,Ns),k);break}qu(x,Ns);break;case 5:qu(x,Ns);break;default:throw Error(o(329))}}}return Fs(x,_i()),x.callbackNode===I?xI.bind(null,x):null}function T2(x,S){var I=Dm;return x.current.memoizedState.isDehydrated&&(Xu(x,S).flags|=256),x=xv(x,S),x!==2&&(S=Ns,Ns=I,S!==null&&C2(S)),x}function C2(x){Ns===null?Ns=x:Ns.push.apply(Ns,x)}function TH(x){for(var S=x;;){if(S.flags&16384){var I=S.updateQueue;if(I!==null&&(I=I.stores,I!==null))for(var k=0;k<I.length;k++){var W=I[k],re=W.getSnapshot;W=W.value;try{if(!io(re(),W))return!1}catch{return!1}}}if(I=S.child,S.subtreeFlags&16384&&I!==null)I.return=S,S=I;else{if(S===x)break;for(;S.sibling===null;){if(S.return===null||S.return===x)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function Ec(x,S){for(S&=~S2,S&=~fv,x.suspendedLanes|=S,x.pingedLanes&=~S,x=x.expirationTimes;0<S;){var I=31-Wi(S),k=1<<I;x[I]=-1,S&=~k}}function bI(x){if(_n&6)throw Error(o(327));Yu();var S=eo(x,0);if(!(S&1))return Fs(x,_i()),null;var I=xv(x,S);if(x.tag!==0&&I===2){var k=mr(x);k!==0&&(S=k,I=T2(x,k))}if(I===1)throw I=Lm,Xu(x,0),Ec(x,S),Fs(x,_i()),I;if(I===6)throw Error(o(345));return x.finishedWork=x.current.alternate,x.finishedLanes=S,qu(x,Ns),Fs(x,_i()),null}function SI(x){Mc!==null&&Mc.tag===0&&!(_n&6)&&Yu();var S=_n;_n|=1;var I=Ui.transition,k=ln;try{if(Ui.transition=null,ln=1,x)return x()}finally{ln=k,Ui.transition=I,_n=S,!(_n&6)&&Ds()}}function P2(){lo=Fd.current,St(Fd)}function Xu(x,S){x.finishedWork=null,x.finishedLanes=0;var I=x.timeoutHandle;if(I!==le&&(x.timeoutHandle=le,Q(I)),Xi!==null)for(I=Xi.return;I!==null;){var k=I;switch(jS(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&Jt();break;case 3:Dd(),St(vn),St(Rt),JS();break;case 5:ZS(k);break;case 4:Dd();break;case 13:St(yi);break;case 19:St(yi);break;case 10:vr(k.type._context);break;case 22:case 23:P2()}I=I.return}if(ji=x,Xi=x=Tc(x.current,null),Cr=lo=S,rr=0,Lm=null,S2=fv=kd=0,Ns=Dm=null,ro!==null){for(S=0;S<ro.length;S++)if(I=ro[S],k=I.interleaved,k!==null){I.interleaved=null;var W=k.next,re=I.pending;if(re!==null){var Fe=re.next;re.next=W,k.next=Fe}I.pending=k}ro=null}return x}function wI(x,S){do{var I=Xi;try{if(Td(),j1.current=Q1,X1){for(var k=Pi.memoizedState;k!==null;){var W=k.queue;W!==null&&(W.pending=null),k=k.next}X1=!1}if(Nd=0,_r=Gr=Pi=null,wm=!1,Mm=0,b2.current=null,I===null||I.return===null){rr=1,Lm=S,Xi=null;break}e:{var re=x,Fe=I.return,Ke=I,ft=S;if(S=Cr,Ke.flags|=32768,ft!==null&&typeof ft=="object"&&typeof ft.then=="function"){var Pt=ft,Vt=Ke,on=Vt.tag;if(!(Vt.mode&1)&&(on===0||on===11||on===15)){var Qt=Vt.alternate;Qt?(Vt.updateQueue=Qt.updateQueue,Vt.memoizedState=Qt.memoizedState,Vt.lanes=Qt.lanes):(Vt.updateQueue=null,Vt.memoizedState=null)}var Kn=$3(Fe);if(Kn!==null){Kn.flags&=-257,W3(Kn,Fe,Ke,re,S),Kn.mode&1&&H3(re,Pt,S),S=Kn,ft=Pt;var Xt=S.updateQueue;if(Xt===null){var $r=new Set;$r.add(ft),S.updateQueue=$r}else Xt.add(ft);break e}else{if(!(S&1)){H3(re,Pt,S),R2();break e}ft=Error(o(426))}}else if(ci&&Ke.mode&1){var Fo=$3(Fe);if(Fo!==null){!(Fo.flags&65536)&&(Fo.flags|=256),W3(Fo,Fe,Ke,re,S),YS(ft);break e}}re=ft,rr!==4&&(rr=2),Dm===null?Dm=[re]:Dm.push(re),ft=o2(ft,Ke),Ke=Fe;do{switch(Ke.tag){case 3:Ke.flags|=65536,S&=-S,Ke.lanes|=S;var ot=G3(Ke,ft,S);c3(Ke,ot);break e;case 1:re=ft;var Je=Ke.type,ut=Ke.stateNode;if(!(Ke.flags&128)&&(typeof Je.getDerivedStateFromError=="function"||ut!==null&&typeof ut.componentDidCatch=="function"&&(wc===null||!wc.has(ut)))){Ke.flags|=65536,S&=-S,Ke.lanes|=S;var Bt=V3(Ke,re,S);c3(Ke,Bt);break e}}Ke=Ke.return}while(Ke!==null)}EI(I)}catch(jt){S=jt,Xi===I&&I!==null&&(Xi=I=I.return);continue}break}while(!0)}function MI(){var x=dv.current;return dv.current=Q1,x===null?Q1:x}function R2(){(rr===0||rr===3||rr===2)&&(rr=4),ji===null||!(kd&268435455)&&!(fv&268435455)||Ec(ji,Cr)}function xv(x,S){var I=_n;_n|=2;var k=MI();ji===x&&Cr===S||Xu(x,S);do try{CH();break}catch(W){wI(x,W)}while(!0);if(Td(),_n=I,dv.current=k,Xi!==null)throw Error(o(261));return ji=null,Cr=0,rr}function CH(){for(;Xi!==null;)AI(Xi)}function PH(){for(;Xi!==null&&!fm();)AI(Xi)}function AI(x){var S=PI(x.alternate,x,lo);x.memoizedProps=x.pendingProps,S===null?EI(x):Xi=S,b2.current=null}function EI(x){var S=x;do{var I=S.alternate;if(x=S.return,S.flags&32768){if(I=bH(I,S),I!==null){I.flags&=32767,Xi=I;return}if(x!==null)x.flags|=32768,x.subtreeFlags=0,x.deletions=null;else{rr=6,Xi=null;return}}else if(I=_H(I,S,lo),I!==null){Xi=I;return}if(S=S.sibling,S!==null){Xi=S;return}Xi=S=x}while(S!==null);rr===0&&(rr=5)}function qu(x,S){var I=ln,k=Ui.transition;try{Ui.transition=null,ln=1,RH(x,S,I)}finally{Ui.transition=k,ln=I}return null}function RH(x,S,I){do Yu();while(Mc!==null);if(_n&6)throw Error(o(327));var k=x.finishedWork,W=x.finishedLanes;if(k===null)return null;if(x.finishedWork=null,x.finishedLanes=0,k===x.current)throw Error(o(177));x.callbackNode=null,x.callbackPriority=0;var re=k.lanes|k.childLanes;if(ir(x,re),x===ji&&(Xi=ji=null,Cr=0),!(k.subtreeFlags&2064)&&!(k.flags&2064)||mv||(mv=!0,RI(ls,function(){return Yu(),null})),re=(k.flags&15990)!==0,k.subtreeFlags&15990||re){re=Ui.transition,Ui.transition=null;var Fe=ln;ln=1;var Ke=_n;_n|=4,b2.current=null,wH(x,k),MH(x,k),B(x.containerInfo),x.current=k,AH(k),F1(),_n=Ke,ln=Fe,Ui.transition=re}else x.current=k;if(mv&&(mv=!1,Mc=x,gv=W),re=x.pendingLanes,re===0&&(wc=null),mm(k.stateNode),Fs(x,_i()),S!==null)for(I=x.onRecoverableError,k=0;k<S.length;k++)I(S[k]);if(pv)throw pv=!1,x=A2,A2=null,x;return gv&1&&x.tag!==0&&Yu(),re=x.pendingLanes,re&1?x===E2?Nm++:(Nm=0,E2=x):Nm=0,Ds(),null}function Yu(){if(Mc!==null){var x=vl(gv),S=Ui.transition,I=ln;try{if(Ui.transition=null,ln=16>x?16:x,Mc===null)var k=!1;else{if(x=Mc,Mc=null,gv=0,_n&6)throw Error(o(331));var W=_n;for(_n|=4,Ut=x.current;Ut!==null;){var re=Ut,Fe=re.child;if(Ut.flags&16){var Ke=re.deletions;if(Ke!==null){for(var ft=0;ft<Ke.length;ft++){var Pt=Ke[ft];for(Ut=Pt;Ut!==null;){var Vt=Ut;switch(Vt.tag){case 0:case 11:case 15:ju(8,Vt,re)}var on=Vt.child;if(on!==null)on.return=Vt,Ut=on;else for(;Ut!==null;){Vt=Ut;var Qt=Vt.sibling,Kn=Vt.return;if(uI(Vt),Vt===Pt){Ut=null;break}if(Qt!==null){Qt.return=Kn,Ut=Qt;break}Ut=Kn}}}var Xt=re.alternate;if(Xt!==null){var $r=Xt.child;if($r!==null){Xt.child=null;do{var Fo=$r.sibling;$r.sibling=null,$r=Fo}while($r!==null)}}Ut=re}}if(re.subtreeFlags&2064&&Fe!==null)Fe.return=re,Ut=Fe;else e:for(;Ut!==null;){if(re=Ut,re.flags&2048)switch(re.tag){case 0:case 11:case 15:ju(9,re,re.return)}var ot=re.sibling;if(ot!==null){ot.return=re.return,Ut=ot;break e}Ut=re.return}}var Je=x.current;for(Ut=Je;Ut!==null;){Fe=Ut;var ut=Fe.child;if(Fe.subtreeFlags&2064&&ut!==null)ut.return=Fe,Ut=ut;else e:for(Fe=Je;Ut!==null;){if(Ke=Ut,Ke.flags&2048)try{switch(Ke.tag){case 0:case 11:case 15:Rm(9,Ke)}}catch(jt){ks(Ke,Ke.return,jt)}if(Ke===Fe){Ut=null;break e}var Bt=Ke.sibling;if(Bt!==null){Bt.return=Ke.return,Ut=Bt;break e}Ut=Ke.return}}if(_n=W,Ds(),no&&typeof no.onPostCommitFiberRoot=="function")try{no.onPostCommitFiberRoot(Ou,x)}catch{}k=!0}return k}finally{ln=I,Ui.transition=S}}return!1}function TI(x,S,I){S=o2(I,S),S=G3(x,S,1),Sc(x,S),S=fs(),x=yv(x,1),x!==null&&(to(x,1,S),Fs(x,S))}function ks(x,S,I){if(x.tag===3)TI(x,x,I);else for(;S!==null;){if(S.tag===3){TI(S,x,I);break}else if(S.tag===1){var k=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(wc===null||!wc.has(k))){x=o2(I,x),x=V3(S,x,1),Sc(S,x),x=fs(),S=yv(S,1),S!==null&&(to(S,1,x),Fs(S,x));break}}S=S.return}}function IH(x,S,I){var k=x.pingCache;k!==null&&k.delete(S),S=fs(),x.pingedLanes|=x.suspendedLanes&I,ji===x&&(Cr&I)===I&&(rr===4||rr===3&&(Cr&130023424)===Cr&&500>_i()-w2?Xu(x,0):S2|=I),Fs(x,S)}function CI(x,S){S===0&&(x.mode&1?(S=os,os<<=1,!(os&130023424)&&(os=4194304)):S=1);var I=fs();x=yv(x,S),x!==null&&(to(x,S,I),Fs(x,I))}function LH(x){var S=x.memoizedState,I=0;S!==null&&(I=S.retryLane),CI(x,I)}function DH(x,S){var I=0;switch(x.tag){case 13:var k=x.stateNode,W=x.memoizedState;W!==null&&(I=W.retryLane);break;case 19:k=x.stateNode;break;default:throw Error(o(314))}k!==null&&k.delete(S),CI(x,I)}var PI;PI=function(x,S,I){if(x!==null)if(x.memoizedProps!==S.pendingProps||vn.current)ao=!0;else{if(!(x.lanes&I)&&!(S.flags&128))return ao=!1,xH(x,S,I);ao=!!(x.flags&131072)}else ao=!1,ci&&S.flags&1048576&&m3(S,H1,S.index);switch(S.lanes=0,S.tag){case 2:var k=S.type;x!==null&&(x.alternate=null,S.alternate=null,S.flags|=2),x=S.pendingProps;var W=$n(S,Rt.current);Fi(S,I),W=t2(null,S,k,x,W,I);var re=n2();return S.flags|=1,typeof W=="object"&&W!==null&&typeof W.render=="function"&&W.$$typeof===void 0?(S.tag=1,S.memoizedState=null,S.updateQueue=null,Pn(k)?(re=!0,hn(S)):re=!1,S.memoizedState=W.state!==null&&W.state!==void 0?W.state:null,VS(S),W.updater=G1,S.stateNode=W,W._reactInternals=S,$S(S,k,x,I),S=c2(null,S,k,!0,re,I)):(S.tag=0,ci&&re&&WS(S),ds(null,S,W,I),S=S.child),S;case 16:k=S.elementType;e:{switch(x!==null&&(x.alternate=null,S.alternate=null,S.flags|=2),x=S.pendingProps,W=k._init,k=W(k._payload),S.type=k,W=S.tag=FH(k),x=us(k,x),W){case 0:S=l2(null,S,k,x,I);break e;case 1:S=J3(null,S,k,x,I);break e;case 11:S=q3(null,S,k,x,I);break e;case 14:S=Y3(null,S,k,us(k.type,x),I);break e}throw Error(o(306,k,""))}return S;case 0:return k=S.type,W=S.pendingProps,W=S.elementType===k?W:us(k,W),l2(x,S,k,W,I);case 1:return k=S.type,W=S.pendingProps,W=S.elementType===k?W:us(k,W),J3(x,S,k,W,I);case 3:e:{if(eI(S),x===null)throw Error(o(387));k=S.pendingProps,re=S.memoizedState,W=re.element,l3(x,S),z1(S,k,null,I);var Fe=S.memoizedState;if(k=Fe.element,pe&&re.isDehydrated)if(re={element:k,isDehydrated:!1,cache:Fe.cache,transitions:Fe.transitions},S.updateQueue.baseState=re,S.memoizedState=re,S.flags&256){W=Error(o(423)),S=tI(x,S,k,I,W);break e}else if(k!==W){W=Error(o(424)),S=tI(x,S,k,I,W);break e}else for(pe&&(oo=mt(S.stateNode.containerInfo),so=S,ci=!0,ta=null,_m=!1),I=b3(S,null,k,I),S.child=I;I;)I.flags=I.flags&-3|4096,I=I.sibling;else{if(Rd(),k===W){S=wl(x,S,I);break e}ds(x,S,k,I)}S=S.child}return S;case 5:return S3(S),x===null&&qS(S),k=S.type,W=S.pendingProps,re=x!==null?x.memoizedProps:null,Fe=W.children,Y(k,W)?Fe=null:re!==null&&Y(k,re)&&(S.flags|=32),Q3(x,S),ds(x,S,Fe,I),S.child;case 6:return x===null&&qS(S),null;case 13:return nI(x,S,I);case 4:return KS(S,S.stateNode.containerInfo),k=S.pendingProps,x===null?S.child=Id(S,null,k,I):ds(x,S,k,I),S.child;case 11:return k=S.type,W=S.pendingProps,W=S.elementType===k?W:us(k,W),q3(x,S,k,W,I);case 7:return ds(x,S,S.pendingProps,I),S.child;case 8:return ds(x,S,S.pendingProps.children,I),S.child;case 12:return ds(x,S,S.pendingProps.children,I),S.child;case 10:e:{if(k=S.type._context,W=S.pendingProps,re=S.memoizedProps,Fe=W.value,O1(S,k,Fe),re!==null)if(io(re.value,Fe)){if(re.children===W.children&&!vn.current){S=wl(x,S,I);break e}}else for(re=S.child,re!==null&&(re.return=S);re!==null;){var Ke=re.dependencies;if(Ke!==null){Fe=re.child;for(var ft=Ke.firstContext;ft!==null;){if(ft.context===k){if(re.tag===1){ft=yl(-1,I&-I),ft.tag=2;var Pt=re.updateQueue;if(Pt!==null){Pt=Pt.shared;var Vt=Pt.pending;Vt===null?ft.next=ft:(ft.next=Vt.next,Vt.next=ft),Pt.pending=ft}}re.lanes|=I,ft=re.alternate,ft!==null&&(ft.lanes|=I),hs(re.return,I,S),Ke.lanes|=I;break}ft=ft.next}}else if(re.tag===10)Fe=re.type===S.type?null:re.child;else if(re.tag===18){if(Fe=re.return,Fe===null)throw Error(o(341));Fe.lanes|=I,Ke=Fe.alternate,Ke!==null&&(Ke.lanes|=I),hs(Fe,I,S),Fe=re.sibling}else Fe=re.child;if(Fe!==null)Fe.return=re;else for(Fe=re;Fe!==null;){if(Fe===S){Fe=null;break}if(re=Fe.sibling,re!==null){re.return=Fe.return,Fe=re;break}Fe=Fe.return}re=Fe}ds(x,S,W.children,I),S=S.child}return S;case 9:return W=S.type,k=S.pendingProps.children,Fi(S,I),W=ki(W),k=k(W),S.flags|=1,ds(x,S,k,I),S.child;case 14:return k=S.type,W=us(k,S.pendingProps),W=us(k.type,W),Y3(x,S,k,W,I);case 15:return K3(x,S,S.type,S.pendingProps,I);case 17:return k=S.type,W=S.pendingProps,W=S.elementType===k?W:us(k,W),x!==null&&(x.alternate=null,S.alternate=null,S.flags|=2),S.tag=1,Pn(k)?(x=!0,hn(S)):x=!1,Fi(S,I),f3(S,k,W),$S(S,k,W,I),c2(null,S,k,!0,x,I);case 19:return oI(x,S,I);case 22:return Z3(x,S,I)}throw Error(o(156,S.tag))};function RI(x,S){return _l(x,S)}function NH(x,S,I,k){this.tag=x,this.key=I,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function No(x,S,I,k){return new NH(x,S,I,k)}function I2(x){return x=x.prototype,!(!x||!x.isReactComponent)}function FH(x){if(typeof x=="function")return I2(x)?1:0;if(x!=null){if(x=x.$$typeof,x===_)return 11;if(x===b)return 14}return 2}function Tc(x,S){var I=x.alternate;return I===null?(I=No(x.tag,S,x.key,x.mode),I.elementType=x.elementType,I.type=x.type,I.stateNode=x.stateNode,I.alternate=x,x.alternate=I):(I.pendingProps=S,I.type=x.type,I.flags=0,I.subtreeFlags=0,I.deletions=null),I.flags=x.flags&14680064,I.childLanes=x.childLanes,I.lanes=x.lanes,I.child=x.child,I.memoizedProps=x.memoizedProps,I.memoizedState=x.memoizedState,I.updateQueue=x.updateQueue,S=x.dependencies,I.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},I.sibling=x.sibling,I.index=x.index,I.ref=x.ref,I}function bv(x,S,I,k,W,re){var Fe=2;if(k=x,typeof x=="function")I2(x)&&(Fe=1);else if(typeof x=="string")Fe=5;else e:switch(x){case u:return Ku(I.children,W,re,S);case h:Fe=8,W|=8;break;case d:return x=No(12,I,S,W|2),x.elementType=d,x.lanes=re,x;case v:return x=No(13,I,S,W),x.elementType=v,x.lanes=re,x;case g:return x=No(19,I,S,W),x.elementType=g,x.lanes=re,x;case y:return Sv(I,W,re,S);default:if(typeof x=="object"&&x!==null)switch(x.$$typeof){case f:Fe=10;break e;case m:Fe=9;break e;case _:Fe=11;break e;case b:Fe=14;break e;case p:Fe=16,k=null;break e}throw Error(o(130,x==null?x:typeof x,""))}return S=No(Fe,I,S,W),S.elementType=x,S.type=k,S.lanes=re,S}function Ku(x,S,I,k){return x=No(7,x,k,S),x.lanes=I,x}function Sv(x,S,I,k){return x=No(22,x,k,S),x.elementType=y,x.lanes=I,x.stateNode={},x}function L2(x,S,I){return x=No(6,x,null,S),x.lanes=I,x}function D2(x,S,I){return S=No(4,x.children!==null?x.children:[],x.key,S),S.lanes=I,S.stateNode={containerInfo:x.containerInfo,pendingChildren:null,implementation:x.implementation},S}function kH(x,S,I,k,W){this.tag=S,this.containerInfo=x,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=le,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Jo(0),this.expirationTimes=Jo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Jo(0),this.identifierPrefix=k,this.onRecoverableError=W,pe&&(this.mutableSourceEagerHydrationData=null)}function II(x,S,I,k,W,re,Fe,Ke,ft){return x=new kH(x,S,I,Ke,ft),S===1?(S=1,re===!0&&(S|=8)):S=0,re=No(3,null,null,S),x.current=re,re.stateNode=x,re.memoizedState={element:k,isDehydrated:I,cache:null,transitions:null},VS(re),x}function LI(x){if(!x)return $t;x=x._reactInternals;e:{if(E(x)!==x||x.tag!==1)throw Error(o(170));var S=x;do{switch(S.tag){case 3:S=S.stateNode.context;break e;case 1:if(Pn(S.type)){S=S.stateNode.__reactInternalMemoizedMergedChildContext;break e}}S=S.return}while(S!==null);throw Error(o(171))}if(x.tag===1){var I=x.type;if(Pn(I))return $i(x,I,S)}return S}function DI(x){var S=x._reactInternals;if(S===void 0)throw typeof x.render=="function"?Error(o(188)):(x=Object.keys(x).join(","),Error(o(268,x)));return x=P(S),x===null?null:x.stateNode}function NI(x,S){if(x=x.memoizedState,x!==null&&x.dehydrated!==null){var I=x.retryLane;x.retryLane=I!==0&&I<S?I:S}}function N2(x,S){NI(x,S),(x=x.alternate)&&NI(x,S)}function UH(x){return x=P(x),x===null?null:x.stateNode}function OH(){return null}return t.attemptContinuousHydration=function(x){if(x.tag===13){var S=fs();Do(x,134217728,S),N2(x,134217728)}},t.attemptHydrationAtCurrentPriority=function(x){if(x.tag===13){var S=fs(),I=Ac(x);Do(x,I,S),N2(x,I)}},t.attemptSynchronousHydration=function(x){switch(x.tag){case 3:var S=x.stateNode;if(S.current.memoizedState.isDehydrated){var I=as(S.pendingLanes);I!==0&&(zr(S,I|1),Fs(S,_i()),!(_n&6)&&(Ud(),Ds()))}break;case 13:var k=fs();SI(function(){return Do(x,1,k)}),N2(x,1)}},t.batchedUpdates=function(x,S){var I=_n;_n|=1;try{return x(S)}finally{_n=I,_n===0&&(Ud(),za&&Ds())}},t.createComponentSelector=function(x){return{$$typeof:av,value:x}},t.createContainer=function(x,S,I,k,W,re,Fe){return II(x,S,!1,null,I,k,W,re,Fe)},t.createHasPseudoClassSelector=function(x){return{$$typeof:lv,value:x}},t.createHydrationContainer=function(x,S,I,k,W,re,Fe,Ke,ft){return x=II(I,k,!0,x,W,re,Fe,Ke,ft),x.context=LI(null),I=x.current,k=fs(),W=Ac(I),re=yl(k,W),re.callback=S??null,Sc(I,re),x.current.lanes=W,to(x,W,k),Fs(x,k),x},t.createPortal=function(x,S,I){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:k==null?null:""+k,children:x,containerInfo:S,implementation:I}},t.createRoleSelector=function(x){return{$$typeof:cv,value:x}},t.createTestNameSelector=function(x){return{$$typeof:uv,value:x}},t.createTextSelector=function(x){return{$$typeof:hv,value:x}},t.deferredUpdates=function(x){var S=ln,I=Ui.transition;try{return Ui.transition=null,ln=16,x()}finally{ln=S,Ui.transition=I}},t.discreteUpdates=function(x,S,I,k,W){var re=ln,Fe=Ui.transition;try{return Ui.transition=null,ln=1,x(S,I,k,W)}finally{ln=re,Ui.transition=Fe,_n===0&&Ud()}},t.findAllNodes=x2,t.findBoundingRects=function(x,S){if(!J)throw Error(o(363));S=x2(x,S),x=[];for(var I=0;I<S.length;I++)x.push(Ie(S[I]));for(S=x.length-1;0<S;S--){I=x[S];for(var k=I.x,W=k+I.width,re=I.y,Fe=re+I.height,Ke=S-1;0<=Ke;Ke--)if(S!==Ke){var ft=x[Ke],Pt=ft.x,Vt=Pt+ft.width,on=ft.y,Qt=on+ft.height;if(k>=Pt&&re>=on&&W<=Vt&&Fe<=Qt){x.splice(S,1);break}else if(k!==Pt||I.width!==ft.width||Qt<re||on>Fe){if(!(re!==on||I.height!==ft.height||Vt<k||Pt>W)){Pt>k&&(ft.width+=Pt-k,ft.x=k),Vt<W&&(ft.width=W-Pt),x.splice(S,1);break}}else{on>re&&(ft.height+=on-re,ft.y=re),Qt<Fe&&(ft.height=Fe-on),x.splice(S,1);break}}}return x},t.findHostInstance=DI,t.findHostInstanceWithNoPortals=function(x){return x=N(x),x=x!==null?R(x):null,x===null?null:x.stateNode},t.findHostInstanceWithWarning=function(x){return DI(x)},t.flushControlled=function(x){var S=_n;_n|=1;var I=Ui.transition,k=ln;try{Ui.transition=null,ln=1,x()}finally{ln=k,Ui.transition=I,_n=S,_n===0&&(Ud(),Ds())}},t.flushPassiveEffects=Yu,t.flushSync=SI,t.focusWithin=function(x,S){if(!J)throw Error(o(363));for(x=v2(x),S=yI(x,S),S=Array.from(S),x=0;x<S.length;){var I=S[x++];if(!X(I)){if(I.tag===5&&ke(I.stateNode))return!0;for(I=I.child;I!==null;)S.push(I),I=I.sibling}}return!1},t.getCurrentUpdatePriority=function(){return ln},t.getFindAllNodesFailureDescription=function(x,S){if(!J)throw Error(o(363));var I=0,k=[];x=[v2(x),0];for(var W=0;W<x.length;){var re=x[W++],Fe=x[W++],Ke=S[Fe];if((re.tag!==5||!X(re))&&(_2(re,Ke)&&(k.push(y2(Ke)),Fe++,Fe>I&&(I=Fe)),Fe<S.length))for(re=re.child;re!==null;)x.push(re,Fe),re=re.sibling}if(I<S.length){for(x=[];I<S.length;I++)x.push(y2(S[I]));return`findAllNodes was able to match part of the selector:
  `+(k.join(" > ")+`

No matching component was found for:
  `)+x.join(" > ")}return null},t.getPublicRootInstance=function(x){if(x=x.current,!x.child)return null;switch(x.child.tag){case 5:return V(x.child.stateNode);default:return x.child.stateNode}},t.injectIntoDevTools=function(x){if(x={bundleType:x.bundleType,version:x.version,rendererPackageName:x.rendererPackageName,rendererConfig:x.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:UH,findFiberByHostInstance:x.findFiberByHostInstance||OH,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")x=!1;else{var S=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(S.isDisabled||!S.supportsFiber)x=!0;else{try{Ou=S.inject(x),no=S}catch{}x=!!S.checkDCE}}return x},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(x,S,I,k){if(!J)throw Error(o(363));x=x2(x,S);var W=ge(x,I,k).disconnect;return{disconnect:function(){W()}}},t.registerMutableSourceForHydration=function(x,S){var I=S._getVersion;I=I(S._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[S,I]:x.mutableSourceEagerHydrationData.push(S,I)},t.runWithPriority=function(x,S){var I=ln;try{return ln=x,S()}finally{ln=I}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(x,S,I,k){var W=S.current,re=fs(),Fe=Ac(W);return I=LI(I),S.context===null?S.context=I:S.pendingContext=I,S=yl(re,Fe),S.payload={element:x},k=k===void 0?null:k,k!==null&&(S.callback=k),Sc(W,S),x=Do(W,Fe,re),x!==null&&B1(x,W,Fe),Fe},t};o8.exports=pQ;var mQ=o8.exports;const gQ=gO(mQ),yR={},vQ=i=>void Object.assign(yR,i);function _Q(i,e){function t(u,{args:h=[],attach:d,...f},m){let _=`${u[0].toUpperCase()}${u.slice(1)}`,v;if(u==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const g=f.object;v=Uf(g,{type:u,root:m,attach:d,primitive:!0})}else{const g=yR[_];if(!g)throw new Error(`R3F: ${_} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");v=Uf(new g(...h),{type:u,root:m,attach:d,memoizedProps:{args:h}})}return v.__r3f.attach===void 0&&(v.isBufferGeometry?v.__r3f.attach="geometry":v.isMaterial&&(v.__r3f.attach="material")),_!=="inject"&&jw(v,f),v}function n(u,h){let d=!1;if(h){var f,m;(f=h.__r3f)!=null&&f.attach?Ww(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),d=!0),d||(m=u.__r3f)==null||m.objects.push(h),h.__r3f||Uf(h,{}),h.__r3f.parent=u,DT(h),Of(h)}}function r(u,h,d){let f=!1;if(h){var m,_;if((m=h.__r3f)!=null&&m.attach)Ww(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const v=u.children.filter(b=>b!==h),g=v.indexOf(d);u.children=[...v.slice(0,g),h,...v.slice(g)],f=!0}f||(_=u.__r3f)==null||_.objects.push(h),h.__r3f||Uf(h,{}),h.__r3f.parent=u,DT(h),Of(h)}}function s(u,h,d=!1){u&&[...u].forEach(f=>o(h,f,d))}function o(u,h,d){if(h){var f,m,_;if(h.__r3f&&(h.__r3f.parent=null),(f=u.__r3f)!=null&&f.objects&&(u.__r3f.objects=u.__r3f.objects.filter(y=>y!==h)),(m=h.__r3f)!=null&&m.attach)MN(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var v;u.remove(h),(v=h.__r3f)!=null&&v.root&&AQ(ox(h),h)}const b=(_=h.__r3f)==null?void 0:_.primitive,p=!b&&(d===void 0?h.dispose!==null:d);if(!b){var g;s((g=h.__r3f)==null?void 0:g.objects,h,p),s(h.children,h,p)}if(delete h.__r3f,p&&h.dispose&&h.type!=="Scene"){const y=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?IT.unstable_scheduleCallback(IT.unstable_IdlePriority,y):y()}Of(u)}}function a(u,h,d,f){var m;const _=(m=u.__r3f)==null?void 0:m.parent;if(!_)return;const v=t(h,d,u.__r3f.root);if(u.children){for(const g of u.children)g.__r3f&&n(v,g);u.children=u.children.filter(g=>!g.__r3f)}u.__r3f.objects.forEach(g=>n(v,g)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||o(_,u),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),n(_,v),v.raycast&&v.__r3f.eventCount&&ox(v).getState().internal.interaction.push(v),[f,f.alternate].forEach(g=>{g!==null&&(g.stateNode=v,g.ref&&(typeof g.ref=="function"?g.ref(v):g.ref.current=v))})}const l=()=>{};return{reconciler:gQ({createInstance:t,removeChild:o,appendChild:n,appendInitialChild:n,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const d=u.getState().scene;d.__r3f&&(d.__r3f.root=u,n(d,h))},removeChildFromContainer:(u,h)=>{h&&o(u.getState().scene,h)},insertInContainerBefore:(u,h,d)=>{if(!h||!d)return;const f=u.getState().scene;f.__r3f&&r(f,h,d)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,d,f){var m;if(((m=u==null?void 0:u.__r3f)!=null?m:{}).primitive&&f.object&&f.object!==u)return[!0];{const{args:v=[],children:g,...b}=f,{args:p=[],children:y,...A}=d;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((M,T)=>M!==p[T]))return[!0];const w=m8(u,b,A,!0);return w.changes.length?[!1,w]:null}},commitUpdate(u,[h,d],f,m,_,v){h?a(u,f,_,v):jw(u,d)},commitMount(u,h,d,f){var m;const _=(m=u.__r3f)!=null?m:{};u.raycast&&_.handlers&&_.eventCount&&ox(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>Uf(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:d,parent:f}=(h=u.__r3f)!=null?h:{};d&&f&&MN(f,u,d),u.isObject3D&&(u.visible=!1),Of(u)},unhideInstance(u,h){var d;const{attach:f,parent:m}=(d=u.__r3f)!=null?d:{};f&&m&&Ww(m,u,f),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),Of(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():ip.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&oi.fun(performance.now)?performance.now:oi.fun(Date.now)?Date.now:()=>0,scheduleTimeout:oi.fun(setTimeout)?setTimeout:void 0,cancelTimeout:oi.fun(clearTimeout)?clearTimeout:void 0}),applyProps:jw}}var xN,bN;const $w=i=>"colorSpace"in i||"outputColorSpace"in i,c8=()=>{var i;return(i=yR.ColorManagement)!=null?i:null},u8=i=>i&&i.isOrthographicCamera,yQ=i=>i&&i.hasOwnProperty("current"),x1=typeof window<"u"&&((xN=window.document)!=null&&xN.createElement||((bN=window.navigator)==null?void 0:bN.product)==="ReactNative")?Ge.useLayoutEffect:Ge.useEffect;function h8(i){const e=Ge.useRef(i);return x1(()=>void(e.current=i),[i]),e}function xQ({set:i}){return x1(()=>(i(new Promise(()=>null)),()=>i(!1)),[i]),null}class d8 extends Ge.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}d8.getDerivedStateFromError=()=>({error:!0});const f8="__default",SN=new Map,bQ=i=>i&&!!i.memoized&&!!i.changes;function p8(i){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(i)?Math.min(Math.max(i[0],t),i[1]):i}const eg=i=>{var e;return(e=i.__r3f)==null?void 0:e.root.getState()};function ox(i){let e=i.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const oi={obj:i=>i===Object(i)&&!oi.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",boo:i=>typeof i=="boolean",und:i=>i===void 0,arr:i=>Array.isArray(i),equ(i,e,{arrays:t="shallow",objects:n="reference",strict:r=!0}={}){if(typeof i!=typeof e||!!i!=!!e)return!1;if(oi.str(i)||oi.num(i)||oi.boo(i))return i===e;const s=oi.obj(i);if(s&&n==="reference")return i===e;const o=oi.arr(i);if(o&&t==="reference")return i===e;if((o||s)&&i===e)return!0;let a;for(a in i)if(!(a in e))return!1;if(s&&t==="shallow"&&n==="shallow"){for(a in r?e:i)if(!oi.equ(i[a],e[a],{strict:r,objects:"reference"}))return!1}else for(a in r?e:i)if(i[a]!==e[a])return!1;if(oi.und(a)){if(o&&i.length===0&&e.length===0||s&&Object.keys(i).length===0&&Object.keys(e).length===0)return!0;if(i!==e)return!1}return!0}};function SQ(i){i.dispose&&i.type!=="Scene"&&i.dispose();for(const e in i)e.dispose==null||e.dispose(),delete i[e]}function Uf(i,e){const t=i;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},i}function LT(i,e){let t=i;if(e.includes("-")){const n=e.split("-"),r=n.pop();return t=n.reduce((s,o)=>s[o],i),{target:t,key:r}}else return{target:t,key:e}}const wN=/-\d+$/;function Ww(i,e,t){if(oi.str(t)){if(wN.test(t)){const s=t.replace(wN,""),{target:o,key:a}=LT(i,s);Array.isArray(o[a])||(o[a]=[])}const{target:n,key:r}=LT(i,t);e.__r3f.previousAttach=n[r],n[r]=e}else e.__r3f.previousAttach=t(i,e)}function MN(i,e,t){var n,r;if(oi.str(t)){const{target:s,key:o}=LT(i,t),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(n=e.__r3f)==null||n.previousAttach==null||n.previousAttach(i,e);(r=e.__r3f)==null||delete r.previousAttach}function m8(i,{children:e,key:t,ref:n,...r},{children:s,key:o,ref:a,...l}={},c=!1){const u=i.__r3f,h=Object.entries(r),d=[];if(c){const m=Object.keys(l);for(let _=0;_<m.length;_++)r.hasOwnProperty(m[_])||h.unshift([m[_],f8+"remove"])}h.forEach(([m,_])=>{var v;if((v=i.__r3f)!=null&&v.primitive&&m==="object"||oi.equ(_,l[m]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(m))return d.push([m,_,!0,[]]);let g=[];m.includes("-")&&(g=m.split("-")),d.push([m,_,!1,g]);for(const b in r){const p=r[b];b.startsWith(`${m}-`)&&d.push([b,p,!1,b.split("-")])}});const f={...r};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(f.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(f.attach=u.memoizedProps.attach),{memoized:f,changes:d}}function jw(i,e){var t;const n=i.__r3f,r=n==null?void 0:n.root,s=r==null||r.getState==null?void 0:r.getState(),{memoized:o,changes:a}=bQ(e)?e:m8(i,e),l=n==null?void 0:n.eventCount;i.__r3f&&(i.__r3f.memoizedProps=o);for(let d=0;d<a.length;d++){let[f,m,_,v]=a[d];if($w(i)){const y="srgb",A="srgb-linear";f==="encoding"?(f="colorSpace",m=m===3001?y:A):f==="outputEncoding"&&(f="outputColorSpace",m=m===3001?y:A)}let g=i,b=g[f];if(v.length&&(b=v.reduce((p,y)=>p[y],i),!(b&&b.set))){const[p,...y]=v.reverse();g=y.reverse().reduce((A,w)=>A[w],i),f=p}if(m===f8+"remove")if(g.constructor){let p=SN.get(g.constructor);p||(p=new g.constructor,SN.set(g.constructor,p)),m=p[f]}else m=0;if(_&&n)m?n.handlers[f]=m:delete n.handlers[f],n.eventCount=Object.keys(n.handlers).length;else if(b&&b.set&&(b.copy||b instanceof Vh)){if(Array.isArray(m))b.fromArray?b.fromArray(m):b.set(...m);else if(b.copy&&m&&m.constructor&&b.constructor===m.constructor)b.copy(m);else if(m!==void 0){var c;const p=(c=b)==null?void 0:c.isColor;!p&&b.setScalar?b.setScalar(m):b instanceof Vh&&m instanceof Vh?b.mask=m.mask:b.set(m),!c8()&&s&&!s.linear&&p&&b.convertSRGBToLinear()}}else{var u;if(g[f]=m,(u=g[f])!=null&&u.isTexture&&g[f].format===Ss&&g[f].type===rl&&s){const p=g[f];$w(p)&&$w(s.gl)?p.colorSpace=s.gl.outputColorSpace:p.encoding=s.gl.outputEncoding}}Of(i)}if(n&&n.parent&&i.raycast&&l!==n.eventCount){const d=ox(i).getState().internal,f=d.interaction.indexOf(i);f>-1&&d.interaction.splice(f,1),n.eventCount&&d.interaction.push(i)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(t=i.__r3f)!=null&&t.parent&&DT(i),i}function Of(i){var e,t;const n=(e=i.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function DT(i){i.onUpdate==null||i.onUpdate(i)}function wQ(i,e){i.manual||(u8(i)?(i.left=e.width/-2,i.right=e.width/2,i.top=e.height/2,i.bottom=e.height/-2):i.aspect=e.width/e.height,i.updateProjectionMatrix(),i.updateMatrixWorld())}function D_(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function MQ(){var i;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return ip.DefaultEventPriority;switch((i=e.event)==null?void 0:i.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ip.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ip.ContinuousEventPriority;default:return ip.DefaultEventPriority}}function g8(i,e,t,n){const r=t.get(e);r&&(t.delete(e),t.size===0&&(i.delete(n),r.target.releasePointerCapture(n)))}function AQ(i,e){const{internal:t}=i.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,r)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((n,r)=>{g8(t.capturedMap,e,n,r)})}function EQ(i){function e(l){const{internal:c}=i.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function t(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function n(l,c){const u=i.getState(),h=new Set,d=[],f=c?c(u.internal.interaction):u.internal.interaction;for(let g=0;g<f.length;g++){const b=eg(f[g]);b&&(b.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function m(g){const b=eg(g);if(!b||!b.events.enabled||b.raycaster.camera===null)return[];if(b.raycaster.camera===void 0){var p;b.events.compute==null||b.events.compute(l,b,(p=b.previousRoot)==null?void 0:p.getState()),b.raycaster.camera===void 0&&(b.raycaster.camera=null)}return b.raycaster.camera?b.raycaster.intersectObject(g,!0):[]}let _=f.flatMap(m).sort((g,b)=>{const p=eg(g.object),y=eg(b.object);return!p||!y?g.distance-b.distance:y.events.priority-p.events.priority||g.distance-b.distance}).filter(g=>{const b=D_(g);return h.has(b)?!1:(h.add(b),!0)});u.events.filter&&(_=u.events.filter(_,u));for(const g of _){let b=g.object;for(;b;){var v;(v=b.__r3f)!=null&&v.eventCount&&d.push({...g,eventObject:b}),b=b.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let g of u.internal.capturedMap.get(l.pointerId).values())h.has(D_(g.intersection))||d.push(g.intersection);return d}function r(l,c,u,h){const d=i.getState();if(l.length){const f={stopped:!1};for(const m of l){const _=eg(m.object)||d,{raycaster:v,pointer:g,camera:b,internal:p}=_,y=new Ce(g.x,g.y,0).unproject(b),A=C=>{var N,P;return(N=(P=p.capturedMap.get(C))==null?void 0:P.has(m.eventObject))!=null?N:!1},w=C=>{const N={intersection:m,target:c.target};p.capturedMap.has(C)?p.capturedMap.get(C).set(m.eventObject,N):p.capturedMap.set(C,new Map([[m.eventObject,N]])),c.target.setPointerCapture(C)},M=C=>{const N=p.capturedMap.get(C);N&&g8(p.capturedMap,m.eventObject,N,C)};let T={};for(let C in c){let N=c[C];typeof N!="function"&&(T[C]=N)}let E={...m,...T,pointer:g,intersections:l,stopped:f.stopped,delta:u,unprojectedPoint:y,ray:v.ray,camera:b,stopPropagation(){const C="pointerId"in c&&p.capturedMap.get(c.pointerId);if((!C||C.has(m.eventObject))&&(E.stopped=f.stopped=!0,p.hovered.size&&Array.from(p.hovered.values()).find(N=>N.eventObject===m.eventObject))){const N=l.slice(0,l.indexOf(m));s([...N,m])}},target:{hasPointerCapture:A,setPointerCapture:w,releasePointerCapture:M},currentTarget:{hasPointerCapture:A,setPointerCapture:w,releasePointerCapture:M},nativeEvent:c};if(h(E),f.stopped===!0)break}}return l}function s(l){const{internal:c}=i.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f,f=d==null?void 0:d.handlers;if(c.hovered.delete(D_(u)),d!=null&&d.eventCount){const m={...u,intersections:l};f.onPointerOut==null||f.onPointerOut(m),f.onPointerLeave==null||f.onPointerLeave(m)}}}function o(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function a(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=i.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=i.getState();d.lastEvent.current=u;const f=l==="onPointerMove",m=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",v=n(u,f?t:void 0),g=m?e(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=v.map(p=>p.eventObject)),m&&!v.length&&g<=2&&(o(u,d.interaction),h&&h(u)),f&&s(v);function b(p){const y=p.eventObject,A=y.__r3f,w=A==null?void 0:A.handlers;if(A!=null&&A.eventCount)if(f){if(w.onPointerOver||w.onPointerEnter||w.onPointerOut||w.onPointerLeave){const M=D_(p),T=d.hovered.get(M);T?T.stopped&&p.stopPropagation():(d.hovered.set(M,p),w.onPointerOver==null||w.onPointerOver(p),w.onPointerEnter==null||w.onPointerEnter(p))}w.onPointerMove==null||w.onPointerMove(p)}else{const M=w[l];M?(!m||d.initialHits.includes(y))&&(o(u,d.interaction.filter(T=>!d.initialHits.includes(T))),M(p)):m&&d.initialHits.includes(y)&&o(u,d.interaction.filter(T=>!d.initialHits.includes(T)))}}r(v,u,g,b)}}return{handlePointer:a}}const v8=i=>!!(i!=null&&i.render),_8=Ge.createContext(null),TQ=(i,e)=>{const t=cQ((a,l)=>{const c=new Ce,u=new Ce,h=new Ce;function d(g=l().camera,b=u,p=l().size){const{width:y,height:A,top:w,left:M}=p,T=y/A;b.isVector3?h.copy(b):h.set(...b);const E=g.getWorldPosition(c).distanceTo(h);if(u8(g))return{width:y/g.zoom,height:A/g.zoom,top:w,left:M,factor:1,distance:E,aspect:T};{const C=g.fov*Math.PI/180,N=2*Math.tan(C/2)*E,P=N*(y/A);return{width:P,height:N,top:w,left:M,factor:y/P,distance:E,aspect:T}}}let f;const m=g=>a(b=>({performance:{...b.performance,current:g}})),_=new xt;return{set:a,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(g=1)=>i(l(),g),advance:(g,b)=>e(g,b,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new gR,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const g=l();f&&clearTimeout(f),g.performance.current!==g.performance.min&&m(g.performance.min),f=setTimeout(()=>m(l().performance.max),g.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:g=>a(b=>({...b,events:{...b.events,...g}})),setSize:(g,b,p,y,A)=>{const w=l().camera,M={width:g,height:b,top:y||0,left:A||0,updateStyle:p};a(T=>({size:M,viewport:{...T.viewport,...d(w,u,M)}}))},setDpr:g=>a(b=>{const p=p8(g);return{viewport:{...b.viewport,dpr:p,initialDpr:b.viewport.initialDpr||p}}}),setFrameloop:(g="always")=>{const b=l().clock;b.stop(),b.elapsedTime=0,g!=="never"&&(b.start(),b.elapsedTime=0),a(()=>({frameloop:g}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:Ge.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(g,b,p)=>{const y=l().internal;return y.priority=y.priority+(b>0?1:0),y.subscribers.push({ref:g,priority:b,store:p}),y.subscribers=y.subscribers.sort((A,w)=>A.priority-w.priority),()=>{const A=l().internal;A!=null&&A.subscribers&&(A.priority=A.priority-(b>0?1:0),A.subscribers=A.subscribers.filter(w=>w.ref!==g))}}}}}),n=t.getState();let r=n.size,s=n.viewport.dpr,o=n.camera;return t.subscribe(()=>{const{camera:a,size:l,viewport:c,gl:u,set:h}=t.getState();if(l.width!==r.width||l.height!==r.height||c.dpr!==s){var d;r=l,s=c.dpr,wQ(a,l),u.setPixelRatio(c.dpr);const f=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,f)}a!==o&&(o=a,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>i(a)),t};let N_,CQ=new Set,PQ=new Set,RQ=new Set;function Xw(i,e){if(i.size)for(const{callback:t}of i.values())t(e)}function tg(i,e){switch(i){case"before":return Xw(CQ,e);case"after":return Xw(PQ,e);case"tail":return Xw(RQ,e)}}let qw,Yw;function Kw(i,e,t){let n=e.clock.getDelta();for(e.frameloop==="never"&&typeof i=="number"&&(n=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),qw=e.internal.subscribers,N_=0;N_<qw.length;N_++)Yw=qw[N_],Yw.ref.current(Yw.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function IQ(i){let e=!1,t=!1,n,r,s;function o(c){r=requestAnimationFrame(o),e=!0,n=0,tg("before",c),t=!0;for(const h of i.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(n+=Kw(c,s))}if(t=!1,tg("after",c),n===0)return tg("tail",c),e=!1,cancelAnimationFrame(r)}function a(c,u=1){var h;if(!c)return i.forEach(d=>a(d.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):t?c.internal.frames=2:c.internal.frames=1,e||(e=!0,requestAnimationFrame(o)))}function l(c,u=!0,h,d){if(u&&tg("before",c),h)Kw(c,h,d);else for(const f of i.values())Kw(c,f.store.getState());u&&tg("after",c)}return{loop:o,invalidate:a,advance:l}}function y8(){const i=Ge.useContext(_8);if(!i)throw new Error("R3F: Hooks can only be used within the Canvas component!");return i}function Qi(i=t=>t,e){return y8()(i,e)}function Ia(i,e=0){const t=y8(),n=t.getState().internal.subscribe,r=h8(i);return x1(()=>n(r,e,t),[e,n,t]),null}const Fp=new Map,{invalidate:AN,advance:EN}=IQ(Fp),{reconciler:tb,applyProps:af}=_Q(Fp,MQ),lf={objects:"shallow",strict:!1},LQ=(i,e)=>{const t=typeof i=="function"?i(e):i;return v8(t)?t:new YP({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...i})};function DQ(i,e){const t=typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement;if(e){const{width:n,height:r,top:s,left:o,updateStyle:a=t}=e;return{width:n,height:r,top:s,left:o,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement&&i.parentElement){const{width:n,height:r,top:s,left:o}=i.parentElement.getBoundingClientRect();return{width:n,height:r,top:s,left:o,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function NQ(i){const e=Fp.get(i),t=e==null?void 0:e.fiber,n=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,s=n||TQ(AN,EN),o=t||tb.createContainer(s,ip.ConcurrentRoot,null,!1,null,"",r,null);e||Fp.set(i,{fiber:o,store:s});let a,l=!1,c;return{configure(u={}){let{gl:h,size:d,scene:f,events:m,onCreated:_,shadows:v=!1,linear:g=!1,flat:b=!1,legacy:p=!1,orthographic:y=!1,frameloop:A="always",dpr:w=[1,2],performance:M,raycaster:T,camera:E,onPointerMissed:C}=u,N=s.getState(),P=N.gl;N.gl||N.set({gl:P=LQ(h,i)});let L=N.raycaster;L||N.set({raycaster:L=new i8});const{params:R,...F}=T||{};if(oi.equ(F,L,lf)||af(L,{...F}),oi.equ(R,L.params,lf)||af(L,{params:{...L.params,...R}}),!N.camera||N.camera===c&&!oi.equ(c,E,lf)){c=E;const B=E instanceof p1,D=B?E:y?new vd(0,0,0,0,.1,1e3):new Ji(75,0,.1,1e3);B||(D.position.z=5,E&&(af(D,E),("aspect"in E||"left"in E||"right"in E||"bottom"in E||"top"in E)&&(D.manual=!0,D.updateProjectionMatrix())),!N.camera&&!(E!=null&&E.rotation)&&D.lookAt(0,0,0)),N.set({camera:D}),L.camera=D}if(!N.scene){let B;f!=null&&f.isScene?B=f:(B=new KP,f&&af(B,f)),N.set({scene:Uf(B)})}if(!N.xr){var V;const B=(j,q)=>{const Y=s.getState();Y.frameloop!=="never"&&EN(j,!0,Y,q)},D=()=>{const j=s.getState();j.gl.xr.enabled=j.gl.xr.isPresenting,j.gl.xr.setAnimationLoop(j.gl.xr.isPresenting?B:null),j.gl.xr.isPresenting||AN(j)},O={connect(){const j=s.getState().gl;j.xr.addEventListener("sessionstart",D),j.xr.addEventListener("sessionend",D)},disconnect(){const j=s.getState().gl;j.xr.removeEventListener("sessionstart",D),j.xr.removeEventListener("sessionend",D)}};typeof((V=P.xr)==null?void 0:V.addEventListener)=="function"&&O.connect(),N.set({xr:O})}if(P.shadowMap){const B=P.shadowMap.enabled,D=P.shadowMap.type;if(P.shadowMap.enabled=!!v,oi.boo(v))P.shadowMap.type=jg;else if(oi.str(v)){var z;const O={basic:LB,percentage:jb,soft:jg,variance:ma};P.shadowMap.type=(z=O[v])!=null?z:jg}else oi.obj(v)&&Object.assign(P.shadowMap,v);(B!==P.shadowMap.enabled||D!==P.shadowMap.type)&&(P.shadowMap.needsUpdate=!0)}const U=c8();U&&("enabled"in U?U.enabled=!p:"legacyMode"in U&&(U.legacyMode=p)),l||af(P,{outputEncoding:g?3e3:3001,toneMapping:b?il:CP}),N.legacy!==p&&N.set(()=>({legacy:p})),N.linear!==g&&N.set(()=>({linear:g})),N.flat!==b&&N.set(()=>({flat:b})),h&&!oi.fun(h)&&!v8(h)&&!oi.equ(h,P,lf)&&af(P,h),m&&!N.events.handlers&&N.set({events:m(s)});const G=DQ(i,d);return oi.equ(G,N.size,lf)||N.setSize(G.width,G.height,G.updateStyle,G.top,G.left),w&&N.viewport.dpr!==p8(w)&&N.setDpr(w),N.frameloop!==A&&N.setFrameloop(A),N.onPointerMissed||N.set({onPointerMissed:C}),M&&!oi.equ(M,N.performance,lf)&&N.set(B=>({performance:{...B.performance,...M}})),a=_,l=!0,this},render(u){return l||this.configure(),tb.updateContainer(we.jsx(FQ,{store:s,children:u,onCreated:a,rootElement:i}),o,null,()=>{}),s},unmount(){x8(i)}}}function FQ({store:i,children:e,onCreated:t,rootElement:n}){return x1(()=>{const r=i.getState();r.set(s=>({internal:{...s.internal,active:!0}})),t&&t(r),i.getState().events.connected||r.events.connect==null||r.events.connect(n)},[]),we.jsx(_8.Provider,{value:i,children:e})}function x8(i,e){const t=Fp.get(i),n=t==null?void 0:t.fiber;if(n){const r=t==null?void 0:t.store.getState();r&&(r.internal.active=!1),tb.updateContainer(null,n,null,()=>{r&&setTimeout(()=>{try{var s,o,a,l;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=r.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(l=r.gl)!=null&&l.xr&&r.xr.disconnect(),SQ(r),Fp.delete(i)}catch{}},500)})}}tb.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:Ge.version});const Zw={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function kQ(i){const{handlePointer:e}=EQ(i);return{priority:1,enabled:!0,compute(t,n,r){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(Zw).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:r}=i.getState();(t=r.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:s}=i.getState();s.disconnect==null||s.disconnect(),r(o=>({events:{...o.events,connected:t}})),Object.entries((n=s.handlers)!=null?n:[]).forEach(([o,a])=>{const[l,c]=Zw[o];t.addEventListener(l,a,{passive:c})})},disconnect:()=>{const{set:t,events:n}=i.getState();if(n.connected){var r;Object.entries((r=n.handlers)!=null?r:[]).forEach(([s,o])=>{if(n&&n.connected instanceof HTMLElement){const[a]=Zw[s];n.connected.removeEventListener(a,o)}}),t(s=>({events:{...s.events,connected:void 0}}))}}}}function TN(i,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>i(...n),e)}}function UQ({debounce:i,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const r=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=Ge.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=Ge.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=i?typeof i=="number"?i:i.scroll:null,c=i?typeof i=="number"?i:i.resize:null,u=Ge.useRef(!1);Ge.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,f]=Ge.useMemo(()=>{const g=()=>{if(!a.current.element)return;const{left:b,top:p,width:y,height:A,bottom:w,right:M,x:T,y:E}=a.current.element.getBoundingClientRect(),C={left:b,top:p,width:y,height:A,bottom:w,right:M,x:T,y:E};a.current.element instanceof HTMLElement&&n&&(C.height=a.current.element.offsetHeight,C.width=a.current.element.offsetWidth),Object.freeze(C),u.current&&!GQ(a.current.lastBounds,C)&&o(a.current.lastBounds=C)};return[g,c?TN(g,c):g,l?TN(g,l):g]},[o,n,l,c]);function m(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(g=>g.removeEventListener("scroll",f,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function _(){a.current.element&&(a.current.resizeObserver=new r(f),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(g=>g.addEventListener("scroll",f,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const v=g=>{!g||g===a.current.element||(m(),a.current.element=g,a.current.scrollContainers=b8(g),_())};return BQ(f,!!e),OQ(d),Ge.useEffect(()=>{m(),_()},[e,f,d]),Ge.useEffect(()=>m,[]),[v,s,h]}function OQ(i){Ge.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function BQ(i,e){Ge.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function b8(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:r}=window.getComputedStyle(i);return[t,n,r].some(s=>s==="auto"||s==="scroll")&&e.push(i),[...e,...b8(i.parentElement)]}const zQ=["x","y","top","bottom","left","right","width","height"],GQ=(i,e)=>zQ.every(t=>i[t]===e[t]);var VQ=Object.defineProperty,HQ=Object.defineProperties,$Q=Object.getOwnPropertyDescriptors,CN=Object.getOwnPropertySymbols,WQ=Object.prototype.hasOwnProperty,jQ=Object.prototype.propertyIsEnumerable,PN=(i,e,t)=>e in i?VQ(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,RN=(i,e)=>{for(var t in e||(e={}))WQ.call(e,t)&&PN(i,t,e[t]);if(CN)for(var t of CN(e))jQ.call(e,t)&&PN(i,t,e[t]);return i},XQ=(i,e)=>HQ(i,$Q(e)),IN,LN;typeof window<"u"&&((IN=window.document)!=null&&IN.createElement||((LN=window.navigator)==null?void 0:LN.product)==="ReactNative")?Ge.useLayoutEffect:Ge.useEffect;function S8(i,e,t){if(!i)return;if(t(i)===!0)return i;let n=i.child;for(;n;){const r=S8(n,e,t);if(r)return r;n=n.sibling}}function w8(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const DN=console.error;console.error=function(){const i=[...arguments].join("");if(i!=null&&i.startsWith("Warning:")&&i.includes("useContext")){console.error=DN;return}return DN.apply(this,arguments)};const xR=w8(Ge.createContext(null));class M8 extends Ge.Component{render(){return Ge.createElement(xR.Provider,{value:this._reactInternals},this.props.children)}}function qQ(){const i=Ge.useContext(xR);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Ge.useId();return Ge.useMemo(()=>{for(const n of[i,i==null?void 0:i.alternate]){if(!n)continue;const r=S8(n,!1,s=>{let o=s.memoizedState;for(;o;){if(o.memoizedState===e)return!0;o=o.next}});if(r)return r}},[i,e])}function YQ(){const i=qQ(),[e]=Ge.useState(()=>new Map);e.clear();let t=i;for(;t;){if(t.type&&typeof t.type=="object"){const r=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;r&&r!==xR&&!e.has(r)&&e.set(r,Ge.useContext(w8(r)))}t=t.return}return e}function KQ(){const i=YQ();return Ge.useMemo(()=>Array.from(i.keys()).reduce((e,t)=>n=>Ge.createElement(e,null,Ge.createElement(t.Provider,XQ(RN({},n),{value:i.get(t)}))),e=>Ge.createElement(M8,RN({},e))),[i])}const ZQ=Ge.forwardRef(function({children:e,fallback:t,resize:n,style:r,gl:s,events:o=kQ,eventSource:a,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:m,dpr:_,performance:v,raycaster:g,camera:b,scene:p,onPointerMissed:y,onCreated:A,...w},M){Ge.useMemo(()=>vQ(oQ),[]);const T=KQ(),[E,C]=UQ({scroll:!0,debounce:{scroll:50,resize:0},...n}),N=Ge.useRef(null),P=Ge.useRef(null);Ge.useImperativeHandle(M,()=>N.current);const L=h8(y),[R,F]=Ge.useState(!1),[V,z]=Ge.useState(!1);if(R)throw R;if(V)throw V;const U=Ge.useRef(null);x1(()=>{const B=N.current;C.width>0&&C.height>0&&B&&(U.current||(U.current=NQ(B)),U.current.configure({gl:s,events:o,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:m,dpr:_,performance:v,raycaster:g,camera:b,scene:p,size:C,onPointerMissed:(...D)=>L.current==null?void 0:L.current(...D),onCreated:D=>{D.events.connect==null||D.events.connect(a?yQ(a)?a.current:a:P.current),l&&D.setEvents({compute:(O,j)=>{const q=O[l+"X"],Y=O[l+"Y"];j.pointer.set(q/j.size.width*2-1,-(Y/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),A==null||A(D)}}),U.current.render(we.jsx(T,{children:we.jsx(d8,{set:z,children:we.jsx(Ge.Suspense,{fallback:we.jsx(xQ,{set:F}),children:e??null})})})))}),Ge.useEffect(()=>{const B=N.current;if(B)return()=>x8(B)},[]);const G=a?"none":"auto";return we.jsx("div",{ref:P,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:G,...r},...w,children:we.jsx("div",{ref:E,style:{width:"100%",height:"100%"},children:we.jsx("canvas",{ref:N,style:{display:"block"},children:t})})})}),A8=Ge.forwardRef(function(e,t){return we.jsx(M8,{children:we.jsx(ZQ,{...e,ref:t})})});function QQ(i){let e;const t=new Set,n=(c,u)=>{const h=typeof c=="function"?c(e):c;if(h!==e){const d=e;e=u?h:Object.assign({},e,h),t.forEach(f=>f(e,d))}},r=()=>e,s=(c,u=r,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(e);function f(){const m=u(e);if(!h(d,m)){const _=d;c(d=m,_)}}return t.add(f),()=>t.delete(f)},l={setState:n,getState:r,subscribe:(c,u,h)=>u||h?s(c,u,h):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=i(n,r,l),l}const JQ=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),NN=JQ?Ge.useEffect:Ge.useLayoutEffect;function E8(i){const e=typeof i=="function"?QQ(i):i,t=(n=e.getState,r=Object.is)=>{const[,s]=Ge.useReducer(v=>v+1,0),o=e.getState(),a=Ge.useRef(o),l=Ge.useRef(n),c=Ge.useRef(r),u=Ge.useRef(!1),h=Ge.useRef();h.current===void 0&&(h.current=n(o));let d,f=!1;(a.current!==o||l.current!==n||c.current!==r||u.current)&&(d=n(o),f=!r(h.current,d)),NN(()=>{f&&(h.current=d),a.current=o,l.current=n,c.current=r,u.current=!1});const m=Ge.useRef(o);NN(()=>{const v=()=>{try{const b=e.getState(),p=l.current(b);c.current(h.current,p)||(a.current=b,h.current=p,s())}catch{u.current=!0,s()}},g=e.subscribe(v);return e.getState()!==m.current&&v(),g},[]);const _=f?d:h.current;return Ge.useDebugValue(_),_};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const r=n.length<=0;return{value:n.shift(),done:r}}}},t}class eJ extends Kl{constructor(e,t){super(),this.inputSource=null,this.xrControllerModel=null,this.index=e,this.controller=t.xr.getController(e),this.grip=t.xr.getControllerGrip(e),this.hand=t.xr.getHand(e),this.grip.userData.name="grip",this.controller.userData.name="controller",this.hand.userData.name="hand",this.visible=!1,this.add(this.controller,this.grip,this.hand),this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.controller.addEventListener("connected",this._onConnected),this.controller.addEventListener("disconnected",this._onDisconnected)}_onConnected(e){e.fake||e.data&&(this.visible=!0,this.inputSource=e.data,this.dispatchEvent(e))}_onDisconnected(e){e.fake||(this.visible=!1,this.inputSource=null,this.dispatchEvent(e))}dispose(){this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}var FN,kN;const tJ=i=>Array.from(new Set(i)),xa=typeof window<"u"&&((FN=window.document)!=null&&FN.createElement||((kN=window.navigator)==null?void 0:kN.product)==="ReactNative")?Ge.useLayoutEffect:Ge.useEffect;function Uh(i){const e=Ge.useRef(i);return xa(()=>void(e.current=i),[i]),e}function cf(i,e,{handedness:t}={}){const n=Uh(e),r=is(s=>s.controllers);xa(()=>{const s=r.map(o=>{if(t&&o.inputSource&&o.inputSource.handedness!==t)return;const a=l=>n.current({nativeEvent:l,target:o});return o.controller.addEventListener(i,a),()=>o.controller.removeEventListener(i,a)});return()=>s.forEach(o=>o==null?void 0:o())},[r,t,i])}const UN=new nn;function nJ({children:i}){const e=Qi(h=>h.events),t=Qi(h=>h.get),n=Qi(h=>h.raycaster),r=is(h=>h.controllers),s=is(h=>h.interactions),o=is(h=>h.hoverState),a=is(h=>h.hasInteraction),l=is(h=>h.getInteraction),c=Ge.useCallback(h=>{const d=Array.from(s.keys());return UN.identity().extractRotation(h.matrixWorld),n.ray.origin.setFromMatrixPosition(h.matrixWorld),n.ray.direction.set(0,0,-1).applyMatrix4(UN),n.intersectObjects(d,!0)},[s,n]);Ia(()=>{var h;if(s.size!==0)for(const d of r){if(!((h=d.inputSource)!=null&&h.handedness))return;const f=o[d.inputSource.handedness],m=new Set;let _=c(d.controller);if(e.filter)_=e.filter(_,t());else{const v=_.find(g=>g==null?void 0:g.object);v&&(_=[v])}for(const v of _){let g=v.object;for(;g;){if(a(g,"onHover")&&!f.has(g)){const p=l(g,"onHover");for(const y of p)y({target:d,intersection:v,intersections:_})}const b=l(g,"onMove");b==null||b.forEach(p=>p({target:d,intersection:v,intersections:_})),f.set(g,v),m.add(g.id),g=g.parent}}for(const v of f.keys())if(!m.has(v.id)){f.delete(v);const g=l(v,"onBlur");if(!g)continue;for(const b of g)b({target:d,intersections:_})}}});const u=Ge.useCallback(h=>d=>{var f;if(!((f=d.target.inputSource)!=null&&f.handedness))return;const m=o[d.target.inputSource.handedness],_=Array.from(new Set(m.values()));s.forEach((v,g)=>{var b,p,y;if(m.has(g)){if(!v[h])return;for(const A of v[h])(b=A.current)==null||b.call(A,{target:d.target,intersection:m.get(g),intersections:_})}else if(h==="onSelect"&&v.onSelectMissed)for(const A of v.onSelectMissed)(p=A.current)==null||p.call(A,{target:d.target,intersections:_});else if(h==="onSqueeze"&&v.onSqueezeMissed)for(const A of v.onSqueezeMissed)(y=A.current)==null||y.call(A,{target:d.target,intersections:_})})},[o,s]);return cf("select",u("onSelect")),cf("selectstart",u("onSelectStart")),cf("selectend",u("onSelectEnd")),cf("squeeze",u("onSqueeze")),cf("squeezeend",u("onSqueezeEnd")),cf("squeezestart",u("onSqueezeStart")),Ge.createElement(Ge.Fragment,null,i)}function oa(i,e,t){const n=is(o=>o.addInteraction),r=is(o=>o.removeInteraction),s=Uh(t);xa(()=>{const o=i.current;if(!(!o||!s.current))return n(o,e,s),()=>r(o,e,s)},[i,e,n,r])}const iJ=Ge.forwardRef(function({onHover:e,onBlur:t,onSelectStart:n,onSelectEnd:r,onSelectMissed:s,onSelect:o,onSqueezeStart:a,onSqueezeEnd:l,onSqueezeMissed:c,onSqueeze:u,onMove:h,children:d},f){const m=Ge.useRef(null);return Ge.useImperativeHandle(f,()=>m.current),oa(m,"onHover",e),oa(m,"onBlur",t),oa(m,"onSelectStart",n),oa(m,"onSelectEnd",r),oa(m,"onSelectMissed",s),oa(m,"onSelect",o),oa(m,"onSqueezeStart",a),oa(m,"onSqueezeEnd",l),oa(m,"onSqueezeMissed",c),oa(m,"onSqueeze",u),oa(m,"onMove",h),Ge.createElement("group",{ref:m},d)});Ge.forwardRef(function({onSelectStart:e,onSelectEnd:t,children:n,...r},s){const o=Ge.useRef(),a=Ge.useRef(null),l=Ge.useMemo(()=>new nn,[]);return Ge.useImperativeHandle(s,()=>a.current),Ia(()=>{const c=o.current,u=a.current;c&&(u.applyMatrix4(l),u.applyMatrix4(c.matrixWorld),u.updateMatrixWorld(),l.copy(c.matrixWorld).invert())}),Ge.createElement(iJ,{ref:a,onSelectStart:c=>{o.current=c.target.controller,l.copy(c.target.controller.matrixWorld).invert(),e==null||e(c)},onSelectEnd:c=>{c.target.controller===o.current&&(o.current=void 0),t==null||t(c)},...r},n)});const T8=Ge.createContext(null),Wh=E8((i,e)=>({set:i,get:e,session:null,referenceSpaceType:null}));function rJ({foveation:i=0,frameRate:e=void 0,referenceSpace:t="local-floor",onSessionStart:n,onSessionEnd:r,onVisibilityChange:s,onInputSourcesChange:o,children:a}){const l=Qi(p=>p.gl),c=Qi(p=>p.camera),u=is(p=>p.player),h=is(p=>p.get),d=is(p=>p.set),f=is(p=>p.session),m=is(p=>p.controllers),_=Uh(n),v=Uh(r),g=Uh(s),b=Uh(o);return xa(()=>{const p=[0,1].map(y=>{const A=new eJ(y,l),w=()=>d(T=>({controllers:[...T.controllers,A]})),M=()=>d(T=>({controllers:T.controllers.filter(E=>E!==A)}));return A.addEventListener("connected",w),A.addEventListener("disconnected",M),()=>{A.removeEventListener("connected",w),A.removeEventListener("disconnected",M)}});return()=>p.forEach(y=>y())},[l,d]),xa(()=>Wh.subscribe(({session:p})=>d(()=>({session:p}))),[l.xr,d]),xa(()=>{l.xr.setFoveation(i),d(()=>({foveation:i}))},[l.xr,i,d]),xa(()=>{var p;try{e&&((p=f==null?void 0:f.updateTargetFrameRate)==null||p.call(f,e))}catch{}d(()=>({frameRate:e}))},[f,e,d]),xa(()=>{const p=Wh.getState();l.xr.setReferenceSpaceType(t),d(()=>({referenceSpace:t})),p.set({referenceSpaceType:t})},[l.xr,t,d]),xa(()=>{if(!f)return void l.xr.setSession(null);const p=M=>{var T;d(()=>({isPresenting:!0})),(T=_.current)==null||T.call(_,{nativeEvent:{...M,target:f},target:f})},y=M=>{var T;d(()=>({isPresenting:!1,session:null})),Wh.setState(()=>({session:null})),(T=v.current)==null||T.call(v,{nativeEvent:{...M,target:f},target:f})},A=M=>{var T;(T=g.current)==null||T.call(g,{nativeEvent:M,target:f})},w=M=>{var T;const E=Object.values(f.inputSources).some(C=>C.hand);d(()=>({isHandTracking:E})),(T=b.current)==null||T.call(b,{nativeEvent:M,target:f})};return l.xr.addEventListener("sessionstart",p),l.xr.addEventListener("sessionend",y),f.addEventListener("visibilitychange",A),f.addEventListener("inputsourceschange",w),l.xr.setSession(f).then(()=>{l.xr.setFoveation(h().foveation)}),()=>{l.xr.removeEventListener("sessionstart",p),l.xr.removeEventListener("sessionend",y),f.removeEventListener("visibilitychange",A),f.removeEventListener("inputsourceschange",w)}},[f,l.xr,d,h]),Ge.createElement(nJ,null,Ge.createElement("primitive",{object:u},Ge.createElement("primitive",{object:c}),m.map(p=>Ge.createElement("primitive",{key:p.index,object:p}))),a)}function C8(i){const e=Ge.useMemo(()=>E8((t,n)=>({set:t,get:n,controllers:[],isPresenting:!1,isHandTracking:!1,player:new Kl,session:null,foveation:0,referenceSpace:"local-floor",hoverState:{left:new Map,right:new Map,none:new Map},interactions:new Map,hasInteraction(r,s){var o;return!!((o=n().interactions.get(r))!=null&&o[s].some(a=>a.current))},getInteraction(r,s){var o;return(o=n().interactions.get(r))==null?void 0:o[s].reduce((a,l)=>(l.current&&a.push(l.current),a),[])},addInteraction(r,s,o){const a=n().interactions;a.has(r)||a.set(r,{onHover:[],onBlur:[],onSelect:[],onSelectEnd:[],onSelectStart:[],onSelectMissed:[],onSqueeze:[],onSqueezeEnd:[],onSqueezeStart:[],onSqueezeMissed:[],onMove:[]}),a.get(r)[s].push(o)},removeInteraction(r,s,o){const a=n().interactions.get(r);if(a){const l=a[s].indexOf(o);l!==-1&&a[s].splice(l,1)}}})),[]);return Ge.createElement(T8.Provider,{value:e},Ge.createElement(rJ,{...i}))}const sJ=(i,e)=>{var t;if(!(!i&&!e))return i&&!e?{optionalFeatures:[i]}:i&&e?{...e,optionalFeatures:tJ([...(t=e.optionalFeatures)!=null?t:[],i])}:e},oJ=async(i,e)=>{const t=Wh.getState();if(t.session){console.warn("@react-three/xr: session already started, please stop it first");return}const n=sJ(t.referenceSpaceType,e),r=await navigator.xr.requestSession(i,n);return t.set(()=>({session:r})),r},aJ=async()=>{const i=Wh.getState();if(!i.session){console.warn("@react-three/xr: no session to stop, please start it first");return}await i.session.end(),i.set({session:null})},lJ=async(i,{sessionInit:e,enterOnly:t,exitOnly:n}={})=>{const r=Wh.getState();if(!(r.session&&t)&&!(!r.session&&n))return r.session?await aJ():await oJ(i,e)},cJ=(i,e,t)=>{switch(i){case"entered":return`Exit ${e}`;case"exited":return`Enter ${e}`;case"unsupported":default:switch(t){case"https":return"HTTPS needed";case"security":return`${e} blocked`;case"unknown":default:return`${e} unsupported`}}},P8=Ge.forwardRef(function({mode:e,sessionInit:t,enterOnly:n=!1,exitOnly:r=!1,onClick:s,onError:o,children:a,...l},c){var u;const[h,d]=Ge.useState("exited"),[f,m]=Ge.useState("unknown"),_=cJ(h,e,f),v=e==="inline"?e:`immersive-${e.toLowerCase()}`,g=Uh(o);xa(()=>{if(!(navigator!=null&&navigator.xr))return void d("unsupported");navigator.xr.isSessionSupported(v).then(p=>{if(p)d("exited");else{const y=location.protocol==="https:";d("unsupported"),m(y?"unknown":"https")}}).catch(p=>{d("unsupported"),"name"in p&&p.name==="SecurityError"?m("security"):m("unknown")})},[v]),xa(()=>Wh.subscribe(p=>{p.session?d("entered"):h!=="unsupported"&&d("exited")}),[h]);const b=Ge.useCallback(async p=>{s==null||s(p);try{lJ(v,{sessionInit:t,enterOnly:n,exitOnly:r})}catch(y){const A=g.current;if(A&&y instanceof Error)A(y);else throw y}},[s,v,t,n,r,g]);return Ge.createElement("button",{...l,ref:c,onClick:h==="unsupported"?s:b},(u=typeof a=="function"?a(h):a)!=null?u:_)}),R8={position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",border:"1px solid white",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",zIndex:99999,cursor:"pointer"};Ge.forwardRef(({style:i=R8,sessionInit:e={domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]},children:t,...n},r)=>Ge.createElement(P8,{...n,ref:r,mode:"AR",style:i,sessionInit:e},t));const I8=Ge.forwardRef(({style:i=R8,sessionInit:e={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]},children:t,...n},r)=>Ge.createElement(P8,{...n,ref:r,mode:"VR",style:i,sessionInit:e},t));function is(i=t=>t,e){const t=Ge.useContext(T8);if(!t)throw new Error("useXR must be used within an <XR /> component!");return t(i,e)}function ON(i){const e=is(n=>n.controllers);return Ge.useMemo(()=>e.find(({inputSource:n})=>(n==null?void 0:n.handedness)&&n.handedness===i),[i,e])}var uJ=Object.defineProperty,hJ=(i,e,t)=>e in i?uJ(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,dJ=(i,e,t)=>(hJ(i,e+"",t),t);let fJ=class{constructor(){dJ(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};var pJ=Object.defineProperty,mJ=(i,e,t)=>e in i?pJ(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,sr=(i,e,t)=>(mJ(i,typeof e!="symbol"?e+"":e,t),t);const uf=new d1(0,0,0,"YXZ"),hf=new Ce,gJ={type:"change"},vJ={type:"lock"},_J={type:"unlock"},BN=.002,zN=Math.PI/2;let yJ=class extends fJ{constructor(e,t){super(),sr(this,"camera"),sr(this,"domElement"),sr(this,"isLocked"),sr(this,"minPolarAngle"),sr(this,"maxPolarAngle"),sr(this,"pointerSpeed"),sr(this,"onMouseMove",n=>{!this.domElement||this.isLocked===!1||(uf.setFromQuaternion(this.camera.quaternion),uf.y-=n.movementX*BN*this.pointerSpeed,uf.x-=n.movementY*BN*this.pointerSpeed,uf.x=Math.max(zN-this.maxPolarAngle,Math.min(zN-this.minPolarAngle,uf.x)),this.camera.quaternion.setFromEuler(uf),this.dispatchEvent(gJ))}),sr(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(vJ),this.isLocked=!0):(this.dispatchEvent(_J),this.isLocked=!1))}),sr(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),sr(this,"connect",n=>{this.domElement=n||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),sr(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),sr(this,"dispose",()=>{this.disconnect()}),sr(this,"getObject",()=>this.camera),sr(this,"direction",new Ce(0,0,-1)),sr(this,"getDirection",n=>n.copy(this.direction).applyQuaternion(this.camera.quaternion)),sr(this,"moveForward",n=>{hf.setFromMatrixColumn(this.camera.matrix,0),hf.crossVectors(this.camera.up,hf),this.camera.position.addScaledVector(hf,n)}),sr(this,"moveRight",n=>{hf.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(hf,n)}),sr(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),sr(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}};const xJ=i=>we.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[we.jsx("path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v0A2.5 2.5 0 0 1 9.5 7v0A2.5 2.5 0 0 1 7 4.5v0A2.5 2.5 0 0 1 9.5 2"}),we.jsx("path",{d:"M14.5 2A2.5 2.5 0 0 1 17 4.5v0A2.5 2.5 0 0 1 14.5 7v0A2.5 2.5 0 0 1 12 4.5v0A2.5 2.5 0 0 1 14.5 2"}),we.jsx("path",{d:"M12 12a2.5 2.5 0 0 0-2.5 2.5v0A2.5 2.5 0 0 0 12 17v0a2.5 2.5 0 0 0 2.5-2.5v0A2.5 2.5 0 0 0 12 12"}),we.jsx("path",{d:"M4.5 10A2.5 2.5 0 0 1 7 12.5v0A2.5 2.5 0 0 1 4.5 15v0A2.5 2.5 0 0 1 2 12.5v0A2.5 2.5 0 0 1 4.5 10"}),we.jsx("path",{d:"M19.5 10A2.5 2.5 0 0 1 22 12.5v0A2.5 2.5 0 0 1 19.5 15v0A2.5 2.5 0 0 1 17 12.5v0A2.5 2.5 0 0 1 19.5 10"}),we.jsx("path",{d:"M12 7v5"}),we.jsx("path",{d:"M7 7.5v7"}),we.jsx("path",{d:"M17 7.5v7"}),we.jsx("path",{d:"M7 4.5C5.5 6 4 7 4 8.5"}),we.jsx("path",{d:"M17 4.5c1.5 1.5 3 2.5 3 4"}),we.jsx("path",{d:"M2 12.5c0 1.5 1 3 2.5 4"}),we.jsx("path",{d:"M22 12.5c0 1.5-1 3-2.5 4"}),we.jsx("path",{d:"M12 17c-1.5 1.5-2.5 2.5-2.5 4"}),we.jsx("path",{d:"M12 17c1.5 1.5 2.5 2.5 2.5 4"})]}),bJ=i=>we.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[we.jsx("rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1"}),we.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"})]}),SJ=i=>we.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[we.jsx("circle",{cx:"12",cy:"12",r:"10"}),we.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),we.jsx("path",{d:"M12 17h.01"})]}),wJ=i=>we.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[we.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2.73l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2.73l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),we.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),MJ=i=>we.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[we.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),we.jsx("circle",{cx:"9",cy:"7",r:"4"}),we.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),we.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),AJ=i=>we.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...i,children:[we.jsx("circle",{cx:"11",cy:"11",r:"8"}),we.jsx("path",{d:"m21 21-4.3-4.3"})]}),bh=[{id:"visualise",title:"Visualise",menuLabel:"Visualise",Icon:xJ},{id:"host-join",title:"Host/Join Session",menuLabel:"Host/Join",Icon:MJ},{id:"assessments",title:"Assessments",menuLabel:"Assessments",Icon:bJ},{id:"settings",title:"Settings",menuLabel:"Settings",Icon:wJ},{id:"help",title:"Help",menuLabel:"Help",Icon:SJ}],Qw=5,EJ=1.6,Rr=30,aa=10,Yi=4;function TJ(){Ge.useRef(null);const{floorTiles:i,ceilingTiles:e}=Ge.useMemo(()=>{const t=[],n=[],r=new H0({color:"#ffffff",roughness:.7,metalness:.1}),s=new H0({color:"#f0f0f0",roughness:.9,metalness:0});for(let o=-Rr/2;o<Rr/2;o+=Yi)for(let a=-Rr/2;a<Rr/2;a+=Yi)t.push(we.jsxs("mesh",{position:[o+Yi/2,-.01,a+Yi/2],rotation:[-Math.PI/2,0,0],children:[we.jsx("planeGeometry",{args:[Yi-.05,Yi-.05]}),we.jsx("primitive",{object:r,attach:"material"})]},`floor-${o}-${a}`)),t.push(we.jsxs("mesh",{position:[o+Yi/2,-.02,a+Yi/2],rotation:[-Math.PI/2,0,0],children:[we.jsx("planeGeometry",{args:[Yi,Yi]}),we.jsx("primitive",{object:s,attach:"material"})]},`floor-border-${o}-${a}`));for(let o=-Rr/2;o<Rr/2;o+=Yi)for(let a=-Rr/2;a<Rr/2;a+=Yi)n.push(we.jsxs("mesh",{position:[o+Yi/2,aa+.01,a+Yi/2],rotation:[Math.PI/2,0,0],children:[we.jsx("planeGeometry",{args:[Yi-.05,Yi-.05]}),we.jsx("primitive",{object:r,attach:"material"})]},`ceiling-${o}-${a}`)),n.push(we.jsxs("mesh",{position:[o+Yi/2,aa+.02,a+Yi/2],rotation:[Math.PI/2,0,0],children:[we.jsx("planeGeometry",{args:[Yi,Yi]}),we.jsx("primitive",{object:s,attach:"material"})]},`ceiling-border-${o}-${a}`));return{floorTiles:t,ceilingTiles:n}},[]);return we.jsxs("group",{children:[i,e,we.jsxs("mesh",{position:[0,aa/2,-Rr/2],children:[we.jsx("boxGeometry",{args:[Rr,aa,.2]}),we.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.6})]}),we.jsxs("mesh",{position:[0,aa/2,Rr/2],children:[we.jsx("boxGeometry",{args:[Rr,aa,.2]}),we.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.6})]}),we.jsxs("mesh",{position:[-Rr/2,aa/2,0],rotation:[0,Math.PI/2,0],children:[we.jsx("boxGeometry",{args:[Rr,aa,.2]}),we.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.6})]}),we.jsxs("mesh",{position:[Rr/2,aa/2,0],rotation:[0,Math.PI/2,0],children:[we.jsx("boxGeometry",{args:[Rr,aa,.2]}),we.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.6})]}),we.jsx("ambientLight",{intensity:.7,color:"#ffffff"}),[...Array(9)].map((t,n)=>{const r=n%3*10-10,s=Math.floor(n/3)*10-10;return we.jsx("pointLight",{position:[r,aa-.3,s],intensity:400,distance:12,decay:1.8,color:"#ffffff",castShadow:!1},`ceiling-light-${n}`)}),[...Array(4)].map((t,n)=>{const r=n%2===0?-10:10,s=n<2?-10:10;return we.jsx("pointLight",{position:[r,1,s],intensity:200,distance:15,decay:2,color:"#fffaf0",castShadow:!1},`floor-light-${n}`)})]})}const CJ=()=>we.jsxs(we.Fragment,{children:[we.jsx("ambientLight",{intensity:.3}),we.jsx(TJ,{})]});function kp(){return kp=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},kp.apply(null,arguments)}function PJ(){var i=Object.create(null);function e(r,s){var o=r.id,a=r.name,l=r.dependencies;l===void 0&&(l=[]);var c=r.init;c===void 0&&(c=function(){});var u=r.getTransferables;if(u===void 0&&(u=null),!i[o])try{l=l.map(function(d){return d&&d.isWorkerModule&&(e(d,function(f){if(f instanceof Error)throw f}),d=i[d.id].value),d}),c=n("<"+a+">.init",c),u&&(u=n("<"+a+">.getTransferables",u));var h=null;typeof c=="function"?h=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),i[o]={id:o,value:h,getTransferables:u},s(h)}catch(d){d&&d.noLog||console.error(d),s(d)}}function t(r,s){var o,a=r.id,l=r.args;(!i[a]||typeof i[a].value!="function")&&s(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var c=(o=i[a]).value.apply(o,l);c&&typeof c.then=="function"?c.then(u,function(h){return s(h instanceof Error?h:new Error(""+h))}):u(c)}catch(h){s(h)}function u(h){try{var d=i[a].getTransferables&&i[a].getTransferables(h);(!d||!Array.isArray(d)||!d.length)&&(d=void 0),s(h,d)}catch(f){console.error(f),s(f)}}}function n(r,s){var o=void 0;self.troikaDefine=function(l){return o=l};var a=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(a)}catch(l){console.error(l)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(r){var s=r.data,o=s.messageId,a=s.action,l=s.data;try{a==="registerModule"&&e(l,function(c){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof c=="function"}})}),a==="callModule"&&t(l,function(c,u){c instanceof Error?postMessage({messageId:o,success:!1,error:c.message}):postMessage({messageId:o,success:!0,result:c},u||void 0)})}catch(c){postMessage({messageId:o,success:!1,error:c.stack})}})}function RJ(i){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=i.dependencies,n=i.init;t=Array.isArray(t)?t.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var r=Promise.all(t).then(function(s){return n.apply(null,s)});return e._getInitResult=function(){return r},r},e}var L8=function(){var i=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),i=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return L8=function(){return i},i},IJ=0,LJ=0,Jw=!1,Qg=Object.create(null),Jg=Object.create(null),NT=Object.create(null);function nm(i){if((!i||typeof i.init!="function")&&!Jw)throw new Error("requires `options.init` function");var e=i.dependencies,t=i.init,n=i.getTransferables,r=i.workerId,s=RJ(i);r==null&&(r="#default");var o="workerModule"+ ++IJ,a=i.name||o,l=null;e=e&&e.map(function(u){return typeof u=="function"&&!u.workerModuleData&&(Jw=!0,u=nm({workerId:r,name:"<"+a+"> function dependency: "+u.name,init:`function(){return (
`+ax(u)+`
)}`}),Jw=!1),u&&u.workerModuleData&&(u=u.workerModuleData),u});function c(){for(var u=[],h=arguments.length;h--;)u[h]=arguments[h];if(!L8())return s.apply(void 0,u);if(!l){l=GN(r,"registerModule",c.workerModuleData);var d=function(){l=null,Jg[r].delete(d)};(Jg[r]||(Jg[r]=new Set)).add(d)}return l.then(function(f){var m=f.isCallable;if(m)return GN(r,"callModule",{id:o,args:u});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:o,name:a,dependencies:e,init:ax(t),getTransferables:n&&ax(n)},c.onMainThread=s,c}function DJ(i){Jg[i]&&Jg[i].forEach(function(e){e()}),Qg[i]&&(Qg[i].terminate(),delete Qg[i])}function ax(i){var e=i.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function NJ(i){var e=Qg[i];if(!e){var t=ax(PJ);e=Qg[i]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+i.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(n){var r=n.data,s=r.messageId,o=NT[s];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete NT[s],o(r)}}return e}function GN(i,e,t){return new Promise(function(n,r){var s=++LJ;NT[s]=function(o){o.success?n(o.result):r(new Error("Error in worker "+e+" call: "+o.error))},NJ(i).postMessage({messageId:s,action:e,data:t})})}function D8(){var i=function(e){function t(G,B,D,O,j,q,Y,ie){var ne=1-Y;ie.x=ne*ne*G+2*ne*Y*D+Y*Y*j,ie.y=ne*ne*B+2*ne*Y*O+Y*Y*q}function n(G,B,D,O,j,q,Y,ie,ne,Q){var le=1-ne;Q.x=le*le*le*G+3*le*le*ne*D+3*le*ne*ne*j+ne*ne*ne*Y,Q.y=le*le*le*B+3*le*le*ne*O+3*le*ne*ne*q+ne*ne*ne*ie}function r(G,B){for(var D=/([MLQCZ])([^MLQCZ]*)/g,O,j,q,Y,ie;O=D.exec(G);){var ne=O[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(Q){return parseFloat(Q)});switch(O[1]){case"M":Y=j=ne[0],ie=q=ne[1];break;case"L":(ne[0]!==Y||ne[1]!==ie)&&B("L",Y,ie,Y=ne[0],ie=ne[1]);break;case"Q":{B("Q",Y,ie,Y=ne[2],ie=ne[3],ne[0],ne[1]);break}case"C":{B("C",Y,ie,Y=ne[4],ie=ne[5],ne[0],ne[1],ne[2],ne[3]);break}case"Z":(Y!==j||ie!==q)&&B("L",Y,ie,j,q);break}}}function s(G,B,D){D===void 0&&(D=16);var O={x:0,y:0};r(G,function(j,q,Y,ie,ne,Q,le,se,oe){switch(j){case"L":B(q,Y,ie,ne);break;case"Q":{for(var $=q,pe=Y,xe=1;xe<D;xe++)t(q,Y,Q,le,ie,ne,xe/(D-1),O),B($,pe,O.x,O.y),$=O.x,pe=O.y;break}case"C":{for(var Pe=q,ve=Y,Ue=1;Ue<D;Ue++)n(q,Y,Q,le,se,oe,ie,ne,Ue/(D-1),O),B(Pe,ve,O.x,O.y),Pe=O.x,ve=O.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function u(G,B){var D=G.getContext?G.getContext("webgl",c):G,O=l.get(D);if(!O){let Pe=function(de){var Ie=q[de];if(!Ie&&(Ie=q[de]=D.getExtension(de),!Ie))throw new Error(de+" not supported");return Ie},ve=function(de,Ie){var te=D.createShader(Ie);return D.shaderSource(te,de),D.compileShader(te),te},Ue=function(de,Ie,te,X){if(!Y[de]){var ye={},ke={},ge=D.createProgram();D.attachShader(ge,ve(Ie,D.VERTEX_SHADER)),D.attachShader(ge,ve(te,D.FRAGMENT_SHADER)),D.linkProgram(ge),Y[de]={program:ge,transaction:function($e){D.useProgram(ge),$e({setUniform:function(Ze,nt){for(var rt=[],Oe=arguments.length-2;Oe-- >0;)rt[Oe]=arguments[Oe+2];var qe=ke[nt]||(ke[nt]=D.getUniformLocation(ge,nt));D["uniform"+Ze].apply(D,[qe].concat(rt))},setAttribute:function(Ze,nt,rt,Oe,qe){var it=ye[Ze];it||(it=ye[Ze]={buf:D.createBuffer(),loc:D.getAttribLocation(ge,Ze),data:null}),D.bindBuffer(D.ARRAY_BUFFER,it.buf),D.vertexAttribPointer(it.loc,nt,D.FLOAT,!1,0,0),D.enableVertexAttribArray(it.loc),j?D.vertexAttribDivisor(it.loc,Oe):Pe("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(it.loc,Oe),qe!==it.data&&(D.bufferData(D.ARRAY_BUFFER,qe,rt),it.data=qe)}})}}}Y[de].transaction(X)},Le=function(de,Ie){ne++;try{D.activeTexture(D.TEXTURE0+ne);var te=ie[de];te||(te=ie[de]=D.createTexture(),D.bindTexture(D.TEXTURE_2D,te),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.NEAREST),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.NEAREST)),D.bindTexture(D.TEXTURE_2D,te),Ie(te,ne)}finally{ne--}},Z=function(de,Ie,te){var X=D.createFramebuffer();Q.push(X),D.bindFramebuffer(D.FRAMEBUFFER,X),D.activeTexture(D.TEXTURE0+Ie),D.bindTexture(D.TEXTURE_2D,de),D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,de,0);try{te(X)}finally{D.deleteFramebuffer(X),D.bindFramebuffer(D.FRAMEBUFFER,Q[--Q.length-1]||null)}},J=function(){q={},Y={},ie={},ne=-1,Q.length=0};var le=Pe,se=ve,oe=Ue,$=Le,pe=Z,xe=J,j=typeof WebGL2RenderingContext<"u"&&D instanceof WebGL2RenderingContext,q={},Y={},ie={},ne=-1,Q=[];D.canvas.addEventListener("webglcontextlost",function(de){J(),de.preventDefault()},!1),l.set(D,O={gl:D,isWebGL2:j,getExtension:Pe,withProgram:Ue,withTexture:Le,withTextureFramebuffer:Z,handleContextLoss:J})}B(O)}function h(G,B,D,O,j,q,Y,ie){Y===void 0&&(Y=15),ie===void 0&&(ie=null),u(G,function(ne){var Q=ne.gl,le=ne.withProgram,se=ne.withTexture;se("copy",function(oe,$){Q.texImage2D(Q.TEXTURE_2D,0,Q.RGBA,j,q,0,Q.RGBA,Q.UNSIGNED_BYTE,B),le("copy",o,a,function(pe){var xe=pe.setUniform,Pe=pe.setAttribute;Pe("aUV",2,Q.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),xe("1i","image",$),Q.bindFramebuffer(Q.FRAMEBUFFER,ie||null),Q.disable(Q.BLEND),Q.colorMask(Y&8,Y&4,Y&2,Y&1),Q.viewport(D,O,j,q),Q.scissor(D,O,j,q),Q.drawArrays(Q.TRIANGLES,0,3)})})})}function d(G,B,D){var O=G.width,j=G.height;u(G,function(q){var Y=q.gl,ie=new Uint8Array(O*j*4);Y.readPixels(0,0,O,j,Y.RGBA,Y.UNSIGNED_BYTE,ie),G.width=B,G.height=D,h(Y,ie,0,0,O,j)})}var f=Object.freeze({__proto__:null,withWebGLContext:u,renderImageData:h,resizeWebGLCanvasWithoutClearing:d});function m(G,B,D,O,j,q){q===void 0&&(q=1);var Y=new Uint8Array(G*B),ie=O[2]-O[0],ne=O[3]-O[1],Q=[];s(D,function(Pe,ve,Ue,Le){Q.push({x1:Pe,y1:ve,x2:Ue,y2:Le,minX:Math.min(Pe,Ue),minY:Math.min(ve,Le),maxX:Math.max(Pe,Ue),maxY:Math.max(ve,Le)})}),Q.sort(function(Pe,ve){return Pe.maxX-ve.maxX});for(var le=0;le<G;le++)for(var se=0;se<B;se++){var oe=pe(O[0]+ie*(le+.5)/G,O[1]+ne*(se+.5)/B),$=Math.pow(1-Math.abs(oe)/j,q)/2;oe<0&&($=1-$),$=Math.max(0,Math.min(255,Math.round($*255))),Y[se*G+le]=$}return Y;function pe(Pe,ve){for(var Ue=1/0,Le=1/0,Z=Q.length;Z--;){var J=Q[Z];if(J.maxX+Le<=Pe)break;if(Pe+Le>J.minX&&ve-Le<J.maxY&&ve+Le>J.minY){var de=g(Pe,ve,J.x1,J.y1,J.x2,J.y2);de<Ue&&(Ue=de,Le=Math.sqrt(Ue))}}return xe(Pe,ve)&&(Le=-Le),Le}function xe(Pe,ve){for(var Ue=0,Le=Q.length;Le--;){var Z=Q[Le];if(Z.maxX<=Pe)break;var J=Z.y1>ve!=Z.y2>ve&&Pe<(Z.x2-Z.x1)*(ve-Z.y1)/(Z.y2-Z.y1)+Z.x1;J&&(Ue+=Z.y1<Z.y2?1:-1)}return Ue!==0}}function _(G,B,D,O,j,q,Y,ie,ne,Q){q===void 0&&(q=1),ie===void 0&&(ie=0),ne===void 0&&(ne=0),Q===void 0&&(Q=0),v(G,B,D,O,j,q,Y,null,ie,ne,Q)}function v(G,B,D,O,j,q,Y,ie,ne,Q,le){q===void 0&&(q=1),ne===void 0&&(ne=0),Q===void 0&&(Q=0),le===void 0&&(le=0);for(var se=m(G,B,D,O,j,q),oe=new Uint8Array(se.length*4),$=0;$<se.length;$++)oe[$*4+le]=se[$];h(Y,oe,ne,Q,G,B,1<<3-le,ie)}function g(G,B,D,O,j,q){var Y=j-D,ie=q-O,ne=Y*Y+ie*ie,Q=ne?Math.max(0,Math.min(1,((G-D)*Y+(B-O)*ie)/ne)):0,le=G-(D+Q*Y),se=B-(O+Q*ie);return le*le+se*se}var b=Object.freeze({__proto__:null,generate:m,generateIntoCanvas:_,generateIntoFramebuffer:v}),p="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",y="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",A="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",w=new Float32Array([0,0,2,0,0,2]),M=null,T=!1,E={},C=new WeakMap;function N(G){if(!T&&!F(G))throw new Error("WebGL generation not supported")}function P(G,B,D,O,j,q,Y){if(q===void 0&&(q=1),Y===void 0&&(Y=null),!Y&&(Y=M,!Y)){var ie=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!ie)throw new Error("OffscreenCanvas or DOM canvas not supported");Y=M=ie.getContext("webgl",{depth:!1})}N(Y);var ne=new Uint8Array(G*B*4);u(Y,function(oe){var $=oe.gl,pe=oe.withTexture,xe=oe.withTextureFramebuffer;pe("readable",function(Pe,ve){$.texImage2D($.TEXTURE_2D,0,$.RGBA,G,B,0,$.RGBA,$.UNSIGNED_BYTE,null),xe(Pe,ve,function(Ue){R(G,B,D,O,j,q,$,Ue,0,0,0),$.readPixels(0,0,G,B,$.RGBA,$.UNSIGNED_BYTE,ne)})})});for(var Q=new Uint8Array(G*B),le=0,se=0;le<ne.length;le+=4)Q[se++]=ne[le];return Q}function L(G,B,D,O,j,q,Y,ie,ne,Q){q===void 0&&(q=1),ie===void 0&&(ie=0),ne===void 0&&(ne=0),Q===void 0&&(Q=0),R(G,B,D,O,j,q,Y,null,ie,ne,Q)}function R(G,B,D,O,j,q,Y,ie,ne,Q,le){q===void 0&&(q=1),ne===void 0&&(ne=0),Q===void 0&&(Q=0),le===void 0&&(le=0),N(Y);var se=[];s(D,function(oe,$,pe,xe){se.push(oe,$,pe,xe)}),se=new Float32Array(se),u(Y,function(oe){var $=oe.gl,pe=oe.isWebGL2,xe=oe.getExtension,Pe=oe.withProgram,ve=oe.withTexture,Ue=oe.withTextureFramebuffer,Le=oe.handleContextLoss;if(ve("rawDistances",function(Z,J){(G!==Z._lastWidth||B!==Z._lastHeight)&&$.texImage2D($.TEXTURE_2D,0,$.RGBA,Z._lastWidth=G,Z._lastHeight=B,0,$.RGBA,$.UNSIGNED_BYTE,null),Pe("main",p,y,function(de){var Ie=de.setAttribute,te=de.setUniform,X=!pe&&xe("ANGLE_instanced_arrays"),ye=!pe&&xe("EXT_blend_minmax");Ie("aUV",2,$.STATIC_DRAW,0,w),Ie("aLineSegment",4,$.DYNAMIC_DRAW,1,se),te.apply(void 0,["4f","uGlyphBounds"].concat(O)),te("1f","uMaxDistance",j),te("1f","uExponent",q),Ue(Z,J,function(ke){$.enable($.BLEND),$.colorMask(!0,!0,!0,!0),$.viewport(0,0,G,B),$.scissor(0,0,G,B),$.blendFunc($.ONE,$.ONE),$.blendEquationSeparate($.FUNC_ADD,pe?$.MAX:ye.MAX_EXT),$.clear($.COLOR_BUFFER_BIT),pe?$.drawArraysInstanced($.TRIANGLES,0,3,se.length/4):X.drawArraysInstancedANGLE($.TRIANGLES,0,3,se.length/4)})}),Pe("post",o,A,function(de){de.setAttribute("aUV",2,$.STATIC_DRAW,0,w),de.setUniform("1i","tex",J),$.bindFramebuffer($.FRAMEBUFFER,ie),$.disable($.BLEND),$.colorMask(le===0,le===1,le===2,le===3),$.viewport(ne,Q,G,B),$.scissor(ne,Q,G,B),$.drawArrays($.TRIANGLES,0,3)})}),$.isContextLost())throw Le(),new Error("webgl context lost")})}function F(G){var B=!G||G===M?E:G.canvas||G,D=C.get(B);if(D===void 0){T=!0;var O=null;try{var j=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],q=P(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,G);D=q&&j.length===q.length&&q.every(function(Y,ie){return Y===j[ie]}),D||(O="bad trial run results",console.info(j,q))}catch(Y){D=!1,O=Y.message}O&&console.warn("WebGL SDF generation not supported:",O),T=!1,C.set(B,D)}return D}var V=Object.freeze({__proto__:null,generate:P,generateIntoCanvas:L,generateIntoFramebuffer:R,isSupported:F});function z(G,B,D,O,j,q){j===void 0&&(j=Math.max(O[2]-O[0],O[3]-O[1])/2),q===void 0&&(q=1);try{return P.apply(V,arguments)}catch(Y){return console.info("WebGL SDF generation failed, falling back to JS",Y),m.apply(b,arguments)}}function U(G,B,D,O,j,q,Y,ie,ne,Q){j===void 0&&(j=Math.max(O[2]-O[0],O[3]-O[1])/2),q===void 0&&(q=1),ie===void 0&&(ie=0),ne===void 0&&(ne=0),Q===void 0&&(Q=0);try{return L.apply(V,arguments)}catch(le){return console.info("WebGL SDF generation failed, falling back to JS",le),_.apply(b,arguments)}}return e.forEachPathCommand=r,e.generate=z,e.generateIntoCanvas=U,e.javascript=b,e.pathToLineSegments=s,e.webgl=V,e.webglUtils=f,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}function FJ(){var i=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},r={};n.L=1,r[1]="L",Object.keys(t).forEach(function(Le,Z){n[Le]=1<<Z+1,r[n[Le]]=Le}),Object.freeze(n);var s=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,a=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,l=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,c=n.S|n.WS|n.B|s|n.PDI|l,u=null;function h(){if(!u){u=new Map;var Le=function(J){if(t.hasOwnProperty(J)){var de=0;t[J].split(",").forEach(function(Ie){var te=Ie.split("+"),X=te[0],ye=te[1];X=parseInt(X,36),ye=ye?parseInt(ye,36):0,u.set(de+=X,n[J]);for(var ke=0;ke<ye;ke++)u.set(++de,n[J])})}};for(var Z in t)Le(Z)}}function d(Le){return h(),u.get(Le.codePointAt(0))||n.L}function f(Le){return r[d(Le)]}var m={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function _(Le,Z){var J=36,de=0,Ie=new Map,te=Z&&new Map,X;return Le.split(",").forEach(function ye(ke){if(ke.indexOf("+")!==-1)for(var ge=+ke;ge--;)ye(X);else{X=ke;var De=ke.split(">"),$e=De[0],Ae=De[1];$e=String.fromCodePoint(de+=parseInt($e,J)),Ae=String.fromCodePoint(de+=parseInt(Ae,J)),Ie.set($e,Ae),Z&&te.set(Ae,$e)}}),{map:Ie,reverseMap:te}}var v,g,b;function p(){if(!v){var Le=_(m.pairs,!0),Z=Le.map,J=Le.reverseMap;v=Z,g=J,b=_(m.canonical,!1).map}}function y(Le){return p(),v.get(Le)||null}function A(Le){return p(),g.get(Le)||null}function w(Le){return p(),b.get(Le)||null}var M=n.L,T=n.R,E=n.EN,C=n.ES,N=n.ET,P=n.AN,L=n.CS,R=n.B,F=n.S,V=n.ON,z=n.BN,U=n.NSM,G=n.AL,B=n.LRO,D=n.RLO,O=n.LRE,j=n.RLE,q=n.PDF,Y=n.LRI,ie=n.RLI,ne=n.FSI,Q=n.PDI;function le(Le,Z){for(var J=125,de=new Uint32Array(Le.length),Ie=0;Ie<Le.length;Ie++)de[Ie]=d(Le[Ie]);var te=new Map;function X(vr,hs){var Fi=de[vr];de[vr]=hs,te.set(Fi,te.get(Fi)-1),Fi&a&&te.set(a,te.get(a)-1),te.set(hs,(te.get(hs)||0)+1),hs&a&&te.set(a,(te.get(a)||0)+1)}for(var ye=new Uint8Array(Le.length),ke=new Map,ge=[],De=null,$e=0;$e<Le.length;$e++)De||ge.push(De={start:$e,end:Le.length-1,level:Z==="rtl"?1:Z==="ltr"?0:Td($e,!1)}),de[$e]&R&&(De.end=$e,De=null);for(var Ae=j|O|D|B|s|Q|q|R,Ze=function(vr){return vr+(vr&1?1:2)},nt=function(vr){return vr+(vr&1?2:1)},rt=0;rt<ge.length;rt++){De=ge[rt];var Oe=[{_level:De.level,_override:0,_isolate:0}],qe=void 0,it=0,at=0,ht=0;te.clear();for(var Qe=De.start;Qe<=De.end;Qe++){var je=de[Qe];if(qe=Oe[Oe.length-1],te.set(je,(te.get(je)||0)+1),je&a&&te.set(a,(te.get(a)||0)+1),je&Ae)if(je&(j|O)){ye[Qe]=qe._level;var ee=(je===j?nt:Ze)(qe._level);ee<=J&&!it&&!at?Oe.push({_level:ee,_override:0,_isolate:0}):it||at++}else if(je&(D|B)){ye[Qe]=qe._level;var ze=(je===D?nt:Ze)(qe._level);ze<=J&&!it&&!at?Oe.push({_level:ze,_override:je&D?T:M,_isolate:0}):it||at++}else if(je&s){je&ne&&(je=Td(Qe+1,!0)===1?ie:Y),ye[Qe]=qe._level,qe._override&&X(Qe,qe._override);var Ee=(je===ie?nt:Ze)(qe._level);Ee<=J&&it===0&&at===0?(ht++,Oe.push({_level:Ee,_override:0,_isolate:1,_isolInitIndex:Qe})):it++}else if(je&Q){if(it>0)it--;else if(ht>0){for(at=0;!Oe[Oe.length-1]._isolate;)Oe.pop();var Re=Oe[Oe.length-1]._isolInitIndex;Re!=null&&(ke.set(Re,Qe),ke.set(Qe,Re)),Oe.pop(),ht--}qe=Oe[Oe.length-1],ye[Qe]=qe._level,qe._override&&X(Qe,qe._override)}else je&q?(it===0&&(at>0?at--:!qe._isolate&&Oe.length>1&&(Oe.pop(),qe=Oe[Oe.length-1])),ye[Qe]=qe._level):je&R&&(ye[Qe]=De.level);else ye[Qe]=qe._level,qe._override&&je!==z&&X(Qe,qe._override)}for(var Xe=[],gt=null,_t=De.start;_t<=De.end;_t++){var Mt=de[_t];if(!(Mt&l)){var K=ye[_t],ae=Mt&s,ue=Mt===Q;gt&&K===gt._level?(gt._end=_t,gt._endsWithIsolInit=ae):Xe.push(gt={_start:_t,_end:_t,_level:K,_startsWithPDI:ue,_endsWithIsolInit:ae})}}for(var _e=[],be=0;be<Xe.length;be++){var Ne=Xe[be];if(!Ne._startsWithPDI||Ne._startsWithPDI&&!ke.has(Ne._start)){for(var Be=[gt=Ne],He=void 0;gt&&gt._endsWithIsolInit&&(He=ke.get(gt._end))!=null;)for(var lt=be+1;lt<Xe.length;lt++)if(Xe[lt]._start===He){Be.push(gt=Xe[lt]);break}for(var mt=[],wt=0;wt<Be.length;wt++)for(var zt=Be[wt],Et=zt._start;Et<=zt._end;Et++)mt.push(Et);for(var bt=ye[mt[0]],H=De.level,fe=mt[0]-1;fe>=0;fe--)if(!(de[fe]&l)){H=ye[fe];break}var Me=mt[mt.length-1],Se=ye[Me],Te=De.level;if(!(de[Me]&s)){for(var et=Me+1;et<=De.end;et++)if(!(de[et]&l)){Te=ye[et];break}}_e.push({_seqIndices:mt,_sosType:Math.max(H,bt)%2?T:M,_eosType:Math.max(Te,Se)%2?T:M})}}for(var dt=0;dt<_e.length;dt++){var yt=_e[dt],Ye=yt._seqIndices,We=yt._sosType,st=yt._eosType,ct=ye[Ye[0]]&1?T:M;if(te.get(U))for(var Lt=0;Lt<Ye.length;Lt++){var Dt=Ye[Lt];if(de[Dt]&U){for(var It=We,Ot=Lt-1;Ot>=0;Ot--)if(!(de[Ye[Ot]]&l)){It=de[Ye[Ot]];break}X(Dt,It&(s|Q)?V:It)}}if(te.get(E))for(var St=0;St<Ye.length;St++){var vt=Ye[St];if(de[vt]&E)for(var $t=St-1;$t>=-1;$t--){var Rt=$t===-1?We:de[Ye[$t]];if(Rt&o){Rt===G&&X(vt,P);break}}}if(te.get(G))for(var vn=0;vn<Ye.length;vn++){var vi=Ye[vn];de[vi]&G&&X(vi,T)}if(te.get(C)||te.get(L))for(var $n=1;$n<Ye.length-1;$n++){var Pn=Ye[$n];if(de[Pn]&(C|L)){for(var Jt=0,Wn=0,$i=$n-1;$i>=0&&(Jt=de[Ye[$i]],!!(Jt&l));$i--);for(var hn=$n+1;hn<Ye.length&&(Wn=de[Ye[hn]],!!(Wn&l));hn++);Jt===Wn&&(de[Pn]===C?Jt===E:Jt&(E|P))&&X(Pn,Jt)}}if(te.get(E))for(var Yn=0;Yn<Ye.length;Yn++){var Wi=Ye[Yn];if(de[Wi]&E){for(var pr=Yn-1;pr>=0&&de[Ye[pr]]&(N|l);pr--)X(Ye[pr],E);for(Yn++;Yn<Ye.length&&de[Ye[Yn]]&(N|l|E);Yn++)de[Ye[Yn]]!==E&&X(Ye[Yn],E)}}if(te.get(N)||te.get(C)||te.get(L))for(var Js=0;Js<Ye.length;Js++){var Oa=Ye[Js];if(de[Oa]&(N|C|L)){X(Oa,V);for(var ss=Js-1;ss>=0&&de[Ye[ss]]&l;ss--)X(Ye[ss],V);for(var os=Js+1;os<Ye.length&&de[Ye[os]]&l;os++)X(Ye[os],V)}}if(te.get(E))for(var as=0,eo=We;as<Ye.length;as++){var Ba=Ye[as],Qo=de[Ba];Qo&E?eo===M&&X(Ba,M):Qo&o&&(eo=Qo)}if(te.get(a)){var mr=T|E|P,Jo=mr|M,to=[];{for(var ir=[],zr=0;zr<Ye.length;zr++)if(de[Ye[zr]]&a){var ln=Le[Ye[zr]],vl=void 0;if(y(ln)!==null)if(ir.length<63)ir.push({char:ln,seqIndex:zr});else break;else if((vl=A(ln))!==null)for(var _l=ir.length-1;_l>=0;_l--){var Ad=ir[_l].char;if(Ad===vl||Ad===A(w(ln))||y(w(Ad))===ln){to.push([ir[_l].seqIndex,zr]),ir.length=_l;break}}}to.sort(function(vr,hs){return vr[0]-hs[0]})}for(var fm=0;fm<to.length;fm++){for(var F1=to[fm],_i=F1[0],Uu=F1[1],k1=!1,ls=0,pm=_i+1;pm<Uu;pm++){var Ou=Ye[pm];if(de[Ou]&Jo){k1=!0;var no=de[Ou]&mr?T:M;if(no===ct){ls=no;break}}}if(k1&&!ls){ls=We;for(var mm=_i-1;mm>=0;mm--){var U1=Ye[mm];if(de[U1]&Jo){var io=de[U1]&mr?T:M;io!==ct?ls=io:ls=ct;break}}}if(ls){if(de[Ye[_i]]=de[Ye[Uu]]=ls,ls!==ct){for(var cs=_i+1;cs<Ye.length;cs++)if(!(de[Ye[cs]]&l)){d(Le[Ye[cs]])&U&&(de[Ye[cs]]=ls);break}}if(ls!==ct){for(var za=Uu+1;za<Ye.length;za++)if(!(de[Ye[za]]&l)){d(Le[Ye[za]])&U&&(de[Ye[za]]=ls);break}}}}for(var Co=0;Co<Ye.length;Co++)if(de[Ye[Co]]&a){for(var gm=Co,vm=Co,Ds=We,Bu=Co-1;Bu>=0;Bu--)if(de[Ye[Bu]]&l)gm=Bu;else{Ds=de[Ye[Bu]]&mr?T:M;break}for(var zu=st,Gu=Co+1;Gu<Ye.length;Gu++)if(de[Ye[Gu]]&(a|l))vm=Gu;else{zu=de[Ye[Gu]]&mr?T:M;break}for(var us=gm;us<=vm;us++)de[Ye[us]]=Ds===zu?Ds:ct;Co=vm}}}for(var gr=De.start;gr<=De.end;gr++){var Ed=ye[gr],ea=de[gr];if(Ed&1?ea&(M|E|P)&&ye[gr]++:ea&T?ye[gr]++:ea&(P|E)&&(ye[gr]+=2),ea&l&&(ye[gr]=gr===0?De.level:ye[gr-1]),gr===De.end||d(Le[gr])&(F|R))for(var xc=gr;xc>=0&&d(Le[xc])&c;xc--)ye[xc]=De.level}}return{levels:ye,paragraphs:ge};function Td(vr,hs){for(var Fi=vr;Fi<Le.length;Fi++){var ki=de[Fi];if(ki&(T|G))return 1;if(ki&(R|M)||hs&&ki===Q)return 0;if(ki&s){var ro=O1(Fi);Fi=ro===-1?Le.length:ro}}return 0}function O1(vr){for(var hs=1,Fi=vr+1;Fi<Le.length;Fi++){var ki=de[Fi];if(ki&R)break;if(ki&Q){if(--hs===0)return Fi}else ki&s&&hs++}return-1}}var se="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",oe;function $(){if(!oe){var Le=_(se,!0),Z=Le.map,J=Le.reverseMap;J.forEach(function(de,Ie){Z.set(Ie,de)}),oe=Z}}function pe(Le){return $(),oe.get(Le)||null}function xe(Le,Z,J,de){var Ie=Le.length;J=Math.max(0,J==null?0:+J),de=Math.min(Ie-1,de==null?Ie-1:+de);for(var te=new Map,X=J;X<=de;X++)if(Z[X]&1){var ye=pe(Le[X]);ye!==null&&te.set(X,ye)}return te}function Pe(Le,Z,J,de){var Ie=Le.length;J=Math.max(0,J==null?0:+J),de=Math.min(Ie-1,de==null?Ie-1:+de);var te=[];return Z.paragraphs.forEach(function(X){var ye=Math.max(J,X.start),ke=Math.min(de,X.end);if(ye<ke){for(var ge=Z.levels.slice(ye,ke+1),De=ke;De>=ye&&d(Le[De])&c;De--)ge[De]=X.level;for(var $e=X.level,Ae=1/0,Ze=0;Ze<ge.length;Ze++){var nt=ge[Ze];nt>$e&&($e=nt),nt<Ae&&(Ae=nt|1)}for(var rt=$e;rt>=Ae;rt--)for(var Oe=0;Oe<ge.length;Oe++)if(ge[Oe]>=rt){for(var qe=Oe;Oe+1<ge.length&&ge[Oe+1]>=rt;)Oe++;Oe>qe&&te.push([qe+ye,Oe+ye])}}}),te}function ve(Le,Z,J,de){var Ie=Ue(Le,Z,J,de),te=[].concat(Le);return Ie.forEach(function(X,ye){te[ye]=(Z.levels[X]&1?pe(Le[X]):null)||Le[X]}),te.join("")}function Ue(Le,Z,J,de){for(var Ie=Pe(Le,Z,J,de),te=[],X=0;X<Le.length;X++)te[X]=X;return Ie.forEach(function(ye){for(var ke=ye[0],ge=ye[1],De=te.slice(ke,ge+1),$e=De.length;$e--;)te[ge-$e]=De[$e]}),te}return e.closingToOpeningBracket=A,e.getBidiCharType=d,e.getBidiCharTypeName=f,e.getCanonicalBracket=w,e.getEmbeddingLevels=le,e.getMirroredCharacter=pe,e.getMirroredCharactersMap=xe,e.getReorderSegments=Pe,e.getReorderedIndices=Ue,e.getReorderedString=ve,e.openingToClosingBracket=y,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}const N8=/\bvoid\s+main\s*\(\s*\)\s*{/g;function FT(i){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(n,r){let s=cn[r];return s?FT(s):n}return i.replace(e,t)}const Ir=[];for(let i=0;i<256;i++)Ir[i]=(i<16?"0":"")+i.toString(16);function kJ(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ir[i&255]+Ir[i>>8&255]+Ir[i>>16&255]+Ir[i>>24&255]+"-"+Ir[e&255]+Ir[e>>8&255]+"-"+Ir[e>>16&15|64]+Ir[e>>24&255]+"-"+Ir[t&63|128]+Ir[t>>8&255]+"-"+Ir[t>>16&255]+Ir[t>>24&255]+Ir[n&255]+Ir[n>>8&255]+Ir[n>>16&255]+Ir[n>>24&255]).toUpperCase()}const ah=Object.assign||function(){let i=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let n=arguments[e];if(n)for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i},UJ=Date.now(),VN=new WeakMap,HN=new Map;let OJ=1e10;function kT(i,e){const t=VJ(e);let n=VN.get(i);if(n||VN.set(i,n=Object.create(null)),n[t])return new n[t];const r=`_onBeforeCompile${t}`,s=function(c,u){i.onBeforeCompile.call(this,c,u);const h=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let d=HN[h];if(!d){const f=BJ(this,c,e,t);d=HN[h]=f}c.vertexShader=d.vertexShader,c.fragmentShader=d.fragmentShader,ah(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-UJ}}),this[r]&&this[r](c)},o=function(){return a(e.chained?i:i.clone())},a=function(c){const u=Object.create(c,l);return Object.defineProperty(u,"baseMaterial",{value:i}),Object.defineProperty(u,"id",{value:OJ++}),u.uuid=kJ(),u.uniforms=ah({},c.uniforms,e.uniforms),u.defines=ah({},c.defines,e.defines),u.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",u.extensions=ah({},c.extensions,e.extensions),u._listeners=void 0,u},l={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>i.type,set:c=>{i.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const u=this.baseMaterial;return c===u||u.isDerivedMaterial&&u.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return i.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return s},set(c){this[r]=c}},copy:{writable:!0,configurable:!0,value:function(c){return i.copy.call(this,c),!i.isShaderMaterial&&!i.isDerivedMaterial&&(ah(this.extensions,c.extensions),ah(this.defines,c.defines),ah(this.uniforms,jP.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new i.constructor;return a(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=kT(i.isDerivedMaterial?i.getDepthMaterial():new Jb({depthPacking:BP}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=kT(i.isDerivedMaterial?i.getDistanceMaterial():new eS,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:u}=this;c&&c.dispose(),u&&u.dispose(),i.dispose.call(this)}}};return n[t]=o,new o}function BJ(i,{vertexShader:e,fragmentShader:t},n,r){let{vertexDefs:s,vertexMainIntro:o,vertexMainOutro:a,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:u,fragmentMainOutro:h,fragmentColorTransform:d,customRewriter:f,timeUniform:m}=n;if(s=s||"",o=o||"",a=a||"",c=c||"",u=u||"",h=h||"",(l||f)&&(e=FT(e)),(d||f)&&(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),t=FT(t)),f){let _=f({vertexShader:e,fragmentShader:t});e=_.vertexShader,t=_.fragmentShader}if(d){let _=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,v=>(_.push(v),"")),h=`${d}
${_.join(`
`)}
${h}`}if(m){const _=`
uniform float ${m};
`;s=_+s,c=_+c}return l&&(e=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${e}
`,s=`${s}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,o=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${o}
`,e=e.replace(/\b(position|normal|uv)\b/g,(_,v,g,b)=>/\battribute\s+vec[23]\s+$/.test(b.substr(0,g))?v:`troika_${v}_${r}`),i.map&&i.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),e=$N(e,r,s,o,a),t=$N(t,r,c,u,h),{vertexShader:e,fragmentShader:t}}function $N(i,e,t,n,r){return(n||r||t)&&(i=i.replace(N8,`
${t}
void troikaOrigMain${e}() {`),i+=`
void main() {
  ${n}
  troikaOrigMain${e}();
  ${r}
}`),i}function zJ(i,e){return i==="uniforms"?void 0:typeof e=="function"?e.toString():e}let GJ=0;const WN=new Map;function VJ(i){const e=JSON.stringify(i,zJ);let t=WN.get(e);return t==null&&WN.set(e,t=++GJ),t}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function HJ(){return typeof window>"u"&&(self.window=self),function(i){var e={parse:function(r){var s=e._bin,o=new Uint8Array(r);if(s.readASCII(o,0,4)=="ttcf"){var a=4;s.readUshort(o,a),a+=2,s.readUshort(o,a),a+=2;var l=s.readUint(o,a);a+=4;for(var c=[],u=0;u<l;u++){var h=s.readUint(o,a);a+=4,c.push(e._readFont(o,h))}return c}return[e._readFont(o,0)]},_readFont:function(r,s){var o=e._bin,a=s;o.readFixed(r,s),s+=4;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],u={_data:r,_offset:a},h={},d=0;d<l;d++){var f=o.readASCII(r,s,4);s+=4,o.readUint(r,s),s+=4;var m=o.readUint(r,s);s+=4;var _=o.readUint(r,s);s+=4,h[f]={offset:m,length:_}}for(d=0;d<c.length;d++){var v=c[d];h[v]&&(u[v.trim()]=e[v.trim()].parse(r,h[v].offset,h[v].length,u))}return u},_tabOffset:function(r,s,o){for(var a=e._bin,l=a.readUshort(r,o+4),c=o+12,u=0;u<l;u++){var h=a.readASCII(r,c,4);c+=4,a.readUint(r,c),c+=4;var d=a.readUint(r,c);if(c+=4,a.readUint(r,c),c+=4,h==s)return d}return 0}};e._bin={readFixed:function(r,s){return(r[s]<<8|r[s+1])+(r[s+2]<<8|r[s+3])/65540},readF2dot14:function(r,s){return e._bin.readShort(r,s)/16384},readInt:function(r,s){return e._bin._view(r).getInt32(s)},readInt8:function(r,s){return e._bin._view(r).getInt8(s)},readShort:function(r,s){return e._bin._view(r).getInt16(s)},readUshort:function(r,s){return e._bin._view(r).getUint16(s)},readUshorts:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(e._bin.readUshort(r,s+2*l));return a},readUint:function(r,s){return e._bin._view(r).getUint32(s)},readUint64:function(r,s){return 4294967296*e._bin.readUint(r,s)+e._bin.readUint(r,s+4)},readASCII:function(r,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(r[s+l]);return a},readUnicode:function(r,s,o){for(var a="",l=0;l<o;l++){var c=r[s++]<<8|r[s++];a+=String.fromCharCode(c)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,s,o){var a=e._bin._tdec;return a&&s==0&&o==r.length?a.decode(r):e._bin.readASCII(r,s,o)},readBytes:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(r[s+l]);return a},readASCIIArray:function(r,s,o){for(var a=[],l=0;l<o;l++)a.push(String.fromCharCode(r[s+l]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},e._lctf={},e._lctf.parse=function(r,s,o,a,l){var c=e._bin,u={},h=s;c.readFixed(r,s),s+=4;var d=c.readUshort(r,s);s+=2;var f=c.readUshort(r,s);s+=2;var m=c.readUshort(r,s);return s+=2,u.scriptList=e._lctf.readScriptList(r,h+d),u.featureList=e._lctf.readFeatureList(r,h+f),u.lookupList=e._lctf.readLookupList(r,h+m,l),u},e._lctf.readLookupList=function(r,s,o){var a=e._bin,l=s,c=[],u=a.readUshort(r,s);s+=2;for(var h=0;h<u;h++){var d=a.readUshort(r,s);s+=2;var f=e._lctf.readLookupTable(r,l+d,o);c.push(f)}return c},e._lctf.readLookupTable=function(r,s,o){var a=e._bin,l=s,c={tabs:[]};c.ltype=a.readUshort(r,s),s+=2,c.flag=a.readUshort(r,s),s+=2;var u=a.readUshort(r,s);s+=2;for(var h=c.ltype,d=0;d<u;d++){var f=a.readUshort(r,s);s+=2;var m=o(r,h,l+f,c);c.tabs.push(m)}return c},e._lctf.numOfOnes=function(r){for(var s=0,o=0;o<32;o++)r>>>o&1&&s++;return s},e._lctf.readClassDef=function(r,s){var o=e._bin,a=[],l=o.readUshort(r,s);if(s+=2,l==1){var c=o.readUshort(r,s);s+=2;var u=o.readUshort(r,s);s+=2;for(var h=0;h<u;h++)a.push(c+h),a.push(c+h),a.push(o.readUshort(r,s)),s+=2}if(l==2){var d=o.readUshort(r,s);for(s+=2,h=0;h<d;h++)a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2,a.push(o.readUshort(r,s)),s+=2}return a},e._lctf.getInterval=function(r,s){for(var o=0;o<r.length;o+=3){var a=r[o],l=r[o+1];if(r[o+2],a<=s&&s<=l)return o}return-1},e._lctf.readCoverage=function(r,s){var o=e._bin,a={};a.fmt=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.fmt==1&&(a.tab=o.readUshorts(r,s,l)),a.fmt==2&&(a.tab=o.readUshorts(r,s,3*l)),a},e._lctf.coverageIndex=function(r,s){var o=r.tab;if(r.fmt==1)return o.indexOf(s);if(r.fmt==2){var a=e._lctf.getInterval(o,s);if(a!=-1)return o[a+2]+(s-o[a])}return-1},e._lctf.readFeatureList=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readASCII(r,s,4);s+=4;var d=o.readUshort(r,s);s+=2;var f=e._lctf.readFeatureTable(r,a+d);f.tag=h.trim(),l.push(f)}return l},e._lctf.readFeatureTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.featureParams=a+c);var u=o.readUshort(r,s);s+=2,l.tab=[];for(var h=0;h<u;h++)l.tab.push(o.readUshort(r,s+2*h));return l},e._lctf.readScriptList=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readASCII(r,s,4);s+=4;var d=o.readUshort(r,s);s+=2,l[h.trim()]=e._lctf.readScriptTable(r,a+d)}return l},e._lctf.readScriptTable=function(r,s){var o=e._bin,a=s,l={},c=o.readUshort(r,s);s+=2,c>0&&(l.default=e._lctf.readLangSysTable(r,a+c));var u=o.readUshort(r,s);s+=2;for(var h=0;h<u;h++){var d=o.readASCII(r,s,4);s+=4;var f=o.readUshort(r,s);s+=2,l[d.trim()]=e._lctf.readLangSysTable(r,a+f)}return l},e._lctf.readLangSysTable=function(r,s){var o=e._bin,a={};o.readUshort(r,s),s+=2,a.reqFeature=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);return s+=2,a.features=o.readUshorts(r,s,l),a},e.CFF={},e.CFF.parse=function(r,s,o){var a=e._bin;(r=new Uint8Array(r.buffer,s,o))[s=0],r[++s],r[++s],r[++s],s++;var l=[];s=e.CFF.readIndex(r,s,l);for(var c=[],u=0;u<l.length-1;u++)c.push(a.readASCII(r,s+l[u],l[u+1]-l[u]));s+=l[l.length-1];var h=[];s=e.CFF.readIndex(r,s,h);var d=[];for(u=0;u<h.length-1;u++)d.push(e.CFF.readDict(r,s+h[u],s+h[u+1]));s+=h[h.length-1];var f=d[0],m=[];s=e.CFF.readIndex(r,s,m);var _=[];for(u=0;u<m.length-1;u++)_.push(a.readASCII(r,s+m[u],m[u+1]-m[u]));if(s+=m[m.length-1],e.CFF.readSubrs(r,s,f),f.CharStrings){s=f.CharStrings,m=[],s=e.CFF.readIndex(r,s,m);var v=[];for(u=0;u<m.length-1;u++)v.push(a.readBytes(r,s+m[u],m[u+1]-m[u]));f.CharStrings=v}if(f.ROS){s=f.FDArray;var g=[];for(s=e.CFF.readIndex(r,s,g),f.FDArray=[],u=0;u<g.length-1;u++){var b=e.CFF.readDict(r,s+g[u],s+g[u+1]);e.CFF._readFDict(r,b,_),f.FDArray.push(b)}s+=g[g.length-1],s=f.FDSelect,f.FDSelect=[];var p=r[s];if(s++,p!=3)throw p;var y=a.readUshort(r,s);for(s+=2,u=0;u<y+1;u++)f.FDSelect.push(a.readUshort(r,s),r[s+2]),s+=3}return f.Encoding&&(f.Encoding=e.CFF.readEncoding(r,f.Encoding,f.CharStrings.length)),f.charset&&(f.charset=e.CFF.readCharset(r,f.charset,f.CharStrings.length)),e.CFF._readFDict(r,f,_),f},e.CFF._readFDict=function(r,s,o){var a;for(var l in s.Private&&(a=s.Private[1],s.Private=e.CFF.readDict(r,a,a+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(r,a+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(s[l]=o[s[l]-426+35])},e.CFF.readSubrs=function(r,s,o){var a=e._bin,l=[];s=e.CFF.readIndex(r,s,l);var c,u=l.length;c=u<1240?107:u<33900?1131:32768,o.Bias=c,o.Subrs=[];for(var h=0;h<l.length-1;h++)o.Subrs.push(a.readBytes(r,s+l[h],l[h+1]-l[h]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(r,s){for(var o=0;o<r.charset.length;o++)if(r.charset[o]==s)return o;return-1},e.CFF.glyphBySE=function(r,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(r,e.CFF.tableSE[s])},e.CFF.readEncoding=function(r,s,o){e._bin;var a=[".notdef"],l=r[s];if(s++,l!=0)throw"error: unknown encoding format: "+l;var c=r[s];s++;for(var u=0;u<c;u++)a.push(r[s+u]);return a},e.CFF.readCharset=function(r,s,o){var a=e._bin,l=[".notdef"],c=r[s];if(s++,c==0)for(var u=0;u<o;u++){var h=a.readUshort(r,s);s+=2,l.push(h)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<o;){h=a.readUshort(r,s),s+=2;var d=0;for(c==1?(d=r[s],s++):(d=a.readUshort(r,s),s+=2),u=0;u<=d;u++)l.push(h),h++}}return l},e.CFF.readIndex=function(r,s,o){var a=e._bin,l=a.readUshort(r,s)+1,c=r[s+=2];if(s++,c==1)for(var u=0;u<l;u++)o.push(r[s+u]);else if(c==2)for(u=0;u<l;u++)o.push(a.readUshort(r,s+2*u));else if(c==3)for(u=0;u<l;u++)o.push(16777215&a.readUint(r,s+3*u-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(s+=l*c)-1},e.CFF.getCharString=function(r,s,o){var a=e._bin,l=r[s],c=r[s+1];r[s+2],r[s+3],r[s+4];var u=1,h=null,d=null;l<=20&&(h=l,u=1),l==12&&(h=100*l+c,u=2),21<=l&&l<=27&&(h=l,u=1),l==28&&(d=a.readShort(r,s+1),u=3),29<=l&&l<=31&&(h=l,u=1),32<=l&&l<=246&&(d=l-139,u=1),247<=l&&l<=250&&(d=256*(l-247)+c+108,u=2),251<=l&&l<=254&&(d=256*-(l-251)-c-108,u=2),l==255&&(d=a.readInt(r,s+1)/65535,u=5),o.val=d??"o"+h,o.size=u},e.CFF.readCharString=function(r,s,o){for(var a=s+o,l=e._bin,c=[];s<a;){var u=r[s],h=r[s+1];r[s+2],r[s+3],r[s+4];var d=1,f=null,m=null;u<=20&&(f=u,d=1),u==12&&(f=100*u+h,d=2),u!=19&&u!=20||(f=u,d=2),21<=u&&u<=27&&(f=u,d=1),u==28&&(m=l.readShort(r,s+1),d=3),29<=u&&u<=31&&(f=u,d=1),32<=u&&u<=246&&(m=u-139,d=1),247<=u&&u<=250&&(m=256*(u-247)+h+108,d=2),251<=u&&u<=254&&(m=256*-(u-251)-h-108,d=2),u==255&&(m=l.readInt(r,s+1)/65535,d=5),c.push(m??"o"+f),s+=d}return c},e.CFF.readDict=function(r,s,o){for(var a=e._bin,l={},c=[];s<o;){var u=r[s],h=r[s+1];r[s+2],r[s+3],r[s+4];var d=1,f=null,m=null;if(u==28&&(m=a.readShort(r,s+1),d=3),u==29&&(m=a.readInt(r,s+1),d=5),32<=u&&u<=246&&(m=u-139,d=1),247<=u&&u<=250&&(m=256*(u-247)+h+108,d=2),251<=u&&u<=254&&(m=256*-(u-251)-h-108,d=2),u==255)throw m=a.readInt(r,s+1)/65535,d=5,"unknown number";if(u==30){var _=[];for(d=1;;){var v=r[s+d];d++;var g=v>>4,b=15&v;if(g!=15&&_.push(g),b!=15&&_.push(b),b==15)break}for(var p="",y=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],A=0;A<_.length;A++)p+=y[_[A]];m=parseFloat(p)}u<=21&&(f=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][u],d=1,u==12&&(f=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][h],d=2)),f!=null?(l[f]=c.length==1?c[0]:c,c=[]):c.push(m),s+=d}return l},e.cmap={},e.cmap.parse=function(r,s,o){r=new Uint8Array(r.buffer,s,o),s=0;var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2;var u=[];l.tables=[];for(var h=0;h<c;h++){var d=a.readUshort(r,s);s+=2;var f=a.readUshort(r,s);s+=2;var m=a.readUint(r,s);s+=4;var _="p"+d+"e"+f,v=u.indexOf(m);if(v==-1){var g;v=l.tables.length,u.push(m);var b=a.readUshort(r,m);b==0?g=e.cmap.parse0(r,m):b==4?g=e.cmap.parse4(r,m):b==6?g=e.cmap.parse6(r,m):b==12?g=e.cmap.parse12(r,m):console.debug("unknown format: "+b,d,f,m),l.tables.push(g)}if(l[_]!=null)throw"multiple tables for one platform+encoding";l[_]=v}return l},e.cmap.parse0=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2,a.map=[];for(var c=0;c<l-6;c++)a.map.push(r[s+c]);return a},e.cmap.parse4=function(r,s){var o=e._bin,a=s,l={};l.format=o.readUshort(r,s),s+=2;var c=o.readUshort(r,s);s+=2,o.readUshort(r,s),s+=2;var u=o.readUshort(r,s);s+=2;var h=u/2;l.searchRange=o.readUshort(r,s),s+=2,l.entrySelector=o.readUshort(r,s),s+=2,l.rangeShift=o.readUshort(r,s),s+=2,l.endCount=o.readUshorts(r,s,h),s+=2*h,s+=2,l.startCount=o.readUshorts(r,s,h),s+=2*h,l.idDelta=[];for(var d=0;d<h;d++)l.idDelta.push(o.readShort(r,s)),s+=2;for(l.idRangeOffset=o.readUshorts(r,s,h),s+=2*h,l.glyphIdArray=[];s<a+c;)l.glyphIdArray.push(o.readUshort(r,s)),s+=2;return l},e.cmap.parse6=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,o.readUshort(r,s),s+=2,a.firstCode=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2,a.glyphIdArray=[];for(var c=0;c<l;c++)a.glyphIdArray.push(o.readUshort(r,s)),s+=2;return a},e.cmap.parse12=function(r,s){var o=e._bin,a={};a.format=o.readUshort(r,s),s+=2,s+=2,o.readUint(r,s),s+=4,o.readUint(r,s),s+=4;var l=o.readUint(r,s);s+=4,a.groups=[];for(var c=0;c<l;c++){var u=s+12*c,h=o.readUint(r,u+0),d=o.readUint(r,u+4),f=o.readUint(r,u+8);a.groups.push([h,d,f])}return a},e.glyf={},e.glyf.parse=function(r,s,o,a){for(var l=[],c=0;c<a.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(r,s){var o=e._bin,a=r._data,l=e._tabOffset(a,"glyf",r._offset)+r.loca[s];if(r.loca[s]==r.loca[s+1])return null;var c={};if(c.noc=o.readShort(a,l),l+=2,c.xMin=o.readShort(a,l),l+=2,c.yMin=o.readShort(a,l),l+=2,c.xMax=o.readShort(a,l),l+=2,c.yMax=o.readShort(a,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var u=0;u<c.noc;u++)c.endPts.push(o.readUshort(a,l)),l+=2;var h=o.readUshort(a,l);if(l+=2,a.length-l<h)return null;c.instructions=o.readBytes(a,l,h),l+=h;var d=c.endPts[c.noc-1]+1;for(c.flags=[],u=0;u<d;u++){var f=a[l];if(l++,c.flags.push(f),(8&f)!=0){var m=a[l];l++;for(var _=0;_<m;_++)c.flags.push(f),u++}}for(c.xs=[],u=0;u<d;u++){var v=(2&c.flags[u])!=0,g=(16&c.flags[u])!=0;v?(c.xs.push(g?a[l]:-a[l]),l++):g?c.xs.push(0):(c.xs.push(o.readShort(a,l)),l+=2)}for(c.ys=[],u=0;u<d;u++)v=(4&c.flags[u])!=0,g=(32&c.flags[u])!=0,v?(c.ys.push(g?a[l]:-a[l]),l++):g?c.ys.push(0):(c.ys.push(o.readShort(a,l)),l+=2);var b=0,p=0;for(u=0;u<d;u++)b+=c.xs[u],p+=c.ys[u],c.xs[u]=b,c.ys[u]=p}else{var y;c.parts=[];do{y=o.readUshort(a,l),l+=2;var A={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(A),A.glyphIndex=o.readUshort(a,l),l+=2,1&y){var w=o.readShort(a,l);l+=2;var M=o.readShort(a,l);l+=2}else w=o.readInt8(a,l),l++,M=o.readInt8(a,l),l++;2&y?(A.m.tx=w,A.m.ty=M):(A.p1=w,A.p2=M),8&y?(A.m.a=A.m.d=o.readF2dot14(a,l),l+=2):64&y?(A.m.a=o.readF2dot14(a,l),l+=2,A.m.d=o.readF2dot14(a,l),l+=2):128&y&&(A.m.a=o.readF2dot14(a,l),l+=2,A.m.b=o.readF2dot14(a,l),l+=2,A.m.c=o.readF2dot14(a,l),l+=2,A.m.d=o.readF2dot14(a,l),l+=2)}while(32&y);if(256&y){var T=o.readUshort(a,l);for(l+=2,c.instr=[],u=0;u<T;u++)c.instr.push(a[l]),l++}}return c},e.GDEF={},e.GDEF.parse=function(r,s,o,a){var l=s;s+=4;var c=e._bin.readUshort(r,s);return{glyphClassDef:c===0?null:e._lctf.readClassDef(r,l+c)}},e.GPOS={},e.GPOS.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GPOS.subt)},e.GPOS.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,s==1||s==2||s==3||s==7||s==8&&u.fmt<=2){var h=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,h+c)}if(s==1&&u.fmt==1){var d=l.readUshort(r,o);o+=2,d!=0&&(u.pos=e.GPOS.readValueRecord(r,o,d))}else if(s==2&&u.fmt>=1&&u.fmt<=2){d=l.readUshort(r,o),o+=2;var f=l.readUshort(r,o);o+=2;var m=e._lctf.numOfOnes(d),_=e._lctf.numOfOnes(f);if(u.fmt==1){u.pairsets=[];var v=l.readUshort(r,o);o+=2;for(var g=0;g<v;g++){var b=c+l.readUshort(r,o);o+=2;var p=l.readUshort(r,b);b+=2;for(var y=[],A=0;A<p;A++){var w=l.readUshort(r,b);b+=2,d!=0&&(P=e.GPOS.readValueRecord(r,b,d),b+=2*m),f!=0&&(L=e.GPOS.readValueRecord(r,b,f),b+=2*_),y.push({gid2:w,val1:P,val2:L})}u.pairsets.push(y)}}if(u.fmt==2){var M=l.readUshort(r,o);o+=2;var T=l.readUshort(r,o);o+=2;var E=l.readUshort(r,o);o+=2;var C=l.readUshort(r,o);for(o+=2,u.classDef1=e._lctf.readClassDef(r,c+M),u.classDef2=e._lctf.readClassDef(r,c+T),u.matrix=[],g=0;g<E;g++){var N=[];for(A=0;A<C;A++){var P=null,L=null;d!=0&&(P=e.GPOS.readValueRecord(r,o,d),o+=2*m),f!=0&&(L=e.GPOS.readValueRecord(r,o,f),o+=2*_),N.push({val1:P,val2:L})}u.matrix.push(N)}}}else if(s==4&&u.fmt==1)u.markCoverage=e._lctf.readCoverage(r,l.readUshort(r,o)+c),u.baseCoverage=e._lctf.readCoverage(r,l.readUshort(r,o+2)+c),u.markClassCount=l.readUshort(r,o+4),u.markArray=e.GPOS.readMarkArray(r,l.readUshort(r,o+6)+c),u.baseArray=e.GPOS.readBaseArray(r,l.readUshort(r,o+8)+c,u.markClassCount);else if(s==6&&u.fmt==1)u.mark1Coverage=e._lctf.readCoverage(r,l.readUshort(r,o)+c),u.mark2Coverage=e._lctf.readCoverage(r,l.readUshort(r,o+2)+c),u.markClassCount=l.readUshort(r,o+4),u.mark1Array=e.GPOS.readMarkArray(r,l.readUshort(r,o+6)+c),u.mark2Array=e.GPOS.readBaseArray(r,l.readUshort(r,o+8)+c,u.markClassCount);else{if(s==9&&u.fmt==1){var R=l.readUshort(r,o);o+=2;var F=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=R;else if(a.ltype!=R)throw"invalid extension substitution";return e.GPOS.subt(r,a.ltype,c+F)}console.debug("unsupported GPOS table LookupType",s,"format",u.fmt)}return u},e.GPOS.readValueRecord=function(r,s,o){var a=e._bin,l=[];return l.push(1&o?a.readShort(r,s):0),s+=1&o?2:0,l.push(2&o?a.readShort(r,s):0),s+=2&o?2:0,l.push(4&o?a.readShort(r,s):0),s+=4&o?2:0,l.push(8&o?a.readShort(r,s):0),s+=8&o?2:0,l},e.GPOS.readBaseArray=function(r,s,o){var a=e._bin,l=[],c=s,u=a.readUshort(r,s);s+=2;for(var h=0;h<u;h++){for(var d=[],f=0;f<o;f++)d.push(e.GPOS.readAnchorRecord(r,c+a.readUshort(r,s))),s+=2;l.push(d)}return l},e.GPOS.readMarkArray=function(r,s){var o=e._bin,a=[],l=s,c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=e.GPOS.readAnchorRecord(r,o.readUshort(r,s+2)+l);h.markClass=o.readUshort(r,s),a.push(h),s+=4}return a},e.GPOS.readAnchorRecord=function(r,s){var o=e._bin,a={};return a.fmt=o.readUshort(r,s),a.x=o.readShort(r,s+2),a.y=o.readShort(r,s+4),a},e.GSUB={},e.GSUB.parse=function(r,s,o,a){return e._lctf.parse(r,s,o,a,e.GSUB.subt)},e.GSUB.subt=function(r,s,o,a){var l=e._bin,c=o,u={};if(u.fmt=l.readUshort(r,o),o+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&u.fmt<=2||s==6&&u.fmt<=2){var h=l.readUshort(r,o);o+=2,u.coverage=e._lctf.readCoverage(r,c+h)}if(s==1&&u.fmt>=1&&u.fmt<=2){if(u.fmt==1)u.delta=l.readShort(r,o),o+=2;else if(u.fmt==2){var d=l.readUshort(r,o);o+=2,u.newg=l.readUshorts(r,o,d),o+=2*u.newg.length}}else if(s==2&&u.fmt==1){d=l.readUshort(r,o),o+=2,u.seqs=[];for(var f=0;f<d;f++){var m=l.readUshort(r,o)+c;o+=2;var _=l.readUshort(r,m);u.seqs.push(l.readUshorts(r,m+2,_))}}else if(s==4)for(u.vals=[],d=l.readUshort(r,o),o+=2,f=0;f<d;f++){var v=l.readUshort(r,o);o+=2,u.vals.push(e.GSUB.readLigatureSet(r,c+v))}else if(s==5&&u.fmt==2){if(u.fmt==2){var g=l.readUshort(r,o);o+=2,u.cDef=e._lctf.readClassDef(r,c+g),u.scset=[];var b=l.readUshort(r,o);for(o+=2,f=0;f<b;f++){var p=l.readUshort(r,o);o+=2,u.scset.push(p==0?null:e.GSUB.readSubClassSet(r,c+p))}}}else if(s==6&&u.fmt==3){if(u.fmt==3){for(f=0;f<3;f++){d=l.readUshort(r,o),o+=2;for(var y=[],A=0;A<d;A++)y.push(e._lctf.readCoverage(r,c+l.readUshort(r,o+2*A)));o+=2*d,f==0&&(u.backCvg=y),f==1&&(u.inptCvg=y),f==2&&(u.ahedCvg=y)}d=l.readUshort(r,o),o+=2,u.lookupRec=e.GSUB.readSubstLookupRecords(r,o,d)}}else{if(s==7&&u.fmt==1){var w=l.readUshort(r,o);o+=2;var M=l.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=w;else if(a.ltype!=w)throw"invalid extension substitution";return e.GSUB.subt(r,a.ltype,c+M)}console.debug("unsupported GSUB table LookupType",s,"format",u.fmt)}return u},e.GSUB.readSubClassSet=function(r,s){var o=e._bin.readUshort,a=s,l=[],c=o(r,s);s+=2;for(var u=0;u<c;u++){var h=o(r,s);s+=2,l.push(e.GSUB.readSubClassRule(r,a+h))}return l},e.GSUB.readSubClassRule=function(r,s){var o=e._bin.readUshort,a={},l=o(r,s),c=o(r,s+=2);s+=2,a.input=[];for(var u=0;u<l-1;u++)a.input.push(o(r,s)),s+=2;return a.substLookupRecords=e.GSUB.readSubstLookupRecords(r,s,c),a},e.GSUB.readSubstLookupRecords=function(r,s,o){for(var a=e._bin.readUshort,l=[],c=0;c<o;c++)l.push(a(r,s),a(r,s+2)),s+=4;return l},e.GSUB.readChainSubClassSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readUshort(r,s);s+=2,l.push(e.GSUB.readChainSubClassRule(r,a+h))}return l},e.GSUB.readChainSubClassRule=function(r,s){for(var o=e._bin,a={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var u=o.readUshort(r,s);s+=2,c==1&&u--,a[l[c]]=o.readUshorts(r,s,u),s+=2*a[l[c]].length}return u=o.readUshort(r,s),s+=2,a.subst=o.readUshorts(r,s,2*u),s+=2*a.subst.length,a},e.GSUB.readLigatureSet=function(r,s){var o=e._bin,a=s,l=[],c=o.readUshort(r,s);s+=2;for(var u=0;u<c;u++){var h=o.readUshort(r,s);s+=2,l.push(e.GSUB.readLigature(r,a+h))}return l},e.GSUB.readLigature=function(r,s){var o=e._bin,a={chain:[]};a.nglyph=o.readUshort(r,s),s+=2;var l=o.readUshort(r,s);s+=2;for(var c=0;c<l-1;c++)a.chain.push(o.readUshort(r,s)),s+=2;return a},e.head={},e.head.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.fontRevision=a.readFixed(r,s),s+=4,a.readUint(r,s),s+=4,a.readUint(r,s),s+=4,l.flags=a.readUshort(r,s),s+=2,l.unitsPerEm=a.readUshort(r,s),s+=2,l.created=a.readUint64(r,s),s+=8,l.modified=a.readUint64(r,s),s+=8,l.xMin=a.readShort(r,s),s+=2,l.yMin=a.readShort(r,s),s+=2,l.xMax=a.readShort(r,s),s+=2,l.yMax=a.readShort(r,s),s+=2,l.macStyle=a.readUshort(r,s),s+=2,l.lowestRecPPEM=a.readUshort(r,s),s+=2,l.fontDirectionHint=a.readShort(r,s),s+=2,l.indexToLocFormat=a.readShort(r,s),s+=2,l.glyphDataFormat=a.readShort(r,s),s+=2,l},e.hhea={},e.hhea.parse=function(r,s,o){var a=e._bin,l={};return a.readFixed(r,s),s+=4,l.ascender=a.readShort(r,s),s+=2,l.descender=a.readShort(r,s),s+=2,l.lineGap=a.readShort(r,s),s+=2,l.advanceWidthMax=a.readUshort(r,s),s+=2,l.minLeftSideBearing=a.readShort(r,s),s+=2,l.minRightSideBearing=a.readShort(r,s),s+=2,l.xMaxExtent=a.readShort(r,s),s+=2,l.caretSlopeRise=a.readShort(r,s),s+=2,l.caretSlopeRun=a.readShort(r,s),s+=2,l.caretOffset=a.readShort(r,s),s+=2,s+=8,l.metricDataFormat=a.readShort(r,s),s+=2,l.numberOfHMetrics=a.readUshort(r,s),s+=2,l},e.hmtx={},e.hmtx.parse=function(r,s,o,a){for(var l=e._bin,c={aWidth:[],lsBearing:[]},u=0,h=0,d=0;d<a.maxp.numGlyphs;d++)d<a.hhea.numberOfHMetrics&&(u=l.readUshort(r,s),s+=2,h=l.readShort(r,s),s+=2),c.aWidth.push(u),c.lsBearing.push(h);return c},e.kern={},e.kern.parse=function(r,s,o,a){var l=e._bin,c=l.readUshort(r,s);if(s+=2,c==1)return e.kern.parseV1(r,s-2,o,a);var u=l.readUshort(r,s);s+=2;for(var h={glyph1:[],rval:[]},d=0;d<u;d++){s+=2,o=l.readUshort(r,s),s+=2;var f=l.readUshort(r,s);s+=2;var m=f>>>8;if((m&=15)!=0)throw"unknown kern table format: "+m;s=e.kern.readFormat0(r,s,h)}return h},e.kern.parseV1=function(r,s,o,a){var l=e._bin;l.readFixed(r,s),s+=4;var c=l.readUint(r,s);s+=4;for(var u={glyph1:[],rval:[]},h=0;h<c;h++){l.readUint(r,s),s+=4;var d=l.readUshort(r,s);s+=2,l.readUshort(r,s),s+=2;var f=d>>>8;if((f&=15)!=0)throw"unknown kern table format: "+f;s=e.kern.readFormat0(r,s,u)}return u},e.kern.readFormat0=function(r,s,o){var a=e._bin,l=-1,c=a.readUshort(r,s);s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2,a.readUshort(r,s),s+=2;for(var u=0;u<c;u++){var h=a.readUshort(r,s);s+=2;var d=a.readUshort(r,s);s+=2;var f=a.readShort(r,s);s+=2,h!=l&&(o.glyph1.push(h),o.rval.push({glyph2:[],vals:[]}));var m=o.rval[o.rval.length-1];m.glyph2.push(d),m.vals.push(f),l=h}return s},e.loca={},e.loca.parse=function(r,s,o,a){var l=e._bin,c=[],u=a.head.indexToLocFormat,h=a.maxp.numGlyphs+1;if(u==0)for(var d=0;d<h;d++)c.push(l.readUshort(r,s+(d<<1))<<1);if(u==1)for(d=0;d<h;d++)c.push(l.readUint(r,s+(d<<2)));return c},e.maxp={},e.maxp.parse=function(r,s,o){var a=e._bin,l={},c=a.readUint(r,s);return s+=4,l.numGlyphs=a.readUshort(r,s),s+=2,c==65536&&(l.maxPoints=a.readUshort(r,s),s+=2,l.maxContours=a.readUshort(r,s),s+=2,l.maxCompositePoints=a.readUshort(r,s),s+=2,l.maxCompositeContours=a.readUshort(r,s),s+=2,l.maxZones=a.readUshort(r,s),s+=2,l.maxTwilightPoints=a.readUshort(r,s),s+=2,l.maxStorage=a.readUshort(r,s),s+=2,l.maxFunctionDefs=a.readUshort(r,s),s+=2,l.maxInstructionDefs=a.readUshort(r,s),s+=2,l.maxStackElements=a.readUshort(r,s),s+=2,l.maxSizeOfInstructions=a.readUshort(r,s),s+=2,l.maxComponentElements=a.readUshort(r,s),s+=2,l.maxComponentDepth=a.readUshort(r,s),s+=2),l},e.name={},e.name.parse=function(r,s,o){var a=e._bin,l={};a.readUshort(r,s),s+=2;var c=a.readUshort(r,s);s+=2,a.readUshort(r,s);for(var u,h=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],d=s+=2,f=0;f<c;f++){var m=a.readUshort(r,s);s+=2;var _=a.readUshort(r,s);s+=2;var v=a.readUshort(r,s);s+=2;var g=a.readUshort(r,s);s+=2;var b=a.readUshort(r,s);s+=2;var p=a.readUshort(r,s);s+=2;var y,A=h[g],w=d+12*c+p;if(m==0)y=a.readUnicode(r,w,b/2);else if(m==3&&_==0)y=a.readUnicode(r,w,b/2);else if(_==0)y=a.readASCII(r,w,b);else if(_==1)y=a.readUnicode(r,w,b/2);else if(_==3)y=a.readUnicode(r,w,b/2);else{if(m!=1)throw"unknown encoding "+_+", platformID: "+m;y=a.readASCII(r,w,b),console.debug("reading unknown MAC encoding "+_+" as ASCII")}var M="p"+m+","+v.toString(16);l[M]==null&&(l[M]={}),l[M][A!==void 0?A:g]=y,l[M]._lang=v}for(var T in l)if(l[T].postScriptName!=null&&l[T]._lang==1033)return l[T];for(var T in l)if(l[T].postScriptName!=null&&l[T]._lang==0)return l[T];for(var T in l)if(l[T].postScriptName!=null&&l[T]._lang==3084)return l[T];for(var T in l)if(l[T].postScriptName!=null)return l[T];for(var T in l){u=T;break}return console.debug("returning name table with languageID "+l[u]._lang),l[u]},e["OS/2"]={},e["OS/2"].parse=function(r,s,o){var a=e._bin.readUshort(r,s);s+=2;var l={};if(a==0)e["OS/2"].version0(r,s,l);else if(a==1)e["OS/2"].version1(r,s,l);else if(a==2||a==3||a==4)e["OS/2"].version2(r,s,l);else{if(a!=5)throw"unknown OS/2 table version: "+a;e["OS/2"].version5(r,s,l)}return l},e["OS/2"].version0=function(r,s,o){var a=e._bin;return o.xAvgCharWidth=a.readShort(r,s),s+=2,o.usWeightClass=a.readUshort(r,s),s+=2,o.usWidthClass=a.readUshort(r,s),s+=2,o.fsType=a.readUshort(r,s),s+=2,o.ySubscriptXSize=a.readShort(r,s),s+=2,o.ySubscriptYSize=a.readShort(r,s),s+=2,o.ySubscriptXOffset=a.readShort(r,s),s+=2,o.ySubscriptYOffset=a.readShort(r,s),s+=2,o.ySuperscriptXSize=a.readShort(r,s),s+=2,o.ySuperscriptYSize=a.readShort(r,s),s+=2,o.ySuperscriptXOffset=a.readShort(r,s),s+=2,o.ySuperscriptYOffset=a.readShort(r,s),s+=2,o.yStrikeoutSize=a.readShort(r,s),s+=2,o.yStrikeoutPosition=a.readShort(r,s),s+=2,o.sFamilyClass=a.readShort(r,s),s+=2,o.panose=a.readBytes(r,s,10),s+=10,o.ulUnicodeRange1=a.readUint(r,s),s+=4,o.ulUnicodeRange2=a.readUint(r,s),s+=4,o.ulUnicodeRange3=a.readUint(r,s),s+=4,o.ulUnicodeRange4=a.readUint(r,s),s+=4,o.achVendID=[a.readInt8(r,s),a.readInt8(r,s+1),a.readInt8(r,s+2),a.readInt8(r,s+3)],s+=4,o.fsSelection=a.readUshort(r,s),s+=2,o.usFirstCharIndex=a.readUshort(r,s),s+=2,o.usLastCharIndex=a.readUshort(r,s),s+=2,o.sTypoAscender=a.readShort(r,s),s+=2,o.sTypoDescender=a.readShort(r,s),s+=2,o.sTypoLineGap=a.readShort(r,s),s+=2,o.usWinAscent=a.readUshort(r,s),s+=2,o.usWinDescent=a.readUshort(r,s),s+=2},e["OS/2"].version1=function(r,s,o){var a=e._bin;return s=e["OS/2"].version0(r,s,o),o.ulCodePageRange1=a.readUint(r,s),s+=4,o.ulCodePageRange2=a.readUint(r,s),s+=4},e["OS/2"].version2=function(r,s,o){var a=e._bin;return s=e["OS/2"].version1(r,s,o),o.sxHeight=a.readShort(r,s),s+=2,o.sCapHeight=a.readShort(r,s),s+=2,o.usDefault=a.readUshort(r,s),s+=2,o.usBreak=a.readUshort(r,s),s+=2,o.usMaxContext=a.readUshort(r,s),s+=2},e["OS/2"].version5=function(r,s,o){var a=e._bin;return s=e["OS/2"].version2(r,s,o),o.usLowerOpticalPointSize=a.readUshort(r,s),s+=2,o.usUpperOpticalPointSize=a.readUshort(r,s),s+=2},e.post={},e.post.parse=function(r,s,o){var a=e._bin,l={};return l.version=a.readFixed(r,s),s+=4,l.italicAngle=a.readFixed(r,s),s+=4,l.underlinePosition=a.readShort(r,s),s+=2,l.underlineThickness=a.readShort(r,s),s+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(r,s){var o=r.cmap,a=-1;if(o.p0e4!=null?a=o.p0e4:o.p3e1!=null?a=o.p3e1:o.p1e0!=null?a=o.p1e0:o.p0e3!=null&&(a=o.p0e3),a==-1)throw"no familiar platform and encoding!";var l=o.tables[a];if(l.format==0)return s>=l.map.length?0:l.map[s];if(l.format==4){for(var c=-1,u=0;u<l.endCount.length;u++)if(s<=l.endCount[u]){c=u;break}return c==-1||l.startCount[c]>s?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[s-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:s+l.idDelta[c])}if(l.format==12){if(s>l.groups[l.groups.length-1][1])return 0;for(u=0;u<l.groups.length;u++){var h=l.groups[u];if(h[0]<=s&&s<=h[1])return h[2]+(s-h[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(r,s){var o={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[s]){var a=r.SVG.entries[s];return a==null?o:(typeof a=="string"&&(a=e.SVG.toPath(a),r.SVG.entries[s]=a),a)}if(r.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},c=r.CFF,u=r.CFF.Private;if(c.ROS){for(var h=0;c.FDSelect[h+2]<=s;)h+=2;u=c.FDArray[c.FDSelect[h+1]].Private}e.U._drawCFF(r.CFF.CharStrings[s],l,c,u,o)}else r.glyf&&e.U._drawGlyf(s,r,o);return o},e.U._drawGlyf=function(r,s,o){var a=s.glyf[r];a==null&&(a=s.glyf[r]=e.glyf._parseGlyf(s,r)),a!=null&&(a.noc>-1?e.U._simpleGlyph(a,o):e.U._compoGlyph(a,s,o))},e.U._simpleGlyph=function(r,s){for(var o=0;o<r.noc;o++){for(var a=o==0?0:r.endPts[o-1]+1,l=r.endPts[o],c=a;c<=l;c++){var u=c==a?l:c-1,h=c==l?a:c+1,d=1&r.flags[c],f=1&r.flags[u],m=1&r.flags[h],_=r.xs[c],v=r.ys[c];if(c==a)if(d){if(!f){e.U.P.moveTo(s,_,v);continue}e.U.P.moveTo(s,r.xs[u],r.ys[u])}else f?e.U.P.moveTo(s,r.xs[u],r.ys[u]):e.U.P.moveTo(s,(r.xs[u]+_)/2,(r.ys[u]+v)/2);d?f&&e.U.P.lineTo(s,_,v):m?e.U.P.qcurveTo(s,_,v,r.xs[h],r.ys[h]):e.U.P.qcurveTo(s,_,v,(_+r.xs[h])/2,(v+r.ys[h])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(r,s,o){for(var a=0;a<r.parts.length;a++){var l={cmds:[],crds:[]},c=r.parts[a];e.U._drawGlyf(c.glyphIndex,s,l);for(var u=c.m,h=0;h<l.crds.length;h+=2){var d=l.crds[h],f=l.crds[h+1];o.crds.push(d*u.a+f*u.b+u.tx),o.crds.push(d*u.c+f*u.d+u.ty)}for(h=0;h<l.cmds.length;h++)o.cmds.push(l.cmds[h])}},e.U._getGlyphClass=function(r,s){var o=e._lctf.getInterval(s,r);return o==-1?0:s[o+2]},e.U._applySubs=function(r,s,o,a){for(var l=r.length-s-1,c=0;c<o.tabs.length;c++)if(o.tabs[c]!=null){var u,h=o.tabs[c];if(!h.coverage||(u=e._lctf.coverageIndex(h.coverage,r[s]))!=-1){if(o.ltype==1)r[s],h.fmt==1?r[s]=r[s]+h.delta:r[s]=h.newg[u];else if(o.ltype==4)for(var d=h.vals[u],f=0;f<d.length;f++){var m=d[f],_=m.chain.length;if(!(_>l)){for(var v=!0,g=0,b=0;b<_;b++){for(;r[s+g+(1+b)]==-1;)g++;m.chain[b]!=r[s+g+(1+b)]&&(v=!1)}if(v){for(r[s]=m.nglyph,b=0;b<_+g;b++)r[s+b+1]=-1;break}}}else if(o.ltype==5&&h.fmt==2)for(var p=e._lctf.getInterval(h.cDef,r[s]),y=h.cDef[p+2],A=h.scset[y],w=0;w<A.length;w++){var M=A[w],T=M.input;if(!(T.length>l)){for(v=!0,b=0;b<T.length;b++){var E=e._lctf.getInterval(h.cDef,r[s+1+b]);if(p==-1&&h.cDef[E+2]!=T[b]){v=!1;break}}if(v){var C=M.substLookupRecords;for(f=0;f<C.length;f+=2)C[f],C[f+1]}}}else if(o.ltype==6&&h.fmt==3){if(!e.U._glsCovered(r,h.backCvg,s-h.backCvg.length)||!e.U._glsCovered(r,h.inptCvg,s)||!e.U._glsCovered(r,h.ahedCvg,s+h.inptCvg.length))continue;var N=h.lookupRec;for(w=0;w<N.length;w+=2){p=N[w];var P=a[N[w+1]];e.U._applySubs(r,s+p,P,a)}}}}},e.U._glsCovered=function(r,s,o){for(var a=0;a<s.length;a++)if(e._lctf.coverageIndex(s[a],r[o+a])==-1)return!1;return!0},e.U.glyphsToPath=function(r,s,o){for(var a={cmds:[],crds:[]},l=0,c=0;c<s.length;c++){var u=s[c];if(u!=-1){for(var h=c<s.length-1&&s[c+1]!=-1?s[c+1]:0,d=e.U.glyphToPath(r,u),f=0;f<d.crds.length;f+=2)a.crds.push(d.crds[f]+l),a.crds.push(d.crds[f+1]);for(o&&a.cmds.push(o),f=0;f<d.cmds.length;f++)a.cmds.push(d.cmds[f]);o&&a.cmds.push("X"),l+=r.hmtx.aWidth[u],c<s.length-1&&(l+=e.U.getPairAdjustment(r,u,h))}}return a},e.U.P={},e.U.P.moveTo=function(r,s,o){r.cmds.push("M"),r.crds.push(s,o)},e.U.P.lineTo=function(r,s,o){r.cmds.push("L"),r.crds.push(s,o)},e.U.P.curveTo=function(r,s,o,a,l,c,u){r.cmds.push("C"),r.crds.push(s,o,a,l,c,u)},e.U.P.qcurveTo=function(r,s,o,a,l){r.cmds.push("Q"),r.crds.push(s,o,a,l)},e.U.P.closePath=function(r){r.cmds.push("Z")},e.U._drawCFF=function(r,s,o,a,l){for(var c=s.stack,u=s.nStems,h=s.haveWidth,d=s.width,f=s.open,m=0,_=s.x,v=s.y,g=0,b=0,p=0,y=0,A=0,w=0,M=0,T=0,E=0,C=0,N={val:0,size:0};m<r.length;){e.CFF.getCharString(r,m,N);var P=N.val;if(m+=N.size,P=="o1"||P=="o18")c.length%2!=0&&!h&&(d=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(P=="o3"||P=="o23")c.length%2!=0&&!h&&(d=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0;else if(P=="o4")c.length>1&&!h&&(d=c.shift()+a.nominalWidthX,h=!0),f&&e.U.P.closePath(l),v+=c.pop(),e.U.P.moveTo(l,_,v),f=!0;else if(P=="o5")for(;c.length>0;)_+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,_,v);else if(P=="o6"||P=="o7")for(var L=c.length,R=P=="o6",F=0;F<L;F++){var V=c.shift();R?_+=V:v+=V,R=!R,e.U.P.lineTo(l,_,v)}else if(P=="o8"||P=="o24"){L=c.length;for(var z=0;z+6<=L;)g=_+c.shift(),b=v+c.shift(),p=g+c.shift(),y=b+c.shift(),_=p+c.shift(),v=y+c.shift(),e.U.P.curveTo(l,g,b,p,y,_,v),z+=6;P=="o24"&&(_+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,_,v))}else{if(P=="o11")break;if(P=="o1234"||P=="o1235"||P=="o1236"||P=="o1237")P=="o1234"&&(b=v,p=(g=_+c.shift())+c.shift(),C=y=b+c.shift(),w=y,T=v,_=(M=(A=(E=p+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,g,b,p,y,E,C),e.U.P.curveTo(l,A,w,M,T,_,v)),P=="o1235"&&(g=_+c.shift(),b=v+c.shift(),p=g+c.shift(),y=b+c.shift(),E=p+c.shift(),C=y+c.shift(),A=E+c.shift(),w=C+c.shift(),M=A+c.shift(),T=w+c.shift(),_=M+c.shift(),v=T+c.shift(),c.shift(),e.U.P.curveTo(l,g,b,p,y,E,C),e.U.P.curveTo(l,A,w,M,T,_,v)),P=="o1236"&&(g=_+c.shift(),b=v+c.shift(),p=g+c.shift(),C=y=b+c.shift(),w=y,M=(A=(E=p+c.shift())+c.shift())+c.shift(),T=w+c.shift(),_=M+c.shift(),e.U.P.curveTo(l,g,b,p,y,E,C),e.U.P.curveTo(l,A,w,M,T,_,v)),P=="o1237"&&(g=_+c.shift(),b=v+c.shift(),p=g+c.shift(),y=b+c.shift(),E=p+c.shift(),C=y+c.shift(),A=E+c.shift(),w=C+c.shift(),M=A+c.shift(),T=w+c.shift(),Math.abs(M-_)>Math.abs(T-v)?_=M+c.shift():v=T+c.shift(),e.U.P.curveTo(l,g,b,p,y,E,C),e.U.P.curveTo(l,A,w,M,T,_,v));else if(P=="o14"){if(c.length>0&&!h&&(d=c.shift()+o.nominalWidthX,h=!0),c.length==4){var U=c.shift(),G=c.shift(),B=c.shift(),D=c.shift(),O=e.CFF.glyphBySE(o,B),j=e.CFF.glyphBySE(o,D);e.U._drawCFF(o.CharStrings[O],s,o,a,l),s.x=U,s.y=G,e.U._drawCFF(o.CharStrings[j],s,o,a,l)}f&&(e.U.P.closePath(l),f=!1)}else if(P=="o19"||P=="o20")c.length%2!=0&&!h&&(d=c.shift()+a.nominalWidthX),u+=c.length>>1,c.length=0,h=!0,m+=u+7>>3;else if(P=="o21")c.length>2&&!h&&(d=c.shift()+a.nominalWidthX,h=!0),v+=c.pop(),_+=c.pop(),f&&e.U.P.closePath(l),e.U.P.moveTo(l,_,v),f=!0;else if(P=="o22")c.length>1&&!h&&(d=c.shift()+a.nominalWidthX,h=!0),_+=c.pop(),f&&e.U.P.closePath(l),e.U.P.moveTo(l,_,v),f=!0;else if(P=="o25"){for(;c.length>6;)_+=c.shift(),v+=c.shift(),e.U.P.lineTo(l,_,v);g=_+c.shift(),b=v+c.shift(),p=g+c.shift(),y=b+c.shift(),_=p+c.shift(),v=y+c.shift(),e.U.P.curveTo(l,g,b,p,y,_,v)}else if(P=="o26")for(c.length%2&&(_+=c.shift());c.length>0;)g=_,b=v+c.shift(),_=p=g+c.shift(),v=(y=b+c.shift())+c.shift(),e.U.P.curveTo(l,g,b,p,y,_,v);else if(P=="o27")for(c.length%2&&(v+=c.shift());c.length>0;)b=v,p=(g=_+c.shift())+c.shift(),y=b+c.shift(),_=p+c.shift(),v=y,e.U.P.curveTo(l,g,b,p,y,_,v);else if(P=="o10"||P=="o29"){var q=P=="o10"?a:o;if(c.length==0)console.debug("error: empty stack");else{var Y=c.pop(),ie=q.Subrs[Y+q.Bias];s.x=_,s.y=v,s.nStems=u,s.haveWidth=h,s.width=d,s.open=f,e.U._drawCFF(ie,s,o,a,l),_=s.x,v=s.y,u=s.nStems,h=s.haveWidth,d=s.width,f=s.open}}else if(P=="o30"||P=="o31"){var ne=c.length,Q=(z=0,P=="o31");for(z+=ne-(L=-3&ne);z<L;)Q?(b=v,p=(g=_+c.shift())+c.shift(),v=(y=b+c.shift())+c.shift(),L-z==5?(_=p+c.shift(),z++):_=p,Q=!1):(g=_,b=v+c.shift(),p=g+c.shift(),y=b+c.shift(),_=p+c.shift(),L-z==5?(v=y+c.shift(),z++):v=y,Q=!0),e.U.P.curveTo(l,g,b,p,y,_,v),z+=4}else{if((P+"").charAt(0)=="o")throw console.debug("Unknown operation: "+P,r),P;c.push(P)}}}s.x=_,s.y=v,s.nStems=u,s.haveWidth=h,s.width=d,s.open=f};var t=e,n={Typr:t};return i.Typr=t,i.default=n,Object.defineProperty(i,"__esModule",{value:!0}),i}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function $J(){return function(i){var e=Uint8Array,t=Uint16Array,n=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(P,L){for(var R=new t(31),F=0;F<31;++F)R[F]=L+=1<<P[F-1];var V=new n(R[30]);for(F=1;F<30;++F)for(var z=R[F];z<R[F+1];++z)V[z]=z-R[F]<<5|F;return[R,V]},l=a(r,2),c=l[0],u=l[1];c[28]=258,u[258]=28;for(var h=a(s,0)[0],d=new t(32768),f=0;f<32768;++f){var m=(43690&f)>>>1|(21845&f)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,d[f]=((65280&m)>>>8|(255&m)<<8)>>>1}var _=function(P,L,R){for(var F=P.length,V=0,z=new t(L);V<F;++V)++z[P[V]-1];var U,G=new t(L);for(V=0;V<L;++V)G[V]=G[V-1]+z[V-1]<<1;{U=new t(1<<L);var B=15-L;for(V=0;V<F;++V)if(P[V])for(var D=V<<4|P[V],O=L-P[V],j=G[P[V]-1]++<<O,q=j|(1<<O)-1;j<=q;++j)U[d[j]>>>B]=D}return U},v=new e(288);for(f=0;f<144;++f)v[f]=8;for(f=144;f<256;++f)v[f]=9;for(f=256;f<280;++f)v[f]=7;for(f=280;f<288;++f)v[f]=8;var g=new e(32);for(f=0;f<32;++f)g[f]=5;var b=_(v,9),p=_(g,5),y=function(P){for(var L=P[0],R=1;R<P.length;++R)P[R]>L&&(L=P[R]);return L},A=function(P,L,R){var F=L/8|0;return(P[F]|P[F+1]<<8)>>(7&L)&R},w=function(P,L){var R=L/8|0;return(P[R]|P[R+1]<<8|P[R+2]<<16)>>(7&L)},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(P,L,R){var F=new Error(L||M[P]);if(F.code=P,Error.captureStackTrace&&Error.captureStackTrace(F,T),!R)throw F;return F},E=function(P,L,R){var F=P.length;if(!F||R&&!R.l&&F<5)return L||new e(0);var V=!L||R,z=!R||R.i;R||(R={}),L||(L=new e(3*F));var U,G=function(qe){var it=L.length;if(qe>it){var at=new e(Math.max(2*it,qe));at.set(L),L=at}},B=R.f||0,D=R.p||0,O=R.b||0,j=R.l,q=R.d,Y=R.m,ie=R.n,ne=8*F;do{if(!j){R.f=B=A(P,D,1);var Q=A(P,D+1,3);if(D+=3,!Q){var le=P[(J=((U=D)/8|0)+(7&U&&1)+4)-4]|P[J-3]<<8,se=J+le;if(se>F){z&&T(0);break}V&&G(O+le),L.set(P.subarray(J,se),O),R.b=O+=le,R.p=D=8*se;continue}if(Q==1)j=b,q=p,Y=9,ie=5;else if(Q==2){var oe=A(P,D,31)+257,$=A(P,D+10,15)+4,pe=oe+A(P,D+5,31)+1;D+=14;for(var xe=new e(pe),Pe=new e(19),ve=0;ve<$;++ve)Pe[o[ve]]=A(P,D+3*ve,7);D+=3*$;var Ue=y(Pe),Le=(1<<Ue)-1,Z=_(Pe,Ue);for(ve=0;ve<pe;){var J,de=Z[A(P,D,Le)];if(D+=15&de,(J=de>>>4)<16)xe[ve++]=J;else{var Ie=0,te=0;for(J==16?(te=3+A(P,D,3),D+=2,Ie=xe[ve-1]):J==17?(te=3+A(P,D,7),D+=3):J==18&&(te=11+A(P,D,127),D+=7);te--;)xe[ve++]=Ie}}var X=xe.subarray(0,oe),ye=xe.subarray(oe);Y=y(X),ie=y(ye),j=_(X,Y),q=_(ye,ie)}else T(1);if(D>ne){z&&T(0);break}}V&&G(O+131072);for(var ke=(1<<Y)-1,ge=(1<<ie)-1,De=D;;De=D){var $e=(Ie=j[w(P,D)&ke])>>>4;if((D+=15&Ie)>ne){z&&T(0);break}if(Ie||T(2),$e<256)L[O++]=$e;else{if($e==256){De=D,j=null;break}var Ae=$e-254;if($e>264){var Ze=r[ve=$e-257];Ae=A(P,D,(1<<Ze)-1)+c[ve],D+=Ze}var nt=q[w(P,D)&ge],rt=nt>>>4;if(nt||T(3),D+=15&nt,ye=h[rt],rt>3&&(Ze=s[rt],ye+=w(P,D)&(1<<Ze)-1,D+=Ze),D>ne){z&&T(0);break}V&&G(O+131072);for(var Oe=O+Ae;O<Oe;O+=4)L[O]=L[O-ye],L[O+1]=L[O+1-ye],L[O+2]=L[O+2-ye],L[O+3]=L[O+3-ye];O=Oe}}R.l=j,R.p=De,R.b=O,j&&(B=1,R.m=Y,R.d=q,R.n=ie)}while(!B);return O==L.length?L:function(qe,it,at){(at==null||at>qe.length)&&(at=qe.length);var ht=new(qe instanceof t?t:qe instanceof n?n:e)(at-it);return ht.set(qe.subarray(it,at)),ht}(L,0,O)},C=new e(0),N=typeof TextDecoder<"u"&&new TextDecoder;try{N.decode(C,{stream:!0})}catch{}return i.convert_streams=function(P){var L=new DataView(P),R=0;function F(){var oe=L.getUint16(R);return R+=2,oe}function V(){var oe=L.getUint32(R);return R+=4,oe}function z(oe){le.setUint16(se,oe),se+=2}function U(oe){le.setUint32(se,oe),se+=4}for(var G={signature:V(),flavor:V(),length:V(),numTables:F(),reserved:F(),totalSfntSize:V(),majorVersion:F(),minorVersion:F(),metaOffset:V(),metaLength:V(),metaOrigLength:V(),privOffset:V(),privLength:V()},B=0;Math.pow(2,B)<=G.numTables;)B++;B--;for(var D=16*Math.pow(2,B),O=16*G.numTables-D,j=12,q=[],Y=0;Y<G.numTables;Y++)q.push({tag:V(),offset:V(),compLength:V(),origLength:V(),origChecksum:V()}),j+=16;var ie,ne=new Uint8Array(12+16*q.length+q.reduce(function(oe,$){return oe+$.origLength+4},0)),Q=ne.buffer,le=new DataView(Q),se=0;return U(G.flavor),z(G.numTables),z(D),z(B),z(O),q.forEach(function(oe){U(oe.tag),U(oe.origChecksum),U(j),U(oe.origLength),oe.outOffset=j,(j+=oe.origLength)%4!=0&&(j+=4-j%4)}),q.forEach(function(oe){var $,pe=P.slice(oe.offset,oe.offset+oe.compLength);if(oe.compLength!=oe.origLength){var xe=new Uint8Array(oe.origLength);$=new Uint8Array(pe,2),E($,xe)}else xe=new Uint8Array(pe);ne.set(xe,oe.outOffset);var Pe=0;(j=oe.outOffset+oe.origLength)%4!=0&&(Pe=4-j%4),ne.set(new Uint8Array(Pe).buffer,oe.outOffset+oe.origLength),ie=j+Pe}),Q.slice(0,ie)},Object.defineProperty(i,"__esModule",{value:!0}),i}({}).convert_streams}function WJ(i,e){const t={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,s=2,o=4,a=8,l=16,c=32;let u;function h(M){if(!u){const T={R:s,L:r,D:o,C:l,U:c,T:a};u=new Map;for(let E in n){let C=0;n[E].split(",").forEach(N=>{let[P,L]=N.split("+");P=parseInt(P,36),L=L?parseInt(L,36):0,u.set(C+=P,T[E]);for(let R=L;R--;)u.set(++C,T[E])})}}return u.get(M)||c}const d=1,f=2,m=3,_=4,v=[null,"isol","init","fina","medi"];function g(M){const T=new Uint8Array(M.length);let E=c,C=d,N=-1;for(let P=0;P<M.length;P++){const L=M.codePointAt(P);let R=h(L)|0,F=d;R&a||(E&(r|o|l)?R&(s|o|l)?(F=m,(C===d||C===m)&&T[N]++):R&(r|c)&&(C===f||C===_)&&T[N]--:E&(s|c)&&(C===f||C===_)&&T[N]--,C=T[P]=F,E=R,N=P,L>65535&&P++)}return T}function b(M,T){const E=[];for(let N=0;N<T.length;N++){const P=T.codePointAt(N);P>65535&&N++,E.push(i.U.codeToGlyph(M,P))}const C=M.GSUB;if(C){const{lookupList:N,featureList:P}=C;let L;const R=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,F=[];P.forEach(V=>{if(R.test(V.tag))for(let z=0;z<V.tab.length;z++){if(F[V.tab[z]])continue;F[V.tab[z]]=!0;const U=N[V.tab[z]],G=/^(isol|init|fina|medi)$/.test(V.tag);G&&!L&&(L=g(T));for(let B=0;B<E.length;B++)(!L||!G||v[L[B]]===V.tag)&&i.U._applySubs(E,B,U,N)}})}return E}function p(M,T){const E=new Int16Array(T.length*3);let C=0;for(;C<T.length;C++){const R=T[C];if(R===-1)continue;E[C*3+2]=M.hmtx.aWidth[R];const F=M.GPOS;if(F){const V=F.lookupList;for(let z=0;z<V.length;z++){const U=V[z];for(let G=0;G<U.tabs.length;G++){const B=U.tabs[G];if(U.ltype===1){if(i._lctf.coverageIndex(B.coverage,R)!==-1&&B.pos){L(B.pos,C);break}}else if(U.ltype===2){let D=null,O=N();if(O!==-1){const j=i._lctf.coverageIndex(B.coverage,T[O]);if(j!==-1){if(B.fmt===1){const q=B.pairsets[j];for(let Y=0;Y<q.length;Y++)q[Y].gid2===R&&(D=q[Y])}else if(B.fmt===2){const q=i.U._getGlyphClass(T[O],B.classDef1),Y=i.U._getGlyphClass(R,B.classDef2);D=B.matrix[q][Y]}if(D){D.val1&&L(D.val1,O),D.val2&&L(D.val2,C);break}}}}else if(U.ltype===4){const D=i._lctf.coverageIndex(B.markCoverage,R);if(D!==-1){const O=N(P),j=O===-1?-1:i._lctf.coverageIndex(B.baseCoverage,T[O]);if(j!==-1){const q=B.markArray[D],Y=B.baseArray[j][q.markClass];E[C*3]=Y.x-q.x+E[O*3]-E[O*3+2],E[C*3+1]=Y.y-q.y+E[O*3+1];break}}}else if(U.ltype===6){const D=i._lctf.coverageIndex(B.mark1Coverage,R);if(D!==-1){const O=N();if(O!==-1){const j=T[O];if(y(M,j)===3){const q=i._lctf.coverageIndex(B.mark2Coverage,j);if(q!==-1){const Y=B.mark1Array[D],ie=B.mark2Array[q][Y.markClass];E[C*3]=ie.x-Y.x+E[O*3]-E[O*3+2],E[C*3+1]=ie.y-Y.y+E[O*3+1];break}}}}}}}}else if(M.kern&&!M.cff){const V=N();if(V!==-1){const z=M.kern.glyph1.indexOf(T[V]);if(z!==-1){const U=M.kern.rval[z].glyph2.indexOf(R);U!==-1&&(E[V*3+2]+=M.kern.rval[z].vals[U])}}}}return E;function N(R){for(let F=C-1;F>=0;F--)if(T[F]!==-1&&(!R||R(T[F])))return F;return-1}function P(R){return y(M,R)===1}function L(R,F){for(let V=0;V<3;V++)E[F*3+V]+=R[V]||0}}function y(M,T){const E=M.GDEF&&M.GDEF.glyphClassDef;return E?i.U._getGlyphClass(T,E):0}function A(...M){for(let T=0;T<M.length;T++)if(typeof M[T]=="number")return M[T]}function w(M){const T=Object.create(null),E=M["OS/2"],C=M.hhea,N=M.head.unitsPerEm,P=A(E&&E.sTypoAscender,C&&C.ascender,N),L={unitsPerEm:N,ascender:P,descender:A(E&&E.sTypoDescender,C&&C.descender,0),capHeight:A(E&&E.sCapHeight,P),xHeight:A(E&&E.sxHeight,P),lineGap:A(E&&E.sTypoLineGap,C&&C.lineGap),supportsCodePoint(R){return i.U.codeToGlyph(M,R)>0},forEachGlyph(R,F,V,z){let U=0;const G=1/L.unitsPerEm*F,B=b(M,R);let D=0;const O=p(M,B);return B.forEach((j,q)=>{if(j!==-1){let Y=T[j];if(!Y){const{cmds:ie,crds:ne}=i.U.glyphToPath(M,j);let Q="",le=0;for(let xe=0,Pe=ie.length;xe<Pe;xe++){const ve=t[ie[xe]];Q+=ie[xe];for(let Ue=1;Ue<=ve;Ue++)Q+=(Ue>1?",":"")+ne[le++]}let se,oe,$,pe;if(ne.length){se=oe=1/0,$=pe=-1/0;for(let xe=0,Pe=ne.length;xe<Pe;xe+=2){let ve=ne[xe],Ue=ne[xe+1];ve<se&&(se=ve),Ue<oe&&(oe=Ue),ve>$&&($=ve),Ue>pe&&(pe=Ue)}}else se=$=oe=pe=0;Y=T[j]={index:j,advanceWidth:M.hmtx.aWidth[j],xMin:se,yMin:oe,xMax:$,yMax:pe,path:Q}}z.call(null,Y,U+O[q*3]*G,O[q*3+1]*G,D),U+=O[q*3+2]*G,V&&(U+=V*F)}D+=R.codePointAt(D)>65535?2:1}),U}};return L}return function(T){const E=new Uint8Array(T,0,4),C=i._bin.readASCII(E,0,4);if(C==="wOFF")T=e(T);else if(C==="wOF2")throw new Error("woff2 fonts not supported");return w(i.parse(T)[0])}}const jJ=nm({name:"Typr Font Parser",dependencies:[HJ,$J,WJ],init(i,e,t){const n=i(),r=e();return t(n,r)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function XJ(){return function(i){var e=function(){this.buckets=new Map};e.prototype.add=function(p){var y=p>>5;this.buckets.set(y,(this.buckets.get(y)||0)|1<<(31&p))},e.prototype.has=function(p){var y=this.buckets.get(p>>5);return y!==void 0&&(y&1<<(31&p))!=0},e.prototype.serialize=function(){var p=[];return this.buckets.forEach(function(y,A){p.push((+A).toString(36)+":"+y.toString(36))}),p.join(",")},e.prototype.deserialize=function(p){var y=this;this.buckets.clear(),p.split(",").forEach(function(A){var w=A.split(":");y.buckets.set(parseInt(w[0],36),parseInt(w[1],36))})};var t=Math.pow(2,8),n=t-1,r=~n;function s(p){var y=function(w){return w&r}(p).toString(16),A=function(w){return(w&r)+t-1}(p).toString(16);return"codepoint-index/plane"+(p>>16)+"/"+y+"-"+A+".json"}function o(p,y){var A=p&n,w=y.codePointAt(A/6|0);return((w=(w||48)-48)&1<<A%6)!=0}function a(p,y){var A;(A=p,A.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(w){return w.split("-").map(function(M){return parseInt(M.trim(),16)})})).forEach(function(w){var M=w[0],T=w[1];T===void 0&&(T=M),y(M,T)})}function l(p,y){a(p,function(A,w){for(var M=A;M<=w;M++)y(M)})}var c={},u={},h=new WeakMap,d="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function f(p){var y=h.get(p);return y||(y=new e,l(p.ranges,function(A){return y.add(A)}),h.set(p,y)),y}var m,_=new Map;function v(p,y,A){return p[y]?y:p[A]?A:function(w){for(var M in w)return M}(p)}function g(p,y){var A=y;if(!p.includes(A)){A=1/0;for(var w=0;w<p.length;w++)Math.abs(p[w]-y)<Math.abs(A-y)&&(A=p[w])}return A}function b(p){return m||(m=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(y){m.add(y)})),m.has(p)}return i.CodePointSet=e,i.clearCache=function(){c={},u={}},i.getFontsForString=function(p,y){y===void 0&&(y={});var A,w=y.lang;w===void 0&&(w=new RegExp("\\p{Script=Hangul}","u").test(A=p)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(A)?"ja":"en");var M=y.category;M===void 0&&(M="sans-serif");var T=y.style;T===void 0&&(T="normal");var E=y.weight;E===void 0&&(E=400);var C=(y.dataUrl||d).replace(/\/$/g,""),N=new Map,P=new Uint8Array(p.length),L={},R={},F=new Array(p.length),V=new Map,z=!1;function U(D){var O=_.get(D);return O||(O=fetch(C+"/"+D).then(function(j){if(!j.ok)throw new Error(j.statusText);return j.json().then(function(q){if(!Array.isArray(q)||q[0]!==1)throw new Error("Incorrect schema version; need 1, got "+q[0]);return q[1]})}).catch(function(j){if(C!==d)return z||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+C+'", trying default CDN. '+j.message),z=!0),C=d,_.delete(D),U(D);throw j}),_.set(D,O)),O}for(var G=function(D){var O=p.codePointAt(D),j=s(O);F[D]=j,c[j]||V.has(j)||V.set(j,U(j).then(function(q){c[j]=q})),O>65535&&(D++,B=D)},B=0;B<p.length;B++)G(B);return Promise.all(V.values()).then(function(){V.clear();for(var D=function(j){var q=p.codePointAt(j),Y=null,ie=c[F[j]],ne=void 0;for(var Q in ie){var le=R[Q];if(le===void 0&&(le=R[Q]=new RegExp(Q).test(w||"en")),le){for(var se in ne=Q,ie[Q])if(o(q,ie[Q][se])){Y=se;break}break}}if(!Y){e:for(var oe in ie)if(oe!==ne){for(var $ in ie[oe])if(o(q,ie[oe][$])){Y=$;break e}}}Y||(console.debug("No font coverage for U+"+q.toString(16)),Y="latin"),F[j]=Y,u[Y]||V.has(Y)||V.set(Y,U("font-meta/"+Y+".json").then(function(pe){u[Y]=pe})),q>65535&&(j++,O=j)},O=0;O<p.length;O++)D(O);return Promise.all(V.values())}).then(function(){for(var D,O=null,j=0;j<p.length;j++){var q=p.codePointAt(j);if(O&&(b(q)||f(O).has(q)))P[j]=P[j-1];else{O=u[F[j]];var Y=L[O.id];if(!Y){var ie=O.typeforms,ne=v(ie,M,"sans-serif"),Q=v(ie[ne],T,"normal"),le=g((D=ie[ne])===null||D===void 0?void 0:D[Q],E);Y=L[O.id]=C+"/font-files/"+O.id+"/"+ne+"."+Q+"."+le+".woff"}var se=N.get(Y);se==null&&(se=N.size,N.set(Y,se)),P[j]=se}q>65535&&(j++,P[j]=P[j-1])}return{fontUrls:Array.from(N.keys()),chars:P}})},Object.defineProperty(i,"__esModule",{value:!0}),i}({})}function qJ(i,e){const t=Object.create(null),n=Object.create(null);function r(o,a){const l=c=>{console.error(`Failure loading font ${o}`,c)};try{const c=new XMLHttpRequest;c.open("get",o,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)l(new Error(c.statusText));else if(c.status>0)try{const u=i(c.response);u.src=o,a(u)}catch(u){l(u)}},c.onerror=l,c.send()}catch(c){l(c)}}function s(o,a){let l=t[o];l?a(l):n[o]?n[o].push(a):(n[o]=[a],r(o,c=>{c.src=o,t[o]=c,n[o].forEach(u=>u(c)),delete n[o]}))}return function(o,a,{lang:l,fonts:c=[],style:u="normal",weight:h="normal",unicodeFontsURL:d}={}){const f=new Uint8Array(o.length),m=[];o.length||b();const _=new Map,v=[];if(u!=="italic"&&(u="normal"),typeof h!="number"&&(h=h==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(y=>!y.lang||y.lang.test(l)).reverse(),c.length){let M=0;(function T(E=0){for(let C=E,N=o.length;C<N;C++){const P=o.codePointAt(C);if(M===1&&m[f[C-1]].supportsCodePoint(P)||C>0&&/\s/.test(o[C]))f[C]=f[C-1],M===2&&(v[v.length-1][1]=C);else for(let L=f[C],R=c.length;L<=R;L++)if(L===R){const F=M===2?v[v.length-1]:v[v.length]=[C,C];F[1]=C,M=2}else{f[C]=L;const{src:F,unicodeRange:V}=c[L];if(!V||p(P,V)){const z=t[F];if(!z){s(F,()=>{T(C)});return}if(z.supportsCodePoint(P)){let U=_.get(z);typeof U!="number"&&(U=m.length,m.push(z),_.set(z,U)),f[C]=U,M=1;break}}}P>65535&&C+1<N&&(f[C+1]=f[C],C++,M===2&&(v[v.length-1][1]=C))}g()})()}else v.push([0,o.length-1]),g();function g(){if(v.length){const y=v.map(A=>o.substring(A[0],A[1]+1)).join(`
`);e.getFontsForString(y,{lang:l||void 0,style:u,weight:h,dataUrl:d}).then(({fontUrls:A,chars:w})=>{const M=m.length;let T=0;v.forEach(C=>{for(let N=0,P=C[1]-C[0];N<=P;N++)f[C[0]+N]=w[T++]+M;T++});let E=0;A.forEach((C,N)=>{s(C,P=>{m[N+M]=P,++E===A.length&&b()})})})}else b()}function b(){a({chars:f,fonts:m})}function p(y,A){for(let w=0;w<A.length;w++){const[M,T=M]=A[w];if(M<=y&&y<=T)return!0}return!1}}}const YJ=nm({name:"FontResolver",dependencies:[qJ,jJ,XJ],init(i,e,t){return i(e,t())}});function KJ(i,e){const n=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,r="[^\\S\\u00A0]",s=new RegExp(`${r}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:m,lang:_,fonts:v,style:g,weight:b,preResolvedFonts:p,unicodeFontsURL:y},A){const w=({chars:M,fonts:T})=>{let E,C;const N=[];for(let P=0;P<M.length;P++)M[P]!==C?(C=M[P],N.push(E={start:P,end:P,fontObj:T[M[P]]})):E.end=P;A(N)};p?w(p):i(m,w,{lang:_,fonts:v,style:g,weight:b,unicodeFontsURL:y})}function a({text:m="",font:_,lang:v,sdfGlyphSize:g=64,fontSize:b=400,fontWeight:p=1,fontStyle:y="normal",letterSpacing:A=0,lineHeight:w="normal",maxWidth:M=1/0,direction:T,textAlign:E="left",textIndent:C=0,whiteSpace:N="normal",overflowWrap:P="normal",anchorX:L=0,anchorY:R=0,metricsOnly:F=!1,unicodeFontsURL:V,preResolvedFonts:z=null,includeCaretPositions:U=!1,chunkedBoundsSize:G=8192,colorRanges:B=null},D){const O=h(),j={fontLoad:0,typesetting:0};m.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),m=m.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),b=+b,A=+A,M=+M,w=w||"normal",C=+C,o({text:m,lang:v,style:y,weight:p,fonts:typeof _=="string"?[{src:_}]:_,unicodeFontsURL:V,preResolvedFonts:z},q=>{j.fontLoad=h()-O;const Y=isFinite(M);let ie=null,ne=null,Q=null,le=null,se=null,oe=null,$=null,pe=null,xe=0,Pe=0,ve=N!=="nowrap";const Ue=new Map,Le=h();let Z=C,J=0,de=new d;const Ie=[de];q.forEach(ge=>{const{fontObj:De}=ge,{ascender:$e,descender:Ae,unitsPerEm:Ze,lineGap:nt,capHeight:rt,xHeight:Oe}=De;let qe=Ue.get(De);if(!qe){const je=b/Ze,ee=w==="normal"?($e-Ae+nt)*je:w*b,ze=(ee-($e-Ae)*je)/2,Ee=Math.min(ee,($e-Ae)*je),Re=($e+Ae)/2*je+Ee/2;qe={index:Ue.size,src:De.src,fontObj:De,fontSizeMult:je,unitsPerEm:Ze,ascender:$e*je,descender:Ae*je,capHeight:rt*je,xHeight:Oe*je,lineHeight:ee,baseline:-ze-$e*je,caretTop:Re,caretBottom:Re-Ee},Ue.set(De,qe)}const{fontSizeMult:it}=qe,at=m.slice(ge.start,ge.end+1);let ht,Qe;De.forEachGlyph(at,b,A,(je,ee,ze,Ee)=>{ee+=J,Ee+=ge.start,ht=ee,Qe=je;const Re=m.charAt(Ee),Xe=je.advanceWidth*it,gt=de.count;let _t;if("isEmpty"in je||(je.isWhitespace=!!Re&&new RegExp(r).test(Re),je.canBreakAfter=!!Re&&s.test(Re),je.isEmpty=je.xMin===je.xMax||je.yMin===je.yMax||n.test(Re)),!je.isWhitespace&&!je.isEmpty&&Pe++,ve&&Y&&!je.isWhitespace&&ee+Xe+Z>M&&gt){if(de.glyphAt(gt-1).glyphObj.canBreakAfter)_t=new d,Z=-ee;else for(let K=gt;K--;)if(K===0&&P==="break-word"){_t=new d,Z=-ee;break}else if(de.glyphAt(K).glyphObj.canBreakAfter){_t=de.splitAt(K+1);const ae=_t.glyphAt(0).x;Z-=ae;for(let ue=_t.count;ue--;)_t.glyphAt(ue).x-=ae;break}_t&&(de.isSoftWrapped=!0,de=_t,Ie.push(de),xe=M)}let Mt=de.glyphAt(de.count);Mt.glyphObj=je,Mt.x=ee+Z,Mt.y=ze,Mt.width=Xe,Mt.charIndex=Ee,Mt.fontData=qe,Re===`
`&&(de=new d,Ie.push(de),Z=-(ee+Xe+A*b)+C)}),J=ht+Qe.advanceWidth*it+A*b});let te=0;Ie.forEach(ge=>{let De=!0;for(let $e=ge.count;$e--;){const Ae=ge.glyphAt($e);De&&!Ae.glyphObj.isWhitespace&&(ge.width=Ae.x+Ae.width,ge.width>xe&&(xe=ge.width),De=!1);let{lineHeight:Ze,capHeight:nt,xHeight:rt,baseline:Oe}=Ae.fontData;Ze>ge.lineHeight&&(ge.lineHeight=Ze);const qe=Oe-ge.baseline;qe<0&&(ge.baseline+=qe,ge.cap+=qe,ge.ex+=qe),ge.cap=Math.max(ge.cap,ge.baseline+nt),ge.ex=Math.max(ge.ex,ge.baseline+rt)}ge.baseline-=te,ge.cap-=te,ge.ex-=te,te+=ge.lineHeight});let X=0,ye=0;if(L&&(typeof L=="number"?X=-L:typeof L=="string"&&(X=-xe*(L==="left"?0:L==="center"?.5:L==="right"?1:c(L)))),R&&(typeof R=="number"?ye=-R:typeof R=="string"&&(ye=R==="top"?0:R==="top-baseline"?-Ie[0].baseline:R==="top-cap"?-Ie[0].cap:R==="top-ex"?-Ie[0].ex:R==="middle"?te/2:R==="bottom"?te:R==="bottom-baseline"?-Ie[Ie.length-1].baseline:c(R)*te)),!F){const ge=e.getEmbeddingLevels(m,T);ie=new Uint16Array(Pe),ne=new Uint8Array(Pe),Q=new Float32Array(Pe*2),le={},$=[1/0,1/0,-1/0,-1/0],pe=[],U&&(oe=new Float32Array(m.length*4)),B&&(se=new Uint8Array(Pe*3));let De=0,$e=-1,Ae=-1,Ze,nt;if(Ie.forEach((rt,Oe)=>{let{count:qe,width:it}=rt;if(qe>0){let at=0;for(let Ee=qe;Ee--&&rt.glyphAt(Ee).glyphObj.isWhitespace;)at++;let ht=0,Qe=0;if(E==="center")ht=(xe-it)/2;else if(E==="right")ht=xe-it;else if(E==="justify"&&rt.isSoftWrapped){let Ee=0;for(let Re=qe-at;Re--;)rt.glyphAt(Re).glyphObj.isWhitespace&&Ee++;Qe=(xe-it)/Ee}if(Qe||ht){let Ee=0;for(let Re=0;Re<qe;Re++){let Xe=rt.glyphAt(Re);const gt=Xe.glyphObj;Xe.x+=ht+Ee,Qe!==0&&gt.isWhitespace&&Re<qe-at&&(Ee+=Qe,Xe.width+=Qe)}}const je=e.getReorderSegments(m,ge,rt.glyphAt(0).charIndex,rt.glyphAt(rt.count-1).charIndex);for(let Ee=0;Ee<je.length;Ee++){const[Re,Xe]=je[Ee];let gt=1/0,_t=-1/0;for(let Mt=0;Mt<qe;Mt++)if(rt.glyphAt(Mt).charIndex>=Re){let K=Mt,ae=Mt;for(;ae<qe;ae++){let ue=rt.glyphAt(ae);if(ue.charIndex>Xe)break;ae<qe-at&&(gt=Math.min(gt,ue.x),_t=Math.max(_t,ue.x+ue.width))}for(let ue=K;ue<ae;ue++){const _e=rt.glyphAt(ue);_e.x=_t-(_e.x+_e.width-gt)}break}}let ee;const ze=Ee=>ee=Ee;for(let Ee=0;Ee<qe;Ee++){const Re=rt.glyphAt(Ee);ee=Re.glyphObj;const Xe=ee.index,gt=ge.levels[Re.charIndex]&1;if(gt){const _t=e.getMirroredCharacter(m[Re.charIndex]);_t&&Re.fontData.fontObj.forEachGlyph(_t,0,0,ze)}if(U){const{charIndex:_t,fontData:Mt}=Re,K=Re.x+X,ae=Re.x+Re.width+X;oe[_t*4]=gt?ae:K,oe[_t*4+1]=gt?K:ae,oe[_t*4+2]=rt.baseline+Mt.caretBottom+ye,oe[_t*4+3]=rt.baseline+Mt.caretTop+ye;const ue=_t-$e;ue>1&&u(oe,$e,ue),$e=_t}if(B){const{charIndex:_t}=Re;for(;_t>Ae;)Ae++,B.hasOwnProperty(Ae)&&(nt=B[Ae])}if(!ee.isWhitespace&&!ee.isEmpty){const _t=De++,{fontSizeMult:Mt,src:K,index:ae}=Re.fontData,ue=le[K]||(le[K]={});ue[Xe]||(ue[Xe]={path:ee.path,pathBounds:[ee.xMin,ee.yMin,ee.xMax,ee.yMax]});const _e=Re.x+X,be=Re.y+rt.baseline+ye;Q[_t*2]=_e,Q[_t*2+1]=be;const Ne=_e+ee.xMin*Mt,Be=be+ee.yMin*Mt,He=_e+ee.xMax*Mt,lt=be+ee.yMax*Mt;Ne<$[0]&&($[0]=Ne),Be<$[1]&&($[1]=Be),He>$[2]&&($[2]=He),lt>$[3]&&($[3]=lt),_t%G===0&&(Ze={start:_t,end:_t,rect:[1/0,1/0,-1/0,-1/0]},pe.push(Ze)),Ze.end++;const mt=Ze.rect;if(Ne<mt[0]&&(mt[0]=Ne),Be<mt[1]&&(mt[1]=Be),He>mt[2]&&(mt[2]=He),lt>mt[3]&&(mt[3]=lt),ie[_t]=Xe,ne[_t]=ae,B){const wt=_t*3;se[wt]=nt>>16&255,se[wt+1]=nt>>8&255,se[wt+2]=nt&255}}}}}),oe){const rt=m.length-$e;rt>1&&u(oe,$e,rt)}}const ke=[];Ue.forEach(({index:ge,src:De,unitsPerEm:$e,ascender:Ae,descender:Ze,lineHeight:nt,capHeight:rt,xHeight:Oe})=>{ke[ge]={src:De,unitsPerEm:$e,ascender:Ae,descender:Ze,lineHeight:nt,capHeight:rt,xHeight:Oe}}),j.typesetting=h()-Le,D({glyphIds:ie,glyphFontIndices:ne,glyphPositions:Q,glyphData:le,fontData:ke,caretPositions:oe,glyphColors:se,chunkedBounds:pe,fontSize:b,topBaseline:ye+Ie[0].baseline,blockBounds:[X,ye-te,X+xe,ye],visibleBounds:$,timings:j})})}function l(m,_){a({...m,metricsOnly:!0},v=>{const[g,b,p,y]=v.blockBounds;_({width:p-g,height:y-b})})}function c(m){let _=m.match(/^([\d.]+)%$/),v=_?parseFloat(_[1]):NaN;return isNaN(v)?0:v/100}function u(m,_,v){const g=m[_*4],b=m[_*4+1],p=m[_*4+2],y=m[_*4+3],A=(b-g)/v;for(let w=0;w<v;w++){const M=(_+w)*4;m[M]=g+A*w,m[M+1]=g+A*(w+1),m[M+2]=p,m[M+3]=y}}function h(){return(self.performance||Date).now()}function d(){this.data=[]}const f=["glyphObj","x","y","width","charIndex","fontData"];return d.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/f.length)},glyphAt(m){let _=d.flyweight;return _.data=this.data,_.index=m,_},splitAt(m){let _=new d;return _.data=this.data.splice(m*f.length),_}},d.flyweight=f.reduce((m,_,v,g)=>(Object.defineProperty(m,_,{get(){return this.data[this.index*f.length+v]},set(b){this.data[this.index*f.length+v]=b}}),m),{data:null,index:0}),{typeset:a,measure:l}}const jh=()=>(self.performance||Date).now(),vS=D8();let jN;function ZJ(i,e,t,n,r,s,o,a,l,c,u=!0){return u?JJ(i,e,t,n,r,s,o,a,l,c).then(null,h=>(jN||(console.warn("WebGL SDF generation failed, falling back to JS",h),jN=!0),qN(i,e,t,n,r,s,o,a,l,c))):qN(i,e,t,n,r,s,o,a,l,c)}const lx=[],QJ=5;let UT=0;function F8(){const i=jh();for(;lx.length&&jh()-i<QJ;)lx.shift()();UT=lx.length?setTimeout(F8,0):0}const JJ=(...i)=>new Promise((e,t)=>{lx.push(()=>{const n=jh();try{vS.webgl.generateIntoCanvas(...i),e({timing:jh()-n})}catch(r){t(r)}}),UT||(UT=setTimeout(F8,0))}),eee=4,tee=2e3,XN={};let nee=0;function qN(i,e,t,n,r,s,o,a,l,c){const u="TroikaTextSDFGenerator_JS_"+nee++%eee;let h=XN[u];return h||(h=XN[u]={workerModule:nm({name:u,workerId:u,dependencies:[D8,jh],init(d,f){const m=d().javascript.generate;return function(..._){const v=f();return{textureData:m(..._),timing:f()-v}}},getTransferables(d){return[d.textureData.buffer]}}),requests:0,idleTimer:null}),h.requests++,clearTimeout(h.idleTimer),h.workerModule(i,e,t,n,r,s).then(({textureData:d,timing:f})=>{const m=jh(),_=new Uint8Array(d.length*4);for(let v=0;v<d.length;v++)_[v*4+c]=d[v];return vS.webglUtils.renderImageData(o,_,a,l,i,e,1<<3-c),f+=jh()-m,--h.requests===0&&(h.idleTimer=setTimeout(()=>{DJ(u)},tee)),{timing:f}})}function iee(i){i._warm||(vS.webgl.isSupported(i),i._warm=!0)}const ree=vS.webglUtils.resizeWebGLCanvasWithoutClearing,Eg={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},see=new kt;function df(){return(self.performance||Date).now()}const YN=Object.create(null);function k8(i,e){i=lee({},i);const t=df(),n=[];if(i.font&&n.push({label:"user",src:cee(i.font)}),i.font=n,i.text=""+i.text,i.sdfGlyphSize=i.sdfGlyphSize||Eg.sdfGlyphSize,i.unicodeFontsURL=i.unicodeFontsURL||Eg.unicodeFontsURL,i.colorRanges!=null){let d={};for(let f in i.colorRanges)if(i.colorRanges.hasOwnProperty(f)){let m=i.colorRanges[f];typeof m!="number"&&(m=see.set(m).getHex()),d[f]=m}i.colorRanges=d}Object.freeze(i);const{textureWidth:r,sdfExponent:s}=Eg,{sdfGlyphSize:o}=i,a=r/o*4;let l=YN[o];if(!l){const d=document.createElement("canvas");d.width=r,d.height=o*256/a,l=YN[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:d,sdfTexture:new Tr(d,void 0,void 0,void 0,Mi,Mi),contextLost:!1,glyphsByFont:new Map},l.sdfTexture.generateMipmaps=!1,oee(l)}const{sdfTexture:c,sdfCanvas:u}=l;B8(i).then(d=>{const{glyphIds:f,glyphFontIndices:m,fontData:_,glyphPositions:v,fontSize:g,timings:b}=d,p=[],y=new Float32Array(f.length*4);let A=0,w=0;const M=df(),T=_.map(L=>{let R=l.glyphsByFont.get(L.src);return R||l.glyphsByFont.set(L.src,R=new Map),R});f.forEach((L,R)=>{const F=m[R],{src:V,unitsPerEm:z}=_[F];let U=T[F].get(L);if(!U){const{path:j,pathBounds:q}=d.glyphData[V][L],Y=Math.max(q[2]-q[0],q[3]-q[1])/o*(Eg.sdfMargin*o+.5),ie=l.glyphCount++,ne=[q[0]-Y,q[1]-Y,q[2]+Y,q[3]+Y];T[F].set(L,U={path:j,atlasIndex:ie,sdfViewBox:ne}),p.push(U)}const{sdfViewBox:G}=U,B=v[w++],D=v[w++],O=g/z;y[A++]=B+G[0]*O,y[A++]=D+G[1]*O,y[A++]=B+G[2]*O,y[A++]=D+G[3]*O,f[R]=U.atlasIndex}),b.quads=(b.quads||0)+(df()-M);const E=df();b.sdf={};const C=u.height,N=Math.ceil(l.glyphCount/a),P=Math.pow(2,Math.ceil(Math.log2(N*o)));P>C&&(console.info(`Increasing SDF texture size ${C}->${P}`),ree(u,r,P),c.dispose()),Promise.all(p.map(L=>U8(L,l,i.gpuAccelerateSDF).then(({timing:R})=>{b.sdf[L.atlasIndex]=R}))).then(()=>{p.length&&!l.contextLost&&(O8(l),c.needsUpdate=!0),b.sdfTotal=df()-E,b.total=df()-t,e(Object.freeze({parameters:i,sdfTexture:c,sdfGlyphSize:o,sdfExponent:s,glyphBounds:y,glyphAtlasIndices:f,glyphColors:d.glyphColors,caretPositions:d.caretPositions,chunkedBounds:d.chunkedBounds,ascender:d.ascender,descender:d.descender,lineHeight:d.lineHeight,capHeight:d.capHeight,xHeight:d.xHeight,topBaseline:d.topBaseline,blockBounds:d.blockBounds,visibleBounds:d.visibleBounds,timings:d.timings}))})}),Promise.resolve().then(()=>{l.contextLost||iee(u)})}function U8({path:i,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:n,sdfCanvas:r,contextLost:s},o){if(s)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:l}=Eg,c=Math.max(t[2]-t[0],t[3]-t[1]),u=Math.floor(e/4),h=u%(a/n)*n,d=Math.floor(u/(a/n))*n,f=e%4;return ZJ(n,n,i,t,c,l,r,h,d,f,o)}function oee(i){const e=i.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),i.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),i.contextLost=!1;const n=[];i.glyphsByFont.forEach(r=>{r.forEach(s=>{n.push(U8(s,i,!0))})}),Promise.all(n).then(()=>{O8(i),i.sdfTexture.needsUpdate=!0})})}function aee({font:i,characters:e,sdfGlyphSize:t},n){let r=Array.isArray(e)?e.join(`
`):""+e;k8({font:i,sdfGlyphSize:t,text:r},n)}function lee(i,e){for(let t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}let F_;function cee(i){return F_||(F_=typeof document>"u"?{}:document.createElement("a")),F_.href=i,F_.href}function O8(i){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=i,{width:n,height:r}=e,s=i.sdfCanvas.getContext("webgl");let o=t.image.data;(!o||o.length!==n*r*4)&&(o=new Uint8Array(n*r*4),t.image={width:n,height:r,data:o},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,n,r,s.RGBA,s.UNSIGNED_BYTE,o)}}const uee=nm({name:"Typesetter",dependencies:[KJ,YJ,FJ],init(i,e,t){return i(e,t())}}),B8=nm({name:"Typesetter",dependencies:[uee],init(i){return function(e){return new Promise(t=>{i.typeset(e,t)})}},getTransferables(i){const e=[];for(let t in i)i[t]&&i[t].buffer&&e.push(i[t].buffer);return e}});B8.onMainThread;const KN={};function hee(i){let e=KN[i];return e||(e=KN[i]=new gd(1,1,i,i).translate(.5,.5,0)),e}const dee="aTroikaGlyphBounds",ZN="aTroikaGlyphIndex",fee="aTroikaGlyphColor";class pee extends pR{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new kr,this.boundingBox=new Fr}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=hee(e);["position","normal","uv"].forEach(n=>{this.attributes[n]=t.attributes[n].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,n,r,s){this.updateAttributeData(dee,e,4),this.updateAttributeData(ZN,t,1),this.updateAttributeData(fee,s,3),this._blockBounds=n,this._chunkedBounds=r,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:n}=this;if(t){const{PI:r,floor:s,min:o,max:a,sin:l,cos:c}=Math,u=r/2,h=r*2,d=Math.abs(t),f=e[0]/d,m=e[2]/d,_=s((f+u)/h)!==s((m+u)/h)?-d:o(l(f)*d,l(m)*d),v=s((f-u)/h)!==s((m-u)/h)?d:a(l(f)*d,l(m)*d),g=s((f+r)/h)!==s((m+r)/h)?d*2:a(d-c(f)*d,d-c(m)*d);n.min.set(_,e[1],t<0?-g:0),n.max.set(v,e[3],t<0?0:g)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(ZN).count,n=this._chunkedBounds;if(n)for(let r=n.length;r--;){t=n[r].end;let s=n[r].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,n){const r=this.getAttribute(e);t?r&&r.array.length===t.length?(r.array.set(t),r.needsUpdate=!0):(this.setAttribute(e,new od(t,n)),delete this._maxInstanceCount,this.dispose()):r&&this.deleteAttribute(e)}}const mee=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,gee=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,vee=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,_ee=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function yee(i){const e=kT(i,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new xt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Gn(0,0,0,0)},uTroikaClipRect:{value:new Gn(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new xt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new kt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new yn},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:mee,vertexTransform:gee,fragmentDefs:vee,fragmentColorTransform:_ee,customRewriter({vertexShader:t,fragmentShader:n}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(n)&&(n=n.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(t)||(t=t.replace(N8,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:n}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const bR=new qo({color:16777215,side:ts,transparent:!0}),QN=8421504,JN=new nn,k_=new Ce,eM=new Ce,ng=[],xee=new Ce,tM="+x+y";function eF(i){return Array.isArray(i)?i[0]:i}let z8=()=>{const i=new gi(new gd(1,1),bR);return z8=()=>i,i},G8=()=>{const i=new gi(new gd(1,1,32,1),bR);return G8=()=>i,i};const bee={type:"syncstart"},See={type:"synccomplete"},V8=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],wee=V8.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let H8=class extends gi{constructor(){const e=new pee;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=QN,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=tM,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(bee),k8({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(r=>r&&r())})),this.dispatchEvent(See),e&&e()})))}onBeforeRender(e,t,n,r,s,o){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return yee(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=bR.clone());if((!e||!e.isDerivedFrom(t))&&(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),this.hasOutline()){let n=e._outlineMtl;return n||(n=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),n.isTextOutlineMaterial=!0,n.depthWrite=!1,n.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),n.dispose()})),[n,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return eF(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return eF(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,n=e.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:a,blockBounds:l}=r;n.uTroikaSDFTexture.value=a,n.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),n.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,n.uTroikaSDFExponent.value=r.sdfExponent,n.uTroikaTotalBounds.value.fromArray(l),n.uTroikaUseGlyphColors.value=!t&&!!r.glyphColors;let c=0,u=0,h=0,d,f,m,_=0,v=0;if(t){let{outlineWidth:b,outlineOffsetX:p,outlineOffsetY:y,outlineBlur:A,outlineOpacity:w}=this;c=this._parsePercent(b)||0,u=Math.max(0,this._parsePercent(A)||0),d=w,_=this._parsePercent(p)||0,v=this._parsePercent(y)||0}else h=Math.max(0,this._parsePercent(this.strokeWidth)||0),h&&(m=this.strokeColor,n.uTroikaStrokeColor.value.set(m??QN),f=this.strokeOpacity,f==null&&(f=1)),d=this.fillOpacity;n.uTroikaEdgeOffset.value=c,n.uTroikaPositionOffset.value.set(_,v),n.uTroikaBlurRadius.value=u,n.uTroikaStrokeWidth.value=h,n.uTroikaStrokeOpacity.value=f,n.uTroikaFillOpacity.value=d??1,n.uTroikaCurveRadius.value=this.curveRadius||0;let g=this.clipRect;if(g&&Array.isArray(g)&&g.length===4)n.uTroikaClipRect.value.fromArray(g);else{const b=(this.fontSize||.1)*100;n.uTroikaClipRect.value.set(l[0]-b,l[1]-b,l[2]+b,l[3]+b)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const a=e.hasOwnProperty("color")?e.color:e.color=new kt;(s!==a._input||typeof s=="object")&&a.set(a._input=s)}let o=this.orientation||tM;if(o!==e._orientation){let a=n.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let l=o!==tM&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,u,h,d]=l;k_.set(0,0,0)[u]=c==="-"?1:-1,eM.set(0,0,0)[d]=h==="-"?-1:1,JN.lookAt(xee,k_.cross(eM),eM),a.setFromMatrix4(JN)}else a.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new xt){t.copy(e);const n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}worldPositionToTextCoords(e,t=new xt){return k_.copy(e),this.localPositionToTextCoords(this.worldToLocal(k_),t)}raycast(e,t){const{textRenderInfo:n,curveRadius:r}=this;if(n){const s=n.blockBounds,o=r?G8():z8(),a=o.geometry,{position:l,uv:c}=a.attributes;for(let u=0;u<c.count;u++){let h=s[0]+c.getX(u)*(s[2]-s[0]);const d=s[1]+c.getY(u)*(s[3]-s[1]);let f=0;r&&(f=r-Math.cos(h/r)*r,h=Math.sin(h/r)*r),l.setXYZ(u,h,d,f)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,ng.length=0,o.raycast(e,ng);for(let u=0;u<ng.length;u++)ng[u].object=this,t.push(ng[u])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,wee.forEach(n=>{this[n]=e[n]}),this}clone(){return new this.constructor().copy(this)}};V8.forEach(i=>{const e="_private_"+i;Object.defineProperty(H8.prototype,i,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});new Fr;new kt;const Mee=Ge.forwardRef(({sdfGlyphSize:i=64,anchorX:e="center",anchorY:t="middle",font:n,fontSize:r=1,children:s,characters:o,onSync:a,...l},c)=>{const u=Qi(({invalidate:m})=>m),[h]=Ge.useState(()=>new H8),[d,f]=Ge.useMemo(()=>{const m=[];let _="";return Ge.Children.forEach(s,v=>{typeof v=="string"||typeof v=="number"?_+=v:m.push(v)}),[m,_]},[s]);return fQ(()=>new Promise(m=>aee({font:n,characters:o},m)),["troika-text",n,o]),Ge.useLayoutEffect(()=>void h.sync(()=>{u(),a&&a(h)})),Ge.useEffect(()=>()=>h.dispose(),[h]),Ge.createElement("primitive",kp({object:h,ref:c,font:n,text:f,anchorX:e,anchorY:t,fontSize:r,sdfGlyphSize:i},l),d)}),Aee=Ge.forwardRef(({domElement:i,selector:e,onChange:t,onLock:n,onUnlock:r,enabled:s=!0,makeDefault:o,...a},l)=>{const{camera:c,...u}=a,h=Qi(A=>A.setEvents),d=Qi(A=>A.gl),f=Qi(A=>A.camera),m=Qi(A=>A.invalidate),_=Qi(A=>A.events),v=Qi(A=>A.get),g=Qi(A=>A.set),b=c||f,p=i||_.connected||d.domElement,y=Ge.useMemo(()=>new yJ(b),[b]);return Ge.useEffect(()=>{if(s){y.connect(p);const A=v().events.compute;return h({compute(w,M){const T=M.size.width/2,E=M.size.height/2;M.pointer.set(T/M.size.width*2-1,-(E/M.size.height)*2+1),M.raycaster.setFromCamera(M.pointer,M.camera)}}),()=>{y.disconnect(),h({compute:A})}}},[s,y]),Ge.useEffect(()=>{const A=T=>{m(),t&&t(T)};y.addEventListener("change",A),n&&y.addEventListener("lock",n),r&&y.addEventListener("unlock",r);const w=()=>y.lock(),M=e?Array.from(document.querySelectorAll(e)):[document];return M.forEach(T=>T&&T.addEventListener("click",w)),()=>{y.removeEventListener("change",A),n&&y.removeEventListener("lock",n),r&&y.removeEventListener("unlock",r),M.forEach(T=>T?T.removeEventListener("click",w):void 0)}},[t,n,r,e,y,m]),Ge.useEffect(()=>{if(o){const A=v().controls;return g({controls:y}),()=>g({controls:A})}},[o,y]),Ge.createElement("primitive",kp({ref:l,object:y},u))});function Eee(i,e){const t=i+"Geometry";return Ge.forwardRef(({args:n,children:r,...s},o)=>{const a=Ge.useRef(null);return Ge.useImperativeHandle(o,()=>a.current),Ge.useLayoutEffect(()=>void(e==null?void 0:e(a.current))),Ge.createElement("mesh",kp({ref:a},s),Ge.createElement(t,{attach:"geometry",args:n}),r)})}const Tee=Eee("box"),Cee=()=>{const[i,e]=Ge.useState({forward:!1,backward:!1,left:!1,right:!1,jump:!1});return Ge.useEffect(()=>{const t=r=>{switch(r.key.toLowerCase()){case"w":case"arrowup":e(s=>({...s,forward:!0}));break;case"s":case"arrowdown":e(s=>({...s,backward:!0}));break;case"a":case"arrowleft":e(s=>({...s,left:!0}));break;case"d":case"arrowright":e(s=>({...s,right:!0}));break;case" ":e(s=>({...s,jump:!0}));break}},n=r=>{switch(r.key.toLowerCase()){case"w":case"arrowup":e(s=>({...s,forward:!1}));break;case"s":case"arrowdown":e(s=>({...s,backward:!1}));break;case"a":case"arrowleft":e(s=>({...s,left:!1}));break;case"d":case"arrowright":e(s=>({...s,right:!1}));break;case" ":e(s=>({...s,jump:!1}));break}};return document.addEventListener("keydown",t),document.addEventListener("keyup",n),()=>{document.removeEventListener("keydown",t),document.removeEventListener("keyup",n)}},[]),i};var xi=(i=>(i[i.START=0]="START",i[i.EXPLORING=1]="EXPLORING",i[i.MENU=2]="MENU",i[i.PAGE_VIEW=3]="PAGE_VIEW",i))(xi||{});const Pee=({gameState:i,isLocked:e,onPointerLockChange:t})=>{const{camera:n}=Qi(),r=Ge.useRef(null),s=Cee(),o=Ge.useRef(new Ce),a=new Ce,{player:l,controllers:c,isPresenting:u}=is();Ge.useEffect(()=>{var m,_;if(u){e&&((m=r.current)==null||m.unlock());return}(i===xi.PAGE_VIEW||i===xi.START)&&e&&((_=r.current)==null||_.unlock());const f=v=>{var g,b;v.key.toLowerCase()==="t"&&(i===xi.EXPLORING||i===xi.MENU)&&(e?(g=r.current)==null||g.unlock():(b=r.current)==null||b.lock())};return window.addEventListener("keydown",f),()=>{window.removeEventListener("keydown",f)}},[i,e,u]);const h=Ge.useCallback(()=>{u||t(!0)},[t,u]),d=Ge.useCallback(()=>{u||t(!1)},[t,u]);return Ia((f,m)=>{var v,g;if(!(i===xi.EXPLORING||i===xi.MENU)){o.current.set(0,0,0);return}if(u&&l&&c.length>0){const b=c.find(A=>A.handedness==="left");if((v=b==null?void 0:b.inputSource)!=null&&v.gamepad){const A=b.inputSource.gamepad.axes;let w=0,M=0;if(Math.abs(A[0])>.1||Math.abs(A[1])>.1?(w=A[0],M=A[1],console.log("Using primary axes for movement:",w,M)):(Math.abs(A[2])>.1||Math.abs(A[3])>.1)&&(w=A[2],M=A[3],console.log("Using secondary axes for movement:",w,M)),Math.abs(w)>.1||Math.abs(M)>.1){const T=new As;f.camera.getWorldQuaternion(T);const E=new d1().setFromQuaternion(T,"YXZ");E.x=0,E.z=0;const C=new Ce(w,0,M);C.applyEuler(E).normalize();const N=Qw*m*1.5;l.position.add(C.multiplyScalar(N)),console.log("VR movement applied:",C)}}const p=30/2,y=.5;l.position.x=Mg.clamp(l.position.x,-p+y,p-y),l.position.z=Mg.clamp(l.position.z,-p+y,p-y),l.position.y=0}else{if(o.current.x-=o.current.x*10*m,o.current.z-=o.current.z*10*m,a.z=Number(s.forward)-Number(s.backward),a.x=Number(s.right)-Number(s.left),a.normalize(),(s.forward||s.backward)&&(o.current.z-=a.z*Qw*10*m),(s.left||s.right)&&(o.current.x-=a.x*Qw*10*m),(g=r.current)!=null&&g.isLocked){r.current.moveRight(-o.current.x*m),r.current.moveForward(-o.current.z*m);const b=Rr/2,p=.5;n.position.x=Mg.clamp(n.position.x,-b+p,b-p),n.position.z=Mg.clamp(n.position.z,-b+p,b-p)}n.position.y=EJ}}),u?null:we.jsx(Aee,{ref:r,onLock:h,onUnlock:d})},b1=new Ce,SR=new Ce,Ree=new Ce,tF=new xt;function Iee(i,e,t){const n=b1.setFromMatrixPosition(i.matrixWorld);n.project(e);const r=t.width/2,s=t.height/2;return[n.x*r+r,-(n.y*s)+s]}function Lee(i,e){const t=b1.setFromMatrixPosition(i.matrixWorld),n=SR.setFromMatrixPosition(e.matrixWorld),r=t.sub(n),s=e.getWorldDirection(Ree);return r.angleTo(s)>Math.PI/2}function Dee(i,e,t,n){const r=b1.setFromMatrixPosition(i.matrixWorld),s=r.clone();s.project(e),tF.set(s.x,s.y),t.setFromCamera(tF,e);const o=t.intersectObjects(n,!0);if(o.length){const a=o[0].distance;return r.distanceTo(t.ray.origin)<a}return!0}function Nee(i,e){if(e instanceof vd)return e.zoom;if(e instanceof Ji){const t=b1.setFromMatrixPosition(i.matrixWorld),n=SR.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=t.distanceTo(n);return 1/(2*Math.tan(r/2)*s)}else return 1}function Fee(i,e,t){if(e instanceof Ji||e instanceof vd){const n=b1.setFromMatrixPosition(i.matrixWorld),r=SR.setFromMatrixPosition(e.matrixWorld),s=n.distanceTo(r),o=(t[1]-t[0])/(e.far-e.near),a=t[1]-o*e.far;return Math.round(o*s+a)}}const OT=i=>Math.abs(i)<1e-10?0:i;function $8(i,e,t=""){let n="matrix3d(";for(let r=0;r!==16;r++)n+=OT(e[r]*i.elements[r])+(r!==15?",":")");return t+n}const kee=(i=>e=>$8(e,i))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Uee=(i=>(e,t)=>$8(e,i(t),"translate(-50%,-50%)"))(i=>[1/i,1/i,1/i,1,-1/i,-1/i,-1/i,-1,1/i,1/i,1/i,1,1,1,1,1]);function Oee(i){return i&&typeof i=="object"&&"current"in i}const Yc=Ge.forwardRef(({children:i,eps:e=.001,style:t,className:n,prepend:r,center:s,fullscreen:o,portal:a,distanceFactor:l,sprite:c=!1,transform:u=!1,occlude:h,onOcclude:d,castShadow:f,receiveShadow:m,material:_,geometry:v,zIndexRange:g=[16777271,0],calculatePosition:b=Iee,as:p="div",wrapperClass:y,pointerEvents:A="auto",...w},M)=>{const{gl:T,camera:E,scene:C,size:N,raycaster:P,events:L,viewport:R}=Qi(),[F]=Ge.useState(()=>document.createElement(p)),V=Ge.useRef(),z=Ge.useRef(null),U=Ge.useRef(0),G=Ge.useRef([0,0]),B=Ge.useRef(null),D=Ge.useRef(null),O=(a==null?void 0:a.current)||L.connected||T.domElement.parentNode,j=Ge.useRef(null),q=Ge.useRef(!1),Y=Ge.useMemo(()=>h&&h!=="blending"||Array.isArray(h)&&h.length&&Oee(h[0]),[h]);Ge.useLayoutEffect(()=>{const se=T.domElement;h&&h==="blending"?(se.style.zIndex=`${Math.floor(g[0]/2)}`,se.style.position="absolute",se.style.pointerEvents="none"):(se.style.zIndex=null,se.style.position=null,se.style.pointerEvents=null)},[h]),Ge.useLayoutEffect(()=>{if(z.current){const se=V.current=PB(F);if(C.updateMatrixWorld(),u)F.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const oe=b(z.current,E,N);F.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${oe[0]}px,${oe[1]}px,0);transform-origin:0 0;`}return O&&(r?O.prepend(F):O.appendChild(F)),()=>{O&&O.removeChild(F),se.unmount()}}},[O,u]),Ge.useLayoutEffect(()=>{y&&(F.className=y)},[y]);const ie=Ge.useMemo(()=>u?{position:"absolute",top:0,left:0,width:N.width,height:N.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...o&&{top:-N.height/2,left:-N.width/2,width:N.width,height:N.height},...t},[t,s,o,N,u]),ne=Ge.useMemo(()=>({position:"absolute",pointerEvents:A}),[A]);Ge.useLayoutEffect(()=>{if(q.current=!1,u){var se;(se=V.current)==null||se.render(Ge.createElement("div",{ref:B,style:ie},Ge.createElement("div",{ref:D,style:ne},Ge.createElement("div",{ref:M,className:n,style:t,children:i}))))}else{var oe;(oe=V.current)==null||oe.render(Ge.createElement("div",{ref:M,style:ie,className:n,children:i}))}});const Q=Ge.useRef(!0);Ia(se=>{if(z.current){E.updateMatrixWorld(),z.current.updateWorldMatrix(!0,!1);const oe=u?G.current:b(z.current,E,N);if(u||Math.abs(U.current-E.zoom)>e||Math.abs(G.current[0]-oe[0])>e||Math.abs(G.current[1]-oe[1])>e){const $=Lee(z.current,E);let pe=!1;Y&&(Array.isArray(h)?pe=h.map(Ue=>Ue.current):h!=="blending"&&(pe=[C]));const xe=Q.current;if(pe){const Ue=Dee(z.current,E,P,pe);Q.current=Ue&&!$}else Q.current=!$;xe!==Q.current&&(d?d(!Q.current):F.style.display=Q.current?"block":"none");const Pe=Math.floor(g[0]/2),ve=h?Y?[g[0],Pe]:[Pe-1,0]:g;if(F.style.zIndex=`${Fee(z.current,E,ve)}`,u){const[Ue,Le]=[N.width/2,N.height/2],Z=E.projectionMatrix.elements[5]*Le,{isOrthographicCamera:J,top:de,left:Ie,bottom:te,right:X}=E,ye=kee(E.matrixWorldInverse),ke=J?`scale(${Z})translate(${OT(-(X+Ie)/2)}px,${OT((de+te)/2)}px)`:`translateZ(${Z}px)`;let ge=z.current.matrixWorld;c&&(ge=E.matrixWorldInverse.clone().transpose().copyPosition(ge).scale(z.current.scale),ge.elements[3]=ge.elements[7]=ge.elements[11]=0,ge.elements[15]=1),F.style.width=N.width+"px",F.style.height=N.height+"px",F.style.perspective=J?"":`${Z}px`,B.current&&D.current&&(B.current.style.transform=`${ke}${ye}translate(${Ue}px,${Le}px)`,D.current.style.transform=Uee(ge,1/((l||10)/400)))}else{const Ue=l===void 0?1:Nee(z.current,E)*l;F.style.transform=`translate3d(${oe[0]}px,${oe[1]}px,0) scale(${Ue})`}G.current=oe,U.current=E.zoom}}if(!Y&&j.current&&!q.current)if(u){if(B.current){const oe=B.current.children[0];if(oe!=null&&oe.clientWidth&&oe!=null&&oe.clientHeight){const{isOrthographicCamera:$}=E;if($||v)w.scale&&(Array.isArray(w.scale)?w.scale instanceof Ce?j.current.scale.copy(w.scale.clone().divideScalar(1)):j.current.scale.set(1/w.scale[0],1/w.scale[1],1/w.scale[2]):j.current.scale.setScalar(1/w.scale));else{const pe=(l||10)/400,xe=oe.clientWidth*pe,Pe=oe.clientHeight*pe;j.current.scale.set(xe,Pe,1)}q.current=!0}}}else{const oe=F.children[0];if(oe!=null&&oe.clientWidth&&oe!=null&&oe.clientHeight){const $=1/R.factor,pe=oe.clientWidth*$,xe=oe.clientHeight*$;j.current.scale.set(pe,xe,1),q.current=!0}j.current.lookAt(se.camera.position)}});const le=Ge.useMemo(()=>({vertexShader:u?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[u]);return Ge.createElement("group",kp({},w,{ref:z}),h&&!Y&&Ge.createElement("mesh",{castShadow:f,receiveShadow:m,ref:j},v||Ge.createElement("planeGeometry",null),_||Ge.createElement("shaderMaterial",{side:ts,vertexShader:le.vertexShader,fragmentShader:le.fragmentShader})))}),Bee=({page:i,position:e,isSelected:t,onSelect:n,onHover:r})=>{const s=Ge.useRef(null),[o,a]=Ge.useState(!1),l=o||t;Ia(()=>{if(s.current){s.current.scale.lerp(new Ce(1,1,1).multiplyScalar(l?1.2:1),.1);const u=s.current.material;u.color.lerp(l?new kt("#38bdf8"):new kt("#0ea5e9"),.1),u.emissive.lerp(l?new kt("#38bdf8"):new kt("#0ea5e9"),.1)}});const c=i.Icon;return we.jsxs("group",{position:e,children:[we.jsxs("mesh",{ref:s,rotation:[Math.PI/2,0,0],onClick:u=>{u.stopPropagation(),n()},onPointerOver:u=>{u.stopPropagation(),a(!0),r()},onPointerOut:()=>a(!1),children:[we.jsx("cylinderGeometry",{args:[.3,.3,.1,32]}),we.jsx("meshStandardMaterial",{color:"#0ea5e9",emissive:"#0ea5e9",emissiveIntensity:l?.8:.4,toneMapped:!1})]}),we.jsx(Yc,{center:!0,position:[0,0,.06],children:we.jsx("div",{className:"w-8 h-8 pointer-events-none",children:we.jsx(c,{className:"w-full h-full text-white"})})}),we.jsx(Mee,{position:[0,-.45,0],fontSize:.15,color:"white",anchorX:"center",anchorY:"middle",children:i.menuLabel})]})},zee=({onSelectPage:i,pageYOffset:e})=>{const{camera:t}=Qi(),n=Ge.useRef(null),[r,s]=Ge.useState(0),[o,a]=Ge.useState(!1);Ge.useEffect(()=>{a(!0)},[]);const l=Ge.useCallback(h=>{h.preventDefault(),h.key.toLowerCase()==="e"||h.key==="ArrowRight"?s(d=>(d+1)%bh.length):h.key.toLowerCase()==="q"||h.key==="ArrowLeft"?s(d=>(d-1+bh.length)%bh.length):(h.key==="Enter"||h.key===" ")&&i(bh[r])},[i,r]);Ge.useEffect(()=>(window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}),[l]);const c=1.2,u=Math.PI*2/bh.length;return Ia(()=>{if(n.current){const h=t.position.clone().add(t.getWorldDirection(new Ce).multiplyScalar(3)),d=c+.5,f=Math.max(h.y,d);h.y=f+e,n.current.position.lerp(h,.1),n.current.quaternion.slerp(t.quaternion,.1);const m=o?1:0;n.current.scale.lerp(new Ce(m,m,m),.1)}}),we.jsxs("group",{ref:n,children:[we.jsxs("mesh",{position:[0,0,-.1],children:[we.jsx("ringGeometry",{args:[c*.9,c*.95,64]}),we.jsx("meshBasicMaterial",{color:"#38bdf8",toneMapped:!1,transparent:!0,opacity:.5})]}),we.jsxs("mesh",{position:[0,0,-.1],children:[we.jsx("circleGeometry",{args:[c*1.4,64]}),we.jsx("meshBasicMaterial",{color:"black",transparent:!0,opacity:.3})]}),bh.map((h,d)=>{const f=u*d-Math.PI/2,m=Math.cos(f)*c,_=Math.sin(f)*c;return we.jsx(Bee,{page:h,position:[m,_,0],isSelected:d===r,onSelect:()=>i(h),onHover:()=>s(d)},h.id)})]})},Up=({title:i,breadcrumbs:e,children:t,onClose:n})=>we.jsxs("div",{className:"relative w-full h-full bg-slate-900 bg-opacity-80 backdrop-blur-sm p-8 flex flex-col rounded-2xl border-4 border-sky-500/50 shadow-2xl shadow-sky-500/20",children:[n&&we.jsx("button",{onClick:n,className:"absolute top-3 right-3 text-white bg-red-600 hover:bg-red-700 rounded-full p-1 transition-colors z-10","aria-label":"Close",children:we.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"3",children:we.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),we.jsxs("div",{className:"flex-shrink-0 mb-4",children:[we.jsx("div",{className:"text-sky-300 text-sm mb-2",children:e.map((r,s)=>we.jsxs("span",{children:[r," ",s<e.length-1&&we.jsx("span",{className:"mx-2",children:"/"})]},s))}),we.jsx("h1",{className:"text-3xl font-bold text-white tracking-wider",children:i})]}),we.jsx("div",{className:"flex-grow flex flex-col items-center justify-center relative",children:t})]}),Gee=({title:i,message:e,onClose:t})=>we.jsx(Up,{title:i,breadcrumbs:["Home",i],onClose:t,children:we.jsx("div",{className:"text-center",children:we.jsx("p",{className:"text-2xl text-slate-300",children:e})})}),ba=({children:i,className:e,variant:t="primary",size:n="md",...r})=>{const s="font-semibold rounded-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900",o={primary:"bg-sky-500 hover:bg-sky-600 text-white focus:ring-sky-500",secondary:"bg-slate-600 hover:bg-slate-700 text-slate-100 focus:ring-slate-500"},a={md:"px-6 py-2 text-lg",sm:"px-3 py-1 text-base"},l=[s,o[t],a[n],e].join(" ");return we.jsx("button",{className:l,...r,children:i})},BT=({className:i,...e})=>{const n=["bg-slate-700 border border-slate-600 text-white placeholder-slate-400 text-lg rounded-md focus:ring-sky-500 focus:border-sky-500 block w-full p-2.5",i].join(" ");return we.jsx("input",{className:n,...e})},Vee=[{id:"1",name:"James' Session"},{id:"2",name:"Class B8' Session"},{id:"3",name:"Class C4' Session"},{id:"4",name:"Class D9' Session"}],Hee=({onClose:i})=>{const[e,t]=Ge.useState("main"),[n,r]=Ge.useState(10),s=()=>r(c=>c+1),o=()=>r(c=>Math.max(1,c-1)),a=()=>{switch(e){case"create":return we.jsxs("div",{className:"w-full max-w-sm flex flex-col items-center space-y-4",children:[we.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Create Session"}),we.jsx(BT,{placeholder:"Name"}),we.jsxs("div",{className:"w-full text-center",children:[we.jsx("label",{className:"text-slate-300",children:"Number of Participants"}),we.jsxs("div",{className:"flex items-center justify-center space-x-4 mt-2",children:[we.jsx("button",{onClick:o,className:"px-4 py-2 bg-sky-600 hover:bg-sky-700 rounded-md text-xl font-bold",children:"-"}),we.jsx("span",{className:"text-2xl font-bold w-16 text-center",children:n}),we.jsx("button",{onClick:s,className:"px-4 py-2 bg-sky-600 hover:bg-sky-700 rounded-md text-xl font-bold",children:"+"})]})]}),we.jsxs("div",{className:"flex space-x-4 pt-4",children:[we.jsx(ba,{onClick:()=>alert("Session Created!"),children:"Finish"}),we.jsx(ba,{onClick:()=>t("main"),variant:"secondary",children:"Cancel"})]})]});case"join":return we.jsxs("div",{className:"w-full max-w-md flex flex-col items-center",children:[we.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Join Session"}),we.jsx("div",{className:"w-full space-y-2 bg-slate-800/50 p-4 rounded-lg",children:Vee.map(c=>we.jsxs("div",{className:"flex justify-between items-center p-2 rounded-md hover:bg-sky-900/50",children:[we.jsx("span",{className:"text-lg",children:c.name}),we.jsx(ba,{onClick:()=>alert(`Joining ${c.name}`),size:"sm",children:"Enter"})]},c.id))}),we.jsx("div",{className:"mt-6",children:we.jsx(ba,{onClick:()=>t("main"),variant:"secondary",children:"Cancel"})})]});case"main":default:return we.jsxs("div",{className:"flex flex-col space-y-6 items-center",children:[we.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Multi-User Session"}),we.jsxs("div",{className:"flex space-x-6",children:[we.jsx(ba,{onClick:()=>t("create"),children:"Create"}),we.jsx(ba,{onClick:()=>t("join"),children:"Join"})]})]})}},l=()=>{const c=["Home","Host/Join"];return e==="create"?[...c,"Create"]:e==="join"?[...c,"Join"]:c};return we.jsx(Up,{title:"Host/Join Session",breadcrumbs:l(),onClose:i,children:a()})};/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const wR="158",$ee=0,nF=1,Wee=2,W8=1,jee=2,zl=3,uc=0,Es=1,Qa=2,tc=0,nc=1,zT=2,iF=3,rF=4,Xee=5,Eh=100,qee=101,Yee=102,sF=103,oF=104,Kee=200,Zee=201,Qee=202,Jee=203,GT=204,VT=205,ete=206,tte=207,nte=208,ite=209,rte=210,ste=211,ote=212,ate=213,lte=214,cte=0,ute=1,hte=2,nb=3,dte=4,fte=5,pte=6,mte=7,j8=0,gte=1,vte=2,gu=0,_te=1,yte=2,xte=3,bte=4,Ste=5,X8=300,Op=301,Bp=302,HT=303,$T=304,_S=306,WT=1e3,Ma=1001,jT=1002,Zn=1003,aF=1004,nM=1005,es=1006,wte=1007,q0=1008,La=1009,Mte=1010,Ate=1011,MR=1012,q8=1013,iu=1014,Ca=1015,ld=1016,Y8=1017,K8=1018,Xh=1020,Ete=1021,Ws=1023,Tte=1024,Cte=1025,qh=1026,zp=1027,Pte=1028,Z8=1029,Rte=1030,Q8=1031,J8=1033,iM=33776,rM=33777,sM=33778,oM=33779,lF=35840,cF=35841,uF=35842,hF=35843,Ite=36196,dF=37492,fF=37496,pF=37808,mF=37809,gF=37810,vF=37811,_F=37812,yF=37813,xF=37814,bF=37815,SF=37816,wF=37817,MF=37818,AF=37819,EF=37820,TF=37821,aM=36492,CF=36494,PF=36495,Lte=36283,RF=36284,IF=36285,LF=36286,eG=3e3,Yh=3001,Dte=3200,Nte=3201,Fte=0,kte=1,Wo="",Dr="srgb",hc="srgb-linear",AR="display-p3",yS="display-p3-linear",ib="linear",ri="srgb",rb="rec709",sb="p3",ff=7680,DF=519,Ute=512,Ote=513,Bte=514,zte=515,Gte=516,Vte=517,Hte=518,$te=519,Kc=35044,pf=35048,NF="300 es",XT=1035,Ql=2e3,ob=2001;class im{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const Kr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],cx=Math.PI/180,qT=180/Math.PI;function S1(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Kr[i&255]+Kr[i>>8&255]+Kr[i>>16&255]+Kr[i>>24&255]+"-"+Kr[e&255]+Kr[e>>8&255]+"-"+Kr[e>>16&15|64]+Kr[e>>24&255]+"-"+Kr[t&63|128]+Kr[t>>8&255]+"-"+Kr[t>>16&255]+Kr[t>>24&255]+Kr[n&255]+Kr[n>>8&255]+Kr[n>>16&255]+Kr[n>>24&255]).toLowerCase()}function Vs(i,e,t){return Math.max(e,Math.min(t,i))}function Wte(i,e){return(i%e+e)%e}function lM(i,e,t){return(1-t)*i+t*e}function FF(i){return(i&i-1)===0&&i!==0}function YT(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function ig(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Us(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}class sn{constructor(e=0,t=0){sn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*r+e.x,this.y=s*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class mn{constructor(e,t,n,r,s,o,a,l,c){mn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c)}set(e,t,n,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],u=n[4],h=n[7],d=n[2],f=n[5],m=n[8],_=r[0],v=r[3],g=r[6],b=r[1],p=r[4],y=r[7],A=r[2],w=r[5],M=r[8];return s[0]=o*_+a*b+l*A,s[3]=o*v+a*p+l*w,s[6]=o*g+a*y+l*M,s[1]=c*_+u*b+h*A,s[4]=c*v+u*p+h*w,s[7]=c*g+u*y+h*M,s[2]=d*_+f*b+m*A,s[5]=d*v+f*p+m*w,s[8]=d*g+f*y+m*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-n*s*u+n*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,d=a*l-u*s,f=c*s-o*l,m=t*h+n*d+r*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/m;return e[0]=h*_,e[1]=(r*c-u*n)*_,e[2]=(a*n-r*o)*_,e[3]=d*_,e[4]=(u*t-r*l)*_,e[5]=(r*s-a*t)*_,e[6]=f*_,e[7]=(n*l-c*t)*_,e[8]=(o*t-n*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(cM.makeScale(e,t)),this}rotate(e){return this.premultiply(cM.makeRotation(-e)),this}translate(e,t){return this.premultiply(cM.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const cM=new mn;function tG(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}function ab(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function jte(){const i=ab("canvas");return i.style.display="block",i}const kF={};function e0(i){i in kF||(kF[i]=!0,console.warn(i))}const UF=new mn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),OF=new mn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),U_={[hc]:{transfer:ib,primaries:rb,toReference:i=>i,fromReference:i=>i},[Dr]:{transfer:ri,primaries:rb,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[yS]:{transfer:ib,primaries:sb,toReference:i=>i.applyMatrix3(OF),fromReference:i=>i.applyMatrix3(UF)},[AR]:{transfer:ri,primaries:sb,toReference:i=>i.convertSRGBToLinear().applyMatrix3(OF),fromReference:i=>i.applyMatrix3(UF).convertLinearToSRGB()}},Xte=new Set([hc,yS]),jn={enabled:!0,_workingColorSpace:hc,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(i){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!i},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!Xte.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const n=U_[e].toReference,r=U_[t].fromReference;return r(n(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this._workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this._workingColorSpace)},getPrimaries:function(i){return U_[i].primaries},getTransfer:function(i){return i===Wo?ib:U_[i].transfer}};function vp(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function uM(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}let mf;class nG{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{mf===void 0&&(mf=ab("canvas")),mf.width=e.width,mf.height=e.height;const n=mf.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=mf}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=ab("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=vp(s[o]/255)*255;return n.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(vp(t[n]/255)*255):t[n]=vp(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let qte=0;class iG{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:qte++}),this.uuid=S1(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(hM(r[o].image)):s.push(hM(r[o]))}else s=hM(r);n.url=s}return t||(e.images[this.uuid]=n),n}}function hM(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?nG.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Yte=0;class Ts extends im{constructor(e=Ts.DEFAULT_IMAGE,t=Ts.DEFAULT_MAPPING,n=Ma,r=Ma,s=es,o=q0,a=Ws,l=La,c=Ts.DEFAULT_ANISOTROPY,u=Wo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Yte++}),this.uuid=S1(),this.name="",this.source=new iG(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new sn(0,0),this.repeat=new sn(1,1),this.center=new sn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new mn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(e0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===Yh?Dr:Wo),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==X8)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case WT:e.x=e.x-Math.floor(e.x);break;case Ma:e.x=e.x<0?0:1;break;case jT:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case WT:e.y=e.y-Math.floor(e.y);break;case Ma:e.y=e.y<0?0:1;break;case jT:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return e0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Dr?Yh:eG}set encoding(e){e0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Yh?Dr:Wo}}Ts.DEFAULT_IMAGE=null;Ts.DEFAULT_MAPPING=X8;Ts.DEFAULT_ANISOTROPY=1;class Mr{constructor(e=0,t=0,n=0,r=1){Mr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,s;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],f=l[5],m=l[9],_=l[2],v=l[6],g=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-_)<.01&&Math.abs(m-v)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+_)<.1&&Math.abs(m+v)<.1&&Math.abs(c+f+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const p=(c+1)/2,y=(f+1)/2,A=(g+1)/2,w=(u+d)/4,M=(h+_)/4,T=(m+v)/4;return p>y&&p>A?p<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(p),r=w/n,s=M/n):y>A?y<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(y),n=w/r,s=T/r):A<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(A),n=M/s,r=T/s),this.set(n,r,s,t),this}let b=Math.sqrt((v-m)*(v-m)+(h-_)*(h-_)+(d-u)*(d-u));return Math.abs(b)<.001&&(b=1),this.x=(v-m)/b,this.y=(h-_)/b,this.z=(d-u)/b,this.w=Math.acos((c+f+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Kte extends im{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Mr(0,0,e,t),this.scissorTest=!1,this.viewport=new Mr(0,0,e,t);const r={width:e,height:t,depth:1};n.encoding!==void 0&&(e0("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===Yh?Dr:Wo),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:es,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Ts(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new iG(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ol extends Kte{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class rG extends Ts{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Zn,this.minFilter=Zn,this.wrapR=Ma,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Zte extends Ts{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=Zn,this.minFilter=Zn,this.wrapR=Ma,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Cs{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,s,o,a){let l=n[r+0],c=n[r+1],u=n[r+2],h=n[r+3];const d=s[o+0],f=s[o+1],m=s[o+2],_=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=d,e[t+1]=f,e[t+2]=m,e[t+3]=_;return}if(h!==_||l!==d||c!==f||u!==m){let v=1-a;const g=l*d+c*f+u*m+h*_,b=g>=0?1:-1,p=1-g*g;if(p>Number.EPSILON){const A=Math.sqrt(p),w=Math.atan2(A,g*b);v=Math.sin(v*w)/A,a=Math.sin(a*w)/A}const y=a*b;if(l=l*v+d*y,c=c*v+f*y,u=u*v+m*y,h=h*v+_*y,v===1-a){const A=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=A,c*=A,u*=A,h*=A}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,r,s,o){const a=n[r],l=n[r+1],c=n[r+2],u=n[r+3],h=s[o],d=s[o+1],f=s[o+2],m=s[o+3];return e[t]=a*m+u*h+l*f-c*d,e[t+1]=l*m+u*d+c*h-a*f,e[t+2]=c*m+u*f+a*d-l*h,e[t+3]=u*m-a*h-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(r/2),h=a(s/2),d=l(n/2),f=l(r/2),m=l(s/2);switch(o){case"XYZ":this._x=d*u*h+c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h-d*f*m;break;case"YXZ":this._x=d*u*h+c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h+d*f*m;break;case"ZXY":this._x=d*u*h-c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h-d*f*m;break;case"ZYX":this._x=d*u*h-c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h+d*f*m;break;case"YZX":this._x=d*u*h+c*f*m,this._y=c*f*h+d*u*m,this._z=c*u*m-d*f*h,this._w=c*u*h-d*f*m;break;case"XZY":this._x=d*u*h-c*f*m,this._y=c*f*h-d*u*m,this._z=c*u*m+d*f*h,this._w=c*u*h+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],d=n+a+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(o-r)*f}else if(n>a&&n>h){const f=2*Math.sqrt(1+n-a-h);this._w=(u-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+c)/f}else if(a>h){const f=2*Math.sqrt(1+a-n-h);this._w=(s-c)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-n-a);this._w=(o-r)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Vs(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-n*c,this._z=s*u+o*c+n*l-r*a,this._w=o*u-n*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*n+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,d=Math.sin(t*u)/c;return this._w=o*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(s),n*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class me{constructor(e=0,t=0,n=0){me.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(BF.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(BF.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*r,this.y=s[1]*t+s[4]*n+s[7]*r,this.z=s[2]*t+s[5]*n+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*n),u=2*(a*t-s*r),h=2*(s*n-o*t);return this.x=t+l*c+o*h-a*u,this.y=n+l*u+a*c-s*h,this.z=r+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r,this.y=s[1]*t+s[5]*n+s[9]*r,this.z=s[2]*t+s[6]*n+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return dM.copy(this).projectOnVector(e),this.sub(dM)}reflect(e){return this.sub(dM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const dM=new me,BF=new Cs;class Ti{constructor(e=new me(1/0,1/0,1/0),t=new me(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(la.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(la.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=la.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,la):la.fromBufferAttribute(s,o),la.applyMatrix4(e.matrixWorld),this.expandByPoint(la);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),O_.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),O_.copy(n.boundingBox)),O_.applyMatrix4(e.matrixWorld),this.union(O_)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,la),la.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(rg),B_.subVectors(this.max,rg),gf.subVectors(e.a,rg),vf.subVectors(e.b,rg),_f.subVectors(e.c,rg),Uc.subVectors(vf,gf),Oc.subVectors(_f,vf),lh.subVectors(gf,_f);let t=[0,-Uc.z,Uc.y,0,-Oc.z,Oc.y,0,-lh.z,lh.y,Uc.z,0,-Uc.x,Oc.z,0,-Oc.x,lh.z,0,-lh.x,-Uc.y,Uc.x,0,-Oc.y,Oc.x,0,-lh.y,lh.x,0];return!fM(t,gf,vf,_f,B_)||(t=[1,0,0,0,1,0,0,0,1],!fM(t,gf,vf,_f,B_))?!1:(z_.crossVectors(Uc,Oc),t=[z_.x,z_.y,z_.z],fM(t,gf,vf,_f,B_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,la).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(la).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Rl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Rl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Rl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Rl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Rl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Rl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Rl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Rl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Rl),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Rl=[new me,new me,new me,new me,new me,new me,new me,new me],la=new me,O_=new Ti,gf=new me,vf=new me,_f=new me,Uc=new me,Oc=new me,lh=new me,rg=new me,B_=new me,z_=new me,ch=new me;function fM(i,e,t,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){ch.fromArray(i,s);const a=r.x*Math.abs(ch.x)+r.y*Math.abs(ch.y)+r.z*Math.abs(ch.z),l=e.dot(ch),c=t.dot(ch),u=n.dot(ch);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const Qte=new Ti,sg=new me,pM=new me;class w1{constructor(e=new me,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):Qte.setFromPoints(e).getCenter(n);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;sg.subVectors(e,this.center);const t=sg.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=(n-this.radius)*.5;this.center.addScaledVector(sg,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(pM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(sg.copy(e.center).add(pM)),this.expandByPoint(sg.copy(e.center).sub(pM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Il=new me,mM=new me,G_=new me,Bc=new me,gM=new me,V_=new me,vM=new me;class ER{constructor(e=new me,t=new me(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Il)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Il.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Il.copy(this.origin).addScaledVector(this.direction,t),Il.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){mM.copy(e).add(t).multiplyScalar(.5),G_.copy(t).sub(e).normalize(),Bc.copy(this.origin).sub(mM);const s=e.distanceTo(t)*.5,o=-this.direction.dot(G_),a=Bc.dot(this.direction),l=-Bc.dot(G_),c=Bc.lengthSq(),u=Math.abs(1-o*o);let h,d,f,m;if(u>0)if(h=o*l-a,d=o*a-l,m=s*u,h>=0)if(d>=-m)if(d<=m){const _=1/u;h*=_,d*=_,f=h*(h+o*d+2*a)+d*(o*h+d+2*l)+c}else d=s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;else d<=-m?(h=Math.max(0,-(-o*s+a)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c):d<=m?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(h=Math.max(0,-(o*s+a)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c);else d=o>0?-s:s,h=Math.max(0,-(o*d+a)),f=-h*h+d*(d+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(mM).addScaledVector(G_,d),f}intersectSphere(e,t){Il.subVectors(e.center,this.origin);const n=Il.dot(this.direction),r=Il.dot(Il)-n*n,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(n=(e.min.x-d.x)*c,r=(e.max.x-d.x)*c):(n=(e.max.x-d.x)*c,r=(e.min.x-d.x)*c),u>=0?(s=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),n>o||s>r||((s>n||isNaN(n))&&(n=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,t)}intersectsBox(e){return this.intersectBox(e,Il)!==null}intersectTriangle(e,t,n,r,s){gM.subVectors(t,e),V_.subVectors(n,e),vM.crossVectors(gM,V_);let o=this.direction.dot(vM),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Bc.subVectors(this.origin,e);const l=a*this.direction.dot(V_.crossVectors(Bc,V_));if(l<0)return null;const c=a*this.direction.dot(gM.cross(Bc));if(c<0||l+c>o)return null;const u=-a*Bc.dot(vM);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Tt{constructor(e,t,n,r,s,o,a,l,c,u,h,d,f,m,_,v){Tt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,r,s,o,a,l,c,u,h,d,f,m,_,v)}set(e,t,n,r,s,o,a,l,c,u,h,d,f,m,_,v){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=s,g[5]=o,g[9]=a,g[13]=l,g[2]=c,g[6]=u,g[10]=h,g[14]=d,g[3]=f,g[7]=m,g[11]=_,g[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Tt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/yf.setFromMatrixColumn(e,0).length(),s=1/yf.setFromMatrixColumn(e,1).length(),o=1/yf.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=o*u,f=o*h,m=a*u,_=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=f+m*c,t[5]=d-_*c,t[9]=-a*l,t[2]=_-d*c,t[6]=m+f*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*u,f=l*h,m=c*u,_=c*h;t[0]=d+_*a,t[4]=m*a-f,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=f*a-m,t[6]=_+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*u,f=l*h,m=c*u,_=c*h;t[0]=d-_*a,t[4]=-o*h,t[8]=m+f*a,t[1]=f+m*a,t[5]=o*u,t[9]=_-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*u,f=o*h,m=a*u,_=a*h;t[0]=l*u,t[4]=m*c-f,t[8]=d*c+_,t[1]=l*h,t[5]=_*c+d,t[9]=f*c-m,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,f=o*c,m=a*l,_=a*c;t[0]=l*u,t[4]=_-d*h,t[8]=m*h+f,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*h+m,t[10]=d-_*h}else if(e.order==="XZY"){const d=o*l,f=o*c,m=a*l,_=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=d*h+_,t[5]=o*u,t[9]=f*h-m,t[2]=m*h-f,t[6]=a*u,t[10]=_*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Jte,e,ene)}lookAt(e,t,n){const r=this.elements;return ho.subVectors(e,t),ho.lengthSq()===0&&(ho.z=1),ho.normalize(),zc.crossVectors(n,ho),zc.lengthSq()===0&&(Math.abs(n.z)===1?ho.x+=1e-4:ho.z+=1e-4,ho.normalize(),zc.crossVectors(n,ho)),zc.normalize(),H_.crossVectors(ho,zc),r[0]=zc.x,r[4]=H_.x,r[8]=ho.x,r[1]=zc.y,r[5]=H_.y,r[9]=ho.y,r[2]=zc.z,r[6]=H_.z,r[10]=ho.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],u=n[1],h=n[5],d=n[9],f=n[13],m=n[2],_=n[6],v=n[10],g=n[14],b=n[3],p=n[7],y=n[11],A=n[15],w=r[0],M=r[4],T=r[8],E=r[12],C=r[1],N=r[5],P=r[9],L=r[13],R=r[2],F=r[6],V=r[10],z=r[14],U=r[3],G=r[7],B=r[11],D=r[15];return s[0]=o*w+a*C+l*R+c*U,s[4]=o*M+a*N+l*F+c*G,s[8]=o*T+a*P+l*V+c*B,s[12]=o*E+a*L+l*z+c*D,s[1]=u*w+h*C+d*R+f*U,s[5]=u*M+h*N+d*F+f*G,s[9]=u*T+h*P+d*V+f*B,s[13]=u*E+h*L+d*z+f*D,s[2]=m*w+_*C+v*R+g*U,s[6]=m*M+_*N+v*F+g*G,s[10]=m*T+_*P+v*V+g*B,s[14]=m*E+_*L+v*z+g*D,s[3]=b*w+p*C+y*R+A*U,s[7]=b*M+p*N+y*F+A*G,s[11]=b*T+p*P+y*V+A*B,s[15]=b*E+p*L+y*z+A*D,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],f=e[14],m=e[3],_=e[7],v=e[11],g=e[15];return m*(+s*l*h-r*c*h-s*a*d+n*c*d+r*a*f-n*l*f)+_*(+t*l*f-t*c*d+s*o*d-r*o*f+r*c*u-s*l*u)+v*(+t*c*h-t*a*f-s*o*h+n*o*f+s*a*u-n*c*u)+g*(-r*a*u-t*l*h+t*a*d+r*o*h-n*o*d+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],m=e[12],_=e[13],v=e[14],g=e[15],b=h*v*c-_*d*c+_*l*f-a*v*f-h*l*g+a*d*g,p=m*d*c-u*v*c-m*l*f+o*v*f+u*l*g-o*d*g,y=u*_*c-m*h*c+m*a*f-o*_*f-u*a*g+o*h*g,A=m*h*l-u*_*l-m*a*d+o*_*d+u*a*v-o*h*v,w=t*b+n*p+r*y+s*A;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/w;return e[0]=b*M,e[1]=(_*d*s-h*v*s-_*r*f+n*v*f+h*r*g-n*d*g)*M,e[2]=(a*v*s-_*l*s+_*r*c-n*v*c-a*r*g+n*l*g)*M,e[3]=(h*l*s-a*d*s-h*r*c+n*d*c+a*r*f-n*l*f)*M,e[4]=p*M,e[5]=(u*v*s-m*d*s+m*r*f-t*v*f-u*r*g+t*d*g)*M,e[6]=(m*l*s-o*v*s-m*r*c+t*v*c+o*r*g-t*l*g)*M,e[7]=(o*d*s-u*l*s+u*r*c-t*d*c-o*r*f+t*l*f)*M,e[8]=y*M,e[9]=(m*h*s-u*_*s-m*n*f+t*_*f+u*n*g-t*h*g)*M,e[10]=(o*_*s-m*a*s+m*n*c-t*_*c-o*n*g+t*a*g)*M,e[11]=(u*a*s-o*h*s-u*n*c+t*h*c+o*n*f-t*a*f)*M,e[12]=A*M,e[13]=(u*_*r-m*h*r+m*n*d-t*_*d-u*n*v+t*h*v)*M,e[14]=(m*a*r-o*_*r-m*n*l+t*_*l+o*n*v-t*a*v)*M,e[15]=(o*h*r-u*a*r+u*n*l-t*h*l-o*n*d+t*a*d)*M,this}scale(e){const t=this.elements,n=e.x,r=e.y,s=e.z;return t[0]*=n,t[4]*=r,t[8]*=s,t[1]*=n,t[5]*=r,t[9]*=s,t[2]*=n,t[6]*=r,t[10]*=s,t[3]*=n,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+n,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+n,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,s,o){return this.set(1,n,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,h=a+a,d=s*c,f=s*u,m=s*h,_=o*u,v=o*h,g=a*h,b=l*c,p=l*u,y=l*h,A=n.x,w=n.y,M=n.z;return r[0]=(1-(_+g))*A,r[1]=(f+y)*A,r[2]=(m-p)*A,r[3]=0,r[4]=(f-y)*w,r[5]=(1-(d+g))*w,r[6]=(v+b)*w,r[7]=0,r[8]=(m+p)*M,r[9]=(v-b)*M,r[10]=(1-(d+_))*M,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let s=yf.set(r[0],r[1],r[2]).length();const o=yf.set(r[4],r[5],r[6]).length(),a=yf.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],ca.copy(this);const c=1/s,u=1/o,h=1/a;return ca.elements[0]*=c,ca.elements[1]*=c,ca.elements[2]*=c,ca.elements[4]*=u,ca.elements[5]*=u,ca.elements[6]*=u,ca.elements[8]*=h,ca.elements[9]*=h,ca.elements[10]*=h,t.setFromRotationMatrix(ca),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,r,s,o,a=Ql){const l=this.elements,c=2*s/(t-e),u=2*s/(n-r),h=(t+e)/(t-e),d=(n+r)/(n-r);let f,m;if(a===Ql)f=-(o+s)/(o-s),m=-2*o*s/(o-s);else if(a===ob)f=-o/(o-s),m=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,r,s,o,a=Ql){const l=this.elements,c=1/(t-e),u=1/(n-r),h=1/(o-s),d=(t+e)*c,f=(n+r)*u;let m,_;if(a===Ql)m=(o+s)*h,_=-2*h;else if(a===ob)m=s*h,_=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=_,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const yf=new me,ca=new Tt,Jte=new me(0,0,0),ene=new me(1,1,1),zc=new me,H_=new me,ho=new me,zF=new Tt,GF=new Cs;class Gp{constructor(e=0,t=0,n=0,r=Gp.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],d=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(Vs(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Vs(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Vs(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Vs(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Vs(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Vs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return zF.makeRotationFromQuaternion(e),this.setFromRotationMatrix(zF,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return GF.setFromEuler(this),this.setFromQuaternion(GF,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Gp.DEFAULT_ORDER="XYZ";class sG{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let tne=0;const VF=new me,xf=new Cs,Ll=new Tt,$_=new me,og=new me,nne=new me,ine=new Cs,HF=new me(1,0,0),$F=new me(0,1,0),WF=new me(0,0,1),rne={type:"added"},sne={type:"removed"};class Er extends im{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:tne++}),this.uuid=S1(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Er.DEFAULT_UP.clone();const e=new me,t=new Gp,n=new Cs,r=new me(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Tt},normalMatrix:{value:new mn}}),this.matrix=new Tt,this.matrixWorld=new Tt,this.matrixAutoUpdate=Er.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Er.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new sG,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return xf.setFromAxisAngle(e,t),this.quaternion.multiply(xf),this}rotateOnWorldAxis(e,t){return xf.setFromAxisAngle(e,t),this.quaternion.premultiply(xf),this}rotateX(e){return this.rotateOnAxis(HF,e)}rotateY(e){return this.rotateOnAxis($F,e)}rotateZ(e){return this.rotateOnAxis(WF,e)}translateOnAxis(e,t){return VF.copy(e).applyQuaternion(this.quaternion),this.position.add(VF.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(HF,e)}translateY(e){return this.translateOnAxis($F,e)}translateZ(e){return this.translateOnAxis(WF,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ll.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?$_.copy(e):$_.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),og.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ll.lookAt(og,$_,this.up):Ll.lookAt($_,og,this.up),this.quaternion.setFromRotationMatrix(Ll),r&&(Ll.extractRotation(r.matrixWorld),xf.setFromRotationMatrix(Ll),this.quaternion.premultiply(xf.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(rne)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(sne)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ll.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ll.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ll),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let r=0,s=this.children.length;r<s;r++){const o=this.children[r].getObjectsByProperty(e,t);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(og,e,nne),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(og,ine,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const s=t[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),d=o(e.skeletons),f=o(e.animations),m=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),h.length>0&&(n.shapes=h),d.length>0&&(n.skeletons=d),f.length>0&&(n.animations=f),m.length>0&&(n.nodes=m)}return n.object=r,n;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}}Er.DEFAULT_UP=new me(0,1,0);Er.DEFAULT_MATRIX_AUTO_UPDATE=!0;Er.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ua=new me,Dl=new me,_M=new me,Nl=new me,bf=new me,Sf=new me,jF=new me,yM=new me,xM=new me,bM=new me;let W_=!1;class Sa{constructor(e=new me,t=new me,n=new me){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),ua.subVectors(e,t),r.cross(ua);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,n,r,s){ua.subVectors(r,t),Dl.subVectors(n,t),_M.subVectors(e,t);const o=ua.dot(ua),a=ua.dot(Dl),l=ua.dot(_M),c=Dl.dot(Dl),u=Dl.dot(_M),h=o*c-a*a;if(h===0)return s.set(-2,-1,-1);const d=1/h,f=(c*l-a*u)*d,m=(o*u-a*l)*d;return s.set(1-f-m,m,f)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Nl),Nl.x>=0&&Nl.y>=0&&Nl.x+Nl.y<=1}static getUV(e,t,n,r,s,o,a,l){return W_===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),W_=!0),this.getInterpolation(e,t,n,r,s,o,a,l)}static getInterpolation(e,t,n,r,s,o,a,l){return this.getBarycoord(e,t,n,r,Nl),l.setScalar(0),l.addScaledVector(s,Nl.x),l.addScaledVector(o,Nl.y),l.addScaledVector(a,Nl.z),l}static isFrontFacing(e,t,n,r){return ua.subVectors(n,t),Dl.subVectors(e,t),ua.cross(Dl).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ua.subVectors(this.c,this.b),Dl.subVectors(this.a,this.b),ua.cross(Dl).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Sa.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Sa.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,s){return W_===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),W_=!0),Sa.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}getInterpolation(e,t,n,r,s){return Sa.getInterpolation(e,this.a,this.b,this.c,t,n,r,s)}containsPoint(e){return Sa.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Sa.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,s=this.c;let o,a;bf.subVectors(r,n),Sf.subVectors(s,n),yM.subVectors(e,n);const l=bf.dot(yM),c=Sf.dot(yM);if(l<=0&&c<=0)return t.copy(n);xM.subVectors(e,r);const u=bf.dot(xM),h=Sf.dot(xM);if(u>=0&&h<=u)return t.copy(r);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(bf,o);bM.subVectors(e,s);const f=bf.dot(bM),m=Sf.dot(bM);if(m>=0&&f<=m)return t.copy(s);const _=f*c-l*m;if(_<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(n).addScaledVector(Sf,a);const v=u*m-f*h;if(v<=0&&h-u>=0&&f-m>=0)return jF.subVectors(s,r),a=(h-u)/(h-u+(f-m)),t.copy(r).addScaledVector(jF,a);const g=1/(v+_+d);return o=_*g,a=d*g,t.copy(n).addScaledVector(bf,o).addScaledVector(Sf,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const oG={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gc={h:0,s:0,l:0},j_={h:0,s:0,l:0};function SM(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}class Ht{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Dr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,jn.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=jn.workingColorSpace){return this.r=e,this.g=t,this.b=n,jn.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=jn.workingColorSpace){if(e=Wte(e,1),t=Vs(t,0,1),n=Vs(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=SM(o,s,e+1/3),this.g=SM(o,s,e),this.b=SM(o,s,e-1/3)}return jn.toWorkingColorSpace(this,r),this}setStyle(e,t=Dr){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Dr){const n=oG[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=vp(e.r),this.g=vp(e.g),this.b=vp(e.b),this}copyLinearToSRGB(e){return this.r=uM(e.r),this.g=uM(e.g),this.b=uM(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Dr){return jn.fromWorkingColorSpace(Zr.copy(this),e),Math.round(Vs(Zr.r*255,0,255))*65536+Math.round(Vs(Zr.g*255,0,255))*256+Math.round(Vs(Zr.b*255,0,255))}getHexString(e=Dr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=jn.workingColorSpace){jn.fromWorkingColorSpace(Zr.copy(this),t);const n=Zr.r,r=Zr.g,s=Zr.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case n:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-n)/h+2;break;case s:l=(n-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=jn.workingColorSpace){return jn.fromWorkingColorSpace(Zr.copy(this),t),e.r=Zr.r,e.g=Zr.g,e.b=Zr.b,e}getStyle(e=Dr){jn.fromWorkingColorSpace(Zr.copy(this),e);const t=Zr.r,n=Zr.g,r=Zr.b;return e!==Dr?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(r*255)})`}offsetHSL(e,t,n){return this.getHSL(Gc),this.setHSL(Gc.h+e,Gc.s+t,Gc.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Gc),e.getHSL(j_);const n=lM(Gc.h,j_.h,t),r=lM(Gc.s,j_.s,t),s=lM(Gc.l,j_.l,t);return this.setHSL(n,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*r,this.g=s[1]*t+s[4]*n+s[7]*r,this.b=s[2]*t+s[5]*n+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Zr=new Ht;Ht.NAMES=oG;let one=0;class rm extends im{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:one++}),this.uuid=S1(),this.name="",this.type="Material",this.blending=nc,this.side=uc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=GT,this.blendDst=VT,this.blendEquation=Eh,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ht(0,0,0),this.blendAlpha=0,this.depthFunc=nb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=DF,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ff,this.stencilZFail=ff,this.stencilZPass=ff,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==nc&&(n.blending=this.blending),this.side!==uc&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==GT&&(n.blendSrc=this.blendSrc),this.blendDst!==VT&&(n.blendDst=this.blendDst),this.blendEquation!==Eh&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==nb&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==DF&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ff&&(n.stencilFail=this.stencilFail),this.stencilZFail!==ff&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==ff&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class aG extends rm{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ht(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=j8,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ki=new me,X_=new sn;class Hi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Kc,this.updateRange={offset:0,count:-1},this.gpuType=Ca,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)X_.fromBufferAttribute(this,t),X_.applyMatrix3(e),this.setXY(t,X_.x,X_.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Ki.fromBufferAttribute(this,t),Ki.applyMatrix3(e),this.setXYZ(t,Ki.x,Ki.y,Ki.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ki.fromBufferAttribute(this,t),Ki.applyMatrix4(e),this.setXYZ(t,Ki.x,Ki.y,Ki.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ki.fromBufferAttribute(this,t),Ki.applyNormalMatrix(e),this.setXYZ(t,Ki.x,Ki.y,Ki.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ki.fromBufferAttribute(this,t),Ki.transformDirection(e),this.setXYZ(t,Ki.x,Ki.y,Ki.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=ig(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Us(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ig(t,this.array)),t}setX(e,t){return this.normalized&&(t=Us(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ig(t,this.array)),t}setY(e,t){return this.normalized&&(t=Us(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ig(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Us(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ig(t,this.array)),t}setW(e,t){return this.normalized&&(t=Us(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Us(t,this.array),n=Us(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Us(t,this.array),n=Us(n,this.array),r=Us(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,s){return e*=this.itemSize,this.normalized&&(t=Us(t,this.array),n=Us(n,this.array),r=Us(r,this.array),s=Us(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Kc&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class lG extends Hi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class cG extends Hi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class ai extends Hi{constructor(e,t,n){super(new Float32Array(e),t,n)}}let ane=0;const Uo=new Tt,wM=new Er,wf=new me,fo=new Ti,ag=new Ti,br=new me;class nr extends im{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ane++}),this.uuid=S1(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(tG(e)?cG:lG)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new mn().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Uo.makeRotationFromQuaternion(e),this.applyMatrix4(Uo),this}rotateX(e){return Uo.makeRotationX(e),this.applyMatrix4(Uo),this}rotateY(e){return Uo.makeRotationY(e),this.applyMatrix4(Uo),this}rotateZ(e){return Uo.makeRotationZ(e),this.applyMatrix4(Uo),this}translate(e,t,n){return Uo.makeTranslation(e,t,n),this.applyMatrix4(Uo),this}scale(e,t,n){return Uo.makeScale(e,t,n),this.applyMatrix4(Uo),this}lookAt(e){return wM.lookAt(e),wM.updateMatrix(),this.applyMatrix4(wM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(wf).negate(),this.translate(wf.x,wf.y,wf.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ai(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ti);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new me(-1/0,-1/0,-1/0),new me(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const s=t[n];fo.setFromBufferAttribute(s),this.morphTargetsRelative?(br.addVectors(this.boundingBox.min,fo.min),this.boundingBox.expandByPoint(br),br.addVectors(this.boundingBox.max,fo.max),this.boundingBox.expandByPoint(br)):(this.boundingBox.expandByPoint(fo.min),this.boundingBox.expandByPoint(fo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new w1);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new me,1/0);return}if(e){const n=this.boundingSphere.center;if(fo.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];ag.setFromBufferAttribute(a),this.morphTargetsRelative?(br.addVectors(fo.min,ag.min),fo.expandByPoint(br),br.addVectors(fo.max,ag.max),fo.expandByPoint(br)):(fo.expandByPoint(ag.min),fo.expandByPoint(ag.max))}fo.getCenter(n);let r=0;for(let s=0,o=e.count;s<o;s++)br.fromBufferAttribute(e,s),r=Math.max(r,n.distanceToSquared(br));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)br.fromBufferAttribute(a,c),l&&(wf.fromBufferAttribute(e,c),br.add(wf)),r=Math.max(r,n.distanceToSquared(br))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Hi(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let C=0;C<a;C++)c[C]=new me,u[C]=new me;const h=new me,d=new me,f=new me,m=new sn,_=new sn,v=new sn,g=new me,b=new me;function p(C,N,P){h.fromArray(r,C*3),d.fromArray(r,N*3),f.fromArray(r,P*3),m.fromArray(o,C*2),_.fromArray(o,N*2),v.fromArray(o,P*2),d.sub(h),f.sub(h),_.sub(m),v.sub(m);const L=1/(_.x*v.y-v.x*_.y);isFinite(L)&&(g.copy(d).multiplyScalar(v.y).addScaledVector(f,-_.y).multiplyScalar(L),b.copy(f).multiplyScalar(_.x).addScaledVector(d,-v.x).multiplyScalar(L),c[C].add(g),c[N].add(g),c[P].add(g),u[C].add(b),u[N].add(b),u[P].add(b))}let y=this.groups;y.length===0&&(y=[{start:0,count:n.length}]);for(let C=0,N=y.length;C<N;++C){const P=y[C],L=P.start,R=P.count;for(let F=L,V=L+R;F<V;F+=3)p(n[F+0],n[F+1],n[F+2])}const A=new me,w=new me,M=new me,T=new me;function E(C){M.fromArray(s,C*3),T.copy(M);const N=c[C];A.copy(N),A.sub(M.multiplyScalar(M.dot(N))).normalize(),w.crossVectors(T,N);const L=w.dot(u[C])<0?-1:1;l[C*4]=A.x,l[C*4+1]=A.y,l[C*4+2]=A.z,l[C*4+3]=L}for(let C=0,N=y.length;C<N;++C){const P=y[C],L=P.start,R=P.count;for(let F=L,V=L+R;F<V;F+=3)E(n[F+0]),E(n[F+1]),E(n[F+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Hi(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let d=0,f=n.count;d<f;d++)n.setXYZ(d,0,0,0);const r=new me,s=new me,o=new me,a=new me,l=new me,c=new me,u=new me,h=new me;if(e)for(let d=0,f=e.count;d<f;d+=3){const m=e.getX(d+0),_=e.getX(d+1),v=e.getX(d+2);r.fromBufferAttribute(t,m),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,v),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(n,m),l.fromBufferAttribute(n,_),c.fromBufferAttribute(n,v),a.add(u),l.add(u),c.add(u),n.setXYZ(m,a.x,a.y,a.z),n.setXYZ(_,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let d=0,f=t.count;d<f;d+=3)r.fromBufferAttribute(t,d+0),s.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),n.setXYZ(d+0,u.x,u.y,u.z),n.setXYZ(d+1,u.x,u.y,u.z),n.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)br.fromBufferAttribute(e,t),br.normalize(),e.setXYZ(t,br.x,br.y,br.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,d=new c.constructor(l.length*u);let f=0,m=0;for(let _=0,v=l.length;_<v;_++){a.isInterleavedBufferAttribute?f=l[_]*a.data.stride+a.offset:f=l[_]*u;for(let g=0;g<u;g++)d[m++]=c[f++]}return new Hi(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new nr,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,n);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const d=c[u],f=e(d,n);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h];u.push(f.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const XF=new Tt,uh=new ER,q_=new w1,qF=new me,Mf=new me,Af=new me,Ef=new me,MM=new me,Y_=new me,K_=new sn,Z_=new sn,Q_=new sn,YF=new me,KF=new me,ZF=new me,J_=new me,ey=new me;class el extends Er{constructor(e=new nr,t=new aG){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){Y_.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],h=s[l];u!==0&&(MM.fromBufferAttribute(h,e),o?Y_.addScaledVector(MM,u):Y_.addScaledVector(MM.sub(t),u))}t.add(Y_)}return t}raycast(e,t){const n=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),q_.copy(n.boundingSphere),q_.applyMatrix4(s),uh.copy(e.ray).recast(e.near),!(q_.containsPoint(uh.origin)===!1&&(uh.intersectSphere(q_,qF)===null||uh.origin.distanceToSquared(qF)>(e.far-e.near)**2))&&(XF.copy(s).invert(),uh.copy(e.ray).applyMatrix4(XF),!(n.boundingBox!==null&&uh.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,uh)))}_computeIntersections(e,t,n){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,_=d.length;m<_;m++){const v=d[m],g=o[v.materialIndex],b=Math.max(v.start,f.start),p=Math.min(a.count,Math.min(v.start+v.count,f.start+f.count));for(let y=b,A=p;y<A;y+=3){const w=a.getX(y),M=a.getX(y+1),T=a.getX(y+2);r=ty(this,g,e,n,c,u,h,w,M,T),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=v.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),_=Math.min(a.count,f.start+f.count);for(let v=m,g=_;v<g;v+=3){const b=a.getX(v),p=a.getX(v+1),y=a.getX(v+2);r=ty(this,o,e,n,c,u,h,b,p,y),r&&(r.faceIndex=Math.floor(v/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let m=0,_=d.length;m<_;m++){const v=d[m],g=o[v.materialIndex],b=Math.max(v.start,f.start),p=Math.min(l.count,Math.min(v.start+v.count,f.start+f.count));for(let y=b,A=p;y<A;y+=3){const w=y,M=y+1,T=y+2;r=ty(this,g,e,n,c,u,h,w,M,T),r&&(r.faceIndex=Math.floor(y/3),r.face.materialIndex=v.materialIndex,t.push(r))}}else{const m=Math.max(0,f.start),_=Math.min(l.count,f.start+f.count);for(let v=m,g=_;v<g;v+=3){const b=v,p=v+1,y=v+2;r=ty(this,o,e,n,c,u,h,b,p,y),r&&(r.faceIndex=Math.floor(v/3),t.push(r))}}}}function lne(i,e,t,n,r,s,o,a){let l;if(e.side===Es?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,e.side===uc,a),l===null)return null;ey.copy(a),ey.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(ey);return c<t.near||c>t.far?null:{distance:c,point:ey.clone(),object:i}}function ty(i,e,t,n,r,s,o,a,l,c){i.getVertexPosition(a,Mf),i.getVertexPosition(l,Af),i.getVertexPosition(c,Ef);const u=lne(i,e,t,n,Mf,Af,Ef,J_);if(u){r&&(K_.fromBufferAttribute(r,a),Z_.fromBufferAttribute(r,l),Q_.fromBufferAttribute(r,c),u.uv=Sa.getInterpolation(J_,Mf,Af,Ef,K_,Z_,Q_,new sn)),s&&(K_.fromBufferAttribute(s,a),Z_.fromBufferAttribute(s,l),Q_.fromBufferAttribute(s,c),u.uv1=Sa.getInterpolation(J_,Mf,Af,Ef,K_,Z_,Q_,new sn),u.uv2=u.uv1),o&&(YF.fromBufferAttribute(o,a),KF.fromBufferAttribute(o,l),ZF.fromBufferAttribute(o,c),u.normal=Sa.getInterpolation(J_,Mf,Af,Ef,YF,KF,ZF,new me),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:l,c,normal:new me,materialIndex:0};Sa.getNormal(Mf,Af,Ef,h.normal),u.face=h}return u}class sm extends nr{constructor(e=1,t=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],h=[];let d=0,f=0;m("z","y","x",-1,-1,n,t,e,o,s,0),m("z","y","x",1,-1,n,t,-e,o,s,1),m("x","z","y",1,1,e,n,t,r,o,2),m("x","z","y",1,-1,e,n,-t,r,o,3),m("x","y","z",1,-1,e,t,n,r,s,4),m("x","y","z",-1,-1,e,t,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new ai(c,3)),this.setAttribute("normal",new ai(u,3)),this.setAttribute("uv",new ai(h,2));function m(_,v,g,b,p,y,A,w,M,T,E){const C=y/M,N=A/T,P=y/2,L=A/2,R=w/2,F=M+1,V=T+1;let z=0,U=0;const G=new me;for(let B=0;B<V;B++){const D=B*N-L;for(let O=0;O<F;O++){const j=O*C-P;G[_]=j*b,G[v]=D*p,G[g]=R,c.push(G.x,G.y,G.z),G[_]=0,G[v]=0,G[g]=w>0?1:-1,u.push(G.x,G.y,G.z),h.push(O/M),h.push(1-B/T),z+=1}}for(let B=0;B<T;B++)for(let D=0;D<M;D++){const O=d+D+F*B,j=d+D+F*(B+1),q=d+(D+1)+F*(B+1),Y=d+(D+1)+F*B;l.push(O,j,Y),l.push(j,q,Y),U+=6}a.addGroup(f,U,E),f+=U,d+=z}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sm(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Vp(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const r=i[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function _s(i){const e={};for(let t=0;t<i.length;t++){const n=Vp(i[t]);for(const r in n)e[r]=n[r]}return e}function cne(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function uG(i){return i.getRenderTarget()===null?i.outputColorSpace:jn.workingColorSpace}const ux={clone:Vp,merge:_s};var une=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,hne=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Yo extends rm{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=une,this.fragmentShader=hne,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Vp(e.uniforms),this.uniformsGroups=cne(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class hG extends Er{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Tt,this.projectionMatrix=new Tt,this.projectionMatrixInverse=new Tt,this.coordinateSystem=Ql}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Hs extends hG{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=qT*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(cx*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return qT*2*Math.atan(Math.tan(cx*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(cx*.5*this.fov)/this.zoom,n=2*t,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*n/c,r*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Tf=-90,Cf=1;class dne extends Er{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Hs(Tf,Cf,e,t);r.layers=this.layers,this.add(r);const s=new Hs(Tf,Cf,e,t);s.layers=this.layers,this.add(s);const o=new Hs(Tf,Cf,e,t);o.layers=this.layers,this.add(o);const a=new Hs(Tf,Cf,e,t);a.layers=this.layers,this.add(a);const l=new Hs(Tf,Cf,e,t);l.layers=this.layers,this.add(l);const c=new Hs(Tf,Cf,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===Ql)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===ob)n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),m=e.xr.enabled;e.xr.enabled=!1;const _=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,s),e.setRenderTarget(n,1,r),e.render(t,o),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,l),e.setRenderTarget(n,4,r),e.render(t,c),n.texture.generateMipmaps=_,e.setRenderTarget(n,5,r),e.render(t,u),e.setRenderTarget(h,d,f),e.xr.enabled=m,n.texture.needsPMREMUpdate=!0}}class dG extends Ts{constructor(e,t,n,r,s,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:Op,super(e,t,n,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class fne extends ol{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];t.encoding!==void 0&&(e0("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Yh?Dr:Wo),this.texture=new dG(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:es}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new sm(5,5,5),s=new Yo({name:"CubemapFromEquirect",uniforms:Vp(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Es,blending:tc});s.uniforms.tEquirect.value=t;const o=new el(r,s),a=t.minFilter;return t.minFilter===q0&&(t.minFilter=es),new dne(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,r);e.setRenderTarget(s)}}const AM=new me,pne=new me,mne=new mn;class Sh{constructor(e=new me(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=AM.subVectors(n,t).cross(pne.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(AM),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||mne.getNormalMatrix(e),r=this.coplanarPoint(AM).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const hh=new w1,ny=new me;class TR{constructor(e=new Sh,t=new Sh,n=new Sh,r=new Sh,s=new Sh,o=new Sh){this.planes=[e,t,n,r,s,o]}set(e,t,n,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Ql){const n=this.planes,r=e.elements,s=r[0],o=r[1],a=r[2],l=r[3],c=r[4],u=r[5],h=r[6],d=r[7],f=r[8],m=r[9],_=r[10],v=r[11],g=r[12],b=r[13],p=r[14],y=r[15];if(n[0].setComponents(l-s,d-c,v-f,y-g).normalize(),n[1].setComponents(l+s,d+c,v+f,y+g).normalize(),n[2].setComponents(l+o,d+u,v+m,y+b).normalize(),n[3].setComponents(l-o,d-u,v-m,y-b).normalize(),n[4].setComponents(l-a,d-h,v-_,y-p).normalize(),t===Ql)n[5].setComponents(l+a,d+h,v+_,y+p).normalize();else if(t===ob)n[5].setComponents(a,h,_,p).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),hh.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),hh.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(hh)}intersectsSprite(e){return hh.center.set(0,0,0),hh.radius=.7071067811865476,hh.applyMatrix4(e.matrixWorld),this.intersectsSphere(hh)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(ny.x=r.normal.x>0?e.max.x:e.min.x,ny.y=r.normal.y>0?e.max.y:e.min.y,ny.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(ny)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function fG(){let i=null,e=!1,t=null,n=null;function r(s,o){t(s,o),n=i.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(r),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){i=s}}}function gne(i,e){const t=e.isWebGL2,n=new WeakMap;function r(c,u){const h=c.array,d=c.usage,f=i.createBuffer();i.bindBuffer(u,f),i.bufferData(u,h,d),c.onUploadCallback();let m;if(h instanceof Float32Array)m=i.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)m=i.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else m=i.UNSIGNED_SHORT;else if(h instanceof Int16Array)m=i.SHORT;else if(h instanceof Uint32Array)m=i.UNSIGNED_INT;else if(h instanceof Int32Array)m=i.INT;else if(h instanceof Int8Array)m=i.BYTE;else if(h instanceof Uint8Array)m=i.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)m=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:f,type:m,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){const d=u.array,f=u.updateRange;i.bindBuffer(h,c),f.count===-1?i.bufferSubData(h,0,d):(t?i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):i.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=n.get(c);u&&(i.deleteBuffer(u.buffer),n.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const d=n.get(c);(!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=n.get(c);h===void 0?n.set(c,r(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:o,remove:a,update:l}}class xS extends nr{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(r),c=a+1,u=l+1,h=e/a,d=t/l,f=[],m=[],_=[],v=[];for(let g=0;g<u;g++){const b=g*d-o;for(let p=0;p<c;p++){const y=p*h-s;m.push(y,-b,0),_.push(0,0,1),v.push(p/a),v.push(1-g/l)}}for(let g=0;g<l;g++)for(let b=0;b<a;b++){const p=b+c*g,y=b+c*(g+1),A=b+1+c*(g+1),w=b+1+c*g;f.push(p,y,w),f.push(y,A,w)}this.setIndex(f),this.setAttribute("position",new ai(m,3)),this.setAttribute("normal",new ai(_,3)),this.setAttribute("uv",new ai(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xS(e.width,e.height,e.widthSegments,e.heightSegments)}}var vne=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,_ne=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,yne=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,xne=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,bne=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Sne=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,wne=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Mne=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Ane=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Ene=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Tne=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Cne=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Pne=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Rne=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Ine=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Lne=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Dne=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Nne=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Fne=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,kne=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Une=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,One=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Bne=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,zne=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Gne=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Vne=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Hne=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,$ne=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Wne="gl_FragColor = linearToOutputTexel( gl_FragColor );",jne=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Xne=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,qne=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Yne=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Kne=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Zne=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Qne=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Jne=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,eie=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,tie=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,nie=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,iie=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,rie=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,sie=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,oie=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,aie=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lie=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,cie=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,uie=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,hie=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,die=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,fie=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,pie=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,mie=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,gie=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,vie=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,_ie=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,yie=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,xie=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,bie=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Sie=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,wie=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Mie=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Aie=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Eie=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Tie=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Cie=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Pie=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Rie=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Iie=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Lie=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Die=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Nie=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Fie=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,kie=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Uie=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Oie=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Bie=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,zie=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Gie=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Vie=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Hie=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,$ie=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Wie=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,jie=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Xie=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,qie=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Yie=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Kie=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Zie=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Qie=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Jie=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,ere=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,tre=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,nre=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,ire=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,rre=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,sre=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,ore=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,are=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,lre=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,cre=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,ure=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,hre=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,dre=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,fre=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const pre=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,mre=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,gre=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,vre=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,_re=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,yre=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xre=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,bre=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Sre=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,wre=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Mre=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Are=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Ere=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Tre=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Cre=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Pre=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Rre=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ire=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Lre=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Dre=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Nre=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Fre=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,kre=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ure=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ore=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Bre=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zre=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Gre=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Vre=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Hre=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,$re=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Wre=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,jre=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Xre=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,dn={alphahash_fragment:vne,alphahash_pars_fragment:_ne,alphamap_fragment:yne,alphamap_pars_fragment:xne,alphatest_fragment:bne,alphatest_pars_fragment:Sne,aomap_fragment:wne,aomap_pars_fragment:Mne,begin_vertex:Ane,beginnormal_vertex:Ene,bsdfs:Tne,iridescence_fragment:Cne,bumpmap_pars_fragment:Pne,clipping_planes_fragment:Rne,clipping_planes_pars_fragment:Ine,clipping_planes_pars_vertex:Lne,clipping_planes_vertex:Dne,color_fragment:Nne,color_pars_fragment:Fne,color_pars_vertex:kne,color_vertex:Une,common:One,cube_uv_reflection_fragment:Bne,defaultnormal_vertex:zne,displacementmap_pars_vertex:Gne,displacementmap_vertex:Vne,emissivemap_fragment:Hne,emissivemap_pars_fragment:$ne,colorspace_fragment:Wne,colorspace_pars_fragment:jne,envmap_fragment:Xne,envmap_common_pars_fragment:qne,envmap_pars_fragment:Yne,envmap_pars_vertex:Kne,envmap_physical_pars_fragment:lie,envmap_vertex:Zne,fog_vertex:Qne,fog_pars_vertex:Jne,fog_fragment:eie,fog_pars_fragment:tie,gradientmap_pars_fragment:nie,lightmap_fragment:iie,lightmap_pars_fragment:rie,lights_lambert_fragment:sie,lights_lambert_pars_fragment:oie,lights_pars_begin:aie,lights_toon_fragment:cie,lights_toon_pars_fragment:uie,lights_phong_fragment:hie,lights_phong_pars_fragment:die,lights_physical_fragment:fie,lights_physical_pars_fragment:pie,lights_fragment_begin:mie,lights_fragment_maps:gie,lights_fragment_end:vie,logdepthbuf_fragment:_ie,logdepthbuf_pars_fragment:yie,logdepthbuf_pars_vertex:xie,logdepthbuf_vertex:bie,map_fragment:Sie,map_pars_fragment:wie,map_particle_fragment:Mie,map_particle_pars_fragment:Aie,metalnessmap_fragment:Eie,metalnessmap_pars_fragment:Tie,morphcolor_vertex:Cie,morphnormal_vertex:Pie,morphtarget_pars_vertex:Rie,morphtarget_vertex:Iie,normal_fragment_begin:Lie,normal_fragment_maps:Die,normal_pars_fragment:Nie,normal_pars_vertex:Fie,normal_vertex:kie,normalmap_pars_fragment:Uie,clearcoat_normal_fragment_begin:Oie,clearcoat_normal_fragment_maps:Bie,clearcoat_pars_fragment:zie,iridescence_pars_fragment:Gie,opaque_fragment:Vie,packing:Hie,premultiplied_alpha_fragment:$ie,project_vertex:Wie,dithering_fragment:jie,dithering_pars_fragment:Xie,roughnessmap_fragment:qie,roughnessmap_pars_fragment:Yie,shadowmap_pars_fragment:Kie,shadowmap_pars_vertex:Zie,shadowmap_vertex:Qie,shadowmask_pars_fragment:Jie,skinbase_vertex:ere,skinning_pars_vertex:tre,skinning_vertex:nre,skinnormal_vertex:ire,specularmap_fragment:rre,specularmap_pars_fragment:sre,tonemapping_fragment:ore,tonemapping_pars_fragment:are,transmission_fragment:lre,transmission_pars_fragment:cre,uv_pars_fragment:ure,uv_pars_vertex:hre,uv_vertex:dre,worldpos_vertex:fre,background_vert:pre,background_frag:mre,backgroundCube_vert:gre,backgroundCube_frag:vre,cube_vert:_re,cube_frag:yre,depth_vert:xre,depth_frag:bre,distanceRGBA_vert:Sre,distanceRGBA_frag:wre,equirect_vert:Mre,equirect_frag:Are,linedashed_vert:Ere,linedashed_frag:Tre,meshbasic_vert:Cre,meshbasic_frag:Pre,meshlambert_vert:Rre,meshlambert_frag:Ire,meshmatcap_vert:Lre,meshmatcap_frag:Dre,meshnormal_vert:Nre,meshnormal_frag:Fre,meshphong_vert:kre,meshphong_frag:Ure,meshphysical_vert:Ore,meshphysical_frag:Bre,meshtoon_vert:zre,meshtoon_frag:Gre,points_vert:Vre,points_frag:Hre,shadow_vert:$re,shadow_frag:Wre,sprite_vert:jre,sprite_frag:Xre},Ft={common:{diffuse:{value:new Ht(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new mn},alphaMap:{value:null},alphaMapTransform:{value:new mn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new mn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new mn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new mn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new mn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new mn},normalScale:{value:new sn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new mn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new mn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new mn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new mn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ht(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ht(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new mn},alphaTest:{value:0},uvTransform:{value:new mn}},sprite:{diffuse:{value:new Ht(16777215)},opacity:{value:1},center:{value:new sn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new mn},alphaMap:{value:null},alphaMapTransform:{value:new mn},alphaTest:{value:0}}},Ka={basic:{uniforms:_s([Ft.common,Ft.specularmap,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.fog]),vertexShader:dn.meshbasic_vert,fragmentShader:dn.meshbasic_frag},lambert:{uniforms:_s([Ft.common,Ft.specularmap,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.fog,Ft.lights,{emissive:{value:new Ht(0)}}]),vertexShader:dn.meshlambert_vert,fragmentShader:dn.meshlambert_frag},phong:{uniforms:_s([Ft.common,Ft.specularmap,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.fog,Ft.lights,{emissive:{value:new Ht(0)},specular:{value:new Ht(1118481)},shininess:{value:30}}]),vertexShader:dn.meshphong_vert,fragmentShader:dn.meshphong_frag},standard:{uniforms:_s([Ft.common,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.roughnessmap,Ft.metalnessmap,Ft.fog,Ft.lights,{emissive:{value:new Ht(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:dn.meshphysical_vert,fragmentShader:dn.meshphysical_frag},toon:{uniforms:_s([Ft.common,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.gradientmap,Ft.fog,Ft.lights,{emissive:{value:new Ht(0)}}]),vertexShader:dn.meshtoon_vert,fragmentShader:dn.meshtoon_frag},matcap:{uniforms:_s([Ft.common,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.fog,{matcap:{value:null}}]),vertexShader:dn.meshmatcap_vert,fragmentShader:dn.meshmatcap_frag},points:{uniforms:_s([Ft.points,Ft.fog]),vertexShader:dn.points_vert,fragmentShader:dn.points_frag},dashed:{uniforms:_s([Ft.common,Ft.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:dn.linedashed_vert,fragmentShader:dn.linedashed_frag},depth:{uniforms:_s([Ft.common,Ft.displacementmap]),vertexShader:dn.depth_vert,fragmentShader:dn.depth_frag},normal:{uniforms:_s([Ft.common,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,{opacity:{value:1}}]),vertexShader:dn.meshnormal_vert,fragmentShader:dn.meshnormal_frag},sprite:{uniforms:_s([Ft.sprite,Ft.fog]),vertexShader:dn.sprite_vert,fragmentShader:dn.sprite_frag},background:{uniforms:{uvTransform:{value:new mn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:dn.background_vert,fragmentShader:dn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:dn.backgroundCube_vert,fragmentShader:dn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:dn.cube_vert,fragmentShader:dn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:dn.equirect_vert,fragmentShader:dn.equirect_frag},distanceRGBA:{uniforms:_s([Ft.common,Ft.displacementmap,{referencePosition:{value:new me},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:dn.distanceRGBA_vert,fragmentShader:dn.distanceRGBA_frag},shadow:{uniforms:_s([Ft.lights,Ft.fog,{color:{value:new Ht(0)},opacity:{value:1}}]),vertexShader:dn.shadow_vert,fragmentShader:dn.shadow_frag}};Ka.physical={uniforms:_s([Ka.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new mn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new mn},clearcoatNormalScale:{value:new sn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new mn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new mn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new mn},sheen:{value:0},sheenColor:{value:new Ht(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new mn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new mn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new mn},transmissionSamplerSize:{value:new sn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new mn},attenuationDistance:{value:0},attenuationColor:{value:new Ht(0)},specularColor:{value:new Ht(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new mn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new mn},anisotropyVector:{value:new sn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new mn}}]),vertexShader:dn.meshphysical_vert,fragmentShader:dn.meshphysical_frag};const iy={r:0,b:0,g:0};function qre(i,e,t,n,r,s,o){const a=new Ht(0);let l=s===!0?0:1,c,u,h=null,d=0,f=null;function m(v,g){let b=!1,p=g.isScene===!0?g.background:null;p&&p.isTexture&&(p=(g.backgroundBlurriness>0?t:e).get(p)),p===null?_(a,l):p&&p.isColor&&(_(p,1),b=!0);const y=i.xr.getEnvironmentBlendMode();y==="additive"?n.buffers.color.setClear(0,0,0,1,o):y==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(i.autoClear||b)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),p&&(p.isCubeTexture||p.mapping===_S)?(u===void 0&&(u=new el(new sm(1,1,1),new Yo({name:"BackgroundCubeMaterial",uniforms:Vp(Ka.backgroundCube.uniforms),vertexShader:Ka.backgroundCube.vertexShader,fragmentShader:Ka.backgroundCube.fragmentShader,side:Es,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(A,w,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=p,u.material.uniforms.flipEnvMap.value=p.isCubeTexture&&p.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=jn.getTransfer(p.colorSpace)!==ri,(h!==p||d!==p.version||f!==i.toneMapping)&&(u.material.needsUpdate=!0,h=p,d=p.version,f=i.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):p&&p.isTexture&&(c===void 0&&(c=new el(new xS(2,2),new Yo({name:"BackgroundMaterial",uniforms:Vp(Ka.background.uniforms),vertexShader:Ka.background.vertexShader,fragmentShader:Ka.background.fragmentShader,side:uc,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=p,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=jn.getTransfer(p.colorSpace)!==ri,p.matrixAutoUpdate===!0&&p.updateMatrix(),c.material.uniforms.uvTransform.value.copy(p.matrix),(h!==p||d!==p.version||f!==i.toneMapping)&&(c.material.needsUpdate=!0,h=p,d=p.version,f=i.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}function _(v,g){v.getRGB(iy,uG(i)),n.buffers.color.setClear(iy.r,iy.g,iy.b,g,o)}return{getClearColor:function(){return a},setClearColor:function(v,g=1){a.set(v),l=g,_(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,_(a,l)},render:m}}function Yre(i,e,t,n){const r=i.getParameter(i.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=v(null);let c=l,u=!1;function h(R,F,V,z,U){let G=!1;if(o){const B=_(z,V,F);c!==B&&(c=B,f(c.object)),G=g(R,z,V,U),G&&b(R,z,V,U)}else{const B=F.wireframe===!0;(c.geometry!==z.id||c.program!==V.id||c.wireframe!==B)&&(c.geometry=z.id,c.program=V.id,c.wireframe=B,G=!0)}U!==null&&t.update(U,i.ELEMENT_ARRAY_BUFFER),(G||u)&&(u=!1,T(R,F,V,z),U!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.get(U).buffer))}function d(){return n.isWebGL2?i.createVertexArray():s.createVertexArrayOES()}function f(R){return n.isWebGL2?i.bindVertexArray(R):s.bindVertexArrayOES(R)}function m(R){return n.isWebGL2?i.deleteVertexArray(R):s.deleteVertexArrayOES(R)}function _(R,F,V){const z=V.wireframe===!0;let U=a[R.id];U===void 0&&(U={},a[R.id]=U);let G=U[F.id];G===void 0&&(G={},U[F.id]=G);let B=G[z];return B===void 0&&(B=v(d()),G[z]=B),B}function v(R){const F=[],V=[],z=[];for(let U=0;U<r;U++)F[U]=0,V[U]=0,z[U]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:V,attributeDivisors:z,object:R,attributes:{},index:null}}function g(R,F,V,z){const U=c.attributes,G=F.attributes;let B=0;const D=V.getAttributes();for(const O in D)if(D[O].location>=0){const q=U[O];let Y=G[O];if(Y===void 0&&(O==="instanceMatrix"&&R.instanceMatrix&&(Y=R.instanceMatrix),O==="instanceColor"&&R.instanceColor&&(Y=R.instanceColor)),q===void 0||q.attribute!==Y||Y&&q.data!==Y.data)return!0;B++}return c.attributesNum!==B||c.index!==z}function b(R,F,V,z){const U={},G=F.attributes;let B=0;const D=V.getAttributes();for(const O in D)if(D[O].location>=0){let q=G[O];q===void 0&&(O==="instanceMatrix"&&R.instanceMatrix&&(q=R.instanceMatrix),O==="instanceColor"&&R.instanceColor&&(q=R.instanceColor));const Y={};Y.attribute=q,q&&q.data&&(Y.data=q.data),U[O]=Y,B++}c.attributes=U,c.attributesNum=B,c.index=z}function p(){const R=c.newAttributes;for(let F=0,V=R.length;F<V;F++)R[F]=0}function y(R){A(R,0)}function A(R,F){const V=c.newAttributes,z=c.enabledAttributes,U=c.attributeDivisors;V[R]=1,z[R]===0&&(i.enableVertexAttribArray(R),z[R]=1),U[R]!==F&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,F),U[R]=F)}function w(){const R=c.newAttributes,F=c.enabledAttributes;for(let V=0,z=F.length;V<z;V++)F[V]!==R[V]&&(i.disableVertexAttribArray(V),F[V]=0)}function M(R,F,V,z,U,G,B){B===!0?i.vertexAttribIPointer(R,F,V,U,G):i.vertexAttribPointer(R,F,V,z,U,G)}function T(R,F,V,z){if(n.isWebGL2===!1&&(R.isInstancedMesh||z.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;p();const U=z.attributes,G=V.getAttributes(),B=F.defaultAttributeValues;for(const D in G){const O=G[D];if(O.location>=0){let j=U[D];if(j===void 0&&(D==="instanceMatrix"&&R.instanceMatrix&&(j=R.instanceMatrix),D==="instanceColor"&&R.instanceColor&&(j=R.instanceColor)),j!==void 0){const q=j.normalized,Y=j.itemSize,ie=t.get(j);if(ie===void 0)continue;const ne=ie.buffer,Q=ie.type,le=ie.bytesPerElement,se=n.isWebGL2===!0&&(Q===i.INT||Q===i.UNSIGNED_INT||j.gpuType===q8);if(j.isInterleavedBufferAttribute){const oe=j.data,$=oe.stride,pe=j.offset;if(oe.isInstancedInterleavedBuffer){for(let xe=0;xe<O.locationSize;xe++)A(O.location+xe,oe.meshPerAttribute);R.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let xe=0;xe<O.locationSize;xe++)y(O.location+xe);i.bindBuffer(i.ARRAY_BUFFER,ne);for(let xe=0;xe<O.locationSize;xe++)M(O.location+xe,Y/O.locationSize,Q,q,$*le,(pe+Y/O.locationSize*xe)*le,se)}else{if(j.isInstancedBufferAttribute){for(let oe=0;oe<O.locationSize;oe++)A(O.location+oe,j.meshPerAttribute);R.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=j.meshPerAttribute*j.count)}else for(let oe=0;oe<O.locationSize;oe++)y(O.location+oe);i.bindBuffer(i.ARRAY_BUFFER,ne);for(let oe=0;oe<O.locationSize;oe++)M(O.location+oe,Y/O.locationSize,Q,q,Y*le,Y/O.locationSize*oe*le,se)}}else if(B!==void 0){const q=B[D];if(q!==void 0)switch(q.length){case 2:i.vertexAttrib2fv(O.location,q);break;case 3:i.vertexAttrib3fv(O.location,q);break;case 4:i.vertexAttrib4fv(O.location,q);break;default:i.vertexAttrib1fv(O.location,q)}}}}w()}function E(){P();for(const R in a){const F=a[R];for(const V in F){const z=F[V];for(const U in z)m(z[U].object),delete z[U];delete F[V]}delete a[R]}}function C(R){if(a[R.id]===void 0)return;const F=a[R.id];for(const V in F){const z=F[V];for(const U in z)m(z[U].object),delete z[U];delete F[V]}delete a[R.id]}function N(R){for(const F in a){const V=a[F];if(V[R.id]===void 0)continue;const z=V[R.id];for(const U in z)m(z[U].object),delete z[U];delete V[R.id]}}function P(){L(),u=!0,c!==l&&(c=l,f(c.object))}function L(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:P,resetDefaultState:L,dispose:E,releaseStatesOfGeometry:C,releaseStatesOfProgram:N,initAttributes:p,enableAttribute:y,disableUnusedAttributes:w}}function Kre(i,e,t,n){const r=n.isWebGL2;let s;function o(c){s=c}function a(c,u){i.drawArrays(s,c,u),t.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,f;if(r)d=i,f="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](s,c,u,h),t.update(u,s,h)}this.setMode=o,this.render=a,this.renderInstances=l}function Zre(i,e,t){let n;function r(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(M){if(M==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";M="mediump"}return M==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&i.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),d=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=i.getParameter(i.MAX_TEXTURE_SIZE),m=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),_=i.getParameter(i.MAX_VERTEX_ATTRIBS),v=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),g=i.getParameter(i.MAX_VARYING_VECTORS),b=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),p=d>0,y=o||e.has("OES_texture_float"),A=p&&y,w=o?i.getParameter(i.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:m,maxAttributes:_,maxVertexUniforms:v,maxVaryings:g,maxFragmentUniforms:b,vertexTextures:p,floatFragmentTextures:y,floatVertexTextures:A,maxSamples:w}}function Qre(i){const e=this;let t=null,n=0,r=!1,s=!1;const o=new Sh,a=new mn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||n!==0||r;return r=d,n=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){t=u(h,d,0)},this.setState=function(h,d,f){const m=h.clippingPlanes,_=h.clipIntersection,v=h.clipShadows,g=i.get(h);if(!r||m===null||m.length===0||s&&!v)s?u(null):c();else{const b=s?0:n,p=b*4;let y=g.clippingState||null;l.value=y,y=u(m,d,p,f);for(let A=0;A!==p;++A)y[A]=t[A];g.clippingState=y,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,d,f,m){const _=h!==null?h.length:0;let v=null;if(_!==0){if(v=l.value,m!==!0||v===null){const g=f+_*4,b=d.matrixWorldInverse;a.getNormalMatrix(b),(v===null||v.length<g)&&(v=new Float32Array(g));for(let p=0,y=f;p!==_;++p,y+=4)o.copy(h[p]).applyMatrix4(b,a),o.normal.toArray(v,y),v[y+3]=o.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,v}}function Jre(i){let e=new WeakMap;function t(o,a){return a===HT?o.mapping=Op:a===$T&&(o.mapping=Bp),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===HT||a===$T)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new fne(l.height/2);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}class Y0 extends hG{constructor(e=-1,t=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const rp=4,QF=[.125,.215,.35,.446,.526,.582],Th=20,EM=new Y0,JF=new Ht;let TM=null,CM=0,PM=0;const wh=(1+Math.sqrt(5))/2,Pf=1/wh,ek=[new me(1,1,1),new me(-1,1,1),new me(1,1,-1),new me(-1,1,-1),new me(0,wh,Pf),new me(0,wh,-Pf),new me(Pf,0,wh),new me(-Pf,0,wh),new me(wh,Pf,0),new me(-wh,Pf,0)];class tk{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){TM=this._renderer.getRenderTarget(),CM=this._renderer.getActiveCubeFace(),PM=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=rk(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=ik(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(TM,CM,PM),e.scissorTest=!1,ry(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Op||e.mapping===Bp?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),TM=this._renderer.getRenderTarget(),CM=this._renderer.getActiveCubeFace(),PM=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:es,minFilter:es,generateMipmaps:!1,type:ld,format:Ws,colorSpace:hc,depthBuffer:!1},r=nk(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=nk(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=ese(s)),this._blurMaterial=tse(s,e,t)}return r}_compileMaterial(e){const t=new el(this._lodPlanes[0],e);this._renderer.compile(t,EM)}_sceneToCubeUV(e,t,n,r){const a=new Hs(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(JF),u.toneMapping=gu,u.autoClear=!1;const f=new aG({name:"PMREM.Background",side:Es,depthWrite:!1,depthTest:!1}),m=new el(new sm,f);let _=!1;const v=e.background;v?v.isColor&&(f.color.copy(v),e.background=null,_=!0):(f.color.copy(JF),_=!0);for(let g=0;g<6;g++){const b=g%3;b===0?(a.up.set(0,l[g],0),a.lookAt(c[g],0,0)):b===1?(a.up.set(0,0,l[g]),a.lookAt(0,c[g],0)):(a.up.set(0,l[g],0),a.lookAt(0,0,c[g]));const p=this._cubeSize;ry(r,b*p,g>2?p:0,p,p),u.setRenderTarget(r),_&&u.render(m,a),u.render(e,a)}m.geometry.dispose(),m.material.dispose(),u.toneMapping=d,u.autoClear=h,e.background=v}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===Op||e.mapping===Bp;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=rk()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=ik());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new el(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;ry(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,EM)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=ek[(r-1)%ek.length];this._blur(e,r-1,r,s,o)}t.autoClear=n}_blur(e,t,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",s),this._halfBlur(o,e,n,n,r,"longitudinal",s)}_halfBlur(e,t,n,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new el(this._lodPlanes[r],c),d=c.uniforms,f=this._sizeLods[n]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*Th-1),_=s/m,v=isFinite(s)?1+Math.floor(u*_):Th;v>Th&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Th}`);const g=[];let b=0;for(let M=0;M<Th;++M){const T=M/_,E=Math.exp(-T*T/2);g.push(E),M===0?b+=E:M<v&&(b+=2*E)}for(let M=0;M<g.length;M++)g[M]=g[M]/b;d.envMap.value=e.texture,d.samples.value=v,d.weights.value=g,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:p}=this;d.dTheta.value=m,d.mipInt.value=p-n;const y=this._sizeLods[r],A=3*y*(r>p-rp?r-p+rp:0),w=4*(this._cubeSize-y);ry(t,A,w,3*y,2*y),l.setRenderTarget(t),l.render(h,EM)}}function ese(i){const e=[],t=[],n=[];let r=i;const s=i-rp+1+QF.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>i-rp?l=QF[o-i+rp-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,m=6,_=3,v=2,g=1,b=new Float32Array(_*m*f),p=new Float32Array(v*m*f),y=new Float32Array(g*m*f);for(let w=0;w<f;w++){const M=w%3*2/3-1,T=w>2?0:-1,E=[M,T,0,M+2/3,T,0,M+2/3,T+1,0,M,T,0,M+2/3,T+1,0,M,T+1,0];b.set(E,_*m*w),p.set(d,v*m*w);const C=[w,w,w,w,w,w];y.set(C,g*m*w)}const A=new nr;A.setAttribute("position",new Hi(b,_)),A.setAttribute("uv",new Hi(p,v)),A.setAttribute("faceIndex",new Hi(y,g)),e.push(A),r>rp&&r--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function nk(i,e,t){const n=new ol(i,e,t);return n.texture.mapping=_S,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function ry(i,e,t,n,r){i.viewport.set(e,t,n,r),i.scissor.set(e,t,n,r)}function tse(i,e,t){const n=new Float32Array(Th),r=new me(0,1,0);return new Yo({name:"SphericalGaussianBlur",defines:{n:Th,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:CR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:tc,depthTest:!1,depthWrite:!1})}function ik(){return new Yo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:CR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:tc,depthTest:!1,depthWrite:!1})}function rk(){return new Yo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:CR(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:tc,depthTest:!1,depthWrite:!1})}function CR(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function nse(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===HT||l===$T,u=l===Op||l===Bp;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new tk(i)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{const h=a.image;if(c&&h&&h.height>0||u&&h&&r(h)){t===null&&(t=new tk(i));const d=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",s),d.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function ise(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const r=t(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function rse(i,e,t,n){const r={},s=new WeakMap;function o(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const m in d.attributes)e.remove(d.attributes[m]);for(const m in d.morphAttributes){const _=d.morphAttributes[m];for(let v=0,g=_.length;v<g;v++)e.remove(_[v])}d.removeEventListener("dispose",o),delete r[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){return r[d.id]===!0||(d.addEventListener("dispose",o),r[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const m in d)e.update(d[m],i.ARRAY_BUFFER);const f=h.morphAttributes;for(const m in f){const _=f[m];for(let v=0,g=_.length;v<g;v++)e.update(_[v],i.ARRAY_BUFFER)}}function c(h){const d=[],f=h.index,m=h.attributes.position;let _=0;if(f!==null){const b=f.array;_=f.version;for(let p=0,y=b.length;p<y;p+=3){const A=b[p+0],w=b[p+1],M=b[p+2];d.push(A,w,w,M,M,A)}}else if(m!==void 0){const b=m.array;_=m.version;for(let p=0,y=b.length/3-1;p<y;p+=3){const A=p+0,w=p+1,M=p+2;d.push(A,w,w,M,M,A)}}else return;const v=new(tG(d)?cG:lG)(d,1);v.version=_;const g=s.get(h);g&&e.remove(g),s.set(h,v)}function u(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function sse(i,e,t,n){const r=n.isWebGL2;let s;function o(d){s=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function u(d,f){i.drawElements(s,f,a,d*l),t.update(f,s,1)}function h(d,f,m){if(m===0)return;let _,v;if(r)_=i,v="drawElementsInstanced";else if(_=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",_===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}_[v](s,f,a,d*l,m),t.update(f,s,m)}this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=h}function ose(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case i.TRIANGLES:t.triangles+=a*(s/3);break;case i.LINES:t.lines+=a*(s/2);break;case i.LINE_STRIP:t.lines+=a*(s-1);break;case i.LINE_LOOP:t.lines+=a*s;break;case i.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:n}}function ase(i,e){return i[0]-e[0]}function lse(i,e){return Math.abs(e[1])-Math.abs(i[1])}function cse(i,e,t){const n={},r=new Float32Array(8),s=new WeakMap,o=new Mr,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,h){const d=c.morphTargetInfluences;if(e.isWebGL2===!0){const m=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,_=m!==void 0?m.length:0;let v=s.get(u);if(v===void 0||v.count!==_){let F=function(){L.dispose(),s.delete(u),u.removeEventListener("dispose",F)};var f=F;v!==void 0&&v.texture.dispose();const p=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,A=u.morphAttributes.color!==void 0,w=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],T=u.morphAttributes.color||[];let E=0;p===!0&&(E=1),y===!0&&(E=2),A===!0&&(E=3);let C=u.attributes.position.count*E,N=1;C>e.maxTextureSize&&(N=Math.ceil(C/e.maxTextureSize),C=e.maxTextureSize);const P=new Float32Array(C*N*4*_),L=new rG(P,C,N,_);L.type=Ca,L.needsUpdate=!0;const R=E*4;for(let V=0;V<_;V++){const z=w[V],U=M[V],G=T[V],B=C*N*4*V;for(let D=0;D<z.count;D++){const O=D*R;p===!0&&(o.fromBufferAttribute(z,D),P[B+O+0]=o.x,P[B+O+1]=o.y,P[B+O+2]=o.z,P[B+O+3]=0),y===!0&&(o.fromBufferAttribute(U,D),P[B+O+4]=o.x,P[B+O+5]=o.y,P[B+O+6]=o.z,P[B+O+7]=0),A===!0&&(o.fromBufferAttribute(G,D),P[B+O+8]=o.x,P[B+O+9]=o.y,P[B+O+10]=o.z,P[B+O+11]=G.itemSize===4?o.w:1)}}v={count:_,texture:L,size:new sn(C,N)},s.set(u,v),u.addEventListener("dispose",F)}let g=0;for(let p=0;p<d.length;p++)g+=d[p];const b=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(i,"morphTargetBaseInfluence",b),h.getUniforms().setValue(i,"morphTargetInfluences",d),h.getUniforms().setValue(i,"morphTargetsTexture",v.texture,t),h.getUniforms().setValue(i,"morphTargetsTextureSize",v.size)}else{const m=d===void 0?0:d.length;let _=n[u.id];if(_===void 0||_.length!==m){_=[];for(let y=0;y<m;y++)_[y]=[y,0];n[u.id]=_}for(let y=0;y<m;y++){const A=_[y];A[0]=y,A[1]=d[y]}_.sort(lse);for(let y=0;y<8;y++)y<m&&_[y][1]?(a[y][0]=_[y][0],a[y][1]=_[y][1]):(a[y][0]=Number.MAX_SAFE_INTEGER,a[y][1]=0);a.sort(ase);const v=u.morphAttributes.position,g=u.morphAttributes.normal;let b=0;for(let y=0;y<8;y++){const A=a[y],w=A[0],M=A[1];w!==Number.MAX_SAFE_INTEGER&&M?(v&&u.getAttribute("morphTarget"+y)!==v[w]&&u.setAttribute("morphTarget"+y,v[w]),g&&u.getAttribute("morphNormal"+y)!==g[w]&&u.setAttribute("morphNormal"+y,g[w]),r[y]=M,b+=M):(v&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),g&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),r[y]=0)}const p=u.morphTargetsRelative?1:1-b;h.getUniforms().setValue(i,"morphTargetBaseInfluence",p),h.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function use(i,e,t,n){let r=new WeakMap;function s(l){const c=n.render.frame,u=l.geometry,h=e.get(l,u);if(r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,i.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,i.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;r.get(d)!==c&&(d.update(),r.set(d,c))}return h}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}const pG=new Ts,mG=new rG,gG=new Zte,vG=new dG,sk=[],ok=[],ak=new Float32Array(16),lk=new Float32Array(9),ck=new Float32Array(4);function om(i,e,t){const n=i[0];if(n<=0||n>0)return i;const r=e*t;let s=sk[r];if(s===void 0&&(s=new Float32Array(r),sk[r]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(s,a)}return s}function dr(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function fr(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function bS(i,e){let t=ok[e];t===void 0&&(t=new Int32Array(e),ok[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function hse(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function dse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(dr(t,e))return;i.uniform2fv(this.addr,e),fr(t,e)}}function fse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(dr(t,e))return;i.uniform3fv(this.addr,e),fr(t,e)}}function pse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(dr(t,e))return;i.uniform4fv(this.addr,e),fr(t,e)}}function mse(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(dr(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),fr(t,e)}else{if(dr(t,n))return;ck.set(n),i.uniformMatrix2fv(this.addr,!1,ck),fr(t,n)}}function gse(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(dr(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),fr(t,e)}else{if(dr(t,n))return;lk.set(n),i.uniformMatrix3fv(this.addr,!1,lk),fr(t,n)}}function vse(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(dr(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),fr(t,e)}else{if(dr(t,n))return;ak.set(n),i.uniformMatrix4fv(this.addr,!1,ak),fr(t,n)}}function _se(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function yse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(dr(t,e))return;i.uniform2iv(this.addr,e),fr(t,e)}}function xse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(dr(t,e))return;i.uniform3iv(this.addr,e),fr(t,e)}}function bse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(dr(t,e))return;i.uniform4iv(this.addr,e),fr(t,e)}}function Sse(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function wse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(dr(t,e))return;i.uniform2uiv(this.addr,e),fr(t,e)}}function Mse(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(dr(t,e))return;i.uniform3uiv(this.addr,e),fr(t,e)}}function Ase(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(dr(t,e))return;i.uniform4uiv(this.addr,e),fr(t,e)}}function Ese(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2D(e||pG,r)}function Tse(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||gG,r)}function Cse(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||vG,r)}function Pse(i,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||mG,r)}function Rse(i){switch(i){case 5126:return hse;case 35664:return dse;case 35665:return fse;case 35666:return pse;case 35674:return mse;case 35675:return gse;case 35676:return vse;case 5124:case 35670:return _se;case 35667:case 35671:return yse;case 35668:case 35672:return xse;case 35669:case 35673:return bse;case 5125:return Sse;case 36294:return wse;case 36295:return Mse;case 36296:return Ase;case 35678:case 36198:case 36298:case 36306:case 35682:return Ese;case 35679:case 36299:case 36307:return Tse;case 35680:case 36300:case 36308:case 36293:return Cse;case 36289:case 36303:case 36311:case 36292:return Pse}}function Ise(i,e){i.uniform1fv(this.addr,e)}function Lse(i,e){const t=om(e,this.size,2);i.uniform2fv(this.addr,t)}function Dse(i,e){const t=om(e,this.size,3);i.uniform3fv(this.addr,t)}function Nse(i,e){const t=om(e,this.size,4);i.uniform4fv(this.addr,t)}function Fse(i,e){const t=om(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function kse(i,e){const t=om(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function Use(i,e){const t=om(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function Ose(i,e){i.uniform1iv(this.addr,e)}function Bse(i,e){i.uniform2iv(this.addr,e)}function zse(i,e){i.uniform3iv(this.addr,e)}function Gse(i,e){i.uniform4iv(this.addr,e)}function Vse(i,e){i.uniform1uiv(this.addr,e)}function Hse(i,e){i.uniform2uiv(this.addr,e)}function $se(i,e){i.uniform3uiv(this.addr,e)}function Wse(i,e){i.uniform4uiv(this.addr,e)}function jse(i,e,t){const n=this.cache,r=e.length,s=bS(t,r);dr(n,s)||(i.uniform1iv(this.addr,s),fr(n,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||pG,s[o])}function Xse(i,e,t){const n=this.cache,r=e.length,s=bS(t,r);dr(n,s)||(i.uniform1iv(this.addr,s),fr(n,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||gG,s[o])}function qse(i,e,t){const n=this.cache,r=e.length,s=bS(t,r);dr(n,s)||(i.uniform1iv(this.addr,s),fr(n,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||vG,s[o])}function Yse(i,e,t){const n=this.cache,r=e.length,s=bS(t,r);dr(n,s)||(i.uniform1iv(this.addr,s),fr(n,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||mG,s[o])}function Kse(i){switch(i){case 5126:return Ise;case 35664:return Lse;case 35665:return Dse;case 35666:return Nse;case 35674:return Fse;case 35675:return kse;case 35676:return Use;case 5124:case 35670:return Ose;case 35667:case 35671:return Bse;case 35668:case 35672:return zse;case 35669:case 35673:return Gse;case 5125:return Vse;case 36294:return Hse;case 36295:return $se;case 36296:return Wse;case 35678:case 36198:case 36298:case 36306:case 35682:return jse;case 35679:case 36299:case 36307:return Xse;case 35680:case 36300:case 36308:case 36293:return qse;case 36289:case 36303:case 36311:case 36292:return Yse}}class Zse{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=Rse(t.type)}}class Qse{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=Kse(t.type)}}class Jse{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],n)}}}const RM=/(\w+)(\])?(\[|\.)?/g;function uk(i,e){i.seq.push(e),i.map[e.id]=e}function eoe(i,e,t){const n=i.name,r=n.length;for(RM.lastIndex=0;;){const s=RM.exec(n),o=RM.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){uk(t,c===void 0?new Zse(a,i,e):new Qse(a,i,e));break}else{let h=t.map[a];h===void 0&&(h=new Jse(a),uk(t,h)),t=h}}}class hx{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const s=e.getActiveUniform(t,r),o=e.getUniformLocation(t,s.name);eoe(s,o,this)}}setValue(e,t,n,r){const s=this.map[t];s!==void 0&&s.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&n.push(o)}return n}}function hk(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}const toe=37297;let noe=0;function ioe(i,e){const t=i.split(`
`),n=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}function roe(i){const e=jn.getPrimaries(jn.workingColorSpace),t=jn.getPrimaries(i);let n;switch(e===t?n="":e===sb&&t===rb?n="LinearDisplayP3ToLinearSRGB":e===rb&&t===sb&&(n="LinearSRGBToLinearDisplayP3"),i){case hc:case yS:return[n,"LinearTransferOETF"];case Dr:case AR:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",i),[n,"LinearTransferOETF"]}}function dk(i,e,t){const n=i.getShaderParameter(e,i.COMPILE_STATUS),r=i.getShaderInfoLog(e).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+ioe(i.getShaderSource(e),o)}else return r}function soe(i,e){const t=roe(e);return`vec4 ${i}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function ooe(i,e){let t;switch(e){case _te:t="Linear";break;case yte:t="Reinhard";break;case xte:t="OptimizedCineon";break;case bte:t="ACESFilmic";break;case Ste:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function aoe(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Tg).join(`
`)}function loe(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function coe(i,e){const t={},n=i.getProgramParameter(e,i.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const s=i.getActiveAttrib(e,r),o=s.name;let a=1;s.type===i.FLOAT_MAT2&&(a=2),s.type===i.FLOAT_MAT3&&(a=3),s.type===i.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}function Tg(i){return i!==""}function fk(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pk(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const uoe=/^[ \t]*#include +<([\w\d./]+)>/gm;function KT(i){return i.replace(uoe,doe)}const hoe=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function doe(i,e){let t=dn[e];if(t===void 0){const n=hoe.get(e);if(n!==void 0)t=dn[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return KT(t)}const foe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function mk(i){return i.replace(foe,poe)}function poe(i,e,t,n){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function gk(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function moe(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===W8?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===jee?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===zl&&(e="SHADOWMAP_TYPE_VSM"),e}function goe(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Op:case Bp:e="ENVMAP_TYPE_CUBE";break;case _S:e="ENVMAP_TYPE_CUBE_UV";break}return e}function voe(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Bp:e="ENVMAP_MODE_REFRACTION";break}return e}function _oe(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case j8:e="ENVMAP_BLENDING_MULTIPLY";break;case gte:e="ENVMAP_BLENDING_MIX";break;case vte:e="ENVMAP_BLENDING_ADD";break}return e}function yoe(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function xoe(i,e,t,n){const r=i.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=moe(t),c=goe(t),u=voe(t),h=_oe(t),d=yoe(t),f=t.isWebGL2?"":aoe(t),m=loe(s),_=r.createProgram();let v,g,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(Tg).join(`
`),v.length>0&&(v+=`
`),g=[f,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m].filter(Tg).join(`
`),g.length>0&&(g+=`
`)):(v=[gk(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Tg).join(`
`),g=[f,gk(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==gu?"#define TONE_MAPPING":"",t.toneMapping!==gu?dn.tonemapping_pars_fragment:"",t.toneMapping!==gu?ooe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",dn.colorspace_pars_fragment,soe("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Tg).join(`
`)),o=KT(o),o=fk(o,t),o=pk(o,t),a=KT(a),a=fk(a,t),a=pk(a,t),o=mk(o),a=mk(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,g=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===NF?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===NF?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);const p=b+v+o,y=b+g+a,A=hk(r,r.VERTEX_SHADER,p),w=hk(r,r.FRAGMENT_SHADER,y);r.attachShader(_,A),r.attachShader(_,w),t.index0AttributeName!==void 0?r.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(_,0,"position"),r.linkProgram(_);function M(N){if(i.debug.checkShaderErrors){const P=r.getProgramInfoLog(_).trim(),L=r.getShaderInfoLog(A).trim(),R=r.getShaderInfoLog(w).trim();let F=!0,V=!0;if(r.getProgramParameter(_,r.LINK_STATUS)===!1)if(F=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(r,_,A,w);else{const z=dk(r,A,"vertex"),U=dk(r,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(_,r.VALIDATE_STATUS)+`

Program Info Log: `+P+`
`+z+`
`+U)}else P!==""?console.warn("THREE.WebGLProgram: Program Info Log:",P):(L===""||R==="")&&(V=!1);V&&(N.diagnostics={runnable:F,programLog:P,vertexShader:{log:L,prefix:v},fragmentShader:{log:R,prefix:g}})}r.deleteShader(A),r.deleteShader(w),T=new hx(r,_),E=coe(r,_)}let T;this.getUniforms=function(){return T===void 0&&M(this),T};let E;this.getAttributes=function(){return E===void 0&&M(this),E};let C=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return C===!1&&(C=r.getProgramParameter(_,toe)),C},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=noe++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=A,this.fragmentShader=w,this}let boe=0;class Soe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new woe(e),t.set(e,n)),n}}class woe{constructor(e){this.id=boe++,this.code=e,this.usedTimes=0}}function Moe(i,e,t,n,r,s,o){const a=new sG,l=new Soe,c=[],u=r.isWebGL2,h=r.logarithmicDepthBuffer,d=r.vertexTextures;let f=r.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(E){return E===0?"uv":`uv${E}`}function v(E,C,N,P,L){const R=P.fog,F=L.geometry,V=E.isMeshStandardMaterial?P.environment:null,z=(E.isMeshStandardMaterial?t:e).get(E.envMap||V),U=z&&z.mapping===_S?z.image.height:null,G=m[E.type];E.precision!==null&&(f=r.getMaxPrecision(E.precision),f!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",f,"instead."));const B=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,D=B!==void 0?B.length:0;let O=0;F.morphAttributes.position!==void 0&&(O=1),F.morphAttributes.normal!==void 0&&(O=2),F.morphAttributes.color!==void 0&&(O=3);let j,q,Y,ie;if(G){const Mt=Ka[G];j=Mt.vertexShader,q=Mt.fragmentShader}else j=E.vertexShader,q=E.fragmentShader,l.update(E),Y=l.getVertexShaderID(E),ie=l.getFragmentShaderID(E);const ne=i.getRenderTarget(),Q=L.isInstancedMesh===!0,le=!!E.map,se=!!E.matcap,oe=!!z,$=!!E.aoMap,pe=!!E.lightMap,xe=!!E.bumpMap,Pe=!!E.normalMap,ve=!!E.displacementMap,Ue=!!E.emissiveMap,Le=!!E.metalnessMap,Z=!!E.roughnessMap,J=E.anisotropy>0,de=E.clearcoat>0,Ie=E.iridescence>0,te=E.sheen>0,X=E.transmission>0,ye=J&&!!E.anisotropyMap,ke=de&&!!E.clearcoatMap,ge=de&&!!E.clearcoatNormalMap,De=de&&!!E.clearcoatRoughnessMap,$e=Ie&&!!E.iridescenceMap,Ae=Ie&&!!E.iridescenceThicknessMap,Ze=te&&!!E.sheenColorMap,nt=te&&!!E.sheenRoughnessMap,rt=!!E.specularMap,Oe=!!E.specularColorMap,qe=!!E.specularIntensityMap,it=X&&!!E.transmissionMap,at=X&&!!E.thicknessMap,ht=!!E.gradientMap,Qe=!!E.alphaMap,je=E.alphaTest>0,ee=!!E.alphaHash,ze=!!E.extensions,Ee=!!F.attributes.uv1,Re=!!F.attributes.uv2,Xe=!!F.attributes.uv3;let gt=gu;return E.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(gt=i.toneMapping),{isWebGL2:u,shaderID:G,shaderType:E.type,shaderName:E.name,vertexShader:j,fragmentShader:q,defines:E.defines,customVertexShaderID:Y,customFragmentShaderID:ie,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:f,instancing:Q,instancingColor:Q&&L.instanceColor!==null,supportsVertexTextures:d,outputColorSpace:ne===null?i.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:hc,map:le,matcap:se,envMap:oe,envMapMode:oe&&z.mapping,envMapCubeUVHeight:U,aoMap:$,lightMap:pe,bumpMap:xe,normalMap:Pe,displacementMap:d&&ve,emissiveMap:Ue,normalMapObjectSpace:Pe&&E.normalMapType===kte,normalMapTangentSpace:Pe&&E.normalMapType===Fte,metalnessMap:Le,roughnessMap:Z,anisotropy:J,anisotropyMap:ye,clearcoat:de,clearcoatMap:ke,clearcoatNormalMap:ge,clearcoatRoughnessMap:De,iridescence:Ie,iridescenceMap:$e,iridescenceThicknessMap:Ae,sheen:te,sheenColorMap:Ze,sheenRoughnessMap:nt,specularMap:rt,specularColorMap:Oe,specularIntensityMap:qe,transmission:X,transmissionMap:it,thicknessMap:at,gradientMap:ht,opaque:E.transparent===!1&&E.blending===nc,alphaMap:Qe,alphaTest:je,alphaHash:ee,combine:E.combine,mapUv:le&&_(E.map.channel),aoMapUv:$&&_(E.aoMap.channel),lightMapUv:pe&&_(E.lightMap.channel),bumpMapUv:xe&&_(E.bumpMap.channel),normalMapUv:Pe&&_(E.normalMap.channel),displacementMapUv:ve&&_(E.displacementMap.channel),emissiveMapUv:Ue&&_(E.emissiveMap.channel),metalnessMapUv:Le&&_(E.metalnessMap.channel),roughnessMapUv:Z&&_(E.roughnessMap.channel),anisotropyMapUv:ye&&_(E.anisotropyMap.channel),clearcoatMapUv:ke&&_(E.clearcoatMap.channel),clearcoatNormalMapUv:ge&&_(E.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:De&&_(E.clearcoatRoughnessMap.channel),iridescenceMapUv:$e&&_(E.iridescenceMap.channel),iridescenceThicknessMapUv:Ae&&_(E.iridescenceThicknessMap.channel),sheenColorMapUv:Ze&&_(E.sheenColorMap.channel),sheenRoughnessMapUv:nt&&_(E.sheenRoughnessMap.channel),specularMapUv:rt&&_(E.specularMap.channel),specularColorMapUv:Oe&&_(E.specularColorMap.channel),specularIntensityMapUv:qe&&_(E.specularIntensityMap.channel),transmissionMapUv:it&&_(E.transmissionMap.channel),thicknessMapUv:at&&_(E.thicknessMap.channel),alphaMapUv:Qe&&_(E.alphaMap.channel),vertexTangents:!!F.attributes.tangent&&(Pe||J),vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,vertexUv1s:Ee,vertexUv2s:Re,vertexUv3s:Xe,pointsUvs:L.isPoints===!0&&!!F.attributes.uv&&(le||Qe),fog:!!R,useFog:E.fog===!0,fogExp2:R&&R.isFogExp2,flatShading:E.flatShading===!0,sizeAttenuation:E.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:L.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:D,morphTextureStride:O,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numSpotLightMaps:C.spotLightMap.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numSpotLightShadowsWithMaps:C.numSpotLightShadowsWithMaps,numLightProbes:C.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:E.dithering,shadowMapEnabled:i.shadowMap.enabled&&N.length>0,shadowMapType:i.shadowMap.type,toneMapping:gt,useLegacyLights:i._useLegacyLights,decodeVideoTexture:le&&E.map.isVideoTexture===!0&&jn.getTransfer(E.map.colorSpace)===ri,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===Qa,flipSided:E.side===Es,useDepthPacking:E.depthPacking>=0,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:ze&&E.extensions.derivatives===!0,extensionFragDepth:ze&&E.extensions.fragDepth===!0,extensionDrawBuffers:ze&&E.extensions.drawBuffers===!0,extensionShaderTextureLOD:ze&&E.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:E.customProgramCacheKey()}}function g(E){const C=[];if(E.shaderID?C.push(E.shaderID):(C.push(E.customVertexShaderID),C.push(E.customFragmentShaderID)),E.defines!==void 0)for(const N in E.defines)C.push(N),C.push(E.defines[N]);return E.isRawShaderMaterial===!1&&(b(C,E),p(C,E),C.push(i.outputColorSpace)),C.push(E.customProgramCacheKey),C.join()}function b(E,C){E.push(C.precision),E.push(C.outputColorSpace),E.push(C.envMapMode),E.push(C.envMapCubeUVHeight),E.push(C.mapUv),E.push(C.alphaMapUv),E.push(C.lightMapUv),E.push(C.aoMapUv),E.push(C.bumpMapUv),E.push(C.normalMapUv),E.push(C.displacementMapUv),E.push(C.emissiveMapUv),E.push(C.metalnessMapUv),E.push(C.roughnessMapUv),E.push(C.anisotropyMapUv),E.push(C.clearcoatMapUv),E.push(C.clearcoatNormalMapUv),E.push(C.clearcoatRoughnessMapUv),E.push(C.iridescenceMapUv),E.push(C.iridescenceThicknessMapUv),E.push(C.sheenColorMapUv),E.push(C.sheenRoughnessMapUv),E.push(C.specularMapUv),E.push(C.specularColorMapUv),E.push(C.specularIntensityMapUv),E.push(C.transmissionMapUv),E.push(C.thicknessMapUv),E.push(C.combine),E.push(C.fogExp2),E.push(C.sizeAttenuation),E.push(C.morphTargetsCount),E.push(C.morphAttributeCount),E.push(C.numDirLights),E.push(C.numPointLights),E.push(C.numSpotLights),E.push(C.numSpotLightMaps),E.push(C.numHemiLights),E.push(C.numRectAreaLights),E.push(C.numDirLightShadows),E.push(C.numPointLightShadows),E.push(C.numSpotLightShadows),E.push(C.numSpotLightShadowsWithMaps),E.push(C.numLightProbes),E.push(C.shadowMapType),E.push(C.toneMapping),E.push(C.numClippingPlanes),E.push(C.numClipIntersection),E.push(C.depthPacking)}function p(E,C){a.disableAll(),C.isWebGL2&&a.enable(0),C.supportsVertexTextures&&a.enable(1),C.instancing&&a.enable(2),C.instancingColor&&a.enable(3),C.matcap&&a.enable(4),C.envMap&&a.enable(5),C.normalMapObjectSpace&&a.enable(6),C.normalMapTangentSpace&&a.enable(7),C.clearcoat&&a.enable(8),C.iridescence&&a.enable(9),C.alphaTest&&a.enable(10),C.vertexColors&&a.enable(11),C.vertexAlphas&&a.enable(12),C.vertexUv1s&&a.enable(13),C.vertexUv2s&&a.enable(14),C.vertexUv3s&&a.enable(15),C.vertexTangents&&a.enable(16),C.anisotropy&&a.enable(17),C.alphaHash&&a.enable(18),E.push(a.mask),a.disableAll(),C.fog&&a.enable(0),C.useFog&&a.enable(1),C.flatShading&&a.enable(2),C.logarithmicDepthBuffer&&a.enable(3),C.skinning&&a.enable(4),C.morphTargets&&a.enable(5),C.morphNormals&&a.enable(6),C.morphColors&&a.enable(7),C.premultipliedAlpha&&a.enable(8),C.shadowMapEnabled&&a.enable(9),C.useLegacyLights&&a.enable(10),C.doubleSided&&a.enable(11),C.flipSided&&a.enable(12),C.useDepthPacking&&a.enable(13),C.dithering&&a.enable(14),C.transmission&&a.enable(15),C.sheen&&a.enable(16),C.opaque&&a.enable(17),C.pointsUvs&&a.enable(18),C.decodeVideoTexture&&a.enable(19),E.push(a.mask)}function y(E){const C=m[E.type];let N;if(C){const P=Ka[C];N=ux.clone(P.uniforms)}else N=E.uniforms;return N}function A(E,C){let N;for(let P=0,L=c.length;P<L;P++){const R=c[P];if(R.cacheKey===C){N=R,++N.usedTimes;break}}return N===void 0&&(N=new xoe(i,C,E,s),c.push(N)),N}function w(E){if(--E.usedTimes===0){const C=c.indexOf(E);c[C]=c[c.length-1],c.pop(),E.destroy()}}function M(E){l.remove(E)}function T(){l.dispose()}return{getParameters:v,getProgramCacheKey:g,getUniforms:y,acquireProgram:A,releaseProgram:w,releaseShaderCache:M,programs:c,dispose:T}}function Aoe(){let i=new WeakMap;function e(s){let o=i.get(s);return o===void 0&&(o={},i.set(s,o)),o}function t(s){i.delete(s)}function n(s,o,a){i.get(s)[o]=a}function r(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:r}}function Eoe(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function vk(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function _k(){const i=[];let e=0;const t=[],n=[],r=[];function s(){e=0,t.length=0,n.length=0,r.length=0}function o(h,d,f,m,_,v){let g=i[e];return g===void 0?(g={id:h.id,object:h,geometry:d,material:f,groupOrder:m,renderOrder:h.renderOrder,z:_,group:v},i[e]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=f,g.groupOrder=m,g.renderOrder=h.renderOrder,g.z=_,g.group=v),e++,g}function a(h,d,f,m,_,v){const g=o(h,d,f,m,_,v);f.transmission>0?n.push(g):f.transparent===!0?r.push(g):t.push(g)}function l(h,d,f,m,_,v){const g=o(h,d,f,m,_,v);f.transmission>0?n.unshift(g):f.transparent===!0?r.unshift(g):t.unshift(g)}function c(h,d){t.length>1&&t.sort(h||Eoe),n.length>1&&n.sort(d||vk),r.length>1&&r.sort(d||vk)}function u(){for(let h=e,d=i.length;h<d;h++){const f=i[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function Toe(){let i=new WeakMap;function e(n,r){const s=i.get(n);let o;return s===void 0?(o=new _k,i.set(n,[o])):r>=s.length?(o=new _k,s.push(o)):o=s[r],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function Coe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new me,color:new Ht};break;case"SpotLight":t={position:new me,direction:new me,color:new Ht,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new me,color:new Ht,distance:0,decay:0};break;case"HemisphereLight":t={direction:new me,skyColor:new Ht,groundColor:new Ht};break;case"RectAreaLight":t={color:new Ht,position:new me,halfWidth:new me,halfHeight:new me};break}return i[e.id]=t,t}}}function Poe(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sn};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sn};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sn,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let Roe=0;function Ioe(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function Loe(i,e){const t=new Coe,n=Poe(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)r.probe.push(new me);const s=new me,o=new Tt,a=new Tt;function l(u,h){let d=0,f=0,m=0;for(let P=0;P<9;P++)r.probe[P].set(0,0,0);let _=0,v=0,g=0,b=0,p=0,y=0,A=0,w=0,M=0,T=0,E=0;u.sort(Ioe);const C=h===!0?Math.PI:1;for(let P=0,L=u.length;P<L;P++){const R=u[P],F=R.color,V=R.intensity,z=R.distance,U=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)d+=F.r*V*C,f+=F.g*V*C,m+=F.b*V*C;else if(R.isLightProbe){for(let G=0;G<9;G++)r.probe[G].addScaledVector(R.sh.coefficients[G],V);E++}else if(R.isDirectionalLight){const G=t.get(R);if(G.color.copy(R.color).multiplyScalar(R.intensity*C),R.castShadow){const B=R.shadow,D=n.get(R);D.shadowBias=B.bias,D.shadowNormalBias=B.normalBias,D.shadowRadius=B.radius,D.shadowMapSize=B.mapSize,r.directionalShadow[_]=D,r.directionalShadowMap[_]=U,r.directionalShadowMatrix[_]=R.shadow.matrix,y++}r.directional[_]=G,_++}else if(R.isSpotLight){const G=t.get(R);G.position.setFromMatrixPosition(R.matrixWorld),G.color.copy(F).multiplyScalar(V*C),G.distance=z,G.coneCos=Math.cos(R.angle),G.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),G.decay=R.decay,r.spot[g]=G;const B=R.shadow;if(R.map&&(r.spotLightMap[M]=R.map,M++,B.updateMatrices(R),R.castShadow&&T++),r.spotLightMatrix[g]=B.matrix,R.castShadow){const D=n.get(R);D.shadowBias=B.bias,D.shadowNormalBias=B.normalBias,D.shadowRadius=B.radius,D.shadowMapSize=B.mapSize,r.spotShadow[g]=D,r.spotShadowMap[g]=U,w++}g++}else if(R.isRectAreaLight){const G=t.get(R);G.color.copy(F).multiplyScalar(V),G.halfWidth.set(R.width*.5,0,0),G.halfHeight.set(0,R.height*.5,0),r.rectArea[b]=G,b++}else if(R.isPointLight){const G=t.get(R);if(G.color.copy(R.color).multiplyScalar(R.intensity*C),G.distance=R.distance,G.decay=R.decay,R.castShadow){const B=R.shadow,D=n.get(R);D.shadowBias=B.bias,D.shadowNormalBias=B.normalBias,D.shadowRadius=B.radius,D.shadowMapSize=B.mapSize,D.shadowCameraNear=B.camera.near,D.shadowCameraFar=B.camera.far,r.pointShadow[v]=D,r.pointShadowMap[v]=U,r.pointShadowMatrix[v]=R.shadow.matrix,A++}r.point[v]=G,v++}else if(R.isHemisphereLight){const G=t.get(R);G.skyColor.copy(R.color).multiplyScalar(V*C),G.groundColor.copy(R.groundColor).multiplyScalar(V*C),r.hemi[p]=G,p++}}b>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ft.LTC_FLOAT_1,r.rectAreaLTC2=Ft.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=Ft.LTC_HALF_1,r.rectAreaLTC2=Ft.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=d,r.ambient[1]=f,r.ambient[2]=m;const N=r.hash;(N.directionalLength!==_||N.pointLength!==v||N.spotLength!==g||N.rectAreaLength!==b||N.hemiLength!==p||N.numDirectionalShadows!==y||N.numPointShadows!==A||N.numSpotShadows!==w||N.numSpotMaps!==M||N.numLightProbes!==E)&&(r.directional.length=_,r.spot.length=g,r.rectArea.length=b,r.point.length=v,r.hemi.length=p,r.directionalShadow.length=y,r.directionalShadowMap.length=y,r.pointShadow.length=A,r.pointShadowMap.length=A,r.spotShadow.length=w,r.spotShadowMap.length=w,r.directionalShadowMatrix.length=y,r.pointShadowMatrix.length=A,r.spotLightMatrix.length=w+M-T,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=T,r.numLightProbes=E,N.directionalLength=_,N.pointLength=v,N.spotLength=g,N.rectAreaLength=b,N.hemiLength=p,N.numDirectionalShadows=y,N.numPointShadows=A,N.numSpotShadows=w,N.numSpotMaps=M,N.numLightProbes=E,r.version=Roe++)}function c(u,h){let d=0,f=0,m=0,_=0,v=0;const g=h.matrixWorldInverse;for(let b=0,p=u.length;b<p;b++){const y=u[b];if(y.isDirectionalLight){const A=r.directional[d];A.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(g),d++}else if(y.isSpotLight){const A=r.spot[m];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),A.direction.setFromMatrixPosition(y.matrixWorld),s.setFromMatrixPosition(y.target.matrixWorld),A.direction.sub(s),A.direction.transformDirection(g),m++}else if(y.isRectAreaLight){const A=r.rectArea[_];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),a.identity(),o.copy(y.matrixWorld),o.premultiply(g),a.extractRotation(o),A.halfWidth.set(y.width*.5,0,0),A.halfHeight.set(0,y.height*.5,0),A.halfWidth.applyMatrix4(a),A.halfHeight.applyMatrix4(a),_++}else if(y.isPointLight){const A=r.point[f];A.position.setFromMatrixPosition(y.matrixWorld),A.position.applyMatrix4(g),f++}else if(y.isHemisphereLight){const A=r.hemi[v];A.direction.setFromMatrixPosition(y.matrixWorld),A.direction.transformDirection(g),v++}}}return{setup:l,setupView:c,state:r}}function yk(i,e){const t=new Loe(i,e),n=[],r=[];function s(){n.length=0,r.length=0}function o(h){n.push(h)}function a(h){r.push(h)}function l(h){t.setup(n,h)}function c(h){t.setupView(n,h)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function Doe(i,e){let t=new WeakMap;function n(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new yk(i,e),t.set(s,[l])):o>=a.length?(l=new yk(i,e),a.push(l)):l=a[o],l}function r(){t=new WeakMap}return{get:n,dispose:r}}class Noe extends rm{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Dte,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class Foe extends rm{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const koe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Uoe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Ooe(i,e,t){let n=new TR;const r=new sn,s=new sn,o=new Mr,a=new Noe({depthPacking:Nte}),l=new Foe,c={},u=t.maxTextureSize,h={[uc]:Es,[Es]:uc,[Qa]:Qa},d=new Yo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new sn},radius:{value:4}},vertexShader:koe,fragmentShader:Uoe}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const m=new nr;m.setAttribute("position",new Hi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new el(m,d),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=W8;let g=this.type;this.render=function(A,w,M){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||A.length===0)return;const T=i.getRenderTarget(),E=i.getActiveCubeFace(),C=i.getActiveMipmapLevel(),N=i.state;N.setBlending(tc),N.buffers.color.setClear(1,1,1,1),N.buffers.depth.setTest(!0),N.setScissorTest(!1);const P=g!==zl&&this.type===zl,L=g===zl&&this.type!==zl;for(let R=0,F=A.length;R<F;R++){const V=A[R],z=V.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",V,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;r.copy(z.mapSize);const U=z.getFrameExtents();if(r.multiply(U),s.copy(z.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/U.x),r.x=s.x*U.x,z.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/U.y),r.y=s.y*U.y,z.mapSize.y=s.y)),z.map===null||P===!0||L===!0){const B=this.type!==zl?{minFilter:Zn,magFilter:Zn}:{};z.map!==null&&z.map.dispose(),z.map=new ol(r.x,r.y,B),z.map.texture.name=V.name+".shadowMap",z.camera.updateProjectionMatrix()}i.setRenderTarget(z.map),i.clear();const G=z.getViewportCount();for(let B=0;B<G;B++){const D=z.getViewport(B);o.set(s.x*D.x,s.y*D.y,s.x*D.z,s.y*D.w),N.viewport(o),z.updateMatrices(V,B),n=z.getFrustum(),y(w,M,z.camera,V,this.type)}z.isPointLightShadow!==!0&&this.type===zl&&b(z,M),z.needsUpdate=!1}g=this.type,v.needsUpdate=!1,i.setRenderTarget(T,E,C)};function b(A,w){const M=e.update(_);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,f.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new ol(r.x,r.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,i.setRenderTarget(A.mapPass),i.clear(),i.renderBufferDirect(w,null,M,d,_,null),f.uniforms.shadow_pass.value=A.mapPass.texture,f.uniforms.resolution.value=A.mapSize,f.uniforms.radius.value=A.radius,i.setRenderTarget(A.map),i.clear(),i.renderBufferDirect(w,null,M,f,_,null)}function p(A,w,M,T){let E=null;const C=M.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(C!==void 0)E=C;else if(E=M.isPointLight===!0?l:a,i.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0||w.map&&w.alphaTest>0){const N=E.uuid,P=w.uuid;let L=c[N];L===void 0&&(L={},c[N]=L);let R=L[P];R===void 0&&(R=E.clone(),L[P]=R),E=R}if(E.visible=w.visible,E.wireframe=w.wireframe,T===zl?E.side=w.shadowSide!==null?w.shadowSide:w.side:E.side=w.shadowSide!==null?w.shadowSide:h[w.side],E.alphaMap=w.alphaMap,E.alphaTest=w.alphaTest,E.map=w.map,E.clipShadows=w.clipShadows,E.clippingPlanes=w.clippingPlanes,E.clipIntersection=w.clipIntersection,E.displacementMap=w.displacementMap,E.displacementScale=w.displacementScale,E.displacementBias=w.displacementBias,E.wireframeLinewidth=w.wireframeLinewidth,E.linewidth=w.linewidth,M.isPointLight===!0&&E.isMeshDistanceMaterial===!0){const N=i.properties.get(E);N.light=M}return E}function y(A,w,M,T,E){if(A.visible===!1)return;if(A.layers.test(w.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&E===zl)&&(!A.frustumCulled||n.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,A.matrixWorld);const P=e.update(A),L=A.material;if(Array.isArray(L)){const R=P.groups;for(let F=0,V=R.length;F<V;F++){const z=R[F],U=L[z.materialIndex];if(U&&U.visible){const G=p(A,U,T,E);i.renderBufferDirect(M,null,P,G,A,z)}}}else if(L.visible){const R=p(A,L,T,E);i.renderBufferDirect(M,null,P,R,A,null)}}const N=A.children;for(let P=0,L=N.length;P<L;P++)y(N[P],w,M,T,E)}}function Boe(i,e,t){const n=t.isWebGL2;function r(){let ee=!1;const ze=new Mr;let Ee=null;const Re=new Mr(0,0,0,0);return{setMask:function(Xe){Ee!==Xe&&!ee&&(i.colorMask(Xe,Xe,Xe,Xe),Ee=Xe)},setLocked:function(Xe){ee=Xe},setClear:function(Xe,gt,_t,Mt,K){K===!0&&(Xe*=Mt,gt*=Mt,_t*=Mt),ze.set(Xe,gt,_t,Mt),Re.equals(ze)===!1&&(i.clearColor(Xe,gt,_t,Mt),Re.copy(ze))},reset:function(){ee=!1,Ee=null,Re.set(-1,0,0,0)}}}function s(){let ee=!1,ze=null,Ee=null,Re=null;return{setTest:function(Xe){Xe?le(i.DEPTH_TEST):se(i.DEPTH_TEST)},setMask:function(Xe){ze!==Xe&&!ee&&(i.depthMask(Xe),ze=Xe)},setFunc:function(Xe){if(Ee!==Xe){switch(Xe){case cte:i.depthFunc(i.NEVER);break;case ute:i.depthFunc(i.ALWAYS);break;case hte:i.depthFunc(i.LESS);break;case nb:i.depthFunc(i.LEQUAL);break;case dte:i.depthFunc(i.EQUAL);break;case fte:i.depthFunc(i.GEQUAL);break;case pte:i.depthFunc(i.GREATER);break;case mte:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Ee=Xe}},setLocked:function(Xe){ee=Xe},setClear:function(Xe){Re!==Xe&&(i.clearDepth(Xe),Re=Xe)},reset:function(){ee=!1,ze=null,Ee=null,Re=null}}}function o(){let ee=!1,ze=null,Ee=null,Re=null,Xe=null,gt=null,_t=null,Mt=null,K=null;return{setTest:function(ae){ee||(ae?le(i.STENCIL_TEST):se(i.STENCIL_TEST))},setMask:function(ae){ze!==ae&&!ee&&(i.stencilMask(ae),ze=ae)},setFunc:function(ae,ue,_e){(Ee!==ae||Re!==ue||Xe!==_e)&&(i.stencilFunc(ae,ue,_e),Ee=ae,Re=ue,Xe=_e)},setOp:function(ae,ue,_e){(gt!==ae||_t!==ue||Mt!==_e)&&(i.stencilOp(ae,ue,_e),gt=ae,_t=ue,Mt=_e)},setLocked:function(ae){ee=ae},setClear:function(ae){K!==ae&&(i.clearStencil(ae),K=ae)},reset:function(){ee=!1,ze=null,Ee=null,Re=null,Xe=null,gt=null,_t=null,Mt=null,K=null}}}const a=new r,l=new s,c=new o,u=new WeakMap,h=new WeakMap;let d={},f={},m=new WeakMap,_=[],v=null,g=!1,b=null,p=null,y=null,A=null,w=null,M=null,T=null,E=new Ht(0,0,0),C=0,N=!1,P=null,L=null,R=null,F=null,V=null;const z=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let U=!1,G=0;const B=i.getParameter(i.VERSION);B.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(B)[1]),U=G>=1):B.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),U=G>=2);let D=null,O={};const j=i.getParameter(i.SCISSOR_BOX),q=i.getParameter(i.VIEWPORT),Y=new Mr().fromArray(j),ie=new Mr().fromArray(q);function ne(ee,ze,Ee,Re){const Xe=new Uint8Array(4),gt=i.createTexture();i.bindTexture(ee,gt),i.texParameteri(ee,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(ee,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let _t=0;_t<Ee;_t++)n&&(ee===i.TEXTURE_3D||ee===i.TEXTURE_2D_ARRAY)?i.texImage3D(ze,0,i.RGBA,1,1,Re,0,i.RGBA,i.UNSIGNED_BYTE,Xe):i.texImage2D(ze+_t,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,Xe);return gt}const Q={};Q[i.TEXTURE_2D]=ne(i.TEXTURE_2D,i.TEXTURE_2D,1),Q[i.TEXTURE_CUBE_MAP]=ne(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Q[i.TEXTURE_2D_ARRAY]=ne(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),Q[i.TEXTURE_3D]=ne(i.TEXTURE_3D,i.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),le(i.DEPTH_TEST),l.setFunc(nb),Le(!1),Z(nF),le(i.CULL_FACE),ve(tc);function le(ee){d[ee]!==!0&&(i.enable(ee),d[ee]=!0)}function se(ee){d[ee]!==!1&&(i.disable(ee),d[ee]=!1)}function oe(ee,ze){return f[ee]!==ze?(i.bindFramebuffer(ee,ze),f[ee]=ze,n&&(ee===i.DRAW_FRAMEBUFFER&&(f[i.FRAMEBUFFER]=ze),ee===i.FRAMEBUFFER&&(f[i.DRAW_FRAMEBUFFER]=ze)),!0):!1}function $(ee,ze){let Ee=_,Re=!1;if(ee)if(Ee=m.get(ze),Ee===void 0&&(Ee=[],m.set(ze,Ee)),ee.isWebGLMultipleRenderTargets){const Xe=ee.texture;if(Ee.length!==Xe.length||Ee[0]!==i.COLOR_ATTACHMENT0){for(let gt=0,_t=Xe.length;gt<_t;gt++)Ee[gt]=i.COLOR_ATTACHMENT0+gt;Ee.length=Xe.length,Re=!0}}else Ee[0]!==i.COLOR_ATTACHMENT0&&(Ee[0]=i.COLOR_ATTACHMENT0,Re=!0);else Ee[0]!==i.BACK&&(Ee[0]=i.BACK,Re=!0);Re&&(t.isWebGL2?i.drawBuffers(Ee):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ee))}function pe(ee){return v!==ee?(i.useProgram(ee),v=ee,!0):!1}const xe={[Eh]:i.FUNC_ADD,[qee]:i.FUNC_SUBTRACT,[Yee]:i.FUNC_REVERSE_SUBTRACT};if(n)xe[sF]=i.MIN,xe[oF]=i.MAX;else{const ee=e.get("EXT_blend_minmax");ee!==null&&(xe[sF]=ee.MIN_EXT,xe[oF]=ee.MAX_EXT)}const Pe={[Kee]:i.ZERO,[Zee]:i.ONE,[Qee]:i.SRC_COLOR,[GT]:i.SRC_ALPHA,[rte]:i.SRC_ALPHA_SATURATE,[nte]:i.DST_COLOR,[ete]:i.DST_ALPHA,[Jee]:i.ONE_MINUS_SRC_COLOR,[VT]:i.ONE_MINUS_SRC_ALPHA,[ite]:i.ONE_MINUS_DST_COLOR,[tte]:i.ONE_MINUS_DST_ALPHA,[ste]:i.CONSTANT_COLOR,[ote]:i.ONE_MINUS_CONSTANT_COLOR,[ate]:i.CONSTANT_ALPHA,[lte]:i.ONE_MINUS_CONSTANT_ALPHA};function ve(ee,ze,Ee,Re,Xe,gt,_t,Mt,K,ae){if(ee===tc){g===!0&&(se(i.BLEND),g=!1);return}if(g===!1&&(le(i.BLEND),g=!0),ee!==Xee){if(ee!==b||ae!==N){if((p!==Eh||w!==Eh)&&(i.blendEquation(i.FUNC_ADD),p=Eh,w=Eh),ae)switch(ee){case nc:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case zT:i.blendFunc(i.ONE,i.ONE);break;case iF:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case rF:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}else switch(ee){case nc:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case zT:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case iF:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case rF:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}y=null,A=null,M=null,T=null,E.set(0,0,0),C=0,b=ee,N=ae}return}Xe=Xe||ze,gt=gt||Ee,_t=_t||Re,(ze!==p||Xe!==w)&&(i.blendEquationSeparate(xe[ze],xe[Xe]),p=ze,w=Xe),(Ee!==y||Re!==A||gt!==M||_t!==T)&&(i.blendFuncSeparate(Pe[Ee],Pe[Re],Pe[gt],Pe[_t]),y=Ee,A=Re,M=gt,T=_t),(Mt.equals(E)===!1||K!==C)&&(i.blendColor(Mt.r,Mt.g,Mt.b,K),E.copy(Mt),C=K),b=ee,N=!1}function Ue(ee,ze){ee.side===Qa?se(i.CULL_FACE):le(i.CULL_FACE);let Ee=ee.side===Es;ze&&(Ee=!Ee),Le(Ee),ee.blending===nc&&ee.transparent===!1?ve(tc):ve(ee.blending,ee.blendEquation,ee.blendSrc,ee.blendDst,ee.blendEquationAlpha,ee.blendSrcAlpha,ee.blendDstAlpha,ee.blendColor,ee.blendAlpha,ee.premultipliedAlpha),l.setFunc(ee.depthFunc),l.setTest(ee.depthTest),l.setMask(ee.depthWrite),a.setMask(ee.colorWrite);const Re=ee.stencilWrite;c.setTest(Re),Re&&(c.setMask(ee.stencilWriteMask),c.setFunc(ee.stencilFunc,ee.stencilRef,ee.stencilFuncMask),c.setOp(ee.stencilFail,ee.stencilZFail,ee.stencilZPass)),de(ee.polygonOffset,ee.polygonOffsetFactor,ee.polygonOffsetUnits),ee.alphaToCoverage===!0?le(i.SAMPLE_ALPHA_TO_COVERAGE):se(i.SAMPLE_ALPHA_TO_COVERAGE)}function Le(ee){P!==ee&&(ee?i.frontFace(i.CW):i.frontFace(i.CCW),P=ee)}function Z(ee){ee!==$ee?(le(i.CULL_FACE),ee!==L&&(ee===nF?i.cullFace(i.BACK):ee===Wee?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):se(i.CULL_FACE),L=ee}function J(ee){ee!==R&&(U&&i.lineWidth(ee),R=ee)}function de(ee,ze,Ee){ee?(le(i.POLYGON_OFFSET_FILL),(F!==ze||V!==Ee)&&(i.polygonOffset(ze,Ee),F=ze,V=Ee)):se(i.POLYGON_OFFSET_FILL)}function Ie(ee){ee?le(i.SCISSOR_TEST):se(i.SCISSOR_TEST)}function te(ee){ee===void 0&&(ee=i.TEXTURE0+z-1),D!==ee&&(i.activeTexture(ee),D=ee)}function X(ee,ze,Ee){Ee===void 0&&(D===null?Ee=i.TEXTURE0+z-1:Ee=D);let Re=O[Ee];Re===void 0&&(Re={type:void 0,texture:void 0},O[Ee]=Re),(Re.type!==ee||Re.texture!==ze)&&(D!==Ee&&(i.activeTexture(Ee),D=Ee),i.bindTexture(ee,ze||Q[ee]),Re.type=ee,Re.texture=ze)}function ye(){const ee=O[D];ee!==void 0&&ee.type!==void 0&&(i.bindTexture(ee.type,null),ee.type=void 0,ee.texture=void 0)}function ke(){try{i.compressedTexImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ge(){try{i.compressedTexImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function De(){try{i.texSubImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function $e(){try{i.texSubImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ae(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ze(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function nt(){try{i.texStorage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function rt(){try{i.texStorage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Oe(){try{i.texImage2D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function qe(){try{i.texImage3D.apply(i,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function it(ee){Y.equals(ee)===!1&&(i.scissor(ee.x,ee.y,ee.z,ee.w),Y.copy(ee))}function at(ee){ie.equals(ee)===!1&&(i.viewport(ee.x,ee.y,ee.z,ee.w),ie.copy(ee))}function ht(ee,ze){let Ee=h.get(ze);Ee===void 0&&(Ee=new WeakMap,h.set(ze,Ee));let Re=Ee.get(ee);Re===void 0&&(Re=i.getUniformBlockIndex(ze,ee.name),Ee.set(ee,Re))}function Qe(ee,ze){const Re=h.get(ze).get(ee);u.get(ze)!==Re&&(i.uniformBlockBinding(ze,Re,ee.__bindingPointIndex),u.set(ze,Re))}function je(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),n===!0&&(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),d={},D=null,O={},f={},m=new WeakMap,_=[],v=null,g=!1,b=null,p=null,y=null,A=null,w=null,M=null,T=null,E=new Ht(0,0,0),C=0,N=!1,P=null,L=null,R=null,F=null,V=null,Y.set(0,0,i.canvas.width,i.canvas.height),ie.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:le,disable:se,bindFramebuffer:oe,drawBuffers:$,useProgram:pe,setBlending:ve,setMaterial:Ue,setFlipSided:Le,setCullFace:Z,setLineWidth:J,setPolygonOffset:de,setScissorTest:Ie,activeTexture:te,bindTexture:X,unbindTexture:ye,compressedTexImage2D:ke,compressedTexImage3D:ge,texImage2D:Oe,texImage3D:qe,updateUBOMapping:ht,uniformBlockBinding:Qe,texStorage2D:nt,texStorage3D:rt,texSubImage2D:De,texSubImage3D:$e,compressedTexSubImage2D:Ae,compressedTexSubImage3D:Ze,scissor:it,viewport:at,reset:je}}function zoe(i,e,t,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,h=r.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let _;const v=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(te,X){return g?new OffscreenCanvas(te,X):ab("canvas")}function p(te,X,ye,ke){let ge=1;if((te.width>ke||te.height>ke)&&(ge=ke/Math.max(te.width,te.height)),ge<1||X===!0)if(typeof HTMLImageElement<"u"&&te instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&te instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&te instanceof ImageBitmap){const De=X?YT:Math.floor,$e=De(ge*te.width),Ae=De(ge*te.height);_===void 0&&(_=b($e,Ae));const Ze=ye?b($e,Ae):_;return Ze.width=$e,Ze.height=Ae,Ze.getContext("2d").drawImage(te,0,0,$e,Ae),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+te.width+"x"+te.height+") to ("+$e+"x"+Ae+")."),Ze}else return"data"in te&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+te.width+"x"+te.height+")."),te;return te}function y(te){return FF(te.width)&&FF(te.height)}function A(te){return a?!1:te.wrapS!==Ma||te.wrapT!==Ma||te.minFilter!==Zn&&te.minFilter!==es}function w(te,X){return te.generateMipmaps&&X&&te.minFilter!==Zn&&te.minFilter!==es}function M(te){i.generateMipmap(te)}function T(te,X,ye,ke,ge=!1){if(a===!1)return X;if(te!==null){if(i[te]!==void 0)return i[te];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+te+"'")}let De=X;if(X===i.RED&&(ye===i.FLOAT&&(De=i.R32F),ye===i.HALF_FLOAT&&(De=i.R16F),ye===i.UNSIGNED_BYTE&&(De=i.R8)),X===i.RED_INTEGER&&(ye===i.UNSIGNED_BYTE&&(De=i.R8UI),ye===i.UNSIGNED_SHORT&&(De=i.R16UI),ye===i.UNSIGNED_INT&&(De=i.R32UI),ye===i.BYTE&&(De=i.R8I),ye===i.SHORT&&(De=i.R16I),ye===i.INT&&(De=i.R32I)),X===i.RG&&(ye===i.FLOAT&&(De=i.RG32F),ye===i.HALF_FLOAT&&(De=i.RG16F),ye===i.UNSIGNED_BYTE&&(De=i.RG8)),X===i.RGBA){const $e=ge?ib:jn.getTransfer(ke);ye===i.FLOAT&&(De=i.RGBA32F),ye===i.HALF_FLOAT&&(De=i.RGBA16F),ye===i.UNSIGNED_BYTE&&(De=$e===ri?i.SRGB8_ALPHA8:i.RGBA8),ye===i.UNSIGNED_SHORT_4_4_4_4&&(De=i.RGBA4),ye===i.UNSIGNED_SHORT_5_5_5_1&&(De=i.RGB5_A1)}return(De===i.R16F||De===i.R32F||De===i.RG16F||De===i.RG32F||De===i.RGBA16F||De===i.RGBA32F)&&e.get("EXT_color_buffer_float"),De}function E(te,X,ye){return w(te,ye)===!0||te.isFramebufferTexture&&te.minFilter!==Zn&&te.minFilter!==es?Math.log2(Math.max(X.width,X.height))+1:te.mipmaps!==void 0&&te.mipmaps.length>0?te.mipmaps.length:te.isCompressedTexture&&Array.isArray(te.image)?X.mipmaps.length:1}function C(te){return te===Zn||te===aF||te===nM?i.NEAREST:i.LINEAR}function N(te){const X=te.target;X.removeEventListener("dispose",N),L(X),X.isVideoTexture&&m.delete(X)}function P(te){const X=te.target;X.removeEventListener("dispose",P),F(X)}function L(te){const X=n.get(te);if(X.__webglInit===void 0)return;const ye=te.source,ke=v.get(ye);if(ke){const ge=ke[X.__cacheKey];ge.usedTimes--,ge.usedTimes===0&&R(te),Object.keys(ke).length===0&&v.delete(ye)}n.remove(te)}function R(te){const X=n.get(te);i.deleteTexture(X.__webglTexture);const ye=te.source,ke=v.get(ye);delete ke[X.__cacheKey],o.memory.textures--}function F(te){const X=te.texture,ye=n.get(te),ke=n.get(X);if(ke.__webglTexture!==void 0&&(i.deleteTexture(ke.__webglTexture),o.memory.textures--),te.depthTexture&&te.depthTexture.dispose(),te.isWebGLCubeRenderTarget)for(let ge=0;ge<6;ge++){if(Array.isArray(ye.__webglFramebuffer[ge]))for(let De=0;De<ye.__webglFramebuffer[ge].length;De++)i.deleteFramebuffer(ye.__webglFramebuffer[ge][De]);else i.deleteFramebuffer(ye.__webglFramebuffer[ge]);ye.__webglDepthbuffer&&i.deleteRenderbuffer(ye.__webglDepthbuffer[ge])}else{if(Array.isArray(ye.__webglFramebuffer))for(let ge=0;ge<ye.__webglFramebuffer.length;ge++)i.deleteFramebuffer(ye.__webglFramebuffer[ge]);else i.deleteFramebuffer(ye.__webglFramebuffer);if(ye.__webglDepthbuffer&&i.deleteRenderbuffer(ye.__webglDepthbuffer),ye.__webglMultisampledFramebuffer&&i.deleteFramebuffer(ye.__webglMultisampledFramebuffer),ye.__webglColorRenderbuffer)for(let ge=0;ge<ye.__webglColorRenderbuffer.length;ge++)ye.__webglColorRenderbuffer[ge]&&i.deleteRenderbuffer(ye.__webglColorRenderbuffer[ge]);ye.__webglDepthRenderbuffer&&i.deleteRenderbuffer(ye.__webglDepthRenderbuffer)}if(te.isWebGLMultipleRenderTargets)for(let ge=0,De=X.length;ge<De;ge++){const $e=n.get(X[ge]);$e.__webglTexture&&(i.deleteTexture($e.__webglTexture),o.memory.textures--),n.remove(X[ge])}n.remove(X),n.remove(te)}let V=0;function z(){V=0}function U(){const te=V;return te>=l&&console.warn("THREE.WebGLTextures: Trying to use "+te+" texture units while this GPU supports only "+l),V+=1,te}function G(te){const X=[];return X.push(te.wrapS),X.push(te.wrapT),X.push(te.wrapR||0),X.push(te.magFilter),X.push(te.minFilter),X.push(te.anisotropy),X.push(te.internalFormat),X.push(te.format),X.push(te.type),X.push(te.generateMipmaps),X.push(te.premultiplyAlpha),X.push(te.flipY),X.push(te.unpackAlignment),X.push(te.colorSpace),X.join()}function B(te,X){const ye=n.get(te);if(te.isVideoTexture&&de(te),te.isRenderTargetTexture===!1&&te.version>0&&ye.__version!==te.version){const ke=te.image;if(ke===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ke.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{le(ye,te,X);return}}t.bindTexture(i.TEXTURE_2D,ye.__webglTexture,i.TEXTURE0+X)}function D(te,X){const ye=n.get(te);if(te.version>0&&ye.__version!==te.version){le(ye,te,X);return}t.bindTexture(i.TEXTURE_2D_ARRAY,ye.__webglTexture,i.TEXTURE0+X)}function O(te,X){const ye=n.get(te);if(te.version>0&&ye.__version!==te.version){le(ye,te,X);return}t.bindTexture(i.TEXTURE_3D,ye.__webglTexture,i.TEXTURE0+X)}function j(te,X){const ye=n.get(te);if(te.version>0&&ye.__version!==te.version){se(ye,te,X);return}t.bindTexture(i.TEXTURE_CUBE_MAP,ye.__webglTexture,i.TEXTURE0+X)}const q={[WT]:i.REPEAT,[Ma]:i.CLAMP_TO_EDGE,[jT]:i.MIRRORED_REPEAT},Y={[Zn]:i.NEAREST,[aF]:i.NEAREST_MIPMAP_NEAREST,[nM]:i.NEAREST_MIPMAP_LINEAR,[es]:i.LINEAR,[wte]:i.LINEAR_MIPMAP_NEAREST,[q0]:i.LINEAR_MIPMAP_LINEAR},ie={[Ute]:i.NEVER,[$te]:i.ALWAYS,[Ote]:i.LESS,[zte]:i.LEQUAL,[Bte]:i.EQUAL,[Hte]:i.GEQUAL,[Gte]:i.GREATER,[Vte]:i.NOTEQUAL};function ne(te,X,ye){if(ye?(i.texParameteri(te,i.TEXTURE_WRAP_S,q[X.wrapS]),i.texParameteri(te,i.TEXTURE_WRAP_T,q[X.wrapT]),(te===i.TEXTURE_3D||te===i.TEXTURE_2D_ARRAY)&&i.texParameteri(te,i.TEXTURE_WRAP_R,q[X.wrapR]),i.texParameteri(te,i.TEXTURE_MAG_FILTER,Y[X.magFilter]),i.texParameteri(te,i.TEXTURE_MIN_FILTER,Y[X.minFilter])):(i.texParameteri(te,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(te,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(te===i.TEXTURE_3D||te===i.TEXTURE_2D_ARRAY)&&i.texParameteri(te,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),(X.wrapS!==Ma||X.wrapT!==Ma)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(te,i.TEXTURE_MAG_FILTER,C(X.magFilter)),i.texParameteri(te,i.TEXTURE_MIN_FILTER,C(X.minFilter)),X.minFilter!==Zn&&X.minFilter!==es&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),X.compareFunction&&(i.texParameteri(te,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(te,i.TEXTURE_COMPARE_FUNC,ie[X.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const ke=e.get("EXT_texture_filter_anisotropic");if(X.magFilter===Zn||X.minFilter!==nM&&X.minFilter!==q0||X.type===Ca&&e.has("OES_texture_float_linear")===!1||a===!1&&X.type===ld&&e.has("OES_texture_half_float_linear")===!1)return;(X.anisotropy>1||n.get(X).__currentAnisotropy)&&(i.texParameterf(te,ke.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(X.anisotropy,r.getMaxAnisotropy())),n.get(X).__currentAnisotropy=X.anisotropy)}}function Q(te,X){let ye=!1;te.__webglInit===void 0&&(te.__webglInit=!0,X.addEventListener("dispose",N));const ke=X.source;let ge=v.get(ke);ge===void 0&&(ge={},v.set(ke,ge));const De=G(X);if(De!==te.__cacheKey){ge[De]===void 0&&(ge[De]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,ye=!0),ge[De].usedTimes++;const $e=ge[te.__cacheKey];$e!==void 0&&(ge[te.__cacheKey].usedTimes--,$e.usedTimes===0&&R(X)),te.__cacheKey=De,te.__webglTexture=ge[De].texture}return ye}function le(te,X,ye){let ke=i.TEXTURE_2D;(X.isDataArrayTexture||X.isCompressedArrayTexture)&&(ke=i.TEXTURE_2D_ARRAY),X.isData3DTexture&&(ke=i.TEXTURE_3D);const ge=Q(te,X),De=X.source;t.bindTexture(ke,te.__webglTexture,i.TEXTURE0+ye);const $e=n.get(De);if(De.version!==$e.__version||ge===!0){t.activeTexture(i.TEXTURE0+ye);const Ae=jn.getPrimaries(jn.workingColorSpace),Ze=X.colorSpace===Wo?null:jn.getPrimaries(X.colorSpace),nt=X.colorSpace===Wo||Ae===Ze?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,X.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,X.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,X.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,nt);const rt=A(X)&&y(X.image)===!1;let Oe=p(X.image,rt,!1,u);Oe=Ie(X,Oe);const qe=y(Oe)||a,it=s.convert(X.format,X.colorSpace);let at=s.convert(X.type),ht=T(X.internalFormat,it,at,X.colorSpace,X.isVideoTexture);ne(ke,X,qe);let Qe;const je=X.mipmaps,ee=a&&X.isVideoTexture!==!0,ze=$e.__version===void 0||ge===!0,Ee=E(X,Oe,qe);if(X.isDepthTexture)ht=i.DEPTH_COMPONENT,a?X.type===Ca?ht=i.DEPTH_COMPONENT32F:X.type===iu?ht=i.DEPTH_COMPONENT24:X.type===Xh?ht=i.DEPTH24_STENCIL8:ht=i.DEPTH_COMPONENT16:X.type===Ca&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),X.format===qh&&ht===i.DEPTH_COMPONENT&&X.type!==MR&&X.type!==iu&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),X.type=iu,at=s.convert(X.type)),X.format===zp&&ht===i.DEPTH_COMPONENT&&(ht=i.DEPTH_STENCIL,X.type!==Xh&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),X.type=Xh,at=s.convert(X.type))),ze&&(ee?t.texStorage2D(i.TEXTURE_2D,1,ht,Oe.width,Oe.height):t.texImage2D(i.TEXTURE_2D,0,ht,Oe.width,Oe.height,0,it,at,null));else if(X.isDataTexture)if(je.length>0&&qe){ee&&ze&&t.texStorage2D(i.TEXTURE_2D,Ee,ht,je[0].width,je[0].height);for(let Re=0,Xe=je.length;Re<Xe;Re++)Qe=je[Re],ee?t.texSubImage2D(i.TEXTURE_2D,Re,0,0,Qe.width,Qe.height,it,at,Qe.data):t.texImage2D(i.TEXTURE_2D,Re,ht,Qe.width,Qe.height,0,it,at,Qe.data);X.generateMipmaps=!1}else ee?(ze&&t.texStorage2D(i.TEXTURE_2D,Ee,ht,Oe.width,Oe.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,Oe.width,Oe.height,it,at,Oe.data)):t.texImage2D(i.TEXTURE_2D,0,ht,Oe.width,Oe.height,0,it,at,Oe.data);else if(X.isCompressedTexture)if(X.isCompressedArrayTexture){ee&&ze&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Ee,ht,je[0].width,je[0].height,Oe.depth);for(let Re=0,Xe=je.length;Re<Xe;Re++)Qe=je[Re],X.format!==Ws?it!==null?ee?t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,Re,0,0,0,Qe.width,Qe.height,Oe.depth,it,Qe.data,0,0):t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,Re,ht,Qe.width,Qe.height,Oe.depth,0,Qe.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ee?t.texSubImage3D(i.TEXTURE_2D_ARRAY,Re,0,0,0,Qe.width,Qe.height,Oe.depth,it,at,Qe.data):t.texImage3D(i.TEXTURE_2D_ARRAY,Re,ht,Qe.width,Qe.height,Oe.depth,0,it,at,Qe.data)}else{ee&&ze&&t.texStorage2D(i.TEXTURE_2D,Ee,ht,je[0].width,je[0].height);for(let Re=0,Xe=je.length;Re<Xe;Re++)Qe=je[Re],X.format!==Ws?it!==null?ee?t.compressedTexSubImage2D(i.TEXTURE_2D,Re,0,0,Qe.width,Qe.height,it,Qe.data):t.compressedTexImage2D(i.TEXTURE_2D,Re,ht,Qe.width,Qe.height,0,Qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ee?t.texSubImage2D(i.TEXTURE_2D,Re,0,0,Qe.width,Qe.height,it,at,Qe.data):t.texImage2D(i.TEXTURE_2D,Re,ht,Qe.width,Qe.height,0,it,at,Qe.data)}else if(X.isDataArrayTexture)ee?(ze&&t.texStorage3D(i.TEXTURE_2D_ARRAY,Ee,ht,Oe.width,Oe.height,Oe.depth),t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,Oe.width,Oe.height,Oe.depth,it,at,Oe.data)):t.texImage3D(i.TEXTURE_2D_ARRAY,0,ht,Oe.width,Oe.height,Oe.depth,0,it,at,Oe.data);else if(X.isData3DTexture)ee?(ze&&t.texStorage3D(i.TEXTURE_3D,Ee,ht,Oe.width,Oe.height,Oe.depth),t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,Oe.width,Oe.height,Oe.depth,it,at,Oe.data)):t.texImage3D(i.TEXTURE_3D,0,ht,Oe.width,Oe.height,Oe.depth,0,it,at,Oe.data);else if(X.isFramebufferTexture){if(ze)if(ee)t.texStorage2D(i.TEXTURE_2D,Ee,ht,Oe.width,Oe.height);else{let Re=Oe.width,Xe=Oe.height;for(let gt=0;gt<Ee;gt++)t.texImage2D(i.TEXTURE_2D,gt,ht,Re,Xe,0,it,at,null),Re>>=1,Xe>>=1}}else if(je.length>0&&qe){ee&&ze&&t.texStorage2D(i.TEXTURE_2D,Ee,ht,je[0].width,je[0].height);for(let Re=0,Xe=je.length;Re<Xe;Re++)Qe=je[Re],ee?t.texSubImage2D(i.TEXTURE_2D,Re,0,0,it,at,Qe):t.texImage2D(i.TEXTURE_2D,Re,ht,it,at,Qe);X.generateMipmaps=!1}else ee?(ze&&t.texStorage2D(i.TEXTURE_2D,Ee,ht,Oe.width,Oe.height),t.texSubImage2D(i.TEXTURE_2D,0,0,0,it,at,Oe)):t.texImage2D(i.TEXTURE_2D,0,ht,it,at,Oe);w(X,qe)&&M(ke),$e.__version=De.version,X.onUpdate&&X.onUpdate(X)}te.__version=X.version}function se(te,X,ye){if(X.image.length!==6)return;const ke=Q(te,X),ge=X.source;t.bindTexture(i.TEXTURE_CUBE_MAP,te.__webglTexture,i.TEXTURE0+ye);const De=n.get(ge);if(ge.version!==De.__version||ke===!0){t.activeTexture(i.TEXTURE0+ye);const $e=jn.getPrimaries(jn.workingColorSpace),Ae=X.colorSpace===Wo?null:jn.getPrimaries(X.colorSpace),Ze=X.colorSpace===Wo||$e===Ae?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,X.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,X.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,X.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ze);const nt=X.isCompressedTexture||X.image[0].isCompressedTexture,rt=X.image[0]&&X.image[0].isDataTexture,Oe=[];for(let Re=0;Re<6;Re++)!nt&&!rt?Oe[Re]=p(X.image[Re],!1,!0,c):Oe[Re]=rt?X.image[Re].image:X.image[Re],Oe[Re]=Ie(X,Oe[Re]);const qe=Oe[0],it=y(qe)||a,at=s.convert(X.format,X.colorSpace),ht=s.convert(X.type),Qe=T(X.internalFormat,at,ht,X.colorSpace),je=a&&X.isVideoTexture!==!0,ee=De.__version===void 0||ke===!0;let ze=E(X,qe,it);ne(i.TEXTURE_CUBE_MAP,X,it);let Ee;if(nt){je&&ee&&t.texStorage2D(i.TEXTURE_CUBE_MAP,ze,Qe,qe.width,qe.height);for(let Re=0;Re<6;Re++){Ee=Oe[Re].mipmaps;for(let Xe=0;Xe<Ee.length;Xe++){const gt=Ee[Xe];X.format!==Ws?at!==null?je?t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,Xe,0,0,gt.width,gt.height,at,gt.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,Xe,Qe,gt.width,gt.height,0,gt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,Xe,0,0,gt.width,gt.height,at,ht,gt.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,Xe,Qe,gt.width,gt.height,0,at,ht,gt.data)}}}else{Ee=X.mipmaps,je&&ee&&(Ee.length>0&&ze++,t.texStorage2D(i.TEXTURE_CUBE_MAP,ze,Qe,Oe[0].width,Oe[0].height));for(let Re=0;Re<6;Re++)if(rt){je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,0,0,Oe[Re].width,Oe[Re].height,at,ht,Oe[Re].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,Qe,Oe[Re].width,Oe[Re].height,0,at,ht,Oe[Re].data);for(let Xe=0;Xe<Ee.length;Xe++){const _t=Ee[Xe].image[Re].image;je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,Xe+1,0,0,_t.width,_t.height,at,ht,_t.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,Xe+1,Qe,_t.width,_t.height,0,at,ht,_t.data)}}else{je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,0,0,at,ht,Oe[Re]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,Qe,at,ht,Oe[Re]);for(let Xe=0;Xe<Ee.length;Xe++){const gt=Ee[Xe];je?t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,Xe+1,0,0,at,ht,gt.image[Re]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Re,Xe+1,Qe,at,ht,gt.image[Re])}}}w(X,it)&&M(i.TEXTURE_CUBE_MAP),De.__version=ge.version,X.onUpdate&&X.onUpdate(X)}te.__version=X.version}function oe(te,X,ye,ke,ge,De){const $e=s.convert(ye.format,ye.colorSpace),Ae=s.convert(ye.type),Ze=T(ye.internalFormat,$e,Ae,ye.colorSpace);if(!n.get(X).__hasExternalTextures){const rt=Math.max(1,X.width>>De),Oe=Math.max(1,X.height>>De);ge===i.TEXTURE_3D||ge===i.TEXTURE_2D_ARRAY?t.texImage3D(ge,De,Ze,rt,Oe,X.depth,0,$e,Ae,null):t.texImage2D(ge,De,Ze,rt,Oe,0,$e,Ae,null)}t.bindFramebuffer(i.FRAMEBUFFER,te),J(X)?d.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,ke,ge,n.get(ye).__webglTexture,0,Z(X)):(ge===i.TEXTURE_2D||ge>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&ge<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,ke,ge,n.get(ye).__webglTexture,De),t.bindFramebuffer(i.FRAMEBUFFER,null)}function $(te,X,ye){if(i.bindRenderbuffer(i.RENDERBUFFER,te),X.depthBuffer&&!X.stencilBuffer){let ke=a===!0?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT16;if(ye||J(X)){const ge=X.depthTexture;ge&&ge.isDepthTexture&&(ge.type===Ca?ke=i.DEPTH_COMPONENT32F:ge.type===iu&&(ke=i.DEPTH_COMPONENT24));const De=Z(X);J(X)?d.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,De,ke,X.width,X.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,De,ke,X.width,X.height)}else i.renderbufferStorage(i.RENDERBUFFER,ke,X.width,X.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,te)}else if(X.depthBuffer&&X.stencilBuffer){const ke=Z(X);ye&&J(X)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,ke,i.DEPTH24_STENCIL8,X.width,X.height):J(X)?d.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,ke,i.DEPTH24_STENCIL8,X.width,X.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,X.width,X.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,te)}else{const ke=X.isWebGLMultipleRenderTargets===!0?X.texture:[X.texture];for(let ge=0;ge<ke.length;ge++){const De=ke[ge],$e=s.convert(De.format,De.colorSpace),Ae=s.convert(De.type),Ze=T(De.internalFormat,$e,Ae,De.colorSpace),nt=Z(X);ye&&J(X)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,nt,Ze,X.width,X.height):J(X)?d.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,nt,Ze,X.width,X.height):i.renderbufferStorage(i.RENDERBUFFER,Ze,X.width,X.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function pe(te,X){if(X&&X.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,te),!(X.depthTexture&&X.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(X.depthTexture).__webglTexture||X.depthTexture.image.width!==X.width||X.depthTexture.image.height!==X.height)&&(X.depthTexture.image.width=X.width,X.depthTexture.image.height=X.height,X.depthTexture.needsUpdate=!0),B(X.depthTexture,0);const ke=n.get(X.depthTexture).__webglTexture,ge=Z(X);if(X.depthTexture.format===qh)J(X)?d.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,ke,0,ge):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,ke,0);else if(X.depthTexture.format===zp)J(X)?d.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,ke,0,ge):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,ke,0);else throw new Error("Unknown depthTexture format")}function xe(te){const X=n.get(te),ye=te.isWebGLCubeRenderTarget===!0;if(te.depthTexture&&!X.__autoAllocateDepthBuffer){if(ye)throw new Error("target.depthTexture not supported in Cube render targets");pe(X.__webglFramebuffer,te)}else if(ye){X.__webglDepthbuffer=[];for(let ke=0;ke<6;ke++)t.bindFramebuffer(i.FRAMEBUFFER,X.__webglFramebuffer[ke]),X.__webglDepthbuffer[ke]=i.createRenderbuffer(),$(X.__webglDepthbuffer[ke],te,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,X.__webglFramebuffer),X.__webglDepthbuffer=i.createRenderbuffer(),$(X.__webglDepthbuffer,te,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}function Pe(te,X,ye){const ke=n.get(te);X!==void 0&&oe(ke.__webglFramebuffer,te,te.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),ye!==void 0&&xe(te)}function ve(te){const X=te.texture,ye=n.get(te),ke=n.get(X);te.addEventListener("dispose",P),te.isWebGLMultipleRenderTargets!==!0&&(ke.__webglTexture===void 0&&(ke.__webglTexture=i.createTexture()),ke.__version=X.version,o.memory.textures++);const ge=te.isWebGLCubeRenderTarget===!0,De=te.isWebGLMultipleRenderTargets===!0,$e=y(te)||a;if(ge){ye.__webglFramebuffer=[];for(let Ae=0;Ae<6;Ae++)if(a&&X.mipmaps&&X.mipmaps.length>0){ye.__webglFramebuffer[Ae]=[];for(let Ze=0;Ze<X.mipmaps.length;Ze++)ye.__webglFramebuffer[Ae][Ze]=i.createFramebuffer()}else ye.__webglFramebuffer[Ae]=i.createFramebuffer()}else{if(a&&X.mipmaps&&X.mipmaps.length>0){ye.__webglFramebuffer=[];for(let Ae=0;Ae<X.mipmaps.length;Ae++)ye.__webglFramebuffer[Ae]=i.createFramebuffer()}else ye.__webglFramebuffer=i.createFramebuffer();if(De)if(r.drawBuffers){const Ae=te.texture;for(let Ze=0,nt=Ae.length;Ze<nt;Ze++){const rt=n.get(Ae[Ze]);rt.__webglTexture===void 0&&(rt.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&te.samples>0&&J(te)===!1){const Ae=De?X:[X];ye.__webglMultisampledFramebuffer=i.createFramebuffer(),ye.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,ye.__webglMultisampledFramebuffer);for(let Ze=0;Ze<Ae.length;Ze++){const nt=Ae[Ze];ye.__webglColorRenderbuffer[Ze]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,ye.__webglColorRenderbuffer[Ze]);const rt=s.convert(nt.format,nt.colorSpace),Oe=s.convert(nt.type),qe=T(nt.internalFormat,rt,Oe,nt.colorSpace,te.isXRRenderTarget===!0),it=Z(te);i.renderbufferStorageMultisample(i.RENDERBUFFER,it,qe,te.width,te.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Ze,i.RENDERBUFFER,ye.__webglColorRenderbuffer[Ze])}i.bindRenderbuffer(i.RENDERBUFFER,null),te.depthBuffer&&(ye.__webglDepthRenderbuffer=i.createRenderbuffer(),$(ye.__webglDepthRenderbuffer,te,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(ge){t.bindTexture(i.TEXTURE_CUBE_MAP,ke.__webglTexture),ne(i.TEXTURE_CUBE_MAP,X,$e);for(let Ae=0;Ae<6;Ae++)if(a&&X.mipmaps&&X.mipmaps.length>0)for(let Ze=0;Ze<X.mipmaps.length;Ze++)oe(ye.__webglFramebuffer[Ae][Ze],te,X,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,Ze);else oe(ye.__webglFramebuffer[Ae],te,X,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0);w(X,$e)&&M(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(De){const Ae=te.texture;for(let Ze=0,nt=Ae.length;Ze<nt;Ze++){const rt=Ae[Ze],Oe=n.get(rt);t.bindTexture(i.TEXTURE_2D,Oe.__webglTexture),ne(i.TEXTURE_2D,rt,$e),oe(ye.__webglFramebuffer,te,rt,i.COLOR_ATTACHMENT0+Ze,i.TEXTURE_2D,0),w(rt,$e)&&M(i.TEXTURE_2D)}t.unbindTexture()}else{let Ae=i.TEXTURE_2D;if((te.isWebGL3DRenderTarget||te.isWebGLArrayRenderTarget)&&(a?Ae=te.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Ae,ke.__webglTexture),ne(Ae,X,$e),a&&X.mipmaps&&X.mipmaps.length>0)for(let Ze=0;Ze<X.mipmaps.length;Ze++)oe(ye.__webglFramebuffer[Ze],te,X,i.COLOR_ATTACHMENT0,Ae,Ze);else oe(ye.__webglFramebuffer,te,X,i.COLOR_ATTACHMENT0,Ae,0);w(X,$e)&&M(Ae),t.unbindTexture()}te.depthBuffer&&xe(te)}function Ue(te){const X=y(te)||a,ye=te.isWebGLMultipleRenderTargets===!0?te.texture:[te.texture];for(let ke=0,ge=ye.length;ke<ge;ke++){const De=ye[ke];if(w(De,X)){const $e=te.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,Ae=n.get(De).__webglTexture;t.bindTexture($e,Ae),M($e),t.unbindTexture()}}}function Le(te){if(a&&te.samples>0&&J(te)===!1){const X=te.isWebGLMultipleRenderTargets?te.texture:[te.texture],ye=te.width,ke=te.height;let ge=i.COLOR_BUFFER_BIT;const De=[],$e=te.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,Ae=n.get(te),Ze=te.isWebGLMultipleRenderTargets===!0;if(Ze)for(let nt=0;nt<X.length;nt++)t.bindFramebuffer(i.FRAMEBUFFER,Ae.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+nt,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,Ae.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+nt,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,Ae.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ae.__webglFramebuffer);for(let nt=0;nt<X.length;nt++){De.push(i.COLOR_ATTACHMENT0+nt),te.depthBuffer&&De.push($e);const rt=Ae.__ignoreDepthValues!==void 0?Ae.__ignoreDepthValues:!1;if(rt===!1&&(te.depthBuffer&&(ge|=i.DEPTH_BUFFER_BIT),te.stencilBuffer&&(ge|=i.STENCIL_BUFFER_BIT)),Ze&&i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,Ae.__webglColorRenderbuffer[nt]),rt===!0&&(i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[$e]),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[$e])),Ze){const Oe=n.get(X[nt]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,Oe,0)}i.blitFramebuffer(0,0,ye,ke,0,0,ye,ke,ge,i.NEAREST),f&&i.invalidateFramebuffer(i.READ_FRAMEBUFFER,De)}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),Ze)for(let nt=0;nt<X.length;nt++){t.bindFramebuffer(i.FRAMEBUFFER,Ae.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+nt,i.RENDERBUFFER,Ae.__webglColorRenderbuffer[nt]);const rt=n.get(X[nt]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,Ae.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+nt,i.TEXTURE_2D,rt,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,Ae.__webglMultisampledFramebuffer)}}function Z(te){return Math.min(h,te.samples)}function J(te){const X=n.get(te);return a&&te.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&X.__useRenderToTexture!==!1}function de(te){const X=o.render.frame;m.get(te)!==X&&(m.set(te,X),te.update())}function Ie(te,X){const ye=te.colorSpace,ke=te.format,ge=te.type;return te.isCompressedTexture===!0||te.isVideoTexture===!0||te.format===XT||ye!==hc&&ye!==Wo&&(jn.getTransfer(ye)===ri?a===!1?e.has("EXT_sRGB")===!0&&ke===Ws?(te.format=XT,te.minFilter=es,te.generateMipmaps=!1):X=nG.sRGBToLinear(X):(ke!==Ws||ge!==La)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ye)),X}this.allocateTextureUnit=U,this.resetTextureUnits=z,this.setTexture2D=B,this.setTexture2DArray=D,this.setTexture3D=O,this.setTextureCube=j,this.rebindTextures=Pe,this.setupRenderTarget=ve,this.updateRenderTargetMipmap=Ue,this.updateMultisampleRenderTarget=Le,this.setupDepthRenderbuffer=xe,this.setupFrameBufferTexture=oe,this.useMultisampledRTT=J}function Goe(i,e,t){const n=t.isWebGL2;function r(s,o=Wo){let a;const l=jn.getTransfer(o);if(s===La)return i.UNSIGNED_BYTE;if(s===Y8)return i.UNSIGNED_SHORT_4_4_4_4;if(s===K8)return i.UNSIGNED_SHORT_5_5_5_1;if(s===Mte)return i.BYTE;if(s===Ate)return i.SHORT;if(s===MR)return i.UNSIGNED_SHORT;if(s===q8)return i.INT;if(s===iu)return i.UNSIGNED_INT;if(s===Ca)return i.FLOAT;if(s===ld)return n?i.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===Ete)return i.ALPHA;if(s===Ws)return i.RGBA;if(s===Tte)return i.LUMINANCE;if(s===Cte)return i.LUMINANCE_ALPHA;if(s===qh)return i.DEPTH_COMPONENT;if(s===zp)return i.DEPTH_STENCIL;if(s===XT)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===Pte)return i.RED;if(s===Z8)return i.RED_INTEGER;if(s===Rte)return i.RG;if(s===Q8)return i.RG_INTEGER;if(s===J8)return i.RGBA_INTEGER;if(s===iM||s===rM||s===sM||s===oM)if(l===ri)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===iM)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===rM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===sM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===oM)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===iM)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===rM)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===sM)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===oM)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===lF||s===cF||s===uF||s===hF)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===lF)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===cF)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===uF)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===hF)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===Ite)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===dF||s===fF)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===dF)return l===ri?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===fF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===pF||s===mF||s===gF||s===vF||s===_F||s===yF||s===xF||s===bF||s===SF||s===wF||s===MF||s===AF||s===EF||s===TF)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===pF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===mF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===gF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===vF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===_F)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===yF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===xF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===bF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===SF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===wF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===MF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===AF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===EF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===TF)return l===ri?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===aM||s===CF||s===PF)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===aM)return l===ri?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===CF)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===PF)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===Lte||s===RF||s===IF||s===LF)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===aM)return a.COMPRESSED_RED_RGTC1_EXT;if(s===RF)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===IF)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===LF)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Xh?n?i.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[s]!==void 0?i[s]:null}return{convert:r}}class Voe extends Hs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Xn extends Er{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Hoe={type:"move"};class IM{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Xn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Xn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new me,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new me),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Xn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new me,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new me),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const _ of e.hand.values()){const v=t.getJointPose(_,n),g=this._getHandJoint(c,_);v!==null&&(g.matrix.fromArray(v.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=v.radius),g.visible=v!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),f=.02,m=.005;c.inputState.pinching&&d>f+m?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=f-m&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Hoe)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Xn;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class $oe extends Ts{constructor(e,t,n,r,s,o,a,l,c,u){if(u=u!==void 0?u:qh,u!==qh&&u!==zp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===qh&&(n=iu),n===void 0&&u===zp&&(n=Xh),super(null,r,s,o,a,l,u,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Zn,this.minFilter=l!==void 0?l:Zn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class Woe extends im{constructor(e,t){super();const n=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,h=null,d=null,f=null,m=null;const _=t.getContextAttributes();let v=null,g=null;const b=[],p=[],y=new Hs;y.layers.enable(1),y.viewport=new Mr;const A=new Hs;A.layers.enable(2),A.viewport=new Mr;const w=[y,A],M=new Voe;M.layers.enable(1),M.layers.enable(2);let T=null,E=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(D){let O=b[D];return O===void 0&&(O=new IM,b[D]=O),O.getTargetRaySpace()},this.getControllerGrip=function(D){let O=b[D];return O===void 0&&(O=new IM,b[D]=O),O.getGripSpace()},this.getHand=function(D){let O=b[D];return O===void 0&&(O=new IM,b[D]=O),O.getHandSpace()};function C(D){const O=p.indexOf(D.inputSource);if(O===-1)return;const j=b[O];j!==void 0&&(j.update(D.inputSource,D.frame,c||o),j.dispatchEvent({type:D.type,data:D.inputSource}))}function N(){r.removeEventListener("select",C),r.removeEventListener("selectstart",C),r.removeEventListener("selectend",C),r.removeEventListener("squeeze",C),r.removeEventListener("squeezestart",C),r.removeEventListener("squeezeend",C),r.removeEventListener("end",N),r.removeEventListener("inputsourceschange",P);for(let D=0;D<b.length;D++){const O=p[D];O!==null&&(p[D]=null,b[D].disconnect(O))}T=null,E=null,e.setRenderTarget(v),f=null,d=null,h=null,r=null,g=null,B.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(D){s=D,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(D){a=D,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(D){c=D},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return m},this.getSession=function(){return r},this.setSession=async function(D){if(r=D,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",C),r.addEventListener("selectstart",C),r.addEventListener("selectend",C),r.addEventListener("squeeze",C),r.addEventListener("squeezestart",C),r.addEventListener("squeezeend",C),r.addEventListener("end",N),r.addEventListener("inputsourceschange",P),_.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const O={antialias:r.renderState.layers===void 0?_.antialias:!0,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(r,t,O),r.updateRenderState({baseLayer:f}),g=new ol(f.framebufferWidth,f.framebufferHeight,{format:Ws,type:La,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil})}else{let O=null,j=null,q=null;_.depth&&(q=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,O=_.stencil?zp:qh,j=_.stencil?Xh:iu);const Y={colorFormat:t.RGBA8,depthFormat:q,scaleFactor:s};h=new XRWebGLBinding(r,t),d=h.createProjectionLayer(Y),r.updateRenderState({layers:[d]}),g=new ol(d.textureWidth,d.textureHeight,{format:Ws,type:La,depthTexture:new $oe(d.textureWidth,d.textureHeight,j,void 0,void 0,void 0,void 0,void 0,void 0,O),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0});const ie=e.properties.get(g);ie.__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),B.setContext(r),B.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function P(D){for(let O=0;O<D.removed.length;O++){const j=D.removed[O],q=p.indexOf(j);q>=0&&(p[q]=null,b[q].disconnect(j))}for(let O=0;O<D.added.length;O++){const j=D.added[O];let q=p.indexOf(j);if(q===-1){for(let ie=0;ie<b.length;ie++)if(ie>=p.length){p.push(j),q=ie;break}else if(p[ie]===null){p[ie]=j,q=ie;break}if(q===-1)break}const Y=b[q];Y&&Y.connect(j)}}const L=new me,R=new me;function F(D,O,j){L.setFromMatrixPosition(O.matrixWorld),R.setFromMatrixPosition(j.matrixWorld);const q=L.distanceTo(R),Y=O.projectionMatrix.elements,ie=j.projectionMatrix.elements,ne=Y[14]/(Y[10]-1),Q=Y[14]/(Y[10]+1),le=(Y[9]+1)/Y[5],se=(Y[9]-1)/Y[5],oe=(Y[8]-1)/Y[0],$=(ie[8]+1)/ie[0],pe=ne*oe,xe=ne*$,Pe=q/(-oe+$),ve=Pe*-oe;O.matrixWorld.decompose(D.position,D.quaternion,D.scale),D.translateX(ve),D.translateZ(Pe),D.matrixWorld.compose(D.position,D.quaternion,D.scale),D.matrixWorldInverse.copy(D.matrixWorld).invert();const Ue=ne+Pe,Le=Q+Pe,Z=pe-ve,J=xe+(q-ve),de=le*Q/Le*Ue,Ie=se*Q/Le*Ue;D.projectionMatrix.makePerspective(Z,J,de,Ie,Ue,Le),D.projectionMatrixInverse.copy(D.projectionMatrix).invert()}function V(D,O){O===null?D.matrixWorld.copy(D.matrix):D.matrixWorld.multiplyMatrices(O.matrixWorld,D.matrix),D.matrixWorldInverse.copy(D.matrixWorld).invert()}this.updateCamera=function(D){if(r===null)return;M.near=A.near=y.near=D.near,M.far=A.far=y.far=D.far,(T!==M.near||E!==M.far)&&(r.updateRenderState({depthNear:M.near,depthFar:M.far}),T=M.near,E=M.far);const O=D.parent,j=M.cameras;V(M,O);for(let q=0;q<j.length;q++)V(j[q],O);j.length===2?F(M,y,A):M.projectionMatrix.copy(y.projectionMatrix),z(D,M,O)};function z(D,O,j){j===null?D.matrix.copy(O.matrixWorld):(D.matrix.copy(j.matrixWorld),D.matrix.invert(),D.matrix.multiply(O.matrixWorld)),D.matrix.decompose(D.position,D.quaternion,D.scale),D.updateMatrixWorld(!0),D.projectionMatrix.copy(O.projectionMatrix),D.projectionMatrixInverse.copy(O.projectionMatrixInverse),D.isPerspectiveCamera&&(D.fov=qT*2*Math.atan(1/D.projectionMatrix.elements[5]),D.zoom=1)}this.getCamera=function(){return M},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(D){l=D,d!==null&&(d.fixedFoveation=D),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=D)};let U=null;function G(D,O){if(u=O.getViewerPose(c||o),m=O,u!==null){const j=u.views;f!==null&&(e.setRenderTargetFramebuffer(g,f.framebuffer),e.setRenderTarget(g));let q=!1;j.length!==M.cameras.length&&(M.cameras.length=0,q=!0);for(let Y=0;Y<j.length;Y++){const ie=j[Y];let ne=null;if(f!==null)ne=f.getViewport(ie);else{const le=h.getViewSubImage(d,ie);ne=le.viewport,Y===0&&(e.setRenderTargetTextures(g,le.colorTexture,d.ignoreDepthValues?void 0:le.depthStencilTexture),e.setRenderTarget(g))}let Q=w[Y];Q===void 0&&(Q=new Hs,Q.layers.enable(Y),Q.viewport=new Mr,w[Y]=Q),Q.matrix.fromArray(ie.transform.matrix),Q.matrix.decompose(Q.position,Q.quaternion,Q.scale),Q.projectionMatrix.fromArray(ie.projectionMatrix),Q.projectionMatrixInverse.copy(Q.projectionMatrix).invert(),Q.viewport.set(ne.x,ne.y,ne.width,ne.height),Y===0&&(M.matrix.copy(Q.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),q===!0&&M.cameras.push(Q)}}for(let j=0;j<b.length;j++){const q=p[j],Y=b[j];q!==null&&Y!==void 0&&Y.update(q,O,c||o)}U&&U(D,O),O.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:O}),m=null}const B=new fG;B.setAnimationLoop(G),this.setAnimationLoop=function(D){U=D},this.dispose=function(){}}}function joe(i,e){function t(v,g){v.matrixAutoUpdate===!0&&v.updateMatrix(),g.value.copy(v.matrix)}function n(v,g){g.color.getRGB(v.fogColor.value,uG(i)),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function r(v,g,b,p,y){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(v,g):g.isMeshToonMaterial?(s(v,g),h(v,g)):g.isMeshPhongMaterial?(s(v,g),u(v,g)):g.isMeshStandardMaterial?(s(v,g),d(v,g),g.isMeshPhysicalMaterial&&f(v,g,y)):g.isMeshMatcapMaterial?(s(v,g),m(v,g)):g.isMeshDepthMaterial?s(v,g):g.isMeshDistanceMaterial?(s(v,g),_(v,g)):g.isMeshNormalMaterial?s(v,g):g.isLineBasicMaterial?(o(v,g),g.isLineDashedMaterial&&a(v,g)):g.isPointsMaterial?l(v,g,b,p):g.isSpriteMaterial?c(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function s(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.bumpMap&&(v.bumpMap.value=g.bumpMap,t(g.bumpMap,v.bumpMapTransform),v.bumpScale.value=g.bumpScale,g.side===Es&&(v.bumpScale.value*=-1)),g.normalMap&&(v.normalMap.value=g.normalMap,t(g.normalMap,v.normalMapTransform),v.normalScale.value.copy(g.normalScale),g.side===Es&&v.normalScale.value.negate()),g.displacementMap&&(v.displacementMap.value=g.displacementMap,t(g.displacementMap,v.displacementMapTransform),v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,v.emissiveMapTransform)),g.specularMap&&(v.specularMap.value=g.specularMap,t(g.specularMap,v.specularMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);const b=e.get(g).envMap;if(b&&(v.envMap.value=b,v.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap){v.lightMap.value=g.lightMap;const p=i._useLegacyLights===!0?Math.PI:1;v.lightMapIntensity.value=g.lightMapIntensity*p,t(g.lightMap,v.lightMapTransform)}g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,v.aoMapTransform))}function o(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform))}function a(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function l(v,g,b,p){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*b,v.scale.value=p*.5,g.map&&(v.map.value=g.map,t(g.map,v.uvTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function c(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function u(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function h(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function d(v,g){v.metalness.value=g.metalness,g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,v.metalnessMapTransform)),v.roughness.value=g.roughness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,v.roughnessMapTransform)),e.get(g).envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function f(v,g,b){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,v.sheenColorMapTransform)),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,v.sheenRoughnessMapTransform))),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,v.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(v.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===Es&&v.clearcoatNormalScale.value.negate())),g.iridescence>0&&(v.iridescence.value=g.iridescence,v.iridescenceIOR.value=g.iridescenceIOR,v.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(v.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,v.iridescenceMapTransform)),g.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=b.texture,v.transmissionSamplerSize.value.set(b.width,b.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,v.transmissionMapTransform)),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(v.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(v.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,v.specularColorMapTransform)),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,v.specularIntensityMapTransform))}function m(v,g){g.matcap&&(v.matcap.value=g.matcap)}function _(v,g){const b=e.get(g).light;v.referencePosition.value.setFromMatrixPosition(b.matrixWorld),v.nearDistance.value=b.shadow.camera.near,v.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:r}}function Xoe(i,e,t,n){let r={},s={},o=[];const a=t.isWebGL2?i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(b,p){const y=p.program;n.uniformBlockBinding(b,y)}function c(b,p){let y=r[b.id];y===void 0&&(m(b),y=u(b),r[b.id]=y,b.addEventListener("dispose",v));const A=p.program;n.updateUBOMapping(b,A);const w=e.render.frame;s[b.id]!==w&&(d(b),s[b.id]=w)}function u(b){const p=h();b.__bindingPointIndex=p;const y=i.createBuffer(),A=b.__size,w=b.usage;return i.bindBuffer(i.UNIFORM_BUFFER,y),i.bufferData(i.UNIFORM_BUFFER,A,w),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,p,y),y}function h(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(b){const p=r[b.id],y=b.uniforms,A=b.__cache;i.bindBuffer(i.UNIFORM_BUFFER,p);for(let w=0,M=y.length;w<M;w++){const T=y[w];if(f(T,w,A)===!0){const E=T.__offset,C=Array.isArray(T.value)?T.value:[T.value];let N=0;for(let P=0;P<C.length;P++){const L=C[P],R=_(L);typeof L=="number"?(T.__data[0]=L,i.bufferSubData(i.UNIFORM_BUFFER,E+N,T.__data)):L.isMatrix3?(T.__data[0]=L.elements[0],T.__data[1]=L.elements[1],T.__data[2]=L.elements[2],T.__data[3]=L.elements[0],T.__data[4]=L.elements[3],T.__data[5]=L.elements[4],T.__data[6]=L.elements[5],T.__data[7]=L.elements[0],T.__data[8]=L.elements[6],T.__data[9]=L.elements[7],T.__data[10]=L.elements[8],T.__data[11]=L.elements[0]):(L.toArray(T.__data,N),N+=R.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,E,T.__data)}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function f(b,p,y){const A=b.value;if(y[p]===void 0){if(typeof A=="number")y[p]=A;else{const w=Array.isArray(A)?A:[A],M=[];for(let T=0;T<w.length;T++)M.push(w[T].clone());y[p]=M}return!0}else if(typeof A=="number"){if(y[p]!==A)return y[p]=A,!0}else{const w=Array.isArray(y[p])?y[p]:[y[p]],M=Array.isArray(A)?A:[A];for(let T=0;T<w.length;T++){const E=w[T];if(E.equals(M[T])===!1)return E.copy(M[T]),!0}}return!1}function m(b){const p=b.uniforms;let y=0;const A=16;let w=0;for(let M=0,T=p.length;M<T;M++){const E=p[M],C={boundary:0,storage:0},N=Array.isArray(E.value)?E.value:[E.value];for(let P=0,L=N.length;P<L;P++){const R=N[P],F=_(R);C.boundary+=F.boundary,C.storage+=F.storage}if(E.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),E.__offset=y,M>0){w=y%A;const P=A-w;w!==0&&P-C.boundary<0&&(y+=A-w,E.__offset=y)}y+=C.storage}return w=y%A,w>0&&(y+=A-w),b.__size=y,b.__cache={},this}function _(b){const p={boundary:0,storage:0};return typeof b=="number"?(p.boundary=4,p.storage=4):b.isVector2?(p.boundary=8,p.storage=8):b.isVector3||b.isColor?(p.boundary=16,p.storage=12):b.isVector4?(p.boundary=16,p.storage=16):b.isMatrix3?(p.boundary=48,p.storage=48):b.isMatrix4?(p.boundary=64,p.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),p}function v(b){const p=b.target;p.removeEventListener("dispose",v);const y=o.indexOf(p.__bindingPointIndex);o.splice(y,1),i.deleteBuffer(r[p.id]),delete r[p.id],delete s[p.id]}function g(){for(const b in r)i.deleteBuffer(r[b]);o=[],r={},s={}}return{bind:l,update:c,dispose:g}}class _G{constructor(e={}){const{canvas:t=jte(),context:n=null,depth:r=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let d;n!==null?d=n.getContextAttributes().alpha:d=o;const f=new Uint32Array(4),m=new Int32Array(4);let _=null,v=null;const g=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Dr,this._useLegacyLights=!1,this.toneMapping=gu,this.toneMappingExposure=1;const p=this;let y=!1,A=0,w=0,M=null,T=-1,E=null;const C=new Mr,N=new Mr;let P=null;const L=new Ht(0);let R=0,F=t.width,V=t.height,z=1,U=null,G=null;const B=new Mr(0,0,F,V),D=new Mr(0,0,F,V);let O=!1;const j=new TR;let q=!1,Y=!1,ie=null;const ne=new Tt,Q=new sn,le=new me,se={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function oe(){return M===null?z:1}let $=n;function pe(H,fe){for(let Me=0;Me<H.length;Me++){const Se=H[Me],Te=t.getContext(Se,fe);if(Te!==null)return Te}return null}try{const H={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${wR}`),t.addEventListener("webglcontextlost",je,!1),t.addEventListener("webglcontextrestored",ee,!1),t.addEventListener("webglcontextcreationerror",ze,!1),$===null){const fe=["webgl2","webgl","experimental-webgl"];if(p.isWebGL1Renderer===!0&&fe.shift(),$=pe(fe,H),$===null)throw pe(fe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&$ instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),$.getShaderPrecisionFormat===void 0&&($.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H}let xe,Pe,ve,Ue,Le,Z,J,de,Ie,te,X,ye,ke,ge,De,$e,Ae,Ze,nt,rt,Oe,qe,it,at;function ht(){xe=new ise($),Pe=new Zre($,xe,e),xe.init(Pe),qe=new Goe($,xe,Pe),ve=new Boe($,xe,Pe),Ue=new ose($),Le=new Aoe,Z=new zoe($,xe,ve,Le,Pe,qe,Ue),J=new Jre(p),de=new nse(p),Ie=new gne($,Pe),it=new Yre($,xe,Ie,Pe),te=new rse($,Ie,Ue,it),X=new use($,te,Ie,Ue),nt=new cse($,Pe,Z),$e=new Qre(Le),ye=new Moe(p,J,de,xe,Pe,it,$e),ke=new joe(p,Le),ge=new Toe,De=new Doe(xe,Pe),Ze=new qre(p,J,de,ve,X,d,l),Ae=new Ooe(p,X,Pe),at=new Xoe($,Ue,Pe,ve),rt=new Kre($,xe,Ue,Pe),Oe=new sse($,xe,Ue,Pe),Ue.programs=ye.programs,p.capabilities=Pe,p.extensions=xe,p.properties=Le,p.renderLists=ge,p.shadowMap=Ae,p.state=ve,p.info=Ue}ht();const Qe=new Woe(p,$);this.xr=Qe,this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.forceContextLoss=function(){const H=xe.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){const H=xe.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return z},this.setPixelRatio=function(H){H!==void 0&&(z=H,this.setSize(F,V,!1))},this.getSize=function(H){return H.set(F,V)},this.setSize=function(H,fe,Me=!0){if(Qe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}F=H,V=fe,t.width=Math.floor(H*z),t.height=Math.floor(fe*z),Me===!0&&(t.style.width=H+"px",t.style.height=fe+"px"),this.setViewport(0,0,H,fe)},this.getDrawingBufferSize=function(H){return H.set(F*z,V*z).floor()},this.setDrawingBufferSize=function(H,fe,Me){F=H,V=fe,z=Me,t.width=Math.floor(H*Me),t.height=Math.floor(fe*Me),this.setViewport(0,0,H,fe)},this.getCurrentViewport=function(H){return H.copy(C)},this.getViewport=function(H){return H.copy(B)},this.setViewport=function(H,fe,Me,Se){H.isVector4?B.set(H.x,H.y,H.z,H.w):B.set(H,fe,Me,Se),ve.viewport(C.copy(B).multiplyScalar(z).floor())},this.getScissor=function(H){return H.copy(D)},this.setScissor=function(H,fe,Me,Se){H.isVector4?D.set(H.x,H.y,H.z,H.w):D.set(H,fe,Me,Se),ve.scissor(N.copy(D).multiplyScalar(z).floor())},this.getScissorTest=function(){return O},this.setScissorTest=function(H){ve.setScissorTest(O=H)},this.setOpaqueSort=function(H){U=H},this.setTransparentSort=function(H){G=H},this.getClearColor=function(H){return H.copy(Ze.getClearColor())},this.setClearColor=function(){Ze.setClearColor.apply(Ze,arguments)},this.getClearAlpha=function(){return Ze.getClearAlpha()},this.setClearAlpha=function(){Ze.setClearAlpha.apply(Ze,arguments)},this.clear=function(H=!0,fe=!0,Me=!0){let Se=0;if(H){let Te=!1;if(M!==null){const et=M.texture.format;Te=et===J8||et===Q8||et===Z8}if(Te){const et=M.texture.type,dt=et===La||et===iu||et===MR||et===Xh||et===Y8||et===K8,yt=Ze.getClearColor(),Ye=Ze.getClearAlpha(),We=yt.r,st=yt.g,ct=yt.b;dt?(f[0]=We,f[1]=st,f[2]=ct,f[3]=Ye,$.clearBufferuiv($.COLOR,0,f)):(m[0]=We,m[1]=st,m[2]=ct,m[3]=Ye,$.clearBufferiv($.COLOR,0,m))}else Se|=$.COLOR_BUFFER_BIT}fe&&(Se|=$.DEPTH_BUFFER_BIT),Me&&(Se|=$.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),$.clear(Se)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",je,!1),t.removeEventListener("webglcontextrestored",ee,!1),t.removeEventListener("webglcontextcreationerror",ze,!1),ge.dispose(),De.dispose(),Le.dispose(),J.dispose(),de.dispose(),X.dispose(),it.dispose(),at.dispose(),ye.dispose(),Qe.dispose(),Qe.removeEventListener("sessionstart",K),Qe.removeEventListener("sessionend",ae),ie&&(ie.dispose(),ie=null),ue.stop()};function je(H){H.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function ee(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const H=Ue.autoReset,fe=Ae.enabled,Me=Ae.autoUpdate,Se=Ae.needsUpdate,Te=Ae.type;ht(),Ue.autoReset=H,Ae.enabled=fe,Ae.autoUpdate=Me,Ae.needsUpdate=Se,Ae.type=Te}function ze(H){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",H.statusMessage)}function Ee(H){const fe=H.target;fe.removeEventListener("dispose",Ee),Re(fe)}function Re(H){Xe(H),Le.remove(H)}function Xe(H){const fe=Le.get(H).programs;fe!==void 0&&(fe.forEach(function(Me){ye.releaseProgram(Me)}),H.isShaderMaterial&&ye.releaseShaderCache(H))}this.renderBufferDirect=function(H,fe,Me,Se,Te,et){fe===null&&(fe=se);const dt=Te.isMesh&&Te.matrixWorld.determinant()<0,yt=zt(H,fe,Me,Se,Te);ve.setMaterial(Se,dt);let Ye=Me.index,We=1;if(Se.wireframe===!0){if(Ye=te.getWireframeAttribute(Me),Ye===void 0)return;We=2}const st=Me.drawRange,ct=Me.attributes.position;let Lt=st.start*We,Dt=(st.start+st.count)*We;et!==null&&(Lt=Math.max(Lt,et.start*We),Dt=Math.min(Dt,(et.start+et.count)*We)),Ye!==null?(Lt=Math.max(Lt,0),Dt=Math.min(Dt,Ye.count)):ct!=null&&(Lt=Math.max(Lt,0),Dt=Math.min(Dt,ct.count));const It=Dt-Lt;if(It<0||It===1/0)return;it.setup(Te,Se,yt,Me,Ye);let Ot,St=rt;if(Ye!==null&&(Ot=Ie.get(Ye),St=Oe,St.setIndex(Ot)),Te.isMesh)Se.wireframe===!0?(ve.setLineWidth(Se.wireframeLinewidth*oe()),St.setMode($.LINES)):St.setMode($.TRIANGLES);else if(Te.isLine){let vt=Se.linewidth;vt===void 0&&(vt=1),ve.setLineWidth(vt*oe()),Te.isLineSegments?St.setMode($.LINES):Te.isLineLoop?St.setMode($.LINE_LOOP):St.setMode($.LINE_STRIP)}else Te.isPoints?St.setMode($.POINTS):Te.isSprite&&St.setMode($.TRIANGLES);if(Te.isInstancedMesh)St.renderInstances(Lt,It,Te.count);else if(Me.isInstancedBufferGeometry){const vt=Me._maxInstanceCount!==void 0?Me._maxInstanceCount:1/0,$t=Math.min(Me.instanceCount,vt);St.renderInstances(Lt,It,$t)}else St.render(Lt,It)};function gt(H,fe,Me){H.transparent===!0&&H.side===Qa&&H.forceSinglePass===!1?(H.side=Es,H.needsUpdate=!0,lt(H,fe,Me),H.side=uc,H.needsUpdate=!0,lt(H,fe,Me),H.side=Qa):lt(H,fe,Me)}this.compile=function(H,fe,Me=null){Me===null&&(Me=H),v=De.get(Me),v.init(),b.push(v),Me.traverseVisible(function(Te){Te.isLight&&Te.layers.test(fe.layers)&&(v.pushLight(Te),Te.castShadow&&v.pushShadow(Te))}),H!==Me&&H.traverseVisible(function(Te){Te.isLight&&Te.layers.test(fe.layers)&&(v.pushLight(Te),Te.castShadow&&v.pushShadow(Te))}),v.setupLights(p._useLegacyLights);const Se=new Set;return H.traverse(function(Te){const et=Te.material;if(et)if(Array.isArray(et))for(let dt=0;dt<et.length;dt++){const yt=et[dt];gt(yt,Me,Te),Se.add(yt)}else gt(et,Me,Te),Se.add(et)}),b.pop(),v=null,Se},this.compileAsync=function(H,fe,Me=null){const Se=this.compile(H,fe,Me);return new Promise(Te=>{function et(){if(Se.forEach(function(dt){Le.get(dt).currentProgram.isReady()&&Se.delete(dt)}),Se.size===0){Te(H);return}setTimeout(et,10)}xe.get("KHR_parallel_shader_compile")!==null?et():setTimeout(et,10)})};let _t=null;function Mt(H){_t&&_t(H)}function K(){ue.stop()}function ae(){ue.start()}const ue=new fG;ue.setAnimationLoop(Mt),typeof self<"u"&&ue.setContext(self),this.setAnimationLoop=function(H){_t=H,Qe.setAnimationLoop(H),H===null?ue.stop():ue.start()},Qe.addEventListener("sessionstart",K),Qe.addEventListener("sessionend",ae),this.render=function(H,fe){if(fe!==void 0&&fe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),fe.parent===null&&fe.matrixWorldAutoUpdate===!0&&fe.updateMatrixWorld(),Qe.enabled===!0&&Qe.isPresenting===!0&&(Qe.cameraAutoUpdate===!0&&Qe.updateCamera(fe),fe=Qe.getCamera()),H.isScene===!0&&H.onBeforeRender(p,H,fe,M),v=De.get(H,b.length),v.init(),b.push(v),ne.multiplyMatrices(fe.projectionMatrix,fe.matrixWorldInverse),j.setFromProjectionMatrix(ne),Y=this.localClippingEnabled,q=$e.init(this.clippingPlanes,Y),_=ge.get(H,g.length),_.init(),g.push(_),_e(H,fe,0,p.sortObjects),_.finish(),p.sortObjects===!0&&_.sort(U,G),this.info.render.frame++,q===!0&&$e.beginShadows();const Me=v.state.shadowsArray;if(Ae.render(Me,H,fe),q===!0&&$e.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ze.render(_,H),v.setupLights(p._useLegacyLights),fe.isArrayCamera){const Se=fe.cameras;for(let Te=0,et=Se.length;Te<et;Te++){const dt=Se[Te];be(_,H,dt,dt.viewport)}}else be(_,H,fe);M!==null&&(Z.updateMultisampleRenderTarget(M),Z.updateRenderTargetMipmap(M)),H.isScene===!0&&H.onAfterRender(p,H,fe),it.resetDefaultState(),T=-1,E=null,b.pop(),b.length>0?v=b[b.length-1]:v=null,g.pop(),g.length>0?_=g[g.length-1]:_=null};function _e(H,fe,Me,Se){if(H.visible===!1)return;if(H.layers.test(fe.layers)){if(H.isGroup)Me=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(fe);else if(H.isLight)v.pushLight(H),H.castShadow&&v.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||j.intersectsSprite(H)){Se&&le.setFromMatrixPosition(H.matrixWorld).applyMatrix4(ne);const dt=X.update(H),yt=H.material;yt.visible&&_.push(H,dt,yt,Me,le.z,null)}}else if((H.isMesh||H.isLine||H.isPoints)&&(!H.frustumCulled||j.intersectsObject(H))){const dt=X.update(H),yt=H.material;if(Se&&(H.boundingSphere!==void 0?(H.boundingSphere===null&&H.computeBoundingSphere(),le.copy(H.boundingSphere.center)):(dt.boundingSphere===null&&dt.computeBoundingSphere(),le.copy(dt.boundingSphere.center)),le.applyMatrix4(H.matrixWorld).applyMatrix4(ne)),Array.isArray(yt)){const Ye=dt.groups;for(let We=0,st=Ye.length;We<st;We++){const ct=Ye[We],Lt=yt[ct.materialIndex];Lt&&Lt.visible&&_.push(H,dt,Lt,Me,le.z,ct)}}else yt.visible&&_.push(H,dt,yt,Me,le.z,null)}}const et=H.children;for(let dt=0,yt=et.length;dt<yt;dt++)_e(et[dt],fe,Me,Se)}function be(H,fe,Me,Se){const Te=H.opaque,et=H.transmissive,dt=H.transparent;v.setupLightsView(Me),q===!0&&$e.setGlobalState(p.clippingPlanes,Me),et.length>0&&Ne(Te,et,fe,Me),Se&&ve.viewport(C.copy(Se)),Te.length>0&&Be(Te,fe,Me),et.length>0&&Be(et,fe,Me),dt.length>0&&Be(dt,fe,Me),ve.buffers.depth.setTest(!0),ve.buffers.depth.setMask(!0),ve.buffers.color.setMask(!0),ve.setPolygonOffset(!1)}function Ne(H,fe,Me,Se){if((Me.isScene===!0?Me.overrideMaterial:null)!==null)return;const et=Pe.isWebGL2;ie===null&&(ie=new ol(1,1,{generateMipmaps:!0,type:xe.has("EXT_color_buffer_half_float")?ld:La,minFilter:q0,samples:et?4:0})),p.getDrawingBufferSize(Q),et?ie.setSize(Q.x,Q.y):ie.setSize(YT(Q.x),YT(Q.y));const dt=p.getRenderTarget();p.setRenderTarget(ie),p.getClearColor(L),R=p.getClearAlpha(),R<1&&p.setClearColor(16777215,.5),p.clear();const yt=p.toneMapping;p.toneMapping=gu,Be(H,Me,Se),Z.updateMultisampleRenderTarget(ie),Z.updateRenderTargetMipmap(ie);let Ye=!1;for(let We=0,st=fe.length;We<st;We++){const ct=fe[We],Lt=ct.object,Dt=ct.geometry,It=ct.material,Ot=ct.group;if(It.side===Qa&&Lt.layers.test(Se.layers)){const St=It.side;It.side=Es,It.needsUpdate=!0,He(Lt,Me,Se,Dt,It,Ot),It.side=St,It.needsUpdate=!0,Ye=!0}}Ye===!0&&(Z.updateMultisampleRenderTarget(ie),Z.updateRenderTargetMipmap(ie)),p.setRenderTarget(dt),p.setClearColor(L,R),p.toneMapping=yt}function Be(H,fe,Me){const Se=fe.isScene===!0?fe.overrideMaterial:null;for(let Te=0,et=H.length;Te<et;Te++){const dt=H[Te],yt=dt.object,Ye=dt.geometry,We=Se===null?dt.material:Se,st=dt.group;yt.layers.test(Me.layers)&&He(yt,fe,Me,Ye,We,st)}}function He(H,fe,Me,Se,Te,et){H.onBeforeRender(p,fe,Me,Se,Te,et),H.modelViewMatrix.multiplyMatrices(Me.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),Te.onBeforeRender(p,fe,Me,Se,H,et),Te.transparent===!0&&Te.side===Qa&&Te.forceSinglePass===!1?(Te.side=Es,Te.needsUpdate=!0,p.renderBufferDirect(Me,fe,Se,Te,H,et),Te.side=uc,Te.needsUpdate=!0,p.renderBufferDirect(Me,fe,Se,Te,H,et),Te.side=Qa):p.renderBufferDirect(Me,fe,Se,Te,H,et),H.onAfterRender(p,fe,Me,Se,Te,et)}function lt(H,fe,Me){fe.isScene!==!0&&(fe=se);const Se=Le.get(H),Te=v.state.lights,et=v.state.shadowsArray,dt=Te.state.version,yt=ye.getParameters(H,Te.state,et,fe,Me),Ye=ye.getProgramCacheKey(yt);let We=Se.programs;Se.environment=H.isMeshStandardMaterial?fe.environment:null,Se.fog=fe.fog,Se.envMap=(H.isMeshStandardMaterial?de:J).get(H.envMap||Se.environment),We===void 0&&(H.addEventListener("dispose",Ee),We=new Map,Se.programs=We);let st=We.get(Ye);if(st!==void 0){if(Se.currentProgram===st&&Se.lightsStateVersion===dt)return wt(H,yt),st}else yt.uniforms=ye.getUniforms(H),H.onBuild(Me,yt,p),H.onBeforeCompile(yt,p),st=ye.acquireProgram(yt,Ye),We.set(Ye,st),Se.uniforms=yt.uniforms;const ct=Se.uniforms;return(!H.isShaderMaterial&&!H.isRawShaderMaterial||H.clipping===!0)&&(ct.clippingPlanes=$e.uniform),wt(H,yt),Se.needsLights=bt(H),Se.lightsStateVersion=dt,Se.needsLights&&(ct.ambientLightColor.value=Te.state.ambient,ct.lightProbe.value=Te.state.probe,ct.directionalLights.value=Te.state.directional,ct.directionalLightShadows.value=Te.state.directionalShadow,ct.spotLights.value=Te.state.spot,ct.spotLightShadows.value=Te.state.spotShadow,ct.rectAreaLights.value=Te.state.rectArea,ct.ltc_1.value=Te.state.rectAreaLTC1,ct.ltc_2.value=Te.state.rectAreaLTC2,ct.pointLights.value=Te.state.point,ct.pointLightShadows.value=Te.state.pointShadow,ct.hemisphereLights.value=Te.state.hemi,ct.directionalShadowMap.value=Te.state.directionalShadowMap,ct.directionalShadowMatrix.value=Te.state.directionalShadowMatrix,ct.spotShadowMap.value=Te.state.spotShadowMap,ct.spotLightMatrix.value=Te.state.spotLightMatrix,ct.spotLightMap.value=Te.state.spotLightMap,ct.pointShadowMap.value=Te.state.pointShadowMap,ct.pointShadowMatrix.value=Te.state.pointShadowMatrix),Se.currentProgram=st,Se.uniformsList=null,st}function mt(H){if(H.uniformsList===null){const fe=H.currentProgram.getUniforms();H.uniformsList=hx.seqWithValue(fe.seq,H.uniforms)}return H.uniformsList}function wt(H,fe){const Me=Le.get(H);Me.outputColorSpace=fe.outputColorSpace,Me.instancing=fe.instancing,Me.instancingColor=fe.instancingColor,Me.skinning=fe.skinning,Me.morphTargets=fe.morphTargets,Me.morphNormals=fe.morphNormals,Me.morphColors=fe.morphColors,Me.morphTargetsCount=fe.morphTargetsCount,Me.numClippingPlanes=fe.numClippingPlanes,Me.numIntersection=fe.numClipIntersection,Me.vertexAlphas=fe.vertexAlphas,Me.vertexTangents=fe.vertexTangents,Me.toneMapping=fe.toneMapping}function zt(H,fe,Me,Se,Te){fe.isScene!==!0&&(fe=se),Z.resetTextureUnits();const et=fe.fog,dt=Se.isMeshStandardMaterial?fe.environment:null,yt=M===null?p.outputColorSpace:M.isXRRenderTarget===!0?M.texture.colorSpace:hc,Ye=(Se.isMeshStandardMaterial?de:J).get(Se.envMap||dt),We=Se.vertexColors===!0&&!!Me.attributes.color&&Me.attributes.color.itemSize===4,st=!!Me.attributes.tangent&&(!!Se.normalMap||Se.anisotropy>0),ct=!!Me.morphAttributes.position,Lt=!!Me.morphAttributes.normal,Dt=!!Me.morphAttributes.color;let It=gu;Se.toneMapped&&(M===null||M.isXRRenderTarget===!0)&&(It=p.toneMapping);const Ot=Me.morphAttributes.position||Me.morphAttributes.normal||Me.morphAttributes.color,St=Ot!==void 0?Ot.length:0,vt=Le.get(Se),$t=v.state.lights;if(q===!0&&(Y===!0||H!==E)){const hn=H===E&&Se.id===T;$e.setState(Se,H,hn)}let Rt=!1;Se.version===vt.__version?(vt.needsLights&&vt.lightsStateVersion!==$t.state.version||vt.outputColorSpace!==yt||Te.isInstancedMesh&&vt.instancing===!1||!Te.isInstancedMesh&&vt.instancing===!0||Te.isSkinnedMesh&&vt.skinning===!1||!Te.isSkinnedMesh&&vt.skinning===!0||Te.isInstancedMesh&&vt.instancingColor===!0&&Te.instanceColor===null||Te.isInstancedMesh&&vt.instancingColor===!1&&Te.instanceColor!==null||vt.envMap!==Ye||Se.fog===!0&&vt.fog!==et||vt.numClippingPlanes!==void 0&&(vt.numClippingPlanes!==$e.numPlanes||vt.numIntersection!==$e.numIntersection)||vt.vertexAlphas!==We||vt.vertexTangents!==st||vt.morphTargets!==ct||vt.morphNormals!==Lt||vt.morphColors!==Dt||vt.toneMapping!==It||Pe.isWebGL2===!0&&vt.morphTargetsCount!==St)&&(Rt=!0):(Rt=!0,vt.__version=Se.version);let vn=vt.currentProgram;Rt===!0&&(vn=lt(Se,fe,Te));let vi=!1,$n=!1,Pn=!1;const Jt=vn.getUniforms(),Wn=vt.uniforms;if(ve.useProgram(vn.program)&&(vi=!0,$n=!0,Pn=!0),Se.id!==T&&(T=Se.id,$n=!0),vi||E!==H){Jt.setValue($,"projectionMatrix",H.projectionMatrix),Jt.setValue($,"viewMatrix",H.matrixWorldInverse);const hn=Jt.map.cameraPosition;hn!==void 0&&hn.setValue($,le.setFromMatrixPosition(H.matrixWorld)),Pe.logarithmicDepthBuffer&&Jt.setValue($,"logDepthBufFC",2/(Math.log(H.far+1)/Math.LN2)),(Se.isMeshPhongMaterial||Se.isMeshToonMaterial||Se.isMeshLambertMaterial||Se.isMeshBasicMaterial||Se.isMeshStandardMaterial||Se.isShaderMaterial)&&Jt.setValue($,"isOrthographic",H.isOrthographicCamera===!0),E!==H&&(E=H,$n=!0,Pn=!0)}if(Te.isSkinnedMesh){Jt.setOptional($,Te,"bindMatrix"),Jt.setOptional($,Te,"bindMatrixInverse");const hn=Te.skeleton;hn&&(Pe.floatVertexTextures?(hn.boneTexture===null&&hn.computeBoneTexture(),Jt.setValue($,"boneTexture",hn.boneTexture,Z),Jt.setValue($,"boneTextureSize",hn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const $i=Me.morphAttributes;if(($i.position!==void 0||$i.normal!==void 0||$i.color!==void 0&&Pe.isWebGL2===!0)&&nt.update(Te,Me,vn),($n||vt.receiveShadow!==Te.receiveShadow)&&(vt.receiveShadow=Te.receiveShadow,Jt.setValue($,"receiveShadow",Te.receiveShadow)),Se.isMeshGouraudMaterial&&Se.envMap!==null&&(Wn.envMap.value=Ye,Wn.flipEnvMap.value=Ye.isCubeTexture&&Ye.isRenderTargetTexture===!1?-1:1),$n&&(Jt.setValue($,"toneMappingExposure",p.toneMappingExposure),vt.needsLights&&Et(Wn,Pn),et&&Se.fog===!0&&ke.refreshFogUniforms(Wn,et),ke.refreshMaterialUniforms(Wn,Se,z,V,ie),hx.upload($,mt(vt),Wn,Z)),Se.isShaderMaterial&&Se.uniformsNeedUpdate===!0&&(hx.upload($,mt(vt),Wn,Z),Se.uniformsNeedUpdate=!1),Se.isSpriteMaterial&&Jt.setValue($,"center",Te.center),Jt.setValue($,"modelViewMatrix",Te.modelViewMatrix),Jt.setValue($,"normalMatrix",Te.normalMatrix),Jt.setValue($,"modelMatrix",Te.matrixWorld),Se.isShaderMaterial||Se.isRawShaderMaterial){const hn=Se.uniformsGroups;for(let Yn=0,Wi=hn.length;Yn<Wi;Yn++)if(Pe.isWebGL2){const pr=hn[Yn];at.update(pr,vn),at.bind(pr,vn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return vn}function Et(H,fe){H.ambientLightColor.needsUpdate=fe,H.lightProbe.needsUpdate=fe,H.directionalLights.needsUpdate=fe,H.directionalLightShadows.needsUpdate=fe,H.pointLights.needsUpdate=fe,H.pointLightShadows.needsUpdate=fe,H.spotLights.needsUpdate=fe,H.spotLightShadows.needsUpdate=fe,H.rectAreaLights.needsUpdate=fe,H.hemisphereLights.needsUpdate=fe}function bt(H){return H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&H.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(H,fe,Me){Le.get(H.texture).__webglTexture=fe,Le.get(H.depthTexture).__webglTexture=Me;const Se=Le.get(H);Se.__hasExternalTextures=!0,Se.__hasExternalTextures&&(Se.__autoAllocateDepthBuffer=Me===void 0,Se.__autoAllocateDepthBuffer||xe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Se.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(H,fe){const Me=Le.get(H);Me.__webglFramebuffer=fe,Me.__useDefaultFramebuffer=fe===void 0},this.setRenderTarget=function(H,fe=0,Me=0){M=H,A=fe,w=Me;let Se=!0,Te=null,et=!1,dt=!1;if(H){const Ye=Le.get(H);Ye.__useDefaultFramebuffer!==void 0?(ve.bindFramebuffer($.FRAMEBUFFER,null),Se=!1):Ye.__webglFramebuffer===void 0?Z.setupRenderTarget(H):Ye.__hasExternalTextures&&Z.rebindTextures(H,Le.get(H.texture).__webglTexture,Le.get(H.depthTexture).__webglTexture);const We=H.texture;(We.isData3DTexture||We.isDataArrayTexture||We.isCompressedArrayTexture)&&(dt=!0);const st=Le.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(Array.isArray(st[fe])?Te=st[fe][Me]:Te=st[fe],et=!0):Pe.isWebGL2&&H.samples>0&&Z.useMultisampledRTT(H)===!1?Te=Le.get(H).__webglMultisampledFramebuffer:Array.isArray(st)?Te=st[Me]:Te=st,C.copy(H.viewport),N.copy(H.scissor),P=H.scissorTest}else C.copy(B).multiplyScalar(z).floor(),N.copy(D).multiplyScalar(z).floor(),P=O;if(ve.bindFramebuffer($.FRAMEBUFFER,Te)&&Pe.drawBuffers&&Se&&ve.drawBuffers(H,Te),ve.viewport(C),ve.scissor(N),ve.setScissorTest(P),et){const Ye=Le.get(H.texture);$.framebufferTexture2D($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,$.TEXTURE_CUBE_MAP_POSITIVE_X+fe,Ye.__webglTexture,Me)}else if(dt){const Ye=Le.get(H.texture),We=fe||0;$.framebufferTextureLayer($.FRAMEBUFFER,$.COLOR_ATTACHMENT0,Ye.__webglTexture,Me||0,We)}T=-1},this.readRenderTargetPixels=function(H,fe,Me,Se,Te,et,dt){if(!(H&&H.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let yt=Le.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&dt!==void 0&&(yt=yt[dt]),yt){ve.bindFramebuffer($.FRAMEBUFFER,yt);try{const Ye=H.texture,We=Ye.format,st=Ye.type;if(We!==Ws&&qe.convert(We)!==$.getParameter($.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ct=st===ld&&(xe.has("EXT_color_buffer_half_float")||Pe.isWebGL2&&xe.has("EXT_color_buffer_float"));if(st!==La&&qe.convert(st)!==$.getParameter($.IMPLEMENTATION_COLOR_READ_TYPE)&&!(st===Ca&&(Pe.isWebGL2||xe.has("OES_texture_float")||xe.has("WEBGL_color_buffer_float")))&&!ct){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}fe>=0&&fe<=H.width-Se&&Me>=0&&Me<=H.height-Te&&$.readPixels(fe,Me,Se,Te,qe.convert(We),qe.convert(st),et)}finally{const Ye=M!==null?Le.get(M).__webglFramebuffer:null;ve.bindFramebuffer($.FRAMEBUFFER,Ye)}}},this.copyFramebufferToTexture=function(H,fe,Me=0){const Se=Math.pow(2,-Me),Te=Math.floor(fe.image.width*Se),et=Math.floor(fe.image.height*Se);Z.setTexture2D(fe,0),$.copyTexSubImage2D($.TEXTURE_2D,Me,0,0,H.x,H.y,Te,et),ve.unbindTexture()},this.copyTextureToTexture=function(H,fe,Me,Se=0){const Te=fe.image.width,et=fe.image.height,dt=qe.convert(Me.format),yt=qe.convert(Me.type);Z.setTexture2D(Me,0),$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,Me.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Me.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,Me.unpackAlignment),fe.isDataTexture?$.texSubImage2D($.TEXTURE_2D,Se,H.x,H.y,Te,et,dt,yt,fe.image.data):fe.isCompressedTexture?$.compressedTexSubImage2D($.TEXTURE_2D,Se,H.x,H.y,fe.mipmaps[0].width,fe.mipmaps[0].height,dt,fe.mipmaps[0].data):$.texSubImage2D($.TEXTURE_2D,Se,H.x,H.y,dt,yt,fe.image),Se===0&&Me.generateMipmaps&&$.generateMipmap($.TEXTURE_2D),ve.unbindTexture()},this.copyTextureToTexture3D=function(H,fe,Me,Se,Te=0){if(p.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const et=H.max.x-H.min.x+1,dt=H.max.y-H.min.y+1,yt=H.max.z-H.min.z+1,Ye=qe.convert(Se.format),We=qe.convert(Se.type);let st;if(Se.isData3DTexture)Z.setTexture3D(Se,0),st=$.TEXTURE_3D;else if(Se.isDataArrayTexture)Z.setTexture2DArray(Se,0),st=$.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}$.pixelStorei($.UNPACK_FLIP_Y_WEBGL,Se.flipY),$.pixelStorei($.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Se.premultiplyAlpha),$.pixelStorei($.UNPACK_ALIGNMENT,Se.unpackAlignment);const ct=$.getParameter($.UNPACK_ROW_LENGTH),Lt=$.getParameter($.UNPACK_IMAGE_HEIGHT),Dt=$.getParameter($.UNPACK_SKIP_PIXELS),It=$.getParameter($.UNPACK_SKIP_ROWS),Ot=$.getParameter($.UNPACK_SKIP_IMAGES),St=Me.isCompressedTexture?Me.mipmaps[0]:Me.image;$.pixelStorei($.UNPACK_ROW_LENGTH,St.width),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,St.height),$.pixelStorei($.UNPACK_SKIP_PIXELS,H.min.x),$.pixelStorei($.UNPACK_SKIP_ROWS,H.min.y),$.pixelStorei($.UNPACK_SKIP_IMAGES,H.min.z),Me.isDataTexture||Me.isData3DTexture?$.texSubImage3D(st,Te,fe.x,fe.y,fe.z,et,dt,yt,Ye,We,St.data):Me.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),$.compressedTexSubImage3D(st,Te,fe.x,fe.y,fe.z,et,dt,yt,Ye,St.data)):$.texSubImage3D(st,Te,fe.x,fe.y,fe.z,et,dt,yt,Ye,We,St),$.pixelStorei($.UNPACK_ROW_LENGTH,ct),$.pixelStorei($.UNPACK_IMAGE_HEIGHT,Lt),$.pixelStorei($.UNPACK_SKIP_PIXELS,Dt),$.pixelStorei($.UNPACK_SKIP_ROWS,It),$.pixelStorei($.UNPACK_SKIP_IMAGES,Ot),Te===0&&Se.generateMipmaps&&$.generateMipmap(st),ve.unbindTexture()},this.initTexture=function(H){H.isCubeTexture?Z.setTextureCube(H,0):H.isData3DTexture?Z.setTexture3D(H,0):H.isDataArrayTexture||H.isCompressedArrayTexture?Z.setTexture2DArray(H,0):Z.setTexture2D(H,0),ve.unbindTexture()},this.resetState=function(){A=0,w=0,M=null,ve.reset(),it.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ql}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===AR?"display-p3":"srgb",t.unpackColorSpace=jn.workingColorSpace===yS?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Dr?Yh:eG}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Yh?Dr:hc}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class qoe extends _G{}qoe.prototype.isWebGL1Renderer=!0;class PR{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Ht(e),this.near=t,this.far=n}clone(){return new PR(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class xk extends Er{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class ZT extends Ts{constructor(e=null,t=1,n=1,r,s,o,a,l,c=Zn,u=Zn,h,d){super(null,o,a,l,c,u,r,s,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Yoe extends rm{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ht(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const bk=new me,Sk=new me,wk=new Tt,LM=new ER,sy=new w1;class Koe extends Er{constructor(e=new nr,t=new Yoe){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,s=t.count;r<s;r++)bk.fromBufferAttribute(t,r-1),Sk.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=bk.distanceTo(Sk);e.setAttribute("lineDistance",new ai(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),sy.copy(n.boundingSphere),sy.applyMatrix4(r),sy.radius+=s,e.ray.intersectsSphere(sy)===!1)return;wk.copy(r).invert(),LM.copy(e.ray).applyMatrix4(wk);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new me,u=new me,h=new me,d=new me,f=this.isLineSegments?2:1,m=n.index,v=n.attributes.position;if(m!==null){const g=Math.max(0,o.start),b=Math.min(m.count,o.start+o.count);for(let p=g,y=b-1;p<y;p+=f){const A=m.getX(p),w=m.getX(p+1);if(c.fromBufferAttribute(v,A),u.fromBufferAttribute(v,w),LM.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const T=e.ray.origin.distanceTo(d);T<e.near||T>e.far||t.push({distance:T,point:h.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this})}}else{const g=Math.max(0,o.start),b=Math.min(v.count,o.start+o.count);for(let p=g,y=b-1;p<y;p+=f){if(c.fromBufferAttribute(v,p),u.fromBufferAttribute(v,p+1),LM.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const w=e.ray.origin.distanceTo(d);w<e.near||w>e.far||t.push({distance:w,point:h.clone().applyMatrix4(this.matrixWorld),index:p,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const Mk=new me,Ak=new me;class QT extends Koe{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,s=t.count;r<s;r+=2)Mk.fromBufferAttribute(t,r),Ak.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+Mk.distanceTo(Ak);e.setAttribute("lineDistance",new ai(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Zoe extends rm{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ht(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Ek=new Tt,JT=new ER,oy=new w1,ay=new me;class yG extends Er{constructor(e=new nr,t=new Zoe){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),oy.copy(n.boundingSphere),oy.applyMatrix4(r),oy.radius+=s,e.ray.intersectsSphere(oy)===!1)return;Ek.copy(r).invert(),JT.copy(e.ray).applyMatrix4(Ek);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=n.index,h=n.attributes.position;if(c!==null){const d=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let m=d,_=f;m<_;m++){const v=c.getX(m);ay.fromBufferAttribute(h,v),Tk(ay,v,l,r,e,t,this)}}else{const d=Math.max(0,o.start),f=Math.min(h.count,o.start+o.count);for(let m=d,_=f;m<_;m++)ay.fromBufferAttribute(h,m),Tk(ay,m,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const r=t[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Tk(i,e,t,n,r,s,o){const a=JT.distanceSqToPoint(i);if(a<t){const l=new me;JT.closestPointToPoint(i,l),l.applyMatrix4(n);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class Qoe extends Ts{constructor(e,t,n,r,s,o,a,l,c){super(e,t,n,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class SS extends nr{constructor(e=1,t=1,n=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],h=[],d=[],f=[];let m=0;const _=[],v=n/2;let g=0;b(),o===!1&&(e>0&&p(!0),t>0&&p(!1)),this.setIndex(u),this.setAttribute("position",new ai(h,3)),this.setAttribute("normal",new ai(d,3)),this.setAttribute("uv",new ai(f,2));function b(){const y=new me,A=new me;let w=0;const M=(t-e)/n;for(let T=0;T<=s;T++){const E=[],C=T/s,N=C*(t-e)+e;for(let P=0;P<=r;P++){const L=P/r,R=L*l+a,F=Math.sin(R),V=Math.cos(R);A.x=N*F,A.y=-C*n+v,A.z=N*V,h.push(A.x,A.y,A.z),y.set(F,M,V).normalize(),d.push(y.x,y.y,y.z),f.push(L,1-C),E.push(m++)}_.push(E)}for(let T=0;T<r;T++)for(let E=0;E<s;E++){const C=_[E][T],N=_[E+1][T],P=_[E+1][T+1],L=_[E][T+1];u.push(C,N,L),u.push(N,P,L),w+=6}c.addGroup(g,w,0),g+=w}function p(y){const A=m,w=new sn,M=new me;let T=0;const E=y===!0?e:t,C=y===!0?1:-1;for(let P=1;P<=r;P++)h.push(0,v*C,0),d.push(0,C,0),f.push(.5,.5),m++;const N=m;for(let P=0;P<=r;P++){const R=P/r*l+a,F=Math.cos(R),V=Math.sin(R);M.x=E*V,M.y=v*C,M.z=E*F,h.push(M.x,M.y,M.z),d.push(0,C,0),w.x=F*.5+.5,w.y=V*.5*C+.5,f.push(w.x,w.y),m++}for(let P=0;P<r;P++){const L=A+P,R=N+P;y===!0?u.push(R,R+1,L):u.push(R+1,R,L),T+=3}c.addGroup(g,T,y===!0?1:2),g+=T}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new SS(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class RR extends SS{constructor(e=1,t=1,n=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,n,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new RR(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class M1 extends nr{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const s=[],o=[];a(r),c(n),u(),this.setAttribute("position",new ai(s,3)),this.setAttribute("normal",new ai(s.slice(),3)),this.setAttribute("uv",new ai(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const p=new me,y=new me,A=new me;for(let w=0;w<t.length;w+=3)f(t[w+0],p),f(t[w+1],y),f(t[w+2],A),l(p,y,A,b)}function l(b,p,y,A){const w=A+1,M=[];for(let T=0;T<=w;T++){M[T]=[];const E=b.clone().lerp(y,T/w),C=p.clone().lerp(y,T/w),N=w-T;for(let P=0;P<=N;P++)P===0&&T===w?M[T][P]=E:M[T][P]=E.clone().lerp(C,P/N)}for(let T=0;T<w;T++)for(let E=0;E<2*(w-T)-1;E++){const C=Math.floor(E/2);E%2===0?(d(M[T][C+1]),d(M[T+1][C]),d(M[T][C])):(d(M[T][C+1]),d(M[T+1][C+1]),d(M[T+1][C]))}}function c(b){const p=new me;for(let y=0;y<s.length;y+=3)p.x=s[y+0],p.y=s[y+1],p.z=s[y+2],p.normalize().multiplyScalar(b),s[y+0]=p.x,s[y+1]=p.y,s[y+2]=p.z}function u(){const b=new me;for(let p=0;p<s.length;p+=3){b.x=s[p+0],b.y=s[p+1],b.z=s[p+2];const y=v(b)/2/Math.PI+.5,A=g(b)/Math.PI+.5;o.push(y,1-A)}m(),h()}function h(){for(let b=0;b<o.length;b+=6){const p=o[b+0],y=o[b+2],A=o[b+4],w=Math.max(p,y,A),M=Math.min(p,y,A);w>.9&&M<.1&&(p<.2&&(o[b+0]+=1),y<.2&&(o[b+2]+=1),A<.2&&(o[b+4]+=1))}}function d(b){s.push(b.x,b.y,b.z)}function f(b,p){const y=b*3;p.x=e[y+0],p.y=e[y+1],p.z=e[y+2]}function m(){const b=new me,p=new me,y=new me,A=new me,w=new sn,M=new sn,T=new sn;for(let E=0,C=0;E<s.length;E+=9,C+=6){b.set(s[E+0],s[E+1],s[E+2]),p.set(s[E+3],s[E+4],s[E+5]),y.set(s[E+6],s[E+7],s[E+8]),w.set(o[C+0],o[C+1]),M.set(o[C+2],o[C+3]),T.set(o[C+4],o[C+5]),A.copy(b).add(p).add(y).divideScalar(3);const N=v(A);_(w,C+0,b,N),_(M,C+2,p,N),_(T,C+4,y,N)}}function _(b,p,y,A){A<0&&b.x===1&&(o[p]=b.x-1),y.x===0&&y.z===0&&(o[p]=A/2/Math.PI+.5)}function v(b){return Math.atan2(b.z,-b.x)}function g(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new M1(e.vertices,e.indices,e.radius,e.details)}}class wS extends M1{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new wS(e.radius,e.detail)}}class IR extends M1{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new IR(e.radius,e.detail)}}class LR extends M1{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new LR(e.radius,e.detail)}}class DR extends nr{constructor(e=1,t=.4,n=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:s},n=Math.floor(n),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new me,h=new me,d=new me;for(let f=0;f<=n;f++)for(let m=0;m<=r;m++){const _=m/r*s,v=f/n*Math.PI*2;h.x=(e+t*Math.cos(v))*Math.cos(_),h.y=(e+t*Math.cos(v))*Math.sin(_),h.z=t*Math.sin(v),a.push(h.x,h.y,h.z),u.x=e*Math.cos(_),u.y=e*Math.sin(_),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(m/r),c.push(f/n)}for(let f=1;f<=n;f++)for(let m=1;m<=r;m++){const _=(r+1)*f+m-1,v=(r+1)*(f-1)+m-1,g=(r+1)*(f-1)+m,b=(r+1)*f+m;o.push(_,v,b),o.push(v,g,b)}this.setIndex(o),this.setAttribute("position",new ai(a,3)),this.setAttribute("normal",new ai(l,3)),this.setAttribute("uv",new ai(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new DR(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class xG extends Er{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ht(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const DM=new Tt,Ck=new me,Pk=new me;class Joe{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new sn(512,512),this.map=null,this.mapPass=null,this.matrix=new Tt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new TR,this._frameExtents=new sn(1,1),this._viewportCount=1,this._viewports=[new Mr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Ck.setFromMatrixPosition(e.matrixWorld),t.position.copy(Ck),Pk.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Pk),t.updateMatrixWorld(),DM.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DM),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(DM)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class eae extends Joe{constructor(){super(new Y0(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class tae extends xG{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Er.DEFAULT_UP),this.updateMatrix(),this.target=new Er,this.shadow=new eae}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class nae extends xG{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}const Rk=new Tt,Ik=new Tt,dh=new Tt;class iae{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Hs,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Hs,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,dh.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(cx*t.fov*.5)/t.zoom;let a,l;Ik.elements[12]=-r,Rk.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,dh.elements[0]=2*t.near/(l-a),dh.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(dh),a=-o*t.aspect-s,l=o*t.aspect-s,dh.elements[0]=2*t.near/(l-a),dh.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(dh)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Ik),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Rk)}}class lb{constructor(e){this.value=e}clone(){return new lb(this.value.clone===void 0?this.value:this.value.clone())}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:wR}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=wR);var eC={exports:{}};(function(i,e){/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */(function(){var t,n,r,s,o,a,l,c,u,h,d,f,m,_,v,g,b,p,y,A,w,M,T,E,C,N,P,L,R,F,V,z,U,G,B,D,O,j,q,Y,ie,ne,Q,le,se,oe,$,pe,xe,Pe,ve,Ue,Le,Z,J,de,Ie,te,X,ye,ke,ge,De,$e,Ae,Ze,nt,rt,Oe,qe,it,at,ht,Qe,je,ee,ze,Ee,Re,Xe,gt,_t,Mt=[].slice;Ee=function(){var K,ae,ue,_e,be;for(K={},be="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),_e=0,ae=be.length;_e<ae;_e++)ue=be[_e],K["[object "+ue+"]"]=ue.toLowerCase();return function(Ne){var Be;return Be=Object.prototype.toString.call(Ne),K[Be]||"object"}}(),$=function(K,ae,ue){return ae==null&&(ae=0),ue==null&&(ue=1),K<ae&&(K=ae),K>ue&&(K=ue),K},Re=function(K){return K.length>=3?Array.prototype.slice.call(K):K[0]},w=function(K){var ae,ue;for(K._clipped=!1,K._unclipped=K.slice(0),ae=ue=0;ue<3;ae=++ue)ae<3?((K[ae]<0||K[ae]>255)&&(K._clipped=!0),K[ae]<0&&(K[ae]=0),K[ae]>255&&(K[ae]=255)):ae===3&&(K[ae]<0&&(K[ae]=0),K[ae]>1&&(K[ae]=1));return K._clipped||delete K._unclipped,K},s=Math.PI,ht=Math.round,T=Math.cos,L=Math.floor,de=Math.pow,pe=Math.log,je=Math.sin,ee=Math.sqrt,_=Math.atan2,ve=Math.max,m=Math.abs,l=s*2,o=s/3,n=s/180,a=180/s,A=function(){return arguments[0]instanceof t?arguments[0]:function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,arguments,function(){})},A.default=A,f=[],i!==null&&i.exports!=null&&(i.exports=A),at=e!==null?e:this,at.chroma=A,A.version="1.4.1",d={},u=[],h=!1,t=function(){function K(){var ae,ue,_e,be,Ne,Be,He,lt,mt;for(Be=this,ue=[],lt=0,be=arguments.length;lt<be;lt++)ae=arguments[lt],ae!=null&&ue.push(ae);if(ue.length>1&&(He=ue[ue.length-1]),d[He]!=null)Be._rgb=w(d[He](Re(ue.slice(0,-1))));else{for(h||(u=u.sort(function(wt,zt){return zt.p-wt.p}),h=!0),mt=0,Ne=u.length;mt<Ne&&(_e=u[mt],He=_e.test.apply(_e,ue),!He);mt++);He&&(Be._rgb=w(d[He].apply(d,ue)))}Be._rgb==null&&console.warn("unknown format: "+ue),Be._rgb==null&&(Be._rgb=[0,0,0]),Be._rgb.length===3&&Be._rgb.push(1)}return K.prototype.toString=function(){return this.hex()},K}(),A._input=d;/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */A.brewer=p={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var K,ae;ae=[];for(K in p)ae.push(p[K.toLowerCase()]=p[K]);return ae}(),Xe={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},A.colors=Xe,ne=function(){var K,ae,ue,_e,be,Ne,Be,He,lt;return ae=Re(arguments),be=ae[0],K=ae[1],ue=ae[2],He=(be+16)/116,Be=isNaN(K)?He:He+K/500,lt=isNaN(ue)?He:He-ue/200,He=r.Yn*Q(He),Be=r.Xn*Q(Be),lt=r.Zn*Q(lt),Ne=_t(3.2404542*Be-1.5371385*He-.4985314*lt),_e=_t(-.969266*Be+1.8760108*He+.041556*lt),ue=_t(.0556434*Be-.2040259*He+1.0572252*lt),[Ne,_e,ue,ae.length>3?ae[3]:1]},_t=function(K){return 255*(K<=.00304?12.92*K:1.055*de(K,1/2.4)-.055)},Q=function(K){return K>r.t1?K*K*K:r.t2*(K-r.t0)},r={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},$e=function(){var K,ae,ue,_e,be,Ne,Be,He;return _e=Re(arguments),ue=_e[0],ae=_e[1],K=_e[2],be=Oe(ue,ae,K),Ne=be[0],Be=be[1],He=be[2],[116*Be-16,500*(Ne-Be),200*(Be-He)]},qe=function(K){return(K/=255)<=.04045?K/12.92:de((K+.055)/1.055,2.4)},gt=function(K){return K>r.t3?de(K,1/3):K/r.t2+r.t0},Oe=function(){var K,ae,ue,_e,be,Ne,Be;return _e=Re(arguments),ue=_e[0],ae=_e[1],K=_e[2],ue=qe(ue),ae=qe(ae),K=qe(K),be=gt((.4124564*ue+.3575761*ae+.1804375*K)/r.Xn),Ne=gt((.2126729*ue+.7151522*ae+.072175*K)/r.Yn),Be=gt((.0193339*ue+.119192*ae+.9503041*K)/r.Zn),[be,Ne,Be]},A.lab=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["lab"]),function(){})},d.lab=ne,t.prototype.lab=function(){return $e(this._rgb)},v=function(K){var ae,ue,_e,be,Ne,Be,He,lt,mt,wt,zt;return K=function(){var Et,bt,H;for(H=[],bt=0,Et=K.length;bt<Et;bt++)be=K[bt],H.push(A(be));return H}(),K.length===2?(mt=function(){var Et,bt,H;for(H=[],bt=0,Et=K.length;bt<Et;bt++)be=K[bt],H.push(be.lab());return H}(),Ne=mt[0],Be=mt[1],ae=function(Et){var bt,H;return H=function(){var fe,Me;for(Me=[],bt=fe=0;fe<=2;bt=++fe)Me.push(Ne[bt]+Et*(Be[bt]-Ne[bt]));return Me}(),A.lab.apply(A,H)}):K.length===3?(wt=function(){var Et,bt,H;for(H=[],bt=0,Et=K.length;bt<Et;bt++)be=K[bt],H.push(be.lab());return H}(),Ne=wt[0],Be=wt[1],He=wt[2],ae=function(Et){var bt,H;return H=function(){var fe,Me;for(Me=[],bt=fe=0;fe<=2;bt=++fe)Me.push((1-Et)*(1-Et)*Ne[bt]+2*(1-Et)*Et*Be[bt]+Et*Et*He[bt]);return Me}(),A.lab.apply(A,H)}):K.length===4?(zt=function(){var Et,bt,H;for(H=[],bt=0,Et=K.length;bt<Et;bt++)be=K[bt],H.push(be.lab());return H}(),Ne=zt[0],Be=zt[1],He=zt[2],lt=zt[3],ae=function(Et){var bt,H;return H=function(){var fe,Me;for(Me=[],bt=fe=0;fe<=2;bt=++fe)Me.push((1-Et)*(1-Et)*(1-Et)*Ne[bt]+3*(1-Et)*(1-Et)*Et*Be[bt]+3*(1-Et)*Et*Et*He[bt]+Et*Et*Et*lt[bt]);return Me}(),A.lab.apply(A,H)}):K.length===5&&(ue=v(K.slice(0,3)),_e=v(K.slice(2,5)),ae=function(Et){return Et<.5?ue(Et*2):_e((Et-.5)*2)}),ae},A.bezier=function(K){var ae;return ae=v(K),ae.scale=function(){return A.scale(ae)},ae},A.cubehelix=function(K,ae,ue,_e,be){var Ne,Be,He;return K==null&&(K=300),ae==null&&(ae=-1.5),ue==null&&(ue=1),_e==null&&(_e=1),be==null&&(be=[0,1]),Ne=0,Ee(be)==="array"?Be=be[1]-be[0]:(Be=0,be=[be,be]),He=function(lt){var mt,wt,zt,Et,bt,H,fe,Me,Se;return mt=l*((K+120)/360+ae*lt),fe=de(be[0]+Be*lt,_e),H=Ne!==0?ue[0]+lt*Ne:ue,wt=H*fe*(1-fe)/2,Et=T(mt),Se=je(mt),Me=fe+wt*(-.14861*Et+1.78277*Se),bt=fe+wt*(-.29227*Et-.90649*Se),zt=fe+wt*(1.97294*Et),A(w([Me*255,bt*255,zt*255,1]))},He.start=function(lt){return lt==null?K:(K=lt,He)},He.rotations=function(lt){return lt==null?ae:(ae=lt,He)},He.gamma=function(lt){return lt==null?_e:(_e=lt,He)},He.hue=function(lt){return lt==null?ue:(ue=lt,Ee(ue)==="array"?(Ne=ue[1]-ue[0],Ne===0&&(ue=ue[1])):Ne=0,He)},He.lightness=function(lt){return lt==null?be:(Ee(lt)==="array"?(be=lt,Be=lt[1]-lt[0]):(be=[lt,lt],Be=0),He)},He.scale=function(){return A.scale(He)},He.hue(ue),He},A.random=function(){var K,ae,ue;for(ae="0123456789abcdef",K="#",ue=0;ue<6;++ue)K+=ae.charAt(L(Math.random()*16));return new t(K)},f=[],B=function(K,ae,ue,_e){var be,Ne,Be,He;for(ue==null&&(ue=.5),_e==null&&(_e="rgb"),Ee(K)!=="object"&&(K=A(K)),Ee(ae)!=="object"&&(ae=A(ae)),Be=0,Ne=f.length;Be<Ne;Be++)if(be=f[Be],_e===be[0]){He=be[1](K,ae,ue,_e);break}if(He==null)throw"color mode "+_e+" is not supported";return He.alpha(K.alpha()+ue*(ae.alpha()-K.alpha()))},A.interpolate=B,t.prototype.interpolate=function(K,ae,ue){return B(this,K,ae,ue)},A.mix=B,t.prototype.mix=t.prototype.interpolate,d.rgb=function(){var K,ae,ue,_e;ae=Re(arguments),ue=[];for(K in ae)_e=ae[K],ue.push(_e);return ue},A.rgb=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["rgb"]),function(){})},t.prototype.rgb=function(K){return K==null&&(K=!0),K?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},t.prototype.rgba=function(K){return K==null&&(K=!0),K?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},u.push({p:3,test:function(K){var ae;if(ae=Re(arguments),Ee(ae)==="array"&&ae.length===3||ae.length===4&&Ee(ae[3])==="number"&&ae[3]>=0&&ae[3]<=1)return"rgb"}}),d.lrgb=d.rgb,j=function(K,ae,ue,_e){var be,Ne;return be=K._rgb,Ne=ae._rgb,new t(ee(de(be[0],2)*(1-ue)+de(Ne[0],2)*ue),ee(de(be[1],2)*(1-ue)+de(Ne[1],2)*ue),ee(de(be[2],2)*(1-ue)+de(Ne[2],2)*ue),_e)},c=function(K){var ae,ue,_e,be,Ne,Be;for(ue=1/K.length,Be=[0,0,0,0],be=0,_e=K.length;be<_e;be++)ae=K[be],Ne=ae._rgb,Be[0]+=de(Ne[0],2)*ue,Be[1]+=de(Ne[1],2)*ue,Be[2]+=de(Ne[2],2)*ue,Be[3]+=Ne[3]*ue;return Be[0]=ee(Be[0]),Be[1]=ee(Be[1]),Be[2]=ee(Be[2]),Be[3]>1&&(Be[3]=1),new t(w(Be))},f.push(["lrgb",j]),A.average=function(K,ae){var ue,_e,be,Ne,Be,He,lt,mt,wt,zt,Et,bt,H;if(ae==null&&(ae="rgb"),wt=K.length,K=K.map(function(fe){return A(fe)}),lt=K.splice(0,1)[0],ae==="lrgb")return c(K);bt=lt.get(ae),Ne=[],Be=0,He=0;for(mt in bt)bt[mt]=bt[mt]||0,Ne.push(isNaN(bt[mt])?0:1),ae.charAt(mt)==="h"&&!isNaN(bt[mt])&&(ue=bt[mt]/180*s,Be+=T(ue),He+=je(ue));for(_e=lt.alpha(),Et=0,zt=K.length;Et<zt;Et++){be=K[Et],H=be.get(ae),_e+=be.alpha();for(mt in bt)isNaN(H[mt])||(Ne[mt]+=1,ae.charAt(mt)==="h"?(ue=H[mt]/180*s,Be+=T(ue),He+=je(ue)):bt[mt]+=H[mt])}for(mt in bt)if(ae.charAt(mt)==="h"){for(ue=_(He/Ne[mt],Be/Ne[mt])/s*180;ue<0;)ue+=360;for(;ue>=360;)ue-=360;bt[mt]=ue}else bt[mt]=bt[mt]/Ne[mt];return A(bt,ae).alpha(_e/wt)},F=function(K){var ae,ue,_e,be,Ne,Be;if(K.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(K.length===4||K.length===7)&&(K=K.substr(1)),K.length===3&&(K=K.split(""),K=K[0]+K[0]+K[1]+K[1]+K[2]+K[2]),Be=parseInt(K,16),be=Be>>16,_e=Be>>8&255,ue=Be&255,[be,_e,ue,1];if(K.match(/^#?([A-Fa-f0-9]{8})$/))return K.length===9&&(K=K.substr(1)),Be=parseInt(K,16),be=Be>>24&255,_e=Be>>16&255,ue=Be>>8&255,ae=ht((Be&255)/255*100)/100,[be,_e,ue,ae];if(d.css!=null&&(Ne=d.css(K)))return Ne;throw"unknown color: "+K},ye=function(K,ae){var ue,_e,be,Ne,Be,He,lt;return ae==null&&(ae="auto"),Be=K[0],be=K[1],_e=K[2],ue=K[3],ae==="auto"&&(ae=ue<1?"rgba":"rgb"),Be=Math.round(Be),be=Math.round(be),_e=Math.round(_e),lt=Be<<16|be<<8|_e,He="000000"+lt.toString(16),He=He.substr(He.length-6),Ne="0"+ht(ue*255).toString(16),Ne=Ne.substr(Ne.length-2),"#"+function(){switch(ae.toLowerCase()){case"rgba":return He+Ne;case"argb":return Ne+He;default:return He}}()},d.hex=function(K){return F(K)},A.hex=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["hex"]),function(){})},t.prototype.hex=function(K){return K==null&&(K="auto"),ye(this._rgb,K)},u.push({p:4,test:function(K){if(arguments.length===1&&Ee(K)==="string")return"hex"}}),U=function(){var K,ae,ue,_e,be,Ne,Be,He,lt,mt,wt,zt,Et,bt;if(K=Re(arguments),be=K[0],wt=K[1],Be=K[2],wt===0)lt=_e=ae=Be*255;else{for(bt=[0,0,0],ue=[0,0,0],Et=Be<.5?Be*(1+wt):Be+wt-Be*wt,zt=2*Be-Et,be/=360,bt[0]=be+1/3,bt[1]=be,bt[2]=be-1/3,Ne=He=0;He<=2;Ne=++He)bt[Ne]<0&&(bt[Ne]+=1),bt[Ne]>1&&(bt[Ne]-=1),6*bt[Ne]<1?ue[Ne]=zt+(Et-zt)*6*bt[Ne]:2*bt[Ne]<1?ue[Ne]=Et:3*bt[Ne]<2?ue[Ne]=zt+(Et-zt)*(2/3-bt[Ne])*6:ue[Ne]=zt;mt=[ht(ue[0]*255),ht(ue[1]*255),ht(ue[2]*255)],lt=mt[0],_e=mt[1],ae=mt[2]}return K.length>3?[lt,_e,ae,K[3]]:[lt,_e,ae]},ge=function(K,ae,ue){var _e,be,Ne,Be,He;return K!==void 0&&K.length>=3&&(Be=K,K=Be[0],ae=Be[1],ue=Be[2]),K/=255,ae/=255,ue/=255,Ne=Math.min(K,ae,ue),ve=Math.max(K,ae,ue),be=(ve+Ne)/2,ve===Ne?(He=0,_e=Number.NaN):He=be<.5?(ve-Ne)/(ve+Ne):(ve-Ne)/(2-ve-Ne),K===ve?_e=(ae-ue)/(ve-Ne):ae===ve?_e=2+(ue-K)/(ve-Ne):ue===ve&&(_e=4+(K-ae)/(ve-Ne)),_e*=60,_e<0&&(_e+=360),[_e,He,be]},A.hsl=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["hsl"]),function(){})},d.hsl=U,t.prototype.hsl=function(){return ge(this._rgb)},G=function(){var K,ae,ue,_e,be,Ne,Be,He,lt,mt,wt,zt,Et,bt,H,fe,Me,Se;if(K=Re(arguments),be=K[0],fe=K[1],Se=K[2],Se*=255,fe===0)lt=_e=ae=Se;else switch(be===360&&(be=0),be>360&&(be-=360),be<0&&(be+=360),be/=60,Ne=L(be),ue=be-Ne,Be=Se*(1-fe),He=Se*(1-fe*ue),Me=Se*(1-fe*(1-ue)),Ne){case 0:mt=[Se,Me,Be],lt=mt[0],_e=mt[1],ae=mt[2];break;case 1:wt=[He,Se,Be],lt=wt[0],_e=wt[1],ae=wt[2];break;case 2:zt=[Be,Se,Me],lt=zt[0],_e=zt[1],ae=zt[2];break;case 3:Et=[Be,He,Se],lt=Et[0],_e=Et[1],ae=Et[2];break;case 4:bt=[Me,Be,Se],lt=bt[0],_e=bt[1],ae=bt[2];break;case 5:H=[Se,Be,He],lt=H[0],_e=H[1],ae=H[2]}return[lt,_e,ae,K.length>3?K[3]:1]},De=function(){var K,ae,ue,_e,be,Ne,Be,He,lt;return Be=Re(arguments),Ne=Be[0],ue=Be[1],K=Be[2],be=Math.min(Ne,ue,K),ve=Math.max(Ne,ue,K),ae=ve-be,lt=ve/255,ve===0?(_e=Number.NaN,He=0):(He=ae/ve,Ne===ve&&(_e=(ue-K)/ae),ue===ve&&(_e=2+(K-Ne)/ae),K===ve&&(_e=4+(Ne-ue)/ae),_e*=60,_e<0&&(_e+=360)),[_e,He,lt]},A.hsv=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["hsv"]),function(){})},d.hsv=G,t.prototype.hsv=function(){return De(this._rgb)},Z=function(K){var ae,ue,_e;return Ee(K)==="number"&&K>=0&&K<=16777215?(_e=K>>16,ue=K>>8&255,ae=K&255,[_e,ue,ae,1]):(console.warn("unknown num color: "+K),[0,0,0,1])},nt=function(){var K,ae,ue,_e;return _e=Re(arguments),ue=_e[0],ae=_e[1],K=_e[2],(ue<<16)+(ae<<8)+K},A.num=function(K){return new t(K,"num")},t.prototype.num=function(K){return K==null&&(K="rgb"),nt(this._rgb,K)},d.num=Z,u.push({p:1,test:function(K){if(arguments.length===1&&Ee(K)==="number"&&K>=0&&K<=16777215)return"num"}}),R=function(){var K,ae,ue,_e,be,Ne,Be,He,lt,mt,wt,zt,Et,bt,H,fe,Me,Se,Te,et;if(ue=Re(arguments),He=ue[0],be=ue[1],ae=ue[2],be=be/100,Be=Be/100*255,K=be*255,be===0)zt=Be=_e=ae;else switch(He===360&&(He=0),He>360&&(He-=360),He<0&&(He+=360),He/=60,lt=L(He),Ne=He-lt,mt=ae*(1-be),wt=mt+K*(1-Ne),Te=mt+K*Ne,et=mt+K,lt){case 0:Et=[et,Te,mt],zt=Et[0],Be=Et[1],_e=Et[2];break;case 1:bt=[wt,et,mt],zt=bt[0],Be=bt[1],_e=bt[2];break;case 2:H=[mt,et,Te],zt=H[0],Be=H[1],_e=H[2];break;case 3:fe=[mt,wt,et],zt=fe[0],Be=fe[1],_e=fe[2];break;case 4:Me=[Te,mt,et],zt=Me[0],Be=Me[1],_e=Me[2];break;case 5:Se=[et,mt,wt],zt=Se[0],Be=Se[1],_e=Se[2]}return[zt,Be,_e,ue.length>3?ue[3]:1]},X=function(){var K,ae,ue,_e,be,Ne,Be,He,lt;return lt=Re(arguments),He=lt[0],be=lt[1],ae=lt[2],Be=Math.min(He,be,ae),ve=Math.max(He,be,ae),_e=ve-Be,ue=_e*100/255,K=Be/(255-_e)*100,_e===0?Ne=Number.NaN:(He===ve&&(Ne=(be-ae)/_e),be===ve&&(Ne=2+(ae-He)/_e),ae===ve&&(Ne=4+(He-be)/_e),Ne*=60,Ne<0&&(Ne+=360)),[Ne,ue,K]},A.hcg=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["hcg"]),function(){})},d.hcg=R,t.prototype.hcg=function(){return X(this._rgb)},E=function(K){var ae,ue,_e,be,Ne,Be,He,lt;if(K=K.toLowerCase(),A.colors!=null&&A.colors[K])return F(A.colors[K]);if(Ne=K.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(He=Ne.slice(1,4),be=Be=0;Be<=2;be=++Be)He[be]=+He[be];He[3]=1}else if(Ne=K.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(He=Ne.slice(1,5),be=lt=0;lt<=3;be=++lt)He[be]=+He[be];else if(Ne=K.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(He=Ne.slice(1,4),be=ae=0;ae<=2;be=++ae)He[be]=ht(He[be]*2.55);He[3]=1}else if(Ne=K.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(He=Ne.slice(1,5),be=ue=0;ue<=2;be=++ue)He[be]=ht(He[be]*2.55);He[3]=+He[3]}else(Ne=K.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(_e=Ne.slice(1,4),_e[1]*=.01,_e[2]*=.01,He=U(_e),He[3]=1):(Ne=K.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(_e=Ne.slice(1,4),_e[1]*=.01,_e[2]*=.01,He=U(_e),He[3]=+Ne[4]);return He},te=function(K){var ae;if(ae=K[3]<1?"rgba":"rgb",ae==="rgb")return ae+"("+K.slice(0,3).map(ht).join(",")+")";if(ae==="rgba")return ae+"("+K.slice(0,3).map(ht).join(",")+","+K[3]+")"},it=function(K){return ht(K*100)/100},z=function(K,ae){var ue;return ue=ae<1?"hsla":"hsl",K[0]=it(K[0]||0),K[1]=it(K[1]*100)+"%",K[2]=it(K[2]*100)+"%",ue==="hsla"&&(K[3]=ae),ue+"("+K.join(",")+")"},d.css=function(K){return E(K)},A.css=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["css"]),function(){})},t.prototype.css=function(K){if(K==null&&(K="rgb"),K.slice(0,3)==="rgb")return te(this._rgb);if(K.slice(0,3)==="hsl")return z(this.hsl(),this.alpha())},d.named=function(K){return F(Xe[K])},u.push({p:5,test:function(K){if(arguments.length===1&&Xe[K]!=null)return"named"}}),t.prototype.name=function(K){var ae,ue;arguments.length&&(Xe[K]&&(this._rgb=F(Xe[K])),this._rgb[3]=1),ae=this.hex("rgb");for(ue in Xe)if(ae===Xe[ue])return ue;return ae},le=function(){var K,ae,ue,_e;return _e=Re(arguments),ue=_e[0],K=_e[1],ae=_e[2],ae=ae*n,[ue,T(ae)*K,je(ae)*K]},se=function(){var K,ae,ue,_e,be,Ne,Be,He,lt,mt,wt;return ue=Re(arguments),He=ue[0],be=ue[1],Be=ue[2],mt=le(He,be,Be),K=mt[0],ae=mt[1],_e=mt[2],wt=ne(K,ae,_e),lt=wt[0],Ne=wt[1],_e=wt[2],[lt,Ne,_e,ue.length>3?ue[3]:1]},ie=function(){var K,ae,ue,_e,be,Ne;return Ne=Re(arguments),be=Ne[0],K=Ne[1],ae=Ne[2],ue=ee(K*K+ae*ae),_e=(_(ae,K)*a+360)%360,ht(ue*1e4)===0&&(_e=Number.NaN),[be,ue,_e]},Ae=function(){var K,ae,ue,_e,be,Ne,Be;return Ne=Re(arguments),be=Ne[0],ue=Ne[1],ae=Ne[2],Be=$e(be,ue,ae),_e=Be[0],K=Be[1],ae=Be[2],ie(_e,K,ae)},A.lch=function(){var K;return K=Re(arguments),new t(K,"lch")},A.hcl=function(){var K;return K=Re(arguments),new t(K,"hcl")},d.lch=se,d.hcl=function(){var K,ae,ue,_e;return _e=Re(arguments),ae=_e[0],K=_e[1],ue=_e[2],se([ue,K,ae])},t.prototype.lch=function(){return Ae(this._rgb)},t.prototype.hcl=function(){return Ae(this._rgb).reverse()},Ie=function(K){var ae,ue,_e,be,Ne,Be,He,lt,mt;return K==null&&(K="rgb"),lt=Re(arguments),He=lt[0],be=lt[1],ae=lt[2],He=He/255,be=be/255,ae=ae/255,Ne=1-Math.max(He,Math.max(be,ae)),_e=Ne<1?1/(1-Ne):0,ue=(1-He-Ne)*_e,Be=(1-be-Ne)*_e,mt=(1-ae-Ne)*_e,[ue,Be,mt,Ne]},M=function(){var K,ae,ue,_e,be,Ne,Be,He,lt;return ae=Re(arguments),_e=ae[0],Be=ae[1],lt=ae[2],Ne=ae[3],K=ae.length>4?ae[4]:1,Ne===1?[0,0,0,K]:(He=_e>=1?0:255*(1-_e)*(1-Ne),be=Be>=1?0:255*(1-Be)*(1-Ne),ue=lt>=1?0:255*(1-lt)*(1-Ne),[He,be,ue,K])},d.cmyk=function(){return M(Re(arguments))},A.cmyk=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["cmyk"]),function(){})},t.prototype.cmyk=function(){return Ie(this._rgb)},d.gl=function(){var K,ae,ue,_e,be;for(_e=(function(){var Ne,Be;Ne=Re(arguments),Be=[];for(ae in Ne)be=Ne[ae],Be.push(be);return Be}).apply(this,arguments),K=ue=0;ue<=2;K=++ue)_e[K]*=255;return _e},A.gl=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["gl"]),function(){})},t.prototype.gl=function(){var K;return K=this._rgb,[K[0]/255,K[1]/255,K[2]/255,K[3]]},Ze=function(K,ae,ue){var _e;return _e=Re(arguments),K=_e[0],ae=_e[1],ue=_e[2],K=xe(K),ae=xe(ae),ue=xe(ue),.2126*K+.7152*ae+.0722*ue},xe=function(K){return K/=255,K<=.03928?K/12.92:de((K+.055)/1.055,2.4)},Y=function(K,ae,ue,_e){var be,Ne;return be=K._rgb,Ne=ae._rgb,new t(be[0]+ue*(Ne[0]-be[0]),be[1]+ue*(Ne[1]-be[1]),be[2]+ue*(Ne[2]-be[2]),_e)},f.push(["rgb",Y]),t.prototype.luminance=function(K,ae){var ue,_e,be,Ne,Be;return ae==null&&(ae="rgb"),arguments.length?(Ne=this._rgb,K===0?Ne=[0,0,0,this._rgb[3]]:K===1?Ne=[255,255,255,this[3]]:(ue=Ze(this._rgb),_e=1e-7,be=20,Be=function(He,lt){var mt,wt;return wt=He.interpolate(lt,.5,ae),mt=wt.luminance(),Math.abs(K-mt)<_e||!be--?wt:mt>K?Be(He,wt):Be(wt,lt)},ue>K?Ne=Be(A("black"),this).rgba():Ne=Be(this,A("white")).rgba()),A(Ne).alpha(this.alpha())):Ze(this._rgb)},ze=function(K){var ae,ue,_e,be;return be=K/100,be<66?(_e=255,ue=-155.25485562709179-.44596950469579133*(ue=be-2)+104.49216199393888*pe(ue),ae=be<20?0:-254.76935184120902+.8274096064007395*(ae=be-10)+115.67994401066147*pe(ae)):(_e=351.97690566805693+.114206453784165*(_e=be-55)-40.25366309332127*pe(_e),ue=325.4494125711974+.07943456536662342*(ue=be-50)-28.0852963507957*pe(ue),ae=255),[_e,ue,ae]},rt=function(){var K,ae,ue,_e,be,Ne,Be,He;for(Ne=Re(arguments),be=Ne[0],Ne[1],K=Ne[2],_e=1e3,ue=4e4,ae=.4;ue-_e>ae;)He=(ue+_e)*.5,Be=ze(He),Be[2]/Be[0]>=K/be?ue=He:_e=He;return ht(He)},A.temperature=A.kelvin=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["temperature"]),function(){})},d.temperature=d.kelvin=d.K=ze,t.prototype.temperature=function(){return rt(this._rgb)},t.prototype.kelvin=t.prototype.temperature,A.contrast=function(K,ae){var ue,_e,be,Ne;return((be=Ee(K))==="string"||be==="number")&&(K=new t(K)),((Ne=Ee(ae))==="string"||Ne==="number")&&(ae=new t(ae)),ue=K.luminance(),_e=ae.luminance(),ue>_e?(ue+.05)/(_e+.05):(_e+.05)/(ue+.05)},A.distance=function(K,ae,ue){var _e,be,Ne,Be,He,lt,mt;ue==null&&(ue="lab"),((He=Ee(K))==="string"||He==="number")&&(K=new t(K)),((lt=Ee(ae))==="string"||lt==="number")&&(ae=new t(ae)),Ne=K.get(ue),Be=ae.get(ue),mt=0;for(be in Ne)_e=(Ne[be]||0)-(Be[be]||0),mt+=_e*_e;return Math.sqrt(mt)},A.deltaE=function(K,ae,ue,_e){var be,Ne,Be,He,lt,mt,wt,zt,Et,bt,H,fe,Me,Se,Te,et,dt,yt,Ye,We,st,ct,Lt,Dt,It,Ot,St;for(ue==null&&(ue=1),_e==null&&(_e=1),((dt=Ee(K))==="string"||dt==="number")&&(K=new t(K)),((yt=Ee(ae))==="string"||yt==="number")&&(ae=new t(ae)),Ye=K.lab(),be=Ye[0],Be=Ye[1],lt=Ye[2],We=ae.lab(),Ne=We[0],He=We[1],mt=We[2],wt=ee(Be*Be+lt*lt),zt=ee(He*He+mt*mt),Lt=be<16?.511:.040975*be/(1+.01765*be),st=.0638*wt/(1+.0131*wt)+.638,et=wt<1e-6?0:_(lt,Be)*180/s;et<0;)et+=360;for(;et>=360;)et-=360;return Dt=et>=164&&et<=345?.56+m(.2*T(s*(et+168)/180)):.36+m(.4*T(s*(et+35)/180)),Et=wt*wt*wt*wt,Te=ee(Et/(Et+1900)),ct=st*(Te*Dt+1-Te),Se=be-Ne,Me=wt-zt,H=Be-He,fe=lt-mt,bt=H*H+fe*fe-Me*Me,It=Se/(ue*Lt),Ot=Me/(_e*st),St=ct,ee(It*It+Ot*Ot+bt/(St*St))},t.prototype.get=function(K){var ae,ue,_e,be,Ne,Be;return _e=this,Ne=K.split("."),be=Ne[0],ae=Ne[1],Be=_e[be](),ae?(ue=be.indexOf(ae),ue>-1?Be[ue]:console.warn("unknown channel "+ae+" in mode "+be)):Be},t.prototype.set=function(K,ae){var ue,_e,be,Ne,Be,He;if(be=this,Be=K.split("."),Ne=Be[0],ue=Be[1],ue)if(He=be[Ne](),_e=Ne.indexOf(ue),_e>-1)if(Ee(ae)==="string")switch(ae.charAt(0)){case"+":He[_e]+=+ae;break;case"-":He[_e]+=+ae;break;case"*":He[_e]*=+ae.substr(1);break;case"/":He[_e]/=+ae.substr(1);break;default:He[_e]=+ae}else He[_e]=ae;else console.warn("unknown channel "+ue+" in mode "+Ne);else He=ae;return A(He,Ne).alpha(be.alpha())},t.prototype.clipped=function(){return this._rgb._clipped||!1},t.prototype.alpha=function(K){return arguments.length?A.rgb([this._rgb[0],this._rgb[1],this._rgb[2],K]):this._rgb[3]},t.prototype.darken=function(K){var ae,ue;return K==null&&(K=1),ue=this,ae=ue.lab(),ae[0]-=r.Kn*K,A.lab(ae).alpha(ue.alpha())},t.prototype.brighten=function(K){return K==null&&(K=1),this.darken(-K)},t.prototype.darker=t.prototype.darken,t.prototype.brighter=t.prototype.brighten,t.prototype.saturate=function(K){var ae,ue;return K==null&&(K=1),ue=this,ae=ue.lch(),ae[1]+=K*r.Kn,ae[1]<0&&(ae[1]=0),A.lch(ae).alpha(ue.alpha())},t.prototype.desaturate=function(K){return K==null&&(K=1),this.saturate(-K)},t.prototype.premultiply=function(){var K,ae;return ae=this.rgb(),K=this.alpha(),A(ae[0]*K,ae[1]*K,ae[2]*K,K)},g=function(K,ae,ue){if(!g[ue])throw"unknown blend mode "+ue;return g[ue](K,ae)},b=function(K){return function(ae,ue){var _e,be;return _e=A(ue).rgb(),be=A(ae).rgb(),A(K(_e,be),"rgb")}},P=function(K){return function(ae,ue){var _e,be,Ne;for(Ne=[],_e=be=0;be<=3;_e=++be)Ne[_e]=K(ae[_e],ue[_e]);return Ne}},Le=function(K,ae){return K},Ue=function(K,ae){return K*ae/255},C=function(K,ae){return K>ae?ae:K},oe=function(K,ae){return K>ae?K:ae},Qe=function(K,ae){return 255*(1-(1-K/255)*(1-ae/255))},J=function(K,ae){return ae<128?2*K*ae/255:255*(1-2*(1-K/255)*(1-ae/255))},y=function(K,ae){return 255*(1-(1-ae/255)/(K/255))},N=function(K,ae){return K===255||(K=255*(ae/255)/(1-K/255),K>255)?255:K},g.normal=b(P(Le)),g.multiply=b(P(Ue)),g.screen=b(P(Qe)),g.overlay=b(P(J)),g.darken=b(P(C)),g.lighten=b(P(oe)),g.dodge=b(P(N)),g.burn=b(P(y)),A.blend=g,A.analyze=function(K){var ae,ue,_e,be;for(_e={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},ue=0,ae=K.length;ue<ae;ue++)be=K[ue],be!=null&&!isNaN(be)&&(_e.values.push(be),_e.sum+=be,be<_e.min&&(_e.min=be),be>_e.max&&(_e.max=be),_e.count+=1);return _e.domain=[_e.min,_e.max],_e.limits=function(Ne,Be){return A.limits(_e,Ne,Be)},_e},A.scale=function(K,ae){var ue,_e,be,Ne,Be,He,lt,mt,wt,zt,Et,bt,H,fe,Me,Se,Te,et,dt,yt,Ye;return wt="rgb",zt=A("#ccc"),fe=0,Be=[0,1],H=[],bt=[0,0],ue=!1,be=[],Et=!1,mt=0,lt=1,Ne=!1,_e={},Me=!0,He=1,yt=function(We){var st,ct,Lt,Dt,It,Ot;if(We==null&&(We=["#fff","#000"]),We!=null&&Ee(We)==="string"&&A.brewer!=null&&(We=A.brewer[We]||A.brewer[We.toLowerCase()]||We),Ee(We)==="array"){for(We.length===1&&(We=[We[0],We[0]]),We=We.slice(0),st=Lt=0,Dt=We.length-1;0<=Dt?Lt<=Dt:Lt>=Dt;st=0<=Dt?++Lt:--Lt)ct=We[st],Ee(ct)==="string"&&(We[st]=A(ct));for(H.length=0,st=Ot=0,It=We.length-1;0<=It?Ot<=It:Ot>=It;st=0<=It?++Ot:--Ot)H.push(st/(We.length-1))}return dt(),be=We},Te=function(We){var st,ct;if(ue!=null){for(ct=ue.length-1,st=0;st<ct&&We>=ue[st];)st++;return st-1}return 0},Ye=function(We){return We},et=function(We,st){var ct,Lt,Dt,It,Ot,St,vt,$t;if(st==null&&(st=!1),isNaN(We)||We===null)return zt;if(st?$t=We:ue&&ue.length>2?(ct=Te(We),$t=ct/(ue.length-2)):lt!==mt?$t=(We-mt)/(lt-mt):$t=1,st||($t=Ye($t)),He!==1&&($t=de($t,He)),$t=bt[0]+$t*(1-bt[0]-bt[1]),$t=Math.min(1,Math.max(0,$t)),It=Math.floor($t*1e4),Me&&_e[It])Lt=_e[It];else{if(Ee(be)==="array")for(Dt=Ot=0,vt=H.length-1;0<=vt?Ot<=vt:Ot>=vt;Dt=0<=vt?++Ot:--Ot){if(St=H[Dt],$t<=St){Lt=be[Dt];break}if($t>=St&&Dt===H.length-1){Lt=be[Dt];break}if($t>St&&$t<H[Dt+1]){$t=($t-St)/(H[Dt+1]-St),Lt=A.interpolate(be[Dt],be[Dt+1],$t,wt);break}}else Ee(be)==="function"&&(Lt=be($t));Me&&(_e[It]=Lt)}return Lt},dt=function(){return _e={}},yt(K),Se=function(We){var st;return st=A(et(We)),Et&&st[Et]?st[Et]():st},Se.classes=function(We){var st;return We!=null?(Ee(We)==="array"?(ue=We,Be=[We[0],We[We.length-1]]):(st=A.analyze(Be),We===0?ue=[st.min,st.max]:ue=A.limits(st,"e",We)),Se):ue},Se.domain=function(We){var st,ct,Lt,Dt,It,Ot,St;if(!arguments.length)return Be;if(mt=We[0],lt=We[We.length-1],H=[],Lt=be.length,We.length===Lt&&mt!==lt)for(It=0,Dt=We.length;It<Dt;It++)ct=We[It],H.push((ct-mt)/(lt-mt));else for(st=St=0,Ot=Lt-1;0<=Ot?St<=Ot:St>=Ot;st=0<=Ot?++St:--St)H.push(st/(Lt-1));return Be=[mt,lt],Se},Se.mode=function(We){return arguments.length?(wt=We,dt(),Se):wt},Se.range=function(We,st){return yt(We,st),Se},Se.out=function(We){return Et=We,Se},Se.spread=function(We){return arguments.length?(fe=We,Se):fe},Se.correctLightness=function(We){return We==null&&(We=!0),Ne=We,dt(),Ne?Ye=function(st){var ct,Lt,Dt,It,Ot,St,vt,$t,Rt;for(ct=et(0,!0).lab()[0],Lt=et(1,!0).lab()[0],vt=ct>Lt,Dt=et(st,!0).lab()[0],Ot=ct+(Lt-ct)*st,It=Dt-Ot,$t=0,Rt=1,St=20;Math.abs(It)>.01&&St-- >0;)(function(){return vt&&(It*=-1),It<0?($t=st,st+=(Rt-st)*.5):(Rt=st,st+=($t-st)*.5),Dt=et(st,!0).lab()[0],It=Dt-Ot})();return st}:Ye=function(st){return st},Se},Se.padding=function(We){return We!=null?(Ee(We)==="number"&&(We=[We,We]),bt=We,Se):bt},Se.colors=function(We,st){var ct,Lt,Dt,It,Ot,St,vt,$t;if(arguments.length<2&&(st="hex"),Ot=[],arguments.length===0)Ot=be.slice(0);else if(We===1)Ot=[Se(.5)];else if(We>1)Lt=Be[0],ct=Be[1]-Lt,Ot=(function(){St=[];for(var Rt=0;0<=We?Rt<We:Rt>We;0<=We?Rt++:Rt--)St.push(Rt);return St}).apply(this).map(function(Rt){return Se(Lt+Rt/(We-1)*ct)});else{if(K=[],vt=[],ue&&ue.length>2)for(Dt=$t=1,It=ue.length;1<=It?$t<It:$t>It;Dt=1<=It?++$t:--$t)vt.push((ue[Dt-1]+ue[Dt])*.5);else vt=Be;Ot=vt.map(function(Rt){return Se(Rt)})}return A[st]&&(Ot=Ot.map(function(Rt){return Rt[st]()})),Ot},Se.cache=function(We){return We!=null?(Me=We,Se):Me},Se.gamma=function(We){return We!=null?(He=We,Se):He},Se.nodata=function(We){return We!=null?(zt=A(We),Se):zt},Se},A.scales==null&&(A.scales={}),A.scales.cool=function(){return A.scale([A.hsl(180,1,.9),A.hsl(250,.7,.4)])},A.scales.hot=function(){return A.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},A.analyze=function(K,ae,ue){var _e,be,Ne,Be,He,lt,mt;if(He={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},ue==null&&(ue=function(){return!0}),_e=function(wt){wt!=null&&!isNaN(wt)&&(He.values.push(wt),He.sum+=wt,wt<He.min&&(He.min=wt),wt>He.max&&(He.max=wt),He.count+=1)},mt=function(wt,zt){if(ue(wt,zt))return ae!=null&&Ee(ae)==="function"?_e(ae(wt)):ae!=null&&Ee(ae)==="string"||Ee(ae)==="number"?_e(wt[ae]):_e(wt)},Ee(K)==="array")for(Be=0,Ne=K.length;Be<Ne;Be++)lt=K[Be],mt(lt);else for(be in K)lt=K[be],mt(lt,be);return He.domain=[He.min,He.max],He.limits=function(wt,zt){return A.limits(He,wt,zt)},He},A.limits=function(K,ae,ue){var _e,be,Ne,Be,He,lt,mt,wt,zt,Et,bt,H,fe,Me,Se,Te,et,dt,yt,Ye,We,st,ct,Lt,Dt,It,Ot,St,vt,$t,Rt,vn,vi,$n,Pn,Jt,Wn,$i,hn,Yn,Wi,pr,Js,Oa,ss,os,as,eo,Ba,Qo,mr,Jo,to,ir,zr;if(ae==null&&(ae="equal"),ue==null&&(ue=7),Ee(K)==="array"&&(K=A.analyze(K)),Dt=K.min,ve=K.max,K.sum,ir=K.values.sort(function(ln,vl){return ln-vl}),ue===1)return[Dt,ve];if(ct=[],ae.substr(0,1)==="c"&&(ct.push(Dt),ct.push(ve)),ae.substr(0,1)==="e"){for(ct.push(Dt),Ye=Rt=1,Pn=ue-1;1<=Pn?Rt<=Pn:Rt>=Pn;Ye=1<=Pn?++Rt:--Rt)ct.push(Dt+Ye/ue*(ve-Dt));ct.push(ve)}else if(ae.substr(0,1)==="l"){if(Dt<=0)throw"Logarithmic scales are only possible for values > 0";for(It=Math.LOG10E*pe(Dt),Lt=Math.LOG10E*pe(ve),ct.push(Dt),Ye=zr=1,Jt=ue-1;1<=Jt?zr<=Jt:zr>=Jt;Ye=1<=Jt?++zr:--zr)ct.push(de(10,It+Ye/ue*(Lt-It)));ct.push(ve)}else if(ae.substr(0,1)==="q"){for(ct.push(Dt),Ye=_e=1,pr=ue-1;1<=pr?_e<=pr:_e>=pr;Ye=1<=pr?++_e:--_e)vn=(ir.length-1)*Ye/ue,vi=L(vn),vi===vn?ct.push(ir[vi]):($n=vn-vi,ct.push(ir[vi]*(1-$n)+ir[vi+1]*$n));ct.push(ve)}else if(ae.substr(0,1)==="k"){for(St=ir.length,Me=new Array(St),dt=new Array(ue),Qo=!0,vt=0,Te=null,Te=[],Te.push(Dt),Ye=be=1,Js=ue-1;1<=Js?be<=Js:be>=Js;Ye=1<=Js?++be:--be)Te.push(Dt+Ye/ue*(ve-Dt));for(Te.push(ve);Qo;){for(We=Ne=0,Oa=ue-1;0<=Oa?Ne<=Oa:Ne>=Oa;We=0<=Oa?++Ne:--Ne)dt[We]=0;for(Ye=Be=0,ss=St-1;0<=ss?Be<=ss:Be>=ss;Ye=0<=ss?++Be:--Be){for(to=ir[Ye],Ot=Number.MAX_VALUE,We=He=0,os=ue-1;0<=os?He<=os:He>=os;We=0<=os?++He:--He)yt=m(Te[We]-to),yt<Ot&&(Ot=yt,Se=We);dt[Se]++,Me[Ye]=Se}for($t=new Array(ue),We=lt=0,as=ue-1;0<=as?lt<=as:lt>=as;We=0<=as?++lt:--lt)$t[We]=null;for(Ye=mt=0,eo=St-1;0<=eo?mt<=eo:mt>=eo;Ye=0<=eo?++mt:--mt)et=Me[Ye],$t[et]===null?$t[et]=ir[Ye]:$t[et]+=ir[Ye];for(We=wt=0,Ba=ue-1;0<=Ba?wt<=Ba:wt>=Ba;We=0<=Ba?++wt:--wt)$t[We]*=1/dt[We];for(Qo=!1,We=zt=0,Wn=ue-1;0<=Wn?zt<=Wn:zt>=Wn;We=0<=Wn?++zt:--zt)if($t[We]!==Te[Ye]){Qo=!0;break}Te=$t,vt++,vt>200&&(Qo=!1)}for(st={},We=Et=0,$i=ue-1;0<=$i?Et<=$i:Et>=$i;We=0<=$i?++Et:--Et)st[We]=[];for(Ye=bt=0,hn=St-1;0<=hn?bt<=hn:bt>=hn;Ye=0<=hn?++bt:--bt)et=Me[Ye],st[et].push(ir[Ye]);for(mr=[],We=H=0,Yn=ue-1;0<=Yn?H<=Yn:H>=Yn;We=0<=Yn?++H:--H)mr.push(st[We][0]),mr.push(st[We][st[We].length-1]);for(mr=mr.sort(function(ln,vl){return ln-vl}),ct.push(mr[0]),Ye=fe=1,Wi=mr.length-1;fe<=Wi;Ye=fe+=2)Jo=mr[Ye],!isNaN(Jo)&&ct.indexOf(Jo)===-1&&ct.push(Jo)}return ct},V=function(K,ae,ue){var _e,be,Ne,Be;return _e=Re(arguments),K=_e[0],ae=_e[1],ue=_e[2],isNaN(K)&&(K=0),K/=360,K<1/3?(be=(1-ae)/3,Be=(1+ae*T(l*K)/T(o-l*K))/3,Ne=1-(be+Be)):K<2/3?(K-=1/3,Be=(1-ae)/3,Ne=(1+ae*T(l*K)/T(o-l*K))/3,be=1-(Be+Ne)):(K-=2/3,Ne=(1-ae)/3,be=(1+ae*T(l*K)/T(o-l*K))/3,Be=1-(Ne+be)),Be=$(ue*Be*3),Ne=$(ue*Ne*3),be=$(ue*be*3),[Be*255,Ne*255,be*255,_e.length>3?_e[3]:1]},ke=function(){var K,ae,ue,_e,be,Ne,Be,He;return Be=Re(arguments),Ne=Be[0],ae=Be[1],K=Be[2],l=Math.PI*2,Ne/=255,ae/=255,K/=255,be=Math.min(Ne,ae,K),_e=(Ne+ae+K)/3,He=1-be/_e,He===0?ue=0:(ue=(Ne-ae+(Ne-K))/2,ue/=Math.sqrt((Ne-ae)*(Ne-ae)+(Ne-K)*(ae-K)),ue=Math.acos(ue),K>ae&&(ue=l-ue),ue/=l),[ue*360,He,_e]},A.hsi=function(){return function(K,ae,ue){ue.prototype=K.prototype;var _e=new ue,be=K.apply(_e,ae);return Object(be)===be?be:_e}(t,Mt.call(arguments).concat(["hsi"]),function(){})},d.hsi=V,t.prototype.hsi=function(){return ke(this._rgb)},D=function(K,ae,ue,_e){var be,Ne,Be,He,lt,mt,wt,zt,Et,bt,H,fe;return _e==="hsl"?(H=K.hsl(),fe=ae.hsl()):_e==="hsv"?(H=K.hsv(),fe=ae.hsv()):_e==="hcg"?(H=K.hcg(),fe=ae.hcg()):_e==="hsi"?(H=K.hsi(),fe=ae.hsi()):(_e==="lch"||_e==="hcl")&&(_e="hcl",H=K.hcl(),fe=ae.hcl()),_e.substr(0,1)==="h"&&(Be=H[0],Et=H[1],mt=H[2],He=fe[0],bt=fe[1],wt=fe[2]),!isNaN(Be)&&!isNaN(He)?(He>Be&&He-Be>180?be=He-(Be+360):He<Be&&Be-He>180?be=He+360-Be:be=He-Be,Ne=Be+ue*be):isNaN(Be)?isNaN(He)?Ne=Number.NaN:(Ne=He,(mt===1||mt===0)&&_e!=="hsv"&&(zt=bt)):(Ne=Be,(wt===1||wt===0)&&_e!=="hsv"&&(zt=Et)),zt==null&&(zt=Et+ue*(bt-Et)),lt=mt+ue*(wt-mt),A[_e](Ne,zt,lt)},f=f.concat(function(){var K,ae,ue,_e;for(ue=["hsv","hsl","hsi","hcl","lch","hcg"],_e=[],ae=0,K=ue.length;ae<K;ae++)Pe=ue[ae],_e.push([Pe,D]);return _e}()),q=function(K,ae,ue,_e){var be,Ne;return be=K.num(),Ne=ae.num(),A.num(be+(Ne-be)*ue,"num")},f.push(["num",q]),O=function(K,ae,ue,_e){var be,Ne;return be=K.lab(),Ne=ae.lab(),new t(be[0]+ue*(Ne[0]-be[0]),be[1]+ue*(Ne[1]-be[1]),be[2]+ue*(Ne[2]-be[2]),_e)},f.push(["lab",O])}).call(mO)})(eC,eC.exports);var rae=eC.exports,bG={exports:{}};(function(i){/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */(function(e){function t(o,a,l,c,u){this._listener=a,this._isOnce=l,this.context=c,this._signal=o,this._priority=u||0}t.prototype={active:!0,params:null,execute:function(o){var a,l;return this.active&&this._listener&&(l=this.params?this.params.concat(o):o,a=this._listener.apply(this.context,l),this._isOnce&&this.detach()),a},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function n(o,a){if(typeof o!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",a))}function r(){this._bindings=[],this._prevParams=null;var o=this;this.dispatch=function(){r.prototype.dispatch.apply(o,arguments)}}r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(o,a,l,c){var u=this._indexOfListener(o,l),h;if(u!==-1){if(h=this._bindings[u],h.isOnce()!==a)throw new Error("You cannot add"+(a?"":"Once")+"() then add"+(a?"Once":"")+"() the same listener without removing the relationship first.")}else h=new t(this,o,a,l,c),this._addBinding(h);return this.memorize&&this._prevParams&&h.execute(this._prevParams),h},_addBinding:function(o){var a=this._bindings.length;do--a;while(this._bindings[a]&&o._priority<=this._bindings[a]._priority);this._bindings.splice(a+1,0,o)},_indexOfListener:function(o,a){for(var l=this._bindings.length,c;l--;)if(c=this._bindings[l],c._listener===o&&c.context===a)return l;return-1},has:function(o,a){return this._indexOfListener(o,a)!==-1},add:function(o,a,l){return n(o,"add"),this._registerListener(o,!1,a,l)},addOnce:function(o,a,l){return n(o,"addOnce"),this._registerListener(o,!0,a,l)},remove:function(o,a){n(o,"remove");var l=this._indexOfListener(o,a);return l!==-1&&(this._bindings[l]._destroy(),this._bindings.splice(l,1)),o},removeAll:function(){for(var o=this._bindings.length;o--;)this._bindings[o]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(o){if(this.active){var a=Array.prototype.slice.call(arguments),l=this._bindings.length,c;if(this.memorize&&(this._prevParams=a),!!l){c=this._bindings.slice(),this._shouldPropagate=!0;do l--;while(c[l]&&this._shouldPropagate&&c[l].execute(a)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var s=r;s.Signal=r,i.exports?i.exports=s:e.signals=s})(mO)})(bG);var tn=bG.exports,SG={};(function(i){(function(){var e={not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function t(a){return r(o(a),arguments)}function n(a,l){return t.apply(null,[a].concat(l||[]))}function r(a,l){var c=1,u=a.length,h,d="",f,m,_,v,g,b,p,y;for(f=0;f<u;f++)if(typeof a[f]=="string")d+=a[f];else if(typeof a[f]=="object"){if(_=a[f],_.keys)for(h=l[c],m=0;m<_.keys.length;m++){if(h==null)throw new Error(t('[sprintf] Cannot access property "%s" of undefined value "%s"',_.keys[m],_.keys[m-1]));h=h[_.keys[m]]}else _.param_no?h=l[_.param_no]:h=l[c++];if(e.not_type.test(_.type)&&e.not_primitive.test(_.type)&&h instanceof Function&&(h=h()),e.numeric_arg.test(_.type)&&typeof h!="number"&&isNaN(h))throw new TypeError(t("[sprintf] expecting number but found %T",h));switch(e.number.test(_.type)&&(p=h>=0),_.type){case"b":h=parseInt(h,10).toString(2);break;case"c":h=String.fromCharCode(parseInt(h,10));break;case"d":case"i":h=parseInt(h,10);break;case"j":h=JSON.stringify(h,null,_.width?parseInt(_.width):0);break;case"e":h=_.precision?parseFloat(h).toExponential(_.precision):parseFloat(h).toExponential();break;case"f":h=_.precision?parseFloat(h).toFixed(_.precision):parseFloat(h);break;case"g":h=_.precision?String(Number(h.toPrecision(_.precision))):parseFloat(h);break;case"o":h=(parseInt(h,10)>>>0).toString(8);break;case"s":h=String(h),h=_.precision?h.substring(0,_.precision):h;break;case"t":h=String(!!h),h=_.precision?h.substring(0,_.precision):h;break;case"T":h=Object.prototype.toString.call(h).slice(8,-1).toLowerCase(),h=_.precision?h.substring(0,_.precision):h;break;case"u":h=parseInt(h,10)>>>0;break;case"v":h=h.valueOf(),h=_.precision?h.substring(0,_.precision):h;break;case"x":h=(parseInt(h,10)>>>0).toString(16);break;case"X":h=(parseInt(h,10)>>>0).toString(16).toUpperCase();break}e.json.test(_.type)?d+=h:(e.number.test(_.type)&&(!p||_.sign)?(y=p?"+":"-",h=h.toString().replace(e.sign,"")):y="",g=_.pad_char?_.pad_char==="0"?"0":_.pad_char.charAt(1):" ",b=_.width-(y+h).length,v=_.width&&b>0?g.repeat(b):"",d+=_.align?y+h+v:g==="0"?y+v+h:v+y+h)}return d}var s=Object.create(null);function o(a){if(s[a])return s[a];for(var l=a,c,u=[],h=0;l;){if((c=e.text.exec(l))!==null)u.push(c[0]);else if((c=e.modulo.exec(l))!==null)u.push("%");else if((c=e.placeholder.exec(l))!==null){if(c[2]){h|=1;var d=[],f=c[2],m=[];if((m=e.key.exec(f))!==null)for(d.push(m[1]);(f=f.substring(m[0].length))!=="";)if((m=e.key_access.exec(f))!==null)d.push(m[1]);else if((m=e.index_access.exec(f))!==null)d.push(m[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");c[2]=d}else h|=2;if(h===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");u.push({placeholder:c[0],param_no:c[1],keys:c[2],sign:c[3],pad_char:c[4],align:c[5],width:c[6],precision:c[7],type:c[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");l=l.substring(c[0].length)}return s[a]=u}i.sprintf=t,i.vsprintf=n,typeof window<"u"&&(window.sprintf=t,window.vsprintf=n)})()})(SG);var sae={};function oae(i){if(typeof window>"u")return;const e=new RegExp(`${i}=([^&#=]*)`).exec(window.location.search);return e?decodeURIComponent(e[1]):void 0}function he(i,e){return i!==void 0?i:e}function wo(i,e){const t=Object.assign({},i);for(const n in e)i[n]===void 0&&(t[n]=e[n]);return t}function wG(i,e){for(const t in e){const n=e[t];n!==void 0&&(i[t]=n)}return i}function aae(){if(typeof window>"u")return!1;const i=window.navigator.userAgent;return/Opera|OPR/.test(i)?"Opera":/Chrome/i.test(i)?"Chrome":/Firefox/i.test(i)?"Firefox":/Mobile(\/.*)? Safari/i.test(i)?"Mobile Safari":/MSIE/i.test(i)?"Internet Explorer":!!/Safari/i.test(i)&&"Safari"}function lae(i,e){return i<e?-1:i>e?1:0}function Mh(i,e,t=lae){let n=0,r=i.length-1;for(;n<=r;){const s=n+r>>1,o=t(e,i[s]);if(o>0)n=s+1;else{if(!(o<0))return s;r=s-1}}return-n-1}function NR(i,e,t){const n=function(s,o){let a=s.length-1;if(s[a]<o)return-1;let l=0;for(;l<=a;){const c=l+a>>1;s[c]>=o?a=c-1:l=c+1}return a+1}(i,e),r=function(s,o){if(s[0]>o)return-1;let a=0,l=s.length-1;for(;a<=l;){const c=a+l>>1;s[c]>o?l=c-1:a=c+1}return a-1}(i,t);return n===-1||r===-1||n>r?0:r-n+1}function FR(i){return i.sort().filter(function(e,t,n){return t===0||e!==n[t-1]})}function K0(i){if(i.length>28672){const t=[];for(let n=0;n<i.length;n+=28672)t.push(String.fromCharCode.apply(null,i.subarray(n,n+28672)));return t.join("")}return String.fromCharCode.apply(null,i)}function MG(i,e){switch(i){case"int8":return new Int8Array(e);case"int16":return new Int16Array(e);case"int32":return new Int32Array(e);case"uint8":return new Uint8Array(e);case"uint16":return new Uint16Array(e);case"uint32":return new Uint32Array(e);case"float32":return new Float32Array(e);default:throw new Error("arrayType unknown: "+i)}}function fl(i,e){return new(e>65535?Uint32Array:Uint16Array)(i)}function am(i){return i.buffer&&i.buffer instanceof ArrayBuffer?i.buffer:i}function MS(i,e){return i===void 0?i=new e:Array.isArray(i)&&(i=new e().fromArray(i)),i}function Kh(i){return MS(i,me)}function Cg(i){return MS(i,Tt)}function tC(i){return MS(i,Cs)}function NM(i){return e=i,t=Float32Array,e instanceof t?e:new t(e);var e,t}function Lk(i){return he(i,"").toString().toLowerCase()}class Nu{constructor(e){this.name=e,this._dict={}}add(e,t){this._dict[Lk(e)]=t}get(e){return this._dict[Lk(e)]}get names(){return Object.keys(this._dict)}}function wi(i){return .01745*i}const cae="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),ly=new Array(36);function kR(){let i,e=0;for(let t=0;t<36;t++)t===8||t===13||t===18||t===23?ly[t]="-":t===14?ly[t]="4":(e<=2&&(e=33554432+16777216*Math.random()|0),i=15&e,e>>=4,ly[t]=cae[t===19?3&i|8:i]);return ly.join("")}function nC(i,e,t){return Math.max(e,Math.min(t,i))}function Vo(i,e,t){return i+(e-i)*t}function Wl(i,e,t,n,r,s){const o=(t-i)*s,a=(n-e)*s,l=r*r;return(2*e-2*t+o+a)*(r*l)+(-3*e+3*t-2*o-a)*l+o*r+e}function A1(i,e,t){var n;return n=function(r,s,o){return(r-s)/(o-s)}(t,i,e),(t=nC(n,0,1))*t*(3-2*t)}var AG="sRGB";const uae={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},dx=new Ht;function kn(i,e,t){const n=t.value;return t.value=function(r,s){let o=n.bind(this,r,s)();return AG=="linear"?(dx.set(o),dx.convertSRGBToLinear(),dx.getHex()):o},t}class Hn{constructor(e={}){this.parameters=wo(e,uae),typeof this.parameters.value=="string"&&(this.parameters.value=dx.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())}getScale(e={}){const t=wo(e,this.parameters);return t.scale==="rainbow"?t.scale=["red","orange","yellow","green","blue"]:t.scale==="rwb"&&(t.scale=["red","white","blue"]),t.reverse&&(t.domain=t.domain.slice().reverse()),rae.scale(t.scale).mode(t.mode).domain(t.domain).out("num")}colorToArray(e,t=[],n=0){return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t}atomColorToArray(e,t,n){return this.colorToArray(this.atomColor?this.atomColor(e):0,t,n)}bondColor(e,t){return this.atomProxy&&this.atomColor?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):0}bondColorToArray(e,t,n,r){return this.colorToArray(this.bondColor(e,t),n,r)}volumeColorToArray(e,t,n){return this.colorToArray(this.volumeColor?this.volumeColor(e):0,t,n)}positionColorToArray(e,t,n){return this.colorToArray(this.positionColor?this.positionColor(e):0,t,n)}}var Yt;(function(i){i[i.PROTEIN=1]="PROTEIN",i[i.NUCLEIC=2]="NUCLEIC",i[i.RNA=3]="RNA",i[i.DNA=4]="DNA",i[i.POLYMER=5]="POLYMER",i[i.WATER=6]="WATER",i[i.HELIX=7]="HELIX",i[i.SHEET=8]="SHEET",i[i.TURN=9]="TURN",i[i.BACKBONE=10]="BACKBONE",i[i.SIDECHAIN=11]="SIDECHAIN",i[i.ALL=12]="ALL",i[i.HETERO=13]="HETERO",i[i.ION=14]="ION",i[i.SACCHARIDE=15]="SACCHARIDE",i[i.SUGAR=15]="SUGAR",i[i.BONDED=16]="BONDED",i[i.RING=17]="RING",i[i.AROMATICRING=18]="AROMATICRING",i[i.METAL=19]="METAL",i[i.POLARH=20]="POLARH",i[i.NONE=21]="NONE"})(Yt||(Yt={}));const Dk=["*","","ALL"],hae=["NONE"],UR=[Yt.BACKBONE,Yt.SIDECHAIN,Yt.BONDED,Yt.RING,Yt.AROMATICRING,Yt.METAL,Yt.POLARH],EG=[Yt.POLYMER,Yt.WATER],dae=["ALA","GLY","SER"],fae=["CYS","SER","THR"],pae=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],mae=["PHE","TRP","TYR","HIS"],gae=["ASN","GLN"],vae=["ASP","GLU"],_ae=["ARG","HIS","LYS"],yae=["ARG","ASP","GLU","HIS","LYS"],xae=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],bae=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],Sae=["HIS","PHE","PRO","TRP","TYR"],wae=["ALA","GLY","ILE","LEU","VAL"];function Mae(i,e){if(e.atomname===void 0&&e.element===void 0&&e.altloc===void 0&&e.atomindex===void 0&&e.keyword===void 0&&e.inscode===void 0&&e.resname===void 0&&e.sstruc===void 0&&e.resno===void 0&&e.chainname===void 0&&e.model===void 0)return-1;if(e.keyword!==void 0&&(e.keyword===Yt.BACKBONE&&!i.isBackbone()||e.keyword===Yt.SIDECHAIN&&!i.isSidechain()||e.keyword===Yt.BONDED&&!i.isBonded()||e.keyword===Yt.RING&&!i.isRing()||e.keyword===Yt.AROMATICRING&&!i.isAromatic()||e.keyword===Yt.HETERO&&!i.isHetero()||e.keyword===Yt.PROTEIN&&!i.isProtein()||e.keyword===Yt.NUCLEIC&&!i.isNucleic()||e.keyword===Yt.RNA&&!i.isRna()||e.keyword===Yt.DNA&&!i.isDna()||e.keyword===Yt.POLYMER&&!i.isPolymer()||e.keyword===Yt.WATER&&!i.isWater()||e.keyword===Yt.HELIX&&!i.isHelix()||e.keyword===Yt.SHEET&&!i.isSheet()||e.keyword===Yt.TURN&&!i.isTurn()||e.keyword===Yt.ION&&!i.isIon()||e.keyword===Yt.SACCHARIDE&&!i.isSaccharide()||e.keyword===Yt.METAL&&!i.isMetal()||e.keyword===Yt.POLARH&&!i.isPolarHydrogen())||e.atomname!==void 0&&e.atomname!==i.atomname||e.element!==void 0&&e.element!==i.element||e.altloc!==void 0&&e.altloc!==i.altloc||e.atomindex!==void 0&&Mh(e.atomindex,i.index)<0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(i.resname))return!1}else if(e.resname!==i.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==i.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>i.resno||e.resno[1]<i.resno)return!1}else if(e.resno!==i.resno)return!1}return(e.inscode===void 0||e.inscode===i.inscode)&&(e.chainname===void 0||e.chainname===i.chainname)&&(e.model===void 0||e.model===i.modelIndex)}function Aae(i,e){if(e.resname===void 0&&e.resno===void 0&&e.inscode===void 0&&e.sstruc===void 0&&e.model===void 0&&e.chainname===void 0&&e.atomindex===void 0&&(e.keyword===void 0||UR.includes(e.keyword)))return-1;if(e.keyword!==void 0&&(e.keyword===Yt.HETERO&&!i.isHetero()||e.keyword===Yt.PROTEIN&&!i.isProtein()||e.keyword===Yt.NUCLEIC&&!i.isNucleic()||e.keyword===Yt.RNA&&!i.isRna()||e.keyword===Yt.DNA&&!i.isDna()||e.keyword===Yt.POLYMER&&!i.isPolymer()||e.keyword===Yt.WATER&&!i.isWater()||e.keyword===Yt.HELIX&&!i.isHelix()||e.keyword===Yt.SHEET&&!i.isSheet()||e.keyword===Yt.TURN&&!i.isTurn()||e.keyword===Yt.ION&&!i.isIon()||e.keyword===Yt.SACCHARIDE&&!i.isSaccharide())||e.atomindex!==void 0&&NR(e.atomindex,i.atomOffset,i.atomEnd)===0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(i.resname))return!1}else if(e.resname!==i.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==i.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>i.resno||e.resno[1]<i.resno)return!1}else if(e.resno!==i.resno)return!1}return(e.inscode===void 0||e.inscode===i.inscode)&&(e.chainname===void 0||e.chainname===i.chainname)&&(e.model===void 0||e.model===i.modelIndex)}function Eae(i,e){return e.chainname!==void 0||e.model!==void 0||e.atomindex!==void 0||e.keyword!==void 0&&EG.includes(e.keyword)&&i.entity?e.keyword!==void 0&&(e.keyword===Yt.POLYMER&&!i.entity.isPolymer()||e.keyword===Yt.WATER&&!i.entity.isWater())?!1:(e.atomindex===void 0||NR(e.atomindex,i.atomOffset,i.atomEnd)!==0)&&(e.chainname===void 0||e.chainname===i.chainname)&&(e.model===void 0||e.model===i.modelIndex):-1}function Tae(i,e){return e.model===void 0&&e.atomindex===void 0?-1:(e.atomindex===void 0||NR(e.atomindex,i.atomOffset,i.atomEnd)!==0)&&(e.model===void 0||e.model===i.index)}function E1(i,e){if(i===null||i.error||!i.rules||i.rules.length===0)return!1;const t=i.rules.length,n=!i.negate,r=!!i.negate,s=[];for(let o=0;o<t;++o){const a=i.rules[o];a.hasOwnProperty("operator")&&(s[o]=E1(a,e))}return function(o){const a=i.operator==="AND";let l=!1;for(let c=0;c<t;++c){const u=i.rules[c];let h;if(u.hasOwnProperty("operator")){const d=s[c];if(h=d!==!1?d(o):-1,h===-1){l=!0;continue}if(h===!0){if(a)continue;return n}if(a)return r}else{if(u.keyword===Yt.ALL){if(a)continue;return n}if(u.keyword===Yt.NONE){if(a)continue;return r}if(h=e(o,u),h!==-1){if(h===!0){if(a)continue;return n}if(a)return r}else l=!0}}return l?-1:a?n:r}}function T1(i,e){if(i.error||!i.rules||i.rules.length===0)return i;const t=i.rules.length,n={operator:i.operator,rules:[]};i.hasOwnProperty("negate")&&(n.negate=i.negate);for(let r=0;r<t;++r){const s=i.rules[r];if(s.hasOwnProperty("operator")){const o=T1(s,e);o!==null&&n.rules.push(o)}else e(s)||n.rules.push(s)}return n.rules.length>0?i:null}function Nk(i,e=!1){let t=i;return e&&(t=T1(i,function(n){return n.keyword!==void 0&&!UR.includes(n.keyword)||n.model!==void 0||n.chainname!==void 0||n.resname!==void 0||n.resno!==void 0||n.sstruc!==void 0})),E1(t,Mae)}function Fk(i,e=!1){let t=i;return e&&(t=T1(i,function(n){return!(n.keyword===void 0||!UR.includes(n.keyword))||n.model!==void 0||n.chainname!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0})),E1(t,Aae)}function kk(i,e=!1){let t=i;return e&&(t=T1(i,function(n){return n.keyword!==void 0&&!EG.includes(n.keyword)||n.resname!==void 0||n.resno!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0||n.sstruc!==void 0||n.inscode!==void 0})),E1(t,Eae)}function Uk(i,e=!1){let t=i;return e&&(t=T1(i,function(n){return n.keyword!==void 0||n.chainname!==void 0||n.resname!==void 0||n.resno!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0||n.sstruc!==void 0||n.inscode!==void 0})),E1(t,Tae)}class ei{constructor(e){this.signals={stringChanged:new tn.Signal},this.setString(e)}get type(){return"selection"}setString(e,t){if(e===void 0&&(e=this.string||""),e===this.string)return;try{this.selection=function(r){let s={operator:void 0,rules:[]};if(!r)return s;let o,a,l=s;const c=[];(r=r.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)==="("&&r.substr(-1)===")"&&(r=r.slice(1,-1).trim());const u=r.split(/\s+/),h=_=>{o={operator:_,rules:[]},l===void 0?(l=o,s=o):(l.rules.push(o),c.push(l),l=o)},d=function(_){a=l,l=c.pop(),l===void 0&&(h(_),f(a))},f=function(_){l.rules.push(_)};let m=!1;for(let _=0;_<u.length;++_){const v=u[_],g=v.toUpperCase();if(v==="("){m=!1,h();continue}if(v===")"){d(),l.negate&&d();continue}if(m>0)if(g==="NOT")m=1;else if(m===1)m=2;else{if(m!==2)throw new Error("something went wrong with 'not'");m=!1,d()}if(g==="AND"){if(l.operator==="OR"){const T=l.rules.pop();h("AND"),f(T)}else l.operator="AND";continue}if(g==="OR"){l.operator==="AND"?d("OR"):l.operator="OR";continue}if(v.toUpperCase()==="NOT"){m=1,h(),l.negate=!0;continue}if(+g!=+g){const T=Yt[g];if(T!==void 0){f({keyword:T});continue}}if(g==="HYDROGEN"){f({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if(g==="SMALL"){f({resname:dae});continue}if(g==="NUCLEOPHILIC"){f({resname:fae});continue}if(g==="HYDROPHOBIC"){f({resname:pae});continue}if(g==="AROMATIC"){f({resname:mae});continue}if(g==="AMIDE"){f({resname:gae});continue}if(g==="ACIDIC"){f({resname:vae});continue}if(g==="BASIC"){f({resname:_ae});continue}if(g==="CHARGED"){f({resname:yae});continue}if(g==="POLAR"){f({resname:xae});continue}if(g==="NONPOLAR"){f({resname:bae});continue}if(g==="CYCLIC"){f({resname:Sae});continue}if(g==="ALIPHATIC"){f({resname:wae});continue}if(g==="SIDECHAINATTACHED"){f({operator:"OR",rules:[{keyword:Yt.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:Yt.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:Yt.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});continue}if(g==="APOLARH"){f({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:Yt.POLARH}]}]});continue}if(g==="LIGAND"){f({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:Yt.HETERO},{negate:!0,operator:void 0,rules:[{keyword:Yt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:Yt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:Yt.WATER},{keyword:Yt.ION}]}]}]});continue}if(Dk.indexOf(g)!==-1){f({keyword:Yt.ALL});continue}if(v.charAt(0)==="@"){const T=v.substr(1).split(",").map(E=>parseInt(E));T.sort(function(E,C){return E-C}),f({atomindex:T});continue}if(v.charAt(0)==="#"){console.error("# for element selection deprecated, use _"),f({element:g.substr(1)});continue}if(v.charAt(0)==="_"){f({element:g.substr(1)});continue}if(v[0]==="["&&v[v.length-1]==="]"){const T=g.substr(1,v.length-2).split(","),E=T.length>1?T:T[0];f({resname:E});continue}if(v.length>=1&&v.length<=4&&v[0]!=="^"&&v[0]!==":"&&v[0]!=="."&&v[0]!=="%"&&v[0]!=="/"&&isNaN(parseInt(v))){f({resname:g});continue}const b={operator:"AND",rules:[]},p=v.split("/");if(p.length>1&&p[1]){if(isNaN(parseInt(p[1])))throw new Error("model must be an integer");b.rules.push({model:parseInt(p[1])})}const y=p[0].split("%");y.length>1&&b.rules.push({altloc:y[1]});const A=y[0].split(".");if(A.length>1&&A[1]){if(A[1].length>4)throw new Error("atomname must be one to four characters");b.rules.push({atomname:A[1].substring(0,4).toUpperCase()})}const w=A[0].split(":");w.length>1&&w[1]&&b.rules.push({chainname:w[1]});const M=w[0].split("^");if(M.length>1&&b.rules.push({inscode:M[1]}),M[0]){let T,E;M[0][0]==="-"&&(M[0]=M[0].substr(1),T=!0),M[0].includes("--")&&(M[0]=M[0].replace("--","-"),E=!0);let C=M[0].split("-");if(C.length===1){let N=parseInt(C[0]);if(isNaN(N))throw new Error("resi must be an integer");T&&(N*=-1),b.rules.push({resno:N})}else{if(C.length!==2)throw new Error("resi range must contain one '-'");{const N=C.map(P=>parseInt(P));T&&(N[0]*=-1),E&&(N[1]*=-1),b.rules.push({resno:[N[0],N[1]]})}}}if(b.rules.length===1)f(b.rules[0]);else{if(!(b.rules.length>1))throw new Error("empty selection chunk");f(b)}}return s.operator===void 0&&s.rules.length===1&&s.rules[0].hasOwnProperty("operator")&&(s=s.rules[0]),s}(e)}catch(r){this.selection={error:r.message}}const n=this.selection;this.string=e,this.test=Nk(n),this.residueTest=Fk(n),this.chainTest=kk(n),this.modelTest=Uk(n),this.atomOnlyTest=Nk(n,!0),this.residueOnlyTest=Fk(n,!0),this.chainOnlyTest=kk(n,!0),this.modelOnlyTest=Uk(n,!0),t||this.signals.stringChanged.dispatch(this.string)}isAllSelection(){return Dk.includes(this.string.toUpperCase())}isNoneSelection(){return hae.includes(this.string.toUpperCase())}}class Cae extends Hn{constructor(e){super(e),this.colormakerList=[],this.selectionList=[],(e.dataList||[]).forEach(t=>{const[n,r,s={}]=t;gn.hasScheme(n)?Object.assign(s,{scheme:n,structure:this.parameters.structure}):Object.assign(s,{scheme:"uniform",value:new Ht(n).getHex()}),this.colormakerList.push(gn.getScheme(s)),this.selectionList.push(new ei(r))})}atomColor(e){for(let t=0,n=this.selectionList.length;t<n;++t){const r=this.selectionList[t].test;if(r&&r(e))return this.colormakerList[t].atomColor(e)}return 16777215}}const Pae={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},Rae={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"};function TG(i){const e=i;return i.forEach(function(t){t.__deps&&Array.prototype.push.apply(e,TG(t.__deps))}),e}function Iae(i){return FR(TG(i)).map(function(e){return e.toString()}).join(`


`)}function Lae(i){const e=i.data.__name,t=i.data.__postId;if(e===void 0)console.error("message __name undefined");else if(self.func===void 0)console.error("worker func undefined",e);else{const n=function(r,s){r=r||{},t!==void 0&&(r.__postId=t);try{self.postMessage(r,s)}catch(o){console.error("self.postMessage:",o),self.postMessage(r)}};self.func(i,n)}}function Dae(i,e){let t=`'use strict';

`+Iae(e);return t+=`


self.func = `+i.toString()+";",t+=`


self.onmessage = `+Lae.toString()+";",new Blob([t],{type:"application/javascript"})}const CG=aae();let PG=!1;try{const i=Object.defineProperty({},"passive",{get:function(){PG=!0}});window.addEventListener("test",e=>{},i)}catch{}const RG=typeof window<"u"&&window.orientation!==void 0;let Ya=!1;function Ok(i){Ya=i}let al=!1;function Bk(i){al=i}const tt={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)};let lg={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1},pt=!!(FM=oae("debug"))&&(typeof FM!="string"||/^1|true|t|yes|y$/i.test(FM));var FM;const Nae=["ngl","js"],t0=new class{constructor(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}}add(i,e,t){this._funcDict[i]=e,this._depsDict[i]=t}get(i){return this._blobDict[i]||(this._blobDict[i]=Dae(this._funcDict[i],this._depsDict[i])),this._blobDict[i]}},gn=new class{constructor(){this.schemes={},this.userSchemes={}}getScheme(i){const e=((i||{}).scheme||"").toLowerCase();let t;return t=e in this.schemes?this.schemes[e]:e in this.userSchemes?this.userSchemes[e]:Hn,new t(i)}getSchemes(){const i={};return Object.keys(this.schemes).forEach(function(e){i[e]=e}),Object.keys(this.userSchemes).forEach(function(e){i[e]=e.split("|")[1]}),i}getScales(){return Pae}getModes(){return Rae}add(i,e){i=i.toLowerCase(),this.schemes[i]=e}addScheme(i,e){return function(t){return t instanceof Hn}(i)||(i=this._createScheme(i)),this._addUserScheme(i,e)}_addUserScheme(i,e){e=e||"";const t=`${kR()}|${e}`.toLowerCase();return this.userSchemes[t]=i,t}removeScheme(i){i=i.toLowerCase(),delete this.userSchemes[i]}_createScheme(i){return class extends Hn{constructor(e){super(e),i.call(this,e)}}}addSelectionScheme(i,e){return this._addUserScheme(class extends Cae{constructor(t){super(Object.assign({dataList:i},t))}},e)}hasScheme(i){return(i=i.toLowerCase())in this.schemes||i in this.userSchemes}},vu=new Nu("datasource"),ti=new Nu("representatation"),Zt=new class extends Nu{constructor(){super("parser")}__hasObjName(i,e){const t=this.get(i);return t&&t.prototype.__objName===e}isTrajectory(i){return this.__hasObjName(i,"frames")}isStructure(i){return this.__hasObjName(i,"structure")}isVolume(i){return this.__hasObjName(i,"volume")}isSurface(i){return this.__hasObjName(i,"surface")}isBinary(i){const e=this.get(i);return e&&e.prototype.isBinary}isXml(i){const e=this.get(i);return e&&e.prototype.isXml}isJson(i){const e=this.get(i);return e&&e.prototype.isJson}getTrajectoryExtensions(){return this.names.filter(i=>this.isTrajectory(i))}getStructureExtensions(){return this.names.filter(i=>this.isStructure(i))}getVolumeExtensions(){return this.names.filter(i=>this.isVolume(i))}getSurfaceExtensions(){return this.names.filter(i=>this.isSurface(i))}},An=new Nu("shader"),OR=new Nu("decompressor"),Hp=new Nu("component"),To=new Nu("buffer"),zo=new Nu("picker");let kM;class IG{constructor(e,t={}){this.chunkSize=10485760,this.newline=`
`,this.__pointer=0,this.__partialLine="",this.compressed=he(t.compressed,!1),this.binary=he(t.binary,!1),this.json=he(t.json,!1),this.xml=he(t.xml,!1),this.src=e}isBinary(){return this.binary||this.compressed}read(){return this._read().then(e=>{const t=this.compressed?OR.get(this.compressed):void 0;return this.compressed&&t?this.data=t(e):((this.binary||this.compressed)&&e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.data=e),this.data})}_chunk(e,t){return t=Math.min(this.data.length,t),e===0&&this.data.length===t?this.data:this.isBinary()?this.data.subarray(e,t):this.data.substring(e,t)}chunk(e){const t=e+this.chunkSize;return this._chunk(e,t)}peekLines(e){const t=this.data,n=t.length,r=this.isBinary()?this.newline.charCodeAt(0):this.newline;let s,o=0;for(s=0;s<n&&(t[s]===r&&++o,o!==e);++s);const a=this._chunk(0,s+1);return this.chunkToLines(a,"",s>n).lines}chunkCount(){return Math.floor(this.data.length/this.chunkSize)+1}asText(){return this.isBinary()?K0(this.data):this.data}chunkToLines(e,t,n){const r=this.newline;if(!this.isBinary()&&e.length===this.data.length)return{lines:e.split(r),partialLine:""};let s=[];const o=this.isBinary()?K0(e):e,a=o.lastIndexOf(r);if(a===-1)t+=o;else{const l=t+o.substr(0,a);s=s.concat(l.split(r)),t=a===o.length-r.length?"":o.substr(a+r.length)}return n&&t!==""&&s.push(t),{lines:s,partialLine:t}}nextChunk(){const e=this.__pointer;if(!(e>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(e)}nextChunkOfLines(){const e=this.nextChunk();if(e===void 0)return;const t=this.__pointer>this.data.length,n=this.chunkToLines(e,this.__partialLine,t);return this.__partialLine=n.partialLine,n.lines}eachChunk(e){const t=this.chunkSize,n=this.data.length,r=this.chunkCount();for(let s=0;s<n;s+=t)e(this.chunk(s),Math.round(s/t),r)}eachChunkOfLines(e){this.eachChunk((t,n,r)=>{const s=n===r+1,o=this.chunkToLines(t,this.__partialLine,s);this.__partialLine=o.partialLine,e(o.lines,n,r)})}dispose(){delete this.src}}class Fae extends IG{_read(){return new Promise((e,t)=>{const n=this.src,r=new FileReader;r.onload=s=>{s.target&&e(s.target.result)},r.onerror=s=>t(s),this.binary||this.compressed?r.readAsArrayBuffer(n):r.readAsText(n)})}}class kae extends IG{_read(){return new Promise((e,t)=>{const n=this.src,r=new XMLHttpRequest;r.open("GET",n,!0),r.addEventListener("load",()=>{if(r.status===200||r.status===304||r.status===0)try{e(r.response)}catch(s){t(s)}else t(r.statusText)},!1),r.addEventListener("error",s=>t("network error"),!1),this.isBinary()?r.responseType="arraybuffer":this.json?r.responseType="json":this.xml?r.responseType="document":r.responseType="text",r.send()})}}class LG{constructor(e,t={}){this.parameters=wo(t,{ext:"",compressed:!1,binary:Zt.isBinary(t.ext||""),name:"",dir:"",path:"",protocol:""});const n={compressed:this.parameters.compressed,binary:this.parameters.binary,json:Zt.isJson(this.parameters.ext),xml:Zt.isXml(this.parameters.ext)};typeof File<"u"&&e instanceof File||typeof Blob<"u"&&e instanceof Blob?this.streamer=new Fae(e,n):this.streamer=new kae(e,n)}}class Uae extends LG{constructor(e,t={}){super(e,t),this.parserParams={voxelSize:t.voxelSize,firstModelOnly:t.firstModelOnly,asTrajectory:t.asTrajectory,cAlphaOnly:t.cAlphaOnly,delimiter:t.delimiter,comment:t.comment,columnNames:t.columnNames,inferBonds:t.inferBonds,name:this.parameters.name,path:this.parameters.path}}load(){return new(Zt.get(this.parameters.ext))(this.streamer,this.parserParams).parse()}}class Oae{constructor(e,t,n){this.name=t,this.path=n,this.signals={elementAdded:new tn.Signal,elementRemoved:new tn.Signal,nameChanged:new tn.Signal},this.type="Script",this.dir=n.substring(0,n.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",e)}catch(r){tt.error("Script compilation failed",r),this.fn=function(){}}}run(e){return new Promise((t,n)=>{try{this.fn.apply(null,[e,this.name,this.path,this.dir]),t()}catch(r){tt.error("Script.fn",r),n(r)}})}}class Bae extends LG{load(){return this.streamer.read().then(()=>new Oae(this.streamer.asText(),this.parameters.name,this.parameters.path))}}function Ks(i){const e=OR.names;let t,n,r="";t=i instanceof File?i.name:i instanceof Blob?"":i;const s=t.lastIndexOf("?"),o=s!==-1?t.substring(s):"";t=t.substring(0,s===-1?t.length:s);const a=t.replace(/^.*[\\/]/,"");let l=a.substring(0,a.lastIndexOf("."));const c=a.split(".");let u=c.length>1?(c.pop()||"").toLowerCase():"";const h=t.match(/^(.+):\/\/(.+)$/);h&&(r=h[1].toLowerCase(),t=h[2]||"");const d=t.substring(0,t.lastIndexOf("/")+1);if(e.includes(u)){n=u;const f=t.length-u.length-1;u=(t.substr(0,f).split(".").pop()||"").toLowerCase();const m=l.length-u.length-1;l=l.substr(0,m)}else n=!1;return{path:t,name:a,ext:u,base:l,dir:d,compressed:n,protocol:r,query:o,src:i}}function zae(i){let e=Ks(i);const t=vu.get(e.protocol);return t&&(e=Ks(t.getUrl(e.src)),!e.ext&&t.getExt&&(e.ext=t.getExt(i))),e}function zk(i,e={}){const t=Object.assign(zae(i),e);let n;return Zt.names.includes(t.ext)?n=new Uae(t.src,t):Nae.includes(t.ext)&&(n=new Bae(t.src,t)),n?n.load():Promise.reject(new Error(`autoLoad: ext '${t.ext}' unknown`))}const UM=[];class Gae{constructor(e,t={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;e===void 0&&(e=8192),typeof e=="number"?e=new ArrayBuffer(e):n=!0;const r=t.offset?t.offset>>>0:0;let s=e.byteLength-r,o=r;e instanceof ArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+r),e=e.buffer),this._lastWrittenByte=n?s:0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=o,this._data=new DataView(this.buffer,o,s)}available(e){return e===void 0&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return e===void 0&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){UM.length=e;for(var t=0;t<e;t++)UM[t]=this.readChar();return UM.join("")}writeBoolean(e=!1){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}class DG{constructor(){this.count=0,this.signals={countChanged:new tn.Signal}}clear(){this.change(-this.count)}change(e){this.count+=e,this.signals.countChanged.dispatch(e,this.count),this.count<0&&tt.warn("Counter.count below zero",this.count)}increment(){this.change(1)}decrement(){this.change(-1)}listen(e){this.change(e.count),e.signals.countChanged.add(this.change,this)}unlisten(e){const t=e.signals.countChanged;t.has(this.change,this)&&t.remove(this.change,this)}onZeroOnce(e,t){if(this.count===0)e.call(t);else{const n=()=>{this.count===0&&(this.signals.countChanged.remove(n,this),e.call(t))};this.signals.countChanged.add(n,this)}}dispose(){this.clear(),this.signals.countChanged.dispose()}}An.add("shader/BasicLine.vert",`void main(){
#include begin_vertex
#include project_vertex
}`),An.add("shader/BasicLine.frag",`uniform vec3 uColor;
#include common
#include fog_pars_fragment
void main(){
gl_FragColor = vec4( uColor, 1.0 );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`),An.add("shader/Quad.vert",`varying vec2 vUv;
void main() {
vUv = uv;
gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`),An.add("shader/Quad.frag",`varying vec2 vUv;
uniform sampler2D tForeground;
uniform float scale;
void main() {
vec4 foreground = texture2D( tForeground, vUv );
gl_FragColor = foreground * scale;
}`);class Vae{constructor(){this.signals={updated:new tn.Signal},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()}update(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()}begin(){this.startTime=window.performance.now(),this.lastFrames=this.frames}end(){const e=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=e-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,e>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=e,this.frames=0),e}}An.add("shader/chunk/fog_fragment.glsl",`#ifdef USE_FOG
float depth = length( vViewPosition );
#ifdef FOG_EXP2
float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
#else
float fogFactor = smoothstep( fogNear, fogFar, depth );
#endif
gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`),An.add("shader/chunk/interior_fragment.glsl",`if( gl_FrontFacing == false ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}`),An.add("shader/chunk/matrix_scale.glsl",`float matrixScale( in mat4 m ){
vec4 r = m[ 0 ];
return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );
}`),An.add("shader/chunk/nearclip_vertex.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear - 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),An.add("shader/chunk/nearclip_fragment.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear )
discard;
#endif`),An.add("shader/chunk/opaque_back_fragment.glsl",`#ifdef OPAQUE_BACK
#ifdef FLIP_SIDED
if( gl_FrontFacing == true ){
gl_FragColor.a = 1.0;
}
#else
if( gl_FrontFacing == false ){
gl_FragColor.a = 1.0;
}
#endif
#endif`),An.add("shader/chunk/radiusclip_vertex.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),An.add("shader/chunk/radiusclip_fragment.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius )
discard;
#endif`),An.add("shader/chunk/unpack_color.glsl",`vec3 unpackColor(float f) {
vec3 color;
color.r = floor(f / 256.0 / 256.0);
color.g = floor((f - color.r * 256.0 * 256.0) / 256.0);
color.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);
return color / 255.0;
}`);const Hae=/^(?!\/\/)\s*#include\s+(\S+)/gim,OM={};function Pg(i,e={}){let t=i+"|";for(const n in e)t+=n+":"+e[n];if(!OM[t]){const n=function(s){if(s===void 0)return"";const o=[];for(const a in s){const l=s[a];l&&o.push(`#define ${a} ${l}`)}return o.join(`
`)+`
`}(e);let r=An.get(`shader/${i}`);if(!r)throw new Error(`empty shader, '${i}'`);r=r.replace(Hae,function(s,o){const a=`shader/chunk/${o}.glsl`,l=An.get(a)||dn[o];if(!l)throw new Error(`empty chunk, '${o}'`);return l}),OM[t]=n+r}return OM[t]}if(typeof WebGLRenderingContext<"u"){const i=WebGLRenderingContext.prototype,e=i.getShaderParameter;i.getShaderParameter=function(){return!pt||e.apply(this,arguments)};const t=i.getShaderInfoLog;i.getShaderInfoLog=function(){return pt?t.apply(this,arguments):""};const n=i.getProgramParameter;i.getProgramParameter=function(s,o){return!pt&&o===i.LINK_STATUS||n.apply(this,arguments)};const r=i.getProgramInfoLog;i.getProgramInfoLog=function(){return pt?r.apply(this,arguments):""}}const NG=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];NG.forEach(i=>{i.forEach(e=>{e[0]*=.0625,e[1]*=.0625})});class $ae{constructor(e,t,n,r){this.canvas=document.createElement("canvas"),this._viewer=n,this._factor=he(r.factor,2),this._antialias=he(r.antialias,!1),this._onProgress=r.onProgress,this._onFinish=r.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=n.sampleLevel,this._viewer.setSampling(-1)}_renderTile(e){const t=this._viewer,n=this._width,r=this._height,s=this._factor,o=e%s*n,a=Math.floor(e/s)*r;if(t.camera.setViewOffset(n*s,r*s,o,a,n,r),t.render(),this._antialias){const l=Math.round((o+n)/2)-Math.round(o/2),c=Math.round((a+r)/2)-Math.round(a/2);this._ctx.drawImage(t.renderer.domElement,Math.round(o/2),Math.round(a/2),l,c)}else this._ctx.drawImage(t.renderer.domElement,Math.floor(o),Math.floor(a),Math.ceil(n),Math.ceil(r));typeof this._onProgress=="function"&&this._onProgress(e+1,this._n,!1)}_finalize(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,typeof this._onFinish=="function"&&this._onFinish(this._n+1,this._n,!1)}render(){for(let e=0;e<=this._n;++e)e===this._n?this._finalize():this._renderTile(e)}renderAsync(){let e=0;const t=this._n,n=()=>{e===t?this._finalize():this._renderTile(e),e+=1};for(let r=0;r<=t;++r)setTimeout(n,0)}}const BM=2*Math.PI,FG=180/Math.PI;function zM(i,e,t=1,n=0,r){const s=r?r.length:i.length/t;let o=0,a=0;if(r)for(let l=0;l<s;++l){const c=(i[r[l]*t+n]+e)%e/e*BM-Math.PI;o+=Math.cos(c),a+=Math.sin(c)}else for(let l=n;l<s;l+=t){const c=(i[l]+e)%e/e*BM-Math.PI;o+=Math.cos(c),a+=Math.sin(c)}return o/=s,a/=s,(Math.atan2(a,o)+Math.PI)/BM*e}function ll(i,e,t,n=0){const r=i.length,s=t||new Float32Array(r);for(let o=0;o<r;o+=3)s[n+o+0]=(i[o+0]+e[o+0])/2,s[n+o+1]=(i[o+1]+e[o+1])/2,s[n+o+2]=(i[o+2]+e[o+2])/2;return s}function AS(i,e){const t=i.length,n=new Float32Array(t);for(let r=0;r<t;r+=3)n[r+0]=e[r+0]-i[r+0],n[r+1]=e[r+1]-i[r+1],n[r+2]=e[r+2]-i[r+2];return n}function Mo(i,e,t){const n=t||new Float32Array(i);for(let r=0;r<i;++r)n[r]=e;return n}function Bn(i,e,t,n,r){const s=r||new Float32Array(3*i);for(let o=0;o<i;++o){const a=3*o;s[a+0]=e,s[a+1]=t,s[a+2]=n}return s}function lm(i){const e=new Float32Array(i);for(let t=0;t<i;++t)e[t]=t;return e}function iC(i,e,t=0,n){const r=n||new Float32Array(i*e);for(let s=0;s<i;++s){const o=t+s*e;for(let a=0;a<e;++a)r[o+a]=s}return r}function GM(i,e){const t=i.length,n=new Float32Array(t*e);for(let r=0;r<t;++r){const s=r*e,o=i[r];for(let a=0;a<e;++a)n[s+a]=o}return n}function er(i,e,t,n,r){for(let s=0;s<r;++s)e[n+s]=i[t+s]}function Gk(i,e,t,n){er(i,i,e,t,n)}function fx(i){let e=-1/0;for(let t=0,n=i.length;t<n;++t)i[t]>e&&(e=i[t]);return e}function px(i){let e=1/0;for(let t=0,n=i.length;t<n;++t)i[t]<e&&(e=i[t]);return e}function BR(i,e=1,t=0){const n=i.length;let r=0;for(let s=t;s<n;s+=e)r+=i[s];return r}function mx(i,e=1,t=0){return BR(i,e,t)/(i.length/e)}const Wae={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0};function jae(i,e={}){const{trim:t,factor:n,antialias:r,transparent:s}=wo(e,Wae),o=i.renderer,a=i.camera,l=o.getClearAlpha(),c=o.getClearColor(new Ht);function u(f=!1){let m=n;r&&(m*=2),f&&(m=1/m),i.scene.traverse(function(_){const v=_.material;v&&v.linewidth&&(v.linewidth*=m),v&&v.uniforms&&v.uniforms.size&&v.uniforms.size.__seen===void 0&&(v.uniforms.size.value*=m,v.uniforms.size.__seen=!0),v&&v.uniforms&&v.uniforms.linewidth&&v.uniforms.linewidth.__seen===void 0&&(v.uniforms.linewidth.value*=m,v.uniforms.linewidth.__seen=!0)}),i.scene.traverse(function(_){const v=_.material;v&&v.uniforms&&v.uniforms.size&&delete v.uniforms.size.__seen,v&&v.uniforms&&v.uniforms.linewidth&&delete v.uniforms.linewidth.__seen})}function h(f){if(t){const m=c;return function(_,v,g,b,p){const y=_.height,A=_.width,w=_.getContext("2d").getImageData(0,0,A,y).data;let M,T,E,C;for(E=!1,T=0;T<y;T++){for(M=0;M<A;M++)if(C=4*(T*A+M),w[C]!==v||w[C+1]!==g||w[C+2]!==b||w[C+3]!==p){E=!0;break}if(E)break}const N=T;for(E=!1,M=0;M<A;M++){for(T=0;T<y;T++)if(C=4*(T*A+M),w[C]!==v||w[C+1]!==g||w[C+2]!==b||w[C+3]!==p){E=!0;break}if(E)break}const P=M;for(E=!1,T=y-1;T>=0;T--){for(M=A-1;M>=0;M--)if(C=4*(T*A+M),w[C]!==v||w[C+1]!==g||w[C+2]!==b||w[C+3]!==p){E=!0;break}if(E)break}const L=T;for(E=!1,M=A-1;M>=0;M--){for(T=y-1;T>=0;T--)if(C=4*(T*A+M),w[C]!==v||w[C+1]!==g||w[C+2]!==b||w[C+3]!==p){E=!0;break}if(E)break}const R=M,F=document.createElement("canvas");return F.width=R-P,F.height=L-N,F.getContext("2d").drawImage(_,P,N,F.width,F.height,0,0,F.width,F.height),F}(f,s?0:255*m.r,s?0:255*m.g,s?0:255*m.b,s?0:255)}return f}function d(f,m,_){typeof e.onProgress=="function"&&e.onProgress(f,m,_)}return new Promise(function(f,m){const _=new $ae(o,a,i,{factor:n,antialias:r,onProgress:d,onFinish:function(v,g){h(_.canvas).toBlob(function(b){o.setClearAlpha(l),u(!0),i.requestRender(),d(g,g,!0),b?f(b):m("error creating image")},"image/png")}});o.setClearAlpha(s?0:1),u(),_.renderAsync()})}const VM=new me,Vk=new Tt,Hk=new Tt,$k=new sn,cb=new Tt,ub=new Tt;function HM(i,e){cb.copy(e.projectionMatrix).invert(),ub.copy(e.projectionMatrix).transpose(),i.traverse(function(t){const n=t.material;if(!n)return;const r=n.uniforms;r&&(r.projectionMatrixInverse&&r.projectionMatrixInverse.value.copy(cb),r.projectionMatrixTranspose&&r.projectionMatrixTranspose.value.copy(ub))})}function Wk(i,e,t){const n=i.createShader(t);return n?(i.shaderSource(n,e),i.compileShader(n),i.getShaderParameter(n,i.COMPILE_STATUS)?n:(console.log(`error compiling shader ${n}: ${i.getShaderInfoLog(n)}`),i.deleteShader(n),null)):void console.log(`error creating WebGL shader ${t}`)}function $M(i,e){const t=i.getExtension(e);return t||console.log(`extension '${e}' not available`),t}const Xae=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function cy(i){const e=document.createElement("canvas");e.width=16,e.height=16,e.style.width="16px",e.style.height="16px";const t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return console.log(`error creating webgl context for ${i}`),!1;if(!(t instanceof WebGLRenderingContext))return console.log("Got unexpected type for WebGL rendering context"),!1;$M(t,"OES_texture_float"),$M(t,"OES_texture_half_float"),$M(t,"WEBGL_color_buffer_float");const n=Wk(t,`
attribute vec4 a_position;

void main() {
  gl_Position = a_position;
}`,t.VERTEX_SHADER),r=Wk(t,`
precision mediump float;
uniform vec4 u_color;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;
}`,t.FRAGMENT_SHADER);if(!n||!r)return!1;const s=function(m,_,v,g){const b=m.createProgram();return b?(_.forEach(p=>m.attachShader(b,p)),m.linkProgram(b),m.getProgramParameter(b,m.LINK_STATUS)?b:(console.log(`error linking program: ${m.getProgramInfoLog(b)}`),m.deleteProgram(b),null)):void console.log("error creating WebGL program")}(t,[n,r]);if(!s)return console.log("error creating WebGL program"),!1;t.useProgram(s);const o=t.getAttribLocation(s,"a_position"),a=t.getUniformLocation(s,"u_color");if(!a)return console.log("error getting 'u_color' uniform location"),!1;const l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,Xae,t.STATIC_DRAW),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0);const c=t.createTexture(),u=new Uint8Array([255,255,255,255]);t.bindTexture(t.TEXTURE_2D,c),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,u);const h=t.createTexture();t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,i,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const d=t.createFramebuffer();if(t.bindFramebuffer(t.FRAMEBUFFER,d),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,h,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)return console.log(`error creating framebuffer for ${i}`),!1;t.bindTexture(t.TEXTURE_2D,c),t.uniform4fv(a,[0,10,20,1]),t.drawArrays(t.TRIANGLES,0,6),t.bindTexture(t.TEXTURE_2D,h),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(1,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.uniform4fv(a,[0,.1,.05,1]),t.drawArrays(t.TRIANGLES,0,6);const f=new Uint8Array(4);if(t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,f),f[0]!==0||f[1]<248||f[2]<248||f[3]<254)return console.log(`not able to actually render to ${i} texture`),!1;if(i===t.FLOAT){t.bindFramebuffer(t.FRAMEBUFFER,d);const m=new Float32Array(4);t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,m);const _=t.getError();if(_)return console.log(`error reading pixels as float: '${function(v,g){switch(g){case v.NO_ERROR:return"no error";case v.INVALID_ENUM:return"invalid enum";case v.INVALID_VALUE:return"invalid value";case v.INVALID_OPERATION:return"invalid operation";case v.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case v.OUT_OF_MEMORY:return"out of memory";case v.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}(t,_)}'`),!1}return!0}const qae=new Float32Array(100),Yae=new Uint8Array(100),jk=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],uy=new Tt;function Kae(i,e,t,n,r){const s=r.uniforms,o=[];if(s&&(s.objectId&&(s.objectId.value=Ya?this.id:this.id/255,o.push("objectId")),(s.modelViewMatrixInverse||s.modelViewMatrixInverseTranspose||s.modelViewProjectionMatrix||s.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,this.matrixWorld),s.modelViewMatrixInverse&&(s.modelViewMatrixInverse.value.copy(this.modelViewMatrix).invert(),o.push("modelViewMatrixInverse")),s.modelViewMatrixInverseTranspose&&(s.modelViewMatrixInverse?s.modelViewMatrixInverseTranspose.value.copy(s.modelViewMatrixInverse.value).transpose():s.modelViewMatrixInverseTranspose.value.copy(this.modelViewMatrix).invert().transpose(),o.push("modelViewMatrixInverseTranspose")),s.modelViewProjectionMatrix&&(s.modelViewProjectionMatrix.value.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),o.push("modelViewProjectionMatrix")),s.modelViewProjectionMatrixInverse&&(s.modelViewProjectionMatrix?(uy.copy(s.modelViewProjectionMatrix.value),s.modelViewProjectionMatrixInverse.value.copy(uy.invert())):(uy.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),s.modelViewProjectionMatrixInverse.value.copy(uy.invert())),o.push("modelViewProjectionMatrixInverse")),o.length)){const a=i.properties.get(r);if(a.program){const l=i.getContext(),c=a.program;l.useProgram(c.program);const u=c.getUniforms();o.forEach(function(h){u.setValue(l,h,s[h].value)})}}}class Zae{constructor(e){if(this.boundingBox=new Ti,this.boundingBoxSize=new me,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new me,this.signals={ticked:new tn.Signal,rendered:new tn.Signal},typeof e=="string"){const t=document.getElementById(e);this.container=t===null?document.createElement("div"):t}else e instanceof HTMLElement?this.container=e:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{const t=this.container.getBoundingClientRect();this.width=t.width||1,this.height=t.height||1,this.container.style.overflow="hidden"}this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),this._initRenderer()!==!1?(this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)):tt.error("Viewer: could not initialize renderer")}_initParams(){this.parameters={fogColor:new Ht(0),fogNear:50,fogFar:100,backgroundColor:new Ht(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new Ht(14540253),lightIntensity:1.2,ambientColor:new Ht(14540253),ambientIntensity:.3,sampleLevel:0,outputColorSpace:"srgb-linear"}}_initCamera(){const e=new me(0,0,0),{width:t,height:n}=this;this.perspectiveCamera=new Hs(this.parameters.cameraFov,t/n),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(e),this.orthographicCamera=new Y0(t/-2,t/2,n/2,n/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(e),this.stereoCamera=new iae,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;const r=this.parameters.cameraType;if(r==="orthographic")this.camera=this.orthographicCamera;else{if(r!=="perspective"&&r!=="stereo")throw new Error(`Unknown cameraType '${r}'`);this.camera=this.perspectiveCamera}this.camera.updateProjectionMatrix()}_initStats(){this.stats=new Vae}_initScene(){this.scene||(this.scene=new xk,this.scene.name="scene"),this.rotationGroup=new Xn,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new Xn,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new Xn,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new Xn,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new Xn,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new Xn,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new PR(this.parameters.fogColor.getHex()),this.directionalLight=new tae(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.directionalLight),this.ambientLight=new nae(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)}_initRenderer(){const e=window.devicePixelRatio,{width:t,height:n}=this;try{this.renderer=new _G({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch{return this.wrapper.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',!1}this.renderer.setPixelRatio(e),this.renderer.setSize(t,n),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.outputColorSpace=this.parameters.outputColorSpace,this.renderer.useLegacyLights=!0;const r=this.renderer.getContext();this.renderer.capabilities.isWebGL2?(Bk(!0),Ok(this.renderer.extensions.get("EXT_color_buffer_float")),this.supportsHalfFloat=!0):(Bk(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),Ok(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&cy(r.FLOAT)),this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&cy(36193)),this.wrapper.appendChild(this.renderer.domElement);const s=t*e,o=n*e;pt&&console.log(JSON.stringify({Browser:CG,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":cy(r.FLOAT),"testTextureSupport HalfFloat":cy(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:Ya},null,2)),this.pickingTarget=new ol(s,o,{minFilter:Zn,magFilter:Zn,stencilBuffer:!1,format:Ws,type:Ya?Ca:La}),this.pickingTarget.texture.generateMipmaps=!1,this.pickingTarget.texture.colorSpace=this.parameters.outputColorSpace,this.renderer.setRenderTarget(this.pickingTarget),this.renderer.clear(),this.renderer.setRenderTarget(null),this.sampleTarget=new ol(s,o,{minFilter:es,magFilter:es,format:Ws,type:this.supportsHalfFloat?ld:Ya?Ca:La}),this.sampleTarget.texture.colorSpace=this.parameters.outputColorSpace,this.holdTarget=new ol(s,o,{minFilter:Zn,magFilter:Zn,format:Ws,type:this.supportsHalfFloat?ld:Ya?Ca:La}),this.holdTarget.texture.colorSpace=this.parameters.outputColorSpace,this.compositeUniforms={tForeground:new lb(this.sampleTarget.texture),scale:new lb(1)},this.compositeMaterial=new Yo({uniforms:this.compositeUniforms,vertexShader:Pg("Quad.vert"),fragmentShader:Pg("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:zT,depthTest:!1,depthWrite:!1}),this.compositeCamera=new Y0(-1,1,1,-1,0,1),this.compositeScene=new xk,this.compositeScene.name="compositeScene",this.compositeScene.add(new el(new xS(2,2),this.compositeMaterial))}_initHelper(){const e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),t=new Float32Array(24),n=new nr;n.setIndex(new Hi(e,1)),n.setAttribute("position",new Hi(t,3));const r=new Yo({uniforms:{uColor:{value:new Ht("skyblue")}},vertexShader:Pg("BasicLine.vert"),fragmentShader:Pg("BasicLine.frag")});this.boundingBoxMesh=new QT(n,r),this.helperGroup.add(this.boundingBoxMesh)}updateHelper(){const e=this.boundingBoxMesh.geometry.attributes.position,t=e.array,{min:n,max:r}=this.boundingBox;t[0]=r.x,t[1]=r.y,t[2]=r.z,t[3]=n.x,t[4]=r.y,t[5]=r.z,t[6]=n.x,t[7]=n.y,t[8]=r.z,t[9]=r.x,t[10]=n.y,t[11]=r.z,t[12]=r.x,t[13]=r.y,t[14]=n.z,t[15]=n.x,t[16]=r.y,t[17]=n.z,t[18]=n.x,t[19]=n.y,t[20]=n.z,t[21]=r.x,t[22]=n.y,t[23]=n.z,e.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()}get cameraDistance(){return Math.abs(this.camera.position.z)}set cameraDistance(e){this.camera.position.z=-e}add(e,t){t?t.forEach(n=>this.addBuffer(e,n)):this.addBuffer(e),e.group.name="meshGroup",e.wireframeGroup.name="wireframeGroup",e.parameters.background?(this.backgroundGroup.add(e.group),this.backgroundGroup.add(e.wireframeGroup)):(this.modelGroup.add(e.group),this.modelGroup.add(e.wireframeGroup)),e.pickable&&this.pickingGroup.add(e.pickingGroup),pt&&this.updateHelper()}addBuffer(e,t){function n(o){o instanceof Xn?o.children.forEach(n):(o.userData.buffer=e,o.userData.instance=t,o.onBeforeRender=Kae)}const r=e.getMesh();t&&r.applyMatrix4(t.matrix),n(r),e.group.add(r);const s=e.getWireframeMesh();if(t&&(s.matrix.copy(r.matrix),s.position.copy(r.position),s.quaternion.copy(r.quaternion),s.scale.copy(r.scale)),n(s),e.wireframeGroup.add(s),e.pickable){const o=e.getPickingMesh();t&&(o.matrix.copy(r.matrix),o.position.copy(r.position),o.quaternion.copy(r.quaternion),o.scale.copy(r.scale)),n(o),e.pickingGroup.add(o)}t?this._updateBoundingBox(e.geometry,e.matrix,t.matrix):this._updateBoundingBox(e.geometry,e.matrix)}remove(e){this.translationGroup.children.forEach(function(t){t.remove(e.group),t.remove(e.wireframeGroup)}),e.pickable&&this.pickingGroup.remove(e.pickingGroup),this.updateBoundingBox(),pt&&this.updateHelper()}_updateBoundingBox(e,t,n){const r=this.boundingBox;function s(a,l,c){a.boundingBox==null&&a.computeBoundingBox();const u=a.boundingBox.clone();l&&u.applyMatrix4(l),c&&u.applyMatrix4(c),u.min.equals(u.max)&&u.expandByScalar(5),r.union(u)}function o(a){if(a.geometry!==void 0){let l,c;a.userData.buffer&&(l=a.userData.buffer.matrix),a.userData.instance&&(c=a.userData.instance.matrix),s(a.geometry,l,c)}}e?s(e,t,n):(r.makeEmpty(),this.modelGroup.traverse(o),this.backgroundGroup.traverse(o)),r.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()}updateBoundingBox(){this._updateBoundingBox(),pt&&this.updateHelper()}getPickingPixels(){const{width:e,height:t}=this,n=e*t*4,r=Ya?new Float32Array(n):new Uint8Array(n);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,e,t,r),r}getImage(e){return new Promise(t=>{if(e){const{width:n,height:r}=this,s=n*r*4;let o=this.getPickingPixels();if(Ya){const u=new Uint8Array(s);for(let h=0;h<s;++h)u[h]=Math.round(255*o[h]);o=u}const a=document.createElement("canvas");a.width=n,a.height=r;const l=a.getContext("2d"),c=l.getImageData(0,0,n,r);c.data.set(o),l.putImageData(c,0,0),a.toBlob(t,"image/png")}else this.renderer.domElement.toBlob(t,"image/png")})}makeImage(e={}){return jae(this,e)}setLight(e,t,n,r){const s=this.parameters;e!==void 0&&s.lightColor.set(e),t!==void 0&&(s.lightIntensity=t),n!==void 0&&s.ambientColor.set(n),r!==void 0&&(s.ambientIntensity=r),this.requestRender()}setFog(e,t,n){const r=this.parameters;e!==void 0&&r.fogColor.set(e),t!==void 0&&(r.fogNear=t),n!==void 0&&(r.fogFar=n),this.requestRender()}setBackground(e){const t=this.parameters;e&&t.backgroundColor.set(e),this.setFog(t.backgroundColor),this.renderer.setClearColor(t.backgroundColor,0),this.renderer.domElement.style.backgroundColor=t.backgroundColor.getStyle(),this.requestRender()}setSampling(e){e!==void 0&&(this.parameters.sampleLevel=e,this.sampleLevel=e),this.requestRender()}setOutputEncoding(e){this.parameters.outputColorSpace=e,this.renderer.outputColorSpace=e,this.pickingTarget.texture.colorSpace=e,this.sampleTarget.texture.colorSpace=e,this.holdTarget.texture.colorSpace=e}setColorWorkflow(e){if(e!="srgb-linear"&&e!="srgb")throw new Error(`setColorWorkflow: invalid color workflow ${e}`);AG=e=="srgb-linear"?"linear":"sRGB",this.setOutputEncoding(e=="srgb-linear"?"srgb":"srgb-linear"),this.requestRender()}setCamera(e,t,n){const r=this.parameters;if(e&&(r.cameraType=e),t&&(r.cameraFov=t),n&&(r.cameraEyeSep=n),r.cameraType==="orthographic")this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else{if(r.cameraType!=="perspective"&&r.cameraType!=="stereo")throw new Error(`Unknown cameraType '${r.cameraType}'`);this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up))}this.perspectiveCamera.fov=r.cameraFov,this.stereoCamera.eyeSep=r.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()}setClip(e,t,n,r,s){const o=this.parameters;e!==void 0&&(o.clipNear=e),t!==void 0&&(o.clipFar=t),n!==void 0&&(o.clipDist=n),r!==void 0&&(o.clipMode=r),s!==void 0&&(o.clipScale=s),this.requestRender()}setSize(e,t){this.width=e||1,this.height=t||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();const n=window.devicePixelRatio;this.renderer.setPixelRatio(n),this.renderer.setSize(e,t);const r=this.width*n,s=this.height*n;this.pickingTarget.setSize(r,s),this.sampleTarget.setSize(r,s),this.holdTarget.setSize(r,s),this.requestRender()}handleResize(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{const e=this.container.getBoundingClientRect();this.setSize(e.width,e.height)}}updateInfo(e){const{memory:t,render:n}=this.info;if(e)t.programs=0,t.geometries=0,t.textures=0,n.calls=0,n.vertices=0,n.points=0;else{const r=this.renderer.info,s=r.memory,o=r.render;t.geometries=s.geometries,t.textures=s.textures,n.calls+=o.calls,n.faces+=o.triangles,n.points+=o.points}}animate(){if(this.signals.ticked.dispatch(this.stats),window.performance.now()-this.stats.startTime>500&&!this.isStill&&this.sampleLevel<3&&this.sampleLevel!==-1){const e=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=e,pt&&tt.log("rendered still frame")}this.frameRequest=window.requestAnimationFrame(this.animate)}pick(e,t){if(this.parameters.cameraType==="stereo")return{pid:0,instance:void 0,picker:void 0};e*=window.devicePixelRatio,t*=window.devicePixelRatio,e=Math.max(e-2,0),t=Math.max(t-2,0);let n,r,s=0;const o=Ya?qae:Yae;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,e,t,5,5,o);for(let a=0;a<jk.length;a++){const l=4*jk[a],c=Math.round(o[l+3]),u=this.pickingGroup.getObjectById(c);u&&(n=u.userData.instance,r=u.userData.buffer.picking,s=Ya?Math.round(255*o[l])<<16&16711680|Math.round(255*o[l+1])<<8&65280|255&Math.round(255*o[l+2]):o[l]<<16|o[l+1]<<8|o[l+2])}return{pid:s,instance:n,picker:r}}requestRender(){this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame(()=>{this.render(),this.stats.update()}))}updateZoom(){const e=wi(this.perspectiveCamera.fov),t=2*Math.tan(e/2)*this.cameraDistance;this.orthographicCamera.zoom=this.height/t}absoluteToRelative(e){return 50*(1-e/this.bRadius)}relativeToAbsolute(e){return this.bRadius*(1-e/50)}__updateClipping(){const e=this.parameters;this.bRadius=Math.max(10,.5*this.boundingBoxLength),isFinite(this.bRadius)||(this.bRadius=50),this.camera.getWorldPosition(this.distVector),this.cDist=this.distVector.length(),this.cDist||(this.cameraDistance=Math.abs(e.cameraZ),this.cDist=Math.abs(e.cameraZ));const t=this.scene.fog;if(t.color.set(e.fogColor),e.clipMode==="camera")this.camera.near=e.clipNear,this.camera.far=e.clipFar,t.near=e.fogNear,t.far=e.fogFar;else if(e.clipScale==="absolute")this.camera.near=this.cDist-e.clipNear,this.camera.far=this.cDist+e.clipFar,t.near=this.cDist-e.fogNear,t.far=this.cDist+e.fogFar;else{const n=(50-e.clipNear)/50,r=-(50-e.clipFar)/50;this.camera.near=this.cDist-this.bRadius*n,this.camera.far=this.cDist+this.bRadius*r;const s=(50-e.fogNear)/50,o=-(50-e.fogFar)/50;t.near=this.cDist-this.bRadius*s,t.far=this.cDist+this.bRadius*o}e.clipMode!=="camera"&&(this.camera.type==="PerspectiveCamera"?(this.camera.near=Math.max(.1,e.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),t.near=Math.max(.1,t.near),t.far=Math.max(1,t.far)):this.camera.type==="OrthographicCamera"&&e.clipDist>0&&(this.camera.near=Math.max(e.clipDist,this.camera.near)))}__updateCamera(){const e=this.camera;e.updateMatrix(),e.updateMatrixWorld(!0),e.updateProjectionMatrix(),function(t,n,r,s,o){let a=new sn;r.getSize(a);const l=a.height,c=r.getPixelRatio(),u=n.type==="OrthographicCamera";$k.set(a.width,a.height),cb.copy(n.projectionMatrix).invert(),ub.copy(n.projectionMatrix).transpose(),t.traverse(function(h){const d=h.material;if(!d)return;const f=d.uniforms;if(f){if(d.clipNear){const m=(50-d.clipNear)/50,_=s-o*m;f.clipNear.value=_}f.canvasHeight&&(f.canvasHeight.value=l),f.resolution&&f.resolution.value.copy($k),f.pixelRatio&&(f.pixelRatio.value=c),f.projectionMatrixInverse&&f.projectionMatrixInverse.value.copy(cb),f.projectionMatrixTranspose&&f.projectionMatrixTranspose.value.copy(ub),f.ortho&&(f.ortho.value=u)}})}(this.scene,e,this.renderer,this.cDist,this.bRadius),function(t,n){t.traverseVisible(function(r){if(!(r instanceof yG&&r.userData.buffer.parameters.sortParticles))return;const s=r.geometry.attributes,o=s.position.count;if(o===0)return;let a,l,c,u,h,d,f,m;Vk.multiplyMatrices(n.matrixWorldInverse,r.matrixWorld),Hk.multiplyMatrices(n.projectionMatrix,Vk),r.userData.sortData?(a=r.userData.sortData,c=a.__zArray,l=a.__sortArray,u=a.__cmpFn):(c=new Float32Array(o),l=new Uint32Array(o),u=function(_,v){const g=c[_],b=c[v];return g>b?1:g<b?-1:0},a={__zArray:c,__sortArray:l,__cmpFn:u},r.userData.sortData=a);for(let _=0;_<o;++_)VM.fromArray(s.position.array,3*_),VM.applyMatrix4(Hk),c[_]=-VM.z,l[_]=_;(function(_,v,g=0,b){v=v||function(N,P){return N>P?1:N<P?-1:0};const p=[];let y,A,w,M=-1,T=g,E=b=(b||_.length)-1;function C(N,P){const L=_[N];_[N]=_[P],_[P]=L}for(;;)if(E-T<=25){for(let N=T+1;N<=E;++N){for(y=_[N],A=N-1;A>=T&&v(_[A],y)>0;)_[A+1]=_[A],--A;_[A+1]=y}if(M===-1)break;E=p[M--],T=p[M--]}else{for(A=T+1,w=E,C(T+E>>1,A),v(_[T],_[E])>0&&C(T,E),v(_[A],_[E])>0&&C(A,E),v(_[T],_[A])>0&&C(T,A),y=_[A];;){do A++;while(v(_[A],y)<0);do w--;while(v(_[w],y)>0);if(w<A)break;C(A,w)}_[T+1]=_[w],_[w]=y,E-A+1>=w-T?(p[++M]=A,p[++M]=E,E=w-1):(p[++M]=T,p[++M]=w-1,T=A)}})(l,u);for(let _ in s){const v=s[_],g=v.array,b=v.itemSize;a[_]||(a[_]=new Float32Array(b*o)),m=a[_],a[_]=g;for(let p=0;p<o;++p){h=l[p];for(let y=0;y<b;++y)d=h*b+y,f=p*b+y,m[f]=g[d]}s[_].array=m,s[_].needsUpdate=!0}})}(this.scene,e)}__setVisibility(e,t,n,r){this.modelGroup.visible=e,this.pickingGroup.visible=t,this.backgroundGroup.visible=n,this.helperGroup.visible=r}__updateLights(){this.directionalLight.color.set(this.parameters.lightColor),this.directionalLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(100*this.boundingBoxLength),this.directionalLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity}__renderPickingGroup(e){this.renderer.setRenderTarget(this.pickingTarget||null),this.renderer.clear(),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderModelGroup(e,t){this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,e),this.renderer.clear(!1,!0,!0),this.updateInfo(),this.__setVisibility(!0,!1,!1,pt),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderSuperSample(e,t){const n=NG[Math.max(0,Math.min(this.sampleLevel,5))],r=1/n.length;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;let s=this.sampleTarget.width;const o=this.sampleTarget.height;this.parameters.cameraType==="stereo"&&(s/=2);for(let a=0;a<n.length;++a){const l=n[a];e.setViewOffset(s,o,l[0],l[1],s,o),e.updateProjectionMatrix(),HM(this.scene,e);let c=r;c+=.03125*((a+.5)/n.length-.5),this.compositeUniforms.scale.value=c,this.__renderModelGroup(e,this.sampleTarget),this.renderer.setRenderTarget(this.holdTarget),a===0&&this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,e.clearViewOffset(),this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}__renderStereo(e=!1,t){const n=this.stereoCamera;n.update(this.perspectiveCamera);const r=this.renderer;let s=new sn;r.getSize(s),r.setScissorTest(!0),r.setScissor(0,0,s.width/2,s.height),r.setViewport(0,0,s.width/2,s.height),HM(this.scene,n.cameraL),this.__render(e,n.cameraL),r.setScissor(s.width/2,0,s.width/2,s.height),r.setViewport(s.width/2,0,s.width/2,s.height),HM(this.scene,n.cameraR),this.__render(e,n.cameraR),r.setScissorTest(!1),r.setViewport(0,0,s.width,s.height)}__render(e=!1,t,n){e?this.lastRenderedPicking||this.__renderPickingGroup(t):this.sampleLevel>0&&this.parameters.cameraType!=="stereo"?this.__renderSuperSample(t,n):this.__renderModelGroup(t,n)}render(e=!1,t){if(this.rendering)tt.warn("'tried to call 'render' from within 'render'");else{this.rendering=!0;try{this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),this.parameters.cameraType==="stereo"?this.__renderStereo(e,t):this.__render(e,this.camera,t),this.lastRenderedPicking=e}finally{this.rendering=!1,this.renderPending=!1}this.signals.rendered.dispatch()}}clear(){tt.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()}dispose(){this.renderer.dispose(),window.cancelAnimationFrame(this.frameRequest)}}function Xk(i){const e=i.touches[0].pageX-i.touches[1].pageX,t=i.touches[0].pageY-i.touches[1].pageY;return Math.sqrt(e*e+t*t)}class Qae{constructor(e,t={}){this.domElement=e,this.signals={moved:new tn.Signal,scrolled:new tn.Signal,dragged:new tn.Signal,dropped:new tn.Signal,clicked:new tn.Signal,hovered:new tn.Signal,doubleClicked:new tn.Signal},this.position=new sn,this.prevPosition=new sn,this.down=new sn,this.canvasPosition=new sn,this.prevClickCP=new sn,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=he(t.hoverTimeout,50),this.handleScroll=he(t.handleScroll,!0),this.doubleClickSpeed=he(t.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();const n={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,n),document.addEventListener("wheel",this._onMousewheel,n),document.addEventListener("MozMousePixelScroll",this._onMousewheel,n),document.addEventListener("mousemove",this._onMousemove,n),document.addEventListener("mousedown",this._onMousedown,n),document.addEventListener("mouseup",this._onMouseup,n),document.addEventListener("contextmenu",this._onContextmenu,n),document.addEventListener("touchstart",this._onTouchstart,n),document.addEventListener("touchend",this._onTouchend,n),document.addEventListener("touchmove",this._onTouchmove,n)}get key(){let e=0;return this.altKey&&(e+=1),this.ctrlKey&&(e+=2),this.metaKey&&(e+=4),this.shiftKey&&(e+=8),e}setParameters(e={}){this.hoverTimeout=he(e.hoverTimeout,this.hoverTimeout)}_listen(){const e=window.performance.now(),t=this.canvasPosition;this.doubleClickPending&&e-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),e-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,this.hoverTimeout!==-1&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(t.x,t.y))),this.frameRequest=window.requestAnimationFrame(this._listen)}_onMousewheel(e){if(e.target!==this.domElement||!this.handleScroll)return;e.preventDefault(),this._setKeys(e);let t=0;"deltaY"in e&&"deltaMode"in e&&e.deltaY!==void 0&&e.deltaMode!==void 0?t=e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?.025*-e.deltaY:e.deltaMode===WheelEvent.DOM_DELTA_LINE?-e.deltaY*(2.5/3):2.5*-e.deltaY:"deltaY"in e&&!("detail"in e)?t=.025*-e.deltaY:e.wheelDelta!==void 0?t=.025*-e.wheelDelta:e.wheelDeltaY!==void 0?t=.025*-e.wheelDeltaY:e.detail!==void 0&&(t=-e.detail/3),this.signals.scrolled.dispatch(t),setTimeout(()=>{this.scrolled=!0},this.hoverTimeout)}_onMousemove(e){e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(e),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.clientX,e.clientY),this._setCanvasPosition(e);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n)}_onMousedown(e){e.target===this.domElement&&(e.preventDefault(),this._setKeys(e),this.moving=!1,this.hovering=!1,this.down.set(e.clientX,e.clientY),this.position.set(e.clientX,e.clientY),this.which=e.which,this.buttons=function(t){if(typeof t=="object"){if("buttons"in t)return t.buttons;if("which"in t){const n=t.which;if(n===2)return 4;if(n===3)return 2;if(n>0)return 1<<n-1}else if("button"in t){const n=t.button;if(n===1)return 4;if(n===2)return 2;if(n>=0)return 1<<n}}return 0}(e),this.pressed=!0,this._setCanvasPosition(e))}_onMouseup(e){e.target===this.domElement&&e.preventDefault(),this._setKeys(e);const t=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(t)<4&&(this.signals.doubleClicked.dispatch(t.x,t.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(t.x,t.y),this.doubleClickPending=!0,this.prevClickCP.copy(t)),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onContextmenu(e){e.target===this.domElement&&e.preventDefault()}_onTouchstart(e){if(e.target===this.domElement)switch(e.preventDefault(),this.pressed=!0,e.touches.length){case 1:this.moving=!1,this.hovering=!1,this.down.set(e.touches[0].pageX,e.touches[0].pageY),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);break;case 2:this.down.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.lastTouchDistance=Xk(e)}}_onTouchend(e){e.target===this.domElement&&e.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onTouchmove(e){switch(e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,e.touches.length){case 1:{this._setKeys(e),this.which=1,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n);break}case 2:{const t=Xk(e),n=t-this.lastTouchDistance;if(this.lastTouchDistance=t,this.prevPosition.copy(this.position),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),Math.abs(n)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(n/2);else{this.which=3,this.buttons=2;const r=this.prevPosition.x-this.position.x,s=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(r,s),this.pressed&&this.signals.dragged.dispatch(r,s)}}}}_distance(){return this.position.distanceTo(this.down)}_setCanvasPosition(e){const t=this.domElement.getBoundingClientRect();let n,r;"clientX"in e&&"clientY"in e?(n=e.clientX-t.left,r=e.clientY-t.top):(n=e.offsetX,r=e.offsetY),this.canvasPosition.set(n,t.height-r)}_setKeys(e){this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.metaKey=e.metaKey,this.shiftKey=e.shiftKey}dispose(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove),window.cancelAnimationFrame(this.frameRequest)}}const WM=new Tt,jM=new Tt,qk=new Tt,po=new Tt,Yk=new Tt,Oo=new me,cg=new Cs,Kk=new Cs,Vc=new Tt,fh=new me,hy=new me;class Jae{constructor(e,t={}){this.stage=e,this.rotateSpeed=he(t.rotateSpeed,2),this.zoomSpeed=he(t.zoomSpeed,1.2),this.panSpeed=he(t.panSpeed,1),this.viewer=e.viewer,this.mouse=e.mouseObserver,this.controls=e.viewerControls}get component(){return this.stage.transformComponent}get atom(){return this.stage.transformAtom}_setPanVector(e,t,n=0){const r=this.controls.getCanvasScaleFactor(n);fh.set(e,t,0),fh.multiplyScalar(this.panSpeed*r)}_getRotateXY(e,t){return[this.rotateSpeed*-e*.01,this.rotateSpeed*t*.01]}_getCameraRotation(e){return e.extractRotation(this.viewer.camera.matrixWorld),e.multiply(jM.makeRotationY(Math.PI)),e}_transformPanVector(){this.component&&(Vc.extractRotation(this.component.transform),Vc.premultiply(this.viewer.rotationGroup.matrix),Vc.invert(),Vc.multiply(this._getCameraRotation(po)),fh.applyMatrix4(Vc))}zoom(e){this.controls.zoom(this.zoomSpeed*e*.02)}pan(e,t){this._setPanVector(e,t),Vc.copy(this.viewer.rotationGroup.matrix).invert(),Vc.multiply(this._getCameraRotation(po)),fh.applyMatrix4(Vc),this.controls.translate(fh)}panComponent(e,t){this.component&&(this._setPanVector(e,t),this._transformPanVector(),this.component.position.add(fh),this.component.updateMatrix())}panAtom(e,t){this.atom&&this.component&&(this.atom.positionToVector3(hy),hy.add(this.viewer.translationGroup.position),hy.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(e,t,hy.z),this._transformPanVector(),this.atom.positionAdd(fh),this.component.updateRepresentations({position:!0}))}rotate(e,t){const[n,r]=this._getRotateXY(e,t);this._getCameraRotation(po),Oo.set(1,0,0),Oo.applyMatrix4(po),cg.setFromAxisAngle(Oo,r),Oo.set(0,1,0),Oo.applyMatrix4(po),Kk.setFromAxisAngle(Oo,n),cg.multiply(Kk),po.makeRotationFromQuaternion(cg),this.controls.applyMatrix(po)}zRotate(e,t){const n=this.rotateSpeed*((-e+t)/-2)*.01;qk.makeRotationZ(n),this.controls.applyMatrix(qk)}rotateComponent(e,t){if(!this.component)return;const[n,r]=this._getRotateXY(e,t);this._getCameraRotation(Yk),po.extractRotation(this.component.transform),po.premultiply(this.viewer.rotationGroup.matrix),po.invert(),po.premultiply(Yk),Oo.set(1,0,0),Oo.applyMatrix4(po),WM.makeRotationAxis(Oo,r),Oo.set(0,1,0),Oo.applyMatrix4(po),jM.makeRotationAxis(Oo,n),WM.multiply(jM),cg.setFromRotationMatrix(WM),this.component.quaternion.premultiply(cg),this.component.quaternion.normalize(),this.component.updateMatrix()}}const Rf=new me;class ele{constructor(e,t){this.stage=t,this.pid=e.pid,this.picker=e.picker,this.instance=e.instance,this.stage=t,this.controls=t.viewerControls,this.mouse=t.mouseObserver}get type(){return this.picker.type}get altKey(){return this.mouse.altKey}get ctrlKey(){return this.mouse.ctrlKey}get metaKey(){return this.mouse.metaKey}get shiftKey(){return this.mouse.shiftKey}get canvasPosition(){return this.mouse.canvasPosition}get component(){return this.stage.getComponentsByObject(this.picker.data).list[0]}get object(){return this.picker.getObject(this.pid)}get position(){return this.picker.getPosition(this.pid,this.instance,this.component)}get closestBondAtom(){if(this.type!=="bond"||!this.bond)return;const e=this.bond,t=this.controls,n=this.canvasPosition,r=e.atom1.positionToVector3(),s=e.atom2.positionToVector3();r.applyMatrix4(this.component.matrix),s.applyMatrix4(this.component.matrix);const o=t.getPositionOnCanvas(r),a=t.getPositionOnCanvas(s);return c=o,u=a,(l=n).distanceTo(c)<l.distanceTo(u)?e.atom1:e.atom2;var l,c,u}get closeAtom(){const e=this.canvasPosition,t=this.closestBondAtom;if(!t)return;const n=t.positionToVector3().applyMatrix4(this.component.matrix),r=this.controls.getPositionOnCanvas(n);t.positionToVector3(Rf),this.instance&&Rf.applyMatrix4(this.instance.matrix),Rf.applyMatrix4(this.component.matrix);const s=this.controls.viewer;Rf.add(s.translationGroup.position),Rf.applyMatrix4(s.rotationGroup.matrix);const o=this.controls.getCanvasScaleFactor(Rf.z),a=this.component.getMaxRepresentationRadius(t.index);return e.distanceTo(r)<=a/o?t:void 0}get arrow(){return this._objectIfType("arrow")}get atom(){return this._objectIfType("atom")}get axes(){return this._objectIfType("axes")}get bond(){return this._objectIfType("bond")}get box(){return this._objectIfType("box")}get cone(){return this._objectIfType("cone")}get clash(){return this._objectIfType("clash")}get contact(){return this._objectIfType("contact")}get cylinder(){return this._objectIfType("cylinder")}get distance(){return this._objectIfType("distance")}get ellipsoid(){return this._objectIfType("ellipsoid")}get octahedron(){return this._objectIfType("octahedron")}get point(){return this._objectIfType("point")}get mesh(){return this._objectIfType("mesh")}get slice(){return this._objectIfType("slice")}get sphere(){return this._objectIfType("sphere")}get tetrahedron(){return this._objectIfType("tetrahedron")}get torus(){return this._objectIfType("torus")}get surface(){return this._objectIfType("surface")}get unitcell(){return this._objectIfType("unitcell")}get unknown(){return this._objectIfType("unknown")}get volume(){return this._objectIfType("volume")}get wideline(){return this._objectIfType("wideline")}_objectIfType(e){return this.type===e?this.object:void 0}getLabel(){const e=this.atom||this.closeAtom;let t="nothing";return this.arrow?t=this.arrow.name:e?t=`atom: ${e.qualifiedName()} (${e.structure.name})`:this.axes?t="axes":this.bond?t=`bond: ${this.bond.atom1.qualifiedName()} - ${this.bond.atom2.qualifiedName()} (${this.bond.structure.name})`:this.box?t=this.box.name:this.cone?t=this.cone.name:this.clash?t=`clash: ${this.clash.clash.sele1} - ${this.clash.clash.sele2}`:this.contact?t=`${this.contact.type}: ${this.contact.atom1.qualifiedName()} - ${this.contact.atom2.qualifiedName()} (${this.contact.atom1.structure.name})`:this.cylinder?t=this.cylinder.name:this.distance?t=`distance: ${this.distance.atom1.qualifiedName()} - ${this.distance.atom2.qualifiedName()} (${this.distance.structure.name})`:this.ellipsoid?t=this.ellipsoid.name:this.octahedron?t=this.octahedron.name:this.point?t=this.point.name:this.mesh?t=`mesh: ${this.mesh.name||this.mesh.serial} (${this.mesh.shape.name})`:this.slice?t=`slice: ${this.slice.value.toPrecision(3)} (${this.slice.volume.name})`:this.sphere?t=this.sphere.name:this.surface?t=`surface: ${this.surface.surface.name}`:this.tetrahedron?t=this.tetrahedron.name:this.torus?t=this.torus.name:this.unitcell?t=`unitcell: ${this.unitcell.unitcell.spacegroup} (${this.unitcell.structure.name})`:this.unknown?t="unknown":this.volume?t=`volume: ${this.volume.value.toPrecision(3)} (${this.volume.volume.name})`:this.wideline&&(t=this.wideline.name),t}}class tle{constructor(e){this.stage=e,this.viewer=e.viewer}pick(e,t){const n=this.viewer.pick(e,t);if(n.picker&&n.picker.type!=="ignore"&&n.pid!==void 0){const r=n.picker.array;if(!(r&&n.pid>=r.length))return new ele(n,this.stage);console.error("pid >= picker.array.length")}}}const Zk=new Cs,Qk=new me,Jk=new me,XM=new me,nle=new me,e4=new Tt,t4=new me,n4=new Tt;class ile{constructor(e){this.stage=e,this.signals={changed:new tn.Signal},this.viewer=e.viewer}get position(){return this.viewer.translationGroup.position}get rotation(){return this.viewer.rotationGroup.quaternion}changed(){this.viewer.requestRender(),this.signals.changed.dispatch()}getPositionOnCanvas(e,t){const n=MS(t,sn),r=this.viewer;return XM.copy(e).add(r.translationGroup.position).applyMatrix4(r.rotationGroup.matrix).project(r.camera),n.set((XM.x+1)*r.width/2,(XM.y+1)*r.height/2)}getCanvasScaleFactor(e=0){const t=this.viewer.camera;if(t instanceof Y0)return 1/t.zoom;{e=Math.abs(e),e+=this.getCameraDistance();const n=wi(t.fov);return 2*e*Math.tan(n/2)/this.viewer.height}}getOrientation(e){const t=Cg(e);t.copy(this.viewer.rotationGroup.matrix);const n=this.getCameraDistance();return t.scale(nle.set(n,n,n)),t.setPosition(this.viewer.translationGroup.position),t}orient(e){Cg(e).decompose(Qk,Zk,Jk);const t=this.viewer;t.rotationGroup.setRotationFromQuaternion(Zk),t.translationGroup.position.copy(Qk),t.cameraDistance=Jk.z,t.updateZoom(),this.changed()}translate(e){this.viewer.translationGroup.position.add(Kh(e)),this.changed()}center(e){this.viewer.translationGroup.position.copy(Kh(e)).negate(),this.changed()}zoom(e){this.distance(this.getCameraDistance()*(1-e))}getCameraDistance(){return this.viewer.cameraDistance}distance(e){this.viewer.cameraDistance=Math.max(Math.abs(e),.2),this.viewer.updateZoom(),this.changed()}spin(e,t){e4.copy(this.viewer.rotationGroup.matrix).invert(),t4.copy(Kh(e)).applyMatrix4(e4),this.viewer.rotationGroup.rotateOnAxis(t4,t),this.changed()}rotate(e){this.viewer.rotationGroup.setRotationFromQuaternion(tC(e)),this.changed()}align(e){n4.copy(Cg(e)).invert(),this.viewer.rotationGroup.setRotationFromMatrix(n4),this.changed()}applyMatrix(e){this.viewer.rotationGroup.applyMatrix4(Cg(e)),this.changed()}}class bd{constructor(e,t,...n){this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=he(e,1e3),this.controls=t,this.startTime=window.performance.now(),this._init(...n)}get done(){return this.alpha===1}get paused(){return this._paused}tick(e){if(!this._paused)return this.elapsedDuration=e.currentTime-this.startTime-this.pausedDuration,this.duration===0?this.alpha=1:this.alpha=A1(0,1,this.elapsedDuration/this.duration),this._tick(e),this.done&&this._resolveList.forEach(t=>t()),this.done}pause(e){e&&(this._hold=!0),this.pausedTime===-1&&(this.pausedTime=window.performance.now()),this._paused=!0}resume(e){!e&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)}toggle(){this._paused?this.resume():this.pause()}then(e){let t;return t=this.done?Promise.resolve():new Promise(n=>this._resolveList.push(n)),t.then(e)}}class i4 extends bd{constructor(e,t,...n){super(he(e,1/0),t,...n)}_init(e,t){Array.isArray(e)?this.axis=new me().fromArray(e):this.axis=he(e,new me(0,1,0)),this.angle=he(t,.01)}_tick(e){this.axis&&this.angle&&this.controls.spin(this.axis,this.angle*e.lastDuration/16)}}class r4 extends bd{constructor(e,t,...n){super(he(e,1/0),t,...n),this.angleSum=0,this.direction=1}_init(e,t,n){Array.isArray(e)?this.axis=new me().fromArray(e):this.axis=he(e,new me(0,1,0)),this.angleStep=he(t,.01),this.angleEnd=he(n,.2)}_tick(e){if(!this.axis||!this.angleStep||!this.angleEnd)return;const t=A1(0,1,Math.abs(this.angleSum)/this.angleEnd),n=this.angleStep*this.direction*(1.1-t);this.controls.spin(this.axis,n*e.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}}class s4 extends bd{_init(e,t){this.moveFrom=Kh(he(e,new me)),this.moveTo=Kh(he(t,new me))}_tick(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()}}class rle extends bd{_init(e,t){this.zoomFrom=e,this.zoomTo=t}_tick(){this.controls.distance(Vo(this.zoomFrom,this.zoomTo,this.alpha))}}class sle extends bd{constructor(){super(...arguments),this._currentRotation=new Cs}_init(e,t){this.rotateFrom=tC(e),this.rotateTo=tC(t),this._currentRotation=new Cs}_tick(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)}}class ole extends bd{_init(e,t,n){this.valueFrom=e,this.valueTo=t,this.callback=n}_tick(){this.callback(Vo(this.valueFrom,this.valueTo,this.alpha))}}class ale extends bd{_init(e){this.callback=e}_tick(){this.alpha===1&&this.callback()}}class o4{constructor(e=[]){this._resolveList=[],this._list=e}get done(){return this._list.every(e=>e.done)}then(e){let t;return t=this.done?Promise.resolve():new Promise(n=>{this._resolveList.push(n),this._list.forEach(r=>{r.then(()=>{this._resolveList.forEach(s=>{s()}),this._resolveList.length=0})})}),t.then(e)}}class lle{constructor(e){this.stage=e,this.animationList=[],this.finishedList=[],this.viewer=e.viewer,this.controls=e.viewerControls}get paused(){return this.animationList.every(e=>e.paused)}add(e){return e.duration===0?e.tick(this.viewer.stats):this.animationList.push(e),e}remove(e){const t=this.animationList,n=t.indexOf(e);n>-1&&t.splice(n,1)}run(e){const t=this.finishedList,n=this.animationList,r=n.length;for(let o=0;o<r;++o){const a=n[o];a.tick(e)&&t.push(a)}const s=t.length;if(s){for(let o=0;o<s;++o)this.remove(t[o]);t.length=0}}spin(e,t,n){return this.add(new i4(n,this.controls,e,t))}rock(e,t,n,r){return this.add(new r4(r,this.controls,e,t,n))}rotate(e,t){const n=this.viewer.rotationGroup.quaternion.clone();return this.add(new sle(t,this.controls,n,e))}move(e,t){const n=this.controls.position.clone().negate();return this.add(new s4(t,this.controls,n,e))}zoom(e,t){const n=this.viewer.camera.position.z;return this.add(new rle(t,this.controls,n,e))}zoomMove(e,t,n){return new o4([this.move(e,n),this.zoom(t,n)])}orient(e,t){const n=new me,r=new Cs,s=new me;return Cg(e).decompose(n,r,s),new o4([this.move(n.negate(),t),this.rotate(r,t),this.zoom(-s.x,t)])}value(e,t,n,r){return this.add(new ole(r,this.controls,e,t,n))}timeout(e,t){return this.add(new ale(t,this.controls,e))}spinComponent(e,t,n,r){return this.add(new i4(r,e.controls,t,n))}rockComponent(e,t,n,r,s){return this.add(new r4(s,e.controls,t,n,r))}moveComponent(e,t,n){const r=e.controls.position.clone().negate();return this.add(new s4(n,e.controls,r,t))}pause(){this.animationList.forEach(e=>e.pause())}resume(){this.animationList.forEach(e=>e.resume())}toggle(){this.paused?this.resume():this.pause()}clear(){this.animationList.length=0}dispose(){this.clear()}}class cle{constructor(e,t){if(this.fn=e,this.queue=[],this.pending=!1,this.next=this.next.bind(this),t){for(let n=0,r=t.length;n<r;++n)this.queue.push(t[n]);this.next()}}run(e){this.fn(e,this.next)}next(){const e=this.queue.shift();e!==void 0?(this.pending=!0,setTimeout(()=>this.run(e))):this.pending=!1}push(e){this.queue.push(e),this.pending||this.next()}kill(){this.queue.length=0}length(){return this.queue.length}}class C1{constructor(e,t,n){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:gn.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:gn.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=t,this.tasks=new DG,this.queue=new cle(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=gn.getSchemes()),this.toBePrepared=!1}init(e){const t=e||{};this.clipNear=he(t.clipNear,0),this.clipRadius=he(t.clipRadius,0),this.clipCenter=he(t.clipCenter,new me),this.flatShaded=he(t.flatShaded,!1),this.side=he(t.side,"double"),this.opacity=he(t.opacity,1),this.depthWrite=he(t.depthWrite,!0),this.wireframe=he(t.wireframe,!1),this.setColor(t.color,t),this.colorData=he(t.colorData,void 0),this.colorScheme=he(t.colorScheme,"uniform"),this.colorScale=he(t.colorScale,""),this.colorReverse=he(t.colorReverse,!1),this.colorValue=he(t.colorValue,9474192),this.colorDomain=he(t.colorDomain,void 0),this.colorMode=he(t.colorMode,"hcl"),this.visible=he(t.visible,!0),this.quality=he(t.quality,void 0),this.roughness=he(t.roughness,.4),this.metalness=he(t.metalness,0),this.diffuse=he(t.diffuse,16777215),this.diffuseInterior=he(t.diffuseInterior,!1),this.useInteriorColor=he(t.useInteriorColor,!1),this.interiorColor=he(t.interiorColor,2236962),this.interiorDarkening=he(t.interiorDarkening,0),this.lazy=he(t.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=he(t.matrix,new Tt),this.disablePicking=he(t.disablePicking,!1);const n=this.parameters;n.sphereDetail===!0&&(n.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),n.radialSegments===!0&&(n.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),n.openEnded===!0&&(n.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),n.disableImpostor===!0&&(n.disableImpostor={type:"boolean",rebuild:!0}),t.quality==="low"?(n.sphereDetail&&(this.sphereDetail=0),n.radialSegments&&(this.radialSegments=5)):t.quality==="medium"?(n.sphereDetail&&(this.sphereDetail=1),n.radialSegments&&(this.radialSegments=10)):t.quality==="high"?(n.sphereDetail&&(this.sphereDetail=2),n.radialSegments&&(this.radialSegments=20)):(n.sphereDetail&&(this.sphereDetail=he(t.sphereDetail,1)),n.radialSegments&&(this.radialSegments=he(t.radialSegments,10))),n.openEnded&&(this.openEnded=he(t.openEnded,!0)),n.disableImpostor&&(this.disableImpostor=he(t.disableImpostor,!1))}getColorParams(e){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},e)}getBufferParams(e={}){return Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},e)}setColor(e,t){const n=Object.keys(gn.getSchemes());if(typeof e=="string"&&n.includes(e.toLowerCase()))t?t.colorScheme=e:this.setParameters({colorScheme:e});else if(e!==void 0){let r=new Ht(e).getHex();t?(t.colorScheme="uniform",t.colorValue=r):this.setParameters({colorScheme:"uniform",colorValue:r})}return this}prepare(e){}create(){}update(e){this.build()}build(e){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(e||!1)}else this.lazyProps.build=!0}make(e,t){pt&&tt.time("Representation.make "+this.type);const n=()=>{e?(this.update(e),this.viewer.requestRender(),this.tasks.decrement(),t&&t()):(this.clear(),this.create(),this.manualAttach||this.disposed||(pt&&tt.time("Representation.attach "+this.type),this.attach(()=>{pt&&tt.timeEnd("Representation.attach "+this.type),this.tasks.decrement(),t&&t()}))),pt&&tt.timeEnd("Representation.make "+this.type)};this.toBePrepared?this.prepare(n):n()}attach(e){this.setVisibility(this.visible),e()}setVisibility(e,t){if(this.visible=e,this.visible&&this.opacity){const n=this.lazyProps,r=n.bufferParams,s=n.what;if(n.build)return n.build=!1,this.build(),this;(Object.keys(r).length||Object.keys(s).length)&&(n.bufferParams={},n.what={},this.updateParameters(r,s))}return this.bufferList.forEach(function(n){n.setVisibility(e)}),t||this.viewer.requestRender(),this}setParameters(e,t={},n=!1){const r=e||{},s=this.parameters,o={};this.opacity||r.opacity===void 0||(this.lazyProps.build?(this.lazyProps.build=!1,n=!0):(Object.assign(o,this.lazyProps.bufferParams),Object.assign(t,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(r.color,r);for(let a in r)r[a]!==void 0&&s[a]!=null&&(s[a].int&&(r[a]=parseInt(r[a])),s[a].float&&(r[a]=parseFloat(r[a])),r[a]!==this[a]||r[a].equals&&!r[a].equals(this[a]))&&(this[a]&&this[a].copy&&r[a].copy?this[a].copy(r[a]):this[a]&&this[a].set?this[a].set(r[a]):this[a]=r[a],s[a].buffer&&(s[a].buffer===!0?o[a]=r[a]:o[s[a].buffer]=r[a]),s[a].update&&(t[s[a].update]=!0),!s[a].rebuild||s[a].rebuild==="impostor"&&al&&!this.disableImpostor||(n=!0));return n?this.build():this.updateParameters(o,t),this}updateParameters(e={},t){if(this.lazy&&(!this.visible||!this.opacity)&&e.hasOwnProperty("opacity")===!1)return Object.assign(this.lazyProps.bufferParams,e),void Object.assign(this.lazyProps.what,t);this.bufferList.forEach(function(n){n.setParameters(e)}),Object.keys(t).length&&this.update(t),this.viewer.requestRender()}getParameters(){const e={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach(t=>{this.parameters[t]!==null&&(e[t]=this[t])}),e}clear(){this.bufferList.forEach(e=>{this.viewer.remove(e),e.dispose()}),this.bufferList.length=0,this.viewer.requestRender()}dispose(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()}}class kG{constructor(e){this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=e,this.blobUrl=window.URL.createObjectURL(t0.get(e)),this.worker=new Worker(this.blobUrl),t0.activeWorkerCount+=1,this.worker.onmessage=t=>{this.pending-=1;const n=t.data.__postId;pt&&tt.timeEnd("Worker.postMessage "+e+" #"+n);const r=this.onmessageDict[n];r&&r.call(this.worker,t),delete this.onmessageDict[n],delete this.onerrorDict[n]},this.worker.onerror=t=>{if(this.pending-=1,t.data){const n=t.data.__postId,r=this.onerrorDict[n];r?r.call(this.worker,t):tt.error("Worker.onerror",n,e,t),delete this.onmessageDict[n],delete this.onerrorDict[n]}else tt.error("Worker.onerror",e,t)}}post(e={},t,n,r){this.onmessageDict[this.postCount]=n,this.onerrorDict[this.postCount]=r,e.__name=this.name,e.__postId=this.postCount,e.__debug=pt,pt&&tt.time(`Worker.postMessage ${this.name} #${this.postCount}`);try{this.worker.postMessage(e,t)}catch(s){tt.error("worker.post:",s),this.worker.postMessage(e)}return this.pending+=1,this.postCount+=1,this}terminate(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),t0.activeWorkerCount-=1):tt.log("no worker to terminate")}}class rC{constructor(e,t=2){this.pool=[],this.count=0,this.maxCount=Math.min(8,t),this.name=e}post(e={},t,n,r){const s=this.getNextWorker();return s?s.post(e,t,n,r):console.error("unable to get worker from pool"),this}terminate(){this.pool.forEach(function(e){e.terminate()})}getNextWorker(){let e,t=1/0;for(let n=0;n<this.maxCount;++n){if(n>=this.count){e=new kG(this.name),this.pool.push(e),this.count+=1;break}const r=this.pool[n];if(r.pending===0){e=r;break}r.pending<t&&(t=r.pending,e=r)}return e}}function sC(i){const e=i.length,t=e/3;let n=0,r=0,s=0;for(let o=0;o<e;o+=3)n+=i[o+0],r+=i[o+1],s+=i[o+2];return new me(n/t,r/t,s/t)}function Zh(i,e,t){return t?i.sub(t).projectOnVector(e).add(t):i.projectOnVector(e),i}function Z0(i){let e=1/0,t=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,l=i.length;a<l;a+=3){const c=i[a],u=i[a+1],h=i[a+2];c<e&&(e=c),u<t&&(t=u),h<n&&(n=h),c>r&&(r=c),u>s&&(s=u),h>o&&(o=h)}return[en([e,t,n]),en([r,s,o])]}function ES(i,e){for(let t=0,n=e.length;t<n;t+=3){const r=e[t],s=e[t+1],o=e[t+2];e[t]=i[0]*r+i[4]*s+i[8]*o+i[12],e[t+1]=i[1]*r+i[5]*s+i[9]*o+i[13],e[t+2]=i[2]*r+i[6]*s+i[10]*o+i[14]}}function zR(i,e){for(let t=0,n=e.length;t<n;t+=3){const r=e[t],s=e[t+1],o=e[t+2];e[t]=i[0]*r+i[3]*s+i[6]*o,e[t+1]=i[1]*r+i[4]*s+i[7]*o,e[t+2]=i[2]*r+i[5]*s+i[8]*o}}function UG(i){for(let e=0,t=i.length;e<t;e+=3){const n=i[e],r=i[e+1],s=i[e+2],o=n*n+r*r+s*s;if(o>0){const a=1/Math.sqrt(o);i[e]=n*a,i[e+1]=r*a,i[e+2]=s*a}}}function en(i){return new Float32Array(i||3)}function Zs(i,e,t){const n=e[0],r=e[1],s=e[2],o=t[0],a=t[1],l=t[2];i[0]=r*l-s*a,i[1]=s*o-n*l,i[2]=n*a-r*o}function Bs(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function fi(i,e,t){i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2]}function wa(i,e,t){i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2]}function bs(i,e,t=0){i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2]}function rn(i,e,t=0){e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2]}function OG(i){return i[0]*i[0]+i[1]*i[1]+i[2]*i[2]}function _u(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2])}function sp(i,e,t){zn(i,e,1/t)}function zn(i,e,t){i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t}function Si(i,e){const t=OG(e);t==0?(i[0]=e[0],i[1]=e[1],i[2]=e[2]):zn(i,e,1/Math.sqrt(t))}function BG(i,e,t){i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t}function gx(i,e,t){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function oC(i,e){i[0]=Math.floor(e[0]),i[1]=Math.floor(e[1]),i[2]=Math.floor(e[2])}function Rg(i,e){i[0]=Math.ceil(e[0]),i[1]=Math.ceil(e[1]),i[2]=Math.ceil(e[2])}function TS(i,e){i[0]=-e[0],i[1]=-e[1],i[2]=-e[2]}function ule(i,e){const t=i[0],n=i[1],r=i[2],s=e[0],o=e[1],a=e[2],l=n*a-r*o,c=r*s-t*a,u=t*o-n*s,h=Math.sqrt(l*l+c*c+u*u),d=t*s+n*o+r*a;return Math.atan2(h,d)}function hle(i,e=9){const t=Math.floor(e/2),n=i.position1.length/3,r=3*(t*n),s=1/e,o=AS(i.position1,i.position2),a=new Float32Array(r),l=new Float32Array(r),c=new me;for(let f=0;f<n;++f){const m=3*f;c.set(o[m],o[m+1],o[m+2]);const _=i.position1[m],v=i.position1[m+1],g=i.position1[m+2];for(let b=0;b<t;++b){const p=t*m+3*b,y=s*(2*b+1),A=s*(2*b+2);a[p]=_+c.x*y,a[p+1]=v+c.y*y,a[p+2]=g+c.z*y,l[p]=_+c.x*A,l[p+1]=v+c.y*A,l[p+2]=g+c.z*A}}const u=ll(a,l),h=function(f,m){const _=f.length/3,v=new Float32Array(_*m*3);for(let g=0;g<_;++g){const b=3*g,p=g*m*3,y=f[b+0],A=f[b+1],w=f[b+2];for(let M=0;M<m;++M){const T=p+3*M;v[T+0]=y,v[T+1]=A,v[T+2]=w}}return v}(i.color,t),d={position:u,position1:a,position2:l,color:h,color2:h};return i.radius&&(d.radius=GM(i.radius,t)),i.picking&&i.picking.array&&(i.picking.array=GM(i.picking.array,t),d.picking=i.picking),i.primitiveId&&(d.primitiveId=GM(i.primitiveId,t)),d}function zG(i,e=.1){const t=AS(i.position1,i.position2),n=[],r=[],s=[],o=i.radius?[]:void 0,a=i.picking?[]:void 0,l=i.primitiveId?[]:void 0,c=new me,u=i.position1.length/3;let h=0;for(let g=0;g<u;++g){const b=3*g;c.set(t[b],t[b+1],t[b+2]);const p=c.length()/e,y=Math.floor(p/2),A=1/p,w=i.position1[b],M=i.position1[b+1],T=i.position1[b+2];for(let E=0;E<y;++E){const C=3*h+3*E,N=A*(2*E+1),P=A*(2*E+2);n[C]=w+c.x*N,n[C+1]=M+c.y*N,n[C+2]=T+c.z*N,r[C]=w+c.x*P,r[C+1]=M+c.y*P,r[C+2]=T+c.z*P,i.color&&(s[C]=i.color[b],s[C+1]=i.color[b+1],s[C+2]=i.color[b+2]),o&&(o[h+E]=i.radius[g]),a&&(i.picking.array?a[h+E]=i.picking.array[g]:a[h+E]=g),l&&(l[h+E]=i.primitiveId[g])}h+=y}const d=new Float32Array(n),f=new Float32Array(r),m=ll(d,f),_=new Float32Array(s),v={position:m,position1:d,position2:f,color:_,color2:_};return o&&(v.radius=new Float32Array(o)),a&&i.picking&&(i.picking.array=new Float32Array(a),v.picking=i.picking),l&&(v.primitiveId=new Float32Array(l)),v}function aC(i,e=.1){const t=AS(i.position1,i.position2),n=[],r=[],s=[],o=i.radius?[]:void 0,a=i.picking?[]:void 0,l=i.primitiveId?[]:void 0,c=new me,u=i.position1.length/3;let h=e,d=!0,f=0,m=0,_=0;for(let A=0;A<u;++A){const w=3*A,M=i.position1[w],T=i.position1[w+1],E=i.position1[w+2];c.set(t[w],t[w+1],t[w+2]);const C=c.length();d&&(n[m]=M,n[m+1]=T,n[m+2]=E);let N=h;const P=1/C;for(;N<C;){const L=d?r:n;L[m]=M+c.x*N*P,L[m+1]=T+c.y*N*P,L[m+2]=E+c.z*N*P,d&&(f++,m=3*f),d=!d,h=e,N+=e}d&&(r[m]=i.position2[w],r[m+1]=i.position2[w+1],r[m+2]=i.position2[w+2],f++,m=3*f),h=N-C;for(let L=_;L<f;L++){if(i.color){const R=3*L;s[R]=i.color[w],s[R+1]=i.color[w+1],s[R+2]=i.color[w+2]}o&&(o[L]=i.radius[A]),a&&(i.picking.array?a[L]=i.picking.array[A]:a[L]=A),l&&(l[L]=i.primitiveId[A])}_=f}if(!d&&u>0){const A=3*f;r[A]=i.position2[3*u-3],r[A+1]=i.position2[3*u-2],r[A+1]=i.position2[3*u-1]}const v=new Float32Array(n),g=new Float32Array(r),b=ll(v,g),p=new Float32Array(s),y={position:b,position1:v,position2:g,color:p,color2:p};return o&&(y.radius=new Float32Array(o)),a&&i.picking&&(i.picking.array=new Float32Array(a),y.picking=i.picking),l&&(y.primitiveId=new Float32Array(l)),y}rC.prototype.constructor=rC,Z0.__deps=[en],sp.__deps=[zn],Si.__deps=[zn,OG];const Eu=new me;class Tu{static get Picker(){return zo.get(this.type)}static get Buffer(){return To.get(this.type)}static getShapeKey(e){return this.type+e[0].toUpperCase()+e.substr(1)}static expandBoundingBox(e,t){}static valueToShape(e,t,n){const r=e._primitiveData[this.getShapeKey(t)];switch(this.fields[t]){case"v3":case"c":(function(s,o){s.toArray!==void 0?s=s.toArray():s.x!==void 0?s=[s.x,s.y,s.z]:s.r!==void 0&&(s=[s.r,s.g,s.b]),o.push.apply(o,s)})(n,r);break;default:r.push(n)}}static objectToShape(e,t){Object.keys(this.fields).forEach(n=>{this.valueToShape(e,n,t[n])}),this.valueToShape(e,"name",t.name),this.expandBoundingBox(e.boundingBox,t)}static valueFromShape(e,t,n){const r=e._primitiveData[this.getShapeKey(n)];switch(this.fields[n]){case"v3":return new me().fromArray(r,3*t);case"c":return new Ht().fromArray(r,3*t);default:return r[t]}}static objectFromShape(e,t){let n=this.valueFromShape(e,t,"name");n===void 0&&(n=`${this.type}: ${t} (${e.name})`);const r={shape:e,name:n};return Object.keys(this.fields).forEach(s=>{r[s]=this.valueFromShape(e,t,s)}),r}static arrayFromShape(e,t){const n=e._primitiveData[this.getShapeKey(t)];return this.fields[t]==="s"?n:new Float32Array(n)}static dataFromShape(e){const t={};return this.Picker&&(t.picking=new this.Picker(e)),Object.keys(this.fields).forEach(n=>{t[n]=this.arrayFromShape(e,n)}),t}static bufferFromShape(e,t){return new this.Buffer(this.dataFromShape(e),t)}}Tu.type="",Tu.fields={};class $p extends Tu{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Eu.fromArray(t.position))}}$p.type="sphere",$p.fields={position:"v3",color:"c",radius:"f"};class cd extends Tu{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Eu.fromArray(t.position))}}cd.type="box",cd.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};class CS extends cd{}CS.type="octahedron";class PS extends cd{}PS.type="tetrahedron";class ud extends Tu{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),r=this.valueFromShape(e,t,"position2");return n.add(r).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Eu.fromArray(t.position1)),e.expandByPoint(Eu.fromArray(t.position2))}static bufferFromShape(e,t={}){let n=this.dataFromShape(e);return this.type==="cylinder"&&t.dashedCylinder&&(n=zG(n)),new this.Buffer(n,t)}}ud.type="cylinder",ud.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};class RS extends ud{}RS.type="arrow";class IS extends ud{}IS.type="cone";class Wp extends $p{}Wp.type="ellipsoid",Wp.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};class LS extends Wp{}LS.type="torus";class hb extends Tu{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Eu.fromArray(t.position))}}hb.type="text",hb.fields={position:"v3",color:"c",size:"f",text:"s"};class Q0 extends Tu{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(Eu.fromArray(t.position))}}Q0.type="point",Q0.fields={position:"v3",color:"c"};class J0 extends Tu{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),r=this.valueFromShape(e,t,"position2");return n.add(r).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(Eu.fromArray(t.position1)),e.expandByPoint(Eu.fromArray(t.position2))}}J0.type="wideline",J0.fields={position1:"v3",position2:"v3",color:"c"};class e1{constructor(e,t){this.exp=3;const n=t||function(v){const{x:g,y:b,z:p}=v,y=new Ti,A=g.length,{min:w,max:M}=y;for(let T=0;T<A;T++)w.x=Math.min(g[T],w.x),w.y=Math.min(b[T],w.y),w.z=Math.min(p[T],w.z),M.x=Math.max(g[T],M.x),M.y=Math.max(b[T],M.y),M.z=Math.max(p[T],M.z);return y}(e);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=1+(n.max.x-this.minX>>this.exp),this.boundY=1+(n.max.y-this.minY>>this.exp),this.boundZ=1+(n.max.z-this.minZ>>this.exp);const r=this.boundX*this.boundY*this.boundZ,s=e.count!==void 0?e.count:e.x.length,o=e.x,a=e.y,l=e.z;let c=0;const u=new Uint32Array(r),h=new Int32Array(s);for(let v=0;v<s;++v){const g=o[v]-this.minX>>this.exp,b=a[v]-this.minY>>this.exp,p=l[v]-this.minZ>>this.exp,y=(g*this.boundY+b)*this.boundZ+p;(u[y]+=1)===1&&(c+=1),h[v]=y}const d=new Uint16Array(c);for(let v=0,g=0;v<r;++v){const b=u[v];b>0&&(u[v]=g+1,d[g]=b,g+=1)}const f=new Uint32Array(c);for(let v=1;v<c;++v)f[v]+=f[v-1]+d[v-1];const m=new Uint16Array(c),_=new Int32Array(s);for(let v=0;v<s;++v){const g=u[h[v]];if(g>0){const b=g-1;_[f[b]+m[b]]=v,m[b]+=1}}this.grid=u,this.bucketCount=d,this.bucketOffset=f,this.bucketArray=_,this.xArray=o,this.yArray=a,this.zArray=l}within(e,t,n,r){const s=[];return this.eachWithin(e,t,n,r,o=>s.push(o)),s}eachWithin(e,t,n,r,s){const o=r*r,a=Math.max(0,e-r-this.minX>>this.exp),l=Math.max(0,t-r-this.minY>>this.exp),c=Math.max(0,n-r-this.minZ>>this.exp),u=Math.min(this.boundX,1+(e+r-this.minX>>this.exp)),h=Math.min(this.boundY,1+(t+r-this.minY>>this.exp)),d=Math.min(this.boundZ,1+(n+r-this.minZ>>this.exp));for(let f=a;f<u;++f)for(let m=l;m<h;++m)for(let _=c;_<d;++_){const v=(f*this.boundY+m)*this.boundZ+_,g=this.grid[v];if(g>0){const b=g-1,p=this.bucketOffset[b],y=p+this.bucketCount[b];for(let A=p;A<y;++A){const w=this.bucketArray[A],M=this.xArray[w]-e,T=this.yArray[w]-t,E=this.zArray[w]-n,C=M*M+T*T+E*E;C<=o&&s(w,C)}}}}}class cm{constructor(e=0){this._fields=this._defaultFields,this._init(0)}get _defaultFields(){return[]}_init(e){this.length=e,this.count=0;for(let t=0,n=this._fields.length;t<n;++t){const[r,s,o]=this._fields[t];this._initField(r,s,o)}}_initField(e,t,n){this[e]=MG(n,this.length*t)}addField(e,t,n){this._fields.push([e,t,n]),this._initField(e,t,n)}resize(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(let t=0,n=this._fields.length;t<n;++t){const r=this._fields[t][0],s=this._fields[t][1],o=this.length*s,a=new this[r].constructor(o);this[r].length>o?a.set(this[r].subarray(0,o)):a.set(this[r]),this[r]=a}}growIfFull(){if(this.count>=this.length){const e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}copyFrom(e,t,n,r){for(let s=0,o=this._fields.length;s<o;++s){const a=this._fields[s][0],l=this._fields[s][1],c=this[a],u=e[a];for(let h=0;h<r;++h){const d=l*(t+h),f=l*(n+h);for(let m=0;m<l;++m)c[d+m]=u[f+m]}}}copyWithin(e,t,n){for(let r=0,s=this._fields.length;r<s;++r){const o=this._fields[r][0],a=this._fields[r][1],l=this[o];for(let c=0;c<n;++c){const u=a*(e+c),h=a*(t+c);for(let d=0;d<a;++d)l[u+d]=l[h+d]}}}sort(e){tt.time("Store.sort");const t=this,n=new this.constructor(1);(function r(s,o){if(s<o){let c=Math.floor((s+o)/2),u=s,h=o;do{for(;e(u,c)<0;)u+=1;for(;e(h,c)>0;)h-=1;u<=h&&(u===c?c=h:h===c&&(c=u),(a=u)!==(l=h)&&(n.copyFrom(t,0,a,1),t.copyWithin(a,l,1),t.copyFrom(n,l,0,1)),u+=1,h-=1)}while(u<=h);r(s,h),r(u,o)}var a,l})(0,this.count-1),tt.timeEnd("Store.sort")}clear(){this.count=0}dispose(){for(let e=0,t=this._fields.length;e<t;++e)delete this[this._fields[e][0]]}}class dle extends cm{get _defaultFields(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]}addContact(e,t,n){this.growIfFull();const r=this.count;e<t?(this.index1[r]=e,this.index2[r]=t):(this.index2[r]=e,this.index1[r]=t),n&&(this.type[r]=n),this.count+=1}}function dy(i){return 16843009*((i=(858993459&(i-=i>>>1&1431655765))+(i>>>2&858993459))+(i>>>4)&252645135)>>>24}class or{constructor(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),t===!0&&this.setAll()}get(e){return!!(this._words[e>>>5]&1<<e)}set(e){this._words[e>>>5]|=1<<e}clear(e){this._words[e>>>5]&=~(1<<e)}flip(e){this._words[e>>>5]^=1<<e}_assignRange(e,t,n){if(t<e)return;const r=this._words,s=n===!0?4294967295:0,o=e>>>5,a=t>>>5;for(let u=o+1;u<a;++u)r[u]=s;const l=o<<5,c=a<<5;if(n===!0)if(t-e<32)for(let u=e,h=t+1;u<h;++u)r[u>>>5]|=1<<u;else{for(let u=e,h=l+32;u<h;++u)r[u>>>5]|=1<<u;for(let u=c,h=t+1;u<h;++u)r[u>>>5]|=1<<u}else if(t-e<32)for(let u=e,h=t+1;u<h;++u)r[u>>>5]&=~(1<<u);else{for(let u=e,h=l+32;u<h;++u)r[u>>>5]&=~(1<<u);for(let u=c,h=t+1;u<h;++u)r[u>>>5]&=~(1<<u)}return this}setRange(e,t){return this._assignRange(e,t,!0)}clearRange(e,t){return this._assignRange(e,t,!1)}setBits(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const s=e[r];t[s>>>5]|=1<<s}return this}clearBits(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const s=e[r];t[s>>>5]&=~(1<<s)}return this}setAll(){return this._assignRange(0,this.length-1,!0)}clearAll(){return this._assignRange(0,this.length-1,!1)}flipAll(){const e=this._words.length,t=this._words,n=32-this.length%32;for(let r=0;r<e-1;++r)t[r]=~t[r];return t[e-1]=~(t[e-1]<<n)>>>n,this}_isRangeValue(e,t,n){if(t<e)return;const r=this._words,s=n===!0?4294967295:0,o=e>>>5,a=t>>>5;for(let l=o+1;l<a;++l)if(r[l]!==s)return!1;if(t-e<32){for(let l=e,c=t+1;l<c;++l)if(!!(r[l>>>5]&1<<l)!==n)return!1}else{const l=a<<5;for(let c=e,u=(o<<5)+32;c<u;++c)if(!!(r[c>>>5]&1<<c)!==n)return!1;for(let c=l,u=t+1;c<u;++c)if(!!(r[c>>>5]&1<<c)!==n)return!1}return!0}isRangeSet(e,t){return this._isRangeValue(e,t,!0)}isRangeClear(e,t){return this._isRangeValue(e,t,!1)}isAllSet(){return this._isRangeValue(0,this.length-1,!0)}isAllClear(){return this._isRangeValue(0,this.length-1,!1)}isSet(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const s=e[r];if(!(t[s>>>5]&1<<s))return!1}return!0}isClear(...e){const t=this._words,n=e.length;for(let r=0;r<n;++r){const s=e[r];if(t[s>>>5]&1<<s)return!1}return!0}isEqualTo(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)if(t[s]!==n[s])return!1;return!0}getSize(){const e=this._words.length,t=this._words;let n=0;for(let r=0;r<e;++r)n+=dy(t[r]);return n}difference(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)t[s]=t[s]&~n[s];for(let s=t.length;s<r;++s)t[s]=0;return this}union(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)t[s]|=n[s];for(let s=t.length;s<r;++s)t[s]=0;return this}intersection(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)t[s]&=n[s];for(let s=t.length;s<r;++s)t[s]=0;return this}intersects(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);for(let s=0;s<r;++s)if(t[s]&n[s])return!0;return!1}getIntersectionSize(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length);let s=0;for(let o=0;o<r;++o)s+=dy(t[o]&n[o]);return s}makeIntersection(e){const t=this._words,n=e._words,r=Math.min(t.length,n.length),s=new Uint32Array(r),o=Object.create(or.prototype);o._words=s,o.length=Math.min(this.length,e.length);for(let a=0;a<r;++a)s[a]=t[a]&n[a];return o}forEach(e){const t=this._words.length,n=this._words;let r=0;for(let s=0;s<t;++s){let o=n[s];for(;o!==0;){const a=o&-o;e((s<<5)+dy(a-1),r),o^=a,++r}}}toArray(){const e=this._words,t=new Array(this.getSize()),n=this._words.length;let r=0;for(let s=0;s<n;++s){let o=e[s];for(;o!==0;){const a=o&-o;t[r++]=(s<<5)+dy(a-1),o^=a}}return t}toString(){return"{"+this.toArray().join(",")+"}"}toSeleString(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(or.prototype);return e.length=this.length,e._words=new Uint32Array(this._words),e}}function GG(i){const{edgeCount:e,nodeCount:t,nodeArray1:n,nodeArray2:r}=i,s=new Uint8Array(t),o=new Int32Array(t);for(let c=0;c<e;++c)s[n[c]]+=1,s[r[c]]+=1;for(let c=1;c<t;++c)o[c]+=o[c-1]+s[c-1];const a=2*e,l=new Int32Array(a);for(let c=0;c<a;++c)l[c]=-1;for(let c=0;c<e;++c){const u=n[c],h=r[c];let d=o[u];for(;l[d]!==-1&&d<a;)d+=1;l[d]=c;let f=o[h];for(;l[f]!==-1&&f<a;)f+=1;l[f]=c}return{countArray:s,offsetArray:o,indexArray:l}}function Sr(i=0,e=0){return{type:i,group:e,x:0,y:0,z:0,atomSet:[]}}function Bi(i,e){i.x+=e.x,i.y+=e.y,i.z+=e.z,i.atomSet.push(e.index)}function zi(i,e){const t=e.atomSet.length;if(t>0){const{types:n,groups:r,centers:s,atomSets:o}=i;n.push(e.type),r.push(e.group),s.x.push(e.x/t),s.y.push(e.y/t),s.z.push(e.z/t),o.push(e.atomSet)}}const hd=0,fle=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],ple=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],mle=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],VG=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],gle=["NON-POLYMER"].concat(["OTHER"],VG),HG=["h","g","i"],$G=["e","b"],WG=["s","t","l",""],jG={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},vle={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},_le={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},a4={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},yle={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},l4={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},xle=[0,0,0],db={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},_p=Object.keys(db),XG=["A","C","T","G","U","I"],qG=["DA","DC","DT","DG","DU","DI"],ble=["A","G","I","DA","DG","DI"],n0=XG.concat(qG),fb=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],Sle=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],wle=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],Mle=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],YG=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],Ig={1:{trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},2:{trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},3:{trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},4:{trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},5:{trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},6:{trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]}};Ig[hd]={};const c4={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function fy(i){switch(i){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}const u4=new Map([[2,wi(180)],[3,wi(120)],[4,wi(109.4721)],[6,wi(90)]]);function py(i,e){let t=[];const n=new me,r=new me;return n.subVectors(e,i),i.eachBondedAtom(s=>{s.number!==1&&(r.subVectors(s,i),t.push(n.angleTo(r)))}),t}function h4(i,e){const t=i.clone(),n=new me;n.subVectors(e,i);const r=[new me,new me];let s=0;if(i.eachBondedAtom(a=>{s>1||a.number!==1&&(t.index=a.index,r[s++].subVectors(a,i))}),s===1&&t.eachBondedAtom(a=>{s>1||a.number!==1&&a.index!==i.index&&r[s++].subVectors(a,i)}),s!==2)return;const o=r[0].cross(r[1]);return Math.abs(Math.PI/2-o.angleTo(n))}function Ale(i,e){const t=i.structure,n=t.atomCount,r=new Int8Array(n),s=new Int8Array(n),o=new Int8Array(n),a=new Int8Array(n);return t.eachAtom(l=>{const c=l.index,[u,h,d,f]=function(m,_){const v=m.bondToElementCount(1);let g=m.formalCharge||0;const b=g===0,p=v===0,y=m.bondCount,A=function(C){let N=0;return C.eachBond(P=>N+=P.bondOrder),N}(m),w=function(C){const N=C.structure.getBondProxy(),P=C.number,L=P===8||P===7;if(L&&C.bondCount===4)return!1;let R=!1;return C.eachBond(F=>{if(F.bondOrder>1)R=!0;else if(L){const V=F.getOtherAtom(C);V.eachBond(z=>{if(z.bondOrder>1){const U=V.number;if((U===15||U===16)&&z.getOtherAtom(V).number===8)return;R=!0}},N)}}),R}(m),M=A-y>0;let T=0,E=8;switch(m.number){case 1:b&&(y===0?(g=1,E=0):y===1&&(g=0,E=1));break;case 6:b&&(g=0),p&&(T=Math.max(0,4-A-Math.abs(g))),E=fy(y+T+Math.max(0,-g));break;case 7:if(b)if(p)if(w&&A<4)g=y-v==1&&A-v==2?1:0;else{let C=!1;m.eachBondedAtom(N=>{(N.number===16||N.isMetal())&&(C=!0)}),g=C?0:1}else g=A-3;p&&(T=Math.max(0,3-A+g)),E=fy(w&&!M?y+T-g:y+T+1-g);break;case 8:b&&(p||(g=A-2),A===1&&m.eachBondedAtom(C=>{C.eachBond(N=>{const P=N.getOtherAtom(C);P.index!==m.index&&P.number===8&&N.bondOrder===2&&(g=-1)})})),p&&(T=Math.max(0,2-A+g)),E=fy(w&&!M?y+T-g+1:y+T-g+2);break;case 16:b&&(p||(g=A<=3&&!m.bondToElementCount(8)?A-2:0)),p&&A<2&&(T=Math.max(0,2-A+g)),A<=3&&(E=fy(y+T-g+2));break;case 9:case 17:case 35:case 53:case 85:b&&(g=A-1);break;case 3:case 11:case 19:case 37:case 55:case 87:b&&(g=1-A);break;case 4:case 12:case 20:case 38:case 56:case 88:b&&(g=2-A);break;default:console.warn("Requested charge, protonation for an unhandled element",m.element)}return[g,T,T+v,E]}(l);r[c]=u,s[c]=h,o[c]=d,a[c]=f}),{charge:r,implicitH:s,totalH:o,idealGeometry:a}}function Bf(i){if(i["@valenceModel"])return i["@valenceModel"];const e=Ale(i);return i["@valenceModel"]=e,e}function d4(i){return i.number===15&&i.bondToElementCount(8)===i.bondCount}const Ele=["ARG","HIS","LYS"],Tle=["GLU","ASP"];function Cle(i,e){return i===2&&e===1||i===1&&e===2}function Ple(i,e){return i===3&&e===3}function Rle(i,e){return i===3&&e===1||i===1&&e===3}function f4(i){return i.resname==="HIS"&&i.number==7&&i.isRing()}function Ile(i,e){return i===5&&e===4||i===4&&e===5}function Lle(i,e){return i===9&&e===5||i===5&&e===9}const Dle=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function Nle(i,e){return i===12?e===11||e===12:i===13?e===10:void 0}const Fle=[17,35,53,85],kle=[7,8,16],Ule=[6,7,15,16],Ole=wi(180),Ble=wi(120);function p4(i,e,t){return!KG(i,e,t)&&(i.modelIndex!==e.modelIndex||i.altloc&&e.altloc&&i.altloc!==e.altloc)}const ui={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function KG(i,e,t){return i.modelIndex===t&&e.modelIndex!==t||e.modelIndex===t&&i.modelIndex!==t}function ug(i,e,t){return!KG(i,e,t)&&(i.modelIndex!==e.modelIndex||i.residueIndex===e.residueIndex||i.altloc&&e.altloc&&i.altloc!==e.altloc)}function zle(i){const e={types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]};return pt&&tt.time("calculateFeatures"),function(t,n){const{charge:r}=Bf(t.data),s={};t.eachResidue(o=>{if(Ele.includes(o.resname)){const a=Sr(1);o.eachAtom(l=>{l.number===7&&l.isSidechain()&&Bi(a,l)}),zi(n,a)}else _p.includes(o.resname)||o.isNucleic()||(o.eachAtom(a=>{let l=!1;const c=Sr(1);(function(u){let h=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===3&&u.eachBondedAtom(d=>{d.bondCount-d.bondToElementCount(1)==1&&++h}),h===2})(a)?(c.group=8,l=!0):function(u){let h=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom(d=>{d.bondCount-d.bondToElementCount(1)==1&&++h}),h===2}(a)&&(c.group=9,l=!0),l&&(a.eachBondedAtom(u=>{u.number===7&&(s[u.index]=!0,Bi(c,u))}),zi(n,c))}),o.eachAtom(a=>{const l=Sr(1);r[a.index]>0&&(s[a.index]||(Bi(l,a),zi(n,l)))}))})}(i,e),function(t,n){const{charge:r}=Bf(t.data),s={};t.eachResidue(o=>{if(Tle.includes(o.resname)){const a=Sr(2);o.eachAtom(l=>{l.number===8&&l.isSidechain()&&Bi(a,l)}),zi(n,a)}else if(n0.includes(o.resname)){const a=Sr(2);o.eachAtom(l=>{d4(l)&&(a.group=6,l.eachBondedAtom(c=>{c.number===8&&Bi(a,c)}),zi(n,a))})}else _p.includes(o.resname)||n0.includes(o.resname)||(o.eachAtom(a=>{let l=!1;const c=Sr(2);(function(u){return u.number===16&&u.bondToElementCount(8)===3})(a)?(c.group=4,l=!0):d4(a)?(c.group=6,l=!0):function(u){return u.number===16&&u.bondToElementCount(8)===4}(a)?(c.group=5,l=!0):function(u){let h=0;return u.number===6&&u.bondToElementCount(8)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom(d=>{d.number===8&&d.bondCount-d.bondToElementCount(1)==1&&++h}),h===2}(a)&&(c.group=10,l=!0),l&&(a.eachBondedAtom(u=>{u.number===8&&(s[u.index]=!0,Bi(c,u))}),zi(n,c))}),o.eachAtom(a=>{const l=Sr(2);r[a.index]<0&&(s[a.index]||(Bi(l,a),zi(n,l)))}))})}(i,e),function(t,n){const r=t.getAtomProxy();t.eachResidue(s=>{const o=s.getAromaticRings();if(o){const a=s.atomOffset;o.forEach(l=>{const c=Sr(3);l.forEach(u=>{r.index=u+a,Bi(c,r)}),zi(n,c)})}})}(i,e),function(t,n){const{charge:r,implicitH:s,idealGeometry:o}=Bf(t.data);t.eachAtom(a=>{const l=Sr(5),c=a.number;if(c===8)Bi(l,a),zi(n,l);else if(c===7){if(f4(a))Bi(l,a),zi(n,l);else if(r[a.index]<1){const u=a.bondCount+s[a.index],h=o[a.index];(h===4&&u<4||h===3&&u<3||h===2&&u<2)&&(Bi(l,a),zi(n,l))}}else c===16&&(a.resname!=="CYS"&&a.resname!=="MET"&&a.formalCharge!==-1||(Bi(l,a),zi(n,l)))})}(i,e),function(t,n){const{totalH:r}=Bf(t.data);t.eachAtom(s=>{const o=Sr(4),a=s.number;(f4(s)||r[s.index]>0&&(a===7||a===8||a===16))&&(Bi(o,s),zi(n,o))})}(i,e),function(t,n){const{totalH:r}=Bf(t.data);t.eachAtom(s=>{if(s.number===6&&r[s.index]>0&&(s.bondToElementCount(7)>0||s.bondToElementCount(8)>0||function(o){if(!o.isAromatic())return!1;const a=o.residueType.getRings();if(!a)return!1;let l=!1;return a.rings.forEach(c=>{l||c.some(u=>o.index-o.residueAtomOffset===u)&&(l=c.some(u=>{const h=o.residueType.atomTypeIdList[u],d=o.atomMap.get(h).number;return d===7||d===8}))}),l}(s))){const o=Sr(9);Bi(o,s),zi(n,o)}})}(i,e),function(t,n){t.eachAtom(r=>{let s=!1,o=!1;const a=_p.includes(r.resname),l=n0.includes(r.resname);if(a||l?a?r.number===8?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(r.resname)&&r.isSidechain()||r.isBackbone())&&(s=!0,o=!0):r.number===16&&r.resname==="CYS"?(s=!0,o=!0):r.number===7&&r.resname==="HIS"&&r.isSidechain()&&(s=!0):l&&(r.number===8&&r.isBackbone()?(s=!0,o=!0):["N3","N4","N7"].includes(r.atomname)?s=!0:["O2","O4","O6"].includes(r.atomname)&&(s=!0,o=!0)):r.isHalogen()||r.number===8||r.number===16?(s=!0,o=!0):r.number===7&&(s=!0),s){const c=Sr(11);Bi(c,r),zi(n,c)}if(o){const c=Sr(10);Bi(c,r),zi(n,c)}})}(i,e),function(t,n){t.eachAtom(r=>{if(r.isTransitionMetal()||r.number===30||r.number===48){const s=Sr(12);Bi(s,r),zi(n,s)}else if(Dle.includes(r.number)){const s=Sr(13);Bi(s,r),zi(n,s)}})}(i,e),function(t,n){t.eachAtom(r=>{const s=Sr(8);let o=!1;r.number===6?(o=!0,r.eachBondedAtom(a=>{const l=a.number;l!==6&&l!==1&&(o=!1)})):r.number===9&&(o=!0),o&&(Bi(s,r),zi(n,s))})}(i,e),function(t,n){t.eachAtom(r=>{if(kle.includes(r.number)){let s=!1;if(r.eachBondedAtom(o=>{Ule.includes(o.number)&&(s=!0)}),s){const o=Sr(7);Bi(o,r),zi(n,o)}}})}(i,e),function(t,n){t.eachAtom(r=>{if(Fle.includes(r.number)&&r.bondToElementCount(6)===1){const s=Sr(6);Bi(s,r),zi(n,s)}})}(i,e),pt&&tt.timeEnd("calculateFeatures"),e}function Gle(i,e=ui){const t=function(r){const{types:s,centers:o}=r;return{features:r,spatialHash:new e1(o),contactStore:new dle,featureSet:new or(s.length,!1)}}(zle(i));pt&&tt.time("calculateContacts"),function(r,s,o={}){const a=he(o.maxIonicDist,ui.maxIonicDist),l=he(o.maxPiStackingDist,ui.maxPiStackingDist),c=he(o.maxPiStackingOffset,ui.maxPiStackingOffset),u=he(o.maxPiStackingAngle,ui.maxPiStackingAngle),h=he(o.maxCationPiDist,ui.maxCationPiDist),d=he(o.maxCationPiOffset,ui.maxCationPiOffset),f=he(o.masterModelIndex,ui.masterModelIndex),m=Math.max(a+2,l,h),_=l*l,v=h*h,{features:g,spatialHash:b,contactStore:p,featureSet:y}=s,{types:A,centers:w,atomSets:M}=g,{x:T,y:E,z:C}=w,N=A.length,P=r.atomStore.x,L=r.atomStore.y,R=r.atomStore.z,F=r.getAtomProxy(),V=r.getAtomProxy(),z=function(Q,le,se){const oe=Q.length,$=le.length;for(let pe=0;pe<oe;++pe){F.index=Q[pe];for(let xe=0;xe<$;++xe)if(V.index=le[xe],F.distanceTo(V)<=se)return!0}return!1},U=new me,G=new me,B=new me,D=new me,O=new me,j=new me,q=new me,Y=function(Q,le){U.set(P[Q[0]],L[Q[0]],R[Q[0]]),G.set(P[Q[1]],L[Q[1]],R[Q[1]]),B.set(P[Q[2]],L[Q[2]],R[Q[2]]),D.subVectors(U,G),O.subVectors(U,B),le.crossVectors(D,O)},ie=function(Q,le,se){return U.set(T[Q],E[Q],C[Q]),G.set(T[le],E[le],C[le]),U.sub(G).projectOnPlane(se).add(G).distanceTo(G)},ne=function(Q,le,se){y.setBits(Q,le),p.addContact(Q,le,se)};for(let Q=0;Q<N;++Q)b.eachWithin(T[Q],E[Q],C[Q],m,(le,se)=>{if(le<=Q||(F.index=M[Q][0],V.index=M[le][0],ug(F,V,f)))return;const oe=A[Q],$=A[le];if(Cle(oe,$))z(M[Q],M[le],a)&&ne(Q,le,1);else if(Ple(oe,$)){if(se<=_){Y(M[Q],j),Y(M[le],q);const pe=57.29578*j.angleTo(q);Math.min(ie(Q,le,q),ie(le,Q,j))<=c&&(pe<=u||pe>=180-u||pe<=u+90&&pe>=90-u)&&ne(Q,le,3)}}else if(Rle(oe,$)&&se<=v){const[pe,xe]=oe===3?[Q,le]:[le,Q];Y(M[pe],j),ie(xe,pe,j)<=d&&ne(pe,xe,2)}})}(i,t,e),function(r,s,o={}){const a=he(o.maxHbondDist,ui.maxHbondDist),l=he(o.maxHbondSulfurDist,ui.maxHbondSulfurDist),c=wi(he(o.maxHbondAccAngle,ui.maxHbondAccAngle)),u=wi(he(o.maxHbondDonAngle,ui.maxHbondDonAngle)),h=wi(he(o.maxHbondAccPlaneAngle,ui.maxHbondAccPlaneAngle)),d=wi(he(o.maxHbondDonPlaneAngle,ui.maxHbondDonPlaneAngle)),f=he(o.masterModelIndex,ui.masterModelIndex),m=Math.max(a,l),_=a*a,{features:v,spatialHash:g,contactStore:b,featureSet:p}=s,{types:y,centers:A,atomSets:w}=v,{x:M,y:T,z:E}=A,C=y.length,{idealGeometry:N}=Bf(r.data),P=r.getAtomProxy(),L=r.getAtomProxy();for(let R=0;R<C;++R)g.eachWithin(M[R],T[R],E[R],m,(F,V)=>{if(F<=R)return;const z=y[R],U=y[F],G=Lle(z,U);if(!G&&!Ile(z,U))return;const[B,D]=U===5?[R,F]:[F,R];if(P.index=w[B][0],L.index=w[D][0],L.index===P.index||ug(P,L,f)||P.number!==16&&L.number!==16&&V>_||P.connectedTo(L))return;const O=py(P,L),j=u4.get(N[P.index])||wi(120);if(O.some(le=>Math.abs(j-le)>u))return;if(N[P.index]===3){const le=h4(P,L);if(le!==void 0&&le>d)return}const q=py(L,P),Y=u4.get(N[L.index])||wi(120);if(q.some(le=>Y-le>c))return;if(N[L.index]===3){const le=h4(L,P);if(le!==void 0&&le>h)return}p.setBits(B,D);const ie=G?8:function(le,se){return le.isWater()&&se.isWater()}(ne=P,Q=L)?9:function(le,se){return le.isBackbone()&&se.isBackbone()}(ne,Q)?10:4;var ne,Q;b.addContact(B,D,ie)})}(i,t,e),function(r,s,o={}){const a=he(o.maxMetalDist,ui.maxMetalDist),l=he(o.masterModelIndex,ui.masterModelIndex),{features:c,spatialHash:u,contactStore:h,featureSet:d}=s,{types:f,centers:m,atomSets:_}=c,{x:v,y:g,z:b}=m,p=f.length,y=r.getAtomProxy(),A=r.getAtomProxy();for(let w=0;w<p;++w)u.eachWithin(v[w],g[w],b[w],a,(M,T)=>{if(M<=w||(y.index=_[w][0],A.index=_[M][0],ug(y,A,l)))return;const E=y.isMetal(),C=A.isMetal();if(!E&&!C)return;const[N,P]=E?[f[w],f[M]]:[f[M],f[w]];Nle(N,P)&&(d.setBits(w,M),h.addContact(w,M,7))})}(i,t,e),function(r,s,o={}){const a=he(o.maxHydrophobicDist,ui.maxHydrophobicDist),l=he(o.masterModelIndex,ui.masterModelIndex),{features:c,spatialHash:u,contactStore:h,featureSet:d}=s,{types:f,centers:m,atomSets:_}=c,{x:v,y:g,z:b}=m,p=f.length,y=r.getAtomProxy(),A=r.getAtomProxy();for(let w=0;w<p;++w)u.eachWithin(v[w],g[w],b[w],a,(M,T)=>{var E,C;M<=w||(y.index=_[w][0],A.index=_[M][0],ug(y,A,l)||y.number===9&&A.number===9||y.connectedTo(A)||(E=f[w],C=f[M],E===8&&C===8&&(d.setBits(w,M),h.addContact(w,M,6))))})}(i,t,e),function(r,s,o={}){const a=he(o.maxHalogenBondDist,ui.maxHalogenBondDist),l=wi(he(o.maxHalogenBondAngle,ui.maxHalogenBondAngle)),c=he(o.masterModelIndex,ui.masterModelIndex),{features:u,spatialHash:h,contactStore:d,featureSet:f}=s,{types:m,centers:_,atomSets:v}=u,{x:g,y:b,z:p}=_,y=m.length,A=r.getAtomProxy(),w=r.getAtomProxy();for(let M=0;M<y;++M)h.eachWithin(g[M],b[M],p[M],a,(T,E)=>{if(T<=M||(A.index=v[M][0],w.index=v[T][0],ug(A,w,c))||(C=m[M],N=m[T],!(C===7&&N===6||C===6&&N===7)))return;var C,N;const[P,L]=m[M]===6?[A,w]:[w,A],R=py(P,L);if(R.length!==1||Ole-R[0]>l)return;const F=py(L,P);F.length!==0&&(F.some(V=>Ble-V>l)||(f.setBits(M,T),d.addContact(M,T,5)))})}(i,t,e);const n=function(r){const{index1:s,index2:o,count:a}=r.contactStore,l=GG({nodeArray1:s,nodeArray2:o,edgeCount:a,nodeCount:r.featureSet.length}),c=new or(r.contactStore.count,!0);return Object.assign({adjacencyList:l,contactSet:c},r)}(t);return function(r,s,o={}){pt&&tt.time("refineLineOfSight");const a=he(o.lineOfSightDistFactor,ui.lineOfSightDistFactor),l=he(o.masterModelIndex,ui.masterModelIndex),c=r.spatialHash,{contactSet:u,contactStore:h,features:d}=s,{index1:f,index2:m}=h,{centers:_,atomSets:v}=d,{x:g,y:b,z:p}=_,y=r.getAtomProxy(),A=r.getAtomProxy(),w=r.getAtomProxy(),M=new me,T=new me,E=3*a,C=a*a;u.forEach(N=>{M.set(g[f[N]],b[f[N]],p[f[N]]),T.set(g[m[N]],b[m[N]],p[m[N]]);const P=(M.x+T.x)/2,L=(M.y+T.y)/2,R=(M.z+T.z)/2,F=v[f[N]],V=v[m[N]];y.index=F[0],A.index=V[0],c.eachWithin(P,L,R,E,(z,U)=>{w.index=z,w.number!==1&&w.vdw*w.vdw*C>U&&!p4(y,w,l)&&!p4(A,w,l)&&!F.includes(z)&&!V.includes(z)&&M.distanceToSquared(w)>1&&T.distanceToSquared(w)>1&&(u.clear(N),pt&&tt.log("removing",y.qualifiedName(),A.qualifiedName(),"because",w.qualifiedName()))})}),pt&&tt.timeEnd("refineLineOfSight")}(i,n,e),function(r,s){const{contactSet:o,contactStore:a,features:l}=s,{type:c,index1:u,index2:h}=a,{atomSets:d}=l,f=r.getAtomProxy(),m=r.getAtomProxy(),_={},v=function(g,b,p){const[y,A]=_[p]||[1/0,-1];g<y?(A!==-1&&o.clear(A),_[p]=[g,b]):o.clear(b)};o.forEach(g=>{if(c[g]!==6)return;f.index=d[u[g]][0],m.index=d[h[g]][0];const b=f.distanceTo(m);v(b,g,`${f.index}|${m.residueIndex}`),v(b,g,`${m.index}|${f.residueIndex}`)})}(i,n),e.refineSaltBridges&&function(r,s){const{contactSet:o,contactStore:a,features:l}=s,{type:c,index1:u,index2:h}=a,{atomSets:d}=l,f={},m=function(_,v){f[_]||(f[_]=[]),f[_].push(v)};o.forEach(_=>{c[_]===1&&(d[u[_]].forEach(v=>m(v,_)),d[h[_]].forEach(v=>m(v,_)))}),o.forEach(_=>{if(!function(p){return p===4||p===9||p===10}(c[_]))return;const v=f[d[u[_]][0]],g=f[d[h[_]][0]];if(!v||!g)return;const b=v.length;for(let p=0;p<b;++p)if(g.includes(v[p]))return void o.clear(_)})}(0,n),function(r,s){const{contactSet:o,contactStore:a,features:l}=s,{type:c,index1:u,index2:h}=a,{atomSets:d}=l,f={},m=function(_,v){f[_]||(f[_]=[]),f[_].push(v)};o.forEach(_=>{c[_]===3&&(d[u[_]].forEach(v=>m(v,_)),d[h[_]].forEach(v=>m(v,_)))}),o.forEach(_=>{if(c[_]!==6&&c[_]!==2)return;const v=f[d[u[_]][0]],g=f[d[h[_]][0]];if(!v||!g)return;const b=v.length;for(let p=0;p<b;++p)if(g.includes(v[p]))return void o.clear(_)})}(0,n),function(r,s){const{contactSet:o,contactStore:a,features:l}=s,{type:c,index1:u,index2:h}=a,{atomSets:d}=l,f={},m=function(_,v){f[_]||(f[_]=[]),f[_].push(v)};o.forEach(_=>{c[_]===1&&(d[u[_]].forEach(v=>m(v,_)),d[h[_]].forEach(v=>m(v,_)))}),o.forEach(_=>{if(c[_]!==7)return;const v=f[d[u[_]][0]],g=f[d[h[_]][0]];if(!v||!g)return;const b=v.length;for(let p=0;p<b;++p)if(g.includes(v[p]))return void o.clear(v[p])})}(0,n),pt&&tt.timeEnd("calculateContacts"),n}function Vle(i){switch(i){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}const Hle={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},Fl=new Ht;function $le(i,e,t){const n=wo(t,Hle),r=[];n.hydrogenBond&&r.push(4),n.hydrophobic&&r.push(6),n.halogenBond&&r.push(5),n.ionicInteraction&&r.push(1),n.metalCoordination&&r.push(7),n.cationPi&&r.push(2),n.piStacking&&r.push(3),n.weakHydrogenBond&&r.push(8),n.waterHydrogenBond&&r.push(9),n.backboneHydrogenBond&&r.push(10);const{features:s,contactSet:o,contactStore:a}=i,{centers:l,atomSets:c}=s,{x:u,y:h,z:d}=l,{index1:f,index2:m,type:_}=a,v=[],g=[],b=[],p=[],y=[];let A;return n.filterSele&&(A=Array.isArray(n.filterSele)?n.filterSele.map(w=>e.getAtomSet(new ei(w))):e.getAtomSet(new ei(n.filterSele))),o.forEach(w=>{const M=_[w];if(!r.includes(M))return;if(A){const C=c[f[w]][0],N=c[m[w]][0];if(Array.isArray(A)){if(!(A[0].isSet(C)&&A[1].isSet(N)||A[1].isSet(C)&&A[0].isSet(N)))return}else if(!A.isSet(C)&&!A.isSet(N))return}const T=f[w],E=m[w];v.push(u[T],h[T],d[T]),g.push(u[E],h[E],d[E]),b.push(...function(C){switch(C){case 4:case 9:case 10:return Fl.setHex(2851770).toArray();case 6:return Fl.setHex(8421504).toArray();case 5:return Fl.setHex(4259775).toArray();case 1:return Fl.setHex(15779860).toArray();case 7:return Fl.setHex(9191577).toArray();case 2:return Fl.setHex(16744448).toArray();case 3:return Fl.setHex(9220966).toArray();case 8:return Fl.setHex(12967404).toArray();default:return Fl.setHex(13421772).toArray()}}(M)),p.push(n.radius),y.push(w)}),{position1:new Float32Array(v),position2:new Float32Array(g),color:new Float32Array(b),color2:new Float32Array(b),radius:new Float32Array(p),picking:new jle(y,i,e)}}class gl{constructor(e){this.array=e}get type(){return""}get data(){return{}}getIndex(e){return this.array?this.array[e]:e}getObject(e){return{}}_applyTransformations(e,t,n){return t&&e.applyMatrix4(t.matrix),n&&e.applyMatrix4(n.matrix),e}_getPosition(e){return new me}getPosition(e,t,n){return this._applyTransformations(this._getPosition(e),t,n)}}class Go extends gl{constructor(e){super(),this.shape=e}get primitive(){}get data(){return this.shape}get type(){return this.primitive.type}getObject(e){return this.primitive.objectFromShape(this.shape,this.getIndex(e))}_getPosition(e){return this.primitive.positionFromShape(this.shape,this.getIndex(e))}}class Sd extends gl{constructor(e,t){super(e),this.structure=t}get type(){return"atom"}get data(){return this.structure}getObject(e){return this.structure.getAtomProxy(this.getIndex(e))}_getPosition(e){return new me().copy(this.getObject(e))}}class Wle extends gl{constructor(e){super(),this.axes=e}get type(){return"axes"}get data(){return this.axes}getObject(){return{axes:this.axes}}_getPosition(){return this.axes.center.clone()}}class ZG extends gl{constructor(e,t,n){super(e),this.structure=t,this.bondStore=n||t.bondStore}get type(){return"bond"}get data(){return this.structure}getObject(e){const t=this.structure.getBondProxy(this.getIndex(e));return t.bondStore=this.bondStore,t}_getPosition(e){const t=this.getObject(e);return new me().copy(t.atom1).add(t.atom2).multiplyScalar(.5)}}class jle extends gl{constructor(e,t,n){super(e),this.contacts=t,this.structure=n}get type(){return"contact"}get data(){return this.contacts}getObject(e){const t=this.getIndex(e),{features:n,contactStore:r}=this.contacts,{centers:s,atomSets:o}=n,{x:a,y:l,z:c}=s,{index1:u,index2:h,type:d}=r,f=u[t],m=h[t];return{center1:new me(a[f],l[f],c[f]),center2:new me(a[m],l[m],c[m]),atom1:this.structure.getAtomProxy(o[f][0]),atom2:this.structure.getAtomProxy(o[m][0]),type:Vle(d[t])}}_getPosition(e){const{center1:t,center2:n}=this.getObject(e);return new me().addVectors(t,n).multiplyScalar(.5)}}class Xle extends gl{constructor(e,t,n){super(e),this.validation=t,this.structure=n}get type(){return"clash"}get data(){return this.validation}getObject(e){const t=this.validation,n=this.getIndex(e);return{validation:t,index:n,clash:t.clashArray[n]}}_getAtomProxyFromSele(e){const t=new ei(e),n=this.structure.getAtomIndices(t)[0];return this.structure.getAtomProxy(n)}_getPosition(e){const t=this.getObject(e).clash,n=this._getAtomProxyFromSele(t.sele1),r=this._getAtomProxyFromSele(t.sele2);return new me().copy(n).add(r).multiplyScalar(.5)}}class qle extends ZG{get type(){return"distance"}}class Yle extends gl{get type(){return"ignore"}}class Kle extends Go{constructor(e,t){super(e),this.mesh=t}get type(){return"mesh"}getObject(){const e=this.mesh;return{shape:this.shape,name:e.name,serial:e.serial}}_getPosition(){return this.__position||(this.__position=sC(this.mesh.position)),this.__position}}class Zle extends gl{constructor(e,t){super(e),this.surface=t}get type(){return"surface"}get data(){return this.surface}getObject(e){return{surface:this.surface,index:this.getIndex(e)}}_getPosition(){return this.surface.center.clone()}}class Qle extends gl{constructor(e,t){super(),this.unitcell=e,this.structure=t}get type(){return"unitcell"}get data(){return this.unitcell}getObject(){return{unitcell:this.unitcell,structure:this.structure}}_getPosition(){return this.unitcell.getCenter(this.structure)}}class QG extends gl{constructor(e,t){super(e),this.volume=t}get type(){return"volume"}get data(){return this.volume}getObject(e){const t=this.volume,n=this.getIndex(e);return{volume:t,index:n,value:t.data[n]}}_getPosition(e){const t=this.volume.position,n=this.getIndex(e);return new me(t[3*n],t[3*n+1],t[3*n+2])}}class Jle extends QG{get type(){return"slice"}}function JG(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function eV(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function GR(i,e,t,n,r){var s,o,a,l,c,u,h,d=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]],f=0,m=!1,_=!1,v=!1,g=!1,b=-1,p=e*t*n,y=e,A=e*t,w=new Int32Array(12),M=[],T=[],E=[],C=[],N=JG(),P=eV();function L(D,O,j){return D+(O-D)*j}function R(D,O,j){return A*(j=(j+h)%n)+y*(O=(O+u)%t)+(D=(D+c)%e)}function F(D,O,j,q,Y,ie,ne){var Q=3*D;if(o[Q]<0){var le=(f-ie)/(ne-ie),se=s,oe=3*a;if(M[oe]=j+le,M[oe+1]=q,M[oe+2]=Y,!m){var $=3*D;T[oe]=b*L(se[$],se[$+3],le),T[oe+1]=b*L(se[$+1],se[$+4],le),T[oe+2]=b*L(se[$+2],se[$+5],le)}r&&(C[a]=r[D+Math.round(le)]),o[Q]=a,w[O]=a,a+=1}else w[O]=o[Q]}function V(D,O,j,q,Y,ie,ne){var Q=3*D+1;if(o[Q]<0){var le=(f-ie)/(ne-ie),se=s,oe=3*a;if(M[oe]=j,M[oe+1]=q+le,M[oe+2]=Y,!m){var $=3*D,pe=$+3*y;T[oe]=b*L(se[$],se[pe],le),T[oe+1]=b*L(se[$+1],se[pe+1],le),T[oe+2]=b*L(se[$+2],se[pe+2],le)}r&&(C[a]=r[D+Math.round(le)*y]),o[Q]=a,w[O]=a,a+=1}else w[O]=o[Q]}function z(D,O,j,q,Y,ie,ne){var Q=3*D+2;if(o[Q]<0){var le=(f-ie)/(ne-ie),se=s,oe=3*a;if(M[oe]=j,M[oe+1]=q,M[oe+2]=Y+le,!m){var $=3*D,pe=$+3*A;T[oe]=b*L(se[$],se[pe],le),T[oe+1]=b*L(se[$+1],se[pe+1],le),T[oe+2]=b*L(se[$+2],se[pe+2],le)}r&&(C[a]=r[D+Math.round(le)*A]),o[Q]=a,w[O]=a,a+=1}else w[O]=o[Q]}function U(D){var O=3*D;s[O]===0&&(s[O]=i[(D-1+p)%p]-i[(D+1)%p],s[O+1]=i[(D-y+p)%p]-i[(D+y)%p],s[O+2]=i[(D-A+p)%p]-i[(D+A)%p])}function G(D,O,j,q,Y){var ie,ne,Q,le,se,oe,$;v?(q=R(D,O,j),ie=R(D+1,O,j),ne=R(D,O+1,j),Q=R(D,O,j+1),le=R(D+1,O+1,j),se=R(D+1,O,j+1),oe=R(D,O+1,j+1),$=R(D+1,O+1,j+1)):(ie=q+1,le=(ne=q+y)+1,se=(Q=q+A)+1,$=(oe=ne+A)+1);var pe=0,xe=i[q],Pe=i[ie],ve=i[ne],Ue=i[le],Le=i[Q],Z=i[se],J=i[oe],de=i[$];xe<f&&(pe|=1),Pe<f&&(pe|=2),ve<f&&(pe|=8),Ue<f&&(pe|=4),Le<f&&(pe|=16),Z<f&&(pe|=32),J<f&&(pe|=128),de<f&&(pe|=64);var Ie=N[pe];if(Ie===0)return 0;var te=D+1,X=O+1,ye=j+1;1&Ie&&(m||(U(q),U(ie)),F(q,0,D,O,j,xe,Pe)),2&Ie&&(m||(U(ie),U(le)),V(ie,1,te,O,j,Pe,Ue)),4&Ie&&(m||(U(ne),U(le)),F(ne,2,D,X,j,ve,Ue)),8&Ie&&(m||(U(q),U(ne)),V(q,3,D,O,j,xe,ve)),16&Ie&&(m||(U(Q),U(se)),F(Q,4,D,O,ye,Le,Z)),32&Ie&&(m||(U(se),U($)),V(se,5,te,O,ye,Z,de)),64&Ie&&(m||(U(oe),U($)),F(oe,6,D,X,ye,J,de)),128&Ie&&(m||(U(Q),U(oe)),V(Q,7,D,O,ye,Le,J)),256&Ie&&(m||(U(q),U(Q)),z(q,8,D,O,j,xe,Le)),512&Ie&&(m||(U(ie),U(se)),z(ie,9,te,O,j,Pe,Z)),1024&Ie&&(m||(U(le),U($)),z(le,10,te,X,j,Ue,de)),2048&Ie&&(m||(U(ne),U(oe)),z(ne,11,D,X,j,ve,J));for(var ke,ge,De,$e=pe<<4,Ae=0;P[$e+Ae]!==-1;)ke=P[$e+Ae],ge=P[$e+Ae+1],De=P[$e+Ae+2],_?(d[ke][ge]&Y&&(E[l++]=w[ke],E[l++]=w[ge]),d[ge][De]&Y&&(E[l++]=w[ge],E[l++]=w[De]),d[ke][De]&Y&&(E[l++]=w[ke],E[l++]=w[De])):(E[l++]=w[g?ke:ge],E[l++]=w[g?ge:ke],E[l++]=w[De]),Ae+=3}function B(D,O,j,q,Y,ie){let ne,Q,le,se,oe,$,pe,xe,Pe,ve,Ue,Le,Z;if(D=D!==void 0?D:0,O=O!==void 0?O:0,j=j!==void 0?j:0,q=q!==void 0?q:e-1,Y=Y!==void 0?Y:t-1,ie=ie!==void 0?ie:n-1,v||(m?(D=Math.max(0,D),O=Math.max(0,O),j=Math.max(0,j),q=Math.min(e-1,q),Y=Math.min(t-1,Y),ie=Math.min(n-1,ie)):(D=Math.max(1,D),O=Math.max(1,O),j=Math.max(1,j),q=Math.min(e-2,q),Y=Math.min(t-2,Y),ie=Math.min(n-2,ie))),v)for(xe=D-2,Pe=O-2,ve=j-2,Ue=q+2,Le=Y+2,Z=ie+2,oe=ve;oe<Z;++oe)for(se=Pe;se<Le;++se)for(le=xe;le<Ue;++le)Q=3*R(le,se,oe),o[Q]=-1,o[Q+1]=-1,o[Q+2]=-1;else for(xe=Math.max(0,D-2),Pe=Math.max(0,O-2),ve=Math.max(0,j-2),Ue=Math.min(e,q+2),Le=Math.min(t,Y+2),Z=Math.min(n,ie+2),oe=ve;oe<Z;++oe)for(pe=A*oe,se=Pe;se<Le;++se)for($=pe+y*se,le=xe;le<Ue;++le)ne=3*($+le),o[ne]=-1,o[ne+1]=-1,o[ne+2]=-1;if(!v){var J,de=D,Ie=O,te=j,X=q,ye=Y,ke=ie;for(J=!1,oe=j;oe<ie;++oe){for(se=O;se<Y;++se){for(le=D;le<q;++le)if(ne=e*t*oe+e*se+le,i[ne]>=f){te=oe,J=!0;break}if(J)break}if(J)break}for(J=!1,se=O;se<Y;++se){for(oe=te;oe<ie;++oe){for(le=D;le<q;++le)if(ne=e*t*oe+e*se+le,i[ne]>=f){Ie=se,J=!0;break}if(J)break}if(J)break}for(J=!1,le=D;le<q;++le){for(se=Ie;se<Y;++se){for(oe=te;oe<ie;++oe)if(ne=e*t*oe+e*se+le,i[ne]>=f){de=le,J=!0;break}if(J)break}if(J)break}for(J=!1,oe=ie;oe>=j;--oe){for(se=Y;se>=O;--se){for(le=q;le>=D;--le)if(ne=e*t*oe+e*se+le,i[ne]>=f){ke=oe,J=!0;break}if(J)break}if(J)break}for(J=!1,se=Y;se>=O;--se){for(oe=ke;oe>=j;--oe){for(le=q;le>=D;--le)if(ne=e*t*oe+e*se+le,i[ne]>=f){ye=se,J=!0;break}if(J)break}if(J)break}for(J=!1,le=q;le>=D;--le){for(se=ye;se>=O;--se){for(oe=ke;oe>=j;--oe)if(ne=e*t*oe+e*se+le,i[ne]>=f){X=le,J=!0;break}if(J)break}if(J)break}m?(D=Math.max(0,de-1),O=Math.max(0,Ie-1),j=Math.max(0,te-1),q=Math.min(e-1,X+1),Y=Math.min(t-1,ye+1),ie=Math.min(n-1,ke+1)):(D=Math.max(1,de-1),O=Math.max(1,Ie-1),j=Math.max(1,te-1),q=Math.min(e-2,X+1),Y=Math.min(t-2,ye+1),ie=Math.min(n-2,ke+1))}var ge=15;for(oe=j;oe<ie;++oe,ge&=-5)for(pe=A*oe,ge|=2,se=O;se<Y;++se,ge&=-3)for($=pe+y*se,ge|=1,le=D;le<q;++le,ge&=-2)ne=$+le,G(le,se,oe,ne,ge)}this.triangulate=function(D,O,j,q,Y){g=(f=D)<0,_=q,v=Y,(m=O||_)||(b=f>0?-1:1,s||(s=new Float32Array(3*p)));var ie=3*p;if(o&&o.length===ie||(o=new Int32Array(ie)),a=0,l=0,j!==void 0){var ne=j[0].map(Math.round),Q=j[1].map(Math.round);c=e*Math.ceil(Math.abs(ne[0])/e),u=t*Math.ceil(Math.abs(ne[1])/t),h=n*Math.ceil(Math.abs(ne[2])/n),B(ne[0],ne[1],ne[2],Q[0],Q[1],Q[2])}else c=u=h=0,B();return M.length=3*a,m||(T.length=3*a),E.length=l,r&&(C.length=a),{position:new Float32Array(M),normal:m?void 0:new Float32Array(T),index:fl(E,M.length/3),atomindex:r?new Int32Array(C):void 0,contour:_}}}zo.add("arrow",class extends Go{get primitive(){return RS}}),zo.add("box",class extends Go{get primitive(){return cd}}),zo.add("cone",class extends Go{get primitive(){return IS}}),zo.add("cylinder",class extends Go{get primitive(){return ud}}),zo.add("ellipsoid",class extends Go{get primitive(){return Wp}}),zo.add("octahedron",class extends Go{get primitive(){return CS}}),zo.add("sphere",class extends Go{get primitive(){return $p}}),zo.add("tetrahedron",class extends Go{get primitive(){return PS}}),zo.add("torus",class extends Go{get primitive(){return LS}}),zo.add("point",class extends Go{get primitive(){return Q0}}),zo.add("wideline",class extends Go{get primitive(){return J0}}),Object.assign(GR,{__deps:[JG,eV,fl]});class Fn{constructor(e,t){this.cols=e,this.rows=t,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)}copyTo(e){e.data.set(this.data)}}function Aa(i,e){let t=0,n=0;const r=e.rows,s=e.cols;let o=0,a=0,l=0;const c=e.data,u=i.data;for(;t<r;a+=1,o+=s,t++)for(l=a,n=0;n<s;l+=r,n++)u[l]=c[o+n]}function vx(i,e,t){let n=0,r=0,s=0,o=0,a=0,l=0,c=0;const u=e.cols,h=e.rows,d=t.rows,f=e.data,m=t.data,_=i.data;let v=0;for(;n<h;o+=u,n++)for(l=0,r=0;r<d;c++,r++){for(a=o,v=0,s=0;s<u;a++,l++,s++)v+=f[a]*m[l];_[c]=v}}function qM(i,e,t){const n=i.data,r=e.data,s=t.data,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],d=r[6],f=r[7],m=r[8],_=s[0],v=s[1],g=s[2],b=s[3],p=s[4],y=s[5],A=s[6],w=s[7],M=s[8];n[0]=o*_+a*b+l*A,n[1]=o*v+a*p+l*w,n[2]=o*g+a*y+l*M,n[3]=c*_+u*b+h*A,n[4]=c*v+u*p+h*w,n[5]=c*g+u*y+h*M,n[6]=d*_+f*b+m*A,n[7]=d*v+f*p+m*w,n[8]=d*g+f*y+m*M}function lC(i){const e=i.rows,t=i.cols,n=i.data,r=new Array(t);for(let s=0;s<t;++s)r[s]=0;for(let s=0,o=0;s<e;++s)for(let a=0;a<t;++a,++o)r[a]+=n[o];for(let s=0;s<t;++s)r[s]/=e;return r}function cC(i,e){const t=i.rows,n=i.cols,r=i.data;for(let s=0,o=0;s<t;++s)for(let a=0;a<n;++a,++o)r[o]-=e[a]}function YM(i,e,t,n){n=i[e],i[e]=i[t],i[t]=n}function ece(i,e){return(i=Math.abs(i))>(e=Math.abs(e))?(e/=i,i*Math.sqrt(1+e*e)):e>0?(i/=e,e*Math.sqrt(1+i*i)):0}const tce=1192092896e-16,nce=1e-37;function tV(i,e,t,n){let r=0,s=0;const o=i.rows,a=i.cols;let l=o,c=a;l<c&&(r=1,s=l,l=c,c=s);const u=new Fn(l,l),h=new Fn(1,c),d=new Fn(c,c);if(r===0)Aa(u,i);else{for(s=0;s<a*o;s++)u.data[s]=i.data[s];for(;s<c*l;s++)u.data[s]=0}if(function(f,m,_,v,g,b,p,y){const A=2*tce,w=nce;let M=0,T=0,E=0,C=0;const N=Math.max(b,30);let P=0,L=0,R=0,F=0,V=0,z=0,U=0,G=0,B=0,D=0,O=0,j=0,q=0,Y=0,ie=0,ne=0,Q=0,le=4660,se=0,oe=0,$=0;const pe=new Float64Array(p<<3);for(;M<p;M++){for(E=0,O=0;E<b;E++)G=f[M*m+E],O+=G*G;if(pe[M]=O,v){for(E=0;E<p;E++)v[M*g+E]=0;v[M*g+M]=1}}for(;C<N;C++){for(V=0,M=0;M<p-1;M++)for(T=M+1;T<p;T++){for(P=M*m|0,L=T*m|0,ie=pe[M],ne=0,Q=pe[T],E=2,ne+=f[P]*f[L],ne+=f[P+1]*f[L+1];E<b;E++)ne+=f[P+E]*f[L+E];if(!(Math.abs(ne)<=A*Math.sqrt(ie*Q))){for(ne*=2,j=ie-Q,q=ece(ne,j),j<0?(Y=.5*(q-j),U=Math.sqrt(Y/q),z=ne/(q*U*2)):(z=Math.sqrt((q+j)/(2*q)),U=ne/(q*z*2)),ie=0,Q=0,E=2,B=z*f[P]+U*f[L],D=-U*f[P]+z*f[L],f[P]=B,f[L]=D,ie+=B*B,Q+=D*D,B=z*f[P+1]+U*f[L+1],D=-U*f[P+1]+z*f[L+1],f[P+1]=B,f[L+1]=D,ie+=B*B,Q+=D*D;E<b;E++)B=z*f[P+E]+U*f[L+E],D=-U*f[P+E]+z*f[L+E],f[P+E]=B,f[L+E]=D,ie+=B*B,Q+=D*D;if(pe[M]=ie,pe[T]=Q,V=1,v)for(R=M*g|0,F=T*g|0,E=2,B=z*v[R]+U*v[F],D=-U*v[R]+z*v[F],v[R]=B,v[F]=D,B=z*v[R+1]+U*v[F+1],D=-U*v[R+1]+z*v[F+1],v[R+1]=B,v[F+1]=D;E<p;E++)B=z*v[R+E]+U*v[F+E],D=-U*v[R+E]+z*v[F+E],v[R+E]=B,v[F+E]=D}}if(V===0)break}for(M=0;M<p;M++){for(E=0,O=0;E<b;E++)G=f[M*m+E],O+=G*G;pe[M]=Math.sqrt(O)}for(M=0;M<p-1;M++){for(T=M,E=M+1;E<p;E++)pe[T]<pe[E]&&(T=E);if(M!==T&&(YM(pe,M,T,O),v)){for(E=0;E<b;E++)YM(f,M*m+E,T*m+E,G);for(E=0;E<p;E++)YM(v,M*g+E,T*g+E,G)}}for(M=0;M<p;M++)_[M]=pe[M];if(v)for(M=0;M<y;M++){for(O=M<p?pe[M]:0;O<=w;){for(oe=1/b,E=0;E<b;E++)le=214013*le+2531011,se=256&le>>16?oe:-oe,f[M*m+E]=se;for(C=0;C<2;C++)for(T=0;T<M;T++){for(O=0,E=0;E<b;E++)O+=f[M*m+E]*f[T*m+E];for($=0,E=0;E<b;E++)G=f[M*m+E]-O*f[T*m+E],f[M*m+E]=G,$+=Math.abs(G);for($=$?1/$:0,E=0;E<b;E++)f[M*m+E]*=$}for(O=0,E=0;E<b;E++)G=f[M*m+E],O+=G*G;O=Math.sqrt(O)}for(U=1/O,E=0;E<b;E++)f[M*m+E]*=U}}(u.data,l,h.data,d.data,c,l,c,l),e){for(s=0;s<c;s++)e.data[s]=h.data[s];for(;s<a;s++)e.data[s]=0}r===0?(t&&Aa(t,u),n&&Aa(n,d)):(t&&Aa(t,d),n&&Aa(n,u))}function Lg(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function yp(i,e,t,n,r,s,o,a,l,c,u,h,d,f,m,_,v){i[0]=e,i[4]=t,i[8]=n,i[12]=r,i[1]=s,i[5]=o,i[9]=a,i[13]=l,i[2]=c,i[6]=u,i[10]=h,i[14]=d,i[3]=f,i[7]=m,i[11]=_,i[15]=v}function _x(i,e,t){const n=e[0],r=e[4],s=e[8],o=e[12],a=e[1],l=e[5],c=e[9],u=e[13],h=e[2],d=e[6],f=e[10],m=e[14],_=e[3],v=e[7],g=e[11],b=e[15],p=t[0],y=t[4],A=t[8],w=t[12],M=t[1],T=t[5],E=t[9],C=t[13],N=t[2],P=t[6],L=t[10],R=t[14],F=t[3],V=t[7],z=t[11],U=t[15];i[0]=n*p+r*M+s*N+o*F,i[4]=n*y+r*T+s*P+o*V,i[8]=n*A+r*E+s*L+o*z,i[12]=n*w+r*C+s*R+o*U,i[1]=a*p+l*M+c*N+u*F,i[5]=a*y+l*T+c*P+u*V,i[9]=a*A+l*E+c*L+u*z,i[13]=a*w+l*C+c*R+u*U,i[2]=h*p+d*M+f*N+m*F,i[6]=h*y+d*T+f*P+m*V,i[10]=h*A+d*E+f*L+m*z,i[14]=h*w+d*C+f*R+m*U,i[3]=_*p+v*M+g*N+b*F,i[7]=_*y+v*T+g*P+b*V,i[11]=_*A+v*E+g*L+b*z,i[15]=_*w+v*C+g*R+b*U}function uC(i,e,t,n){yp(i,e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1)}function hC(i,e,t,n){yp(i,1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1)}function dC(i,e){const t=Math.cos(e),n=Math.sin(e);yp(i,t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1)}function nV(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function VR(i,e){const t=en([e[0],e[1],e[2]]),n=en([e[4],e[5],e[6]]),r=en([e[8],e[9],e[10]]),s=en();Zs(s,n,r),i[0]=s[0],i[1]=s[1],i[2]=s[2],Zs(s,r,t),i[3]=s[0],i[4]=s[1],i[5]=s[2],Zs(s,t,n),i[6]=s[0],i[7]=s[1],i[8]=s[2]}function HR(i,e,t,n){t=t||1,n=n||!0;const r=i.length/3,s=e.length/3;let o;n&&(o=new Float32Array(3*r));const a=new Float32Array(3*r);let l;const c=new Array(20);for(l=0;l<20;++l)c[l]=new Uint32Array(r);for(l=0;l<r;++l)c[0][l]=0;let u,h,d;for(l=0;l<s;++l){var f=3*l,m=3*l+1,_=3*l+2;for(d=!0,u=0,h=c[0][e[f]];u<h;++u)if(e[m]===c[u+1][e[f]]){d=!1;break}for(d&&(c[0][e[f]]++,c[c[0][e[f]]][e[f]]=e[m]),d=!0,u=0,h=c[0][e[f]];u<h;++u)if(e[_]===c[u+1][e[f]]){d=!1;break}for(d&&(c[0][e[f]]++,c[c[0][e[f]]][e[f]]=e[_]),d=!0,u=0,h=c[0][e[m]];u<h;++u)if(e[f]===c[u+1][e[m]]){d=!1;break}for(d&&(c[0][e[m]]++,c[c[0][e[m]]][e[m]]=e[f]),d=!0,u=0,h=c[0][e[m]];u<h;++u)if(e[_]===c[u+1][e[m]]){d=!1;break}for(d&&(c[0][e[m]]++,c[c[0][e[m]]][e[m]]=e[_]),d=!0,u=0;u<c[0][e[_]];++u)if(e[f]===c[u+1][e[_]]){d=!1;break}for(d&&(c[0][e[_]]++,c[c[0][e[_]]][e[_]]=e[f]),d=!0,u=0,h=c[0][e[_]];u<h;++u)if(e[m]===c[u+1][e[_]]){d=!1;break}d&&(c[0][e[_]]++,c[c[0][e[_]]][e[_]]=e[m])}for(var v,g,b,p,y,A=.5,w=.75/4.5,M=0;M<t;++M){for(l=0;l<r;++l)if(v=3*l,(b=c[0][l])<3)a[v]=i[v],a[v+1]=i[v+1],a[v+2]=i[v+2];else if(b===3||b===4){for(a[v]=0,a[v+1]=0,a[v+2]=0,u=0;u<b;++u)g=3*c[u+1][l],a[v]+=i[g],a[v+1]+=i[g+1],a[v+2]+=i[g+2];a[v]+=A*i[v],a[v+1]+=A*i[v+1],a[v+2]+=A*i[v+2],y=A+b,a[v]/=y,a[v+1]/=y,a[v+2]/=y}else{for(a[v]=0,a[v+1]=0,a[v+2]=0,u=0;u<b;++u)g=3*c[u+1][l],a[v]+=i[g],a[v+1]+=i[g+1],a[v+2]+=i[g+2];a[v]+=1*i[v],a[v+1]+=1*i[v+1],a[v+2]+=1*i[v+2],p=1+b,a[v]/=p,a[v+1]/=p,a[v+2]/=p}if(i.set(a),n){t1(i,e,o);var T=3*r;for(v=0;v<T;v+=3)i[v]+=-1*w*o[v],i[v+1]+=-1*w*o[v+1],i[v+2]+=-1*w*o[v+2]}}}function t1(i,e,t){var n,r;if(t===void 0)t=new Float32Array(i.length);else for(n=0,r=t.length;n<r;n++)t[n]=0;var s=new Float32Array(3),o=new Float32Array(3),a=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3);if(e)for(n=0,r=e.length;n<r;n+=3){var u=3*e[n],h=3*e[n+1],d=3*e[n+2];bs(s,i,u),bs(o,i,h),bs(a,i,d),fi(l,a,o),fi(c,s,o),Zs(l,l,c),t[u]+=l[0],t[u+1]+=l[1],t[u+2]+=l[2],t[h]+=l[0],t[h+1]+=l[1],t[h+2]+=l[2],t[d]+=l[0],t[d+1]+=l[1],t[d+2]+=l[2]}else for(n=0,r=i.length;n<r;n+=9)bs(s,i,n),bs(o,i,n+3),bs(a,i,n+6),fi(l,a,o),fi(c,s,o),Zs(l,l,c),t[n]=l[0],t[n+1]=l[1],t[n+2]=l[2],t[n+3]=l[0],t[n+4]=l[1],t[n+5]=l[2],t[n+6]=l[0],t[n+7]=l[1],t[n+8]=l[2];return UG(t),t}function iV(i){for(var e={},t=0,n=i.length;t<n;++t)e[i[t]]=!0;return e}function n1(i,e,t,n,r){var s=1/n*3;BG(i,i,r+(s+=t)),gx(e,e,r+s),zn(i,i,n),oC(i,i),sp(i,i,n),zn(e,e,n),Rg(e,e),sp(e,e,n);var o=new Float32Array(3);fi(o,e,i),zn(o,o,n),Rg(o,o),gx(o,o,1);var a=256*Math.pow(10,6),l=o[0]*o[1]*o[2]*3;a<=l&&(zn(i,i,n*=Math.pow(a/l,1/3)),oC(i,i),sp(i,i,n),zn(e,e,n),Rg(e,e),sp(e,e,n),fi(o,e,i),zn(o,o,n),Rg(o,o),gx(o,o,1));var c=new Float32Array(i);TS(c,c);var u=Lg(),h=Lg();dC(h,wi(90)),_x(u,u,h);var d=Lg();uC(d,-1/n,1/n,1/n),_x(u,u,d);var f=Lg();return hC(f,-n*c[2],-n*c[1],-n*c[0]),_x(u,u,f),{dim:o,tran:c,matrix:u,scaleFactor:n}}uC.__deps=[yp],hC.__deps=[yp],dC.__deps=[yp],VR.__deps=[en,Zs],Object.assign(HR,{__deps:[t1]}),Object.assign(t1,{__deps:[fi,Zs,bs,UG]}),Object.assign(n1,{__deps:[wi,BG,gx,sp,zn,oC,Rg,fi,TS,Lg,_x,hC,uC,dC]});class DS{constructor(e,t,n){this.name=e||"",this.path=t||"",this.info={},this.center=new me,this.boundingBox=new Ti,n instanceof nr||n instanceof Xn?this.fromGeometry(n):n&&(this.set(n.position,n.index,n.normal,n.color,n.atomindex,n.contour),this.boundingBox.setFromArray(n.position),this.boundingBox.getCenter(this.center))}get type(){return"Surface"}set(e,t,n,r,s,o=!1){this.position=e,this.index=t,this.normal=n,this.color=r,this.atomindex=s,this.size=e.length/3,this.contour=o}fromGeometry(e){let t,n,r,s;if(pt&&tt.time("GeometrySurface.fromGeometry"),t=e instanceof nr?e:e[0],t.boundingBox||t.computeBoundingBox(),this.boundingBox.copy(t.boundingBox),this.boundingBox.getCenter(this.center),t instanceof nr){const o=t.attributes,a=!!o.normal&&o.normal.array;(!a||a[0]===0&&a[1]===0&&a[2]===0)&&t.computeVertexNormals(),n=o.position.array,r=o.index?o.index.array:null,s=o.normal.array}this.set(n,r,s,void 0,void 0),pt&&tt.timeEnd("GeometrySurface.setGeometry")}getPosition(){return this.position}getColor(e){const t=e||{};t.surface=this;const n=this.size,r=new Float32Array(3*n),s=gn.getScheme(t);if(s.volumeColor||t.scheme==="random")for(let a=0;a<n;++a)s.volumeColorToArray(a,r,3*a);else if(s.positionColor){const a=new me,l=this.position;for(let c=0;c<n;++c){var o=3*c;a.set(l[o],l[o+1],l[o+2]),s.positionColorToArray(a,r,o)}}else if(s.atomColor&&this.atomindex){const a=t.structure.getAtomProxy(),l=this.atomindex;for(let c=0;c<n;++c)a.index=l[c],s.atomColorToArray(a,r,3*c)}else{const a=new Ht(t.value);Bn(n,a.r,a.g,a.b,r)}return r}getPicking(e){return this.atomindex&&e?new Sd(this.atomindex,e):new Zle(lm(this.size),this)}getNormal(){return this.normal}getSize(e,t){return Mo(this.size,e*t)}getIndex(){return this.index}getFilteredIndex(e,t){if(e&&this.atomindex){const n=new ei(e),r=t.getAtomSet(n),s=[],o=this.atomindex,a=this.index,l=a.length,c=this.contour?2:3;let u=0;for(let h=0;h<l;h+=c){let d=!0;for(let f=0;f<c;f++){const m=o[a[h+f]];if(!r.get(m)){d=!1;break}}if(d)for(let f=0;f<c;f++,u++)s[u]=a[h+f]}return fl(s,this.position.length/3)}return this.index}getAtomindex(){return this.atomindex}dispose(){}}function yu(i,e,t,n,r){var s=new GR(i,e,t,n,r);this.getSurface=function(o,a,l,c,u,h=!1){const d=s.triangulate(o,a,l,u,h);if(a&&!u&&(HR(d.position,d.index,a,!0),d.normal=t1(d.position,d.index)),c&&(ES(c,d.position),d.normal)){const f=nV();VR(f,c),zR(f,d.normal)}return d}}Object.assign(yu,{__deps:[HR,t1,GR,ES,zR,nV,VR]}),t0.add("surf",function(i,e){const t=i.data.args,n=i.data.params;if(t&&(self.volsurf=new yu(t[0],t[1],t[2],t[3],t[4])),n){const r=self.volsurf.getSurface(n.isolevel,n.smooth,n.box,n.matrix,n.contour,n.wrap),s=[r.position.buffer,r.index.buffer];r.normal&&s.push(r.normal.buffer),r.atomindex&&s.push(r.atomindex.buffer),e({sd:r,p:n},s)}},[yu]);class zs{constructor(e,t,n,r,s,o,a){this.name=e,this.path=t,this.matrix=new Tt,this.normalMatrix=new mn,this.inverseMatrix=new Tt,this.center=new me,this.boundingBox=new Ti,this.setData(n,r,s,o,a)}get type(){return"Volume"}setData(e,t,n,r,s){this.nx=t||1,this.ny=n||1,this.nz=r||1,this.data=e||new Float32Array(1),this.setAtomindex(s),delete this._position,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()}setStats(e,t,n,r){this._min=e,this._max=t,this._mean=n,this._rms=r}setMatrix(e){this.matrix.copy(e);const t=this.boundingBox,n=this.center,r=this.nx-1,s=this.ny-1,o=this.nz-1;t.makeEmpty(),t.expandByPoint(n.set(r,s,o)),t.expandByPoint(n.set(r,s,0)),t.expandByPoint(n.set(r,0,o)),t.expandByPoint(n.set(r,0,0)),t.expandByPoint(n.set(0,s,o)),t.expandByPoint(n.set(0,0,o)),t.expandByPoint(n.set(0,s,0)),t.expandByPoint(n.set(0,0,0)),t.applyMatrix4(this.matrix),t.getCenter(this.center);const a=this.matrix.elements,l=new me(a[0],a[1],a[2]),c=new me(a[4],a[5],a[6]),u=new me(a[8],a[9],a[10]),h=new me,d=this.normalMatrix.elements;h.crossVectors(c,u),d[0]=h.x,d[1]=h.y,d[2]=h.z,h.crossVectors(u,l),d[3]=h.x,d[4]=h.y,d[5]=h.z,h.crossVectors(l,c),d[6]=h.x,d[7]=h.y,d[8]=h.z,this.inverseMatrix.copy(this.matrix).invert()}setAtomindex(e){this.atomindex=e}getBox(e,t,n){return n||(n=new Ti),n.set(e,e),n.expandByScalar(t),n.applyMatrix4(this.inverseMatrix),n.min.round(),n.max.round(),n}_getBox(e,t){if(!e||!t)return;this.__box||(this.__box=new Ti);const n=this.getBox(e,t,this.__box);return[n.min.toArray(),n.max.toArray()]}_makeSurface(e,t,n){const r=this.name+"@"+t.toPrecision(2),s=new DS(r,"",e);return s.info.isolevel=t,s.info.smooth=n,s.info.volume=this,s}getSurface(e,t,n,r,s,o=!1){e=isNaN(e)?this.getValueForSigma(2):e,t=he(t,0),this.volsurf===void 0&&(this.volsurf=new yu(this.data,this.nx,this.ny,this.nz,this.atomindex));const a=this._getBox(n,r),l=this.volsurf.getSurface(e,t,a,this.matrix.elements,s,o);return this._makeSurface(l,e,t)}getSurfaceWorker(e,t,n,r,s,o,a){if(e=isNaN(e)?this.getValueForSigma(2):e,t=t||0,window.hasOwnProperty("Worker")){this.workerPool===void 0&&(this.workerPool=new rC("surf",2));const l={},c=this.workerPool.getNextWorker();c.postCount===0&&Object.assign(l,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(l,{params:{isolevel:e,smooth:t,box:this._getBox(n,r),matrix:this.matrix.elements,contour:s,wrap:o}}),c.post(l,void 0,u=>{const h=u.data.sd,d=u.data.p;a(this._makeSurface(h,d.isolevel,d.smooth))},u=>{console.warn("Volume.getSurfaceWorker error - trying without worker",u);const h=this.getSurface(e,t,n,r,s,o);a(h)})}else{const l=this.getSurface(e,t,n,r,s,o);a(l)}}getValueForSigma(e){return this.mean+he(e,2)*this.rms}getSigmaForValue(e){return(he(e,0)-this.mean)/this.rms}get position(){if(!this._position){const e=this.nz,t=this.ny,n=this.nx,r=new Float32Array(n*t*e*3);let s=0;for(let o=0;o<e;++o)for(let a=0;a<t;++a)for(let l=0;l<n;++l)r[s+0]=l,r[s+1]=a,r[s+2]=o,s+=3;ES(this.matrix.elements,r),this._position=r}return this._position}getDataAtomindex(){return this.atomindex}getDataPosition(){return this.position}getDataColor(e){const t=e||{};t.volume=this,t.scale=t.scale||"Spectral",t.domain=t.domain||[this.min,this.max];const n=gn.getScheme(t),r=this.position.length/3,s=new Float32Array(3*r);for(let o=0;o<r;++o)n.volumeColorToArray(o,s,3*o);return s}getDataPicking(){const e=lm(this.position.length/3);return new QG(e,this)}getDataSize(e,t){const n=this.data,r=this.position.length/3;let s;switch(e){case"value":case"deviation":s=new Float32Array(n);break;case"abs-value":s=new Float32Array(n);for(let o=0;o<r;++o)s[o]=Math.abs(s[o]);break;case"value-min":{s=new Float32Array(n);const o=this.min;for(let a=0;a<r;++a)s[a]-=o;break}default:s=Mo(r,e)}if(t!==1)for(let o=0;o<r;++o)s[o]*=t;return s}get min(){return this._min===void 0&&(this._min=px(this.data)),this._min}get max(){return this._max===void 0&&(this._max=fx(this.data)),this._max}get sum(){return this._sum===void 0&&(this._sum=BR(this.data)),this._sum}get mean(){return this._mean===void 0&&(this._mean=mx(this.data)),this._mean}get rms(){return this._rms===void 0&&(this._rms=function(e){const t=e.length;let n=0;for(let r=0;r<t;++r){const s=e[r];n+=s*s}return Math.sqrt(n/t)}(this.data)),this._rms}clone(){const e=new zs(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return e.matrix.copy(this.matrix),e.header=Object.assign({},this.header),e}dispose(){this.workerPool&&this.workerPool.terminate()}}function m4(i){return i==="front"?uc:i==="back"?Es:Qa}An.add("shader/Mesh.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#elif defined( NOLIGHT )
vColor = color;
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),An.add("shader/Mesh.frag",`#define STANDARD
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#elif defined( NOLIGHT )
gl_FragColor = vec4( vColor, opacity );
#else
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
#include interior_fragment
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#include opaque_back_fragment
#endif
}`);const g4={f:1,v2:2,v3:3,c:3};function KM(i,e){i.matrix.copy(e),i.matrix.decompose(i.position,i.quaternion,i.scale),i.matrixWorldNeedsUpdate=!0}const Ls={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new me,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new Tt,disablePicking:!1,sortParticles:!1,background:!1},wd={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}};class pl{constructor(e,t={}){this.parameterTypes=wd,this.geometry=new nr,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new Xn,this.wireframeGroup=new Xn,this.pickingGroup=new Xn,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=wo(t,this.defaultParameters),this.uniforms=ux.merge([Ft.common,{fogColor:{value:new Ht(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new Ht(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new Ht(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},Ft.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};const n=e.position||e.position1;this._positionDataSize=n?n.length/3:0,e.primitiveId||(e.primitiveId=lm(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:e.position},color:{type:"c",value:e.color},primitiveId:{type:"f",value:e.primitiveId}}),t.matrix&&(this.matrix=t.matrix),e.index&&this.initIndex(e.index),this.picking=e.picking,this.makeWireframeGeometry()}get defaultParameters(){return Ls}set matrix(e){this.setMatrix(e)}get matrix(){return this.group.matrix.clone()}get transparent(){return this.parameters.opacity<1||this.parameters.forceTransparent}get size(){return this._positionDataSize}get attributeSize(){return this.size}get pickable(){return!!this.picking&&!this.parameters.disablePicking}setMatrix(e){KM(this.group,e),KM(this.wireframeGroup,e),KM(this.pickingGroup,e)}initIndex(e){this.geometry.setIndex(new Hi(e,1));const t=this.geometry.getIndex();t?t.setUsage(this.dynamic?pf:Kc):tt.error("Index is null")}makeMaterial(){const e=m4(this.parameters.side),t=new Yo({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:e});t.vertexColors=!0,t.extensions.derivatives=!0,t.extensions.fragDepth=this.isImpostor;const n=new Yo({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:e});n.vertexColors=!0;const r=new Yo({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:e,blending:tc});r.vertexColors=!0,r.extensions.fragDepth=this.isImpostor,t.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,r.clipNear=this.parameters.clipNear,this.material=t,this.wireframeMaterial=n,this.pickingMaterial=r,this.updateShader()}makeWireframeGeometry(){this.makeWireframeIndex();const e=this.geometry,t=this.wireframeIndex,n=new nr;n.attributes=e.attributes,t&&(n.setIndex(new Hi(t,1).setUsage(this.dynamic?pf:Kc)),n.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=n}makeWireframeIndex(){const e=[];function t(s,o){if(s>o){const l=s;s=o,o=l}const a=e[s];return a===void 0?(e[s]=[o],!0):!a.includes(o)&&(a.push(o),!0)}const n=this.geometry,r=n.index;if(this.parameters.wireframe)if(r){const s=r.array;let o,a=s.length;n.drawRange.count!==1/0&&(a=n.drawRange.count),this.wireframeIndex&&this.wireframeIndex.length>2*a?o=this.wireframeIndex:o=fl(2*a,n.attributes.position.count);let l=0;e.length=0;for(let c=0;c<a;c+=3){const u=s[c+0],h=s[c+1],d=s[c+2];t(u,h)&&(o[l+0]=u,o[l+1]=h,l+=2),t(h,d)&&(o[l+0]=h,o[l+1]=d,l+=2),t(d,u)&&(o[l+0]=d,o[l+1]=u,l+=2)}this.wireframeIndex=o,this.wireframeIndexCount=l,this.wireframeIndexVersion=this.indexVersion}else{const s=n.attributes.position.count;let o;o=this.wireframeIndex&&this.wireframeIndex.length>2*s?this.wireframeIndex:fl(2*s,s);for(let a=0,l=0;a<s;a+=3)o[l+0]=a,o[l+1]=a+1,o[l+2]=a+1,o[l+3]=a+2,o[l+4]=a+2,o[l+5]=a,l+=6;this.wireframeIndex=o,this.wireframeIndexCount=2*s,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0}updateWireframeIndex(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new Hi(this.wireframeIndex,1).setUsage(this.dynamic?pf:Kc));else{const e=this.wireframeGeometry.getIndex();if(!e)return void tt.error("Index is null");e.set(this.wireframeIndex),e.needsUpdate=this.wireframeIndexCount>0,e.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}}getRenderOrder(){let e=0;return this.isText?e=1:this.transparent&&(e=this.isSurface?3:2),e}_getMesh(e){this.material||this.makeMaterial();const t=this.geometry,n=this[e];let r;return r=this.isLine?new QT(t,n):this.isPoint?new yG(t,n):new el(t,n),r.frustumCulled=!1,r.renderOrder=this.getRenderOrder(),r}getMesh(){return this._getMesh("material")}getWireframeMesh(){let e;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),e=new QT(this.wireframeGeometry,this.wireframeMaterial),e.frustumCulled=!1,e.renderOrder=this.getRenderOrder(),e}getPickingMesh(){return this._getMesh("pickingMaterial")}getShader(e,t){return Pg(e,this.getDefines(t))}getVertexShader(e){return this.getShader(this.vertexShader,e)}getFragmentShader(e){return this.getShader(this.fragmentShader,e)}getDefines(e){const t={};return this.parameters.clipNear&&(t.NEAR_CLIP=1),this.parameters.clipRadius&&(t.RADIUS_CLIP=1),e==="picking"?t.PICKING=1:((e==="background"||this.parameters.background)&&(t.NOLIGHT=1),this.parameters.flatShaded&&(t.FLAT_SHADED=1),this.parameters.opaqueBack&&(t.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(t.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(t.USE_INTERIOR_COLOR=1)),t}getParameters(){return this.parameters}addUniforms(e){this.uniforms=ux.merge([this.uniforms,e]),this.pickingUniforms=ux.merge([this.pickingUniforms,e])}addAttributes(e){for(let t in e){let n;const r=e[t],s=this.attributeSize*g4[r.type];r.value?(s!==r.value.length&&tt.error("attribute value has wrong length",t),n=r.value):n=MG("float32",s),this.geometry.setAttribute(t,new Hi(n,g4[r.type]).setUsage(this.dynamic?pf:Kc))}}updateRenderOrder(){const e=this.getRenderOrder();function t(n){n.renderOrder=e}this.group.children.forEach(t),this.pickingGroup&&this.pickingGroup.children.forEach(t)}updateShader(){const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.vertexShader=this.getVertexShader(),e.fragmentShader=this.getFragmentShader(),e.needsUpdate=!0,t.vertexShader=this.getShader("Line.vert"),t.fragmentShader=this.getShader("Line.frag"),t.needsUpdate=!0,n.vertexShader=this.getVertexShader("picking"),n.fragmentShader=this.getFragmentShader("picking"),n.needsUpdate=!0}setParameters(e){const t=e,n=this.parameterTypes,r=this.parameters,s={},o={};let a=!1,l=!1;for(const c in t){const u=t[c];u!==void 0&&(r[c]=u,n[c]!==void 0&&(n[c].property&&(n[c].property!==!0?s[n[c].property]=u:s[c]=u),n[c].uniform&&(n[c].uniform!==!0?o[n[c].uniform]=u:o[c]=u),n[c].updateShader&&(a=!0),n[c].updateVisibility&&(l=!0),this.dynamic&&c==="wireframe"&&u===!0&&this.updateWireframeIndex(),c==="forceTransparent"&&(s.transparent=this.transparent),c==="matrix"&&(this.matrix=u)))}this.setProperties(s),this.setUniforms(o),a&&this.updateShader(),l&&this.setVisibility(this.visible)}setAttributes(e){const t=this.geometry,n=t.attributes;for(const r in e){if(r==="picking")continue;const s=e[r],o=s.length;if(r==="index"){const a=t.getIndex();if(!a){tt.error("Index is null");continue}t.setDrawRange(0,1/0),o>a.array.length?t.setIndex(new Hi(s,1).setUsage(this.dynamic?pf:Kc)):(a.set(s),a.needsUpdate=o>0,a.updateRange.count=o,t.setDrawRange(0,o)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{const a=n[r];o>a.array.length?t.setAttribute(r,new Hi(s,a.itemSize).setUsage(this.dynamic?pf:Kc)):(n[r].set(s),n[r].needsUpdate=o>0,n[r].updateRange.count=o)}}}setUniforms(e){if(!e)return;const t=this.material.uniforms,n=this.wireframeMaterial.uniforms,r=this.pickingMaterial.uniforms;for(let s in e)s==="opacity"&&this.setProperties({transparent:this.transparent}),t[s]!==void 0&&(t[s].value.isVector3?t[s].value.copy(e[s]):t[s].value.set?t[s].value.set(e[s]):t[s].value=e[s]),n[s]!==void 0&&(n[s].value.isVector3?n[s].value.copy(e[s]):n[s].value.set?n[s].value.set(e[s]):n[s].value=e[s]),r[s]!==void 0&&(r[s].value.isVector3?r[s].value.copy(e[s]):r[s].value.set?r[s].value.set(e[s]):r[s].value=e[s])}setProperties(e){if(!e)return;const t=this.material,n=this.wireframeMaterial,r=this.pickingMaterial;for(const s in e){const o=s;let a=e[o];o==="transparent"?this.updateRenderOrder():o==="side"&&(a=m4(a)),t[o]=a,n[o]=a,r[o]=a}t.needsUpdate=!0,n.needsUpdate=!0,r.needsUpdate=!0}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()}toJSON(){var e={};for(var t in this)t!=="group"&&t!=="wireframeGroup"&&t!="pickingGroup"&&t!=="picking"&&(e[t]=this[t]);return e}}class dc extends pl{constructor(e,t={}){super(e,t),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:e.normal}}),e.normal===void 0&&this.geometry.computeVertexNormals()}}class rV extends dc{constructor(){super(...arguments),this.isSurface=!0}}function my(i){i.visible=!0}function v4(i){i.visible=!1}class sV{constructor(e){this.group=new Xn,this.wireframeGroup=new Xn,this.pickingGroup=new Xn,this.frontMeshes=[],this.backMeshes=[],this.size=e.size,this.side=e.parameters.side,this.visible=e.visible,this.geometry=e.geometry,this.picking=e.picking,this.group=new Xn,this.wireframeGroup=new Xn,this.pickingGroup=new Xn,this.matrix=e.matrix;const t=e,n=new e.constructor({position:new Float32Array(0)});t.makeMaterial(),n.makeMaterial(),n.picking=e.picking,n.geometry=e.geometry,n.wireframeGeometry=e.wireframeGeometry,n.setParameters(e.getParameters()),n.updateShader(),t.setParameters({side:"front"}),n.setParameters({side:"back",opacity:n.parameters.opacity}),this.buffer=e,this.frontBuffer=t,this.backBuffer=n}set matrix(e){pl.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking&&!this.parameters.disablePicking}get parameters(){return this.buffer.parameters}getParameters(){const e=Object.assign({},this.buffer.parameters);return e.side=this.side,e}getMesh(e){let t,n;return e?(n=this.backBuffer.getPickingMesh(),t=this.frontBuffer.getPickingMesh()):(n=this.backBuffer.getMesh(),t=this.frontBuffer.getMesh()),this.frontMeshes.push(t),this.backMeshes.push(n),this.setParameters({side:this.side}),new Xn().add(n,t)}getWireframeMesh(){return this.buffer.getWireframeMesh()}getPickingMesh(){return this.getMesh(!0)}setAttributes(e){this.buffer.setAttributes(e)}setParameters(e){(e=Object.assign({},e)).side==="front"?(this.frontMeshes.forEach(my),this.backMeshes.forEach(v4)):e.side==="back"?(this.frontMeshes.forEach(v4),this.backMeshes.forEach(my)):e.side==="double"&&(this.frontMeshes.forEach(my),this.backMeshes.forEach(my)),e.side!==void 0&&(this.side=e.side),delete e.side,e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,this.frontBuffer.setParameters(e),e.wireframe!==void 0&&(this.wireframe=e.wireframe,this.setVisibility(this.visible)),delete e.wireframe,this.backBuffer.setParameters(e)}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.frontBuffer.dispose(),this.backBuffer.dispose()}toJSON(){var e={};for(var t in this)["side","size","visible","matrix","parameters"].includes(t)&&(e[t]=this[t]);return e}}An.add("shader/Line.vert",`uniform float clipNear;
uniform vec3 clipCenter;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include color_pars_vertex
void main(){
#include color_vertex
#include begin_vertex
#include project_vertex
vViewPosition = -mvPosition.xyz;
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),An.add("shader/Line.frag",`uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
void main(){
#include nearclip_fragment
#include radiusclip_fragment
gl_FragColor = vec4( vColor, opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`);class oV extends pl{constructor(){super(...arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}}class fC extends C1{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),e instanceof zs?(this.surface=void 0,this.volume=e):(this.surface=e,this.volume=void 0),this.boxCenter=new me,this.__boxCenter=new me,this.box=new Ti,this.__box=new Ti,this._position=new me,this.inverseMatrix=new Tt,this.setBox=function(){this._position.copy(t.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(n)}init(e){const t=e||{};t.colorScheme=he(t.colorScheme,"uniform"),t.colorValue=he(t.colorValue,14540253),this.isolevelType=he(t.isolevelType,"sigma"),this.isolevel=he(t.isolevel,2),this.negateIsolevel=he(t.negateIsolevel,!1),this.isolevelScroll=he(t.isolevelScroll,!1),this.smooth=he(t.smooth,0),this.background=he(t.background,!1),this.opaqueBack=he(t.opaqueBack,!0),this.boxSize=he(t.boxSize,0),this.colorVolume=he(t.colorVolume,void 0),this.contour=he(t.contour,!1),this.useWorker=he(t.useWorker,!0),this.wrap=he(t.wrap,!1),super.init(t),this.inverseMatrix.copy(this.matrix).invert(),this.build()}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t)}),this.setVisibility(this.visible),e()}prepare(e){if(this.volume){let t;if(t=this.isolevelType==="sigma"?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(t*=-1),!this.surface||this.__isolevel!==t||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=t,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);const n=r=>{this.surface=r,e()};this.useWorker?this.volume.getSurfaceWorker(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,n):n(this.volume.getSurface(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else e()}else e()}create(){const e={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};let t;if(this.contour)t=new oV(e,this.getBufferParams({wireframe:!1}));else{Object.assign(e,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});const n=new rV(e,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));t=new sV(n)}this.bufferList.push(t)}update(e){if(this.bufferList.length===0)return;const t={};(e=e||{}).position&&(t.position=this.surface.getPosition()),e.color&&(t.color=this.surface.getColor(this.getColorParams())),e.index&&(t.index=this.surface.getIndex()),e.normal&&(t.normal=this.surface.getNormal()),this.bufferList.forEach(function(n){n.setAttributes(t)})}setParameters(e,t,n){return e&&e.isolevelType!==void 0&&this.volume&&(this.isolevelType==="value"&&e.isolevelType==="sigma"?this.isolevel=this.volume.getSigmaForValue(this.isolevel):this.isolevelType==="sigma"&&e.isolevelType==="value"&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=e.isolevelType),e&&e.boxCenter&&(this.boxCenter.copy(e.boxCenter),delete e.boxCenter),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),e.matrix&&this.inverseMatrix.copy(e.matrix).invert(),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),e&&e.colorVolume!==void 0&&t&&(t.color=!0),this.surface&&(e.isolevel!==void 0||e.negateIsolevel!==void 0||e.smooth!==void 0||e.wrap!==void 0||e.boxSize!==void 0||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}dispose(){this.viewer.signals.ticked.remove(this.setBox,this),super.dispose()}}class bn{static zoomScroll(e,t){e.trackballControls.zoom(t)}static clipNearScroll(e,t){const n=e.getParameters();e.setParameters({clipNear:n.clipNear+t/10})}static focusScroll(e,t){const n=e.getFocus(),r=Math.sign(t)*function(s,o,a){if(s>o)return s;const l=s/o;return((2*a-o)*l+(2*o-3*a))*l*l+a}((100-n)/10,5,.2);e.setFocus(n+r)}static zoomFocusScroll(e,t){e.trackballControls.zoom(t);const n=e.viewer.camera.position.z;e.setFocus(100-Math.abs(n/8))}static isolevelScroll(e,t){const n=Math.sign(t)/10;e.eachRepresentation((r,s)=>{if(r.repr instanceof fC){const o=r.getParameters();o.isolevelScroll&&r.setParameters({isolevel:o.isolevel+n})}})}static panDrag(e,t,n){e.trackballControls.pan(t,n)}static rotateDrag(e,t,n){e.trackballControls.rotate(t,n)}static zRotateDrag(e,t,n){e.trackballControls.zRotate(t,n)}static zoomDrag(e,t,n){e.trackballControls.zoom((t+n)/-2)}static zoomFocusDrag(e,t,n){e.trackballControls.zoom((t+n)/-2);const r=e.viewer.camera.position.z;e.setFocus(100-Math.abs(r/8))}static panComponentDrag(e,t,n){e.trackballControls.panComponent(t,n)}static panAtomDrag(e,t,n){e.trackballControls.panAtom(t,n)}static rotateComponentDrag(e,t,n){e.trackballControls.rotateComponent(t,n)}static movePick(e,t){t&&e.animationControls.move(t.position.clone())}static tooltipPick(e,t){const n=e.tooltip;if(e.getParameters().tooltip&&t){const r=t.mouse.position;n.innerText=t.getLabel(),n.style.bottom=window.innerHeight-r.y+3+"px",n.style.left=r.x+3+"px",n.style.display="block"}else n.style.display="none"}static measurePick(e,t){if(t&&(t.atom||t.bond)){const n=t.atom||t.closestBondAtom;t.component.measurePick(n)}else e.measureClear()}}const aV={default:[["scroll",bn.zoomScroll],["scroll-shift",bn.focusScroll],["scroll-ctrl",bn.isolevelScroll],["scroll-shift-ctrl",bn.zoomFocusScroll],["drag-left",bn.rotateDrag],["drag-right",bn.panDrag],["drag-ctrl-left",bn.panDrag],["drag-ctrl-right",bn.zRotateDrag],["drag-shift-left",bn.zoomDrag],["drag-middle",bn.zoomFocusDrag],["drag-ctrl-shift-right",bn.panComponentDrag],["drag-ctrl-shift-left",bn.rotateComponentDrag],["clickPick-right",bn.measurePick],["clickPick-ctrl-left",bn.measurePick],["clickPick-middle",bn.movePick],["clickPick-left",bn.movePick],["hoverPick",bn.tooltipPick]],pymol:[["drag-left",bn.rotateDrag],["drag-middle",bn.panDrag],["drag-right",bn.zoomDrag],["scroll",bn.focusScroll],["drag-shift-right",bn.focusScroll],["clickPick-ctrl+shift-middle",bn.movePick],["hoverPick",bn.tooltipPick]],coot:[["scroll",bn.isolevelScroll],["drag-left",bn.rotateDrag],["drag-middle",bn.panDrag],["drag-ctrl-left",bn.panDrag],["drag-right",bn.zoomFocusDrag],["drag-ctrl-right",bn.focusScroll],["clickPick-middle",bn.movePick],["hoverPick",bn.tooltipPick]],astexviewer:[["drag-left",bn.rotateDrag],["drag-ctrl-left",bn.panDrag],["drag-shift-left",bn.zoomDrag],["scroll",bn.focusScroll],["clickPick-middle",bn.movePick],["hoverPick",bn.tooltipPick]]};function _4(i){const e=i.split(/[-+]/);let t="";e.includes("scroll")&&(t="scroll"),e.includes("drag")&&(t="drag"),e.includes("click")&&(t="click"),e.includes("doubleClick")&&(t="doubleClick"),e.includes("hover")&&(t="hover"),e.includes("clickPick")&&(t="clickPick"),e.includes("hoverPick")&&(t="hoverPick");let n=0;e.includes("alt")&&(n+=1),e.includes("ctrl")&&(n+=2),e.includes("meta")&&(n+=4),e.includes("shift")&&(n+=8);let r=0;return e.includes("left")&&(r+=1),e.includes("right")&&(r+=2),e.includes("middle")&&(r+=4),[t,n,r]}class ice{constructor(e,t={}){this.stage=e,this.actionList=[],this.mouse=e.mouseObserver,this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e,...t){if(this.disabled)return;const n=this.mouse.key||0,r=this.mouse.buttons||0;this.actionList.forEach(s=>{s.type===e&&s.key===n&&s.button===r&&s.callback(this.stage,...t)})}add(e,t){const[n,r,s]=_4(e);this.actionList.push({type:n,key:r,button:s,callback:t})}remove(e,t){const n=e.includes("*"),[r,s,o]=_4(e),a=this.actionList.filter(function(l){return!((l.type===r||n&&r==="")&&(l.key===s||n&&s===0)&&(l.button===o||n&&o===0)&&(l.callback===t||t===void 0))});this.actionList=a}preset(e){this.clear(),(aV[e]||[]).forEach(t=>this.add(t[0],t[1]))}clear(){this.actionList.length=0}}class hg{static autoView(e){e.autoView(1e3)}static toggleAnimations(e){e.animationControls.toggle()}static toggleRock(e){e.toggleRock()}static toggleSpin(e){e.toggleSpin()}static toggleAntialiasing(e){const t=e.getParameters();e.setParameters({sampleLevel:t.sampleLevel===-1?0:-1})}}const rce={default:[["i",hg.toggleSpin],["k",hg.toggleRock],["p",hg.toggleAnimations],["a",hg.toggleAntialiasing],["r",hg.autoView]]};class sce{constructor(e,t={}){this.stage=e,this.actionList=[],this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e){this.disabled||this.actionList.forEach(t=>{t.key===e&&t.callback(this.stage)})}add(e,t){this.actionList.push({key:e,callback:t})}remove(e,t){const n=this.actionList.filter(function(r){return!(r.key===e&&(r.callback===t||t===void 0))});this.actionList=n}preset(e){this.clear(),(rce[e]||[]).forEach(t=>this.add(t[0],t[1]))}clear(){this.actionList.length=0}}class oce{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)}_onClick(e,t){const n=this.stage.pickingControls.pick(e,t);this.stage.signals.clicked.dispatch(n),this.controls.run("clickPick",n)}_onHover(e,t){const n=this.stage.pickingControls.pick(e,t);n&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=n.component,this.stage.transformAtom=n.atom),this.stage.signals.hovered.dispatch(n),this.controls.run("hoverPick",n)}dispose(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class ace{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)}_onMove(){this.stage.tooltip.style.display="none"}_onScroll(e){this.controls.run("scroll",e)}_onDrag(e,t){this.controls.run("drag",e,t)}_onClick(e,t){this.controls.run("click",e,t)}_onDblclick(e,t){this.controls.run("doubleClick",e,t)}_onHover(e,t){this.controls.run("hover",e,t)}dispose(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class lce{constructor(e){this.stage=e,this.viewer=e.viewer,this.animationControls=e.animationControls,this.viewer.signals.ticked.add(this._onTick,this)}_onTick(e){this.animationControls.run(e)}dispose(){this.viewer.signals.ticked.remove(this._onTick,this)}}const y4=!!PG&&{passive:!0};class cce{constructor(e){this.stage=e,this.stage=e,this.controls=e.keyControls,this.domElement=e.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,y4),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)}_onKeydown(){}_onKeyup(){}_onKeypress(e){let t;t="key"in KeyboardEvent.prototype?e.key:String.fromCharCode(e.which||e.keyCode),this.controls.run(t)}_focusDomElement(){this.domElement.focus()}dispose(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,y4),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)}}class uce{constructor(e,t,n,r={}){this.component=e,this.position=t,this.offsetX=he(r.offsetX,0),this.offsetY=he(r.offsetY,0),this.visible=he(r.visible,!0),this.stage=e.stage,this.viewer=e.stage.viewer,this._viewerPosition=new me,this._updateViewerPosition(),this._canvasPosition=new sn,this._cameraPosition=new me,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(n),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)}setContent(e){const t=this.element.style.display;if(t==="none"&&(this.element.style.left="-10000px",this.element.style.display="block"),e instanceof HTMLElement)this.element.appendChild(e);else{const n=document.createElement("div");n.innerText=e,Object.assign(n.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(n)}this._clientRect=this.element.getBoundingClientRect(),t==="none"&&(this.element.style.display=t)}setVisibility(e){this.visible=e,this.updateVisibility()}getVisibility(){return this.visible&&this.component.parameters.visible}updateVisibility(){this.element.style.display=this.getVisibility()?"block":"none"}_updateViewerPosition(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)}_update(){if(!this.getVisibility())return;const e=this.element.style,t=this._canvasPosition,n=this._viewerPosition,r=this._clientRect;if(this._cameraPosition.copy(n).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)return void(e.display="none");e.display="block";const s=this._cameraPosition.length(),o=this.viewer.scene.fog;e.opacity=(1-A1(o.near,o.far,s)).toString(),e.zIndex=Math.round(100*(o.far-s)).toString(),this.stage.viewerControls.getPositionOnCanvas(n,t),e.bottom=this.offsetX+t.y+r.height/2+"px",e.left=this.offsetY+t.x-r.width/2+"px"}dispose(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)}}const Hc=new Tt,gy=new me,x4=new Cs;class hce{constructor(e){this.component=e,this.signals={changed:new tn.Signal},this.stage=e.stage,this.viewer=e.stage.viewer}get position(){return this.component.position}get rotation(){return this.component.quaternion}changed(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()}spin(e,t){Hc.copy(this.viewer.rotationGroup.matrix).invert(),gy.copy(Kh(e)).applyMatrix4(Hc),Hc.extractRotation(this.component.transform),Hc.premultiply(this.viewer.rotationGroup.matrix),Hc.invert(),gy.copy(Kh(e)),gy.applyMatrix4(Hc),Hc.makeRotationAxis(gy,t),x4.setFromRotationMatrix(Hc),this.component.quaternion.premultiply(x4),this.changed()}}const lV={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"};class fc{constructor(e={}){this.max=10,this.type=he(e.type,"size"),this.scale=he(e.scale,1),this.size=he(e.size,1),this.data=he(e.data,{})}atomRadius(e){let t;switch(this.type){case"vdw":t=e.vdw;break;case"covalent":t=e.covalent;break;case"bfactor":t=e.bfactor||1;break;case"sstruc":const n=e.sstruc;t=n==="h"||n==="g"||n==="i"||n==="e"||n==="b"?.25:YG.includes(e.atomname)?.4:.1;break;case"data":t=he(this.data[e.index],1);break;case"explicit":t=e.radius,t===null&&(t=this.size);break;default:t=this.size}return Math.min(t*this.scale,this.max)}}fc.types=lV;const dce=new me(-1,-1,-1),fce=new Tt;class cV{constructor(e){const t=e.rows,n=t/3,r=new Fn(t,3),s=new Fn(3,3),o=new Fn(1,3),a=new Fn(3,3),l=new Fn(3,3),c=lC(e);cC(e,c),Aa(r,e),vx(s,r,r),tV(s,o,a,l);const u=new me(c[0],c[1],c[2]),h=new me(a.data[0],a.data[3],a.data[6]),d=new me(a.data[1],a.data[4],a.data[7]),f=new me(a.data[2],a.data[5],a.data[8]),m=h.clone().multiplyScalar(Math.sqrt(o.data[0]/n)),_=d.clone().multiplyScalar(Math.sqrt(o.data[1]/n)),v=f.clone().multiplyScalar(Math.sqrt(o.data[2]/n));this.begA=u.clone().sub(m),this.endA=u.clone().add(m),this.begB=u.clone().sub(_),this.endB=u.clone().add(_),this.begC=u.clone().sub(v),this.endC=u.clone().add(v),this.center=u,this.vecA=m,this.vecB=_,this.vecC=v,this.normVecA=h,this.normVecB=d,this.normVecC=f}getBasisMatrix(e=new Tt){const t=e;return t.makeBasis(this.normVecB,this.normVecA,this.normVecC),t.determinant()<0&&t.scale(dce),t}getRotationQuaternion(e=new Cs){const t=e;return t.setFromRotationMatrix(this.getBasisMatrix(fce)),t.invert()}getProjectedScaleForAtoms(e){let t=-1/0,n=-1/0,r=-1/0,s=-1/0,o=-1/0,a=-1/0;const l=new me,c=new me,u=this.center,h=this.normVecA,d=this.normVecB,f=this.normVecC;return e.eachAtom(function(m){Zh(l.copy(m),h,u);const _=c.subVectors(l,u).normalize().dot(h),v=l.distanceTo(u);_>0?v>t&&(t=v):v>n&&(n=v),Zh(l.copy(m),d,u);const g=c.subVectors(l,u).normalize().dot(d),b=l.distanceTo(u);g>0?b>r&&(r=b):b>s&&(s=b),Zh(l.copy(m),f,u);const p=c.subVectors(l,u).normalize().dot(f),y=l.distanceTo(u);p>0?y>o&&(o=y):y>a&&(a=y)}),{d1a:t,d2a:r,d3a:o,d1b:-n,d2b:-s,d3b:-a}}}class Vl{constructor(e,t,n,r){this.volume=e,this.setFilter(t,n,r)}get header(){return this.volume.header}get matrix(){return this.volume.matrix}get normalMatrix(){return this.volume.normalMatrix}get inverseMatrix(){return this.volume.inverseMatrix}get center(){return this.volume.center}get boundingBox(){return this.volume.boundingBox}get min(){return this.volume.min}get max(){return this.volume.max}get mean(){return this.volume.mean}get rms(){return this.volume.rms}_getFilterHash(e,t,n){return JSON.stringify([e,t,n])}setFilter(e,t,n){isNaN(e)&&this.header&&(e=this.header.DMEAN+2*this.header.ARMS),e=e===void 0||isNaN(e)?-1/0:e,t=he(t,1/0),n=he(n,!1);const r=this.volume.data,s=this.volume.position,o=this.volume.atomindex,a=this._getFilterHash(e,t,n);if(a!==this._filterHash){if(e===-1/0&&t===1/0)this.data=r,this.position=s,this.atomindex=o;else{const l=r.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*l),this._positionBuffer=new ArrayBuffer(3*l*4),o&&(this._atomindexBuffer=new ArrayBuffer(4*l)));const c=new Float32Array(this._dataBuffer),u=new Float32Array(this._positionBuffer);let h;o&&(h=new Uint32Array(this._atomindexBuffer));let d=0;for(let f=0;f<l;++f){const m=3*f,_=r[f];if(!n&&_>=e&&_<=t||n&&(_<e||_>t)){const v=3*d;c[d]=_,u[v+0]=s[m+0],u[v+1]=s[m+1],u[v+2]=s[m+2],o&&h&&(h[d]=o[f]),d+=1}}this.data=new Float32Array(this._dataBuffer,0,d),this.position=new Float32Array(this._positionBuffer,0,3*d),o&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,d))}this._filterHash=a}}}Vl.prototype.getValueForSigma=zs.prototype.getValueForSigma,Vl.prototype.getSigmaForValue=zs.prototype.getSigmaForValue,Vl.prototype.getDataAtomindex=zs.prototype.getDataAtomindex,Vl.prototype.getDataPosition=zs.prototype.getDataPosition,Vl.prototype.getDataColor=zs.prototype.getDataColor,Vl.prototype.getDataPicking=zs.prototype.getDataPicking,Vl.prototype.getDataSize=zs.prototype.getDataSize;class pce{constructor(e,t){const n=GG({nodeArray1:e.atomIndex1,nodeArray2:e.atomIndex2,edgeCount:e.count,nodeCount:t});this.countArray=n.countArray,this.offsetArray=n.offsetArray,this.indexArray=n.indexArray}}class yx extends cm{get _defaultFields(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]}addBond(e,t,n){this.growIfFull();const r=this.count,s=e.index,o=t.index;s<o?(this.atomIndex1[r]=s,this.atomIndex2[r]=o):(this.atomIndex2[r]=s,this.atomIndex1[r]=o),n&&(this.bondOrder[r]=n),this.count+=1}addBondIfConnected(e,t,n){return!!e.connectedTo(t)&&(this.addBond(e,t,n),!0)}}class mce extends cm{get _defaultFields(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]}setAltloc(e,t){this.altloc[e]=t.charCodeAt(0)}getAltloc(e){const t=this.altloc[e];return t?String.fromCharCode(t):""}}class gce extends cm{get _defaultFields(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]}setSstruc(e,t){this.sstruc[e]=t.charCodeAt(0)}getSstruc(e){const t=this.sstruc[e];return t?String.fromCharCode(t):""}setInscode(e,t){this.inscode[e]=t.charCodeAt(0)}getInscode(e){const t=this.inscode[e];return t?String.fromCharCode(t):""}}class vce extends cm{get _defaultFields(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]}setChainname(e,t){const n=4*e;this.chainname[n]=t.charCodeAt(0),this.chainname[n+1]=t.charCodeAt(1),this.chainname[n+2]=t.charCodeAt(2),this.chainname[n+3]=t.charCodeAt(3)}getChainname(e){let t="";for(let n=0;n<4;++n){const r=this.chainname[4*e+n];if(!r)break;t+=String.fromCharCode(r)}return t}setChainid(e,t){const n=4*e;this.chainid[n]=t.charCodeAt(0),this.chainid[n+1]=t.charCodeAt(1),this.chainid[n+2]=t.charCodeAt(2),this.chainid[n+3]=t.charCodeAt(3)}getChainid(e){let t="";for(let n=0;n<4;++n){const r=this.chainid[4*e+n];if(!r)break;t+=String.fromCharCode(r)}return t}}class _ce extends cm{get _defaultFields(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]}}class pb{constructor(e){this.polymer=e,this.size=e.residueCount}getCenterIterator(e=0){const t=this.getPosition().center,n=t.length/3;let r=0,s=-1;const o=[new me,new me,new me,new me];return{size:n,next:function(){const a=this.get(s);return s+=1,a},get:function(a){a=Math.min(n-1,Math.max(0,a));const l=o[r%4],c=3*a;if(l.fromArray(t,c),e){const u=Math.min(e,a,n-a-1);for(let h=1;h<=u;++h){const d=3*h,f=(u+1-h)/(u+1);l.x+=f*t[c-d+0]+f*t[c+d+0],l.y+=f*t[c-d+1]+f*t[c+d+1],l.z+=f*t[c-d+2]+f*t[c+d+2]}l.x/=u+1,l.y/=u+1,l.z/=u+1}return r+=1,l},reset:function(){r=0,s=-1}}}getColor(e){const t=this.polymer,n=t.structure,r=t.residueCount,s=t.residueIndexStart,o=new Float32Array(3*r),a=e||{};a.structure=n;const l=gn.getScheme(a),c=n.getResidueProxy(),u=n.getAtomProxy();for(let h=0;h<r;++h)c.index=s+h,u.index=c.traceAtomIndex,l.atomColorToArray(u,o,3*h);return{color:o}}getPicking(){const e=this.polymer,t=e.structure,n=e.residueCount,r=e.residueIndexStart,s=new Float32Array(n),o=t.getResidueProxy();for(let a=0;a<n;++a)o.index=r+a,s[a]=o.traceAtomIndex;return{picking:new Sd(s,t)}}getSize(e){const t=this.polymer,n=t.structure,r=t.residueCount,s=t.residueIndexStart,o=new Float32Array(r),a=new fc(e),l=n.getResidueProxy(),c=n.getAtomProxy();for(let u=0;u<r;++u)l.index=s+u,c.index=l.traceAtomIndex,o[u]=a.atomRadius(c);return{size:o}}getPosition(){const e=this.polymer,t=e.structure,n=e.residueCount,r=n-3,s=new Float32Array(3*n),o=new Float32Array(3*n),a=new Float32Array(n),l=new Float32Array(n),c=new Float32Array(n),u=new Float32Array(n),h=new Float32Array(3*n),d=new me,f=new me,m=new me,_=new me,v=new me,g=new me,b=new me,p=new me,y=new me,A=new me,w=new me,M=new me(0,0,0),T="trace",E=t.getAtomProxy(),C=t.getAtomProxy(e.getAtomIndexByType(0,T)),N=t.getAtomProxy(e.getAtomIndexByType(1,T)),P=t.getAtomProxy(e.getAtomIndexByType(2,T));for(let U=0;U<r;++U){E.index=C.index,C.index=N.index,N.index=P.index,P.index=e.getAtomIndexByType(U+3,T);const G=3*U;d.subVectors(C,E),f.subVectors(N,C),m.subVectors(P,N),_.subVectors(d,f),v.subVectors(f,m),y.crossVectors(_,v).normalize(),y.toArray(o,G),U>0&&(a[U]=y.angleTo(A));const B=Math.cos(_.angleTo(v));u[U]=180/Math.PI*Math.acos(B);const D=_.length(),O=v.length();l[U]=Math.sqrt(O*D)/Math.max(2,2*(1-B)),c[U]=Math.abs(f.dot(y)),g.copy(_).multiplyScalar(l[U]/D),b.copy(v).multiplyScalar(l[U]/O),g.subVectors(C,g),b.subVectors(N,b),g.toArray(s,G+3),b.toArray(s,G+6),w.subVectors(E,M),w.toArray(h,G),A.copy(y),M.copy(g)}g.fromArray(s,3),b.fromArray(s,6),y.subVectors(g,b).normalize(),E.index=e.getAtomIndexByType(0,T),M.copy(E),p.copy(E),Zh(p,y,g),p.toArray(s,0),w.subVectors(M,g),w.toArray(h,0),g.fromArray(s,3*n-6),b.fromArray(s,3*n-9),y.subVectors(g,b).normalize(),E.index=e.getAtomIndexByType(n-1,T),M.copy(E),p.copy(E),Zh(p,y,g),p.toArray(s,3*n-3);for(let U=n-3;U<n;++U)g.fromArray(s,3*U),E.index=e.getAtomIndexByType(U,T),M.copy(E),w.subVectors(M,g),w.toArray(h,3*U);const L=new Float32Array(n),R=new Float32Array(n),F=new Float32Array(n),V=new Float32Array(n);L[1]=l[0],R[1]=u[0],F[1]=l[0];for(let U=2;U<n-2;++U)L[U]=.5*(l[U-2]+l[U-1]),R[U]=.5*(u[U-2]+u[U-1]),F[U]=.5*(c[U-2]+c[U-1]),g.fromArray(o,3*(U-2)),b.fromArray(o,3*(U-1)),V[U]=180/Math.PI*Math.acos(Math.cos(g.angleTo(b)));L[n-2]=l[n-4],R[n-2]=u[n-4],F[n-2]=c[n-4];const z=new Float32Array(3*n);er(o,z,0,0,3),er(o,z,0,3,3);for(let U=2;U<n-2;++U)g.fromArray(o,3*(U-2)),b.fromArray(o,3*(U-1)),y.addVectors(b,g).multiplyScalar(.5).normalize(),y.toArray(z,3*U);return er(o,z,3*n-12,3*n-6,3),er(o,z,3*n-12,3*n-3,3),{center:s,axis:z,bending:V,radius:L,rise:F,twist:R,resdir:h}}}class uV{constructor(e){this.polymer=e,this.helixorient=new pb(e),this.position=this.helixorient.getPosition()}getAxis(e,t,n,r,s){e=e||30,t=t||2.5,n=n!==void 0&&n;const o=this.polymer,a=o.structure,l=o.residueCount,c=o.residueIndexStart,u=this.position,h=r||{};h.structure=a;const d=gn.getScheme(h),f=new fc(s);let m=0,_=0;const v=[],g=[],b=[],p=[],y=[],A=[],w=[],M=[],T=[];let E,C,N=new Float32Array(3*l),P=new Float32Array(3*l);const L=new me,R=new me,F=a.getResidueProxy(),V=a.getResidueProxy(),z=a.getAtomProxy(),U=new me,G=new me;let B=!1;for(let O=0;O<l;++O)if(F.index=c+O,U.fromArray(u.center,3*O),O===l-1?B=!0:(V.index=c+O+1,G.fromArray(u.center,3*O+3),(n&&F.sstruc!==V.sstruc||U.distanceTo(G)>t||u.bending[O]>e)&&(B=!0)),B){if(O-m<4){m=O,B=!1;continue}z.index=F.traceAtomIndex,N=u.axis.subarray(3*m+3,3*O),P=u.center.subarray(3*m,3*O+3),E=sC(N).normalize(),C=sC(P),L.fromArray(P),Zh(L,E,C),R.fromArray(P,P.length-3),Zh(R,E,C),E.subVectors(R,L),E.toArray(v,_),C.toArray(g,_),L.toArray(b,_),R.toArray(p,_),d.atomColorToArray(z,y,_),A.push(z.index),w.push(f.atomRadius(z)),M.push(c+m),T.push(c+O+1-m),_+=3,m=O,B=!1}const D=new Float32Array(A);return{axis:new Float32Array(v),center:new Float32Array(g),begin:new Float32Array(b),end:new Float32Array(p),color:new Float32Array(y),picking:new Sd(D,a),size:new Float32Array(w),residueOffset:M,residueCount:T}}}class yce{constructor(e){this.scoreFunction=e,this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.bubbleUp(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return t&&this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e}peek(){return this.content[0]}remove(e){const t=this.content.length;for(let n=0;n<t;n++)if(this.content[n]===e){const r=this.content.pop();return void(r&&n!==t-1&&(this.content[n]=r,this.scoreFunction(r)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")}size(){return this.content.length}bubbleUp(e){const t=this.content[e];for(;e>0;){const n=Math.floor((e+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}}sinkDown(e){const t=this.content.length,n=this.content[e],r=this.scoreFunction(n);let s=0,o=0;for(;;){const a=2*(e+1),l=a-1;let c=null;if(l<t){const u=this.content[l];s=this.scoreFunction(u),s<r&&(c=l)}if(a<t){const u=this.content[a];o=this.scoreFunction(u),o<(c===null?r:s)&&(c=a)}if(c===null)break;this.content[e]=this.content[c],this.content[c]=n,e=c}}}/**
 * Kdtree
 * @class
 * @author Alexander Rose <alexander.rose@weirdbyte.de>, 2016
 * @author Roman Bolzern <roman.bolzern@fhnw.ch>, 2013
 * @author I4DS http://www.fhnw.ch/i4ds, 2013
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 * @description
 * k-d Tree for typed arrays of 3d points (e.g. for Float32Array), in-place
 * provides fast nearest neighbour search
 *
 * Based on https://github.com/ubilabs/kd-tree-javascript by Ubilabs
 *
 * Further information (including mathematical properties)
 * http://en.wikipedia.org/wiki/Binary_tree
 * http://en.wikipedia.org/wiki/K-d_tree
 *
 * @example
 * points: [x, y, z, x, y, z, x, y, z, ...]
 * metric: function(a, b){
 *    return Math.pow(a[0]-b[0], 2) + Math.pow(a[1]-b[1], 2) + Math.pow(a[2]-b[2], 2);
 * }
 *
 * @param {Float32Array} points - points
 * @param {Function} metric - metric
 */class xce{constructor(e,t){this.points=e,this.metric=t,this.maxDepth=0,this.currentNode=0;const n=e.length/3,r=new Uint32Array(n);for(let s=0;s<n;++s)r[s]=s;this.indices=r,this.nodes=new Int32Array(4*n),this.rootIndex=this.buildTree(0,-1,0,n)}buildTree(e,t,n,r){e>this.maxDepth&&(this.maxDepth=e);const s=r-n;if(s===0)return-1;const o=4*this.currentNode,a=this.nodes;if(this.currentNode+=1,s===1)return a[o]=n,a[o+1]=-1,a[o+2]=-1,a[o+3]=t,o;const l=this.indices,c=this.points,u=n+Math.floor(s/2),h=e%3;let d,f,m,_,v,g=n,b=r-1;for(;b>g;){for(m=g+b>>1,_=c[3*l[m]+h],f=l[m],l[m]=l[b],l[b]=f,v=g,d=g;d<b;++d)c[3*l[d]+h]<_&&(f=l[v],l[v]=l[d],l[d]=f,++v);if(f=l[b],l[b]=l[v],l[v]=f,m=v,u===m)break;u<m?b=m-1:g=m+1}return a[o]=u,a[o+1]=this.buildTree(e+1,o,n,u),a[o+2]=this.buildTree(e+1,o,u+1,r),a[o+3]=t,o}getNodeDepth(e){const t=this.nodes[e+3];return t===-1?0:this.getNodeDepth(t)+1}nearest(e,t,n){const r=new yce(u=>-u[1]),s=this.nodes,o=this.points,a=this.indices,l=u=>{let h,d;const f=this.getNodeDepth(u)%3,m=3*a[s[u]],_=[o[m+0],o[m+1],o[m+2]],v=this.metric(e,_);function g(w,M){r.push([w,M]),r.size()>t&&r.pop()}const b=s[u+1],p=s[u+2];if(p===-1&&b===-1)return void((r.size()<t||v<r.peek()[1])&&v<=n&&g(u,v));h=p===-1?b:b===-1?p:e[f]<=o[m+f]?b:p,l(h),(r.size()<t||v<r.peek()[1])&&v<=n&&g(u,v);const y=[];for(let w=0;w<3;w+=1)y[w]=w===f?e[w]:o[m+w];const A=this.metric(y,_);(r.size()<t||Math.abs(A)<r.peek()[1])&&Math.abs(A)<=n&&(d=h===b?p:b,d!==-1&&l(d))};l(this.rootIndex);const c=[];for(let u=0,h=Math.min(r.size(),t);u<h;u+=1)c.push(r.content[u]);return c}verify(e,t=0){let n=1;if(e===void 0&&(e=this.rootIndex),e===-1)throw new Error("node is null");const r=t%3,s=this.nodes,o=this.points,a=this.indices,l=s[e+1],c=s[e+2];if(l!==-1){if(o[3*a[s[l]]+r]>o[3*a[s[e]]+r])throw new Error("left child is > parent!");n+=this.verify(l,t+1)}if(c!==-1){if(o[3*a[s[c]]+r]<o[3*a[s[e]]+r])throw new Error("right child is < parent!");n+=this.verify(c,t+1)}return n}}class NS{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get bondHash(){return this.structure.bondHash}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]}get residue(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)}get residueIndex(){return this.atomStore.residueIndex[this.index]}set residueIndex(e){this.atomStore.residueIndex[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.residueIndex)}get inscode(){return this.residueStore.getInscode(this.residueIndex)}get resno(){return this.residueStore.resno[this.residueIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])}get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])}get residueAtomOffset(){return this.residueStore.atomOffset[this.residueIndex]}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get atomname(){return this.atomType.atomname}get number(){return this.atomType.number}get element(){return this.atomType.element}get vdw(){return this.atomType.vdw}get covalent(){return this.atomType.covalent}get x(){return this.atomStore.x[this.index]}set x(e){this.atomStore.x[this.index]=e}get y(){return this.atomStore.y[this.index]}set y(e){this.atomStore.y[this.index]=e}get z(){return this.atomStore.z[this.index]}set z(e){this.atomStore.z[this.index]=e}get serial(){return this.atomStore.serial[this.index]}set serial(e){this.atomStore.serial[this.index]=e}get bfactor(){return this.atomStore.bfactor[this.index]}set bfactor(e){this.atomStore.bfactor[this.index]=e}get occupancy(){return this.atomStore.occupancy[this.index]}set occupancy(e){this.atomStore.occupancy[this.index]=e}get altloc(){return this.atomStore.getAltloc(this.index)}set altloc(e){this.atomStore.setAltloc(this.index,e)}get partialCharge(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null}set partialCharge(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)}get radius(){return this.atomStore.radius?this.atomStore.radius[this.index]:null}set radius(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)}get formalCharge(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null}set formalCharge(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)}get aromatic(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0}set aromatic(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)}get bondCount(){return this.bondHash.countArray[this.index]}eachBond(e,t){t=t||this.structure._bp;const n=this.index,r=this.bondHash,s=r.indexArray,o=r.countArray[n],a=r.offsetArray[n];for(let l=0;l<o;++l)t.index=s[a+l],e(t)}eachBondedAtom(e,t){const n=t||this.structure._ap,r=this.index;this.eachBond(function(s){n.index=r!==s.atomIndex1?s.atomIndex1:s.atomIndex2,e(n)}),this.index=r}hasBondTo(e){let t=!1;return this.eachBondedAtom(function(n){e.index===n.index&&(t=!0)}),t}bondToElementCount(e){let t=0;const n=this.index;return this.eachBondedAtom(function(r){r.number===e&&(t+=1)}),this.index=n,t}hasBondToElement(e){return this.bondToElementCount(e)>0}isBackbone(){const e=this.residueType.backboneIndexList;return e.length>0&&e.includes(this.index-this.residueAtomOffset)}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isSidechain(){return this.isPolymer()&&!this.isBackbone()}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isTrace(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset}isHetero(){return this.residueType.hetero===1}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isHelix(){return HG.includes(this.sstruc)}isSheet(){return $G.includes(this.sstruc)}isTurn(){return WG.includes(this.sstruc)&&this.isProtein()}isBonded(){return this.bondHash.countArray[this.index]!==0}isRing(){return this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]!==void 0}isAromatic(){return this.aromatic===1}isPolarHydrogen(){let e=!1;return this.number!==1||(e=!this.hasBondToElement(6)),e}isMetal(){return this.atomType.isMetal()}isNonmetal(){return this.atomType.isNonmetal()}isMetalloid(){return this.atomType.isMetalloid()}isHalogen(){return this.atomType.isHalogen()}isDiatomicNonmetal(){return this.atomType.isDiatomicNonmetal()}isPolyatomicNonmetal(){return this.atomType.isPolyatomicNonmetal()}isAlkaliMetal(){return this.atomType.isAlkaliMetal()}isAlkalineEarthMetal(){return this.atomType.isAlkalineEarthMetal()}isNobleGas(){return this.atomType.isNobleGas()}isTransitionMetal(){return this.atomType.isTransitionMetal()}isPostTransitionMetal(){return this.atomType.isPostTransitionMetal()}isLanthanide(){return this.atomType.isLanthanide()}isActinide(){return this.atomType.isActinide()}getDefaultValence(){return this.atomType.getDefaultValence()}getValenceList(){return this.atomType.getValenceList()}getOuterShellElectronCount(){return this.atomType.getOuterShellElectronCount()}distanceTo(e){const t=this.atomStore,n=e.atomStore,r=this.index,s=e.index,o=t.x[r]-n.x[s],a=t.y[r]-n.y[s],l=t.z[r]-n.z[s],c=o*o+a*a+l*l;return Math.sqrt(c)}connectedTo(e){const t=this.atomStore,n=e.atomStore,r=this.index,s=e.index;if(t.altloc&&n.altloc){const f=t.altloc[r],m=n.altloc[s];if(f!==0&&m!==0&&f!==32&&m!==32&&f!==m)return!1}const o=t.x[r]-n.x[s],a=t.y[r]-n.y[s],l=t.z[r]-n.z[s],c=o*o+a*a+l*l;if(c<48&&this.isCg())return!0;if(isNaN(c))return!1;const u=this.covalent+e.covalent,h=u+.3,d=u-.5;return c<h*h&&c>d*d}positionFromArray(e,t=0){return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}positionToArray(e=[],t=0){const n=this.index,r=this.atomStore;return e[t+0]=r.x[n],e[t+1]=r.y[n],e[t+2]=r.z[n],e}positionToVector3(e){return e===void 0&&(e=new me),e.x=this.x,e.y=this.y,e.z=this.z,e}positionFromVector3(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}positionAdd(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}positionSub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}getResidueBonds(e=!1){const t=this.residueAtomOffset,n=this.index-this.residueAtomOffset,r=this.residueType.getBonds(),s=r.atomIndices1,o=r.atomIndices2;let a,l,c,u;for(e||(u=[]),a=s.indexOf(n);a!==-1;){if(c=o[a]+t,!u)return c;u.push(c),a=s.indexOf(n,a+1)}for(l=o.indexOf(n);l!==-1;){if(c=s[l]+t,!u)return c;u.push(c),l=o.indexOf(n,l+1)}return u}qualifiedName(e=!1){var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chainname&&(t+=":"+this.chainname),this.atomname&&(t+="."+this.atomname),this.altloc&&(t+="%"+this.altloc),this.structure.modelStore.count>1&&(t+="/"+this.modelIndex),t}clone(){return new NS(this.structure,this.index)}toObject(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}}}function hV(i,e){const t=i[0]-e[0],n=i[1]-e[1],r=i[2]-e[2];return t*t+n*n+r*r}function bce(i,e){return Math.sqrt(hV(i,e))}const ZM=new Float32Array(3);class Sce{constructor(e,t=!1){pt&&tt.time("Kdtree build");const n=t?hV:bce,r=new Float32Array(3*e.atomCount),s=new Uint32Array(e.atomCount);let o=0;e.eachAtom(function(a){r[o+0]=a.x,r[o+1]=a.y,r[o+2]=a.z,s[o/3]=a.index,o+=3}),this.atomIndices=s,this.points=r,this.kdtree=new xce(r,n),pt&&tt.timeEnd("Kdtree build")}nearest(e,t,n){e instanceof me?e.toArray(ZM):e instanceof NS&&e.positionToArray(ZM);const r=this.kdtree.nearest(ZM,t,n),s=this.kdtree.indices,o=this.kdtree.nodes,a=this.atomIndices,l=[];for(let c=0,u=r.length;c<u;++c){const h=r[c],d=h[0],f=h[1];l.push({index:a[s[o[d]]],distance:f})}return l}}const wce={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},Mce={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},Ace=/^[1-9]$/;function dV(i){let e="";return i.length>0&&(e=":"+FR(i).join(" OR :")),new ei(e)}class Cu{constructor(e=""){this.name=e,this.partList=[]}get type(){return"Assembly"}addPart(e,t){const n=new Ece(e,t);return this.partList.push(n),n}getAtomCount(e){return this.partList.reduce((t,n)=>t+n.getAtomCount(e),0)}getResidueCount(e){return this.partList.reduce((t,n)=>t+n.getResidueCount(e),0)}getInstanceCount(){let e=0;return this.partList.forEach(function(t){e+=t.matrixList.length}),e}isIdentity(e){if(this.partList.length!==1)return!1;const t=this.partList[0];if(t.matrixList.length!==1||!new Tt().equals(t.matrixList[0]))return!1;let n=[];return e.eachChain(function(r){n.push(r.chainname)}),n=FR(n),t.chainList.length===n.length}getBoundingBox(e){const t=new Ti;return this.partList.forEach(function(n){const r=n.getBoundingBox(e);t.expandByPoint(r.min),t.expandByPoint(r.max)}),t}getCenter(e){return this.getBoundingBox(e).getCenter(new me)}getSelection(){let e=[];return this.partList.forEach(function(t){e=e.concat(t.chainList)}),dV(e)}}class Ece{constructor(e=[],t=[]){this.matrixList=e,this.chainList=t}get type(){return"AssemblyPart"}_getCount(e,t){let n=0;return e.eachChain(r=>{(this.chainList.length===0||this.chainList.includes(r.chainname))&&(n+=r[t])}),this.matrixList.length*n}getAtomCount(e){return this._getCount(e,"atomCount")}getResidueCount(e){return this._getCount(e,"residueCount")}getBoundingBox(e){const t=new Ti,n=new Ti,r=this.getSelection(),s=e.getBoundingBox(r);return this.matrixList.forEach(function(o){n.copy(s).applyMatrix4(o),t.expandByPoint(n.min),t.expandByPoint(n.max)}),t}getSelection(){return dV(this.chainList)}getView(e){const t=this.getSelection();return t?e.getView(t):e}getInstanceList(){const e=[];for(let t=0,n=this.matrixList.length;t<n;++t)e.push({id:t+1,name:t,matrix:this.matrixList[t]});return e}}class Tce{constructor(e){this.structure=e,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1}addResidueType(e){var t,n;const r=this.structure.atomStore,s=this.structure.residueStore,o=this.structure.residueMap,a=(t=this.structure.chemCompMap)===null||t===void 0?void 0:t.dict[this.previousResname],l=s.atomCount[e],c=s.atomOffset[e],u=new Array(l);for(let f=0;f<l;++f)u[f]=r.atomTypeId[c+f];const h=a==null?void 0:a.chemCompType,d=a?(n=this.structure.chemCompMap)===null||n===void 0?void 0:n.getBonds(this.previousResname,u):void 0;s.residueTypeId[e]=o.add(this.previousResname,u,this.previousHetero,h,d)}addAtom(e,t,n,r,s,o,a,l){const c=this.structure.atomStore,u=this.structure.residueStore,h=this.structure.chainStore,d=this.structure.modelStore;let f=!1,m=!1,_=!1;this.currentModelindex!==e?(f=!0,m=!0,_=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==n?(m=!0,_=!0,this.ci+=1,this.ri+=1):this.currentResno===s&&this.currentResname===r&&this.currentInscode===l||(_=!0,this.ri+=1),this.ai+=1,f&&(d.growIfFull(),d.chainOffset[this.mi]=this.ci,d.chainCount[this.mi]=0,d.count+=1,h.modelIndex[this.ci]=this.mi),m&&(h.growIfFull(),h.setChainname(this.ci,t),h.setChainid(this.ci,n),h.residueOffset[this.ci]=this.ri,h.residueCount[this.ci]=0,h.count+=1,h.modelIndex[this.ci]=this.mi,d.chainCount[this.mi]+=1,u.chainIndex[this.ri]=this.ci),_&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),u.growIfFull(),u.resno[this.ri]=s,a!==void 0&&(u.sstruc[this.ri]=a.charCodeAt(0)),l!==void 0&&(u.inscode[this.ri]=l.charCodeAt(0)),u.atomOffset[this.ri]=this.ai,u.atomCount[this.ri]=0,u.count+=1,u.chainIndex[this.ri]=this.ci,h.residueCount[this.ci]+=1),c.count+=1,c.residueIndex[this.ai]=this.ri,u.atomCount[this.ri]+=1,this.currentModelindex=e,this.currentChainid=n,this.currentResname=r,this.currentResno=s,this.currentInscode=l,this.currentHetero=o}finalize(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)}}function fV(i,e){if(!e)return;pt&&tt.time("assignSecondaryStructure");const t=[];i.eachModel(function(c){c.eachChain(function(u){t.push(u.chainname)})});const n=t.slice().sort(),r=[];n.forEach(function(c){r.push(t.indexOf(c))});const s=e.helices.filter(function(c){return Mh(n,c[0])>=0});s.sort(function(c,u){const h=c[0],d=u[0],f=c[1],m=u[1];if(h===d)return f===m?0:f<m?-1:1;{const _=Mh(n,h),v=Mh(n,d);return r[_]<r[v]?-1:1}});const o=i.residueStore;i.eachModel(function(c){let u=0;const h=s.length;if(h===0)return;let d=s[u],f=!1,m=!1;c.eachChain(function(_){let v=!1;if(_.chainname===d[0]){const g=_.residueCount,b=_.residueOffset,p=b+g;for(let y=b;y<p;++y)if(o.resno[y]===d[1]&&o.getInscode(y)===d[2]&&(f=!0),f&&(o.sstruc[y]=d[6],o.resno[y]===d[4]&&o.getInscode(y)===d[5]&&(f=!1,u+=1,u<h?(y=b-1,d=s[u],v=_.chainname!==d[0]):m=!0)),v||m)return}})});const a=e.sheets.filter(function(c){return Mh(n,c[0])>=0});a.sort(function(c,u){const h=c[0],d=u[0];if(h===d)return 0;const f=Mh(n,h),m=Mh(n,d);return r[f]<r[m]?-1:1});const l=101;i.eachModel(function(c){let u=0;const h=a.length;if(h===0)return;let d=a[u],f=!1,m=!1;c.eachChain(function(_){let v=!1;if(_.chainname===d[0]){const g=_.residueCount,b=_.residueOffset,p=b+g;for(let y=b;y<p;++y)if(o.resno[y]===d[1]&&o.getInscode(y)===d[2]&&(f=!0),f&&(o.sstruc[y]=l,o.resno[y]===d[4]&&o.getInscode(y)===d[5]&&(f=!1,u+=1,u<h?(y=b-1,d=a[u],v=_.chainname!==d[0]):m=!0)),v||m)return}})}),pt&&tt.timeEnd("assignSecondaryStructure")}const FS=function(){const i=function(n,r,s,o){const a=n.structure,l=n.residueIndexStart,c=a.getResidueProxy(),u=a.getResidueProxy(),h=a.getAtomProxy(),d=a.getAtomProxy();for(let f=Math.max(0,r-2);f<=r;++f)for(let m=2;m<5;++m){if(f+m>=n.residueCount)continue;c.index=l+f,u.index=l+f+m,h.index=c.traceAtomIndex,d.index=u.traceAtomIndex;const _=h.distanceTo(d);if(Math.abs(_-s[m-2])>o)return!1}return!0},e=function(n,r){return i(n,r,[5.45,5.18,6.37],2.1)},t=function(n,r){return i(n,r,[6.1,10.4,13],1.42)};return function(n){pt&&tt.time("calculateSecondaryStructure"),n.eachPolymer(function(r){if(r.residueCount<4)return;if(r.isCg())(function(a){const l=a.residueStore,c=a.residueIndexStart,u=new uV(a).position,h=new me,d=new me;for(let f=0,m=a.residueCount;f<m;++f){h.fromArray(u.center,3*f),d.fromArray(u.center,3*f+3);const _=h.distanceTo(d);_<2&&_>1&&u.bending[f]<20&&(l.sstruc[c+f]=104,l.sstruc[c+f+1]=104)}})(r);else{if(!r.isProtein())return;(function(a){const l=a.residueStore,c=a.residueIndexStart;for(let u=0,h=a.residueCount;u<h;++u){let d="c";e(a,u)?d="h":t(a,u)&&(d="e"),l.sstruc[c+u]=d.charCodeAt(0)}})(r)}let s,o=0;r.eachResidue(function(a){a.sstruc===s?o+=1:(o===1&&(a.index-=1,a.sstruc="c"),o=1,s=a.sstruc)})}),pt&&tt.timeEnd("calculateSecondaryStructure")}}(),QM="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function i1(i){const e=QM.length;let t=i,n=0,r=QM[t%e];for(;t>=e;)t=Math.floor(t/e),r+=QM[t%e],n+=1;return n>=5&&tt.warn("chainname overflow"),r}function kS(i,e=!1){pt&&tt.time("calculateChainnames");let t=!0;if(i.eachChain(function(n){n.chainname&&(t=!1)}),t){const n=i.modelStore,r=i.chainStore,s=i.residueStore,o=function(_,v,g,b){const p=r.count;for(let y=0;y<b;++y)s.chainIndex[g+y]=p;r.growIfFull(),r.modelIndex[p]=_,r.setChainname(p,v),r.setChainid(p,v),r.residueOffset[p]=g,r.residueCount[p]=b,r.count+=1,n.chainCount[_]+=1},a=i.getAtomProxy(),l=i.getAtomProxy();let c=0,u=0,h=0,d=0;const f=[];s.count===1?f.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):i.eachResidueN(2,function(_,v){let g=!1;const b=_.backboneType,p=v.backboneType,y=hd;d=_.index,_.modelIndex!==v.modelIndex||_.moleculeType!==v.moleculeType?g=!0:b!==y&&b===p&&(a.index=_.backboneEndAtomIndex,l.index=v.backboneStartAtomIndex,g=e?!a.hasBondTo(l):!a.connectedTo(l)),g||v.index!==s.count-1||(g=!0,d=v.index),g&&(f.push({mIndex:u,chainname:i1(c),rStart:h,rCount:d-h+1}),c+=1,_.modelIndex!==v.modelIndex&&(c=0,u+=1),v.index===s.count-1&&d!==v.index&&f.push({mIndex:u,chainname:i1(c),rStart:s.count-1,rCount:1}),h=v.index,d=v.index)}),r.count=0,n.chainCount.fill(0,0,n.count),n.chainOffset.fill(0,0,n.count),f.forEach(function(_){o(_.mIndex,_.chainname,_.rStart,_.rCount)});let m=0;i.eachModel(function(_){n.chainOffset[_.index]=m,m+=n.chainCount[_.index]})}pt&&tt.timeEnd("calculateChainnames")}function mb(i,e="all"){e!=="none"&&(pt&&tt.time("calculateBonds"),um(i,!1,e),hm(i),pt&&tt.timeEnd("calculateBonds"))}const Cce={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function b4(i,e,t){return[e,t]=e<t?[e,t]:[t,e],_p.includes(i)&&e==="C"&&t==="O"||n0.includes(i)&&e==="OP1"&&t==="P"?2:Cce[`${i}|${e}|${t}`]||1}function um(i,e=!1,t="all"){pt&&tt.time("calculateBondsWithin");const n=i.bondStore,r=i.rungBondStore,s=i.getAtomSet(!1),o=i.getAtomProxy(),a=i.getAtomProxy(),l=i.getBondProxy(),c=e?null:function(h){pt&&tt.time("calculateAtomBondMap");var d=[];return h.eachBond(function(f){var m=f.atomIndex1,_=f.atomIndex2;d[m]===void 0&&(d[m]=[]),d[m][_]=f.index}),pt&&tt.timeEnd("calculateAtomBondMap"),d}(i);let u;e||t!=="auto"||(u=new Set,c.forEach((h,d)=>{u.add(d),h.forEach(f=>{u.add(f)})})),i.eachResidue(function(h){if(!e&&c){const m=h.atomCount,_=h.atomOffset;if(m>500)return void tt.warn("more than 500 atoms, skip residue for auto-bonding",h.qualifiedName());if(t==="auto"&&h.hetero){for(let A=h.atomOffset;A<h.atomEnd;A++)if(u.has(A))return}const v=h.getBonds(),g=v.atomIndices1,b=v.atomIndices2,p=v.bondOrders,y=g.length;for(let A=0;A<y;++A){const w=g[A],M=b[A],T=w+_,E=M+_,C=c[T];C!==void 0&&C[E]!==void 0?(l.index=C[E],p[h.residueType.getBondIndex(w,M)]=l.bondOrder):(o.index=T,a.index=E,n.addBond(o,a,p[A]))}}const d=h.residueType.traceAtomIndex,f=h.residueType.rungEndAtomIndex;d!==-1&&f!==-1&&(o.index=h.traceAtomIndex,a.index=h.rungEndAtomIndex,r.addBond(o,a),s.set(o.index),s.set(a.index))}),i.atomSetDict.rung=s,pt&&tt.timeEnd("calculateBondsWithin")}function hm(i,e=!1,t=!1){pt&&tt.time("calculateBondsBetween");const n=i.bondStore,r=i.backboneBondStore,s=i.getAtomSet(!1),o=i.getAtomProxy(),a=i.getAtomProxy();function l(h,d){const f=h.backboneType,m=d.backboneType;if(f!==hd&&f===m){o.index=h.backboneEndAtomIndex,a.index=d.backboneStartAtomIndex;let _=!1,v=!1;t&&o.hasBondTo(a)?(_=!1,v=!0):o.connectedTo(a)&&(_=!e,v=!0),_&&n.addBond(o,a,1),v&&(o.index=h.traceAtomIndex,a.index=d.traceAtomIndex,r.addBond(o,a),s.set(o.index),s.set(a.index))}}r.count===0&&r.resize(i.residueStore.count),i.eachResidueN(2,l);const c=i.getResidueProxy(),u=i.getResidueProxy();if(i.eachChain(function(h){h.residueCount!==0&&(c.index=h.residueOffset,u.index=h.residueOffset+h.residueCount-1,l(u,c))}),i.atomSetDict.backbone=s,!e){pt&&tt.time("calculateBondsBetween inter");const h=i.spatialHash;i.eachResidue(function(d){d.backboneType!==hd||d.isWater()||d.eachAtom(function(f){f.isMetal()||h.eachWithin(f.x,f.y,f.z,4,function(m){a.index=m,f.modelIndex!==a.modelIndex||f.residueIndex===a.residueIndex||a.isMetal()||n.addBondIfConnected(f,a,1)})})}),pt&&tt.timeEnd("calculateBondsBetween inter")}pt&&tt.timeEnd("calculateBondsBetween")}function gb(i){if(!i.unitcell)return;pt&&tt.time("buildUnitcellAssembly");const e=i.unitcell,t=i.center.clone().applyMatrix4(e.cartToFrac),n=t.clone().floor(),r=function(m){const _=Mce[m],v={};if(_===void 0)return console.warn(`spacegroup '${m}' not found in symop library`),v;const g=[];for(let b=0,p=_.length;b<p;b+=3){const y=[];for(let A=0;A<3;++A)y.push(wce[_[b+A]]);g.push(y)}return g.forEach(function(b){let p=0;const y=new Tt().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),A=y.elements;v[b.toString()]=y,b.forEach(function(w){let M=!1,T=!1;for(let E=0,C=w.length;E<C;++E){const N=w[E];if(N==="-")M=!0;else if(N==="+")M=!1;else if(N==="/")T=!0;else if(N==="X")A[0+p]=M?-1:1;else if(N==="Y")A[4+p]=M?-1:1;else if(N==="Z")A[8+p]=M?-1:1;else if(Ace.test(N)){const P=parseInt(N);T?A[12+p]/=P:A[12+p]=P}else tt.warn(`getSymmetryOperations: unknown token '${N}'`)}p+=1})}),v}(e.spacegroup),s=new me,o=new me;function a(m){const _=[];return Object.keys(r).forEach(function(v){const g=r[v].clone();s.copy(t).applyMatrix4(g).floor(),o.setFromMatrixPosition(g),o.sub(s),o.add(n),m&&o.add(m),g.setPosition(o),g.multiplyMatrices(e.fracToCart,g),g.multiply(e.cartToFrac),_.push(g)}),_}const l=new Cu("UNITCELL"),c=a(),u=[];if(i.biomolDict.NCS){u.push(new Tt,...i.biomolDict.NCS.partList[0].matrixList);const m=[];c.forEach(_=>{u.forEach(v=>{m.push(_.clone().multiply(v))})}),l.addPart(m)}else l.addPart(c);const h=new me,d=new Cu("SUPERCELL"),f=Array.prototype.concat.call(a(h.set(1,0,0)),a(h.set(0,1,0)),a(h.set(0,0,1)),a(h.set(-1,0,0)),a(h.set(0,-1,0)),a(h.set(0,0,-1)),a(h.set(1,1,0)),a(h.set(1,0,1)),a(h.set(0,1,1)),a(h.set(-1,-1,0)),a(h.set(-1,0,-1)),a(h.set(0,-1,-1)),a(h.set(1,-1,-1)),a(h.set(1,1,-1)),a(h.set(1,-1,1)),a(h.set(-1,1,1)),a(h.set(-1,-1,1)),a(h.set(-1,1,-1)),a(h.set(0,1,-1)),a(h.set(0,-1,1)),a(h.set(1,0,-1)),a(h.set(-1,0,1)),a(h.set(1,-1,0)),a(h.set(-1,1,0)),a(),a(h.set(1,1,1)),a(h.set(-1,-1,-1)));if(i.biomolDict.NCS){const m=[];f.forEach(function(_){u.forEach(function(v){m.push(_.clone().multiply(v))})}),d.addPart(m)}else d.addPart(f);i.biomolDict.UNITCELL=l,i.biomolDict.SUPERCELL=d,pt&&tt.timeEnd("buildUnitcellAssembly")}const S4=["H","C","O","N","S","P"],Pce=["NA","CL","FE"];function $R(i){let e=i.toUpperCase(),t=0,n=0;for(let s=0;s<e.length;s++)if(e.charCodeAt(s)<65){if(n>0)break;++t}else n=s+1;(t>0||n<e.length)&&(e=e.substring(t,n));const r=e.length;if(r===0)return"";if(r===1)return e;if(r===2){if(Pce.indexOf(e)!==-1)return e;if(S4.indexOf(e[0])!==-1)return e[0];if(e in jG)return e}return r>=3&&S4.indexOf(e[0])!==-1?e[0]:""}function dd(i){const e=i.bondHash,t=e.countArray,n=e.offsetArray,r=e.indexArray,s=i.getBondProxy();i.eachResidue(function(o){const a=o.residueType;if(a.bonds!==void 0)return;var l=o.atomOffset,c=[],u=[],h=[],d={};const f=l+o.atomCount;o.eachAtom(function(m){const _=m.index,v=n[_];for(let g=0,b=t[_];g<b;++g){s.index=r[v+g];let p=s.atomIndex1;if(p<l||p>=f)continue;let y=s.atomIndex2;if(y<l||y>=f)continue;if(p>y){const w=y;y=p,p=w}const A=p+"|"+y;d[A]===void 0&&(d[A]=!0,c.push(p-l),u.push(y-l),h.push(s.bondOrder))}}),a.bonds={atomIndices1:c,atomIndices2:u,bondOrders:h}})}const Rce=[3,11,19,37,55,87],Ice=[4,12,20,38,56,88],Lce=[6,15,16,34],Dce=[1,7,8,9,17,35,53],Nce=[2,10,18,36,54,86],Fce=[13,30,31,48,49,50,80,81,82,83,84,85,112],kce=[5,14,32,33,51,52,85],Uce=[9,17,35,53,85];class Oce{constructor(e,t,n){this.structure=e,this.atomname=t,n=n||$R(t),this.element=n,this.number=jG[n]||0,this.vdw=vle[this.number]||2,this.covalent=_le[this.number]||1.6}getDefaultValence(){const e=a4[this.number];return e?e[0]:-1}getValenceList(){return a4[this.number]||[]}getOuterShellElectronCount(){return yle[this.number]||2}isMetal(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()}isNonmetal(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()}isMetalloid(){return kce.includes(this.number)}isHalogen(){return Uce.includes(this.number)}isDiatomicNonmetal(){return Dce.includes(this.number)}isPolyatomicNonmetal(){return Lce.includes(this.number)}isAlkaliMetal(){return Rce.includes(this.number)}isAlkalineEarthMetal(){return Ice.includes(this.number)}isNobleGas(){return Nce.includes(this.number)}isTransitionMetal(){const e=this.number;return e>=21&&e<=29||e>=39&&e<=47||e>=72&&e<=79||e>=104&&e<=108}isPostTransitionMetal(){return Fce.includes(this.number)}isLanthanide(){return this.number>=57&&this.number<=71}isActinide(){return this.number>=89&&this.number<=103}}class Bce{constructor(e){this.structure=e,this.dict={},this.list=[],this.structure=e}add(e,t){const n=function(s,o){return s+"|"+o}(e=e.toUpperCase(),t=t?t.toUpperCase():$R(e));let r=this.dict[n];if(r===void 0){const s=new Oce(this.structure,e,t);r=this.list.length,this.dict[n]=r,this.list.push(s)}return r}get(e){return this.list[e]}}class zce{constructor(e,t,n,r,s,o){this.structure=e,this.bondReferenceAtomIndices=[],this.resname=t,this.atomTypeIdList=n,this.hetero=r?1:0,this.chemCompType=s,this.bonds=o,this.atomCount=n.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();const a=Ig[this.backboneType],l=Ig[this.backboneStartType],c=Ig[this.backboneEndType],u=this.getAtomIndexByName(a.trace);this.traceAtomIndex=he(u,-1);const h=this.getAtomIndexByName(a.direction1);this.direction1AtomIndex=he(h,-1);const d=this.getAtomIndexByName(a.direction2);this.direction2AtomIndex=he(d,-1);const f=this.getAtomIndexByName(l.backboneStart);this.backboneStartAtomIndex=he(f,-1);const m=this.getAtomIndexByName(c.backboneEnd);let _;this.backboneEndAtomIndex=he(m,-1),_=ble.includes(t)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=he(_,-1)}getBackboneIndexList(){const e=[];let t;switch(this.moleculeType){case 3:t=Mle;break;case 4:case 5:t=YG;break;default:return e}const n=this.structure.atomMap,r=this.atomTypeIdList;for(let s=0,o=this.atomCount;s<o;++s){const a=n.get(r[s]);t.includes(a.atomname)&&e.push(s)}return e}getMoleculeType(){return this.isProtein()?3:this.isRna()?4:this.isDna()?5:this.isWater()?1:this.isIon()?2:this.isSaccharide()?6:0}getBackboneType(e){return this.hasProteinBackbone(e)?1:this.hasRnaBackbone(e)?2:this.hasDnaBackbone(e)?3:this.hasCgProteinBackbone(e)?4:this.hasCgRnaBackbone(e)?5:this.hasCgDnaBackbone(e)?6:hd}isProtein(){return this.chemCompType?fle.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||_p.includes(this.resname)}isCg(){const e=this.backboneType;return e===4||e===5||e===6}isNucleic(){return this.isRna()||this.isDna()}isRna(){return this.chemCompType?ple.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||XG.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))}isDna(){return this.chemCompType?mle.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||qG.includes(this.resname))}isHetero(){return this.hetero===1}isIon(){return Sle.includes(this.resname)}isWater(){return fb.includes(this.resname)}isSaccharide(){return this.chemCompType?VG.includes(this.chemCompType):wle.includes(this.resname)}isStandardAminoacid(){return _p.includes(this.resname)}isStandardBase(){return n0.includes(this.resname)}hasBackboneAtoms(e,t){const n=Ig[t];return e===-1?this.hasAtomWithName(n.trace,n.backboneEnd,n.direction1,n.direction2):e===0?this.hasAtomWithName(n.trace,n.direction1,n.direction2):e===1?this.hasAtomWithName(n.trace,n.backboneStart,n.direction1,n.direction2):this.hasAtomWithName(n.trace,n.backboneStart,n.backboneEnd,n.direction1,n.direction2)}hasProteinBackbone(e){return this.isProtein()&&this.hasBackboneAtoms(e,1)}hasRnaBackbone(e){return this.isRna()&&this.hasBackboneAtoms(e,2)}hasDnaBackbone(e){return this.isDna()&&this.hasBackboneAtoms(e,3)}hasCgProteinBackbone(e){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(e,4)}hasCgRnaBackbone(e){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(e,5)}hasCgDnaBackbone(e){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(e,6)}hasBackbone(e){return this.hasProteinBackbone(e)||this.hasRnaBackbone(e)||this.hasDnaBackbone(e)||this.hasCgProteinBackbone(e)||this.hasCgRnaBackbone(e)||this.hasCgDnaBackbone(e)}getAtomIndexByName(e){const t=this.atomCount,n=this.structure.atomMap,r=this.atomTypeIdList;if(Array.isArray(e))for(let s=0;s<t;++s){const o=r[s];if(e.includes(n.get(o).atomname))return s}else for(let s=0;s<t;++s){const o=r[s];if(e===n.get(o).atomname)return s}}hasAtomWithName(...e){const t=e.length;for(let n=0;n<t;++n)if(e[n]!==void 0&&this.getAtomIndexByName(e[n])===void 0)return!1;return!0}getBonds(e){return this.bonds===void 0&&(this.bonds=function(t){const n=t.structure,r=n.getAtomProxy(),s=n.getAtomProxy(),o=t.atomCount,a=t.atomOffset,l=a+o-1,c=[],u=[],h=[];if(o>500)pt&&tt.warn("more than 500 atoms, skip residue for auto-bonding",t.qualifiedName());else if(o>50){const d=new Sce(t,!0),f=t.isCg()?1.2:2.3;for(let m=a;m<l;++m){r.index=m;const _=r.covalent+f+.3,v=d.nearest(r,1/0,_*_),g=v.length;for(let b=0;b<g;++b)s.index=v[b].index,r.index<s.index&&r.connectedTo(s)&&(c.push(r.index-a),u.push(s.index-a),h.push(b4(r.resname,r.atomname,s.atomname)))}}else for(let d=a;d<l;++d){r.index=d;for(let f=d+1;f<=l;++f)s.index=f,r.connectedTo(s)&&(c.push(d-a),u.push(f-a),h.push(b4(r.resname,r.atomname,s.atomname)))}return{atomIndices1:c,atomIndices2:u,bondOrders:h}}(e)),this.bonds}getRings(){return this.rings===void 0&&this.calculateRings(),this.rings}getBondGraph(){return this.bondGraph===void 0&&this.calculateBondGraph(),this.bondGraph}getAromatic(e){return this.aromaticAtoms===void 0&&this.calculateAromatic(this.structure.getResidueProxy(e.residueIndex)),this.aromaticAtoms}getAromaticRings(e){return this.aromaticRings===void 0&&this.calculateAromatic(e),this.aromaticRings}calculateBondGraph(){const e=this.bondGraph={},t=this.getBonds(),n=t.atomIndices1.length,r=t.atomIndices1,s=t.atomIndices2;for(let o=0;o<n;++o){const a=r[o],l=s[o];(e[a]=e[a]||[]).push(l),(e[l]=e[l]||[]).push(a)}}calculateRings(){const e=function(t,n){const r={count:n,visited:new Int32Array(n),queue:new Int32Array(n),pred:new Int32Array(n),left:new Int32Array(i0),right:new Int32Array(i0),color:new Int32Array(n),currentColor:0,rings:[],atomRings:[],bonds:t};for(let s=0;s<n;s++)r.visited[s]=-1,r.pred[s]=-1;return r}(this.getBondGraph(),this.atomCount);for(let t=0;t<e.count;t++)e.visited[t]>=0||$ce(e,t);this.rings={atomRings:e.atomRings,rings:e.rings}}isAromatic(e){return this.aromaticAtoms=this.getAromatic(e),this.aromaticAtoms[e.index-e.residueAtomOffset]===1}calculateAromatic(e){const t=this.aromaticAtoms=new Uint8Array(this.atomCount),n=this.getRings().rings,r=n.map(o=>function(a){if(a.some(h=>!Gce.includes(h.number)))return!1;let l=0;const c=new Fn(3,a.length),u=c.data;return a.forEach(h=>{u[l+0]=h.x,u[l+1]=h.y,u[l+2]=h.z,l+=3}),new cV(c).vecC.length()<Vce}(o.map(a=>this.structure.getAtomProxy(a+e.atomOffset)))),s=this.aromaticRings=[];n.forEach((o,a)=>{r[a]&&(s.push(o),o.forEach(l=>t[l]=1))})}assignBondReferenceAtomIndices(){const e=this.getBondGraph(),t=this.getRings(),n=t.atomRings,r=t.rings,s=this.bonds,o=s.atomIndices1,a=s.atomIndices2,l=s.bondOrders,c=this.bondReferenceAtomIndices,u=s.atomIndices1.length;c.length=0;for(let h=0;h<u;++h){if(l[h]<=1)continue;let d;const f=o[h],m=a[h],_=n[f],v=n[m];if(_&&v){for(let g=0;g<_.length;g++)if(v.indexOf(_[g])!==-1){d=r[_[g]];break}}if(e[f].length>1)for(let g=0;g<e[f].length;++g){const b=e[f][g];if(b!==m&&(d===void 0||d.indexOf(b)!==-1)){c[h]=b;break}}else if(e[m].length>1)for(let g=0;g<e[m].length;++g){const b=e[m][g];if(b!==f&&(d===void 0||d.indexOf(b)!==-1)){c[h]=b;break}}}}getBondIndex(e,t){const n=this.bonds,r=n.atomIndices1,s=n.atomIndices2;let o=r.indexOf(e),a=s.indexOf(t);const l=a;for(;o!==-1;){for(;a!==-1;){if(o===a)return o;a=s.indexOf(t,a+1)}o=r.indexOf(e,o+1),a=l}}getBondReferenceAtomIndex(e,t){const n=this.getBondIndex(e,t);if(n!==void 0)return this.bondReferenceAtomIndices.length===0&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[n]}}const Gce=[5,6,7,8,14,15,16,32,33,50,51,83],Vce=.05;function Hce(i,e,t){if(t<e)return;const{pred:n,color:r,left:s,right:o}=i,a=++i.currentColor;let l=e;for(let g=0;g<i0&&(r[l]=a,l=n[l],!(l<0));g++);let c=0,u=0,h=!1,d=0;l=t;for(let g=0;g<i0;g++){if(r[l]===a){d=l,h=!0;break}if(o[u++]=l,l=n[l],l<0)break}if(!h)return;l=e;for(let g=0;g<i0&&(s[c++]=l,d!==l)&&(l=n[l],!(l<0));g++);const f=c+u,m=new Array(f);let _=0;for(let g=0;g<c;g++)m[_++]=s[g];for(let g=u-1;g>=0;g--)m[_++]=o[g];const v=i.rings.length;for(let g=0;g<f;++g){const b=m[g];i.atomRings[b]?i.atomRings[b].push(v):i.atomRings[b]=[v]}i.rings.push(m)}function $ce(i,e){const{bonds:t,visited:n,queue:r,pred:s}=i;n[e]=1,r[0]=e;let o=0,a=1;for(;o<a;){const l=r[o++],c=0;if(t[l]===void 0)continue;const u=t[l].length;for(let h=c;h<u;h++){const d=t[l][h];n[d]>0?s[d]!==l&&s[l]!==d&&Hce(i,l,d):(n[d]=1,r[a++]=d,s[d]=l)}}}const i0=4;class Wce{constructor(e){this.structure=e,this.dict={},this.list=[]}add(e,t,n,r="",s){const o=function(l,c,u,h=""){return l+"|"+c.join(",")+"|"+(u?1:0)+"|"+h}(e=e.toUpperCase(),t,n,r);let a=this.dict[o];if(a===void 0){const l=new zce(this.structure,e,t,n,r,s);a=this.list.length,this.dict[o]=a,this.list.push(l)}return a}get(e){return this.list[e]}}class WR{constructor(e,t=0){this.structure=e,this.index=t,this.bondStore=e.bondStore,this._v12=new me,this._v13=new me,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()}get atom1(){return this.structure.getAtomProxy(this.atomIndex1)}get atom2(){return this.structure.getAtomProxy(this.atomIndex2)}get atomIndex1(){return this.bondStore.atomIndex1[this.index]}set atomIndex1(e){this.bondStore.atomIndex1[this.index]=e}get atomIndex2(){return this.bondStore.atomIndex2[this.index]}set atomIndex2(e){this.bondStore.atomIndex2[this.index]=e}get bondOrder(){return this.bondStore.bondOrder[this.index]}set bondOrder(e){this.bondStore.bondOrder[this.index]=e}getOtherAtomIndex(e){return e===this.atomIndex1?this.atomIndex2:this.atomIndex1}getOtherAtom(e){return this.structure.getAtomProxy(this.getOtherAtomIndex(e.index))}getReferenceAtomIndex(){const e=this._ap1,t=this._ap2;if(e.index=this.atomIndex1,t.index=this.atomIndex2,e.residueIndex!==t.residueIndex)return;const n=e.index-e.residueAtomOffset,r=t.index-t.residueAtomOffset,s=e.residueType.getBondReferenceAtomIndex(n,r);if(s!==void 0)return s+e.residueAtomOffset;console.warn("No reference atom found",e.index,t.index)}calculateShiftDir(e=new me){const t=this._ap1,n=this._ap2,r=this._ap3,s=this._v12,o=this._v13;t.index=this.atomIndex1,n.index=this.atomIndex2;const a=this.getReferenceAtomIndex();s.subVectors(t,n).normalize(),a!==void 0?(r.index=a,o.subVectors(t,r)):o.copy(t),o.normalize();let l=s.dot(o);return 1-Math.abs(l)<1e-5&&(o.set(1,0,0),l=s.dot(o),1-Math.abs(l)<1e-5&&(o.set(0,1,0),l=s.dot(o))),e.copy(o.sub(s.multiplyScalar(l))).normalize()}qualifiedName(){return this.atomIndex1+"="+this.atomIndex2}clone(){return new WR(this.structure,this.index)}toObject(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}}class jR{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get chain(){return this.structure.getChainProxy(this.chainIndex)}get chainIndex(){return this.residueStore.chainIndex[this.index]}set chainIndex(e){this.residueStore.chainIndex[this.index]=e}get atomOffset(){return this.residueStore.atomOffset[this.index]}set atomOffset(e){this.residueStore.atomOffset[this.index]=e}get atomCount(){return this.residueStore.atomCount[this.index]}set atomCount(e){this.residueStore.atomCount[this.index]=e}get atomEnd(){return this.atomOffset+this.atomCount-1}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get resno(){return this.residueStore.resno[this.index]}set resno(e){this.residueStore.resno[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.index)}set sstruc(e){this.residueStore.setSstruc(this.index,e)}get inscode(){return this.residueStore.getInscode(this.index)}set inscode(e){this.residueStore.setInscode(this.index,e)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get moleculeType(){return this.residueType.moleculeType}get backboneType(){return this.residueType.backboneType}get backboneStartType(){return this.residueType.backboneStartType}get backboneEndType(){return this.residueType.backboneEndType}get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset}get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset}get direction2AtomIndex(){return this.residueType.direction2AtomIndex+this.atomOffset}get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset}get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset}get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset}get x(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.x[t];return e/this.atomCount}get y(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.y[t];return e/this.atomCount}get z(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.z[t];return e/this.atomCount}eachAtom(e,t){const n=this.atomCount,r=this.atomOffset,s=this.structure._ap,o=r+n;if(t&&t.atomOnlyTest){const a=t.atomOnlyTest;for(let l=r;l<o;++l)s.index=l,a(s)&&e(s)}else for(let a=r;a<o;++a)s.index=a,e(s)}positionToArray(e=[],t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isHetero(){return this.residueType.hetero===1}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isStandardAminoacid(){return this.residueType.isStandardAminoacid()}isStandardBase(){return this.residueType.isStandardBase()}isHelix(){return HG.includes(this.sstruc)}isSheet(){return $G.includes(this.sstruc)}isTurn(){return WG.includes(this.sstruc)&&this.isProtein()}getAtomType(e){return this.atomMap.get(this.atomStore.atomTypeId[e])}getResname1(){return db[this.resname.toUpperCase()]||"X"}getBackboneType(e){switch(e){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}}getAtomIndexByName(e){let t=this.residueType.getAtomIndexByName(e);return t!==void 0&&(t+=this.atomOffset),t}hasAtomWithName(e){return this.residueType.hasAtomWithName(e)}getAtomnameList(){console.warn("getAtomnameList - might be expensive");const e=this.atomCount,t=this.atomOffset,n=new Array(e);for(let r=0;r<e;++r)n[r]=this.getAtomType(t+r).atomname;return n}connectedTo(e){const t=this.structure.getAtomProxy(this.backboneEndAtomIndex),n=this.structure.getAtomProxy(e.backboneStartAtomIndex);return!(!t||!n)&&t.connectedTo(n)}getNextConnectedResidue(){const e=this.chainStore.residueOffset[this.chainIndex],t=this.chainStore.residueCount[this.chainIndex],n=this.index+1;if(n<e+t){const r=this.structure.getResidueProxy(n);if(this.connectedTo(r))return r}else if(n===e+t){const r=this.structure.getResidueProxy(e);if(this.connectedTo(r))return r}}getPreviousConnectedResidue(e){const t=this.chainStore.residueOffset[this.chainIndex],n=this.index-1;if(n>=t){const r=he(e,this.structure.getResidueProxy());if(r.index=n,r.connectedTo(this))return r}else if(n===t-1){const r=this.chainStore.residueCount[this.chainIndex],s=he(e,this.structure.getResidueProxy());if(s.index=t+r-1,s.connectedTo(this))return s}}getBonds(){return this.residueType.getBonds(this)}getRings(){return this.residueType.getRings()}getAromaticRings(){return this.residueType.getAromaticRings(this)}qualifiedName(e=!1){let t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chain&&(t+=":"+this.chainname),t+="/"+this.modelIndex,t}clone(){return new jR(this.structure,this.index)}toObject(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}}class JM{constructor(e,t,n){this.structure=e,this.residueIndexStart=t,this.residueIndexEnd=n,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueCount=n-t+1;const r=this.structure.getResidueProxy(this.residueIndexStart),s=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=r.getPreviousConnectedResidue()!==void 0;const o=s.getNextConnectedResidue();this.isNextConnected=o!==void 0,this.isNextNextConnected=o!==void 0&&o.getNextConnectedResidue()!==void 0,this.isCyclic=s.connectedTo(r),this.__residueProxy=this.structure.getResidueProxy()}get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}isProtein(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()}isCg(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()}isNucleic(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()}getMoleculeType(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType}getBackboneType(e){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(e)}getAtomIndexByType(e,t){this.isCyclic?e===-1?e=this.residueCount-1:e===this.residueCount&&(e=0):(e!==-1||this.isPrevConnected||(e+=1),e!==this.residueCount||this.isNextNextConnected||(e-=1));const n=this.__residueProxy;let r;switch(n.index=this.residueIndexStart+e,t){case"trace":r=n.traceAtomIndex;break;case"direction1":r=n.direction1AtomIndex;break;case"direction2":r=n.direction2AtomIndex;break;default:r=n.getAtomIndexByName(t)}return r}eachAtom(e,t){this.eachResidue(function(n){n.eachAtom(e,t)})}eachAtomN(e,t,n){const r=this.residueCount,s=new Array(e);for(let a=0;a<e;++a)s[a]=this.structure.getAtomProxy(this.getAtomIndexByType(a,n));t.apply(this,s);for(var o=e;o<r;++o){for(let a=1;a<e;++a)s[a-1].index=s[a].index;s[e-1].index=this.getAtomIndexByType(o,n),t.apply(this,s)}}eachResidue(e){const t=this.structure.getResidueProxy(),n=this.residueCount,r=this.residueIndexStart;for(let s=0;s<n;++s)t.index=r+s,e(t)}qualifiedName(){const e=this.structure.getResidueProxy(this.residueIndexStart),t=this.structure.getResidueProxy(this.residueIndexEnd);return e.qualifiedName()+" - "+t.qualifiedName()}}class XR{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get entity(){return this.structure.entityList[this.entityIndex]}get model(){return this.structure.getModelProxy(this.modelIndex)}get entityIndex(){return this.chainStore.entityIndex[this.index]}set entityIndex(e){this.chainStore.entityIndex[this.index]=e}get modelIndex(){return this.chainStore.modelIndex[this.index]}set modelIndex(e){this.chainStore.modelIndex[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.index]}set residueOffset(e){this.chainStore.residueOffset[this.index]=e}get residueCount(){return this.chainStore.residueCount[this.index]}set residueCount(e){this.chainStore.residueCount[this.index]=e}get residueEnd(){return this.residueOffset+this.residueCount-1}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}get chainname(){return this.chainStore.getChainname(this.index)}set chainname(e){this.chainStore.setChainname(this.index,e)}get chainid(){return this.chainStore.getChainid(this.index)}set chainid(e){this.chainStore.setChainid(this.index,e)}eachAtom(e,t){this.eachResidue(function(n){n.eachAtom(e,t)},t)}eachResidue(e,t){const n=this.residueCount,r=this.residueOffset,s=this.structure._rp,o=r+n;if(t&&t.test){const a=t.residueOnlyTest;if(a)for(let l=r;l<o;++l)s.index=l,a(s)&&e(s);else for(let l=r;l<o;++l)s.index=l,e(s)}else for(let a=r;a<o;++a)s.index=a,e(s)}eachResidueN(e,t){const n=this.residueCount,r=this.residueOffset,s=r+n;if(n<e)return;const o=new Array(e);for(let a=0;a<e;++a)o[a]=this.structure.getResidueProxy(r+a);t.apply(this,o);for(let a=r+e;a<s;++a){for(let l=0;l<e;++l)o[l].index+=1;t.apply(this,o)}}eachPolymer(e,t){let n=0,r=0;const s=t?t.residueOnlyTest:void 0,o=this.model.structure,a=this.residueCount,l=this.residueOffset,c=l+a,u=this.structure.getResidueProxy(),h=this.structure.getResidueProxy(l),d=this.structure.getAtomProxy(),f=this.structure.getAtomProxy();let m=!0;for(let _=l+1;_<c;++_){u.index=h.index,h.index=_;const v=m?u.backboneEndType:u.backboneType,g=h.backboneType;m&&(n=u.index,m=!1),r=h.index,v!==hd&&v===g?(d.index=u.backboneEndAtomIndex,f.index=h.backboneStartAtomIndex,d&&f&&d.connectedTo(f)&&(!s||s(u)&&s(h))||(u.index-n>1&&e(new JM(o,n,u.index)),n=r)):(v!==hd&&u.index-n>1&&e(new JM(o,n,u.index)),n=r)}r-n>1&&this.structure.getResidueProxy(n).backboneEndType&&e(new JM(o,n,r))}qualifiedName(){return":"+this.chainname+"/"+this.modelIndex}clone(){return new XR(this.structure,this.index)}toObject(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}}class qR{constructor(e,t=0){this.structure=e,this.index=t,this.modelStore=e.modelStore,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get chainOffset(){return this.modelStore.chainOffset[this.index]}set chainOffset(e){this.modelStore.chainOffset[this.index]=e}get chainCount(){return this.modelStore.chainCount[this.index]}set chainCount(e){this.modelStore.chainCount[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.chainOffset]}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get chainEnd(){return this.chainOffset+this.chainCount-1}get residueEnd(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get residueCount(){return this.chainCount===0?0:this.residueEnd-this.residueOffset+1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}eachAtom(e,t){this.eachChain(function(n){n.eachAtom(e,t)},t)}eachResidue(e,t){this.eachChain(function(n){n.eachResidue(e,t)},t)}eachPolymer(e,t){if(t&&t.chainOnlyTest){const n=t.chainOnlyTest;this.eachChain(function(r){n(r)&&r.eachPolymer(e,t)})}else this.eachChain(function(n){n.eachPolymer(e,t)})}eachChain(e,t){const n=this.chainCount,r=this.chainOffset,s=this.structure._cp,o=r+n;if(t&&t.test){const a=t.chainOnlyTest;if(a)for(let l=r;l<o;++l)s.index=l,a(s)&&e(s);else for(let l=r;l<o;++l)s.index=l,e(s)}else for(let a=r;a<o;++a)s.index=a,e(s)}qualifiedName(){return"/"+this.index}clone(){return new qR(this.structure,this.index)}toObject(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}}class Ja{constructor(e="",t=""){this.signals={refreshed:new tn.Signal},this.init(e,t)}init(e,t){this.name=e,this.path=t,this.title="",this.id="",this.data={structure:this,"@spatialLookup":void 0,"@valenceModel":void 0},this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new yx(0),this.backboneBondStore=new yx(0),this.rungBondStore=new yx(0),this.atomStore=new mce(0),this.residueStore=new gce(0),this.chainStore=new vce(0),this.modelStore=new _ce(0),this.atomMap=new Bce(this),this.residueMap=new Wce(this),this.chemCompMap=void 0,this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new me,this.boundingBox=new Ti,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()}get type(){return"Structure"}finalizeAtoms(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new me),this.spatialHash=new e1(this.atomStore,this.boundingBox)}finalizeBonds(){this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new pce(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(let e in this.atomSetDict)this.atomSetCache["__"+e]=this.atomSetDict[e].clone()}getBondProxy(e){return new WR(this,e)}getAtomProxy(e){return new NS(this,e)}getResidueProxy(e){return new jR(this,e)}getChainProxy(e){return new XR(this,e)}getModelProxy(e){return new qR(this,e)}getBondSet(){const e=this.bondStore.count,t=new or(e),n=this.atomSet;if(n)if(n.isAllSet())t.setAll();else if(n.isAllClear())t.clearAll();else{const r=this.getBondProxy();for(let s=0;s<e;++s)r.index=s,n.isSet(r.atomIndex1,r.atomIndex2)&&t.set(r.index)}else t.setAll();return t}getBackboneBondSet(){const e=this.backboneBondStore.count,t=new or(e),n=this.atomSetCache.__backbone;if(n){const r=this.getBondProxy();r.bondStore=this.backboneBondStore;for(let s=0;s<e;++s)r.index=s,n.isSet(r.atomIndex1,r.atomIndex2)&&t.set(r.index)}else t.setAll();return t}getRungBondSet(){const e=this.rungBondStore.count,t=new or(e),n=this.atomSetCache.__rung;if(n){const r=this.getBondProxy();r.bondStore=this.rungBondStore;for(let s=0;s<e;++s)r.index=s,n.isSet(r.atomIndex1,r.atomIndex2)&&t.set(r.index)}else t.setAll();return t}getAtomSet(e){const t=this.atomStore.count;if(e===void 0)return new or(t,!0);if(e instanceof or)return e;if(e===!0)return new or(t,!0);if(e&&e.test){const n=e.string;if(n in this.atomSetCache)return this.atomSetCache[n];if(n==="")return new or(t,!0);{const r=new or(t);return this.eachAtom(function(s){r.set(s.index)},e),this.atomSetCache[n]=r,r}}return e===!1?new or(t):new or(t,!0)}getAtomSetWithinSelection(e,t){const n=this.spatialHash,r=this.getAtomSet(!1),s=this.getAtomProxy();return n&&this.getAtomSet(e).forEach(function(o){s.index=o,n.within(s.x,s.y,s.z,t).forEach(function(a){r.set(a)})}),r}getAtomSetWithinPoint(e,t){const n=e,r=this.getAtomSet(!1);return this.spatialHash&&this.spatialHash.within(n.x,n.y,n.z,t).forEach(function(s){r.set(s)}),r}getAtomSetWithinVolume(e,t,n,r,s){const o=new Vl(e,n,r,s),a=o.getDataPosition(),l=a.length,c=o.matrix.getMaxScaleOnAxis(),u=this.getAtomSet(!1);if(!this.spatialHash)return u;for(let h=0;h<l;h+=3)this.spatialHash.within(a[h],a[h+1],a[h+2],c).forEach(function(d){u.set(d)});return u}getAtomSetWithinGroup(e){const t=this.atomStore.residueIndex,n=this.getAtomSet(!1),r=this.getResidueProxy();return this.getAtomSet(e).forEach(function(s){r.index=t[s];for(let o=r.atomOffset;o<=r.atomEnd;++o)n.set(o)}),n}getSelection(){}getStructure(){return this}eachEntity(e,t){this.entityList.forEach(function(n){t!==void 0&&n.getEntityType()!==t||e(n)})}eachBond(e,t){const n=this.getBondProxy();let r;if(t&&t.test&&(r=this.getBondSet(),this.bondSet&&r.intersection(this.bondSet)),r)r.forEach(function(s){n.index=s,e(n)});else{const s=this.bondStore.count;for(let o=0;o<s;++o)n.index=o,e(n)}}eachAtom(e,t){if(t&&t.test)this.eachModel(function(n){n.eachAtom(e,t)},t);else{const n=this.atomStore.count,r=this.getAtomProxy();for(let s=0;s<n;++s)r.index=s,e(r)}}eachResidue(e,t){if(t&&t.test){const n=this.modelStore.count,r=this.getModelProxy(),s=t.modelOnlyTest;if(s)for(let o=0;o<n;++o)r.index=o,s(r)&&r.eachResidue(e,t);else for(let o=0;o<n;++o)r.index=o,r.eachResidue(e,t)}else{const n=this.residueStore.count,r=this.getResidueProxy();for(let s=0;s<n;++s)r.index=s,e(r)}}eachResidueN(e,t){const n=this.residueStore.count;if(n<e)return;const r=new Array(e);for(let s=0;s<e;++s)r[s]=this.getResidueProxy(s);t.apply(this,r);for(let s=e;s<n;++s){for(let o=0;o<e;++o)r[o].index+=1;t.apply(this,r)}}eachPolymer(e,t){if(t&&t.modelOnlyTest){const n=t.modelOnlyTest;this.eachModel(function(r){n(r)&&r.eachPolymer(e,t)})}else this.eachModel(function(n){n.eachPolymer(e,t)})}eachChain(e,t){if(t&&t.test)this.eachModel(function(n){n.eachChain(e,t)});else{const n=this.chainStore.count,r=this.getChainProxy();for(let s=0;s<n;++s)r.index=s,e(r)}}eachModel(e,t){const n=this.modelStore.count,r=this.getModelProxy();if(t&&t.test){const s=t.modelOnlyTest;if(s)for(let o=0;o<n;++o)r.index=o,s(r)&&e(r);else for(let o=0;o<n;++o)r.index=o,e(r)}else for(let s=0;s<n;++s)r.index=s,e(r)}getAtomData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,r=he(t.atomSet,this.atomSet);let s,o;const a={},l=this.getAtomProxy(),c=r.getSize();n&&!n.position||(a.position=new Float32Array(3*c)),n&&!n.color||!t.colorParams||(a.color=new Float32Array(3*c),o=gn.getScheme(t.colorParams)),n&&!n.picking||(a.picking=new Sd(new Float32Array(c),this.getStructure())),n&&!n.radius||(a.radius=new Float32Array(c),s=new fc(t.radiusParams)),n&&!n.index||(a.index=new Uint32Array(c));const{position:u,color:h,picking:d,radius:f,index:m}=a;return r.forEach((_,v)=>{const g=3*v;l.index=_,u&&l.positionToArray(u,g),h&&o.atomColorToArray(l,h,g),d&&(d.array[v]=_),f&&(f[v]=s.atomRadius(l)),m&&(m[v]=_)}),a}getBondData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,r=he(t.bondSet,this.bondSet),s=he(t.multipleBond,"off"),o=s!=="off",a=s==="offset",l=he(t.bondScale,.4),c=he(t.bondSpacing,1);let u,h;const d={},f=this.getBondProxy();t.bondStore&&(f.bondStore=t.bondStore);const m=this.getAtomProxy(),_=this.getAtomProxy();let v;if(o){const U=f.bondStore.bondOrder;v=0,r.forEach(function(G){v+=U[G]})}else v=r.getSize();n&&!n.position||(d.position1=new Float32Array(3*v),d.position2=new Float32Array(3*v)),n&&!n.color||!t.colorParams||(d.color=new Float32Array(3*v),d.color2=new Float32Array(3*v),h=gn.getScheme(t.colorParams)),n&&!n.picking||(d.picking=new ZG(new Float32Array(v),this.getStructure(),t.bondStore)),(!n||n.radius||o&&n.position)&&(u=new fc(t.radiusParams)),n&&!n.radius||(d.radius=new Float32Array(v),t.radius2&&(d.radius2=new Float32Array(v)));const{position1:g,position2:b,color:p,color2:y,picking:A,radius:w,radius2:M}=d;let T,E,C,N,P,L,R=0;const F=new me,V=new me,z=new me;return r.forEach(U=>{if(E=3*R,f.index=U,m.index=f.atomIndex1,_.index=f.atomIndex2,N=f.bondOrder,g)if(o&&N>1){const G=u.atomRadius(m);L=G*l/(.5*N),f.calculateShiftDir(z),a?(P=2*c*G,z.multiplyScalar(P),z.negate(),V.subVectors(_,m).multiplyScalar(Math.max(.1,P/1.88)),m.positionToArray(g,E),_.positionToArray(b,E),N>=2&&(F.addVectors(m,z).add(V).toArray(g,E+3),F.addVectors(_,z).sub(V).toArray(b,E+3),N>=3&&(F.subVectors(m,z).add(V).toArray(g,E+6),F.subVectors(_,z).sub(V).toArray(b,E+6)))):(P=(c-l)*G,z.multiplyScalar(P),N===2?(F.addVectors(m,z).toArray(g,E),F.subVectors(m,z).toArray(g,E+3),F.addVectors(_,z).toArray(b,E),F.subVectors(_,z).toArray(b,E+3)):N===3?(m.positionToArray(g,E),F.addVectors(m,z).toArray(g,E+3),F.subVectors(m,z).toArray(g,E+6),_.positionToArray(b,E),F.addVectors(_,z).toArray(b,E+3),F.subVectors(_,z).toArray(b,E+6)):(m.positionToArray(g,E),_.positionToArray(b,E)))}else m.positionToArray(g,E),_.positionToArray(b,E);if(p&&y&&(h.bondColorToArray(f,1,p,E),h.bondColorToArray(f,0,y,E),o&&N>1))for(T=1;T<N;++T)C=3*T+E,Gk(p,E,C,3),Gk(y,E,C,3);if(A&&A.array&&(A.array[R]=U,o&&N>1))for(T=1;T<N;++T)A.array[R+T]=U;if(w&&(w[R]=u.atomRadius(m),o&&N>1))for(L=w[R]*l/(a?1:.5*N),T=a?1:0;T<N;++T)w[R+T]=L;if(M&&(M[R]=u.atomRadius(_),o&&N>1))for(L=M[R]*l/(a?1:.5*N),T=a?1:0;T<N;++T)M[R+T]=L;R+=o?N:1}),d}getBackboneAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__backbone},e),this.getAtomData(e)}getBackboneBondData(e){return e=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},e),this.getBondData(e)}getRungAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__rung},e),this.getAtomData(e)}getRungBondData(e){return e=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},e),this.getBondData(e)}getBoundingBox(e,t){pt&&tt.time("getBoundingBox"),t=t||new Ti;let n=1/0,r=1/0,s=1/0,o=-1/0,a=-1/0,l=-1/0;return this.eachAtom(c=>{const u=c.x,h=c.y,d=c.z;u<n&&(n=u),h<r&&(r=h),d<s&&(s=d),u>o&&(o=u),h>a&&(a=h),d>l&&(l=d)},e),t.min.set(n,r,s),t.max.set(o,a,l),pt&&tt.timeEnd("getBoundingBox"),t}getPrincipalAxes(e){pt&&tt.time("getPrincipalAxes");let t=0;const n=new Fn(3,this.atomCount),r=n.data;return this.eachAtom(s=>{r[t+0]=s.x,r[t+1]=s.y,r[t+2]=s.z,t+=3},e),pt&&tt.timeEnd("getPrincipalAxes"),new cV(n)}atomCenter(e){return e?this.getBoundingBox(e).getCenter(new me):this.center.clone()}hasCoords(){if(this._hasCoords===void 0){const e=this.atomStore;this._hasCoords=px(e.x)!==0||fx(e.x)!==0||px(e.y)!==0||fx(e.y)!==0||px(e.z)!==0||fx(e.z)!==0||e.count/this.modelStore.count==1}return this._hasCoords}getSequence(e){const t=[],n=this.getResidueProxy();return this.eachAtom(function(r){n.index=r.residueIndex,r.index===n.traceAtomIndex&&t.push(n.getResname1())},e),t}getAtomIndices(e){if(e&&e.string){const t=[];return this.eachAtom(function(n){t.push(n.index)},e),new Uint32Array(t)}{const t={what:{index:!0}};return this.getAtomData(t).index}}getChainnameCount(e){const t=new Set;return this.eachChain(function(n){n.residueCount&&t.add(n.chainname)},e),t.size}updatePosition(e,t=!0){let n=0;this.eachAtom(function(r){r.positionFromArray(e,n),n+=3},void 0),this._hasCoords=void 0,t&&this.refreshPosition()}refreshPosition(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new e1(this.atomStore,this.boundingBox),this.signals.refreshed.dispatch(this)}dispose(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet}}const w4=new Ti,eA=[RS,cd,IS,ud,Wp,CS,$p,PS,hb,LS,Q0,J0],jce={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2};class Xce{constructor(e="shape",t={}){this.boundingBox=new Ti,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=e,this.parameters=wo(t,jce),eA.forEach(n=>{Object.keys(n.fields).forEach(r=>{this._primitiveData[n.getShapeKey(r)]=[]}),this._primitiveData[n.getShapeKey("name")]=[]})}addBuffer(e){this.bufferList.push(e);const t=e.geometry;return t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox),this}addMesh(e,t,n,r,s){let o;e=NM(e),t=NM(t),Array.isArray(n)&&(n=fl(n,e.length)),r&&(r=NM(r)),o=r===void 0||r.length==0?{position:e,color:t,index:n}:{position:e,color:t,index:n,normal:r};const a=new Kle(this,Object.assign({serial:this.meshCount,name:s},o)),l=new dc(Object.assign({picking:a},o));return this.bufferList.push(l),w4.setFromArray(e),this.boundingBox.union(w4),this.meshCount+=1,this}addSphere(e,t,n,r){return $p.objectToShape(this,{position:e,color:t,radius:n,name:r}),this}addEllipsoid(e,t,n,r,s,o){return Wp.objectToShape(this,{position:e,color:t,radius:n,majorAxis:r,minorAxis:s,name:o}),this}addTorus(e,t,n,r,s,o){return LS.objectToShape(this,{position:e,color:t,radius:n,majorAxis:r,minorAxis:s,name:o}),this}addCylinder(e,t,n,r,s){return ud.objectToShape(this,{position1:e,position2:t,color:n,radius:r,name:s}),this}addCone(e,t,n,r,s){return IS.objectToShape(this,{position1:e,position2:t,color:n,radius:r,name:s}),this}addArrow(e,t,n,r,s){return RS.objectToShape(this,{position1:e,position2:t,color:n,radius:r,name:s}),this}addBox(e,t,n,r,s,o){return cd.objectToShape(this,{position:e,color:t,size:n,heightAxis:r,depthAxis:s,name:o}),this}addOctahedron(e,t,n,r,s,o){return CS.objectToShape(this,{position:e,color:t,size:n,heightAxis:r,depthAxis:s,name:o}),this}addTetrahedron(e,t,n,r,s,o){return PS.objectToShape(this,{position:e,color:t,size:n,heightAxis:r,depthAxis:s,name:o}),this}addText(e,t,n,r){return hb.objectToShape(this,{position:e,color:t,size:n,text:r}),this}addPoint(e,t,n){return Q0.objectToShape(this,{position:e,color:t,name:n}),this}addWideline(e,t,n,r,s){return this.parameters.linewidth=r,J0.objectToShape(this,{position1:e,position2:t,color:n,name:s}),this}addLabel(e,t,n,r){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(e,t,n,r)}getBufferList(){const e=[];return eA.forEach(t=>{this._primitiveData[t.getShapeKey("color")].length&&e.push(t.bufferFromShape(this,this.parameters))}),this.bufferList.concat(e)}dispose(){this.bufferList.forEach(function(e){e.dispose()}),this.bufferList.length=0,eA.forEach(e=>{Object.keys(e.fields).forEach(t=>{this._primitiveData[e.getShapeKey(t)].length=0}),this._primitiveData[e.getShapeKey("name")].length=0})}get center(){return this._center||(this._center=this.boundingBox.getCenter(new me)),this._center}get type(){return"Shape"}}class M4 extends C1{constructor(e,t,n){Array.isArray(e)||(e=[e]),super(e,t,n),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=e,this.init(n)}init(e){super.init(e),this.build()}create(){this.bufferList.push.apply(this.bufferList,this.buffer)}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t),t.setParameters(this.getBufferParams())}),this.setVisibility(this.visible),e()}}const vy=new Tt,A4=new mn;class Fu extends dc{constructor(e,t={},n){super(function(l,c){const u=c.attributes.position.array,h=c.index?c.index.array:void 0,d=l.position.length/3,f=u.length/3,m=d*f,_=new Float32Array(3*m),v=new Float32Array(3*m),g=new Float32Array(3*m);let b;return h&&(b=fl(d*h.length,m)),{position:_,color:g,index:b,normal:v,primitiveId:l.primitiveId||iC(d,f),picking:l.picking}}(e,n),t),this.updateNormals=!1;const r=n.attributes.position.array,s=n.attributes.normal.array,o=n.index?n.index.array:void 0;this.geoPosition=r,this.geoNormal=s,this.geoIndex=o,this.positionCount=e.position.length/3,this.geoPositionCount=r.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);const a=this.geometry.attributes;if(this.meshPosition=a.position.array,this.meshColor=a.color.array,this.meshNormal=a.normal.array,this.setAttributes(e),o){const l=this.geometry.getIndex();if(!l)return void tt.error("Index is null");this.meshIndex=l.array,this.makeIndex()}}setAttributes(e={},t=!1){const n=this.geometry.attributes;let r,s,o,a,l,c,u,h,d;const f=this.updateNormals;e.position&&(r=e.position,o=this.geoPosition,u=this.meshPosition,l=this.transformedGeoPosition,n.position.needsUpdate=!0,(f||t)&&(a=this.geoNormal,d=this.meshNormal,c=this.transformedGeoNormal,n.normal.needsUpdate=!0)),e.color&&(s=e.color,h=this.meshColor,n.color.needsUpdate=!0);const m=this.positionCount,_=this.geoPositionCount;for(let v=0;v<m;++v){let g,b;const p=v*_*3,y=3*v;if(r&&l&&u&&d&&o&&a&&(l.set(o),vy.makeTranslation(r[y],r[y+1],r[y+2]),this.applyPositionTransform(vy,v,y),ES(vy.elements,l),u.set(l,p),f&&c?(c.set(a),A4.getNormalMatrix(vy),zR(A4.elements,c),d.set(c,p)):t&&d.set(a,p)),s&&h)for(g=0;g<_;++g)b=p+3*g,h[b]=s[y],h[b+1]=s[y+1],h[b+2]=s[y+2]}}makeIndex(){const e=this.geoIndex,t=this.meshIndex;if(!e)return;const n=this.positionCount,r=this.geoPositionCount,s=3*(e.length/3);for(let o=0;o<n;++o){const a=o*s,l=a+s;t.set(e,a);for(let c=a;c<l;++c)t[c]+=o*r}}}const E4=new me,pV=Object.assign({sphereDetail:1},Ls);class qce extends Fu{constructor(e,t={}){super(e,t,new wS(1,he(t.sphereDetail,1))),this.setAttributes(e,!0)}get defaultParameters(){return pV}applyPositionTransform(e,t){const n=this._radius[t];E4.set(n,n,n),e.scale(E4)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}An.add("shader/SphereImpostor.vert",`uniform mat4 projectionMatrixInverse;
uniform float clipNear;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
attribute vec2 mapping;
attribute float radius;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
#include matrix_scale
const mat4 D = mat4(
1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, -1.0
);
mat4 transposeM( in mat4 inMatrix ) {
vec4 i0 = inMatrix[0];
vec4 i1 = inMatrix[1];
vec4 i2 = inMatrix[2];
vec4 i3 = inMatrix[3];
mat4 outMatrix = mat4(
vec4(i0.x, i1.x, i2.x, i3.x),
vec4(i0.y, i1.y, i2.y, i3.y),
vec4(i0.z, i1.z, i2.z, i3.z),
vec4(i0.w, i1.w, i2.w, i3.w)
);
return outMatrix;
}
void ComputePointSizeAndPositionInClipCoordSphere(){
vec2 xbc;
vec2 ybc;
mat4 T = mat4(
radius, 0.0, 0.0, 0.0,
0.0, radius, 0.0, 0.0,
0.0, 0.0, radius, 0.0,
position.x, position.y, position.z, 1.0
);
mat4 R = transposeM( projectionMatrix * modelViewMatrix * T );
float A = dot( R[ 3 ], D * R[ 3 ] );
float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );
float C = dot( R[ 0 ], D * R[ 0 ] );
xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;
A = dot( R[ 3 ], D * R[ 3 ] );
B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );
C = dot( R[ 1 ], D * R[ 1 ] );
ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;
gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );
gl_Position.xy -= mapping * vec2( sx, sy );
gl_Position.xy *= gl_Position.w;
}
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
vRadius = radius * matrixScale( modelViewMatrix );
vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
mvPosition.z -= vRadius;
gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );
ComputePointSizeAndPositionInClipCoordSphere();
vRadiusSq = vRadius * vRadius;
vec4 vPoint4 = projectionMatrixInverse * gl_Position;
vPoint = vPoint4.xyz / vPoint4.w;
vPointViewPosition = -mvPosition.xyz / mvPosition.w;
}`),An.add("shader/SphereImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool flag2 = false;
bool interior = false;
vec3 cameraPos;
vec3 cameraNormal;
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){
vec3 cameraSpherePos = -vPointViewPosition;
cameraSpherePos.z += vRadius;
vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );
vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );
vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );
float B = dot( rayDirection, cameraSphereDir );
float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );
if( det < 0.0 ){
discard;
return false;
}
float sqrtDet = sqrt( det );
float posT = mix( B + sqrtDet, B + sqrtDet, ortho );
float negT = mix( B - sqrtDet, sqrtDet - B, ortho );
cameraPos = rayDirection * negT + rayOrigin;
#ifdef NEAR_CLIP
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}else if( calcClip( cameraPos ) > 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
flag2 = true;
}
#else
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}
#endif
cameraNormal = normalize( cameraPos - cameraSpherePos );
cameraNormal *= float(!interior) * 2.0 - 1.0;
return !interior;
}
void main(void){
bool flag = Impostor( cameraPos, cameraNormal );
#ifdef NEAR_CLIP
if( calcClip( cameraPos ) > 0.0 )
discard;
#endif
gl_FragDepthEXT = calcDepth( cameraPos );
if( !flag ){
#ifdef NEAR_CLIP
if( flag2 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}else if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#else
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#endif
}
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vNormal = cameraNormal;
vec3 vViewPosition = -cameraPos;
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);class YR extends pl{constructor(e,t,n={}){super(t,n),this.index=fl(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:e,value:null}}),this.setAttributes({primitiveId:lm(this.size)})}get attributeSize(){return this.size*this.mappingSize}get indexSize(){return this.size*this.mappingIndicesSize}addAttributes(e){const t={};for(const n in e){const r=e[n];t[n]={type:r.type,value:null}}super.addAttributes(t)}getAttributeIndex(e){return 3*e*this.mappingSize}setAttributes(e){e&&!e.position&&e.position1&&e.position2&&(e.position=ll(e.position1,e.position2));const t=this.size,n=this.mappingSize,r=this.geometry.attributes;let s,o,a,l,c,u,h;for(const d in e)if(d!=="index"&&d!=="picking"){o=e[d],s=r[d],a=s.itemSize,l=s.array;for(let f=0;f<t;++f){c=f*a,u=c*n;for(let m=0;m<n;++m){h=u+a*m;for(let _=0;_<a;++_)l[h+_]=o[c+_]}}s.needsUpdate=!0}}makeMapping(){const e=this.size,t=this.mapping,n=this.mappingSize,r=this.mappingItemSize,s=this.geometry.attributes.mapping.array;for(let o=0;o<e;o++)s.set(t,o*r*n)}makeIndex(){const e=this.size,t=this.mappingSize,n=this.mappingIndices,r=this.mappingIndicesSize,s=this.index;for(let o=0;o<e;o++){const a=o*r,l=o*t;s.set(n,a);for(let c=0;c<r;++c)s[a+c]+=l}}}const Yce=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Kce=new Uint16Array([0,1,2,1,3,2]);class KR extends YR{constructor(e,t={}){super("v2",e,t)}get mapping(){return Yce}get mappingIndices(){return Kce}get mappingIndicesSize(){return 6}get mappingSize(){return 4}get mappingItemSize(){return 2}}class Zce extends KR{constructor(e,t={}){super(e,t),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new Tt},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}}Object.assign({disableImpostor:!1},pV);const ku=class{constructor(i,e){return!al||e&&e.disableImpostor?new qce(i,e):new Zce(i,e)}};function Qce(i,e,t,n){const r=t-i,s=n-e;return Math.sqrt(r*r+s*s)}To.add("sphere",ku),An.add("shader/Point.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float size;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
varying vec3 vViewPosition;
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
#include begin_vertex
#include project_vertex
#ifdef USE_SIZEATTENUATION
gl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );
#else
gl_PointSize = size * pixelRatio;
#endif
#ifndef PICKING
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),An.add("shader/Point.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef USE_MAP
uniform sampler2D map;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include alphatest_pars_fragment
varying vec3 vViewPosition;
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
#ifdef USE_MAP
if( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )
discard;
#endif
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
#ifdef USE_MAP
diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );
#endif
#include color_fragment
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Jce=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},Ls),eue=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{uniform:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},wd);class ZR extends pl{constructor(e,t={}){super(e,t),this.parameterTypes=eue,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null},alphaTest:{value:this.parameters.alphaTest}})}get defaultParameters(){return Jce}makeMaterial(){super.makeMaterial(),this.makeTexture();const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.uniforms.map.value=this.tex,e.needsUpdate=!0,t.uniforms.map.value=this.tex,t.needsUpdate=!0,n.uniforms.map.value=this.tex,n.needsUpdate=!0}makeTexture(){this.tex&&this.tex.dispose(),this.tex=function(e){const t=e||{},n=he(t.width,256),r=he(t.height,256),s=[n/2,r/2],o=Math.min(n/2,r/2),a=he(t.delta,1/(o+1))*o;let l=0,c=0;const u=new Uint8Array(n*r*4);for(let d=0,f=u.length;d<f;d+=4){const m=1-A1(o-a,o,Qce(l,c,s[0],s[1]));u[d]=255*m,u[d+1]=255*m,u[d+2]=255*m,u[d+3]=255*m,++l===n&&(l=0,c++)}const h=new ZT(u,n,r);return h.needsUpdate=!0,h}({delta:this.parameters.edgeBleach})}getDefines(e){const t=super.getDefines(e);return this.parameters.sizeAttenuation&&(t.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(t.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(t.USE_ALPHATEST=1),t}setUniforms(e){e&&e.edgeBleach!==void 0&&(this.makeTexture(),e.map=this.tex),super.setUniforms(e)}dispose(){super.dispose(),this.tex&&this.tex.dispose()}}To.add("point",ZR);class T4 extends C1{constructor(e,t,n){super(e,t,n),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),e instanceof zs?(this.surface=void 0,this.volume=new Vl(e)):(this.surface=e,this.volume=void 0),this.init(n)}init(e){var t=e||{};t.colorScheme=he(t.colorScheme,"uniform"),t.colorValue=he(t.colorValue,14540253),this.thresholdType=he(t.thresholdType,"sigma"),this.thresholdMin=he(t.thresholdMin,2),this.thresholdMax=he(t.thresholdMax,1/0),this.thresholdOut=he(t.thresholdOut,!1),this.dotType=he(t.dotType,"point"),this.radius=he(t.radius,.1),this.scale=he(t.scale,1),this.pointSize=he(t.pointSize,1),this.sizeAttenuation=he(t.sizeAttenuation,!0),this.sortParticles=he(t.sortParticles,!1),this.useTexture=he(t.useTexture,!1),this.alphaTest=he(t.alphaTest,.5),this.forceTransparent=he(t.forceTransparent,!1),this.edgeBleach=he(t.edgeBleach,0),super.init(t),this.build()}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t)}),this.setVisibility(this.visible),e()}create(){var e={};if(this.volume){var t,n,r=this.volume;this.thresholdType==="sigma"?(t=r.getValueForSigma(this.thresholdMin),n=r.getValueForSigma(this.thresholdMax)):(t=this.thresholdMin,n=this.thresholdMax),r.setFilter(t,n,this.thresholdOut),Object.assign(e,{position:r.getDataPosition(),color:r.getDataColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:r.getDataSize(this.radius,this.scale),picking:r.getDataPicking()})}else{var s=this.surface;Object.assign(e,{position:s.getPosition(),color:s.getColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:s.getSize(this.radius,this.scale),picking:s.getPicking()})}this.dotType==="sphere"?this.dotBuffer=new ku(e,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new ZR(e,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)}update(e={}){if(this.bufferList.length===0)return;const t={};e.color&&(this.volume?Object.assign(t,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(t,{color:this.surface.getColor(this.getColorParams())})),this.dotType==="sphere"&&(e.radius||e.scale)&&(this.volume?Object.assign(t,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(t,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(t)}setParameters(e,t={},n){return e&&e.thresholdType!==void 0&&this.volume instanceof zs&&(this.thresholdType==="value"&&e.thresholdType==="sigma"?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):this.thresholdType==="sigma"&&e.thresholdType==="value"&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=e.thresholdType),e&&e.radiusType!==void 0&&(e.radiusType==="radius"?this.radius=.1:this.radius=parseFloat(e.radiusType),t.radius=!0,this.dotType!=="sphere"||al&&!this.disableImpostor||(n=!0)),e&&e.radius!==void 0&&(t.radius=!0,this.dotType!=="sphere"||al&&!this.disableImpostor||(n=!0)),e&&e.scale!==void 0&&(t.scale=!0,this.dotType!=="sphere"||al&&!this.disableImpostor||(n=!0)),super.setParameters(e,t,n),this}}An.add("shader/Image.vert",`uniform float clipRadius;
uniform vec3 clipCenter;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void main() {
#include begin_vertex
#include project_vertex
vUv = uv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
}`),An.add("shader/Image.frag",`uniform sampler2D map;
uniform float opacity;
uniform vec2 mapSize;
uniform float clipNear;
uniform float clipRadius;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform sampler2D pickingMap;
uniform float objectId;
#else
#include fog_pars_fragment
#endif
#if defined( CUBIC_INTERPOLATION )
#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )
#if defined( CATMULROM_FILTER )
const float B = 0.0;
const float C = 0.5;
#elif defined( MITCHELL_FILTER )
const float B = 0.333;
const float C = 0.333;
#endif
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f < 1.0 ){
return ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +
( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +
( 6.0 - 2.0 * B ) ) / 6.0;
}else if( f >= 1.0 && f < 2.0 ){
return ( ( -B - 6.0 * C ) * ( f * f * f )
+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +
( - ( 12.0 * B ) - 48.0 * C ) * f +
8.0 * B + 24.0 * C ) / 6.0;
}else{
return 0.0;
}
}
#elif defined( BSPLINE_FILTER )
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f >= 0.0 && f <= 1.0 ){
return ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );
}else if( f > 1.0 && f <= 2.0 ){
return 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );
}
return 1.0;
}
#else
float applyFilter( float x ){
return 1.0;
}
#endif
vec4 biCubic( sampler2D tex, vec2 texCoord ){
vec2 texelSize = 1.0 / mapSize;
texCoord -= texelSize / 2.0;
vec4 nSum = vec4( 0.0 );
float nDenom = 0.0;
vec2 cell = fract( texCoord * mapSize );
for( float m = -1.0; m <= 2.0; ++m ){
for( float n = -1.0; n <= 2.0; ++n ){
vec4 vecData = texture2D(
tex, texCoord + texelSize * vec2( m, n )
);
float c = applyFilter( m - cell.x ) * applyFilter( -n + cell.y );
nSum += vecData * c;
nDenom += c;
}
}
return nSum / nDenom;
}
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( CUBIC_INTERPOLATION )
gl_FragColor = biCubic( map, vUv );
#else
gl_FragColor = texture2D( map, vUv );
#endif
#if defined( PICKING )
if( gl_FragColor.a < 0.3 )
discard;
gl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );
#else
if( gl_FragColor.a < 0.01 )
discard;
gl_FragColor.a *= opacity;
#include fog_fragment
#endif
}`);const tue=new Uint16Array([0,1,2,1,3,2]),nue=new Float32Array([0,1,0,0,1,1,1,0]),iue=Object.assign({filter:"nearest",forceTransparent:!0},Ls),rue=Object.assign({filter:{updateShader:!0,uniform:!0}},wd);class sue extends pl{constructor(e,t){super({position:e.position,index:tue,picking:e.picking},t),this.parameterTypes=rue,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";const{imageData:n,width:r,height:s}=e,o=new ZT(n,r,s);o.flipY=!0,this.tex=o;const a=n.length,l=new Uint8Array(a);for(let u=0;u<a;u+=4){const h=u/4;l[u]=h>>16&255,l[u+1]=h>>8&255,l[u+2]=255&h}const c=new ZT(l,r,s);c.flipY=!0,c.minFilter=Zn,c.magFilter=Zn,this.pickingTex=c,this.addUniforms({map:{value:o},pickingMap:{value:c},mapSize:{value:new sn(r,s)}}),this.geometry.setAttribute("uv",new Hi(nue,2))}get defaultParameters(){return iue}getDefines(e){const t=super.getDefines(e),n=this.parameters.filter;return n.startsWith("cubic")&&(t.CUBIC_INTERPOLATION=1,n.endsWith("bspline")?t.BSPLINE_FILTER=1:n.endsWith("catmulrom")?t.CATMULROM_FILTER=1:n.endsWith("mitchell")&&(t.MITCHELL_FILTER=1)),t}updateTexture(){const e=this.tex,t=this.parameters.filter;t.startsWith("cubic")?(e.minFilter=Zn,e.magFilter=Zn):t==="linear"?(e.minFilter=es,e.magFilter=es):(e.minFilter=Zn,e.magFilter=Zn),e.needsUpdate=!0,this.pickingTex.needsUpdate=!0}makeMaterial(){super.makeMaterial(),this.updateTexture();const e=this.material;e.uniforms.map.value=this.tex,e.blending=nc,e.needsUpdate=!0;const t=this.wireframeMaterial;t.uniforms.map.value=this.tex,t.blending=nc,t.needsUpdate=!0;const n=this.pickingMaterial;n.uniforms.map.value=this.tex,n.uniforms.pickingMap.value=this.pickingTex,n.blending=nc,n.needsUpdate=!0}setUniforms(e){e&&e.filter!==void 0&&(this.updateTexture(),e.map=this.tex),super.setUniforms(e)}}class oue{constructor(e,t){const n=t||{};this.dimension=he(n.dimension,"x"),this.positionType=he(n.positionType,"percent"),this.position=he(n.position,30),this.thresholdType=he(n.thresholdType,"sigma"),this.thresholdMin=he(n.thresholdMin,-1/0),this.thresholdMax=he(n.thresholdMax,1/0),this.normalize=he(n.normalize,!1),this.volume=e}getPositionFromCoordinate(e){const t=this.dimension,n=this.volume,r=n.matrix,s=new me().setFromMatrixPosition(r)[t],o=new me().setFromMatrixScale(r)[t];let a;return a=t==="x"?n.nx:t==="y"?n.ny:n.nz,Math.round(((e-s)/(a/100)+1)/o)}getData(e){e=e||{};const t=this.volume,n=t.data,r=t.matrix;let s;function o(B){return Math.round(B/100*(s-1))}function a(B,D,O,j){return 3*(O*t.ny*t.nx+D*t.nx+B)+j}s=this.positionType==="coordinate"?this.getPositionFromCoordinate(this.position):this.position;const l=new Float32Array(12),c=new me;let u,h,d,f,m,_=0,v=0,g=0,b=t.nx,p=t.ny,y=t.nz;function A(B,D,O,j){c.set(B,D,O).applyMatrix4(r).toArray(l,j)}this.dimension==="x"?(d=o(t.nx),f=t.ny-1,m=t.nz-1,u=t.nz,h=t.ny,_=d,b=_+1,A(d,0,0,0),A(d,f,0,3),A(d,0,m,6),A(d,f,m,9)):this.dimension==="y"?(d=t.nx-1,f=o(t.ny),m=t.nz-1,u=t.nz,h=t.nx,v=f,p=v+1,A(0,f,0,0),A(d,f,0,3),A(0,f,m,6),A(d,f,m,9)):this.dimension==="z"&&(d=t.nx-1,f=t.ny-1,m=o(t.nz),u=t.nx,h=t.ny,g=m,y=g+1,A(0,0,m,0),A(0,f,m,3),A(d,0,m,6),A(d,f,m,9));let w=0,M=0;const T=new Uint8Array(u*h*4),E=new Float32Array(u*h);let C,N;this.thresholdType==="sigma"?(C=t.getValueForSigma(this.thresholdMin),N=t.getValueForSigma(this.thresholdMax)):(C=this.thresholdMin,N=this.thresholdMax);const P=Object.assign({},e.colorParams,{volume:t});this.normalize&&(P.domain=[0,1]);const L=gn.getScheme(P),R=new Float32Array(3),F=L.getScale();let V,z=0,U=0;if(this.normalize){z=1/0,V=-1/0;for(let B=v;B<p;++B)for(let D=_;D<b;++D)for(let O=g;O<y;++O){const j=n[a(D,B,O,0)/3];j<z&&(z=j),j>V&&(V=j)}U=V-z}for(let B=v;B<p;++B)for(let D=_;D<b;++D)for(let O=g;O<y;++O){const j=a(D,B,O,0)/3;let q=n[j];this.normalize&&(q=(q-z)/U),L.colorToArray(F(q),R),T[w]=Math.round(255*R[0]),T[w+1]=Math.round(255*R[1]),T[w+2]=Math.round(255*R[2]),T[w+3]=q>C&&q<N?255:0,E[M]=j,++M,w+=4}const G=new Jle(E,t);return{position:l,imageData:T,width:u,height:h,picking:G}}}class aue extends C1{constructor(e,t,n){super(e,t,n),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=e,this.init(n)}init(e){const t=this.volume,n=e||{};n.colorDomain=he(n.colorDomain,[t.min,t.max]),n.colorScheme=he(n.colorScheme,"value"),n.colorScale=he(n.colorScale,"Spectral"),this.colorScheme="value",this.dimension=he(n.dimension,"x"),this.filter=he(n.filter,"cubic-bspline"),this.positionType=he(n.positionType,"percent"),this.position=he(n.position,30),this.thresholdType=he(n.thresholdType,"sigma"),this.thresholdMin=he(n.thresholdMin,-1/0),this.thresholdMax=he(n.thresholdMax,1/0),this.normalize=he(n.normalize,!1),super.init(n),this.build()}attach(e){this.bufferList.forEach(t=>{this.viewer.add(t)}),this.setVisibility(this.visible),e()}create(){const e=new oue(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),t=new sue(e.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(t)}}function tA(i){tt.error(`makeRepresentation: representation type ${i} unknown`)}const QR={name:"some element",status:""};class mV{constructor(e,t={}){this.stage=e,this.signals={statusChanged:new tn.Signal,nameChanged:new tn.Signal,disposed:new tn.Signal},this.parameters=wo(t,this.defaultParameters),this.uuid=kR()}get defaultParameters(){return QR}get name(){return this.parameters.name}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}dispose(){this.signals.disposed.dispatch()}}const lue=Object.assign({visible:!0},QR);class cue extends mV{constructor(e,t,n={},r){super(e,Object.assign({name:t.type},n)),this.parent=r,this.signals=Object.assign({visibilityChanged:new tn.Signal,parametersChanged:new tn.Signal},this.signals),this.setRepresentation(t)}get defaultParameters(){return lue}get visible(){return this.parameters.visible}get type(){return"representation"}getType(){return this.repr.type}setRepresentation(e){this._disposeRepresentation(),this.repr=e,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()}_disposeRepresentation(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())}dispose(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())}setVisibility(e){return this.parameters.visible=e,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this}getVisibility(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible}toggleVisibility(){return this.setVisibility(!this.parameters.visible)}updateVisibility(){this.repr.setVisibility(this.getVisibility())}update(e){return this.repr.update(e),this}build(e){return this.repr.build(e),this}setSelection(e){const t=this.repr;return t.setSelection&&t.setSelection(e),this}setParameters(e){return this.repr.setParameters(e),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this}getParameters(){return this.repr.getParameters()}setColor(e){return this.repr.setColor(e),this}}const If=new Tt,uue=new me,gV={name:"",status:"",visible:!0};class US{constructor(e,t,n={}){this.stage=e,this.object=t,this.signals={representationAdded:new tn.Signal,representationRemoved:new tn.Signal,visibilityChanged:new tn.Signal,matrixChanged:new tn.Signal,statusChanged:new tn.Signal,nameChanged:new tn.Signal,disposed:new tn.Signal},this.reprList=[],this.annotationList=[],this.matrix=new Tt,this.position=new me,this.quaternion=new Cs,this.scale=new me(1,1,1),this.transform=new Tt,this.parameters=wo(n,this.defaultParameters),this.uuid=kR(),this.viewer=e.viewer,this.controls=new hce(this)}get defaultParameters(){return gV}get name(){return this.parameters.name}get status(){return this.parameters.status}get visible(){return this.parameters.visible}setPosition(e){return Array.isArray(e)?this.position.fromArray(e):this.position.copy(e),this.updateMatrix(),this}setRotation(e){if(Array.isArray(e))if(e.length===3){const t=new Gp().fromArray(e);this.quaternion.setFromEuler(t)}else this.quaternion.fromArray(e);else e instanceof Gp?this.quaternion.setFromEuler(e):this.quaternion.copy(e);return this.updateMatrix(),this}setScale(e){return this.scale.set(e,e,e),this.updateMatrix(),this}setTransform(e){return this.transform.copy(e),this.updateMatrix(),this}updateMatrix(){const e=this.getCenterUntransformed(uue);this.matrix.makeTranslation(-e.x,-e.y,-e.z),If.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(If),If.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(If);const t=this.position;If.makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z),this.matrix.premultiply(If),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)}updateRepresentationMatrices(){this.reprList.forEach(e=>{e.setParameters({matrix:this.matrix})})}addAnnotation(e,t,n){const r=new uce(this,e,t,n);return this.annotationList.push(r),r}eachAnnotation(e){this.annotationList.slice().forEach(e)}removeAnnotation(e){const t=this.annotationList.indexOf(e);t!==-1&&(this.annotationList.splice(t,1),e.dispose())}removeAllAnnotations(){this.eachAnnotation(e=>e.dispose()),this.annotationList.length=0}_addRepresentation(e,t,n,r=!1){const s=n||{},o=this.stage.getParameters();s.matrix=this.matrix.clone(),s.quality=s.quality||o.quality,s.disableImpostor=he(s.disableImpostor,!o.impostor),s.useWorker=he(s.useWorker,o.workerDefault),s.visible=he(s.visible,!0);const a=Object.assign({},s,{visible:this.parameters.visible&&s.visible}),l=function(u,h,d,f){var m;if(pt&&tt.time("makeRepresentation "+u),h instanceof Ja){if(!(m=ti.get(u)))return void tA(u)}else if(h instanceof DS)if(u==="surface")m=fC;else{if(u!=="dot")return void tA(u);m=T4}else if(h instanceof zs)if(u==="surface")m=fC;else if(u==="dot")m=T4;else{if(u!=="slice")return void tA(u);m=aue}else if(h instanceof Xce)m=M4,h=h.getBufferList();else{if(u!=="buffer")return void tt.error("makeRepresentation: object "+h+" unknown");m=M4}const _=new m(h,d,f);return pt&&tt.timeEnd("makeRepresentation "+u),_}(e,t,this.viewer,a),c=new cue(this.stage,l,s,this);return r||(this.reprList.push(c),this.signals.representationAdded.dispatch(c)),c}addBufferRepresentation(e,t){return this._addRepresentation.call(this,"buffer",e,t)}hasRepresentation(e){return this.reprList.indexOf(e)!==-1}eachRepresentation(e){this.reprList.slice().forEach(e)}removeRepresentation(e){const t=this.reprList.indexOf(e);t!==-1&&(this.reprList.splice(t,1),e.dispose(),this.signals.representationRemoved.dispatch(e))}updateRepresentations(e){this.reprList.forEach(t=>t.update(e)),this.stage.viewer.requestRender()}removeAllRepresentations(){this.eachRepresentation(e=>e.dispose())}dispose(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()}setVisibility(e){return this.parameters.visible=e,this.eachRepresentation(t=>t.updateVisibility()),this.eachAnnotation(t=>t.updateVisibility()),this.signals.visibilityChanged.dispatch(e),this}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}getBox(...e){return this.getBoxUntransformed(...e).clone().applyMatrix4(this.matrix)}getCenter(...e){return this.getCenterUntransformed(...e).clone().applyMatrix4(this.matrix)}getZoom(...e){return this.stage.getZoomForBox(this.getBox(...e))}getBoxUntransformed(...e){return new Ti}getCenterUntransformed(...e){return this.getBoxUntransformed().getCenter(new me)}autoView(e){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),he(e,0))}}class vV{constructor(e=[]){this.list=e;const t=e.length;for(let n=0;n<t;++n)e[n].signals.disposed.add(this._remove,this)}_remove(e){const t=this.list.indexOf(e);t!==-1&&this.list.splice(t,1)}get first(){return this.list.length>0?this.list[0]:void 0}forEach(e){return this.list.forEach(e),this}dispose(){return this.forEach(e=>e.dispose())}}class _V extends vV{setParameters(e){return this.forEach(t=>t.setParameters(e))}setVisibility(e){return this.forEach(t=>t.setVisibility(e))}setSelection(e){return this.forEach(t=>t.setSelection(e))}setColor(e){return this.forEach(t=>t.setColor(e))}update(e){return this.forEach(t=>t.update(e))}build(e){return this.forEach(t=>t.build(e))}dispose(e){return this.forEach(t=>t.dispose())}}const hue=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},QR);class due extends mV{constructor(e,t,n={}){super(e,Object.assign({name:t.name},n)),this.trajectory=t,this.signals=Object.assign(this.signals,{frameChanged:new tn.Signal,playerChanged:new tn.Signal,countChanged:new tn.Signal,parametersChanged:new tn.Signal}),t.signals.frameChanged.add(r=>{this.signals.frameChanged.dispatch(r)}),t.signals.playerChanged.add(r=>{this.signals.playerChanged.dispatch(r)}),t.signals.countChanged.add(r=>{this.signals.countChanged.dispatch(r)}),n.initialFrame!==void 0&&this.setFrame(n.initialFrame)}get defaultParameters(){return hue}get type(){return"trajectory"}setFrame(e){this.trajectory.setFrame(e)}setParameters(e={}){this.trajectory.setParameters(e),this.signals.parametersChanged.dispatch(e)}dispose(){this.trajectory.dispose(),super.dispose()}}class yV{constructor(e,t){this.name=e,this.path=t,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1}get type(){return"Frames"}}class xV{constructor(e,t){let n,r;if(this.A=new Fn(3,3),this.W=new Fn(1,3),this.U=new Fn(3,3),this.V=new Fn(3,3),this.VH=new Fn(3,3),this.R=new Fn(3,3),this.tmp=new Fn(3,3),this.c=new Fn(3,3),e instanceof Ja)n=e.atomCount;else{if(!(e instanceof Float32Array))return;n=e.length/3}if(t instanceof Ja)r=t.atomCount;else{if(!(t instanceof Float32Array))return;r=t.length/3}const s=Math.min(n,r),o=new Fn(3,s),a=new Fn(3,s);this.coords1t=new Fn(s,3),this.coords2t=new Fn(s,3),this.transformationMatrix=new Tt,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(e,o,s,!1),this.prepCoords(t,a,s,!1),this._superpose(o,a)}_superpose(e,t){this.mean1=lC(e),this.mean2=lC(t),cC(e,this.mean1),cC(t,this.mean2),Aa(this.coords1t,e),Aa(this.coords2t,t),vx(this.A,this.coords2t,this.coords1t),tV(this.A,this.W,this.U,this.V),function(d,f){const m=d.data,_=f.data,v=m[4],g=m[8],b=m[5],p=m[7],y=m[0],A=y*v,w=y*b,M=m[3],T=m[1],E=M*T,C=m[2],N=M*C,P=m[6],L=P*T,R=P*C,F=1/(A*g-w*p-E*g+N*p+L*b-R*v);_[0]=(v*g-b*p)*F,_[1]=-(T*g-C*p)*F,_[2]=-(-T*b+C*v)*F,_[3]=-(M*g-b*P)*F,_[4]=(y*g-R)*F,_[5]=-(w-N)*F,_[6]=-(-M*p+v*P)*F,_[7]=-(y*p-L)*F,_[8]=(A-E)*F}(this.V,this.VH),qM(this.R,this.U,this.VH),function(d){const f=d.data;return f[0]*f[4]*f[8]-f[0]*f[5]*f[7]-f[3]*f[1]*f[8]+f[3]*f[2]*f[7]+f[6]*f[1]*f[5]-f[6]*f[2]*f[4]}(this.R)<0&&(pt&&tt.log("R not a right handed system"),qM(this.tmp,this.c,this.VH),qM(this.R,this.U,this.tmp));const n=new Fn(4,4),r=new Fn(4,4),s=new Fn(4,4),o=new Fn(4,4),a=new Fn(4,4),l=new Fn(4,4),c=this.R.data,u=this.mean1,h=this.mean2;o.data.set([1,0,0,-u[0],0,1,0,-u[1],0,0,1,-u[2],0,0,0,1]),a.data.set([c[0],c[1],c[2],0,c[3],c[4],c[5],0,c[6],c[7],c[8],0,0,0,0,1]),l.data.set([1,0,0,h[0],0,1,0,h[1],0,0,1,h[2],0,0,0,1]),Aa(r,o),vx(n,a,r),Aa(s,n),vx(r,l,s),Aa(n,r),this.transformationMatrix.elements=n.data}prepCoords(e,t,n,r){let s=0;const o=t.data;let a=3,l=3*n;if(r&&(l=4*n,a=4),e instanceof Ja)e.eachAtom(function(c){s<l&&(o[s+0]=c.x,o[s+1]=c.y,o[s+2]=c.z,r&&(o[s+3]=1),s+=a)});else if(e instanceof Float32Array)for(;s<l;s+=a)s<l&&(o[s]=e[s],o[s+1]=e[s+1],o[s+2]=e[s+2],r&&(o[s+3]=1));else tt.warn("prepCoords: input type unknown")}transform(e){let t;if(e instanceof Ja)t=e.atomCount;else{if(!(e instanceof Float32Array))return;t=e.length/3}const n=new Fn(4,t),r=new Fn(t,4);this.prepCoords(e,n,t,!0);const s=this.transformationMatrix,o=s.determinant();if(!o)return o;const a=new Fn(4,4);a.data=s.elements,function(u,h,d){let f=0,m=0,_=0,v=0,g=0,b=0,p=0,y=0;const A=h.cols,w=h.rows,M=d.cols,T=h.data,E=d.data,C=u.data;let N=0;for(;f<w;v+=A,f++)for(p=0,m=0;m<M;y++,p++,m++){for(b=p,g=v,N=0,_=0;_<A;g++,b+=M,_++)N+=T[g]*E[b];C[y]=N}}(r,n,a);let l=0;const c=r.data;if(e instanceof Ja){e.eachAtom(function(d){d.x=c[l],d.y=c[l+1],d.z=c[l+2],l+=4});const u=new Tt;u.copy(s).invert();const h=e.biomolDict;for(let d in h)h.hasOwnProperty(d)&&h[d].partList.forEach(function(f){f.matrixList.forEach(function(m){m.premultiply(s),m.multiply(u)})})}else if(e instanceof Float32Array){const u=4*t;for(;l<u;l+=4)e[l]=c[l],e[l+1]=c[l+1],e[l+2]=c[l+2]}else tt.warn("transform: input type unknown");return this.transformationMatrix}}const fue={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"};class pue{constructor(e,t={}){this.signals={startedRunning:new tn.Signal,haltedRunning:new tn.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,e.signals.playerChanged.add(r=>{r!==this&&this.pause()},this);const n=he(e.frameCount,1);this.traj=e,this.parameters=wo(t,fue),this.parameters.end=Math.min(he(t.end,n-1),n-1),this.parameters.step=he(t.step,Math.ceil((n+1)/100)),this._currentFrame=this.parameters.start,this._direction=this.parameters.direction==="bounce"?"forward":this.parameters.direction,e.signals.countChanged.add(r=>{this.parameters.end=Math.min(he(this.parameters.end,r-1),r-1)},this),this._animate=this._animate.bind(this)}get isRunning(){return this._run}setParameters(e={}){wG(this.parameters,e),e.direction!==void 0&&this.parameters.direction!=="bounce"&&(this._direction=this.parameters.direction)}_animate(){if(!this._run)return;this._currentTime=window.performance.now();const e=this._currentTime-this._previousTime,t=this.parameters.interpolateType?this.parameters.interpolateStep:1,n=this.parameters.timeout/t,r=this.traj;if(r&&r.frameCount&&!r.inProgress&&e>=n)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),this._currentStep===1&&(this._currentFrame=this._nextInterpolated()),r.hasFrame(this._currentFrame)){this._currentStep+=1;const s=this._currentStep/(this.parameters.interpolateStep+1),[o,a,l,c]=this._currentFrame;r.setFrameInterpolated(o,a,l,c,s,this.parameters.interpolateType),this._previousTime=this._currentTime}else r.loadFrame(this._currentFrame);else{const s=this._next();r.hasFrame(s)?(r.setFrame(s),this._previousTime=this._currentTime):r.loadFrame(s)}window.requestAnimationFrame(this._animate)}_next(){const e=this.parameters;let t;return t=this._direction==="forward"?this.traj.currentFrame+e.step:this.traj.currentFrame-e.step,(t>e.end||t<e.start)&&(e.direction==="bounce"&&(this._direction==="forward"?this._direction="backward":this._direction="forward"),e.mode==="once"?(this.pause(),t=e.direction==="forward"?e.end:e.direction==="backward"||this._direction==="forward"?e.start:e.end):this._direction==="forward"?(t=e.start,e.interpolateType&&(t=Math.min(e.end,t+e.step))):(t=e.end,e.interpolateType&&(t=Math.max(e.start,t-e.step)))),t}_nextInterpolated(){const e=this.parameters,t=this._next();let n,r,s;return this._direction==="forward"?(n=Math.max(e.start,t-e.step),r=Math.max(e.start,t-2*e.step),s=Math.max(e.start,t-3*e.step)):(n=Math.min(e.end,t+e.step),r=Math.min(e.end,t+2*e.step),s=Math.min(e.end,t+3*e.step)),[t,n,r,s]}toggle(){this._run?this.pause():this.play()}play(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;const e=this.parameters,t=this.traj.currentFrame;let n=Math.ceil(t/e.step)*e.step;e.direction==="forward"&&t>=e.end?n=e.start:e.direction==="backward"&&t<=e.start&&(n=e.end),this.traj.setFrame(n),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}}pause(){this._run=!1,this.signals.haltedRunning.dispatch()}stop(){this.pause(),this.traj.setFrame(this.parameters.start)}}class OS{constructor(e,t,n={}){this.signals={countChanged:new tn.Signal,frameChanged:new tn.Signal,playerChanged:new tn.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=he(n.deltaTime,0),this.timeOffset=he(n.timeOffset,0),this.centerPbc=he(n.centerPbc,!1),this.removePbc=he(n.removePbc,!1),this.removePeriodicity=he(n.removePeriodicity,!1),this.superpose=he(n.superpose,!1),this.name=e.replace(/^.*[\\/]/,""),this.trajPath=e,this.selection=new ei(he(n.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add(()=>{this.selectionIndices=this.structure.getAtomIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)})}get frameCount(){return this._frameCount}get currentFrame(){return this._currentFrame}_init(e){this.setStructure(e),this._loadFrameCount(),this.setPlayer(new pue(this))}_loadFrameCount(){}setStructure(e){this.structure=e,this.atomCount=e.atomCount,this.backboneIndices=this._getIndices(new ei("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}_saveInitialCoords(){this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,()=>this._saveInitialCoords())}_saveStructureCoords(){this.structureCoords=this.structure.getAtomData({what:{position:!0}}).position}setSelection(e){return this.selection.setString(e),this}_getIndices(e){let t=0;const n=e.test,r=[];return n&&this.structure.eachAtom(s=>{n(s)&&r.push(t),t+=1}),r}_makeSuperposeCoords(){const e=3*this.selectionIndices.length;this.coords1=new Float32Array(e),this.coords2=new Float32Array(e);const t=this.initialCoords,n=this.coords2;for(let r=0;r<e;r+=3){const s=3*this.selectionIndices[r/3];n[r+0]=t[s+0],n[r+1]=t[s+1],n[r+2]=t[s+2]}}_makeAtomIndices(){tt.error("Trajectory._makeAtomIndices not implemented")}_resetCache(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)}setParameters(e={}){let t=!1;e.centerPbc!==void 0&&e.centerPbc!==this.centerPbc&&(this.centerPbc=e.centerPbc,t=!0),e.removePeriodicity!==void 0&&e.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=e.removePeriodicity,t=!0),e.removePbc!==void 0&&e.removePbc!==this.removePbc&&(this.removePbc=e.removePbc,t=!0),e.superpose!==void 0&&e.superpose!==this.superpose&&(this.superpose=e.superpose,t=!0),this.deltaTime=he(e.deltaTime,this.deltaTime),this.timeOffset=he(e.timeOffset,this.timeOffset),t&&(this._resetCache(),this.setFrame(this._currentFrame))}hasFrame(e){return Array.isArray(e)?e.every(t=>!!this.frameCache[t]):!!this.frameCache[e]}setFrame(e,t){return e===void 0||(this.inProgress=!0,e===-1||this.frameCache[e]?(this._updateStructure(e),t&&t()):this.loadFrame(e,()=>{this._updateStructure(e),t&&t()})),this}_interpolate(e,t,n,r,s,o){const a=this.frameCache;let l;l=o==="spline"?function(c,u,h,d,f){const m=c.length,_=new Float32Array(m);for(let v=0;v<m;v+=3){const g=v+1,b=v+2;_[v]=Wl(d[v],h[v],u[v],c[v],f,1),_[g]=Wl(d[g],h[g],u[g],c[g],f,1),_[b]=Wl(d[b],h[b],u[b],c[b],f,1)}return _}(a[e],a[t],a[n],a[r],s):function(c,u,h){const d=c.length,f=new Float32Array(d);for(let m=0;m<d;m+=3){const _=m+1,v=m+2;f[m]=Vo(u[m],c[m],h),f[_]=Vo(u[_],c[_],h),f[v]=Vo(u[v],c[v],h)}return f}(a[e],a[t],s),this.structure.updatePosition(l),this._currentFrame=e,this.signals.frameChanged.dispatch(e)}setFrameInterpolated(e,t,n,r,s,o,a){if(e===void 0)return this;const l=this.frameCache,c=[];return l[r]||c.push(r),l[n]||c.push(n),l[t]||c.push(t),l[e]||c.push(e),c.length?this.loadFrame(c,()=>{this._interpolate(e,t,n,r,s,o),a&&a()}):(this._interpolate(e,t,n,r,s,o),a&&a()),this}loadFrame(e,t){Array.isArray(e)?e.forEach(n=>{this.loadQueue[n]||this.frameCache[n]||(this.loadQueue[n]=!0,this._loadFrame(n,()=>{delete this.loadQueue[n]}))}):this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,()=>{delete this.loadQueue[e],t&&t()}))}_loadFrame(e,t){tt.error("Trajectory._loadFrame not implemented",e,t)}_updateStructure(e){this._disposed?console.error("updateStructure: traj disposed"):(e===-1?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[e]),this.structure.trajectory={name:this.trajPath,frame:e},this._currentFrame=e,this.inProgress=!1,this.signals.frameChanged.dispatch(e))}_doSuperpose(e){const t=3*this.selectionIndices.length,n=this.coords1,r=this.coords2;for(let s=0;s<t;s+=3){const o=3*this.selectionIndices[s/3];n[s+0]=e[o+0],n[s+1]=e[o+1],n[s+2]=e[o+2]}new xV(n,r).transform(e)}_process(e,t,n,r){if(this._setFrameCount(r),t){if(this.backboneIndices.length>0&&this.centerPbc){const s=[t[0],t[4],t[8]],o=function(a,l,c){return[zM(l,c[0],3,0,a),zM(l,c[1],3,1,a),zM(l,c[2],3,2,a)]}(this.backboneIndices,n,s);(function(a,l,c){if(c[0]===0||c[8]===0||c[4]===0)return;const u=a.length,h=c[0],d=c[1],f=c[2],m=-l[0]+h+h/2,_=-l[1]+d+d/2,v=-l[2]+f+f/2;for(let g=0;g<u;g+=3)a[g+0]=(a[g+0]+m)%h,a[g+1]=(a[g+1]+_)%d,a[g+2]=(a[g+2]+v)%f})(n,o,s)}if(this.removePeriodicity){const s=function(o){return[mx(o,3,0),mx(o,3,1),mx(o,3,2)]}(n);(function(o,a,l){if(a[0]===0||a[8]===0||a[4]===0)return;const c=o.length;for(let u=3;u<c;u+=3)for(let h=0;h<3;++h){const d=(o[u+h]-l[h])/a[3*h+h];Math.abs(d)>.5&&(o[u+h]-=a[3*h+h]*Math.round(d))}})(n,t,s)}this.removePbc&&function(s,o){if(o[0]===0||o[8]===0||o[4]===0)return;const a=s.length;for(let l=3;l<a;l+=3)for(let c=0;c<3;++c){const u=s[l+c]-s[l-3+c];if(Math.abs(u)>.9*o[3*c+c])if(u>0)for(let h=0;h<3;++h)s[l+h]-=o[3*c+h];else for(let h=0;h<3;++h)s[l+h]+=o[3*c+h]}}(n,t)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(n),this.frameCache[e]=n,this.boxCache[e]=t,this.frameCacheSize+=1}_setFrameCount(e){e!==this._frameCount&&(this._frameCount=e,this.signals.countChanged.dispatch(e))}dispose(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()}setPlayer(e){this.player=e,this.signals.playerChanged.dispatch(e)}getFrameTime(e){return this.timeOffset+e*this.deltaTime}}class mue extends OS{constructor(e,t,n){const r=n||{};r.timeOffset=he(r.timeOffset,e.timeOffset),r.deltaTime=he(r.deltaTime,e.deltaTime),super("",t,r),this.name=e.name,this.path=e.path,this.frames=e.coordinates,this.boxes=e.boxes,this._init(t)}get type(){return"frames"}_makeAtomIndices(){this.structure.type==="StructureView"?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const r=this.frames[e];if(this.atomIndices){const a=this.atomIndices,l=a.length;n=new Float32Array(3*l);for(let c=0;c<l;++c){const u=3*c,h=3*a[c];n[u+0]=r[h+0],n[u+1]=r[h+1],n[u+2]=r[h+2]}}else n=new Float32Array(r);const s=this.boxes[e],o=this.frames.length;this._process(e,s,n,o),typeof t=="function"&&t()}_loadFrameCount(){this.frames&&this._setFrameCount(this.frames.length)}}class gue extends OS{constructor(e,t,n){super("",t,n),this._init(t)}get type(){return"structure"}_makeAtomIndices(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const r=this.structure,s=r.frames[e];if(this.atomIndices){const l=this.atomIndices,c=l.length;n=new Float32Array(3*c);for(let u=0;u<c;++u){const h=3*u,d=3*l[u];n[h+0]=s[d+0],n[h+1]=s[d+1],n[h+2]=s[d+2]}}else n=new Float32Array(s);const o=r.boxes[e],a=r.frames.length;this._process(e,o,n,a),typeof t=="function"&&t()}_loadFrameCount(){this._setFrameCount(this.structure.frames.length)}}class vue extends OS{constructor(e,t,n){super(e,t,n),this._init(t)}get type(){return"remote"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),n=t.length;let r=t[0],s=t[0];for(let o=1;o<n;++o){const a=t[o];s+1<a&&(e.push([r,s+1]),r=a),s=a}e.push([r,s+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){const n=new XMLHttpRequest,r=kM.getFrameUrl(this.trajPath,e),s=kM.getFrameParams(this.trajPath,this.atomIndices);n.open("POST",r,!0),n.responseType="arraybuffer",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.addEventListener("load",()=>{const o=n.response;if(!o)return void tt.error(`empty arrayBuffer for '${r}'`);const a=new Int32Array(o,0,1)[0],l=new Float32Array(o,8,9),c=new Float32Array(o,44);this._process(e,l,c,a),typeof t=="function"&&t()},!1),n.send(s)}_loadFrameCount(){const e=new XMLHttpRequest,t=kM.getCountUrl(this.trajPath);e.open("GET",t,!0),e.addEventListener("load",()=>{this._setFrameCount(parseInt(e.response))},!1),e.send()}}class _ue extends OS{constructor(e,t,n){super("",t,n),this.requestCallback=e,this._init(t)}get type(){return"callback"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),n=t.length;let r=t[0],s=t[0];for(let o=1;o<n;++o){const a=t[o];s+1<a&&(e.push([r,s+1]),r=a),s=a}e.push([r,s+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){this.requestCallback((n,r,s,o)=>{this._process(n,r,s,o),typeof t=="function"&&t()},e,this.atomIndices)}_loadFrameCount(){this.requestCallback(e=>this._setFrameCount(e))}}Ja.prototype.getView=function(i){return new bV(this,i)};class bV extends Ja{constructor(e,t){super(),this.structure=e,this.selection=t,this.center=new me,this.boundingBox=new Ti,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}init(){}get type(){return"StructureView"}get name(){return this.structure.name}get path(){return this.structure.path}get title(){return this.structure.title}get id(){return this.structure.id}get data(){return this.structure.data}get atomSetDict(){return this.structure.atomSetDict}get biomolDict(){return this.structure.biomolDict}get entityList(){return this.structure.entityList}get unitcell(){return this.structure.unitcell}get frames(){return this.structure.frames}get boxes(){return this.structure.boxes}get validation(){return this.structure.validation}get bondStore(){return this.structure.bondStore}get backboneBondStore(){return this.structure.backboneBondStore}get rungBondStore(){return this.structure.rungBondStore}get atomStore(){return this.structure.atomStore}get residueStore(){return this.structure.residueStore}get chainStore(){return this.structure.chainStore}get modelStore(){return this.structure.modelStore}get atomMap(){return this.structure.atomMap}get residueMap(){return this.structure.residueMap}get bondHash(){return this.structure.bondHash}get spatialHash(){return this.structure.spatialHash}get _hasCoords(){return this.structure._hasCoords}set _hasCoords(e){this.structure._hasCoords=e}refresh(){pt&&tt.time("StructureView.refresh"),this.atomSetCache={};const e=this.structure;if(this.selection.isAllSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=e.atomSet.clone(),this.bondSet=e.bondSet.clone();for(let t in this.atomSetDict){const n=this.atomSetDict[t];this.atomSetCache["__"+t]=n.clone()}this.atomCount=e.atomCount,this.bondCount=e.bondCount,this.boundingBox.copy(e.boundingBox),this.center.copy(e.center)}else if(this.selection.isNoneSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=new or(e.atomCount),this.bondSet=new or(e.bondCount);for(let t in this.atomSetDict)this.atomSetCache["__"+t]=new or(e.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),e.atomSet&&(this.atomSet=this.atomSet.intersection(e.atomSet)),this.bondSet=this.getBondSet();for(let t in this.atomSetDict){const n=this.atomSetDict[t];this.atomSetCache["__"+t]=n.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new me)}pt&&tt.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()}setSelection(e){this.selection=e,this.refresh()}getSelection(e){const t=[];e&&e.string&&t.push(e.string);const n=this.structure.getSelection();n&&n.string&&t.push(n.string),this.selection&&this.selection.string&&t.push(this.selection.string);let r="";return t.length>0&&(r=`( ${t.join(" ) AND ( ")} )`),new ei(r)}getStructure(){return this.structure.getStructure()}eachBond(e,t){this.structure.eachBond(e,this.getSelection(t))}eachAtom(e,t){const n=this.getAtomProxy(),r=this.getAtomSet(t),s=this.atomStore.count;if(r.getSize()<s)r.forEach(function(o){n.index=o,e(n)});else for(let o=0;o<s;++o)n.index=o,e(n)}eachResidue(e,t){this.structure.eachResidue(e,this.getSelection(t))}eachResidueN(e,t){console.error("StructureView.eachResidueN() not implemented")}eachChain(e,t){this.structure.eachChain(e,this.getSelection(t))}eachModel(e,t){this.structure.eachModel(e,this.getSelection(t))}getAtomSet(e,t=!1){let n=this.structure.getAtomSet(e);return!t&&this.atomSet&&(n=n.makeIntersection(this.atomSet)),n}getAtomIndices(e){return this.structure.getAtomIndices(this.getSelection(e))}refreshPosition(){return this.structure.refreshPosition()}dispose(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new Ja,delete this.atomSet,delete this.bondSet}}const yue=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]];function C4(i,e){let t,n=0;const r={};return e.forEach(function(s){t=0;const o={};s.forEach(function(a){o[i[t++]]=a}),r[i[n++]]=o}),r}const xue={blosum62:C4("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:C4("ACDEFGHIKLMNPQRSTVWY",yue)};class bue{constructor(e,t,n=-10,r=-1,s="blosum62"){this.seq1=e,this.seq2=t,this.gapPenalty=n,this.gapExtensionPenalty=r,s&&(this.substMatrix=xue[s])}initMatrices(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(let e=0;e<=this.n;++e){this.S[e]=[],this.V[e]=[],this.H[e]=[];for(let t=0;t<=this.m;++t)this.S[e][t]=0,this.V[e][t]=0,this.H[e][t]=0}for(let e=0;e<=this.n;++e)this.S[e][0]=this.gap(0),this.H[e][0]=-1/0;for(let e=0;e<=this.m;++e)this.S[0][e]=this.gap(0),this.V[0][e]=-1/0;this.S[0][0]=0}gap(e){return this.gapPenalty+e*this.gapExtensionPenalty}makeScoreFn(){const e=this.seq1,t=this.seq2,n=this.substMatrix;return n?function(r,s){const o=e[r],a=t[s];try{return n[o][a]}catch{return-4}}:(tt.warn("Alignment: no subst matrix"),function(r,s){return e[r]===t[s]?5:-3})}calc(){pt&&tt.time("Alignment.calc"),this.initMatrices();const e=this.gap(0),t=this.makeScoreFn(),n=this.gapExtensionPenalty,r=this.V,s=this.H,o=this.S,a=this.n,l=this.m;let c,u,h,d,f;for(let m=1;m<=a;++m){u=o[m-1],c=r[m-1],h=r[m],d=s[m],f=o[m];for(let _=1;_<=l;++_)h[_]=Math.max(u[_]+e,c[_]+n),d[_]=Math.max(f[_-1]+e,d[_-1]+n),f[_]=Math.max(u[_-1]+t(m-1,_-1),h[_],d[_])}pt&&tt.timeEnd("Alignment.calc"),pt&&tt.log(this.S,this.V,this.H)}trace(){pt&&tt.time("Alignment.trace"),this.ali1="",this.ali2="";const e=this.makeScoreFn();let t,n=this.n,r=this.m;for(this.S[n][r]>=this.V[n][r]?(t="S",this.score=this.S[n][r]):this.V[n][r]>=this.H[n][r]?(t="V",this.score=this.V[n][r]):(t="H",this.score=this.H[n][r]),pt&&tt.log("Alignment: SCORE",this.score),pt&&tt.log("Alignment: S, V, H",this.S[n][r],this.V[n][r],this.H[n][r]);n>0&&r>0;)t==="S"?this.S[n][r]===this.S[n-1][r-1]+e(n-1,r-1)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--n,--r,t="S"):this.S[n][r]===this.V[n][r]?t="V":this.S[n][r]===this.H[n][r]?t="H":(--n,--r):t==="V"?this.V[n][r]===this.V[n-1][r]+this.gapExtensionPenalty?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="V"):this.V[n][r]===this.S[n-1][r]+this.gap(0)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="S"):--n:t==="H"?this.H[n][r]===this.H[n][r-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r,t="H"):this.H[n][r]===this.S[n][r-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r,t="S"):--r:tt.error("Alignment: no matrix");for(;n>0;)this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n;for(;r>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[r-1]+this.ali2,--r;pt&&tt.timeEnd("Alignment.trace"),pt&&tt.log([this.ali1,this.ali2])}}function Sue(i,e,t=!1,n="",r=""){let s,o,a,l,c;if(t){let h=i,d=e;n&&r&&(h=i.getView(new ei(n)),d=e.getView(new ei(r)));const f=h.getSequence(),m=d.getSequence(),_=new bue(f.join(""),m.join(""));let v,g;_.calc(),_.trace(),s=0,o=0,a=_.ali1.length;const b=[],p=[];for(let T=0;T<a;++T){const E=_.ali1[T],C=_.ali2[T];v=0,g=0,E==="-"?p[o]=!1:(p[o]=!0,v=1),C==="-"?b[s]=!1:(b[s]=!0,g=1),s+=v,o+=g}const y=[],A=[],w=h.getAtomProxy(),M=d.getAtomProxy();s=0,h.eachResidue(function(T){T.traceAtomIndex!==void 0&&T.traceAtomIndex===T.getAtomIndexByName("CA")&&(b[s]&&(w.index=T.getAtomIndexByName("CA"),y.push(w.x,w.y,w.z)),s+=1)}),s=0,d.eachResidue(function(T){T.traceAtomIndex!==void 0&&T.traceAtomIndex===T.getAtomIndexByName("CA")&&(p[s]&&(M.index=T.getAtomIndexByName("CA"),A.push(M.x,M.y,M.z)),s+=1)}),l=new Float32Array(y),c=new Float32Array(A)}else l=i.getView(new ei(`${n} and .CA`)),c=e.getView(new ei(`${r} and .CA`));const u=new xV(l,c).transform(i);return i.refreshPosition(),u}const wue=Object.assign({sele:"",defaultAssembly:""},gV);class pC extends US{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.structure=t,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new tn.Signal,trajectoryRemoved:new tn.Signal,defaultAssemblyChanged:new tn.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=function(r){let s=0,o=0;const a=[];return{has:function(l){return a.indexOf(l)!==-1},get:function(l){return a[l]},push:function(l){a[s]=l,s=(r+s+1)%r,++o},get count(){return o},get data(){return a.slice(0,Math.min(o,r))},clear:function(){o=0,s=0,a.length=0}}}(4),this.pickDict=function(){const r={};return{has:function(s){return r[JSON.stringify(s)]!==void 0},add:function(s,o){r[JSON.stringify(s)]=o},del:function(s){delete r[JSON.stringify(s)]},get values(){return Object.keys(r).map(s=>r[s])}}}(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:lg.opacity,color:lg.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",lg,!0),this.angleRepresentation=this.addRepresentation("angle",lg,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",lg,!0),this.measureRepresentations=new _V([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly),this.structure.signals.refreshed.add(()=>{this.updateRepresentations({position:!0})})}get defaultParameters(){return wue}get type(){return"structure"}initSelection(e){this.selection=new ei(e),this.structureView=new bV(this.structure,this.selection),this.selection.signals.stringChanged.add(()=>{this.structureView.setSelection(this.selection),this.rebuildRepresentations(),this.rebuildTrajectories()})}setSelection(e){return this.parameters.sele=e,this.selection.setString(e),this}setDefaultAssembly(e){if(this.structure.biomolDict[e]===void 0&&(e=""),this.parameters.defaultAssembly!==e){const t={defaultAssembly:e};this.reprList.forEach(n=>n.setParameters(t)),this.measureRepresentations.setParameters(t),this.parameters.defaultAssembly=e,this.signals.defaultAssemblyChanged.dispatch(e)}return this}rebuildRepresentations(){this.reprList.forEach(e=>{e.build()}),this.measureRepresentations.build()}rebuildTrajectories(){this.trajList.forEach(e=>{e.trajectory.setStructure(this.structureView)})}updateRepresentations(e){super.updateRepresentations(e),this.measureRepresentations.update(e)}updateRepresentationMatrices(){super.updateRepresentationMatrices(),this.measureRepresentations.setParameters({matrix:this.matrix})}addRepresentation(e,t={},n=!1){t.defaultAssembly=this.parameters.defaultAssembly;const r=this._addRepresentation(e,this.structureView,t,n);return n||r.signals.parametersChanged.add(()=>this.measureUpdate()),r}addTrajectory(e="",t={}){const n=function(s,o,a){let l;return l=s&&s instanceof yV?new mue(s,o,a):!s&&o.frames?new gue(s,o,a):s&&typeof s=="function"?new _ue(s,o,a):new vue(s,o,a),l}(e,this.structureView,t),r=new due(this.stage,n,t);return this.trajList.push(r),this.signals.trajectoryAdded.dispatch(r),r}removeTrajectory(e){const t=this.trajList.indexOf(e);t!==-1&&this.trajList.splice(t,1),e.dispose(),this.signals.trajectoryRemoved.dispatch(e)}dispose(){this.trajList.slice().forEach(e=>e.dispose()),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),super.dispose()}autoView(e,t){typeof e=="number"&&(t=e,e=""),this.stage.animationControls.zoomMove(this.getCenter(e),this.getZoom(e),he(t,0))}getBoxUntransformed(e){let t;return t=e?this.structureView.getBoundingBox(new ei(e)):this.structureView.boundingBox,t}getCenterUntransformed(e){return e&&typeof e=="string"?this.structure.atomCenter(new ei(e)):this.structure.center}superpose(e,t,n,r){return Sue(this.structureView,e.structureView,t,n,r),this.updateRepresentations({position:!0}),this}getMaxRepresentationRadius(e){let t=0;const n=this.structure.getAtomProxy(e);return this.eachRepresentation(r=>{if(r.getVisibility()){const s=r.repr;t=Math.max(s.getAtomRadius(n),t)}}),t}measurePick(e){const t=this.pickBuffer.count;if(this.lastPick===e.index&&t>=1){if(t>1){const n=this.pickBuffer.data,r=this.pickBuffer.data.sort();this.pickDict.has(r)?this.pickDict.del(r):this.pickDict.add(r,n),t===2?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter(s=>s.length===2)}):t===3?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter(s=>s.length===3)}):t===4&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter(s=>s.length===4)})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(e.index)||this.pickBuffer.push(e.index),this.lastPick=e.index;this.measureUpdate()}measureClear(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")}measureBuild(){const e=this.measureData();this.distanceRepresentation.setParameters({atomPair:e.distance}),this.angleRepresentation.setParameters({atomTriple:e.angle}),this.dihedralRepresentation.setParameters({atomQuad:e.dihedral})}measureUpdate(){const e=this.pickBuffer.data,t={};e.forEach(n=>{const r=Math.max(.1,this.getMaxRepresentationRadius(n));t[n]=r*(2.3-A1(.1,2,r))}),this.spacefillRepresentation.setSelection(e.length?"@"+e.join(","):"none"),e.length&&this.spacefillRepresentation.setParameters({radiusData:t})}measureData(){const e=this.pickDict.values;return{distance:e.filter(t=>t.length===2),angle:e.filter(t=>t.length===3),dihedral:e.filter(t=>t.length===4)}}removeAllMeasurements(e){const t=this.pickDict,n=t.values,r=function(s){n.filter(o=>o.length===s).forEach(o=>t.del(o.slice().sort()))};(!e||1&e)&&r(2),(!e||2&e)&&r(3),(!e||4&e)&&r(4),this.measureBuild()}removeMeasurement(e){this.pickDict.del(e.slice().sort()),this.measureBuild()}addMeasurement(e){if(e.length<2||e.length>4)return;const t=e.slice().sort();this.pickDict.has(t)||this.pickDict.add(t,e),this.measureBuild()}}Hp.add("structure",pC),Hp.add("structureview",pC);class SV extends US{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.surface=t}get type(){return"surface"}addRepresentation(e,t={}){return this._addRepresentation(e,this.surface,t)}getBoxUntransformed(){return this.surface.boundingBox}getCenterUntransformed(){return this.surface.center}dispose(){this.surface.dispose(),super.dispose()}}Hp.add("surface",SV);class wV extends US{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.volume=t}get type(){return"volume"}addRepresentation(e,t={}){return this._addRepresentation(e,this.volume,t)}getBoxUntransformed(){return this.volume.boundingBox}getCenterUntransformed(){return this.volume.center}dispose(){this.volume.dispose(),super.dispose()}}Hp.add("volume",wV);class P4 extends vV{addRepresentation(e,t){return this.forEach(n=>n.addRepresentation(e,t))}autoView(e){return this.forEach(t=>t.autoView(e))}}function R4(i,e){return i instanceof RegExp?e.name.match(i)!==null:e.name===i}const Mue=new me,Aue={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1.2,ambientColor:14540253,ambientIntensity:.3,hoverTimeout:0,tooltip:!0,mousePreset:"default"};class MV{constructor(e,t={}){this.signals={parametersChanged:new tn.Signal,fullscreenChanged:new tn.Signal,componentAdded:new tn.Signal,componentRemoved:new tn.Signal,clicked:new tn.Signal,hovered:new tn.Signal},this.tasks=new DG,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new Zae(e),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new Qae(this.viewer.renderer.domElement),this.viewerControls=new ile(this),this.trackballControls=new Jae(this),this.pickingControls=new tle(this),this.animationControls=new lle(this),this.mouseControls=new ice(this),this.keyControls=new sce(this),this.pickingBehavior=new oce(this),this.mouseBehavior=new ace(this),this.animationBehavior=new lce(this),this.keyBehavior=new cce(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=wo(t,Aue),this.setParameters(this.parameters),this.viewer.animate())}setParameters(e={}){wG(this.parameters,e);const t=e,n=this.parameters,r=this.viewer,s=this.trackballControls;return t.quality!==void 0&&this.setQuality(n.quality),t.impostor!==void 0&&this.setImpostor(n.impostor),t.rotateSpeed!==void 0&&(s.rotateSpeed=n.rotateSpeed),t.zoomSpeed!==void 0&&(s.zoomSpeed=n.zoomSpeed),t.panSpeed!==void 0&&(s.panSpeed=n.panSpeed),t.mousePreset!==void 0&&this.mouseControls.preset(n.mousePreset),this.mouseObserver.setParameters({hoverTimeout:n.hoverTimeout}),r.setClip(n.clipNear,n.clipFar,n.clipDist,n.clipMode,n.clipScale),r.setFog(void 0,n.fogNear,n.fogFar),r.setCamera(n.cameraType,n.cameraFov,n.cameraEyeSep),r.setSampling(n.sampleLevel),r.setBackground(n.backgroundColor),r.setLight(n.lightColor,n.lightIntensity,n.ambientColor,n.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this}log(e){console.log("STAGE LOG",e),this.logList.push(e)}getParameters(){return Object.assign({},this.parameters)}defaultFileRepresentation(e){if(e instanceof pC){let t,n,r;e.setSelection("/0");const s=e.structure;if(s.biomolDict.BU1){const h=s.biomolDict.BU1;t=h.getAtomCount(s),n=h.getResidueCount(s),r=h.getInstanceCount(),e.setDefaultAssembly("BU1")}else t=s.getModelProxy(0).atomCount,n=s.getModelProxy(0).residueCount,r=1;let o=t;RG&&(o*=4);const a=s.atomStore.count/s.residueStore.count<2;a&&(o*=10);let l="chainname",c="RdYlBu",u=!1;if(s.getChainnameCount(new ei("polymer and /0"))===1&&(l="residueindex",c="Spectral",u=!0),pt&&console.log(o,t,r,a),n/r<4)e.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(r>5&&o>15e3||o>7e5){let h=Math.min(2,Math.max(.1,6e3/(o/r)));a&&(h=Math.min(h,.5)),e.addRepresentation("surface",{colorScheme:l,colorScale:c,colorReverse:u,sele:"polymer",surfaceType:"av",probeRadius:1.4,scaleFactor:h,useWorker:!1})}else o>25e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,lineOnly:!0}):o>1e5?e.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,quality:"low",disableImpostor:!0,radiusScale:2}):o>8e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:c,colorReverse:u,radiusScale:2}):(e.addRepresentation("cartoon",{colorScheme:l,colorScale:c,colorReverse:u,radiusScale:.7,aspectRatio:5,quality:"auto"}),o<5e4&&e.addRepresentation("base",{colorScheme:l,colorScale:c,colorReverse:u,quality:"auto"}),e.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));e.structure.frames.length&&e.addTrajectory()}else(e instanceof SV||e instanceof wV)&&e.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)}loadFile(e,t={}){const n=Object.assign({},this.defaultFileParams,t),r=Ks(e).name;this.tasks.increment(),this.log(`loading file '${r}'`);const s=he(n.ext,Ks(e).ext);let o;return o=Zt.isTrajectory(s)?Promise.reject(new Error(`loadFile: ext '${s}' is a trajectory and must be loaded into a structure component`)):zk(e,n),o.then(a=>{this.log(`loaded '${r}'`);const l=this.addComponentFromObject(a,n);return n.defaultRepresentation&&this.defaultFileRepresentation(l),this.tasks.decrement(),l},a=>{this.tasks.decrement();const l=`error loading file: '${a}'`;throw this.log(l),l})}loadScript(e){const t=Ks(e).name;return this.log(`loading script '${t}'`),zk(e).then(n=>{this.tasks.increment(),this.log(`running script '${t}'`),n.run(this).then(()=>{this.tasks.decrement(),this.log(`finished script '${t}'`)}),this.log(`called script '${t}'`)},n=>{this.tasks.decrement();const r=`errored script '${t}' "${n}"`;throw this.log(r),r})}addComponent(e){e?(this.compList.push(e),this.signals.componentAdded.dispatch(e)):tt.warn("Stage.addComponent: no component given")}addComponentFromObject(e,t={}){const n=Hp.get(e.type);if(n){const r=new n(this,e,t);return this.addComponent(r),r}tt.warn("no component for object type",e.type)}removeComponent(e){const t=this.compList.indexOf(e);t!==-1&&(this.compList.splice(t,1),e.dispose(),this.signals.componentRemoved.dispatch(e))}removeAllComponents(){this.compList.slice().forEach(e=>this.removeComponent(e))}handleResize(){this.viewer.handleResize()}setSize(e,t){const n=this.viewer.container;n!==document.body&&(e!==void 0&&(n.style.width=e),t!==void 0&&(n.style.height=t),this.handleResize())}toggleFullscreen(e){if(!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled))return void tt.log("fullscreen mode (currently) not possible");const t=this;function n(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function r(){if(!n()&&t.lastFullscreenElement){const s=t.lastFullscreenElement;s.style.width=s.dataset.normalWidth||"",s.style.height=s.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",r),document.removeEventListener("mozfullscreenchange",r),document.removeEventListener("webkitfullscreenchange",r),document.removeEventListener("MSFullscreenChange",r),t.handleResize(),t.signals.fullscreenChanged.dispatch(!1)}}e=e||this.viewer.container,this.lastFullscreenElement=e,n()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e.dataset.normalWidth=e.style.width||"",e.dataset.normalHeight=e.style.height||"",e.style.width=window.screen.width+"px",e.style.height=window.screen.height+"px",e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",r),document.addEventListener("mozfullscreenchange",r),document.addEventListener("webkitfullscreenchange",r),document.addEventListener("MSFullscreenChange",r),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout(function(){t.handleResize()},100))}setSpin(e){e?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)}setRock(e){e?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)}toggleSpin(){this.setSpin(this.spinAnimation.paused)}toggleRock(){this.setRock(this.rockAnimation.paused)}getFocus(){const e=this.parameters;if(e.clipMode!=="scene")return 0;let t=e.clipNear;return e.clipScale==="absolute"&&(t=this.viewer.absoluteToRelative(t)),2*t}setFocus(e){if(this.parameters.clipMode!=="scene")return;let t,n,r,s;this.parameters.clipScale==="relative"?(t=nC(e/2,0,49.9),n=100-t,r=50,s=function(o){return nC(o,0,100)}(2*n-50)):(t=this.viewer.relativeToAbsolute(e/2),n=t,r=0,s=2*n),this.setParameters({clipNear:t,clipFar:n,fogNear:r,fogFar:s})}getZoomForBox(e){const t=e.getSize(Mue),n=Math.max(t.x,t.y,t.z),r=Math.min(t.x,t.y,t.z);let s=n+Math.sqrt(r);const o=wi(this.viewer.perspectiveCamera.fov),a=this.viewer.width,l=this.viewer.height,c=l<a?1:a/l;return s=Math.abs(.5*s/c/Math.sin(o/2)),s+=this.parameters.clipDist,-s}getBox(){return this.viewer.boundingBox}getZoom(){return this.getZoomForBox(this.getBox())}getCenter(e){return this.getBox().getCenter(e||new me)}autoView(e){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),he(e,0))}makeImage(e={}){return new Promise((t,n)=>{this.tasks.onZeroOnce(()=>{this.tasks.increment(),this.viewer.makeImage(e).then(r=>{this.tasks.decrement(),t(r)}).catch(r=>{this.tasks.decrement(),n(r)})})})}setImpostor(e){this.parameters.impostor=e;const t=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(n){if(!t.includes(n.getType()))return;const r=n.getParameters();r.disableImpostor=!e,n.build(r)})}setQuality(e){this.parameters.quality=e;const t=["tube","cartoon","ribbon","trace","rope"],n=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation(function(r){const s=r.getParameters();if(!t.includes(r.getType())){if(!n.includes(r.getType()))return;if(!s.disableImpostor)return void(r.repr.quality=e)}s.quality=e,r.build(s)})}eachComponent(e,t){this.compList.slice().forEach(n=>{t!==void 0&&t!==n.type||e(n)})}eachRepresentation(e,t){this.eachComponent(n=>{n.reprList.slice().forEach(r=>{t!==void 0&&t!==r.getType()||e(r,n)})})}getComponentsByName(e){const t=[];return this.eachComponent(n=>{(e===void 0||R4(e,n))&&t.push(n)}),new P4(t)}getComponentsByObject(e){const t=[];return this.eachComponent(n=>{n.object===e&&t.push(n)}),new P4(t)}getRepresentationsByName(e){const t=[];return this.eachRepresentation((n,r)=>{(e===void 0||R4(e,n))&&t.push(n)}),new _V(t)}measureClear(){this.eachComponent(e=>e.measureClear(),"structure")}measureUpdate(){this.eachComponent(e=>e.measureUpdate(),"structure")}dispose(){this.tasks.dispose(),this.viewer.dispose(),this.mouseObserver.dispose()}}class Eue extends US{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.shape=t}get type(){return"shape"}addRepresentation(e,t={}){return this._addRepresentation(e,this.shape,t)}getBoxUntransformed(){return this.shape.boundingBox}getCenterUntransformed(){return this.shape.center}dispose(){this.shape.dispose(),super.dispose()}}function Un(i,e,t,n){var r,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,t,n);else for(var a=i.length-1;a>=0;a--)(r=i[a])&&(o=(s<3?r(o):s>3?r(e,t,o):r(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}function AV(i,e,t,n){return new(t||(t=Promise))(function(r,s){function o(c){try{l(n.next(c))}catch(u){s(u)}}function a(c){try{l(n.throw(c))}catch(u){s(u)}}function l(c){c.done?r(c.value):function(u){return u instanceof t?u:new t(function(h){h(u)})}(c.value).then(o,a)}l((n=n.apply(i,[])).next())})}Hp.add("shape",Eue),typeof SuppressedError=="function"&&SuppressedError;class I4 extends Hn{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=he(e.reverse,!0)),this.scalePerModel={},e.structure.eachModel(t=>{this.parameters.domain=[t.atomOffset,t.atomEnd],this.scalePerModel[t.index]=this.getScale()})}atomColor(e){return this.scalePerModel[e.modelIndex](e.index)}}Un([kn],I4.prototype,"atomColor",null),gn.add("atomindex",I4);class L4 extends Hn{constructor(e){if(super(e),e.scale||(this.parameters.scale="OrRd"),!e.domain){let t,n=1/0,r=-1/0;e.sele&&(t=new ei(e.sele)),e.structure.eachAtom(function(s){const o=s.bfactor;n=Math.min(n,o),r=Math.max(r,o)},t),this.parameters.domain=[n,r]}this.bfactorScale=this.getScale()}atomColor(e){return this.bfactorScale(e.bfactor)}}Un([kn],L4.prototype,"atomColor",null),gn.add("bfactor",L4);class D4 extends Hn{constructor(e){super(e),this.chainidDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel(t=>{let n=0;const r={};t.eachChain(function(s){r[s.chainid]===void 0&&(r[s.chainid]=n,n+=1)}),this.parameters.domain=[0,n-1],this.chainidDictPerModel[t.index]=r,this.scalePerModel[t.index]=this.getScale()})}atomColor(e){const t=this.chainidDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainid])}}Un([kn],D4.prototype,"atomColor",null),gn.add("chainid",D4);class N4 extends Hn{constructor(e){super(e),this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel(t=>{this.parameters.domain=[t.chainOffset,t.chainEnd],this.scalePerModel[t.index]=this.getScale()})}atomColor(e){return this.scalePerModel[e.modelIndex](e.chainIndex)}}Un([kn],N4.prototype,"atomColor",null),gn.add("chainindex",N4);class F4 extends Hn{constructor(e){super(e),this.chainnameDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel(t=>{let n=0;const r={};t.eachChain(function(s){r[s.chainname]===void 0&&(r[s.chainname]=n,n+=1)}),this.parameters.domain=[0,n-1],this.chainnameDictPerModel[t.index]=r,this.scalePerModel[t.index]=this.getScale()})}atomColor(e){const t=this.chainnameDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainname])}}Un([kn],F4.prototype,"atomColor",null),gn.add("chainname",F4);class k4 extends Hn{constructor(e){super(e),this.rsrzDict={},this.rsccDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});const t=e.structure.validation;t&&(this.rsrzDict=t.rsrzDict,this.rsccDict=t.rsccDict)}atomColor(e){let t=e.resno+"";e.inscode&&(t+="^"+e.inscode),e.chainname&&(t+=":"+e.chainname),t+="/"+e.modelIndex;const n=this.rsrzDict[t];if(n!==void 0)return this.rsrzScale(n);const r=this.rsccDict[t];return r!==void 0?this.rsccScale(r):9474192}}Un([kn],k4.prototype,"atomColor",null),gn.add("densityfit",k4);const nA={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}};class U4 extends Hn{constructor(e){super(e),this.delta=new me,this.hCharges=[],e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(e.structure.atomCount);const t=[];e.structure.eachAtom(r=>{var s;if(this.charges[r.index]=((s=r).partialCharge!==null?s.partialCharge:s.isProtein()&&(nA[s.resname]&&nA[s.resname][s.atomname]||nA.backbone[s.atomname])||0)*r.occupancy,r.atomname==="N"){if(r.bondCount>=3||r.bondToElementCount(1))return;const o=function(a,l=new me){let c=!1,u=!1,h=!1;return l.set(2*a.x,2*a.y,2*a.z),a.eachBondedAtom(function(d){if(!c)return d.atomname==="H"?(l.set(d.x,d.y,d.z),void(c=!0)):void(u||d.atomname!=="CA"?h||d.atomname!=="C"||(h=!0,l.sub(d)):(l.sub(d),u=!0))}),c?l:u&&h?(l.normalize(),l.multiplyScalar(1.04),l.add(a),l):void 0}(r);o!==void 0&&(t.push(o),this.hCharges.push(.25*r.occupancy))}});const n=e.structure.getBoundingBox();n.expandByScalar(1.04),this.hStore=function(r){const s=r.length,o=new Float32Array(s),a=new Float32Array(s),l=new Float32Array(s);for(let c=0;c<r.length;c++){const u=r[c];o[c]=u.x,a[c]=u.y,l[c]=u.z}return{x:o,y:a,z:l,count:s}}(t),this.hHash=new e1(this.hStore,n),this.hash=new e1(e.structure.atomStore,n)}positionColor(e){const t=this.charges,n=this.hCharges;let r=0;return this.hash.eachWithin(e.x,e.y,e.z,12,(s,o)=>{const a=t[s];a!==0&&(r+=a/o)}),this.hHash.eachWithin(e.x,e.y,e.z,12,(s,o)=>{const a=n[s];a!==0&&(r+=a/o)}),this.scale(332*r)}}Un([kn],U4.prototype,"positionColor",null),gn.add("electrostatic",U4);const O4={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120};class B4 extends Hn{constructor(e){e.value=he(e.value,O4.C),super(e)}atomColor(e){const t=e.element;return t==="C"?this.parameters.value:O4[t]||16777215}}Un([kn],B4.prototype,"atomColor",null),gn.add("element",B4);class z4 extends Hn{constructor(e){super(e),e.scale||(this.parameters.scale="Spectral"),e.domain||(this.parameters.domain=[0,e.structure.entityList.length-1]),this.entityindexScale=this.getScale()}atomColor(e){return this.entityindexScale(e.entityIndex)}}Un([kn],z4.prototype,"atomColor",null),gn.add("entityindex",z4);class G4 extends Hn{atomColor(e){const t=e.entity;switch(t?t.entityType:void 0){case 1:return 8374655;case 2:return 16629894;case 3:return 12496596;case 4:return 3697840;default:return 16777113}}}Un([kn],G4.prototype,"atomColor",null),gn.add("entitytype",G4);class V4 extends Hn{constructor(e){super(e),this.geoAtomDict={},this.geoDict={};const t=e.structure.validation;t&&(this.geoAtomDict=t.geoAtomDict,this.geoDict=t.geoDict)}atomColor(e){let t,n=e.resno+"";e.inscode&&(n+="^"+e.inscode),e.chainname&&(n+=":"+e.chainname),n+="/"+e.modelIndex;const r=this.geoAtomDict[n];r!==void 0?(s=r[e.atomname]||0,t=16843009*((s=(858993459&(s-=s>>1&1431655765))+(s>>2&858993459))+(s>>4)&252645135)>>24):t=this.geoDict[n]||0;var s;return t===0?2188972:t===1?16703627:t===2?16018755:t>=3?10813478:9474192}}Un([kn],V4.prototype,"atomColor",null),gn.add("geoquality",V4);class H4 extends Hn{constructor(e){super(e),this.resHF={},e.scale||(this.parameters.scale="RdYlGn");for(const t in l4)this.resHF[t]=l4[t][0];if(this.defaultResidueHydrophobicity=xle[0],!e.domain){let t=1/0,n=-1/0;for(const r in this.resHF){const s=this.resHF[r];t=Math.min(t,s),n=Math.max(n,s)}this.parameters.domain=[t,0,n]}this.hfScale=this.getScale()}atomColor(e){return this.hfScale(this.resHF[e.resname]||this.defaultResidueHydrophobicity)}}Un([kn],H4.prototype,"atomColor",null),gn.add("hydrophobicity",H4);class $4 extends Hn{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow"),e.domain||(this.parameters.domain=[0,e.structure.modelStore.count]),this.modelindexScale=this.getScale()}atomColor(e){return this.modelindexScale(e.modelIndex)}}Un([kn],$4.prototype,"atomColor",null),gn.add("modelindex",$4);class W4 extends Hn{atomColor(e){switch(e.residueType.moleculeType){case 1:return 3697840;case 2:return 15729279;case 3:return 12496596;case 4:return 16629894;case 5:return 12540695;case 6:return 8374655;default:return 16777113}}}Un([kn],W4.prototype,"atomColor",null),gn.add("moleculetype",W4);class j4 extends Hn{constructor(e){super(e),e.scale||(this.parameters.scale="PuBu"),e.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}atomColor(e){return this.occupancyScale(e.occupancy)}}Un([kn],j4.prototype,"atomColor",null),gn.add("occupancy",j4);class X4 extends Hn{constructor(e){super(e),e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}atomColor(e){return this.partialchargeScale(e.partialCharge||0)}}function iA(){return 16777215*Math.random()}Un([kn],X4.prototype,"atomColor",null),gn.add("partialcharge",X4);class _y extends Hn{atomColor(){return iA()}volumeColor(){return iA()}positionColor(){return iA()}}Un([kn],_y.prototype,"atomColor",null),Un([kn],_y.prototype,"volumeColor",null),Un([kn],_y.prototype,"positionColor",null),gn.add("random",_y);class q4 extends Hn{constructor(e){super(e),this.rciDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});const t=e.structure.validation;t&&(this.rciDict=t.rciDict)}atomColor(e){let t=`[${e.resname}]${e.resno}`;e.chainname&&(t+=":"+e.chainname);const n=this.rciDict[t];return n!==void 0?this.rciScale(n):9474192}}Un([kn],q4.prototype,"atomColor",null),gn.add("randomcoilindex",q4);class Y4 extends Hn{constructor(e){super(e),this.scalePerChain={},e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=he(e.reverse,!0)),e.structure.eachChain(t=>{this.parameters.domain=[t.residueOffset,t.residueEnd],this.scalePerChain[t.index]=this.getScale()})}atomColor(e){return this.scalePerChain[e.chainIndex](e.residueIndex)}}Un([kn],Y4.prototype,"atomColor",null),gn.add("residueindex",Y4);const Tue={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723};class K4 extends Hn{atomColor(e){return Tue[e.resname]||16711935}}Un([kn],K4.prototype,"atomColor",null),gn.add("resname",K4);const Cue=16711808,Pue=10485888,Rue=6291584,Iue=16762880,Lue=6324479,Due=16777215,Nue=11403518,Fue=16580962,kue=10921722;class Z4 extends Hn{constructor(e){super(e),this.residueProxy=e.structure.getResidueProxy()}atomColor(e){const t=e.sstruc,n=this.residueProxy;return t==="h"?Cue:t==="g"?Pue:t==="i"?Rue:t==="e"||t==="b"?Iue:t==="t"?Lue:(n.index=e.residueIndex,n.isDna()?Nue:n.isRna()?Fue:n.isSaccharide()?kue:n.isProtein()||t==="s"||t==="l"?Due:8421504)}}Un([kn],Z4.prototype,"atomColor",null),gn.add("sstruc",Z4);class rA extends Hn{constructor(e){var t,n;super(e),e.scale||(this.parameters.scale="rwb"),this.atomData=(t=this.parameters.data)===null||t===void 0?void 0:t.atomData,this.bondData=(n=this.parameters.data)===null||n===void 0?void 0:n.bondData,this.scale=this.getScale(this.parameters)}atomColor(e){var t;const n=(t=this.atomData)===null||t===void 0?void 0:t[e.index];return n!==void 0?this.scale(n):this.parameters.value}bondColor(e,t){var n;const r=(n=this.bondData)===null||n===void 0?void 0:n[e.index];return r!==void 0?this.scale(r):this.atomProxy?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value}}Un([kn],rA.prototype,"atomColor",null),Un([kn],rA.prototype,"bondColor",null),gn.add("structuredata",rA);class dg extends Hn{atomColor(){return this.parameters.value}bondColor(){return this.parameters.value}valueColor(){return this.parameters.value}volumeColor(){return this.parameters.value}}Un([kn],dg.prototype,"atomColor",null),Un([kn],dg.prototype,"bondColor",null),Un([kn],dg.prototype,"valueColor",null),Un([kn],dg.prototype,"volumeColor",null),gn.add("uniform",dg);class Q4 extends Hn{constructor(e){super(e),this.valueScale=this.getScale()}volumeColor(e){return this.valueScale(this.parameters.volume.data[e])}}Un([kn],Q4.prototype,"volumeColor",null),gn.add("value",Q4);class J4 extends Hn{constructor(e){super(e),this.vec=new me,this.valueScale=this.getScale()}positionColor(e){const t=this.parameters.volume;if(!t||!t.inverseMatrix)return this.parameters.value;const n=this.vec,r=t.data,s=t.nx,o=t.ny,a=s*o;n.copy(e),n.applyMatrix4(t.inverseMatrix);const l=Math.floor(n.x),c=Math.floor(n.y),u=Math.floor(n.z),h=(u*o+c)*s+l,d=h+1,f=h+s,m=h+a,_=f+1,v=m+1,g=f+a,b=g+1,p=r[h],y=r[d],A=r[f],w=r[m],M=r[_],T=r[v],E=r[g],C=r[b],N=n.x-l,P=n.y-c,L=n.z-u,R=Vo(p,y,N),F=Vo(w,T,N),V=Vo(A,M,N),z=Vo(E,C,N),U=Vo(R,V,P),G=Vo(F,z,P),B=Vo(U,G,L);return this.valueScale(B)}}Un([kn],J4.prototype,"positionColor",null),gn.add("volume",J4);class Br extends C1{constructor(e,t,n){const r=n||{};if(super(e,t,r),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:fc.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new ei(r.sele),this.dataList=[],this.structure=e,this.structureView=this.structure.getView(this.selection),e.biomolDict){const s={default:"default","":e.unitcell?"AU":"FULL"};Object.keys(e.biomolDict).forEach(function(o){s[o]=o}),this.parameters.assembly={type:"select",options:s,rebuild:!0}}else this.parameters.assembly=null}get defaultScale(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}}init(e){const t=e||{};t.colorScheme=he(t.colorScheme,"element"),this.setRadius(t.radius,t),this.radiusType=he(t.radiusType,"vdw"),this.radiusData=he(t.radiusData,{}),this.radiusSize=he(t.radiusSize,1),this.radiusScale=he(t.radiusScale,1),this.assembly=he(t.assembly,"default"),this.defaultAssembly=he(t.defaultAssembly,""),t.quality==="auto"&&(t.quality=this.getQuality()),super.init(t),this.selection.signals.stringChanged.add(()=>{this.build()}),this.build()}setRadius(e,t){const n=Object.keys(lV);return typeof e=="string"&&n.includes(e.toLowerCase())?t.radiusType=e:e!==void 0&&(t.radiusType="size",t.radiusSize=e),this}getAssembly(){const e=this.assembly==="default"?this.defaultAssembly:this.assembly;return this.structure.biomolDict[e]}getQuality(){let e;const t=this.structureView,n=this.getAssembly();return e=n?n.getAtomCount(t):t.atomCount,RG&&(e*=4),t.atomStore.count/t.residueStore.count<2&&(e*=10),e<15e3?"high":e<8e4?"medium":"low"}create(){if(this.structureView.atomCount===0)return;if(!this.structureView.hasCoords())return void(this.needsBuild=!0);this.needsBuild=!1;const e=this.getAssembly();if(e)e.partList.forEach((t,n)=>{const r=t.getView(this.structureView);if(r.atomCount===0)return;const s=this.createData(r,n);s&&(s.sview=r,s.instanceList=t.getInstanceList(),this.dataList.push(s))});else{const t=this.createData(this.structureView,0);t&&(t.sview=this.structureView,this.dataList.push(t))}}update(e){!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach(t=>{t.bufferList.length>0&&this.updateData(e,t)},this):Object.assign(this.lazyProps.what,e)}updateData(e,t){this.build()}getColorParams(){return Object.assign(Object.assign({},super.getColorParams()),{structure:this.structure})}getRadiusParams(e){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}}getAtomParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getBondParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getAtomRadius(e){return this.structureView.atomSet.isSet(e.index)?new fc(this.getRadiusParams()).atomRadius(e):0}setSelection(e,t){return this.selection.setString(e,t),this}setParameters(e,t={},n=!1){const r=e||{};return this.setRadius(r.radius,r),r.radiusType===void 0&&r.radiusData===void 0&&r.radiusSize===void 0&&r.radiusScale===void 0||(t.radius=!0,al&&!this.disableImpostor||(n=!0)),r.defaultAssembly!==void 0&&r.defaultAssembly!==this.defaultAssembly&&(this.assembly==="default"&&r.assembly===void 0||r.assembly==="default")&&(n=!0),super.setParameters(r,t,n),this}getParameters(){return Object.assign(super.getParameters(),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})}attach(e){const t=this.viewer,n=this.bufferList;this.dataList.forEach(function(r){r.bufferList.forEach(function(s){n.push(s),t.add(s,r.instanceList)})}),this.setVisibility(this.visible),e()}clear(){this.dataList.length=0,super.clear()}dispose(){this.structureView.dispose(),super.dispose()}}class JR extends Br{constructor(e,t,n){super(e,t,n),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}init(e){const t=e||{};this.labelVisible=he(t.labelVisible,!0),this.labelSize=he(t.labelSize,2),this.labelColor=he(t.labelColor,16777215),this.labelFontFamily=he(t.labelFontFamily,"sans-serif"),this.labelFontStyle=he(t.labelFontstyle,"normal"),this.labelFontWeight=he(t.labelFontWeight,"bold"),this.labelsdf=he(t.labelsdf,CG==="Chrome"),this.labelXOffset=he(t.labelXOffset,0),this.labelYOffset=he(t.labelYOffset,0),this.labelZOffset=he(t.labelZOffset,.5),this.labelAttachment=he(t.labelAttachment,"bottom-left"),this.labelBorder=he(t.labelBorder,!1),this.labelBorderColor=he(t.labelBorderColor,"lightgrey"),this.labelBorderWidth=he(t.labelBorderWidth,.15),this.labelBackground=he(t.labelBackground,!1),this.labelBackgroundColor=he(t.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=he(t.labelBackgroundMargin,.5),this.labelBackgroundOpacity=he(t.labelBackgroundOpacity,1),this.labelFixedSize=he(t.labelFixedSize,!1),this.lineOpacity=he(t.lineOpacity,1),this.linewidth=he(t.linewidth,2),super.init(t)}update(e){e.position?this.build():super.update(e)}updateData(e,t){const n={};if(e&&!e.labelSize||Object.assign(n,{size:Mo(this.n,this.labelSize)}),!e||e.labelColor){const r=new Ht(this.labelColor);Object.assign(n,{color:Bn(this.n,r.r,r.g,r.b)})}this.textBuffer.setAttributes(n)}setParameters(e,t={},n=!1){return e&&e.labelSize&&(t.labelSize=!0),e&&(e.labelColor||e.labelColor===0)&&(t.labelColor=!0,n=!0),super.setParameters(e,t,n),e&&e.opacity!==void 0&&this.textBuffer.setParameters({opacity:1}),e&&e.labelVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),t||this.viewer.requestRender(),this}getLabelBufferParams(e={}){return super.getBufferParams(Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},e,{opacity:1}))}getAtomRadius(){return 0}}function e3(i,e){const t=i.getAtomProxy(),n=new ei,r=e.length;if(r===0)return new Float32Array(0);const s=e[0].length,o=i.getAtomSet(),a=new Float32Array(r*s*3);let l=0;return e.forEach(function(c){let u=!1;for(let h=0;h<s;h++){const d=c[h];if(typeof d=="number"&&Number.isInteger(d)){if(!o.get(d)){u=!0;break}t.index=d}else{n.setString(d);const m=i.getAtomIndices(n);if(!m.length){u=!0;break}t.index=m[0]}let f=l+3*h;a[f++]=t.x,a[f++]=t.y,a[f++]=t.z}u||(l+=3*s)}),a.subarray(0,l)}function va(i,e,t,n,r){const s=Math.cos(r),o=Math.sin(r);i[0]=e[0]+t[0]*s+n[0]*o,i[1]=e[1]+t[1]*s+n[1]*o,i[2]=e[2]+t[2]*s+n[2]*o}function eU(i,e,t,n,r,s,o){for(let a=0;a<e;a++){for(let l=0;l<t;l++)n[l]=i[l*e+a];tU(n,r,s,o,t);for(let l=0;l<t;l++)i[l*e+a]=r[l]}for(let a=0;a<t;a++){for(let l=0;l<e;l++)n[l]=i[a*e+l];tU(n,r,s,o,e);for(let l=0;l<e;l++)i[a*e+l]=Math.sqrt(r[l])}}function tU(i,e,t,n,r){t[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(let s=1,o=0;s<r;s++){let a=(i[s]+s*s-(i[t[o]]+t[o]*t[o]))/(2*s-2*t[o]);for(;a<=n[o];)o--,a=(i[s]+s*s-(i[t[o]]+t[o]*t[o]))/(2*s-2*t[o]);o++,t[o]=s,n[o]=a,n[o+1]=Number.MAX_SAFE_INTEGER}for(let s=0,o=0;s<r;s++){for(;n[o+1]<s;)o++;e[s]=(s-t[o])*(s-t[o])+i[t[o]]}}An.add("shader/SDFFont.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float xOffset;
uniform float yOffset;
uniform float zOffset;
uniform bool ortho;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
attribute vec2 mapping;
attribute vec2 inputTexCoord;
attribute float inputSize;
#include matrix_scale
#include common
void main(void){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
texCoord = inputTexCoord;
float scale = matrixScale( modelViewMatrix );
float _xOffset = xOffset * scale;
float _yOffset = yOffset * scale;
float _zOffset = zOffset * scale;
if( texCoord.x == 10.0 ){
_zOffset -= 0.001;
}
vec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );
#ifdef FIXED_SIZE
if ( ortho ) {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;
} else {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;
}
#endif
vec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );
cameraCornerPos.xy += mapping * inputSize * 0.01 * scale;
cameraCornerPos.x += _xOffset;
cameraCornerPos.y += _yOffset;
if( ortho ){
cameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;
} else {
cameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;
}
gl_Position = projectionMatrix * cameraCornerPos;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -cameraCornerPos.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),An.add("shader/SDFFont.frag",`uniform sampler2D fontTexture;
uniform float opacity;
uniform bool showBorder;
uniform vec3 borderColor;
uniform float borderWidth;
uniform vec3 backgroundColor;
uniform float backgroundOpacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
const vec3 vColor = vec3( 0.0 );
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#endif
const float gamma = 2.2 * 1.4142 / 128.0;
const float padding = 0.75;
void main(){
#include nearclip_fragment
#include radiusclip_fragment
if( texCoord.x > 1.0 ){
gl_FragColor = vec4( backgroundColor, backgroundOpacity );
}else{
float sdf = texture2D( fontTexture, texCoord ).a;
if( showBorder ) sdf += borderWidth;
float a = smoothstep(padding - gamma, padding + gamma, sdf);
if( a < 0.2 ) discard;
a *= opacity;
vec3 outgoingLight = vColor;
if( showBorder && sdf < ( padding + borderWidth ) ){
outgoingLight = borderColor;
}
gl_FragColor = vec4( outgoingLight, a );
}
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const sA={},Uue={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024};class Oue{constructor(e={}){this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=wo(e,Uue);const t=this.parameters;this.radius=t.size/8,this.padding=t.size/3;const n=this.lineHeight=t.size+2*t.outline+Math.round(t.size/4),r=this.maxWidth=t.width/4,s=this.canvas=document.createElement("canvas");s.width=r,s.height=n;const o=this.context=this.canvas.getContext("2d",{willReadFrequently:!0});o.font=`${t.style} ${t.variant} ${t.weight} ${t.size}px ${t.font}`,o.fillStyle="black",o.textAlign="left",o.textBaseline="bottom",o.lineJoin="round",this.gridOuter=new Float64Array(n*r),this.gridInner=new Float64Array(n*r),this.f=new Float64Array(Math.max(n,r)),this.d=new Float64Array(Math.max(n,r)),this.z=new Float64Array(Math.max(n,r)+1),this.v=new Int16Array(Math.max(n,r)),this.data=new Uint8Array(t.width*t.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=t.width,this.canvas2.height=t.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map("�");for(let a=32;a<=126;++a)this.map(String.fromCharCode(a));this.map("°"),this.map("Å"),this.texture=new Qoe(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0}map(e){const t=this.parameters;return this.mapped[e]===void 0&&(this.draw(e),this.currentX+this.scratchW>t.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>t.height&&console.warn("canvas to small"),this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[e]}get(e){return this.mapped[e]||this.placeholder}draw(e){const t=this.parameters,n=this.lineHeight,r=t.outline,s=this.context,o=this.maxWidth,a=r,l=n-t.outline,c=s.measureText(e),u=Math.min(o,Math.ceil(c.width+2*a+1)),h=u*n;s.clearRect(0,0,u,n),s.fillText(e,a,l);const d=s.getImageData(0,0,u,n),f=d.data;for(let m=0;m<h;m++){const _=d.data[4*m+3]/255;this.gridOuter[m]=_===1?0:_===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-_),2),this.gridInner[m]=_===1?Number.MAX_SAFE_INTEGER:_===0?0:Math.pow(Math.max(0,_-.5),2)}eU(this.gridOuter,u,n,this.f,this.d,this.v,this.z),eU(this.gridInner,u,n,this.f,this.d,this.v,this.z);for(let m=0;m<h;m++){const _=this.gridOuter[m]-this.gridInner[m];f[4*m+3]=Math.max(0,Math.min(255,Math.round(255-255*(_/this.radius+this.cutoff))))}s.putImageData(d,0,0),this.scratchW=u,this.scratchH=n}}const Bue=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},Ls),zue=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},wd);function nU(i,e){const t=i.position.length/3;let n=0;for(let r=0;r<t;++r)n+=i.text[r].length;return e.showBackground&&(n+=t),n}class dm extends KR{constructor(e,t={}){super({position:new Float32Array(3*nU(e,t)),color:new Float32Array(3*nU(e,t)),picking:new Yle},t),this.parameterTypes=zue,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=e.text,this.positionCount=e.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new Ht(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new Ht(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(e),this.makeTexture(),this.makeMapping()}get defaultParameters(){return Bue}makeMaterial(){super.makeMaterial();const e=this.texture,t=this.material;t.transparent=!0,t.extensions.derivatives=!0,t.lights=!1,t.uniforms.fontTexture.value=e,t.needsUpdate=!0;const n=this.wireframeMaterial;n.transparent=!0,n.extensions.derivatives=!0,n.lights=!1,n.uniforms.fontTexture.value=e,n.needsUpdate=!0;const r=this.pickingMaterial;r.extensions.derivatives=!0,r.lights=!1,r.uniforms.fontTexture.value=e,r.needsUpdate=!0}setAttributes(e={}){let t,n,r,s,o,a;const l=this.text,c=this.geometry.attributes;e.position&&(t=e.position,s=c.position.array,c.position.needsUpdate=!0),e.size&&(n=e.size,o=c.inputSize.array,c.inputSize.needsUpdate=!0),e.color&&(r=e.color,a=c.color.array,c.color.needsUpdate=!0);const u=this.positionCount;let h,d,f,m,_,v=0;for(let g=0;g<u;++g)for(d=3*g,f=l[g],_=f.length,this.parameters.showBackground&&(_+=1),m=0;m<_;++m,++v)for(let b=0;b<4;b++)h=4*v*3+3*b,t&&(s[h]=t[d],s[h+1]=t[d+1],s[h+2]=t[d+2]),n&&(o[4*v+b]=n[g]),r&&(a[h]=r[d],a[h+1]=r[d+1],a[h+2]=r[d+2])}makeTexture(){this.textAtlas=function(e){const t=JSON.stringify(e);return sA[t]===void 0&&(sA[t]=new Oue(e)),sA[t]}({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture}makeMapping(){const e=this.textAtlas,t=this.text,n=this.parameters.attachment,r=e.lineHeight*this.parameters.backgroundMargin*.1-10,s=this.geometry.attributes,o=s.inputTexCoord.array,a=s.mapping.array,l=this.positionCount;let c,u,h,d,f,m,_,v,g=0;for(let b=0;b<l;++b){for(h=t[b],d=0,m=h.length,f=0;f<m;++f)c=e.get(h[f]),d+=c.w-2*e.parameters.outline;for(v=n.startsWith("top")?e.lineHeight/1.25:n.startsWith("middle")?e.lineHeight/2.5:0,_=n.endsWith("right")?d:n.endsWith("center")?d/2:0,_+=e.parameters.outline,v+=e.parameters.outline,this.parameters.showBackground&&(u=2*g*4,a[u+0]=-e.lineHeight/6-_-r,a[u+1]=e.lineHeight-v+r,a[u+2]=-e.lineHeight/6-_-r,a[u+3]=0-v-r,a[u+4]=d+e.lineHeight/6-_+2*e.parameters.outline+r,a[u+5]=e.lineHeight-v+r,a[u+6]=d+e.lineHeight/6-_+2*e.parameters.outline+r,a[u+7]=0-v-r,o[u+0]=10,o[u+2]=10,o[u+4]=10,o[u+6]=10,g+=1),d=0,f=0;f<m;++f,++g){c=e.get(h[f]),u=2*g*4,a[u+0]=d-_,a[u+1]=c.h-v,a[u+2]=d-_,a[u+3]=0-v,a[u+4]=d+c.w-_,a[u+5]=c.h-v,a[u+6]=d+c.w-_,a[u+7]=0-v;const p=e.parameters.width,y=e.parameters.height,A=[c.x/p,c.y/y,c.x/p,(c.y+c.h)/y,(c.x+c.w)/p,c.y/y,(c.x+c.w)/p,(c.y+c.h)/y];o.set(A,u),d+=c.w-2*e.parameters.outline}}s.inputTexCoord.needsUpdate=!0,s.mapping.needsUpdate=!0}getDefines(e){const t=super.getDefines(e);return this.parameters.fixedSize&&(t.FIXED_SIZE=1),t}setUniforms(e){!e||e.fontFamily===void 0&&e.fontStyle===void 0&&e.fontWeight===void 0&&e.fontSize===void 0||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,e.fontTexture=this.texture),super.setUniforms(e)}}To.add("text",dm),An.add("shader/WideLine.vert",`
uniform float clipNear;
uniform vec3 clipCenter;
uniform float linewidth;
uniform vec2 resolution;
uniform mat4 projectionMatrixInverse;
attribute vec2 mapping;
attribute vec3 position1;
attribute vec3 position2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void trimSegment( const in vec4 start, inout vec4 end ) {
float a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;
float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );
end.xyz = mix( start.xyz, end.xyz, alpha );
}
void main() {
float aspect = resolution.x / resolution.y;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
flag = mapping.y;
vColor = color;
vColor2 = color2;
#endif
vec4 start = modelViewMatrix * vec4( position1, 1.0 );
vec4 end = modelViewMatrix * vec4( position2, 1.0 );
bool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {
if ( start.z < 0.0 && end.z >= 0.0 ) {
trimSegment( start, end );
} else if ( end.z < 0.0 && start.z >= 0.0 ) {
trimSegment( end, start );
}
}
vec4 clipStart = projectionMatrix * start;
vec4 clipEnd = projectionMatrix * end;
vec2 ndcStart = clipStart.xy / clipStart.w;
vec2 ndcEnd = clipEnd.xy / clipEnd.w;
vec2 dir = ndcEnd - ndcStart;
dir.x *= aspect;
dir = normalize( dir );
vec2 offset = vec2( dir.y, - dir.x );
dir.x /= aspect;
offset.x /= aspect;
if ( mapping.x < 0.0 ) offset *= - 1.0;
offset *= linewidth;
offset /= resolution.y;
vec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;
offset *= clip.w;
clip.xy += offset;
gl_Position = clip;
#ifndef PICKING
vViewPosition = ( projectionMatrixInverse * clip ).xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),An.add("shader/WideLine.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include fog_pars_fragment
varying vec3 vViewPosition;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
#endif
void main() {
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
if ( flag < 0.0 ) {
diffuseColor.rgb *= vColor;
} else {
diffuseColor.rgb *= vColor2;
}
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Gue=Object.assign({linewidth:2},Ls),Vue=Object.assign({linewidth:{uniform:!0}},wd);class pc extends KR{constructor(e,t={}){super(e,t),this.parameterTypes=Vue,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!e.color2&&e.color&&(e.color2=e.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new sn},projectionMatrixInverse:{value:new Tt}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Gue}setParameters(e){super.setParameters(e)}}To.add("wideline",pc);class Hue extends JR{constructor(e,t,n){super(e,t,n),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=he(t.side,"double"),t.opacity=he(t.opacity,.5),this.atomTriple=he(t.atomTriple,[]),this.arcVisible=he(t.arcVisible,!0),this.sectorVisible=he(t.sectorVisible,!0),this.vectorVisible=he(t.vectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomTriple.length)return;const t=function(a,l){return function(c){const u=[],h=c.length/9;for(let m=0;m<h;m++){let _=!0;for(let v=m;v<m+3;v+=3)c[v]===c[v+3]&&c[v+1]===c[v+4]&&c[v+2]===c[v+5]&&(_=!1);_&&u.push(m)}const d=new Float32Array(9*u.length);let f=0;return u.forEach(function(m){er(c,d,9*m,9*f,9),f++}),d}(e3(a,l))}(e,this.atomTriple),n=function(a,l={}){const c=he(l.angleStep,Math.PI/90),u=a.length/9,h=new Float32Array(u),d=new Float32Array(3*u),f=new Array(u),m=new Float32Array(6*u),_=new Float32Array(6*u),v=new Array(u),g=new Array(u),b=new Array(u);let p=0;const y=en(),A=en(),w=en(),M=en(),T=en(),E=en(),C=en(),N=en(),P=en();for(var L=0;L<u;L++){let D=9*L;bs(y,a,D),bs(A,a,D+3),bs(w,a,D+6);let O=6*L;rn(y,m,O),rn(A,_,O),rn(A,m,O+3),rn(w,_,O+3),fi(M,y,A),fi(T,w,A),Si(M,M),Si(T,T),Zs(E,M,T);const j=_u(E),q=Bs(M,T),Y=h[L]=Math.atan2(j,q);f[L]=(FG*Y).toFixed(1)+"°",_u(E)===0&&(E[0]=1,E[1]=0,E[2]=0),Zs(C,E,M),Si(C,C),va(N,A,M,C,Y/2),rn(N,d,3*L);const ie=Math.ceil(Y/c),ne=new Float32Array(9*ie);b[L]=ne;const Q=new Float32Array(3*ie),le=new Float32Array(3*ie);v[L]=Q,g[L]=le,wa(P,A,M);const se=function($,pe){const xe=9*pe,Pe=3*pe;rn(A,ne,xe),rn(P,ne,xe+3),rn(P,Q,Pe),va(P,A,M,C,$),rn(P,ne,xe+6),rn(P,le,Pe)};let oe=0;for(let $=c;$<Y;$+=c)se($,oe),oe++;se(Y,oe),p+=ie}const R=3*p,F=9*p,V=new Float32Array(R),z=new Float32Array(R),U=new Float32Array(F);let G=0,B=0;for(let D=0;D<u;D++){const O=v[D],j=g[D];er(O,V,0,B,O.length),er(j,z,0,B,j.length),B+=O.length;const q=b[D];er(q,U,0,G,q.length),G+=q.length}return{labelPosition:d,labelText:f,vectorPosition1:m,vectorPosition2:_,arcPosition1:V,arcPosition2:z,sectorPosition:U}}(t),r=this.n=n.labelPosition.length/3,s=new Ht(this.labelColor);this.textBuffer=new dm({position:n.labelPosition,size:Mo(r,this.labelSize),color:Bn(r,s.r,s.g,s.b),text:n.labelText},this.getLabelBufferParams());const o=new Ht(this.colorValue);return this.vectorBuffer=new pc(aC({position1:n.vectorPosition1,position2:n.vectorPosition2,color:Bn(2*r,o.r,o.g,o.b),color2:Bn(2*r,o.r,o.g,o.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=n.arcPosition1.length/3,this.arcBuffer=new pc(aC({position1:n.arcPosition1,position2:n.arcPosition2,color:Bn(this.arcLength,o.r,o.g,o.b),color2:Bn(this.arcLength,o.r,o.g,o.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=n.sectorPosition.length/3,this.sectorBuffer=new dc({position:n.sectorPosition,color:Bn(this.sectorLength,o.r,o.g,o.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},r={},s={};if(e.color){const o=new Ht(this.colorValue);Object.assign(n,{color:Bn(2*this.n,o.r,o.g,o.b),color2:Bn(2*this.n,o.r,o.g,o.b)}),Object.assign(r,{color:Bn(this.arcLength,o.r,o.g,o.b),color2:Bn(this.arcLength,o.r,o.g,o.b)}),Object.assign(s,{color:Bn(this.sectorLength,o.r,o.g,o.b)})}this.vectorBuffer.setAttributes(n),this.arcBuffer.setAttributes(r),this.sectorBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),!e||e.vectorVisible===void 0&&e.arcVisible===void 0&&e.sectorVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&(this.vectorBuffer.setParameters({opacity:e.lineOpacity}),this.arcBuffer.setParameters({opacity:e.lineOpacity})),e&&e.opacity!==void 0&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),e&&e.linewidth&&(this.vectorBuffer.setParameters({linewidth:e.linewidth}),this.arcBuffer.setParameters({linewidth:e.linewidth})),this}setVisibility(e,t){return super.setVisibility(e,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}ti.add("angle",Hue);const iU=new me,oA=new me,aA=new me,$ue=new me(0,1,0),t3=Object.assign({radialSegments:1,openEnded:!0},Ls);function rU(i={}){const e=he(i.radialSegments,10),t=he(i.openEnded,!0),n=new Tt().makeRotationX(Math.PI/2),r=new SS(1,1,1,e,1,t);return r.applyMatrix4(n),r}class EV extends Fu{constructor(e,t={}){super(function(s,o={}){const a=rU(o),l=s.position1.length,c=a.attributes.position.array.length/3,u=l/3,h=new Float32Array(2*u*c);return iC(u,c,0,h),iC(u,c,u*c,h),{position:new Float32Array(2*l),color:new Float32Array(2*l),primitiveId:h,picking:s.picking}}(e,t),t,rU(t)),this.updateNormals=!0;const n=e.position1.length,r=e.radius.length;this.__center=new Float32Array(n),this._position=new Float32Array(2*n),this._color=new Float32Array(2*n),this._from=new Float32Array(2*n),this._to=new Float32Array(2*n),this._radius=new Float32Array(2*r),this.setAttributes(e,!0)}get defaultParameters(){return t3}applyPositionTransform(e,t,n){oA.fromArray(this._from,n),aA.fromArray(this._to,n),e.lookAt(oA,aA,$ue);const r=this._radius[t];iU.set(r,r,oA.distanceTo(aA)),e.scale(iU)}setAttributes(e={},t){const n={};e.position1&&e.position2&&(ll(e.position1,e.position2,this.__center),ll(e.position1,this.__center,this._position),ll(this.__center,e.position2,this._position,e.position1.length),this._from.set(e.position1),this._from.set(this.__center,e.position1.length),this._to.set(this.__center),this._to.set(e.position2,this.__center.length),n.position=this._position),e.color&&e.color2&&(this._color.set(e.color),this._color.set(e.color2,e.color.length),n.color=this._color),e.radius&&(this._radius.set(e.radius),this._radius.set(e.radius,e.radius.length),n.radius=this._radius),super.setAttributes(n,t)}}An.add("shader/CylinderImpostor.vert",`
attribute vec3 mapping;
attribute vec3 position1;
attribute vec3 position2;
attribute float radius;
varying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;
varying vec4 w;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform mat4 modelViewMatrixInverse;
uniform float ortho;
#include matrix_scale
void main(){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
base_radius.w = radius * matrixScale( modelViewMatrix );
vec3 center = position;
vec3 dir = normalize( position2 - position1 );
float ext = length( position2 - position1 ) / 2.0;
vec3 cam_dir;
if( ortho == 0.0 ){
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;
}else{
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;
}
cam_dir = normalize( cam_dir );
vec3 ldir;
float b = dot( cam_dir, dir );
end_b.w = b;
if( b < 0.0 )
ldir = -ext * dir;
else
ldir = ext * dir;
vec3 left = radius * normalize( cross( cam_dir, ldir ) );
vec3 up = radius * normalize( cross( left, ldir ) );
axis = normalize( normalMatrix * ldir );
U = normalize( normalMatrix * up );
V = normalize( normalMatrix * left );
vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );
base_radius.xyz = base4.xyz / base4.w;
vec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );
end_b.xyz = end4.xyz / end4.w;
w = modelViewMatrix * vec4(
center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0
);
gl_Position = projectionMatrix * w;
gl_Position.z = 0.99;
}`),An.add("shader/CylinderImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying vec3 axis;
varying vec4 base_radius;
varying vec4 end_b;
varying vec3 U;
varying vec3 V;
varying vec4 w;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float distSq3( vec3 v3a, vec3 v3b ){
return (
( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +
( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +
( v3a.z - v3b.z ) * ( v3a.z - v3b.z )
);
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
void main(){
vec3 ray_target = w.xyz / w.w;
vec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;
vec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);
vec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);
mat3 basis = mat3( U, V, axis );
vec3 diff = ray_target - 0.5 * (base + end);
vec3 P = diff * basis;
float dz = dot( axis, ray_direction );
float radius2 = vRadius*vRadius;
vec3 D = vec3(dot(U, ray_direction),
dot(V, ray_direction),
dz);
float a0 = P.x*P.x + P.y*P.y - radius2;
float a1 = P.x*D.x + P.y*D.y;
float a2 = D.x*D.x + D.y*D.y;
float d = a1*a1 - a0*a2;
if (d < 0.0) {
discard;
}
float dist = (-a1 + sqrt(d)) / a2;
vec3 surface_point = ray_target + dist * ray_direction;
vec3 base_to_surface = surface_point - base;
vec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );
float base_cap_test = dot( base_to_surface, axis );
float end_cap_test = dot((surface_point - end), axis);
#ifndef CAP
vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
vec3 tmp_point2 = new_point2 - base;
#endif
if (base_cap_test < 0.0) {
float dNV;
float near;
vec3 front_point;
if ( ortho == 1.0 ) {
front_point = ray_target;
} else {
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
front_point = ray_direction * near + ray_origin;
}
if (dot(front_point - base, front_point-base) > radius2) {
discard;
}
#ifdef CAP
surface_point = front_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(axis, end) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - end, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
if( end_cap_test > 0.0 )
{
float dNV;
float near;
vec3 end_point;
if ( ortho == 1.0 ) {
end_point = ray_target;
} else {
dNV = dot(axis, ray_direction);
if (dNV < 0.0) {
discard;
}
near = dot(axis, end) / dNV;
end_point = ray_direction * near + ray_origin;
}
if( dot(end_point - end, end_point-base) > radius2 ) {
discard;
}
#ifdef CAP
surface_point = end_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - base, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
gl_FragDepthEXT = calcDepth( surface_point );
#ifdef NEAR_CLIP
if( calcClip( surface_point ) > 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
if( calcClip( surface_point ) > 0.0 ) {
discard;
}
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#endif
if (gl_FragDepthEXT < 0.0) {
discard;
}
if (gl_FragDepthEXT > 1.0) {
discard;
}
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -surface_point;
vec3 vNormal = _normal;
vec3 vColor;
if( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){
if( b < 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}else{
if( b > 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Wue=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),jue=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);class sU extends YR{constructor(e,t={}){super("v3",e,t)}get mapping(){return Wue}get mappingIndices(){return jue}get mappingIndicesSize(){return 12}get mappingSize(){return 6}get mappingItemSize(){return 3}}const TV=Object.assign({openEnded:!1},Ls),Xue=Object.assign({openEnded:{updateShader:!0}},wd);class que extends sU{constructor(e,t={}){super(e,t),this.parameterTypes=Xue,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new Tt},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return TV}getDefines(e){const t=sU.prototype.getDefines.call(this,e);return this.parameters.openEnded||(t.CAP=1),t}}Object.assign({disableImpostor:!1},t3,TV);const vc=class{constructor(i,e={}){return!i.color2&&i.color&&(i.color2=i.color),!al||e&&e.disableImpostor?new EV(i,e):new que(i,e)}};To.add("cylinder",vc);class Yue extends Br{constructor(e,t,n){super(e,t,n),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};t.radiusSize=he(t.radiusSize,.5),t.colorValue=he(t.colorValue,"lightgreen"),t.useInteriorColor=he(t.useInteriorColor,!0),this.showAxes=he(t.showAxes,!0),this.showBox=he(t.showBox,!1),super.init(t)}getPrincipalAxes(){let e;const t=this.getAssembly();return t&&(e=t.partList[0].getSelection()),this.structureView.getPrincipalAxes(e)}getAxesData(e){const t=this.getPrincipalAxes(),n=new Ht(this.colorValue);let r=0,s=0;this.showAxes&&(r+=6,s+=3),this.showBox&&(r+=8,s+=12);const o=new Float32Array(3*r),a=Bn(r,n.r,n.g,n.b),l=Mo(r,this.radiusSize),c=new Float32Array(3*s),u=new Float32Array(3*s),h=Bn(s,n.r,n.g,n.b),d=Mo(s,this.radiusSize);let f=0;if(this.showAxes){const _=function(v,g){v.toArray(o,2*f),g.toArray(o,2*f+3),v.toArray(c,f),g.toArray(u,f),f+=3};_(t.begA,t.endA),_(t.begB,t.endB),_(t.begC,t.endC)}if(this.showBox){const _=new me,{d1a:v,d2a:g,d3a:b,d1b:p,d2b:y,d3b:A}=t.getProjectedScaleForAtoms(e);let w=2*f;const M=function(C,N,P){_.copy(t.center).addScaledVector(t.normVecA,C).addScaledVector(t.normVecB,N).addScaledVector(t.normVecC,P),_.toArray(o,w),w+=3};M(v,g,b),M(v,g,A),M(v,y,A),M(v,y,b),M(p,y,A),M(p,y,b),M(p,g,b),M(p,g,A);let T=f;const E=function(C,N){_.fromArray(o,2*f+3*C).toArray(c,T),_.fromArray(o,2*f+3*N).toArray(u,T),T+=3};E(0,1),E(0,3),E(0,6),E(1,2),E(1,7),E(2,3),E(2,4),E(3,5),E(4,5),E(4,7),E(5,6),E(6,7)}const m=new Wle(t);return{vertex:{position:o,color:a,radius:l,picking:m},edge:{position1:c,position2:u,color:h,color2:h,radius:d,picking:m}}}create(){const e=this.getAxesData(this.structureView);this.sphereBuffer=new ku(e.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new vc(e.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=this.getAxesData(t.sview),r={},s={};e&&!e.position||(Object.assign(r,{position:n.vertex.position}),Object.assign(s,{position1:n.edge.position1,position2:n.edge.position2})),e&&!e.color||(Object.assign(r,{color:n.vertex.color}),Object.assign(s,{color:n.edge.color,color2:n.edge.color})),e&&!e.radius||(Object.assign(r,{radius:n.vertex.radius}),Object.assign(s,{radius:n.edge.radius})),this.sphereBuffer.setAttributes(r),this.cylinderBuffer.setAttributes(s)}}ti.add("axes",Yue);class BS extends Br{constructor(e,t,n){super(e,t,n),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusType=he(t.radiusType,"size"),t.radiusSize=he(t.radiusSize,.15),t.useInteriorColor=he(t.useInteriorColor,!0),this.aspectRatio=he(t.aspectRatio,2),this.lineOnly=he(t.lineOnly,!1),this.cylinderOnly=he(t.cylinderOnly,!1),this.multipleBond=he(t.multipleBond,"off"),this.bondSpacing=he(t.bondSpacing,1),this.bondScale=he(t.bondScale,.4),this.linewidth=he(t.linewidth,2),super.init(t)}getAtomRadius(e){return this.aspectRatio*super.getAtomRadius(e)}getAtomParams(e,t){var n=super.getAtomParams(e,t);return n.radiusParams.scale*=this.aspectRatio,n}getAtomData(e,t,n){return e.getAtomData(this.getAtomParams(t,n))}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},t),super.getBondParams(e,t)}getBondData(e,t,n){return e.getBondData(this.getBondParams(t,n))}createData(e){const t=[];if(this.lineOnly)this.lineBuffer=new pc(this.getBondData(e,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),t.push(this.lineBuffer);else{const n=new vc(this.getBondData(e),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(t.push(n),!this.cylinderOnly){const r=new ku(this.getAtomData(e),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));t.push(r)}}return{bufferList:t}}updateData(e,t){this.multipleBond!=="off"&&e&&e.radius&&(e.position=!0);const n=this.getBondData(t.sview,e);if(this.lineOnly){const a={};e&&!e.position||Object.assign(a,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(a,{color:n.color,color2:n.color2}),t.bufferList[0].setAttributes(a)}else{var r={};if(e&&!e.position||Object.assign(r,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(r,{color:n.color,color2:n.color2}),e&&!e.radius||Object.assign(r,{radius:n.radius}),t.bufferList[0].setAttributes(r),!this.cylinderOnly){var s=this.getAtomData(t.sview,e),o={};e&&!e.position||Object.assign(o,{position:s.position}),e&&!e.color||Object.assign(o,{color:s.color}),e&&!e.radius||Object.assign(o,{radius:s.radius}),t.bufferList[1].setAttributes(o)}}}setParameters(e={}){let t=!1;const n={};return(e.aspectRatio||e.bondSpacing||e.bondScale)&&(Object.assign(n,{radius:!0}),al&&!this.disableImpostor||(t=!0)),super.setParameters(e,n,t),this}}ti.add("ball+stick",BS);class Kue extends BS{constructor(e,t,n){super(e,t,n),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(n)}init(e){var t=e||{};t.aspectRatio=he(t.aspectRatio,1),t.radiusSize=he(t.radiusSize,.25),super.init(t)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}getAtomData(e,t,n){return e.getBackboneAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){return e.getBackboneBondData(this.getBondParams(t,n))}}ti.add("backbone",Kue);class Zue extends BS{constructor(e,t,n){super(e,t,n),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){let t=e||{};t.aspectRatio=he(t.aspectRatio,1),t.radiusSize=he(t.radiusSize,.3),super.init(t)}getAtomData(e,t,n){return e.getRungAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){let r=this.getBondParams(t,n);return Object.assign(r.colorParams,{rung:!0}),e.getRungBondData(r)}}ti.add("base",Zue);class Que{constructor(e,t){this.m=e,this.tension=t,this.dt=1/this.m,this.delta=1e-4,this.vec1=new me,this.vec2=new me,this.vDir=new me,this.vTan=new me,this.vNorm=new me,this.vBin=new me,this.m2=Math.ceil(this.m/2)}interpolateToArr(e,t,n,r,s,o,a){o[a+0]=Wl(e.x,t.x,n.x,r.x,s,this.tension),o[a+1]=Wl(e.y,t.y,n.y,r.y,s,this.tension),o[a+2]=Wl(e.z,t.z,n.z,r.z,s,this.tension)}interpolateToVec(e,t,n,r,s,o){o.x=Wl(e.x,t.x,n.x,r.x,s,this.tension),o.y=Wl(e.y,t.y,n.y,r.y,s,this.tension),o.z=Wl(e.z,t.z,n.z,r.z,s,this.tension)}interpolatePosition(e,t,n,r,s,o){for(var a=0;a<this.m;++a){var l=o+3*a,c=this.dt*a;this.interpolateToArr(e,t,n,r,c,s,l)}}interpolateTangent(e,t,n,r,s,o){for(var a=0;a<this.m;++a){var l=this.dt*a,c=l-this.delta,u=l+this.delta,h=o+3*a;c<0&&(c=0),u>1&&(u=1),this.interpolateToVec(e,t,n,r,c,this.vec1),this.interpolateToVec(e,t,n,r,u,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(s,h)}}vectorSubdivide(e,t,n,r,s){let o,a=t.next(),l=t.next(),c=t.next();const u=t.size,h=u-1;let d=r||0;for(let f=0;f<h;++f)o=a,a=l,l=c,c=t.next(),e.apply(this,[o,a,l,c,n,d]),d+=3*this.m;s&&(o=t.get(u-2),a=t.get(u-1),l=t.get(0),c=t.get(1),e.apply(this,[o,a,l,c,n,d]),d+=3*this.m)}getPosition(e,t,n,r){e.reset(),this.vectorSubdivide(this.interpolatePosition,e,t,n,r);var s=e.size-1,o=s*this.m*3;r&&(o+=3*this.m);var a=e.get(r?0:s);t[o]=a.x,t[o+1]=a.y,t[o+2]=a.z}getTangent(e,t,n,r){e.reset(),this.vectorSubdivide(this.interpolateTangent,e,t,n,r);let s=(e.size-1)*this.m*3;r&&(s+=3*this.m),er(t,t,s-3,s,3)}interpolateNormalDir(e,t,n,r,s,o,a,l,c,u,h,d,f){for(let m=0;m<this.m;++m){let _=d+3*m;f&&(_+=3*this.m2);const v=this.dt*m;this.interpolateToVec(e,t,n,r,v,this.vec1),this.interpolateToVec(s,o,a,l,v,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(c,_),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(h,_),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(u,_)}}interpolateNormal(e,t,n,r,s){for(var o=0;o<this.m;++o){var a=s+3*o;e.copy(this.vNorm),this.vTan.fromArray(t,a),this.vBin.crossVectors(e,this.vTan).normalize(),this.vBin.toArray(r,a),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(n,a)}}getNormal(e,t,n,r,s,o){this.vNorm.set(0,0,1);const a=e-1;let l=s||0;for(var c=0;c<a;++c)this.interpolateNormal(this.vDir,t,n,r,l),l+=3*this.m;o&&(this.interpolateNormal(this.vDir,t,n,r,l),l+=3*this.m),this.vBin.toArray(r,l),this.vNorm.toArray(n,l)}getNormalDir(e,t,n,r,s,o,a,l){e.reset(),t.reset();const c=new me,u=new me,h=new me,d=new me,f=new me,m=new me().copy(e.next()),_=new me().copy(e.next()),v=new me().copy(e.next()),g=new me,b=new me().copy(t.next()),p=new me().copy(t.next()),y=new me().copy(t.next());this.vNorm.set(0,0,1);let A=e.size,w=A-1,M=o||0;for(var T=0;T<w;++T)f.copy(m),m.copy(_),_.copy(v),v.copy(e.next()),g.copy(b),b.copy(p),p.copy(y),y.copy(t.next()),T===0?(c.subVectors(g,f),u.subVectors(b,m),c.dot(u)<0&&(u.multiplyScalar(-1),b.addVectors(m,u)),h.subVectors(p,_),u.dot(h)<0&&(h.multiplyScalar(-1),p.addVectors(_,h))):h.copy(d),d.subVectors(y,v),h.dot(d)<0&&(d.multiplyScalar(-1),y.addVectors(v,d)),this.interpolateNormalDir(f,m,_,v,g,b,p,y,n,r,s,M,l),M+=3*this.m;if(a&&(f.copy(e.get(A-2)),m.copy(e.get(A-1)),_.copy(e.get(0)),v.copy(e.get(1)),g.copy(t.get(A-2)),b.copy(t.get(A-1)),p.copy(t.get(0)),y.copy(t.get(1)),h.copy(d),d.subVectors(y,v),h.dot(d)<0&&(d.multiplyScalar(-1),y.addVectors(v,d)),this.interpolateNormalDir(f,m,_,v,g,b,p,y,n,r,s,M,l),M+=3*this.m),l){this.vBin.fromArray(s,3*this.m2),this.vNorm.fromArray(r,3*this.m2);for(var E=0;E<this.m2;++E)this.vBin.toArray(s,3*E),this.vNorm.toArray(r,3*E)}else this.vBin.toArray(s,M),this.vNorm.toArray(r,M)}interpolateColor(e,t,n,r,s){var o,a;for(o=0;o<this.m2;++o)a=s+3*o,n.apply(this,[e,r,a]);for(o=this.m2;o<this.m;++o)a=s+3*o,n.apply(this,[t,r,a])}getColor(e,t,n,r,s){let o;e.reset(),e.next();let a=e.next();for(var l=e.size,c=l-1,u=r||0,h=0;h<c;++h)o=a,a=e.next(),this.interpolateColor(o,a,t,n,u),u+=3*this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolateColor(o,a,t,n,u),u+=3*this.m),n[u]=n[u-3],n[u+1]=n[u-2],n[u+2]=n[u-1]}interpolatePicking(e,t,n,r,s){var o;for(o=0;o<this.m2;++o)r[s+o]=n.apply(this,[e]);for(o=this.m2;o<this.m;++o)r[s+o]=n.apply(this,[t])}getPicking(e,t,n,r,s){let o;e.reset(),e.next();let a=e.next();const l=e.size,c=l-1;let u=r||0;for(var h=0;h<c;++h)o=a,a=e.next(),this.interpolatePicking(o,a,t,n,u),u+=this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolatePicking(o,a,t,n,u),u+=this.m),n[u]=n[u-1]}interpolateSize(e,t,n,r,s){const o=n.apply(this,[e]),a=n.apply(this,[t]);for(let l=0;l<this.m;++l){let c=l/this.m;r[s+l]=(1-c)*o+c*a}}getSize(e,t,n,r,s){let o;e.reset(),e.next();let a=e.next();const l=e.size,c=l-1;let u=r||0;for(var h=0;h<c;++h)o=a,a=e.next(),this.interpolateSize(o,a,t,n,u),u+=this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolateSize(o,a,t,n,u),u+=this.m),n[u]=n[u-1]}}class jp{constructor(e,t){this.polymer=e,this.size=e.residueCount;var n=t||{};this.directional=n.directional||!1,this.positionIterator=n.positionIterator||!1,this.subdiv=n.subdiv||1,this.smoothSheet=n.smoothSheet||!1,n.tension?this.tension=n.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new Que(this.subdiv,this.tension)}getAtomIterator(e,t){const n=this.polymer,r=n.structure,s=n.residueCount;let o=0,a=-1;const l=[r.getAtomProxy(),r.getAtomProxy(),r.getAtomProxy(),r.getAtomProxy()],c=[new me,new me,new me,new me];var u=r.getAtomProxy(),h=r.getAtomProxy();function d(f){var m=l[o%4];if(m.index=n.getAtomIndexByType(f,e),t&&f>0&&f<s&&m.sstruc==="e"){var _=c[o%4];return u.index=n.getAtomIndexByType(f+1,e),h.index=n.getAtomIndexByType(f-1,e),_.addVectors(u,h).add(m).add(m).multiplyScalar(.25),o+=1,_}return o+=1,m}return{size:s,next:function(){var f=d(a);return a+=1,f},get:d,reset:function(){o=0,a=-1}}}getSubdividedColor(e){var t=this.subdiv,n=this.polymer,r=(n.residueCount-1)*t*3+3;n.isCyclic&&(r+=3*t);var s=new Float32Array(r),o=this.getAtomIterator("trace"),a=e||{};a.structure=n.structure;var l=gn.getScheme(a);return this.interpolator.getColor(o,function(c,u,h){l.atomColorToArray(c,u,h)},s,0,n.isCyclic),{color:s}}getSubdividedPicking(){var e=this.subdiv,t=this.polymer,n=(t.residueCount-1)*e+1;t.isCyclic&&(n+=e);var r=t.structure,s=this.getAtomIterator("trace"),o=new Float32Array(n);return this.interpolator.getPicking(s,function(a){return a.index},o,0,t.isCyclic),{picking:new Sd(o,r)}}getSubdividedPosition(){return{position:this.getPosition()}}getSubdividedOrientation(){const e=this.getTangent(),t=this.getNormals(e);return{tangent:e,normal:t.normal,binormal:t.binormal}}getSubdividedSize(e){var t=this.subdiv,n=this.polymer,r=(n.residueCount-1)*t+1;n.isCyclic&&(r+=t);var s=new Float32Array(r),o=this.getAtomIterator("trace"),a=new fc(e);return this.interpolator.getSize(o,function(l){return a.atomRadius(l)},s,0,n.isCyclic),{size:s}}getPosition(){const e=this.subdiv,t=this.polymer;let n=(t.residueCount-1)*e*3+3;t.isCyclic&&(n+=3*e);const r=new Float32Array(n),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(s,r,0,t.isCyclic),r}getTangent(){const e=this.subdiv,t=this.polymer;let n=(this.size-1)*e*3+3;t.isCyclic&&(n+=3*e);const r=new Float32Array(n),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(s,r,0,t.isCyclic),r}getNormals(e){const t=this.subdiv,n=this.polymer,r=n.isProtein(),s=this.size;let o=(s-1)*t*3+3;n.isCyclic&&(o+=3*t);const a=new Float32Array(o),l=new Float32Array(o);if(this.directional&&!this.polymer.isCg()){const c=this.getAtomIterator("direction1"),u=this.getAtomIterator("direction2");this.interpolator.getNormalDir(c,u,e,a,l,0,n.isCyclic,r)}else this.interpolator.getNormal(s,e,a,l,0,n.isCyclic);return{normal:a,binormal:l}}}const oU=new me,yy=new me,Jue=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},Ls);class ehe extends dc{constructor(e,t={}){super(function(n,r={}){const s=he(r.radialSegments,4),o=he(r.capped,!1),a=o?s:0,l=o?s-2:0,c=n.position.length/3,u=c*s*3+2*a*3,h=2*(c-1)*s*3+2*l*3;return{position:new Float32Array(u),color:new Float32Array(u),index:fl(h,u/3),normal:new Float32Array(u),picking:n.picking}}(e,t),t),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=e.position.length/3,e.primitiveId=lm(this.size2),this.setAttributes(e),this.makeIndex()}get defaultParameters(){return Jue}setAttributes(e={}){const t=this.parameters.aspectRatio,n=this.size2,r=n-1,s=this.parameters.radialSegments,o=this.geometry.attributes;let a,l,c,u,h,d,f,m,_,v,g,b,p;e.position&&(a=e.position,l=e.normal,c=e.binormal,u=e.tangent,d=e.size,m=o.position.array,v=o.normal.array,o.position.needsUpdate=!0,o.normal.needsUpdate=!0),e.color&&(h=e.color,_=o.color.array,o.color.needsUpdate=!0),e.primitiveId&&(f=e.primitiveId,g=o.primitiveId.array,o.primitiveId.needsUpdate=!0);let y=0,A=0,w=0,M=0,T=0,E=0,C=0,N=0,P=0,L=0;const R=[],F=[],V=[],z=[],U=[],G=[];if(a)for(let B=0;B<s;++B){const D=B/s*2*Math.PI;R[B]=t*Math.cos(D),F[B]=Math.sin(D),V[B]=t*Math.cos(D-.01),z[B]=Math.sin(D-.01),U[B]=t*Math.cos(D+.01),G[B]=Math.sin(D+.01)}for(let B=0;B<n;++B){b=3*B,p=b*s,a&&u&&l&&c&&d&&(oU.set(u[b],u[b+1],u[b+2]),A=l[b],w=l[b+1],M=l[b+2],T=c[b],E=c[b+1],C=c[b+2],N=a[b],P=a[b+1],L=a[b+2],y=d[B]);for(let D=0;D<s;++D){const O=p+3*D;if(a){const j=-y*R[D],q=y*F[D],Y=-y*V[D],ie=y*z[D],ne=-y*U[D],Q=y*G[D];m[O]=N+j*A+q*T,m[O+1]=P+j*w+q*E,m[O+2]=L+j*M+q*C,yy.set(ne*A+Q*T-(Y*A+ie*T),ne*w+Q*E-(Y*w+ie*E),ne*M+Q*C-(Y*M+ie*C)).cross(oU),v[O]=yy.x,v[O+1]=yy.y,v[O+2]=yy.z}h&&(_[O]=h[b],_[O+1]=h[b+1],_[O+2]=h[b+2]),f&&(g[B*s+D]=f[B])}}b=0,p=3*n*s;for(let B=0;B<s;++B){const D=b+3*B,O=p+3*B;a&&u&&(m[O]=m[D],m[O+1]=m[D+1],m[O+2]=m[D+2],v[O]=u[b],v[O+1]=u[b+1],v[O+2]=u[b+2]),h&&(_[O]=_[D],_[O+1]=_[D+1],_[O+2]=_[D+2]),f&&(g[n*s+B]=g[0+B])}b=3*(n-1)*s,p=3*(n+1)*s;for(let B=0;B<s;++B){const D=b+3*B,O=p+3*B;a&&u&&(m[O]=m[D],m[O+1]=m[D+1],m[O+2]=m[D+2],v[O]=u[3*r],v[O+1]=u[3*r+1],v[O+2]=u[3*r+2]),h&&(_[O]=_[D],_[O+1]=_[D+1],_[O+2]=_[D+2]),f&&(g[(n+1)*s+B]=g[(n-1)*s+B])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void tt.error("Index is null");const t=e.array,n=this.size2,r=n-1,s=this.capTriangles,o=this.parameters.radialSegments,a=this.parameters.radialSegments+1;let l,c;for(let h=0;h<r;++h){const d=h*o*3*2,f=h*o,m=(h+1)*o;for(let _=0;_<o;++_)c=d+3*_*2,t[c]=f+_,t[c+1]=f+(_+1)%o,t[c+2]=m+_,t[c+3]=m+_,t[c+4]=f+(_+1)%o,t[c+5]=m+(_+1)%o}const u=[0];for(let h=1;h<a/2;++h)u.push(h),o-h!==h&&u.push(o-h);c=r*o*3*2,l=n*o;for(let h=0;h<u.length-2;++h)h%2==0?(t[c+3*h+0]=l+u[h+0],t[c+3*h+1]=l+u[h+1],t[c+3*h+2]=l+u[h+2]):(t[c+3*h+0]=l+u[h+2],t[c+3*h+1]=l+u[h+1],t[c+3*h+2]=l+u[h+0]);c=r*o*3*2+3*s,l=n*o+o;for(let h=0;h<u.length-2;++h)h%2==0?(t[c+3*h+0]=l+u[h+0],t[c+3*h+1]=l+u[h+1],t[c+3*h+2]=l+u[h+2]):(t[c+3*h+0]=l+u[h+2],t[c+3*h+1]=l+u[h+1],t[c+3*h+2]=l+u[h+0])}}class n3 extends Br{constructor(e,t,n){super(e,t,n),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.colorScheme=he(t.colorScheme,"chainname"),t.colorScale=he(t.colorScale,"RdYlBu"),t.radiusType=he(t.radiusType,"sstruc"),t.radiusScale=he(t.radiusScale,.7),t.useInteriorColor=he(t.useInteriorColor,!0),this.aspectRatio=he(t.aspectRatio,5),this.tension=he(t.tension,NaN),this.capped=he(t.capped,!0),this.smoothSheet=he(t.smoothSheet,!1),t.quality==="low"?(this.subdiv=3,this.radialSegments=6):t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=he(t.subdiv,6),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:this.aspectRatio!==1,smoothSheet:this.smoothSheet},e)}getSpline(e){return new jp(e,this.getSplineParams())}getAspectRatio(e){return e.isCg()?1:this.aspectRatio}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){let t=[],n=[];return this.structure.eachPolymer(r=>{if(r.residueCount<4)return;n.push(r);const s=this.getSpline(r),o=this.getAspectRatio(r),a=s.getSubdividedPosition(),l=s.getSubdividedOrientation(),c=s.getSubdividedColor(this.getColorParams()),u=s.getSubdividedPicking(),h=s.getSubdividedSize(this.getRadiusParams());t.push(new ehe(Object.assign({},a,l,c,u,h),this.getBufferParams({radialSegments:this.radialSegments,aspectRatio:o,capped:this.capped})))},e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){pt&&tt.time(this.type+" repr update"),e=e||{};for(var n=0,r=t.polymerList.length;n<r;++n){var s={},o=t.polymerList[n],a=this.getSpline(o),l=this.getAspectRatio(o);if(Object.assign(t.bufferList[n],{aspectRatio:l}),e.position||e.radius){var c=a.getSubdividedPosition(),u=a.getSubdividedOrientation(),h=a.getSubdividedSize(this.getRadiusParams(l));s.position=c.position,s.normal=u.normal,s.binormal=u.binormal,s.tangent=u.tangent,s.size=h.size}if(e.color){var d=a.getSubdividedColor(this.getColorParams());s.color=d.color}if(e.picking){var f=a.getSubdividedPicking();s.picking=f.picking}t.bufferList[n].setAttributes(s)}pt&&tt.timeEnd(this.type+" repr update")}setParameters(e){var t={};return e&&e.aspectRatio&&(t.radius=!0),e&&e.tension&&(t.position=!0),super.setParameters(e,t,!1),this}}ti.add("cartoon",n3);class the extends Br{constructor(e,t,n){super(e,t,n),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusSize=he(t.radiusSize,.05),t.useInteriorColor=he(t.useInteriorColor,!0),this.hydrogenBond=he(t.hydrogenBond,!0),this.weakHydrogenBond=he(t.weakHydrogenBond,!1),this.waterHydrogenBond=he(t.waterHydrogenBond,!1),this.backboneHydrogenBond=he(t.backboneHydrogenBond,!1),this.hydrophobic=he(t.hydrophobic,!1),this.halogenBond=he(t.halogenBond,!0),this.ionicInteraction=he(t.ionicInteraction,!0),this.metalCoordination=he(t.metalCoordination,!0),this.cationPi=he(t.cationPi,!0),this.piStacking=he(t.piStacking,!0),this.filterSele=he(t.filterSele,""),this.labelVisible=he(t.labelVisible,!1),this.labelFixedSize=he(t.labelFixedSize,!1),this.labelSize=he(t.labelSize,2),this.labelUnit=he(t.labelUnit,""),this.maxHydrophobicDist=he(t.maxHydrophobicDist,4),this.maxHbondDist=he(t.maxHbondDist,3.5),this.maxHbondSulfurDist=he(t.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=he(t.maxHbondAccAngle,45),this.maxHbondDonAngle=he(t.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=he(t.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=he(t.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=he(t.maxPiStackingDist,5.5),this.maxPiStackingOffset=he(t.maxPiStackingOffset,2),this.maxPiStackingAngle=he(t.maxPiStackingAngle,30),this.maxCationPiDist=he(t.maxCationPiDist,6),this.maxCationPiOffset=he(t.maxCationPiOffset,2),this.maxIonicDist=he(t.maxIonicDist,5),this.maxHalogenBondDist=he(t.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=he(t.maxHalogenBondAngle,30),this.maxMetalDist=he(t.maxMetalDist,3),this.refineSaltBridges=he(t.refineSaltBridges,!0),this.masterModelIndex=he(t.masterModelIndex,-1),this.lineOfSightDistFactor=he(t.lineOfSightDistFactor,1),super.init(t)}getAtomRadius(){return 0}getContactData(e){const t={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},n={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return $le(Gle(e,t),e,n)}createData(e){const t=this.getContactData(e),n=[new vc(hle(t),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){const r={size:this.labelSize,unit:this.labelUnit};n.push(new dm(function(s,o){const a=ll(s.position1,s.position2),l=[],c=AS(s.position1,s.position2),u=c.length/3;for(let h=0;h<u;h++){const d=3*h,f=Math.sqrt(Math.pow(c[d],2)+Math.pow(c[d+1],2)+Math.pow(c[d+2],2));switch(o.unit){case"angstrom":l[h]=f.toFixed(2)+" Å";break;case"nm":l[h]=(f/10).toFixed(2)+" nm";break;default:l[h]=f.toFixed(2)}}return{position:a,size:Mo(a.length/3,o.size),color:s.color,text:l}}(t,r),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:n}}}ti.add("contact",the);class nhe extends JR{constructor(e,t,n){super(e,t,n),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=he(t.side,"double"),t.opacity=he(t.opacity,.5),this.atomQuad=he(t.atomQuad,[]),this.extendLine=he(t.extendLine,!0),this.lineVisible=he(t.lineVisible,!0),this.planeVisible=he(t.planeVisible,!0),this.sectorVisible=he(t.sectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomQuad.length)return;const t=function(a,l={}){const c=he(l.angleStep,Math.PI/90),u=a.length,h=a.length/12,d=new Float32Array(h),f=new Float32Array(3*h),m=new Array(h),_=new Array(h),v=new Array(h),g=new Array(h),b=new Array(h);let p=0,y=0,A=0;const w=en(),M=en(),T=en(),E=en(),C=en(),N=en(),P=en(),L=en(),R=en(),F=en(),V=en(),z=en(),U=en(),G=en(),B=en();let D=0;for(var O=0;O<u;O+=12){if(bs(w,a,O),bs(M,a,O+3),bs(T,a,O+6),bs(E,a,O+9),fi(C,w,M),fi(N,T,M),_u(N)===0)continue;fi(P,E,T),zn(L,N,.5),wa(R,M,L),Si(C,C),Si(N,N),Si(P,P),fi(L,w,R);const oe=Bs(L,N)>0;fi(L,E,R);const $=Bs(L,N)<0;if(zn(L,N,Bs(N,C)),fi(F,C,L),zn(L,N,Bs(N,P)),fi(V,P,L),_u(F)===0||_u(V)===0)continue;Si(F,F),Si(V,V);const pe=d[D]=ule(F,V);m[D]=(FG*pe).toFixed(1)+"°",Zs(G,F,N),Si(G,G),Bs(G,V)<0&&TS(G,G),va(L,R,F,G,pe/2),rn(L,f,3*D);const xe=Math.ceil(pe/c),Pe=xe+(l.extendLine?4:2),ve=l.extendLine?36:0,Ue=new Float32Array(3*Pe),Le=new Float32Array(3*Pe),Z=new Float32Array(9*xe),J=new Float32Array(ve);_[D]=Ue,v[D]=Le,g[D]=Z,b[D]=J,l.extendLine&&(oe?(fi(L,w,T),Si(L,L),zn(z,L,1/Bs(F,L)),wa(z,z,T)):(zn(z,C,1/Bs(F,C)),wa(z,z,M)),$?(fi(L,E,M),Si(L,L),zn(U,L,1/Bs(V,L)),wa(U,U,M)):(zn(U,P,1/Bs(V,P)),wa(U,U,T))),wa(B,R,F);let de=0;l.extendLine?(rn(w,Ue,de),rn(z,Le,de),de+=3,rn(z,Ue,de),rn(B,Le,de),de+=3,rn(z,J,0),rn(B,J,3),rn(oe?T:M,J,6),rn(oe?T:M,J,9),rn(B,J,12),rn(R,J,15)):(rn(R,Ue,de),rn(B,Le,de),de+=3);const Ie=function(X,ye){const ke=9*ye;rn(R,Z,ke),rn(B,Z,ke+3),rn(B,Ue,de),va(B,R,F,G,X),rn(B,Z,ke+6),rn(B,Le,de),de+=3};let te=0;for(let X=c;X<pe;X+=c)Ie(X,te++);Ie(pe,te++),l.extendLine?(rn(B,Ue,3*(Pe-2)),rn(U,Le,3*(Pe-2)),rn(U,Ue,3*(Pe-1)),rn(E,Le,3*(Pe-1)),rn(U,J,18),rn(B,J,21),rn($?M:T,J,24),rn($?M:T,J,27),rn(B,J,30),rn(R,J,33)):(rn(B,Ue,de),rn(R,Le,de),de+=3),p+=3*Pe,y+=9*xe,A+=ve,D+=1}const j=D,q=new Float32Array(p),Y=new Float32Array(p),ie=new Float32Array(y),ne=new Float32Array(A);let Q=0,le=0,se=0;for(let oe=0;oe<j;oe++){const $=_[oe],pe=v[oe],xe=g[oe],Pe=b[oe];er($,q,0,Q,$.length),er(pe,Y,0,Q,pe.length),er(xe,ie,0,le,xe.length),er(Pe,ne,0,se,Pe.length),Q+=$.length,le+=xe.length,se+=Pe.length}return{labelPosition:f.subarray(0,3*j),labelText:m.slice(0,j),linePosition1:q,linePosition2:Y,planePosition:ne,sectorPosition:ie}}(e3(e,this.atomQuad),{extendLine:this.extendLine}),n=this.n=t.labelText.length,r=new Ht(this.labelColor);this.textBuffer=new dm({position:t.labelPosition,size:Mo(n,this.labelSize),color:Bn(n,r.r,r.g,r.b),text:t.labelText},this.getLabelBufferParams());const s=new Ht(this.colorValue);this.lineLength=t.linePosition1.length/3;const o=Bn(this.lineLength,s.r,s.g,s.b);return this.lineBuffer=new pc(aC({position1:t.linePosition1,position2:t.linePosition2,color:o}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=t.planePosition.length/3,this.planeBuffer=new dc({position:t.planePosition,color:Bn(this.planeLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=t.sectorPosition.length/3,this.sectorBuffer=new dc({position:t.sectorPosition,color:Bn(this.sectorLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},r={},s={};if(e.color){const o=new Ht(this.colorValue);Object.assign(n,{color:Bn(this.lineLength,o.r,o.g,o.b),color2:Bn(this.lineLength,o.r,o.g,o.b)}),Object.assign(r,{color:Bn(this.planeLength,o.r,o.g,o.b)}),Object.assign(s,{color:Bn(this.sectorLength,o.r,o.g,o.b)})}this.lineBuffer.setAttributes(n),this.planeBuffer.setAttributes(r),this.sectorBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),!e||e.lineVisible===void 0&&e.sectorVisible===void 0&&e.planeVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&this.lineBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.lineBuffer.setParameters({linewidth:e.linewidth}),this}setVisibility(e,t){return super.setVisibility(e,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}ti.add("dihedral",nhe);function lA(i,e){function t(r,s){return s in r}const n=Object.assign({},i);for(const r in n)t(n,r)&&t(e,r)&&(n[r]=he(e[r],n[r]));return n}function ha(i,e){const t=new Ht(i),n=new Float32Array(3*e);return Bn(e,t.r,t.g,t.b,n),n}class ihe extends Br{constructor(e,t,n){super(e,t,n),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(n)}init(e){const t=e||{},n=lA({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},t);Object.assign(this,n);const r=lA({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},t);Object.assign(this,r),this.histogramsData.forEach(s=>{const o=lA(n,s);Object.assign(s,o)}),t.side=he(t.side,"double"),t.opacity=he(t.opacity,.5),t.radiusType=he(t.radiusType,"size"),t.radiusSize=he(t.radiusSize,.15),super.init(t)}getHistogramBinBorderBufferParameters(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})}getBondArrowsBufferParameters(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})}getOpaqueMiddleDiscBufferParameters(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})}getHistogramBufferParameters(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})}createData(e){if(!e.atomCount||!this.histogramsData.length)return;this.histogramsData.forEach(a=>a.atomPositions=e3(e,[a.atomQuad]));const t=this.scaleBinToSectorArea?function(a){return Math.sqrt(a)}:function(a){return a};function n(a){const l=a.map(h=>h.length),c=new Float32Array(BR(l));let u=0;for(let h=0;h<a.length;h++)c.set(a[h],u),u+=a[h].length;return c}function r(a,l){return new pc({position1:n(a.map(c=>c.startPoints)),position2:n(a.map(c=>c.endPoints)),color:n(a.map(c=>c.startColors)),color2:n(a.map(c=>c.endColors))},l)}function s(a,l){return new dc({position:n(a.map(c=>c.triangles)),color:n(a.map(c=>c.triangleColors))},l)}this.histogramsData.forEach(a=>a.histogram360Scaled=a.histogram360.map(t));const o=[];for(let a=0;a<this.histogramsData.length;a++){let l,c=this.histogramsData[a];c.histogram360.length>=3&&(l=rhe(c)),l!==void 0&&o.push(l)}return this.frontHistogramBinBordersBuffer=r(o.map(a=>a.frontHistogramBinBorders),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=r(o.map(a=>a.backHistogramBinBorders),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=r(o.map(a=>a.adjacentBondArrows),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=r(o.map(a=>a.distantBondArrows),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=s(o.map(a=>a.opaqueMiddleDisc),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=s(o.map(a=>a.frontHistogram),this.getHistogramBufferParameters()),this.backHistogramBuffer=s(o.map(a=>a.backHistogram),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}setParameters(e){return super.setParameters(e,{},!1),e&&e.histogramBinBorderVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),t||this.viewer.requestRender(),this}}function rhe(i){const e=i.atomPositions,t=i.histogram360Scaled,n=t.length<=180?360:2*t.length,r={triangles:new Float32Array(3*n*3),triangleColors:ha(i.opaqueMiddleDiscColor,3*n)},s={triangles:new Float32Array(3*t.length*3),triangleColors:ha(i.frontHistogramColor,3*t.length)},o={triangles:new Float32Array(3*t.length*3),triangleColors:ha(i.backHistogramColor,3*t.length)},a={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:ha(i.histogramBinBorderColor,t.length),endColors:ha(i.histogramBinBorderColor,t.length)},l={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:ha(i.histogramBinBorderColor,t.length),endColors:ha(i.histogramBinBorderColor,t.length)},c={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:ha(i.adjacentBondArrowColor,t.length),endColors:ha(i.adjacentBondArrowColor,t.length)},u={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:ha(i.distantBondArrowColor,t.length),endColors:ha(i.distantBondArrowColor,t.length)},h=en(),d=en(),f=en(),m=en(),_=en(),v=en(),g=en(),b=en(),p=en(),y=en(),A=en(),w=en(),M=en(),T=en(),E=en(),C=en(),N=[h,d,f,m];for(let G=0;G<N.length;G++)bs(N[G],e,3*G);if(fi(_,h,d),fi(v,f,d),fi(b,m,f),_u(v)===0||(zn(E,v,.5),wa(p,d,E),Si(_,_),Si(v,v),Si(b,b),TS(g,v),zn(E,g,Bs(g,_)),fi(y,_,E),zn(E,v,Bs(v,b)),fi(A,b,E),_u(y)===0||_u(A)===0))return;Si(y,y),Si(A,A);const P=Math.acos(Bs(y,A));Zs(w,g,y),Zs(M,v,A),Si(w,w),Si(M,M);let L=P;Bs(w,A)<0&&(L=-P),wa(T,p,y);const R=Math.max.apply(null,t),F=2*Math.PI/t.length;function V(G,B,D,O,j){const q=3*B*3;rn(p,G,q);const Y=Number(t[B])/R;zn(E,D,Y),zn(C,O,Y),va(T,p,E,C,B*j),rn(T,G,q+3),va(T,p,E,C,(B+1)*j),rn(T,G,q+6)}function z(G,B,D,O,j){er(p,c.startPoints,0,3*D,p.length),va(E,p,O,j,0+0*F),er(E,c.endPoints,0,3*D,p.length),er(p,u.startPoints,0,3*D,p.length),va(E,p,O,j,L),er(E,u.endPoints,0,3*D,p.length);for(let q=0;q<t.length;q++)er(p,B.startPoints,0,3*q,p.length),va(E,p,O,j,0+F*q),er(E,B.endPoints,0,3*q,E.length);for(let q=0;q<t.length;q++)V(G.triangles,q,O,j,F)}const U=2*Math.PI/n;for(let G=0;G<n;G++){const B=3*G*3;rn(p,r.triangles,B),va(T,p,y,w,G*U),rn(T,r.triangles,B+3),va(T,p,y,w,(G+1)*U),rn(T,r.triangles,B+6)}return zn(E,v,-.01),wa(p,p,E),z(s,a,0,y,w),zn(E,v,.02),wa(p,p,E),z(o,l,1,A,M),{opaqueMiddleDisc:r,frontHistogram:s,backHistogram:o,frontHistogramBinBorders:a,backHistogramBinBorders:l,adjacentBondArrows:c,distantBondArrows:u}}ti.add("dihedral-histogram",ihe);class she extends JR{constructor(e,t,n){super(e,t,n),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.linewidth=he(t.linewidth,5),t.radiusType=he(t.radiusType,"size"),t.radiusSize=he(t.radiusSize,.2),this.labelUnit=he(t.labelUnit,""),this.useCylinder=he(t.useCylinder,!1),this.atomPair=he(t.atomPair,[]),super.init(t)}getDistanceData(e,t){let n=t.length;const r=new Array(n);let s=new Float32Array(3*n);const o=new ei,a=new ei,l=new yx,c=e.getAtomProxy(),u=e.getAtomProxy();let h=0;const d=e.getAtomSet();t.forEach((m,_)=>{let v=m[0],g=m[1];if(typeof v=="number"&&Number.isInteger(v)&&typeof g=="number"&&Number.isInteger(g)){if(!d.get(v)||!d.get(g))return void(h+=1);c.index=v,u.index=g}else{o.setString(v),a.setString(g);var b=e.getAtomIndices(o),p=e.getAtomIndices(a);if(!b.length||!p.length)return void(h+=1);c.index=b[0],u.index=p[0]}l.addBond(c,u,1),_-=h;var y=c.distanceTo(u);switch(this.labelUnit){case"angstrom":r[_]=y.toFixed(2)+" Å";break;case"nm":r[_]=(y/10).toFixed(2)+" nm";break;default:r[_]=y.toFixed(2)}var A=3*_;s[A+0]=(c.x+u.x)/2,s[A+1]=(c.y+u.y)/2,s[A+2]=(c.z+u.z)/2}),h>0&&(n-=h,s=s.subarray(0,3*n));var f=new or(l.count,!0);return{text:r,position:s,bondSet:f,bondStore:l}}getBondData(e,t,n){const r=e.getBondData(this.getBondParams(t,n));return r.picking&&(r.picking=new qle(r.picking.array,r.picking.structure,n.bondStore)),r}createData(e){if(!e.atomCount||!this.atomPair.length)return;const t=this.atomPair.length,n=new Ht(this.labelColor),r=this.getDistanceData(e,this.atomPair);this.textBuffer=new dm({position:r.position,size:Mo(t,this.labelSize),color:Bn(t,n.r,n.g,n.b),text:r.text},this.getLabelBufferParams());const s={bondSet:r.bondSet,bondStore:r.bondStore},o=this.getBondData(e,{position:!0,color:!0,picking:!0,radius:this.useCylinder},s);return this.useCylinder?this.distanceBuffer=new vc(o,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new pc(zG(o),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:r.bondSet,bondStore:r.bondStore,position:r.position,bufferList:[this.textBuffer,this.distanceBuffer]}}updateData(e,t){super.updateData(e,t);const n={bondSet:t.bondSet,bondStore:t.bondStore},r=this.getBondData(t.sview,e,n),s={};e&&!e.color||Object.assign(s,{color:r.color,color2:r.color2}),e&&!e.radius||Object.assign(s,{radius:r.radius}),this.distanceBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),this.useCylinder||(e&&e.lineOpacity&&this.distanceBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.distanceBuffer.setParameters({linewidth:e.linewidth})),this}}function cA(i){return 2*(i.position.length/3)*3}ti.add("distance",she);const ohe=Object.assign({scale:1,color:"grey"},Ls);class aU extends pl{constructor(e,t={}){super({position:new Float32Array(cA(e)),color:new Float32Array(cA(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";const n=new Ht(this.parameters.color),r=this.geometry.attributes;Bn(cA(e)/3,n.r,n.g,n.b,r.color.array),this.setAttributes(e)}get defaultParameters(){return ohe}setAttributes(e={}){const t=this.geometry.attributes;let n,r,s;e.position&&e.vector&&(n=e.position,r=e.vector,s=t.position.array,t.position.needsUpdate=!0);const o=this.size/2,a=this.parameters.scale;if(n&&r)for(let l=0;l<o;l++){const c=2*l*3,u=3*l;s[c+0]=n[u+0],s[c+1]=n[u+1],s[c+2]=n[u+2],s[c+3]=n[u+0]+r[u+0]*a,s[c+4]=n[u+1]+r[u+1]*a,s[c+5]=n[u+2]+r[u+2]*a}}}class ahe extends Br{constructor(e,t,n){super(e,t,n),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){const t=e||{};t.colorScheme=he(t.colorScheme,"sstruc"),t.radiusType=he(t.radiusType,"size"),t.radiusSize=he(t.radiusSize,.15),t.radiusScale=he(t.radiusScale,1),t.useInteriorColor=he(t.useInteriorColor,!0),super.init(t)}createData(e){const t=[],n=[];return this.structure.eachPolymer(r=>{if(r.residueCount<4)return;n.push(r);const s=new pb(r),o=s.getPosition(),a=s.getColor(this.getColorParams()),l=s.getSize(this.getRadiusParams()),c=s.getPicking();t.push(new ku({position:o.center,color:a.color,radius:l.size,picking:c.picking},this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),new aU({position:o.center,vector:o.axis},this.getBufferParams({color:"skyblue",scale:1})),new aU({position:o.center,vector:o.resdir},this.getBufferParams({color:"lightgreen",scale:1})))},e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){pt&&tt.time(this.type+" repr update"),e=e||{};for(let n=0,r=t.polymerList.length;n<r;++n){const s=3*n,o={},a=t.polymerList[n],l=new pb(a);if(e.position){const c=l.getPosition();Object.assign(o,{position:c.center}),t.bufferList[s+1].setAttributes({position:c.center,vector:c.axis}),t.bufferList[s+2].setAttributes({position:c.center,vector:c.resdir})}t.bufferList[s].setAttributes(o)}pt&&tt.timeEnd(this.type+" repr update")}}ti.add("helixorient",ahe);class CV extends BS{constructor(e,t,n){super(e,t,n),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,super.init(t)}}ti.add("licorice",CV),An.add("shader/HyperballStickImpostor.vert",`
attribute vec3 mapping;
attribute float radius;
attribute float radius2;
attribute vec3 position1;
attribute vec3 position2;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform float shrink;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewProjectionMatrixInverse;
void main(){
vRadius = radius;
vRadius2 = radius2;
vec4 spaceposition;
vec3 position_atom1;
vec3 position_atom2;
vec4 vertex_position;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
float radius1 = radius;
position_atom1 = position1;
position_atom2 = position2;
float distance = distance( position_atom1, position_atom2 );
spaceposition.z = mapping.z * distance;
if (radius1 > radius2) {
spaceposition.y = mapping.y * 1.5 * radius1;
spaceposition.x = mapping.x * 1.5 * radius1;
} else {
spaceposition.y = mapping.y * 1.5 * radius2;
spaceposition.x = mapping.x * 1.5 * radius2;
}
spaceposition.w = 1.0;
vec4 e3 = vec4( 1.0 );
vec3 e1, e1_temp, e2, e2_temp;
e3.xyz = normalize(position_atom1-position_atom2);
if (e3.z == 0.0) { e3.z = 0.0000000000001;}
if ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}
if ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}
if ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}
vec4 focus = vec4( 1.0 );
focus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +
( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));
focus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +
( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));
focus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +
( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;
e2 = normalize(e2_temp);
mat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );
vertex_position.xyz = R * spaceposition.xyz;
vertex_position.w = 1.0;
vertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;
vertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;
vertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;
gl_Position = modelViewProjectionMatrix * vertex_position;
vec4 i_near, i_far;
vec4 near = gl_Position;
near.z = 0.0 ;
near = modelViewProjectionMatrixInverse * near;
i_near = near;
vec4 far = gl_Position;
far.z = far.w ;
i_far = modelViewProjectionMatrixInverse * far;
prime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );
prime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );
float Rsquare = (radius1*radius1/shrink) - (
(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +
(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +
(position_atom1.z - focus.z)*(position_atom1.z - focus.z)
);
focus.w = Rsquare;
matrix_near = mat4( i_near, i_far, focus, e3 );
gl_Position.z = 1.0;
}`),An.add("shader/HyperballStickImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float shrink;
uniform mat4 modelViewMatrix;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewMatrixInverseTranspose;
uniform mat4 projectionMatrix;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float calcClip( vec4 cameraPos ){
return dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
float calcClip( vec3 cameraPos ){
return calcClip( vec4( cameraPos, 1.0 ) );
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
struct Ray {
vec3 origin ;
vec3 direction ;
};
bool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){
float a = x3.x;
float b = x3.y;
float c = x3.z;
float d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;
float l = a*M.x+b*M.y+c*M.z+d;
if (l<0.0) {return true;}
else{return false;}
}
vec3 isect_surf(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t1 =(-b-sqrt(delta))/a;
return r.origin+t1*r.direction;
}
vec3 isect_surf2(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t2 =(-b+sqrt(delta))/a;
return r.origin+t2*r.direction;
}
Ray primary_ray(vec4 near1, vec4 far1){
vec3 near=near1.xyz/near1.w;
vec3 far=far1.xyz/far1.w;
return Ray(near,far-near);
}
float update_z_buffer(vec3 M, mat4 ModelViewP){
float depth1;
vec4 Ms=(ModelViewP*vec4(M,1.0));
return depth1=(1.0+Ms.z/Ms.w)/2.0;
}
void main(){
float radius = max( vRadius, vRadius2 );
vec4 i_near, i_far, focus;
vec3 e3, e1, e1_temp, e2;
i_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);
i_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);
focus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);
e3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2 = normalize(cross(e1,e3));
vec4 equation = focus;
float shrinkfactor = shrink;
float t1 = -1.0/(1.0-shrinkfactor);
float t2 = 1.0/(shrinkfactor);
vec4 colonne1, colonne2, colonne3, colonne4;
mat4 mat;
vec3 equation1 = vec3(t2,t2,t1);
float A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;
float A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;
float A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;
float A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;
float A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;
float A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;
float A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;
float A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;
float A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;
float A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;
float A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;
float A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;
float A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;
colonne1 = vec4(A11,A21,A31,A41);
colonne2 = vec4(A21,A22,A32,A42);
colonne3 = vec4(A31,A32,A33,A43);
colonne4 = vec4(A41,A42,A43,A44);
mat = mat4(colonne1,colonne2,colonne3,colonne4);
Ray ray = primary_ray(i_near,i_far) ;
vec3 M;
M = isect_surf(ray, mat);
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
vec4 M1 = vec4(M,1.0);
vec4 M2 = mat*M1;
vec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
#ifdef NEAR_CLIP
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){
M = isect_surf2(ray, mat);
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )
discard;
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#endif
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
float distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /
distance(prime2.xyz,prime1.xyz);
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;
vec3 vNormal = _normal;
vec3 vColor;
if( distance_ratio>0.5 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const lhe=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),che=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);class uhe extends YR{constructor(e,t={}){super("v3",e,t)}get mapping(){return lhe}get mappingIndices(){return che}get mappingIndicesSize(){return 36}get mappingSize(){return 8}get mappingItemSize(){return 3}}const PV=Object.assign({shrink:.14},Ls),hhe=Object.assign({shrink:{uniform:!0}},wd);class dhe extends uhe{constructor(e,t={}){super(e,t),this.parameterTypes=hhe,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new Tt},modelViewProjectionMatrixInverse:{value:new Tt},modelViewMatrixInverseTranspose:{value:new Tt},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return PV}}Object.assign({disableImpostor:!1},t3,PV);const fhe=class{constructor(i,e={}){return!al||e&&e.disableImpostor?(i.radius=function(t,n){const r=t.length,s=new Float32Array(r);for(let o=0;o<r;o++)s[o]=Math.min(t[o],n[o]);return s}(i.radius,i.radius2),new EV(i,e)):new dhe(i,e)}};class phe extends CV{constructor(e,t,n){super(e,t,n),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){var t=e||{};t.radiusScale=he(t.radiusScale,.2),t.radiusType=he(t.radiusType,"vdw"),t.useInteriorColor=he(t.useInteriorColor,!0),this.shrink=he(t.shrink,.12),super.init(t)}getBondParams(e,t){return e&&!e.radius||(t=Object.assign({radius2:!0},t)),super.getBondParams(e,t)}createData(e){var t=new ku(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*e.bondCount),{bufferList:[t,new fhe(e.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams()),r=t.sview.getBondData(this.getBondParams()),s={},o={};if(!e||e.position){Object.assign(s,{position:n.position});var a=r.position1,l=r.position2;Object.assign(o,{position:ll(a,l,this.__center),position1:a,position2:l})}e&&!e.color||(Object.assign(s,{color:n.color}),Object.assign(o,{color:r.color,color2:r.color2})),e&&!e.radius||(Object.assign(s,{radius:n.radius}),Object.assign(o,{radius:r.radius,radius2:r.radius2})),t.bufferList[0].setAttributes(s),t.bufferList[1].setAttributes(o)}}ti.add("hyperball",phe);class mC{constructor(e,t={},n=""){this.type=e,this.text=t,this.format=n,this.errorLogged=!1}atomLabel(e){let t;switch(this.type){case"atomname":t=e.atomname;break;case"atomindex":t=`${e.index}`;break;case"occupancy":t=e.occupancy.toFixed(2);break;case"bfactor":t=e.bfactor.toFixed(2);break;case"serial":t=`${e.serial}`;break;case"element":t=e.element;break;case"atom":t=`${e.atomname}|${e.index}`;break;case"resname":t=e.resname;break;case"resno":t=`${e.resno}`;break;case"res":t=`${db[e.resname.toUpperCase()]||e.resname}${e.resno}`;break;case"residue":const n=db[e.resname.toUpperCase()];t=n&&!e.inscode?`${n}${e.resno}`:`[${e.resname}]${e.resno}${e.inscode}`;break;case"text":t=this.text[e.index];break;case"format":try{t=SG.sprintf(this.format,e)}catch(r){this.errorLogged||(this.errorLogged=!0,console.log(r.message))}break;default:t=e.qualifiedName()}return t===void 0?"":t}}mC.types={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"};class mhe extends Br{constructor(e,t,n){super(e,t,n),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:mC.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(n)}init(e){const t=e||{};this.labelType=he(t.labelType,"res"),this.labelText=he(t.labelText,{}),this.labelFormat=he(t.labelFormat,""),this.labelGrouping=he(t.labelGrouping,"atom"),this.fontFamily=he(t.fontFamily,"sans-serif"),this.fontStyle=he(t.fontStyle,"normal"),this.fontWeight=he(t.fontWeight,"bold"),this.xOffset=he(t.xOffset,0),this.yOffset=he(t.yOffset,0),this.zOffset=he(t.zOffset,.5),this.attachment=he(t.attachment,"bottom-left"),this.showBorder=he(t.showBorder,!1),this.borderColor=he(t.borderColor,"lightgrey"),this.borderWidth=he(t.borderWidth,.15),this.showBackground=he(t.showBackground,!1),this.backgroundColor=he(t.backgroundColor,"lightgrey"),this.backgroundMargin=he(t.backgroundMargin,.5),this.backgroundOpacity=he(t.backgroundOpacity,1),this.fixedSize=he(t.fixedSize,!1),super.init(t)}getTextData(e,t){const n=this.getAtomParams(t),r=new mC(this.labelType,this.labelText,this.labelFormat);let s,o,a,l,c,u,h;if(this.labelGrouping==="atom"){const d=e.getAtomData(n);s=d.position,o=d.radius,a=d.color,t&&!t.text||(l=[],e.eachAtom(f=>l.push(r.atomLabel(f))))}else if(this.labelGrouping==="residue"){t&&!t.position||(c=[]),t&&!t.color||(h=[]),t&&!t.radius||(u=[]),t&&!t.text||(l=[]),n.colorParams&&(n.colorParams.structure=e.getStructure());const d=gn.getScheme(n.colorParams),f=new fc(n.radiusParams),m=e.getAtomProxy();let _=0;e.eachResidue(v=>{const g=3*_;v.isProtein()||v.isNucleic()?(m.index=v.traceAtomIndex,t&&!t.position||m.positionToArray(c,g)):(m.index=v.atomOffset,t&&!t.position||v.positionToArray(c,g)),t&&!t.color||d.atomColorToArray(m,h,g),t&&!t.radius||(u[_]=f.atomRadius(m)),t&&!t.text||l.push(r.atomLabel(m)),++_}),t&&!t.position||(s=new Float32Array(c)),t&&!t.color||(a=new Float32Array(h)),t&&!t.radius||(o=new Float32Array(u))}return{position:s,size:o,color:a,text:l}}createData(e){return{bufferList:[new dm(this.getTextData(e,{position:!0,color:!0,radius:!0,text:!0}),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}}updateData(e,t){t.bufferList[0].setAttributes(this.getTextData(t.sview,e))}getAtomRadius(){return 0}}function ghe(i){const e=i.getAtomSet(),t=i.getBondSet(),n=i.getBondProxy();return t.forEach(function(r){n.index=r,e.clear(n.atomIndex1),e.clear(n.atomIndex2)}),e}ti.add("label",mhe);class vhe extends Br{constructor(e,t,n){super(e,t,n),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.multipleBond=he(t.multipleBond,"off"),this.bondSpacing=he(t.bondSpacing,1),this.linewidth=he(t.linewidth,2),this.lines=he(t.lines,!0),this.crosses=he(t.crosses,"lone"),this.crossSize=he(t.crossSize,.4),super.init(t)}getAtomRadius(e){return .1}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},t),super.getBondParams(e,t)}_crossData(e,t){if(e&&!e.position&&!e.color)return;const n={};this.crosses==="lone"&&Object.assign(n,{atomSet:ghe(t)});const r=t.getAtomData(this.getAtomParams(e,n)),s={},o=r.position,a=r.color,l=r.picking,c=(o||a).length,u=3*c;let h=new Float32Array(0),d=new Float32Array(0),f=new Float32Array(0),m=new Float32Array(0),_=0,v=new Float32Array(0);e&&!e.position||(h=s.position1=new Float32Array(u),d=s.position2=new Float32Array(u),_=this.crossSize/2),e&&!e.color||(f=s.color=new Float32Array(u),m=s.color2=new Float32Array(u)),e&&!e.picking||(v=new Float32Array(3*r.picking.array.length));for(let g=0;g<c;g++){const b=3*g,p=3*b;if(!e||e.position){const y=o[b],A=o[b+1],w=o[b+2];h[p]=y-_,h[p+1]=A,h[p+2]=w,d[p]=y+_,d[p+1]=A,d[p+2]=w,h[p+3]=y,h[p+4]=A-_,h[p+5]=w,d[p+3]=y,d[p+4]=A+_,d[p+5]=w,h[p+6]=y,h[p+7]=A,h[p+8]=w-_,d[p+6]=y,d[p+7]=A,d[p+8]=w+_}if(!e||e.color){const y=p+9;for(let A=p;A<y;A+=3)f[A]=m[A]=a[b],f[A+1]=m[A+1]=a[b+1],f[A+2]=m[A+2]=a[b+2]}e&&!e.picking||(v[b]=v[b+1]=v[b+2]=l.array[g])}return e&&!e.picking||(s.picking=new Sd(v,l.structure)),s}createData(e){const t={position:!0,color:!0,picking:!0},n=[];if(this.lines){const r=e.getBondData(this.getBondParams(t)),s=new pc(r,this.getBufferParams({linewidth:this.linewidth}));n.push(s)}if(this.crosses!=="off"){const r=new pc(this._crossData(t,e),this.getBufferParams({linewidth:this.linewidth}));n.push(r)}return{bufferList:n}}updateData(e,t){let n=0;if(this.lines){const r=t.sview.getBondData(this.getBondParams(e)),s={};e&&!e.position||Object.assign(s,{position1:r.position1,position2:r.position2}),e&&!e.color||Object.assign(s,{color:r.color,color2:r.color2}),t.bufferList[n++].setAttributes(s)}if(this.crosses!=="off"){const r=this._crossData(e,t.sview),s={};e&&!e.position||Object.assign(s,{position1:r.position1,position2:r.position2}),e&&!e.color||Object.assign(s,{color:r.color,color2:r.color2}),t.bufferList[n++].setAttributes(s)}}setParameters(e){var t={};return e&&(e.bondSpacing||e.crossSize)&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}function RV(i,e,t,n,r){const s=new(n=n||Int32Array)(i*e*t*(r=r||1));function o(a,l,c){return((a*e+l)*t+c)*r}return{data:s,index:o,set:function(a,l,c,...u){const h=o(a,l,c);for(let d=0;d<r;++d)s[h+d]=u[d]},toArray:function(a,l,c,u=[],h=0){const d=o(a,l,c);for(let f=0;f<r;++f)u[h+f]=s[d+f]},fromArray:function(a,l,c,u,h=0){const d=o(a,l,c);for(let f=0;f<r;++f)s[d+f]=u[h+f]},copy:function(a){s.set(a.data)}}}function xx(i,e,t){var n=iV(e),r=Z0(i);i.length===0&&(r[0].set([0,0,0]),r[1].set([0,0,0]));var s,o,a,l,c,u,h,d,f,m,_,v,g,b,p,y=r[0],A=r[1];function w(z,U,G,B,D){s=U||1.4,o=G||2,v=D||!0;var O=0;for(var j in n)O=Math.max(O,j);var q=n1(y,A,O,o,z?s:0);l=q.dim[0],c=q.dim[1],u=q.dim[2],h=q.matrix,d=q.tran,o=q.scaleFactor,f={},m={},N(z),_=s*o,a=B||s/o,g=new Uint8Array(l*c*u),z&&(b=new Float64Array(l*c*u)),v&&(p=new Int32Array(l*c*u))}var M=1,T=2,E=4,C=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function N(z){var U,G,B,D,O,j,q,Y,ie,ne;for(var Q in n)if(U=parseFloat(Q),!f[Q]){for(j=(q=z?(U+s)*o+.5:U*o+.5)*q,Y=Math.floor(q)+1,ie=new Int32Array(Y*Y),ne=0,G=0;G<Y;++G)for(B=0;B<Y;++B)(D=G*G+B*B)>j?ie[ne]=-1:(O=Math.sqrt(j-D),ie[ne]=Math.floor(O)),++ne;m[Q]=Y,f[Q]=ie}}function P(z){var U,G,B,D,O,j,q,Y,ie,ne,Q,le,se,oe,$,pe,xe,Pe,ve=3*z,Ue=z;U=Math.floor(.5+o*(i[ve]+d[0])),G=Math.floor(.5+o*(i[ve+1]+d[1])),B=Math.floor(.5+o*(i[ve+2]+d[2]));var Le,Z=e[Ue],J=f[Z],de=0,Ie=c*u,te=m[Z];for(ne=0;ne<te;++ne)for(Q=0;Q<te;++Q){if((Le=J[de])!==-1){for(pe=-1;pe<2;++pe)for(xe=-1;xe<2;++xe)for(Pe=-1;Pe<2;++Pe)if(pe!==0&&xe!==0&&Pe!==0){for(q=pe*ne,ie=Pe*Q,le=0;le<=Le;++le)if(oe=G+(Y=le*xe),$=B+ie,!((se=U+q)<0||oe<0||$<0||se>=l||oe>=c||$>=u)){var X=se*Ie+oe*u+$;if(v)if(g[X]&M){if(g[X]&M){var ye=p[X];ye!==ve&&q*q+Y*Y+ie*ie<(D=U+q-Math.floor(.5+o*(i[ye]+d[0])))*D+(O=G+Y-Math.floor(.5+o*(i[ye+1]+d[1])))*O+(j=B+ie-Math.floor(.5+o*(i[ye+2]+d[2])))*j&&(p[X]=z)}}else g[X]|=M,p[X]=z;else g[X]|=M}}}de++}}function L(z){var U,G;for(console.time("EDTSurface fillvoxels"),U=0,G=g.length;U<G;++U)g[U]=0,z&&(b[U]=-1),v&&(p[U]=-1);for(U=0,G=i.length/3;U<G;++U)P(U);for(U=0,G=g.length;U<G;++U)g[U]&M&&(g[U]|=T);console.timeEnd("EDTSurface fillvoxels")}function R(z){var U,G,B,D,O,j,q,Y,ie,ne,Q,le,se,oe,$,pe,xe,Pe,ve,Ue=3*z,Le=z,Z=0;U=Math.floor(.5+o*(i[Ue]+d[0])),G=Math.floor(.5+o*(i[Ue+1]+d[1])),B=Math.floor(.5+o*(i[Ue+2]+d[2]));var J=e[Le],de=c*u;for(se=0,ve=m[J];se<ve;++se)for(oe=0;oe<ve;++oe){if(f[J][Z]!==-1){for(pe=-1;pe<2;++pe)for(xe=-1;xe<2;++xe)for(Pe=-1;Pe<2;++Pe)if(pe!==0&&xe!==0&&Pe!==0){for(q=pe*se,ie=Pe*oe,$=0;$<=f[J][Z];++$)if(Q=G+(Y=$*xe),le=B+ie,!((ne=U+q)<0||Q<0||le<0||ne>=l||Q>=c||le>=u)){var Ie=ne*de+Q*u+le;if(g[Ie]&T){if(v){var te=p[Ie];q*q+Y*Y+ie*ie<(D=Math.floor(.5+o*(i[te]+d[0])))*D+(O=Math.floor(.5+o*(i[te+1]+d[1])))*O+(j=Math.floor(.5+o*(i[te+2]+d[2])))*j&&(p[Ie]=z)}}else g[Ie]|=T,v&&(p[Ie]=z)}}}Z++}}function F(){var z,U,G,B;console.time("EDTSurface fastdistancemap");var D,O=RV(l,c,u,Uint16Array,3),j=c*u,q=_*_,Y=0;for(z=0;z<l;++z)for(U=0;U<c;++U)for(G=0;G<u;++G)g[D=z*j+U*u+G]&=~T,g[D]&M&&g[D]&E&&(O.set(z,U,G,z,U,G),b[D]=0,g[D]|=T,Y+=1);var ie=new Int32Array(3*Y),ne=0,Q=new Int32Array(3*Y),le=0;for(z=0;z<l;++z)for(U=0;U<c;++U)for(G=0;G<u;++G)g[D=z*j+U*u+G]&E&&(ie[ne]=z,ie[ne+1]=U,ie[ne+2]=G,ne+=3,g[D]&=~E);do for(le=V(ie,O,ne,Q),ne=0,z=0,B=le;z<B;z+=3)D=j*Q[z]+u*Q[z+1]+Q[z+2],g[D]&=~E,b[D]<=1.0404*q&&(ie[ne]=Q[z],ie[ne+1]=Q[z+1],ie[ne+2]=Q[z+2],ne+=3);while(ne>0);var se,oe=a*a,$=new Uint16Array(3);for(z=0;z<l;++z)for(U=0;U<c;++U)for(G=0;G<u;++G)g[D=z*j+U*u+G]&=~E,g[D]&M&&(g[D]&T&&!(g[D]&T&&b[D]>=oe)||(g[D]|=E,v&&g[D]&T&&(O.toArray(z,U,G,$),se=$[0]*j+$[1]*u+$[2],p[D]=p[se])));console.timeEnd("EDTSurface fastdistancemap")}function V(z,U,G,B){var D,O,j,q,Y,ie,ne,Q,le,se,oe,$,pe=new Uint16Array(3),xe=0;if(G===0)return xe;var Pe=-1,ve=-1,Ue=-1,Le=c*u;for(ne=0,le=G;ne<le;ne+=3)for(D=z[ne],O=z[ne+1],j=z[ne+2],U.toArray(D,O,j,pe),Q=0;Q<6;++Q)Pe=D+($=C[Q])[0],ve=O+$[1],Ue=j+$[2],Pe<l&&Pe>-1&&ve<c&&ve>-1&&Ue<u&&Ue>-1&&(g[oe=Pe*Le+u*ve+Ue]&M&&!(g[oe]&T)?(U.fromArray(Pe,ve,Ue,pe),se=(q=Pe-pe[0])*q+(Y=ve-pe[1])*Y+(ie=Ue-pe[2])*ie,b[oe]=se,g[oe]|=T,g[oe]|=E,B[xe]=Pe,B[xe+1]=ve,B[xe+2]=Ue,xe+=3):g[oe]&M&&g[oe]&T&&(se=(q=Pe-pe[0])*q+(Y=ve-pe[1])*Y+(ie=Ue-pe[2])*ie)<b[oe]&&(U.fromArray(Pe,ve,Ue,pe),b[oe]=se,g[oe]&E||(g[oe]|=E,B[xe]=Pe,B[xe+1]=ve,B[xe+2]=Ue,xe+=3)));for(ne=0,le=G;ne<le;ne+=3)for(D=z[ne],O=z[ne+1],j=z[ne+2],U.toArray(D,O,j,pe),Q=6;Q<18;Q++)Pe=D+($=C[Q])[0],ve=O+$[1],Ue=j+$[2],Pe<l&&Pe>-1&&ve<c&&ve>-1&&Ue<u&&Ue>-1&&(g[oe=Pe*Le+u*ve+Ue]&M&&!(g[oe]&T)?(U.fromArray(Pe,ve,Ue,pe),se=(q=Pe-pe[0])*q+(Y=ve-pe[1])*Y+(ie=Ue-pe[2])*ie,b[oe]=se,g[oe]|=T,g[oe]|=E,B[xe]=Pe,B[xe+1]=ve,B[xe+2]=Ue,xe+=3):g[oe]&M&&g[oe]&T&&(se=(q=Pe-pe[0])*q+(Y=ve-pe[1])*Y+(ie=Ue-pe[2])*ie)<b[oe]&&(U.fromArray(Pe,ve,Ue,pe),b[oe]=se,g[oe]&E||(g[oe]|=E,B[xe]=Pe,B[xe+1]=ve,B[xe+2]=Ue,xe+=3)));for(ne=0,le=G;ne<le;ne+=3)for(D=z[ne],O=z[ne+1],j=z[ne+2],U.toArray(D,O,j,pe),Q=18;Q<26;Q++)Pe=D+($=C[Q])[0],ve=O+$[1],Ue=j+$[2],Pe<l&&Pe>-1&&ve<c&&ve>-1&&Ue<u&&Ue>-1&&(g[oe=Pe*Le+u*ve+Ue]&M&&!(g[oe]&T)?(U.fromArray(Pe,ve,Ue,pe),se=(q=Pe-pe[0])*q+(Y=ve-pe[1])*Y+(ie=Ue-pe[2])*ie,b[oe]=se,g[oe]|=T,g[oe]|=E,B[xe]=Pe,B[xe+1]=ve,B[xe+2]=Ue,xe+=3):g[oe]&M&&g[oe]&T&&(se=(q=Pe-pe[0])*q+(Y=ve-pe[1])*Y+(ie=Ue-pe[2])*ie)<b[oe]&&(U.fromArray(Pe,ve,Ue,pe),b[oe]=se,g[oe]&E||(g[oe]|=E,B[xe]=Pe,B[xe+1]=ve,B[xe+2]=Ue,xe+=3)));return xe}this.getVolume=function(z,U,G,B,D){console.time("EDTSurface.getVolume");var O=z!=="vws";w(O,U,G,B,D),L(O),function(){var Y,ie,ne,Q=c*u;for(Y=0;Y<l;++Y)for(ie=0;ie<u;++ie)for(ne=0;ne<c;++ne){var le=Y*Q+ne*u+ie;if(g[le]&M)for(var se=0;se<26;){var oe=Y+C[se][0],$=ie+C[se][2],pe=ne+C[se][1];if(oe>-1&&oe<l&&pe>-1&&pe<c&&$>-1&&$<u&&!(g[oe*Q+pe*u+$]&M)){g[le]|=E;break}se++}}}(),z!=="ms"&&z!=="ses"||F(),z==="ses"&&(N(!1),function(){var Y,ie;for(Y=0,ie=g.length;Y<ie;++Y)g[Y]&=~T;for(Y=0,ie=i.length/3;Y<ie;++Y)R(Y)}()),function(Y){var ie,ne=g.length;if(Y==="vws")for(ie=0;ie<ne;++ie)g[ie]&=~E,g[ie]=g[ie]&T?1:0;else if(Y==="ms")for(ie=0;ie<ne;++ie)g[ie]&=~T,g[ie]&E&&(g[ie]|=T),g[ie]&=~E,g[ie]=g[ie]&T?1:0;else if(Y==="ses")for(ie=0;ie<ne;++ie)g[ie]&E&&g[ie]&T?g[ie]&=~E:g[ie]&E&&!(g[ie]&T)&&(g[ie]|=T),g[ie]=g[ie]&T?1:0;else if(Y==="sas")for(ie=0;ie<ne;++ie)g[ie]&=~E,g[ie]=g[ie]&T?1:0}(z);for(var j=0,q=p.length;j<q;++j)p[j]=t[p[j]];return console.timeEnd("EDTSurface.getVolume"),{data:g,nx:u,ny:c,nz:l,atomindex:p}},this.getSurface=function(z,U,G,B,D,O,j){var q=this.getVolume(z,U,G,B,D);return new yu(q.data,q.nx,q.ny,q.nz,q.atomindex).getSurface(1,O,void 0,h,j)}}function IV(i,e,t,n,r,s,o){o=Math.max(.1,o);var a=i.length,l=r[0],c=r[1],u=r[2],h=s[0],d=s[1],f=s[2];function m(G,B){return Math.floor((G-B)/o)}for(var _,v,g,b=m(h,l)+1,p=m(d,c)+1,y=m(f,u)+1,A=b*p*y,w=p*y,M=[],T=0;T<a;T++){var E=(_=i[T],v=e[T],g=t[T],(m(_,l)*p+m(v,c))*y+m(g,u));M[E]===void 0?M[E]=[T]:M[E].push(T)}var C=new Uint32Array(A),N=new Uint16Array(A),P=new Uint32Array(a),L=0,R=0;for(T=0;T<A;T++){var F=C[T]=L,V=M[T];if(V!==void 0)for(var z=0;z<V.length;z++)P[L]=V[z],L++;var U=L-F;N[T]=U,U>R&&(R=U)}return{neighbourListLength:27*R+1,withinRadii:function(G,B,D,O,j){for(var q=0,Y=m(G,l),ie=m(B,c),ne=m(D,u),Q=Math.max(0,Y-1),le=Math.max(0,ie-1),se=Math.max(0,ne-1),oe=Math.min(b,Y+2),$=Math.min(p,ie+2),pe=Math.min(y,ne+2),xe=Q;xe<oe;++xe)for(var Pe=xe*w,ve=le;ve<$;++ve)for(var Ue=ve*y,Le=se;Le<pe;++Le)for(var Z=Pe+Ue+Le,J=C[Z],de=J+N[Z],Ie=J;Ie<de;Ie++){var te=P[Ie],X=i[te]-G,ye=e[te]-B,ke=t[te]-D,ge=n[te]+O;X*X+ye*ye+ke*ke<=ge*ge&&(j[q++]=P[Ie])}j[q]=-1}}}function bx(i,e,t){const n=e.length,r=new Float32Array(n),s=new Float32Array(n),o=new Float32Array(n);for(let Y=0;Y<n;Y++){const ie=3*Y;r[Y]=i[ie],s[Y]=i[ie+1],o[Y]=i[ie+2]}let a=Z0(i);i.length===0&&(a[0].set([0,0,0]),a[1].set([0,0,0]));const l=a[0],c=a[1];let u,h,d,f,m,_,v,g,b,p,y,A,w,M,T,E,C,N,P=-1;const L=new Float32Array([0,0,0]),R=new Float32Array([0,0,0]),F=new Float32Array([0,0,0]),V=new Float32Array([0,0,0]);let z;function U(Y,ie,ne,Q){f=he(Y,1.4),m=he(ie,2),_=he(ne,!0),v=he(Q,30),u=new Float32Array(n),h=new Float32Array(n);for(let se=0;se<u.length;++se){var le=e[se]+f;u[se]=le,h[se]=le*le}d=0;for(let se=0;se<u.length;++se)u[se]>d&&(d=u[se]);(function(){const se=n1(l,c,d,m,0);m=se.scaleFactor,g=se.dim,b=se.matrix,z=Math.max(5,2+Math.floor(f*m)),p=Mo(g[0]*g[1]*g[2],-1001),y=new Int32Array(p.length),A=new Float32Array(g[0]),w=new Float32Array(g[1]),M=new Float32Array(g[2]),G(A,l[0],1/m),G(w,l[1],1/m),G(M,l[2],1/m)})(),function(){var se=0,oe=2*Math.PI/v;E=new Float32Array(v),T=new Float32Array(v);for(var $=0;$<v;$++)E[$]=Math.cos(se),T[$]=Math.sin(se),se+=oe}(),C=IV(r,s,o,u,l,c,2.01*d),N=new Int32Array(C.neighbourListLength),P=-1}function G(Y,ie,ne){for(let Q=0;Q<Y.length;Q++)Y[Q]=ie+ne*Q}function B(Y,ie,ne,Q,le){let se;if(P!==-1){if(se=P,se!==Q&&se!==le&&D(se,Y,ie,ne))return se;P=-1}var oe=0;for(se=N[oe];se>=0;){if(se!==Q&&se!==le&&D(se,Y,ie,ne))return P=se,se;se=N[++oe]}return P=-1,-1}function D(Y,ie,ne,Q){var le=3*Y,se=h[Y],oe=i[le]-ie,$=i[le+1]-ne,pe=i[le+2]-Q;return oe*oe+$*$+pe*pe<se}function O(){for(var Y=0;Y<n;Y++){var ie=r[Y],ne=s[Y],Q=o[Y],le=u[Y],se=h[Y];C.withinRadii(ie,ne,Q,le,N);for(var oe=Math.ceil(le*m),$=Math.floor(m*(ie-l[0])),pe=Math.floor(m*(ne-l[1])),xe=Math.floor(m*(Q-l[2])),Pe=Math.max(0,$-oe),ve=Math.max(0,pe-oe),Ue=Math.max(0,xe-oe),Le=Math.min(g[0],$+oe+2),Z=Math.min(g[1],pe+oe+2),J=Math.min(g[2],xe+oe+2),de=Pe;de<Le;de++)for(var Ie=A[de]-ie,te=g[1]*g[2]*de,X=ve;X<Z;X++)for(var ye=w[X]-ne,ke=Ie*Ie+ye*ye,ge=te+g[2]*X,De=Ue;De<J;De++){var $e=M[De]-Q,Ae=ke+$e*$e;if(Ae<se){var Ze=De+ge;p[Ze]<0&&(p[Ze]=-p[Ze]);var nt=Math.sqrt(Ae),rt=le/nt,Oe=Ie*rt,qe=ye*rt,it=$e*rt;if(B(Oe+=ie,qe+=ne,it+=Q,Y,-1)===-1){var at=le-nt;at<p[Ze]&&(p[Ze]=at,_&&(y[Ze]=Y))}}}}}function j(Y,ie){var ne=u[Y],Q=u[ie],le=L[0]=r[ie]-r[Y],se=L[1]=s[ie]-s[Y],oe=L[2]=o[ie]-o[Y],$=le*le+se*se+oe*oe,pe=Math.sqrt($),xe=ne*((ne*ne+pe*pe-Q*Q)/(2*ne*pe));Si(L,L),function(je,ee){je[0]=je[1]=je[2]=1,ee[0]!==0?je[0]=(ee[1]+ee[2])/-ee[0]:ee[1]!==0?je[1]=(ee[0]+ee[2])/-ee[1]:ee[2]!==0&&(je[2]=(ee[0]+ee[1])/-ee[2])}(F,L),Si(F,F),Zs(V,L,F),Si(V,V);var Pe=Math.sqrt(ne*ne-xe*xe);zn(F,F,Pe),zn(V,V,Pe),zn(L,L,xe),R[0]=L[0]+r[Y],R[1]=L[1]+s[Y],R[2]=L[2]+o[Y],P=-1;for(var ve=z,Ue=0;Ue<v;Ue++){var Le=E[Ue],Z=T[Ue],J=R[0]+Le*F[0]+Z*V[0],de=R[1]+Le*F[1]+Z*V[1],Ie=R[2]+Le*F[2]+Z*V[2];if(B(J,de,Ie,Y,ie)===-1)for(var te=Math.floor(m*(J-l[0])),X=Math.floor(m*(de-l[1])),ye=Math.floor(m*(Ie-l[2])),ke=Math.max(0,te-ve),ge=Math.max(0,X-ve),De=Math.max(0,ye-ve),$e=Math.min(g[0],te+ve+2),Ae=Math.min(g[1],X+ve+2),Ze=Math.min(g[2],ye+ve+2),nt=ke;nt<$e;nt++){le=J-A[nt];for(var rt=g[1]*g[2]*nt,Oe=ge;Oe<Ae;Oe++)for(var qe=le*le+(se=de-w[Oe])*se,it=rt+g[2]*Oe,at=De;at<Ze;at++){$=qe+(oe=Ie-M[at])*oe;var ht=at+it,Qe=p[ht];if(Qe>0&&$<Qe*Qe&&(p[ht]=Math.sqrt($),_)){const je=le*L[0]+se*L[1]+oe*L[2];y[ht]=je<0?ie:Y}}}}}function q(Y,ie,ne){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),U(Y,ie,ne),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),O(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),function(){for(var Q=0;Q<n;Q++){C.withinRadii(r[Q],s[Q],o[Q],u[Q],N);for(var le=0,se=N[le];se>=0;)Q<se&&j(Q,se),se=N[++le]}}(),console.timeEnd("AVSurface.projectTorii"),function(){for(var Q=0;Q<p.length;Q++)p[Q]<0&&(p[Q]=0)}(),function(){for(var Q=0;Q<y.length;Q++)y[Q]=t[y[Q]]}(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(Y,ie,ne,Q,le,se,oe){return q(ie,ne,le),new yu(p,g[2],g[1],g[0],y).getSurface(ie,!1,void 0,b,oe)}}ti.add("line",vhe),Object.assign(xx,{__deps:[n1,iV,yu,Z0,RV]}),Object.assign(bx,{__deps:[n1,yu,Mo,Z0,zn,Zs,Si,IV,he]}),t0.add("molsurf",function(i,e){const t=i.data.args,n=i.data.params;if(t&&n){const r=new(n.type==="av"?bx:xx)(t.coordList,t.radiusList,t.indexList).getSurface(n.type,n.probeRadius,n.scaleFactor,n.cutoff,!0,n.smooth,n.contour),s=[r.position.buffer,r.index.buffer];r.normal&&s.push(r.normal.buffer),r.atomindex&&s.push(r.atomindex.buffer),e({sd:r,p:n},s)}},[xx,bx]);class _he{constructor(e){this.structure=e}_getAtomData(e){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:he(e.radiusParams,{type:"vdw",scale:1})})}_makeSurface(e,t){var n=new DS(t.name,"",e);return n.info.type=t.type,n.info.probeRadius=t.probeRadius,n.info.scaleFactor=t.scaleFactor,n.info.smooth=t.smooth,n.info.cutoff=t.cutoff,n}getSurface(e){const t=e||{},n=this._getAtomData(e),r=n.position,s=n.radius,o=n.index,a=new(t.type==="av"?bx:xx)(r,s,o).getSurface(t.type,t.probeRadius,t.scaleFactor,t.cutoff,!0,t.smooth,t.contour);return this._makeSurface(a,t)}getSurfaceWorker(e,t){const n=Object.assign({},e);if(window.hasOwnProperty("Worker")){this.worker===void 0&&(this.worker=new kG("molsurf"));const r=this._getAtomData(e),s=r.position,o=r.radius,a=r.index,l={args:{coordList:s,radiusList:o,indexList:a},params:n},c=[s.buffer,o.buffer,a.buffer];this.worker.post(l,c,u=>{t(this._makeSurface(u.data.sd,n))},u=>{console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",u),this.worker.terminate(),this.worker=void 0;const h=this.getSurface(n);t(h)})}else{const r=this.getSurface(n);t(r)}}dispose(){this.worker&&this.worker.terminate()}}class yhe extends Br{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add(()=>{this.__forceNewMolsurf=!0}),this.toBePrepared=!0,this.init(n)}init(e){const t=e||{};t.colorScheme=he(t.colorScheme,"uniform"),t.colorValue=he(t.colorValue,14540253),t.disablePicking=he(t.disablePicking,!0),this.surfaceType=he(t.surfaceType,"ms"),this.probeRadius=he(t.probeRadius,1.4),this.smooth=he(t.smooth,2),this.scaleFactor=he(t.scaleFactor,2),this.cutoff=he(t.cutoff,0),this.contour=he(t.contour,!1),this.background=he(t.background,!1),this.opaqueBack=he(t.opaqueBack,!0),this.filterSele=he(t.filterSele,""),this.colorVolume=he(t.colorVolume,void 0),this.useWorker=he(t.useWorker,!0),super.init(e)}prepareData(e,t,n){let r=this.__infoList[t];if(r||(r={},this.__infoList[t]=r),r.molsurf&&r.sele===e.selection.string)n(t);else{if(this.filterSele){const a=e.structure.getView(new ei(this.filterSele)),l=a.boundingBox.getSize(new me),c=Math.max(l.x,l.y,l.z),u=e.getAtomSetWithinPoint(a.center,c/2+6);if((e=e.getView(new ei(e.getAtomSetWithinSelection(u,3).toSeleString()))).atomCount===0)return void n(t)}r.sele=e.selection.string,r.molsurf=new _he(e);const s=this.getSurfaceParams(),o=a=>{r.surface=a,n(t)};this.useWorker?r.molsurf.getSurfaceWorker(s,o):o(r.molsurf.getSurface(s))}}prepare(e){if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach(s=>{s&&s.molsurf&&s.molsurf.dispose()}),this.__infoList.length=0),this.structureView.atomCount===0)return void e();const t=()=>{this.__sele=this.selection.string,this.__surfaceParams=JSON.stringify(this.getSurfaceParams()),this.__forceNewMolsurf=!1,e()},n=this.assembly==="default"?this.defaultAssembly:this.assembly,r=this.structure.biomolDict[n];r?r.partList.forEach((s,o)=>{const a=s.getView(this.structureView);this.prepareData(a,o,l=>{l===r.partList.length-1&&t()})}):this.prepareData(this.structureView,0,t)}createData(e,t){const n=this.__infoList[t],r=n.surface;if(!r)return;const s={position:r.getPosition(),color:r.getColor(this.getColorParams()),index:r.getFilteredIndex(this.filterSele,e)},o=[];if(r.contour){const a=new oV(s,this.getBufferParams({wireframe:!1}));o.push(a)}else{Object.assign(s,{normal:r.getNormal(),picking:r.getPicking(e.getStructure())});const a=new rV(s,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if(this.getBufferParams().side=="double"){const l=new sV(a);o.push(l)}else o.push(a)}return{bufferList:o,info:n}}updateData(e,t){const n={};if(e.position||e.radius)return this.__forceNewMolsurf=!0,void this.build();e.color&&(n.color=t.info.surface.getColor(this.getColorParams())),e.index&&(n.index=t.info.surface.getFilteredIndex(this.filterSele,t.sview)),t.bufferList[0].setAttributes(n)}setParameters(e,t={},n){return e&&e.filterSele&&(t.index=!0),e&&e.colorVolume!==void 0&&(t.color=!0),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),this}getSurfaceParams(e={}){return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},e)}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}getAtomRadius(){return 0}clear(){super.clear()}dispose(){this.__infoList.forEach(e=>{e&&e.molsurf&&e.molsurf.dispose()}),this.__infoList.length=0,super.dispose()}}ti.add("surface",yhe);class xhe extends Br{constructor(e,t,n){super(e,t,n),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.pointSize=he(t.pointSize,1),this.sizeAttenuation=he(t.sizeAttenuation,!0),this.sortParticles=he(t.sortParticles,!1),this.useTexture=he(t.useTexture,!1),this.alphaTest=he(t.alphaTest,.5),this.forceTransparent=he(t.forceTransparent,!1),this.edgeBleach=he(t.edgeBleach,0),super.init(t)}createData(e){var t=e.getAtomData(this.getAtomParams({position:!0,color:!0,picking:!0}));return{bufferList:[new ZR(t,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),r={};e&&!e.position||Object.assign(r,{position:n.position}),e&&!e.color||Object.assign(r,{color:n.color}),t.bufferList[0].setAttributes(r)}getAtomRadius(){return .1}}ti.add("point",xhe),An.add("shader/Ribbon.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
attribute vec3 dir;
attribute float size;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
transformed += normalize( dir ) * size;
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);const bhe=new Uint16Array([0,1,2,1,3,2]);function fg(i){return 3*(4*(i.position.length/3-1))}class She extends dc{constructor(e,t={}){super({position:new Float32Array(fg(e)),color:new Float32Array(fg(e)),index:fl(fg(e),fg(e)/3),normal:new Float32Array(fg(e)),picking:e.picking},t),this.vertexShader="Ribbon.vert";const n=e.position.length/3-1,r=4*n,s=3*r;this.addAttributes({dir:{type:"v3",value:new Float32Array(s)}}),this.addAttributes({size:{type:"f",value:new Float32Array(r)}}),e.primitiveId=lm(n),this.setAttributes(e),this.makeIndex()}setAttributes(e={}){const t=this.size/4,n=this.geometry.attributes;let r,s,o,a,l,c,u,h,d,f,m,_,v,g,b,p,y,A,w;e.position&&(r=e.position,u=n.position.array,n.position.needsUpdate=!0),e.normal&&(s=e.normal,h=n.normal.array,n.normal.needsUpdate=!0),e.size&&(o=e.size,d=n.size.array,n.size.needsUpdate=!0),e.dir&&(a=e.dir,f=n.dir.array,n.dir.needsUpdate=!0),e.color&&(l=e.color,m=n.color.array,n.color.needsUpdate=!0),e.primitiveId&&(c=e.primitiveId,_=n.primitiveId.array,n.primitiveId.needsUpdate=!0);let M=o?o[0]:null;for(v=0;v<t;++v){for(A=3*v,b=3*v*4,y=4*v,r&&(u[b]=u[b+3]=r[A],u[b+1]=u[b+4]=r[A+1],u[b+2]=u[b+5]=r[A+2],u[b+6]=u[b+9]=r[A+3],u[b+7]=u[b+10]=r[A+4],u[b+8]=u[b+11]=r[A+5]),s&&(h[b]=h[b+3]=-s[A],h[b+1]=h[b+4]=-s[A+1],h[b+2]=h[b+5]=-s[A+2],h[b+6]=h[b+9]=-s[A+3],h[b+7]=h[b+10]=-s[A+4],h[b+8]=h[b+11]=-s[A+5]),g=0;g<4;++g)p=b+3*g,l&&(m[p]=l[A],m[p+1]=l[A+1],m[p+2]=l[A+2]),c&&(_[y+g]=c[v]);o&&(w=o[v],M!==o[v]?(d[y]=M,d[y+1]=M,d[y+2]=w,d[y+3]=w):(d[y]=w,d[y+1]=w,d[y+2]=w,d[y+3]=w),M=w),a&&(f[b]=a[A],f[b+1]=a[A+1],f[b+2]=a[A+2],f[b+3]=-a[A],f[b+4]=-a[A+1],f[b+5]=-a[A+2],f[b+6]=a[A+3],f[b+7]=a[A+4],f[b+8]=a[A+5],f[b+9]=-a[A+3],f[b+10]=-a[A+4],f[b+11]=-a[A+5])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void tt.error("Index is null");const t=e.array,n=t.length/4/3;for(let r=0;r<n;++r){const s=6*r,o=4*r;t.set(bhe,s);for(let a=0;a<6;++a)t[s+a]+=o}}}class whe extends Br{constructor(e,t,n){super(e,t,n),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=he(t.colorScheme,"chainname"),t.colorScale=he(t.colorScale,"RdYlBu"),t.radiusType=he(t.radiusType,"sstruc"),t.radiusScale=he(t.radiusScale,4),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=he(t.subdiv,6),this.tension=he(t.tension,NaN),this.smoothSheet=he(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){var t=[],n=[];return this.structure.eachPolymer(r=>{if(!(r.residueCount<4)){n.push(r);var s=new jp(r,this.getSplineParams()),o=s.getSubdividedPosition(),a=s.getSubdividedOrientation(),l=s.getSubdividedColor(this.getColorParams()),c=s.getSubdividedPicking(),u=s.getSubdividedSize(this.getRadiusParams());t.push(new She({position:o.position,normal:a.binormal,dir:a.normal,color:l.color,size:u.size,picking:c.picking},this.getBufferParams()))}},e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,r=t.polymerList.length;for(n=0;n<r;++n){var s={},o=new jp(t.polymerList[n],this.getSplineParams());if(e.position){var a=o.getSubdividedPosition(),l=o.getSubdividedOrientation();Object.assign(s,{position:a.position,normal:l.binormal,dir:l.normal})}if(e.radius||e.scale){var c=o.getSubdividedSize(this.getRadiusParams());Object.assign(s,{size:c.size})}if(e.color){var u=o.getSubdividedColor(this.getColorParams());Object.assign(s,{color:u.color})}t.bufferList[n].setAttributes(s)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}ti.add("ribbon",whe);class Mhe extends Br{constructor(e,t,n){super(e,t,n),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){let t=e||{};t.colorScheme=he(t.colorScheme,"sstruc"),t.radiusSize=he(t.radiusSize,1.5),t.radiusScale=he(t.radiusScale,1),t.openEnded=he(t.openEnded,!1),t.useInteriorColor=he(t.useInteriorColor,!0),this.localAngle=he(t.localAngle,30),this.centerDist=he(t.centerDist,2.5),this.ssBorder=he(t.ssBorder,!1),super.init(t)}createData(e){let t=0;const n=[],r=[];this.structure.eachPolymer(l=>{if(l.residueCount<4||l.isNucleic())return;const c=new uV(l),u=c.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());t+=u.size.length,n.push(u),r.push(c)},e.getSelection());const s={begin:new Float32Array(3*t),end:new Float32Array(3*t),size:new Float32Array(t),color:new Float32Array(3*t),picking:{}};let o=new Float32Array(t),a=0;return n.forEach(function(l){s.begin.set(l.begin,3*a),s.end.set(l.end,3*a),s.size.set(l.size,a),s.color.set(l.color,3*a),o.set(l.picking.array,a),a+=l.size.length}),t&&(s.picking=new Sd(o,e.getStructure())),{bufferList:[new vc({position1:s.begin,position2:s.end,color:s.color,color2:s.color,radius:s.size,picking:s.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:n,helixbundleList:r,axisData:s}}updateData(e,t){if((e=e||{}).position)this.build();else{var n={};if(e.color||e.radius){var r=0;t.helixbundleList.forEach(s=>{var o=s.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());e.color&&t.axisData.color.set(o.color,3*r),(e.radius||e.scale)&&t.axisData.size.set(o.size,r),r+=o.size.length}),e.color&&Object.assign(n,{color:t.axisData.color,color2:t.axisData.color}),(e.radius||e.scale)&&Object.assign(n,{radius:t.axisData.size})}t.bufferList[0].setAttributes(n)}}}ti.add("rocket",Mhe);class Ahe extends n3{constructor(e,t,n){super(e,t,n),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}init(e){var t=e||{};t.aspectRatio=1,t.tension=he(t.tension,.5),t.radiusScale=he(t.radiusScale,5),t.smoothSheet=!1,this.smooth=he(t.smooth,2),super.init(t)}getSpline(e){var t=new pb(e);return new jp(e,this.getSplineParams({directional:!1,positionIterator:t.getCenterIterator(this.smooth)}))}}ti.add("rope",Ahe);class Ehe extends Br{constructor(e,t,n){super(e,t,n),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.useInteriorColor=he(t.useInteriorColor,!0),super.init(t)}createData(e){return{bufferList:[new ku(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),r={};e&&!e.position||Object.assign(r,{position:n.position}),e&&!e.color||Object.assign(r,{color:n.color}),e&&!e.radius||Object.assign(r,{radius:n.radius}),t.bufferList[0].setAttributes(r)}}function lU(i){return 3*(i.position.length/3-1)*2}ti.add("spacefill",Ehe);class The extends pl{constructor(e,t={}){super({position:new Float32Array(lU(e)),color:new Float32Array(lU(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(e)}setAttributes(e){let t,n,r,s;const o=this.geometry.attributes;if(e.position&&(t=e.position,r=o.position.array,o.position.needsUpdate=!0),e.color&&(n=e.color,s=o.color.array,o.color.needsUpdate=!0),!t&&!n)return void tt.warn("TraceBuffer.prototype.setAttributes no data");let a,l;const c=this.size-1;for(let u=0;u<c;++u)a=3*u,l=3*u*2,t&&(r[l]=t[a],r[l+1]=t[a+1],r[l+2]=t[a+2],r[l+3]=t[a+3],r[l+4]=t[a+4],r[l+5]=t[a+5]),n&&(s[l]=n[a],s[l+1]=n[a+1],s[l+2]=n[a+2],s[l+3]=n[a+3],s[l+4]=n[a+4],s[l+5]=n[a+5])}}class Che extends Br{constructor(e,t,n){super(e,t,n),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=he(t.colorScheme,"chainname"),t.colorScale=he(t.colorScale,"RdYlBu"),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=he(t.subdiv,6),this.tension=he(t.tension,NaN),this.smoothSheet=he(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?.1:0}createData(e){var t=[],n=[];return this.structure.eachPolymer(r=>{if(!(r.residueCount<4)){n.push(r);var s=new jp(r,this.getSplineParams()),o=s.getSubdividedPosition(),a=s.getSubdividedColor(this.getColorParams());t.push(new The(Object.assign({},o,a),this.getBufferParams()))}},e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,r=t.polymerList.length;for(n=0;n<r;++n){var s={},o=new jp(t.polymerList[n],this.getSplineParams());if(e.position){var a=o.getSubdividedPosition();Object.assign(s,{position:a.position})}if(e.color){var l=o.getSubdividedColor(this.getColorParams());Object.assign(s,{color:l.color})}t.bufferList[n].setAttributes(s)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}ti.add("trace",Che);class Phe extends n3{constructor(e,t,n){super(e,t,n),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,t.radiusScale=he(t.radiusScale,2),t.quality==="low"&&(this.radialSegments=5),super.init(t)}getSplineParams(){return super.getSplineParams({directional:!1})}}ti.add("tube",Phe);class Rhe extends Br{constructor(e,t,n){super(e,t,n),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};let n=.5;this.structure.unitcell&&(n=Math.cbrt(this.structure.unitcell.volume)/200),t.radiusSize=he(t.radiusSize,n),t.colorValue=he(t.colorValue,"orange"),t.useInteriorColor=he(t.useInteriorColor,!0),super.init(t)}getUnitcellData(e){return e.unitcell.getData(e)}create(){const e=this.structureView.getStructure();if(!e.unitcell)return;const t=this.getUnitcellData(e);this.sphereBuffer=new ku(t.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new vc(t.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=t.sview.getStructure();if(!n.unitcell)return;const r=this.getUnitcellData(n),s={},o={};e&&!e.position||(Object.assign(s,{position:r.vertex.position}),Object.assign(o,{position1:r.edge.position1,position2:r.edge.position2})),e&&!e.color||(Object.assign(s,{color:r.vertex.color}),Object.assign(o,{color:r.edge.color,color2:r.edge.color2})),e&&!e.radius||(Object.assign(s,{radius:r.vertex.radius}),Object.assign(o,{radius:r.edge.radius})),this.sphereBuffer.setAttributes(s),this.cylinderBuffer.setAttributes(o)}}ti.add("unitcell",Rhe);class Ihe extends Br{constructor(e,t,n){super(e,t,n),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(n)}init(e){const t=e||{};t.colorValue=he(t.colorValue,"#f0027f"),t.useInteriorColor=he(t.useInteriorColor,!0),super.init(t)}createData(e){if(!e.validation)return;const t=e.validation.getClashData({structure:e,color:this.colorValue});return{bufferList:[new vc(t,this.getBufferParams({openEnded:!1}))]}}}ti.add("validation",Ihe);const cU=new me,uA=new me,hA=new me,Lhe=new me(0,1,0),Dhe=Object.assign({radialSegments:60,openEnded:!1},Ls);class LV extends Fu{constructor(e,t={}){super({position:new Float32Array(e.position1.length),color:e.color,picking:e.picking},t,function(n={}){const r=new RR(1,1,he(n.radialSegments,60),1,he(n.openEnded,!1));return r.applyMatrix4(new Tt().makeRotationX(-Math.PI/2)),r}(t)),this.updateNormals=!0,this._position=new Float32Array(e.position1.length),this.setAttributes(e,!0)}get defaultParameters(){return Dhe}applyPositionTransform(e,t,n){uA.fromArray(this._position1,n),hA.fromArray(this._position2,n),e.lookAt(uA,hA,Lhe);const r=this._radius[t];cU.set(r,r,uA.distanceTo(hA)),e.scale(cU)}setAttributes(e={},t){e.position1&&e.position2&&(ll(e.position1,e.position2,this._position),this._position1=e.position1,this._position2=e.position2,e.position=this._position),e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}To.add("cone",LV);class Nhe{constructor(e=[]){this.geometryList=e}computeBoundingBox(){this.boundingBox?this.boundingBox.empty():this.boundingBox=new Ti,this.geometryList.forEach(e=>{e.boundingBox||e.computeBoundingBox(),this.boundingBox.union(e.boundingBox)})}}const Fhe=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},Ls);class khe{constructor(e,t={}){this.group=new Xn,this.wireframeGroup=new Xn,this.pickingGroup=new Xn,this.visible=!0,this.parameters=wo(t,this.defaultParameters),this.splitPosition=new Float32Array(e.position1.length),this.cylinderRadius=new Float32Array(e.radius.length);const n=this.makeAttributes(e),r={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new vc(n.cylinder,r),this.coneBuffer=new LV(n.cone,r),this.geometry=new Nhe([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=he(t.matrix,new Tt),this.picking=e.picking}get defaultParameters(){return Fhe}set matrix(e){pl.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking}makeAttributes(e={}){const t=this.splitPosition,n=this.cylinderRadius,r=this.parameters.aspectRatio;let s,o;const a={},l={};if(e.radius){for(s=0,o=n.length;s<o;++s)n[s]=e.radius[s]/r;a.radius=n,l.radius=e.radius}if(e.position1&&e.position2){const c=new me,u=new me,h=new me,d=new me;for(s=0,o=t.length;s<o;s+=3){c.fromArray(e.position1,s),u.fromArray(e.position2,s),h.subVectors(c,u);const f=h.length(),m=n[s/3]*r*2,_=Math.min(f,m);h.setLength(_),d.copy(u).add(h),d.toArray(t,s)}a.position1=e.position1,a.position2=t,l.position1=t,l.position2=e.position2}return e.color&&(a.color=e.color,a.color2=e.color,l.color=e.color),{cylinder:a,cone:l}}getMesh(){return new Xn().add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())}getWireframeMesh(){return new Xn().add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())}getPickingMesh(){return new Xn().add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())}setAttributes(e={}){const t=this.makeAttributes(e);this.cylinderBuffer.setAttributes(t.cylinder),this.coneBuffer.setAttributes(t.cone)}setParameters(e={}){(e=Object.assign({},e))&&e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,e&&e.wireframe!==void 0&&(this.parameters.wireframe=e.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(e),this.coneBuffer.setParameters(e)}setVisibility(e){pl.prototype.setVisibility.call(this,e)}dispose(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()}}To.add("arrow",khe);const uU=new me,dA=new me,fA=new me,Uhe=new me(0,0,0);class Ohe extends Fu{constructor(e,t={}){super(e,t,new sm(1,1,1)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){dA.fromArray(this._heightAxis,n),fA.fromArray(this._depthAxis,n),e.lookAt(Uhe,dA,fA),uU.set(this._size[t],fA.length(),dA.length()),e.scale(uU)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}To.add("box",Ohe);const hU=new me,pA=new me,mA=new me,Bhe=new me(0,0,0),zhe=Object.assign({sphereDetail:2},Ls);class Ghe extends Fu{constructor(e,t={}){super(e,t,new wS(1,he(t.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return zhe}applyPositionTransform(e,t,n){pA.fromArray(this._majorAxis,n),mA.fromArray(this._minorAxis,n),e.lookAt(Bhe,pA,mA),hU.set(this._radius[t],mA.length(),pA.length()),e.scale(hU)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}To.add("ellipsoid",Ghe);const dU=new me,gA=new me,vA=new me,Vhe=new me(0,0,0);class Hhe extends Fu{constructor(e,t={}){super(e,t,new IR(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){gA.fromArray(this._heightAxis,n),vA.fromArray(this._depthAxis,n),e.lookAt(Vhe,gA,vA),dU.set(this._size[t],vA.length(),gA.length()),e.scale(dU)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}To.add("octahedron",Hhe);const fU=new me,_A=new me,yA=new me,$he=new me(0,0,0);class Whe extends Fu{constructor(e,t={}){super(e,t,new LR(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){_A.fromArray(this._heightAxis,n),yA.fromArray(this._depthAxis,n),e.lookAt($he,_A,yA),fU.set(this._size[t],yA.length(),_A.length()),e.scale(fU)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}To.add("tetrahedron",Whe);const pU=new me,mU=new me,gU=new me,jhe=new me(0,0,0),Xhe=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},Ls);class qhe extends Fu{constructor(e,t={}){super(e,t,new DR(1,he(t.radiusRatio,.2),he(t.radialSegments,16),he(t.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return Xhe}applyPositionTransform(e,t,n){mU.fromArray(this._majorAxis,n),gU.fromArray(this._minorAxis,n),e.lookAt(jhe,mU,gU);const r=this._radius[t];pU.set(r,r,r),e.scale(pU)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}function op(i,e){return{start:e&&e.start!==void 0?Math.max(Math.min(e.start,i-1),0):0,end:e&&e.end!==void 0?Math.min(e.end,i):i}}function P1(i,e){const t=e&&e.array!==void 0?e.array:Array,{start:n,end:r}=op(i,e);return{array:new t(r-n),start:n,end:r}}function Qr(i,e,t){const{array:n,start:r}=P1(i,t);return function(s,o,a){for(let l=0,c=o.length;l<c;l++)o[l]=s(a+l);return o}(e,n,r)}function i3(i){return!!i.buffer&&typeof i.byteLength=="number"&&typeof i.BYTES_PER_ELEMENT=="number"}function vb(i,e){const{constructor:t,buffer:n,length:r,byteOffset:s,BYTES_PER_ELEMENT:o}=i,{start:a,end:l}=op(r,e);return a===0&&l===r?i:new t(n,s+o*a,Math.min(r,l-a))}To.add("torus",qhe);const Li=1e-6;function Pr(i,e,t){return Math.abs(i-e)<=t}function vU(i,e,t){return Math.max(e,Math.min(t,i))}function xA(i,e,t,n,r,s){const o=(t-i)*s,a=(n-e)*s,l=r*r;return(2*e-2*t+o+a)*(r*l)+(-3*e+3*t-2*o-a)*l+o*r+e}function bA(i,e,t,n){const r=1-n;return r*r*i+2*r*n*e+n*n*t}const SA=isFinite;function Nn(){return Nn.zero()}(function(i){function e(){const P=[.1,0,0];return P[0]=0,P}function t(P,L,R){const F=e();return F[0]=P,F[1]=L,F[2]=R,F}function n(P,L){return P[0]=L[0],P[1]=L[1],P[2]=L[2],P}function r(P,L,R){return P[0]=L[0]+R[0],P[1]=L[1]+R[1],P[2]=L[2]+R[2],P}function s(P,L,R){return P[0]=L[0]-R[0],P[1]=L[1]-R[1],P[2]=L[2]-R[2],P}function o(P,L,R){return P[0]=L[0]*R,P[1]=L[1]*R,P[2]=L[2]*R,P}function a(P,L,R,F){return P[0]=L[0]+R[0]*F,P[1]=L[1]+R[1]*F,P[2]=L[2]+R[2]*F,P}function l(P){const L=P[0],R=P[1],F=P[2];return L*L+R*R+F*F}function c(P,L){return P[0]=-L[0],P[1]=-L[1],P[2]=-L[2],P}function u(P,L){const R=L[0],F=L[1],V=L[2];let z=R*R+F*F+V*V;return z>0&&(z=1/Math.sqrt(z),P[0]=L[0]*z,P[1]=L[1]*z,P[2]=L[2]*z),P}function h(P,L){return P[0]*L[0]+P[1]*L[1]+P[2]*L[2]}function d(P,L,R){const F=L[0],V=L[1],z=L[2],U=R[0],G=R[1],B=R[2];return P[0]=V*B-z*G,P[1]=z*U-F*B,P[2]=F*G-V*U,P}i.zero=e,i.clone=function(P){const L=e();return L[0]=P[0],L[1]=P[1],L[2]=P[2],L},i.isFinite=function(P){return SA(P[0])&&SA(P[1])&&SA(P[2])},i.hasNaN=function(P){return isNaN(P[0])||isNaN(P[1])||isNaN(P[2])},i.setNaN=function(P){return P[0]=NaN,P[1]=NaN,P[2]=NaN,P},i.fromObj=function(P){return t(P.x,P.y,P.z)},i.toObj=function(P){return{x:P[0],y:P[1],z:P[2]}},i.fromArray=function(P,L,R){return P[0]=L[R+0],P[1]=L[R+1],P[2]=L[R+2],P},i.toArray=function(P,L,R){return L[R+0]=P[0],L[R+1]=P[1],L[R+2]=P[2],L},i.create=t,i.ofArray=function(P){const L=e();return L[0]=P[0],L[1]=P[1],L[2]=P[2],L},i.set=function(P,L,R,F){return P[0]=L,P[1]=R,P[2]=F,P},i.copy=n,i.add=r,i.sub=s,i.mul=function(P,L,R){return P[0]=L[0]*R[0],P[1]=L[1]*R[1],P[2]=L[2]*R[2],P},i.div=function(P,L,R){return P[0]=L[0]/R[0],P[1]=L[1]/R[1],P[2]=L[2]/R[2],P},i.scale=o,i.scaleAndAdd=a,i.scaleAndSub=function(P,L,R,F){return P[0]=L[0]-R[0]*F,P[1]=L[1]-R[1]*F,P[2]=L[2]-R[2]*F,P},i.addScalar=function(P,L,R){return P[0]=L[0]+R,P[1]=L[1]+R,P[2]=L[2]+R,P},i.subScalar=function(P,L,R){return P[0]=L[0]-R,P[1]=L[1]-R,P[2]=L[2]-R,P},i.round=function(P,L){return P[0]=Math.round(L[0]),P[1]=Math.round(L[1]),P[2]=Math.round(L[2]),P},i.ceil=function(P,L){return P[0]=Math.ceil(L[0]),P[1]=Math.ceil(L[1]),P[2]=Math.ceil(L[2]),P},i.floor=function(P,L){return P[0]=Math.floor(L[0]),P[1]=Math.floor(L[1]),P[2]=Math.floor(L[2]),P},i.trunc=function(P,L){return P[0]=Math.trunc(L[0]),P[1]=Math.trunc(L[1]),P[2]=Math.trunc(L[2]),P},i.abs=function(P,L){return P[0]=Math.abs(L[0]),P[1]=Math.abs(L[1]),P[2]=Math.abs(L[2]),P},i.min=function(P,L,R){return P[0]=Math.min(L[0],R[0]),P[1]=Math.min(L[1],R[1]),P[2]=Math.min(L[2],R[2]),P},i.max=function(P,L,R){return P[0]=Math.max(L[0],R[0]),P[1]=Math.max(L[1],R[1]),P[2]=Math.max(L[2],R[2]),P},i.clamp=function(P,L,R,F){return P[0]=Math.max(R[0],Math.min(F[0],L[0])),P[1]=Math.max(R[1],Math.min(F[1],L[1])),P[2]=Math.max(R[2],Math.min(F[2],L[2])),P},i.distance=function(P,L){const R=L[0]-P[0],F=L[1]-P[1],V=L[2]-P[2];return Math.sqrt(R*R+F*F+V*V)},i.squaredDistance=function(P,L){const R=L[0]-P[0],F=L[1]-P[1],V=L[2]-P[2];return R*R+F*F+V*V},i.magnitude=function(P){const L=P[0],R=P[1],F=P[2];return Math.sqrt(L*L+R*R+F*F)},i.squaredMagnitude=l,i.setMagnitude=function(P,L,R){return o(P,u(P,L),R)},i.negate=c,i.inverse=function(P,L){return P[0]=1/L[0],P[1]=1/L[1],P[2]=1/L[2],P},i.normalize=u,i.dot=h,i.cross=d,i.lerp=function(P,L,R,F){const V=L[0],z=L[1],U=L[2];return P[0]=V+F*(R[0]-V),P[1]=z+F*(R[1]-z),P[2]=U+F*(R[2]-U),P};const f=e();function m(P,L){const R=Math.sqrt(l(P)*l(L));if(R===0)return Math.PI/2;const F=h(P,L)/R;return Math.acos(vU(F,-1,1))}i.slerp=function(P,L,R,F){const V=vU(h(L,R),-1,1),z=Math.acos(V)*F;return a(f,R,L,-V),u(f,f),r(P,o(P,L,Math.cos(z)),o(f,f,Math.sin(z)))},i.hermite=function(P,L,R,F,V,z){const U=z*z,G=U*(2*z-3)+1,B=U*(z-2)+z,D=U*(z-1),O=U*(3-2*z);return P[0]=L[0]*G+R[0]*B+F[0]*D+V[0]*O,P[1]=L[1]*G+R[1]*B+F[1]*D+V[1]*O,P[2]=L[2]*G+R[2]*B+F[2]*D+V[2]*O,P},i.bezier=function(P,L,R,F,V,z){const U=1-z,G=U*U,B=z*z,D=G*U,O=3*z*G,j=3*B*U,q=B*z;return P[0]=L[0]*D+R[0]*O+F[0]*j+V[0]*q,P[1]=L[1]*D+R[1]*O+F[1]*j+V[1]*q,P[2]=L[2]*D+R[2]*O+F[2]*j+V[2]*q,P},i.quadraticBezier=function(P,L,R,F,V){return P[0]=bA(L[0],R[0],F[0],V),P[1]=bA(L[1],R[1],F[1],V),P[2]=bA(L[2],R[2],F[2],V),P},i.spline=function(P,L,R,F,V,z,U){return P[0]=xA(L[0],R[0],F[0],V[0],z,U),P[1]=xA(L[1],R[1],F[1],V[1],z,U),P[2]=xA(L[2],R[2],F[2],V[2],z,U),P},i.random=function(P,L){const R=2*Math.random()*Math.PI,F=2*Math.random()-1,V=Math.sqrt(1-F*F)*L;return P[0]=Math.cos(R)*V,P[1]=Math.sin(R)*V,P[2]=F*L,P},i.transformMat4=function(P,L,R){const F=L[0],V=L[1],z=L[2],U=1/(R[3]*F+R[7]*V+R[11]*z+R[15]||1);return P[0]=(R[0]*F+R[4]*V+R[8]*z+R[12])*U,P[1]=(R[1]*F+R[5]*V+R[9]*z+R[13])*U,P[2]=(R[2]*F+R[6]*V+R[10]*z+R[14])*U,P},i.transformDirection=function(P,L,R){const F=L[0],V=L[1],z=L[2];return P[0]=R[0]*F+R[4]*V+R[8]*z,P[1]=R[1]*F+R[5]*V+R[9]*z,P[2]=R[2]*F+R[6]*V+R[10]*z,u(P,P)},i.transformMat4Offset=function(P,L,R,F,V,z){const U=L[0+V],G=L[1+V],B=L[2+V],D=1/(R[3+z]*U+R[7+z]*G+R[11+z]*B+R[15+z]||1);return P[0+F]=(R[0+z]*U+R[4+z]*G+R[8+z]*B+R[12+z])*D,P[1+F]=(R[1+z]*U+R[5+z]*G+R[9+z]*B+R[13+z])*D,P[2+F]=(R[2+z]*U+R[6+z]*G+R[10+z]*B+R[14+z])*D,P},i.transformDirectionOffset=function(P,L,R,F,V,z){const U=L[0+V],G=L[1+V],B=L[2+V];P[0+F]=R[0+z]*U+R[4+z]*G+R[8+z]*B,P[1+F]=R[1+z]*U+R[5+z]*G+R[9+z]*B,P[2+F]=R[2+z]*U+R[6+z]*G+R[10+z]*B;const D=Math.hypot(P[0+F],P[1+F],P[2+F]);return D>0&&(P[0+F]/=D,P[1+F]/=D,P[2+F]/=D),P},i.transformMat3=function(P,L,R){const F=L[0],V=L[1],z=L[2];return P[0]=F*R[0]+V*R[3]+z*R[6],P[1]=F*R[1]+V*R[4]+z*R[7],P[2]=F*R[2]+V*R[5]+z*R[8],P},i.transformQuat=function(P,L,R){const F=L[0],V=L[1],z=L[2],U=R[0],G=R[1],B=R[2],D=R[3],O=D*F+G*z-B*V,j=D*V+B*F-U*z,q=D*z+U*V-G*F,Y=-U*F-G*V-B*z;return P[0]=O*D+Y*-U+j*-B-q*-G,P[1]=j*D+Y*-G+q*-U-O*-B,P[2]=q*D+Y*-B+O*-G-j*-U,P},i.angle=m;const _=e(),v=e(),g=e(),b=e(),p=e(),y=e(),A=e();i.dihedralAngle=function(P,L,R,F){s(_,P,L),s(v,R,L),s(g,L,R),s(b,F,R),d(p,_,v),d(y,g,b);const V=m(p,y);return d(A,p,y),h(v,A)>0?V:-V},i.directionFromSpherical=function(P,L,R,F){return i.set(P,F*Math.cos(R)*Math.sin(L),F*Math.sin(R)*Math.sin(L),F*Math.cos(L))},i.exactEquals=function(P,L){return P[0]===L[0]&&P[1]===L[1]&&P[2]===L[2]},i.equals=function(P,L){const R=P[0],F=P[1],V=P[2],z=L[0],U=L[1],G=L[2];return Math.abs(R-z)<=Li*Math.max(1,Math.abs(R),Math.abs(z))&&Math.abs(F-U)<=Li*Math.max(1,Math.abs(F),Math.abs(U))&&Math.abs(V-G)<=Li*Math.max(1,Math.abs(V),Math.abs(G))};const w=e();i.makeRotation=function(P,L,R){const F=m(L,R);if(Math.abs(F)<1e-4)return ru.setIdentity(P);if(Math.abs(F-Math.PI)<Li)return ru.fromScaling(P,i.negUnit);const V=d(w,L,R);return ru.fromRotation(P,F,V)},i.isZero=function(P){return P[0]===0&&P[1]===0&&P[2]===0},i.projectPointOnVector=function(P,L,R,F){return s(P,L,F),r(P,o(P,R,h(R,P)/l(R)),F)};const M=e();function T(P,L,R){return o(P,R,h(R,L)/l(R))}i.projectPointOnPlane=function(P,L,R,F){return u(M,R),s(P,L,F),s(P,L,o(M,M,h(P,M)))},i.projectOnVector=T;const E=e();i.projectOnPlane=function(P,L,R){return T(E,L,R),s(P,L,E)},i.orthogonalize=function(P,L,R){return u(P,d(P,d(P,L,R),L))},i.matchDirection=function(P,L,R){return h(L,R)>0?n(P,L):c(P,n(P,L)),P};const C=e(),N=e();i.triangleNormal=function(P,L,R,F){return s(C,R,L),s(N,F,L),u(P,d(P,C,N))},i.toString=function(P,L){return`[${P[0].toPrecision(L)} ${P[1].toPrecision(L)} ${P[2].toPrecision(L)}]`},i.origin=t(0,0,0),i.unit=t(1,1,1),i.negUnit=t(-1,-1,-1),i.unitX=t(1,0,0),i.unitY=t(0,1,0),i.unitZ=t(0,0,1),i.negUnitX=t(-1,0,0),i.negUnitY=t(0,-1,0),i.negUnitZ=t(0,0,-1)})(Nn||(Nn={}));const Yhe=Math.PI/180;function ph(i){return i*Yhe}function ru(){return ru.zero()}function Sx(){return Sx.zero()}function gC(){return gC.zero()}function vC(){return vC.zero()}function _b(i){throw new Error("unreachable")}function _C(){return _C.zero()}var Dg,si,_U,ys;function xp(i,e,t){let n=e,r=0,s=1;for(i.charCodeAt(n)===45?(s=-1,++n):i.charCodeAt(n)===43&&++n;n<t;n++){const o=i.charCodeAt(n)-48;if(o>9||o<0)return s*r|0;r=10*r+o|0}return s*r}function yU(i,e,t,n){return e.charCodeAt(t)===43&&t++,i*Math.pow(10,xp(e,t,n))}function r0(i,e,t){let n=e,r=1,s=0,o=0,a=1;for(i.charCodeAt(n)===45?(r=-1,++n):i.charCodeAt(n)===43&&++n;n<t;){let l=i.charCodeAt(n)-48;if(!(l>=0&&l<10)){if(l===-2){for(++n;n<t;){if(l=i.charCodeAt(n)-48,!(l>=0&&l<10))return l===53||l===21?yU(r*(s+o/a),i,n+1,t):r*(s+o/a);o=10*o+l,a*=10,++n}return r*(s+o/a)}if(l===53||l===21)return yU(r*s,i,n+1,t);break}s=10*s+l,++n}return r*s}function xU(i,e,t,n){return{schema:t,__array:void 0,isDefined:n===0,rowCount:e,value:r=>i,valueKind:r=>n,toArray:r=>{const{array:s}=P1(e,r);for(let o=0,a=s.length;o<a;o++)s[o]=i;return s},areValuesEqual:(r,s)=>!0}}function xy({value:i,valueKind:e,areValuesEqual:t,rowCount:n,schema:r}){return{schema:r,__array:void 0,isDefined:!0,rowCount:n,value:i,valueKind:e||(s=>0),toArray:s=>{const{array:o,start:a}=P1(n,s);for(let l=0,c=o.length;l<c;l++)o[l]=i(l+a);return o},areValuesEqual:t||((s,o)=>i(s)===i(o))}}function Hl({array:i,schema:e,valueKind:t}){const n=i.length,r=e.T,s=e.valueType==="str"?e.transform==="lowercase"?a=>{const l=i[a];return typeof l=="string"?l.toLowerCase():`${l??r}`.toLowerCase()}:e.transform==="uppercase"?a=>{const l=i[a];return typeof l=="string"?l.toUpperCase():`${l??r}`.toUpperCase()}:a=>{const l=i[a];return typeof l=="string"?l:`${l??r}`}:a=>i[a],o=i3(i);return{schema:e,__array:i,isDefined:!0,rowCount:n,value:s,valueKind:t||(a=>0),toArray:e.valueType==="str"?e.transform==="lowercase"?a=>{const{start:l,end:c}=op(n,a),u=new(a&&a.array!==void 0?a.array:i.constructor)(c-l);for(let h=0,d=c-l;h<d;h++){const f=i[l+h];u[h]=typeof f=="string"?f.toLowerCase():`${f??r}`.toLowerCase()}return u}:e.transform==="uppercase"?a=>{const{start:l,end:c}=op(n,a),u=new(a&&a.array!==void 0?a.array:i.constructor)(c-l);for(let h=0,d=c-l;h<d;h++){const f=i[l+h];u[h]=typeof f=="string"?f.toUpperCase():`${f??r}`.toUpperCase()}return u}:a=>{const{start:l,end:c}=op(n,a),u=new(a&&a.array!==void 0?a.array:i.constructor)(c-l);for(let h=0,d=c-l;h<d;h++){const f=i[l+h];u[h]=typeof f=="string"?f:`${f??r}`}return u}:o?a=>vb(i,a):a=>{const{start:l,end:c}=op(n,a);if(l===0&&c===i.length)return i;const u=new(a&&a.array!==void 0?a.array:i.constructor)(c-l);for(let h=0,d=c-l;h<d;h++)u[h]=i[l+h];return u},areValuesEqual:(a,l)=>i[a]===i[l]}}function Khe(i,e,t){return i.isDefined?e===0&&t===i.rowCount?i:i.__array&&i3(i.__array)?function(n,r,s){const o=vb(n.__array,{start:r,end:s}),a=n.valueKind;return Hl({array:o,schema:n.schema,valueKind:l=>a(r+l)})}(i,e,t):function(n,r,s){const o=n.value,a=n.valueKind,l=n.areValuesEqual,c=r===0?o:h=>o(h+r),u=s-r;return{schema:n.schema,__array:void 0,isDefined:n.isDefined,rowCount:u,value:c,valueKind:r===0?a:h=>a(h+r),toArray:h=>{const{array:d}=P1(u,h);for(let f=0,m=d.length;f<m;f++)d[f]=o(f+r);return d},areValuesEqual:r===0?l:(h,d)=>l(h+r,d+r)}}(i,e,t):si.Undefined(t-e,i.schema)}function Zhe(i,e,t){return i.rowCount===0||t&&function(n,r){if(n.length!==r)return!1;for(let s=0,o=n.length;s<o;s++)if(n[s]!==s)return!1;return!0}(e,i.rowCount)?i:i.__array&&typeof i.value(0)==typeof i.__array[0]?function(n,r){const s=n.__array,o=new s.constructor(r.length);for(let l=0,c=r.length;l<c;l++)o[l]=s[r[l]];const a=n.valueKind;return Hl({array:o,schema:n.schema,valueKind:l=>a(r[l])})}(i,e):function(n,r){const s=n.value,o=n.valueKind,a=n.areValuesEqual,l=u=>s(r[u]),c=r.length;return{schema:n.schema,__array:void 0,isDefined:n.isDefined,rowCount:c,value:l,valueKind:u=>o(r[u]),toArray:u=>{const{array:h}=P1(c,u);for(let d=0,f=h.length;d<f;d++)h[d]=s(r[d]);return h},areValuesEqual:(u,h)=>a(r[u],r[h])}}(i,e)}function wx(i,e,t){return i[e]-i[t]}function Ng(i,e,t){const n=i[e];i[e]=i[t],i[t]=n}function DV(i,e,t,n){const r=t+n>>1;return e(i,t,n)>0?e(i,t,r)>0?e(i,r,n)>0?r:n:t:e(i,n,r)>0?e(i,r,t)>0?r:t:n}function Qhe(i,e,t){const{cmp:n,swap:r,data:s,parts:o}=i;let a=e+1,l=t;for(r(s,e,DV(s,n,e,t));n(s,l,e)>0;)--l;for(let c=e+1;c<=l;c++){const u=n(s,c,e);if(u>0){for(r(s,c,l),--l;n(s,l,e)>0;)--l;c--}else u===0&&(r(s,c,a),a++)}for(let c=e;c<a;c++)r(s,c,e+l-c);o[0]=l-a+e+1,o[1]=l}function Jhe({data:i,cmp:e,swap:t},n,r){for(let s=n+1;s<=r;s++){let o=s-1;for(;o>=n&&e(i,o,o+1)>0;)t(i,o,o+1),o-=1}}function yC(i,e,t){const{parts:n}=i;for(;e<t;){if(t-e<16)return void Jhe(i,e,t);Qhe(i,e,t);const r=n[0],s=n[1];r-e<t-s?(yC(i,e,r-1),e=s+1):(yC(i,s+1,t),t=r-1)}}function ede(i,e,t,n){let r=t+1,s=n;Ng(i,t,DV(i,wx,t,n));const o=i[t];for(;i[s]>o;)--s;for(let a=t+1;a<=s;a++){const l=i[a];if(l>o){for(Ng(i,a,s),--s;i[s]>o;)--s;a--}else l===o&&(Ng(i,a,r),++r)}for(let a=t;a<r;a++)Ng(i,a,t+s-a);e[0]=s-r+t+1,e[1]=s}function tde(i,e,t){for(let n=e+1;n<=t;n++){const r=i[n];let s=n-1;for(;s>=e&&i[s]>r;)i[s+1]=i[s],s-=1;i[s+1]=r}}function xC(i,e,t,n){for(;t<n;){if(n-t<16)return void tde(i,t,n);ede(i,e,t,n);const r=e[0],s=e[1];r-t<n-s?(xC(i,e,t,r-1),t=s+1):(xC(i,e,s+1,n),n=r-1)}}function nde(i,e=wx){return function(t,n,r,s=wx){return s===wx?xC(t,[0,0],n,r-1):yC({data:t,cmp:s,swap:Ng,parts:[0,0]},n,r-1),t}(i,0,i.length,e)}(function(i){function e(){const p=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return p[0]=0,p}function t(){const p=e();return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function n(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function r(p){for(let y=0;y<16;y++)p[y]=0;return p}i.zero=e,i.identity=t,i.setIdentity=n,i.setZero=r,i.ofRows=function(p){const y=e();for(let A=0;A<4;A++){const w=p[A];for(let M=0;M<4;M++)y[4*M+A]=w[M]}return y};const s=t();function o(p,y,A){for(let w=0;w<16;w++)if(Math.abs(p[w]-y[w])>A)return!1;return!0}function a(p,y,A,w){p[4*A+y]=w}function l(p,y){return p[0]=y[0],p[1]=y[1],p[2]=y[2],p[3]=y[3],p[4]=y[4],p[5]=y[5],p[6]=y[6],p[7]=y[7],p[8]=y[8],p[9]=y[9],p[10]=y[10],p[11]=y[11],p[12]=y[12],p[13]=y[13],p[14]=y[14],p[15]=y[15],p}function c(p,y){const A=y[0]+y[5]+y[10];let w=0;return A>0?(w=2*Math.sqrt(A+1),p[3]=.25*w,p[0]=(y[6]-y[9])/w,p[1]=(y[8]-y[2])/w,p[2]=(y[1]-y[4])/w):y[0]>y[5]&&y[0]>y[10]?(w=2*Math.sqrt(1+y[0]-y[5]-y[10]),p[3]=(y[6]-y[9])/w,p[0]=.25*w,p[1]=(y[1]+y[4])/w,p[2]=(y[8]+y[2])/w):y[5]>y[10]?(w=2*Math.sqrt(1+y[5]-y[0]-y[10]),p[3]=(y[8]-y[2])/w,p[0]=(y[1]+y[4])/w,p[1]=.25*w,p[2]=(y[6]+y[9])/w):(w=2*Math.sqrt(1+y[10]-y[0]-y[5]),p[3]=(y[1]-y[4])/w,p[0]=(y[8]+y[2])/w,p[1]=(y[6]+y[9])/w,p[2]=.25*w),p}function u(p,y){const A=y[0],w=y[1],M=y[2],T=y[3],E=y[4],C=y[5],N=y[6],P=y[7],L=y[8],R=y[9],F=y[10],V=y[11],z=y[12],U=y[13],G=y[14],B=y[15],D=A*C-w*E,O=A*N-M*E,j=A*P-T*E,q=w*N-M*C,Y=w*P-T*C,ie=M*P-T*N,ne=L*U-R*z,Q=L*G-F*z,le=L*B-V*z,se=R*G-F*U,oe=R*B-V*U,$=F*B-V*G;let pe=D*$-O*oe+j*se+q*le-Y*Q+ie*ne;return!!pe&&(pe=1/pe,p[0]=(C*$-N*oe+P*se)*pe,p[1]=(M*oe-w*$-T*se)*pe,p[2]=(U*ie-G*Y+B*q)*pe,p[3]=(F*Y-R*ie-V*q)*pe,p[4]=(N*le-E*$-P*Q)*pe,p[5]=(A*$-M*le+T*Q)*pe,p[6]=(G*j-z*ie-B*O)*pe,p[7]=(L*ie-F*j+V*O)*pe,p[8]=(E*oe-C*le+P*ne)*pe,p[9]=(w*le-A*oe-T*ne)*pe,p[10]=(z*Y-U*j+B*D)*pe,p[11]=(R*j-L*Y-V*D)*pe,p[12]=(C*Q-E*se-N*ne)*pe,p[13]=(A*se-w*Q+M*ne)*pe,p[14]=(U*O-z*q-G*D)*pe,p[15]=(L*q-R*O+F*D)*pe,!0)}function h(p,y,A){const w=y[0],M=y[1],T=y[2],E=y[3],C=y[4],N=y[5],P=y[6],L=y[7],R=y[8],F=y[9],V=y[10],z=y[11],U=y[12],G=y[13],B=y[14],D=y[15];let O=A[0],j=A[1],q=A[2],Y=A[3];return p[0]=O*w+j*C+q*R+Y*U,p[1]=O*M+j*N+q*F+Y*G,p[2]=O*T+j*P+q*V+Y*B,p[3]=O*E+j*L+q*z+Y*D,O=A[4],j=A[5],q=A[6],Y=A[7],p[4]=O*w+j*C+q*R+Y*U,p[5]=O*M+j*N+q*F+Y*G,p[6]=O*T+j*P+q*V+Y*B,p[7]=O*E+j*L+q*z+Y*D,O=A[8],j=A[9],q=A[10],Y=A[11],p[8]=O*w+j*C+q*R+Y*U,p[9]=O*M+j*N+q*F+Y*G,p[10]=O*T+j*P+q*V+Y*B,p[11]=O*E+j*L+q*z+Y*D,O=A[12],j=A[13],q=A[14],Y=A[15],p[12]=O*w+j*C+q*R+Y*U,p[13]=O*M+j*N+q*F+Y*G,p[14]=O*T+j*P+q*V+Y*B,p[15]=O*E+j*L+q*z+Y*D,p}function d(p,y,A){let w=A[0],M=A[1],T=A[2],E=Math.sqrt(w*w+M*M+T*T);if(Math.abs(E)<Li)return n(p);E=1/E,w*=E,M*=E,T*=E;const C=Math.sin(y),N=Math.cos(y),P=1-N;return p[0]=w*w*P+N,p[1]=M*w*P+T*C,p[2]=T*w*P-M*C,p[3]=0,p[4]=w*M*P-T*C,p[5]=M*M*P+N,p[6]=T*M*P+w*C,p[7]=0,p[8]=w*T*P+M*C,p[9]=M*T*P-w*C,p[10]=T*T*P+N,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}i.isIdentity=function(p,y){return o(p,s,y===void 0?Li:y)},i.hasNaN=function(p){for(let y=0;y<16;y++)if(isNaN(p[y]))return!0;return!1},i.areEqual=o,i.setValue=a,i.getValue=function(p,y,A){return p[4*A+y]},i.toArray=function(p,y,A){return y[A+0]=p[0],y[A+1]=p[1],y[A+2]=p[2],y[A+3]=p[3],y[A+4]=p[4],y[A+5]=p[5],y[A+6]=p[6],y[A+7]=p[7],y[A+8]=p[8],y[A+9]=p[9],y[A+10]=p[10],y[A+11]=p[11],y[A+12]=p[12],y[A+13]=p[13],y[A+14]=p[14],y[A+15]=p[15],y},i.fromArray=function(p,y,A){return p[0]=y[A+0],p[1]=y[A+1],p[2]=y[A+2],p[3]=y[A+3],p[4]=y[A+4],p[5]=y[A+5],p[6]=y[A+6],p[7]=y[A+7],p[8]=y[A+8],p[9]=y[A+9],p[10]=y[A+10],p[11]=y[A+11],p[12]=y[A+12],p[13]=y[A+13],p[14]=y[A+14],p[15]=y[A+15],p},i.fromBasis=function(p,y,A,w){return r(p),a(p,0,0,y[0]),a(p,1,0,y[1]),a(p,2,0,y[2]),a(p,0,1,A[0]),a(p,1,1,A[1]),a(p,2,1,A[2]),a(p,0,2,w[0]),a(p,1,2,w[1]),a(p,2,2,w[2]),a(p,3,3,1),p},i.copy=l,i.clone=function(p){return l(e(),p)},i.getTranslation=function(p,y){return p[0]=y[12],p[1]=y[13],p[2]=y[14],p},i.getScaling=function(p,y){const A=y[0],w=y[1],M=y[2],T=y[4],E=y[5],C=y[6],N=y[8],P=y[9],L=y[10];return p[0]=Math.sqrt(A*A+w*w+M*M),p[1]=Math.sqrt(T*T+E*E+C*C),p[2]=Math.sqrt(N*N+P*P+L*L),p},i.getRotation=c,i.extractRotation=function(p,y){const A=1/Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),w=1/Math.sqrt(y[4]*y[4]+y[5]*y[5]+y[6]*y[6]),M=1/Math.sqrt(y[8]*y[8]+y[9]*y[9]+y[10]*y[10]);return p[0]=y[0]*A,p[1]=y[1]*A,p[2]=y[2]*A,p[3]=0,p[4]=y[4]*w,p[5]=y[5]*w,p[6]=y[6]*w,p[7]=0,p[8]=y[8]*M,p[9]=y[9]*M,p[10]=y[10]*M,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},i.transpose=function(p,y){if(p===y){const A=y[1],w=y[2],M=y[3],T=y[6],E=y[7],C=y[11];p[1]=y[4],p[2]=y[8],p[3]=y[12],p[4]=A,p[6]=y[9],p[7]=y[13],p[8]=w,p[9]=T,p[11]=y[14],p[12]=M,p[13]=E,p[14]=C}else p[0]=y[0],p[1]=y[4],p[2]=y[8],p[3]=y[12],p[4]=y[1],p[5]=y[5],p[6]=y[9],p[7]=y[13],p[8]=y[2],p[9]=y[6],p[10]=y[10],p[11]=y[14],p[12]=y[3],p[13]=y[7],p[14]=y[11],p[15]=y[15];return p},i.tryInvert=u,i.invert=function(p,y){return u(p,y)||console.warn("non-invertible matrix.",y),p},i.mul=h,i.mulOffset=function(p,y,A,w,M,T){const E=y[0+M],C=y[1+M],N=y[2+M],P=y[3+M],L=y[4+M],R=y[5+M],F=y[6+M],V=y[7+M],z=y[8+M],U=y[9+M],G=y[10+M],B=y[11+M],D=y[12+M],O=y[13+M],j=y[14+M],q=y[15+M];let Y=A[0+T],ie=A[1+T],ne=A[2+T],Q=A[3+T];return p[0+w]=Y*E+ie*L+ne*z+Q*D,p[1+w]=Y*C+ie*R+ne*U+Q*O,p[2+w]=Y*N+ie*F+ne*G+Q*j,p[3+w]=Y*P+ie*V+ne*B+Q*q,Y=A[4+T],ie=A[5+T],ne=A[6+T],Q=A[7+T],p[4+w]=Y*E+ie*L+ne*z+Q*D,p[5+w]=Y*C+ie*R+ne*U+Q*O,p[6+w]=Y*N+ie*F+ne*G+Q*j,p[7+w]=Y*P+ie*V+ne*B+Q*q,Y=A[8+T],ie=A[9+T],ne=A[10+T],Q=A[11+T],p[8+w]=Y*E+ie*L+ne*z+Q*D,p[9+w]=Y*C+ie*R+ne*U+Q*O,p[10+w]=Y*N+ie*F+ne*G+Q*j,p[11+w]=Y*P+ie*V+ne*B+Q*q,Y=A[12+T],ie=A[13+T],ne=A[14+T],Q=A[15+T],p[12+w]=Y*E+ie*L+ne*z+Q*D,p[13+w]=Y*C+ie*R+ne*U+Q*O,p[14+w]=Y*N+ie*F+ne*G+Q*j,p[15+w]=Y*P+ie*V+ne*B+Q*q,p},i.mul3=function(p,y,A,w){return h(p,h(p,y,A),w)},i.translate=function(p,y,A){const w=A[0],M=A[1],T=A[2];let E,C,N,P,L,R,F,V,z,U,G,B;return y===p?(p[12]=y[0]*w+y[4]*M+y[8]*T+y[12],p[13]=y[1]*w+y[5]*M+y[9]*T+y[13],p[14]=y[2]*w+y[6]*M+y[10]*T+y[14],p[15]=y[3]*w+y[7]*M+y[11]*T+y[15]):(E=y[0],C=y[1],N=y[2],P=y[3],L=y[4],R=y[5],F=y[6],V=y[7],z=y[8],U=y[9],G=y[10],B=y[11],p[0]=E,p[1]=C,p[2]=N,p[3]=P,p[4]=L,p[5]=R,p[6]=F,p[7]=V,p[8]=z,p[9]=U,p[10]=G,p[11]=B,p[12]=E*w+L*M+z*T+y[12],p[13]=C*w+R*M+U*T+y[13],p[14]=N*w+F*M+G*T+y[14],p[15]=P*w+V*M+B*T+y[15]),p},i.fromTranslation=function(p,y){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=y[0],p[13]=y[1],p[14]=y[2],p[15]=1,p},i.setTranslation=function(p,y){return p[12]=y[0],p[13]=y[1],p[14]=y[2],p},i.setAxes=function(p,y,A,w){return p[0]=A[0],p[4]=A[1],p[8]=A[2],p[1]=w[0],p[5]=w[1],p[9]=w[2],p[2]=y[0],p[6]=y[1],p[10]=y[2],p},i.rotate=function(p,y,A,w){let M=w[0],T=w[1],E=w[2],C=Math.sqrt(M*M+T*T+E*E);if(Math.abs(C)<Li)return t();C=1/C,M*=C,T*=C,E*=C;const N=Math.sin(A),P=Math.cos(A),L=1-P,R=y[0],F=y[1],V=y[2],z=y[3],U=y[4],G=y[5],B=y[6],D=y[7],O=y[8],j=y[9],q=y[10],Y=y[11],ie=M*M*L+P,ne=T*M*L+E*N,Q=E*M*L-T*N,le=M*T*L-E*N,se=T*T*L+P,oe=E*T*L+M*N,$=M*E*L+T*N,pe=T*E*L-M*N,xe=E*E*L+P;return p[0]=R*ie+U*ne+O*Q,p[1]=F*ie+G*ne+j*Q,p[2]=V*ie+B*ne+q*Q,p[3]=z*ie+D*ne+Y*Q,p[4]=R*le+U*se+O*oe,p[5]=F*le+G*se+j*oe,p[6]=V*le+B*se+q*oe,p[7]=z*le+D*se+Y*oe,p[8]=R*$+U*pe+O*xe,p[9]=F*$+G*pe+j*xe,p[10]=V*$+B*pe+q*xe,p[11]=z*$+D*pe+Y*xe,y!==p&&(p[12]=y[12],p[13]=y[13],p[14]=y[14],p[15]=y[15]),p},i.fromRotation=d,i.scale=function(p,y,A){const w=A[0],M=A[1],T=A[2];return p[0]=y[0]*w,p[1]=y[1]*w,p[2]=y[2]*w,p[3]=y[3]*w,p[4]=y[4]*M,p[5]=y[5]*M,p[6]=y[6]*M,p[7]=y[7]*M,p[8]=y[8]*T,p[9]=y[9]*T,p[10]=y[10]*T,p[11]=y[11]*T,p[12]=y[12],p[13]=y[13],p[14]=y[14],p[15]=y[15],p},i.scaleUniformly=function(p,y,A){return p[0]=y[0]*A,p[1]=y[1]*A,p[2]=y[2]*A,p[3]=y[3]*A,p[4]=y[4]*A,p[5]=y[5]*A,p[6]=y[6]*A,p[7]=y[7]*A,p[8]=y[8]*A,p[9]=y[9]*A,p[10]=y[10]*A,p[11]=y[11]*A,p[12]=y[12],p[13]=y[13],p[14]=y[14],p[15]=y[15],p},i.fromScaling=function(p,y){return p[0]=y[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=y[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=y[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},i.fromUniformScaling=function(p,y){return p[0]=y,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=y,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=y,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},i.fromMat3=function(p,y){return p[0]=y[0],p[1]=y[1],p[2]=y[2],p[4]=y[3],p[5]=y[4],p[6]=y[5],p[8]=y[6],p[9]=y[7],p[10]=y[8],p},i.compose=function(p,y,A,w){const[M,T,E,C]=A,N=M+M,P=T+T,L=E+E,R=M*N,F=M*P,V=M*L,z=T*P,U=T*L,G=E*L,B=C*N,D=C*P,O=C*L,[j,q,Y]=w;return p[0]=(1-(z+G))*j,p[1]=(F+O)*j,p[2]=(V-D)*j,p[3]=0,p[4]=(F-O)*q,p[5]=(1-(R+G))*q,p[6]=(U+B)*q,p[7]=0,p[8]=(V+D)*Y,p[9]=(U-B)*Y,p[10]=(1-(R+z))*Y,p[11]=0,p[12]=y[0],p[13]=y[1],p[14]=y[2],p[15]=1,p};const f=[0,0,0],m=e();function _(p){const y=p[0],A=p[1],w=p[2],M=p[3],T=p[4],E=p[5],C=p[6],N=p[7],P=p[8],L=p[9],R=p[10],F=p[11],V=p[12],z=p[13],U=p[14],G=p[15];return(y*E-A*T)*(R*G-F*U)-(y*C-w*T)*(L*G-F*z)+(y*N-M*T)*(L*U-R*z)+(A*C-w*E)*(P*G-F*V)-(A*N-M*E)*(P*U-R*V)+(w*N-M*C)*(P*z-L*V)}i.decompose=function(p,y,A,w){let M=Nn.magnitude(Nn.set(f,p[0],p[1],p[2]));const T=Nn.magnitude(Nn.set(f,p[4],p[5],p[6])),E=Nn.magnitude(Nn.set(f,p[8],p[9],p[10]));_(p)<0&&(M=-M),y[0]=p[12],y[1]=p[13],y[2]=p[14],l(m,p);const C=1/M,N=1/T,P=1/E;return m[0]*=C,m[1]*=C,m[2]*=C,m[4]*=N,m[5]*=N,m[6]*=N,m[8]*=P,m[9]*=P,m[10]*=P,c(A,m),w[0]=M,w[1]=T,w[2]=E,p},i.makeTable=function(p){let y="";for(let A=0;A<4;A++){for(let w=0;w<4;w++)y+=p[4*w+A].toString(),w<3&&(y+=" ");A<3&&(y+=`
`)}return y},i.determinant=_,i.isRotationAndTranslation=function(p,y){return function(A,w){const M=A[0],T=A[1],E=A[2],C=A[3],N=A[4],P=A[5],L=A[6],R=A[7],F=A[8],V=A[9],z=A[10],U=A[11],G=A[15];return!(!(Pr(G,1,w)&&Pr(C,0,w)&&Pr(R,0,w)&&Pr(U,0,w))||!Pr(Math.abs(M*(P*z-L*V)-T*(N*z-L*F)+E*(N*V-P*F)),1,w))}(p,y!==void 0?y:Li)},i.isTranslationAndUniformScaling=function(p,y){return function(A,w){const M=A[0];return Pr(A[1],0,w)&&Pr(A[2],0,w)&&Pr(A[3],0,w)&&Pr(A[4],0,w)&&Pr(A[5],M,w)&&Pr(A[6],0,w)&&Pr(A[7],0,w)&&Pr(A[8],0,w)&&Pr(A[9],0,w)&&Pr(A[10],M,w)&&Pr(A[11],0,w)&&Pr(A[15],1,w)}(p,y!==void 0?y:Li)},i.fromQuat=function(p,y){const A=y[0],w=y[1],M=y[2],T=y[3],E=A+A,C=w+w,N=M+M,P=A*E,L=w*E,R=w*C,F=M*E,V=M*C,z=M*N,U=T*E,G=T*C,B=T*N;return p[0]=1-R-z,p[1]=L+B,p[2]=F-G,p[3]=0,p[4]=L-B,p[5]=1-P-z,p[6]=V+U,p[7]=0,p[8]=F+G,p[9]=V-U,p[10]=1-P-R,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},i.fromEuler=function(p,y,A){const w=y[0],M=y[1],T=y[2],E=Math.cos(w),C=Math.sin(w),N=Math.cos(M),P=Math.sin(M),L=Math.cos(T),R=Math.sin(T);if(A==="XYZ"){const F=E*L,V=E*R,z=C*L,U=C*R;p[0]=N*L,p[4]=-N*R,p[8]=P,p[1]=V+z*P,p[5]=F-U*P,p[9]=-C*N,p[2]=U-F*P,p[6]=z+V*P,p[10]=E*N}else if(A==="YXZ"){const F=N*L,V=N*R,z=P*L,U=P*R;p[0]=F+U*C,p[4]=z*C-V,p[8]=E*P,p[1]=E*R,p[5]=E*L,p[9]=-C,p[2]=V*C-z,p[6]=U+F*C,p[10]=E*N}else if(A==="ZXY"){const F=N*L,V=N*R,z=P*L,U=P*R;p[0]=F-U*C,p[4]=-E*R,p[8]=z+V*C,p[1]=V+z*C,p[5]=E*L,p[9]=U-F*C,p[2]=-E*P,p[6]=C,p[10]=E*N}else if(A==="ZYX"){const F=E*L,V=E*R,z=C*L,U=C*R;p[0]=N*L,p[4]=z*P-V,p[8]=F*P+U,p[1]=N*R,p[5]=U*P+F,p[9]=V*P-z,p[2]=-P,p[6]=C*N,p[10]=E*N}else if(A==="YZX"){const F=E*N,V=E*P,z=C*N,U=C*P;p[0]=N*L,p[4]=U-F*R,p[8]=z*R+V,p[1]=R,p[5]=E*L,p[9]=-C*L,p[2]=-P*L,p[6]=V*R+z,p[10]=F-U*R}else if(A==="XZY"){const F=E*N,V=E*P,z=C*N,U=C*P;p[0]=N*L,p[4]=-R,p[8]=P*L,p[1]=F*R+U,p[5]=E*L,p[9]=V*R-z,p[2]=z*R-V,p[6]=C*L,p[10]=U*R+F}return p[3]=0,p[7]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},i.perspective=function(p,y,A,w,M,T,E){const C=2*T/(A-y),N=2*T/(w-M),P=(A+y)/(A-y),L=(w+M)/(w-M),R=-(E+T)/(E-T),F=-2*E*T/(E-T);return p[0]=C,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=N,p[6]=0,p[7]=0,p[8]=P,p[9]=L,p[10]=R,p[11]=-1,p[12]=0,p[13]=0,p[14]=F,p[15]=0,p},i.ortho=function(p,y,A,w,M,T,E){const C=1/(A-y),N=1/(w-M),P=1/(E-T),L=(A+y)*C,R=(w+M)*N,F=(E+T)*P;return p[0]=2*C,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=2*N,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=-2*P,p[11]=0,p[12]=-L,p[13]=-R,p[14]=-F,p[15]=1,p},i.lookAt=function(p,y,A,w){let M,T,E,C,N,P,L,R,F,V;const z=y[0],U=y[1],G=y[2],B=w[0],D=w[1],O=w[2],j=A[0],q=A[1],Y=A[2];return Math.abs(z-j)<Li&&Math.abs(U-q)<Li&&Math.abs(G-Y)<Li?n(p):(L=z-j,R=U-q,F=G-Y,V=1/Math.sqrt(L*L+R*R+F*F),L*=V,R*=V,F*=V,M=D*F-O*R,T=O*L-B*F,E=B*R-D*L,V=Math.sqrt(M*M+T*T+E*E),V?(V=1/V,M*=V,T*=V,E*=V):(M=0,T=0,E=0),C=R*E-F*T,N=F*M-L*E,P=L*T-R*M,V=Math.sqrt(C*C+N*N+P*P),V?(V=1/V,C*=V,N*=V,P*=V):(C=0,N=0,P=0),p[0]=M,p[1]=C,p[2]=L,p[3]=0,p[4]=T,p[5]=N,p[6]=R,p[7]=0,p[8]=E,p[9]=P,p[10]=F,p[11]=0,p[12]=-(M*z+T*U+E*G),p[13]=-(C*z+N*U+P*G),p[14]=-(L*z+R*U+F*G),p[15]=1,p)},i.targetTo=function(p,y,A,w){const M=y[0],T=y[1],E=y[2],C=w[0],N=w[1],P=w[2];let L=M-A[0],R=T-A[1],F=E-A[2],V=L*L+R*R+F*F;V>0&&(V=1/Math.sqrt(V),L*=V,R*=V,F*=V);let z=N*F-P*R,U=P*L-C*F,G=C*R-N*L;return V=z*z+U*U+G*G,V>0&&(V=1/Math.sqrt(V),z*=V,U*=V,G*=V),p[0]=z,p[1]=U,p[2]=G,p[3]=0,p[4]=R*G-F*U,p[5]=F*z-L*G,p[6]=L*U-R*z,p[7]=0,p[8]=L,p[9]=R,p[10]=F,p[11]=0,p[12]=M,p[13]=T,p[14]=E,p[15]=1,p},i.fromPermutation=function(p,y){r(p);for(let A=0;A<4;A++)a(p,A,y[A],1);return p},i.getMaxScaleOnAxis=function(p){const y=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],A=p[4]*p[4]+p[5]*p[5]+p[6]*p[6],w=p[8]*p[8]+p[9]*p[9]+p[10]*p[10];return Math.sqrt(Math.max(y,A,w))};const v=[1,0,0],g=[0,1,0],b=[0,0,1];i.rotX90=d(e(),ph(90),v),i.rotX180=d(e(),ph(180),v),i.rotY90=d(e(),ph(90),g),i.rotY180=d(e(),ph(180),g),i.rotY270=d(e(),ph(270),g),i.rotZ90=d(e(),ph(90),b),i.rotZ180=d(e(),ph(180),b),i.rotXY90=h(e(),i.rotX90,i.rotY90),i.rotZY90=h(e(),i.rotZ90,i.rotY90),i.rotZYZ90=h(e(),i.rotZY90,i.rotZ90),i.rotZ90X180=h(e(),i.rotZ90,i.rotX180),i.rotY90Z180=h(e(),i.rotY90,i.rotZ180),i.id=t()})(ru||(ru={})),function(i){function e(){const w=[.1,0,0,0,0,0,0,0,0];return w[0]=0,w}function t(){const w=e();return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=1,w[5]=0,w[6]=0,w[7]=0,w[8]=1,w}function n(w,M){return w[0]=M[0],w[1]=M[1],w[2]=M[2],w[3]=M[4],w[4]=M[5],w[5]=M[6],w[6]=M[8],w[7]=M[9],w[8]=M[10],w}i.zero=e,i.identity=t,i.setIdentity=function(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=1,w[5]=0,w[6]=0,w[7]=0,w[8]=1,w},i.toArray=function(w,M,T){return M[T+0]=w[0],M[T+1]=w[1],M[T+2]=w[2],M[T+3]=w[3],M[T+4]=w[4],M[T+5]=w[5],M[T+6]=w[6],M[T+7]=w[7],M[T+8]=w[8],M},i.fromArray=function(w,M,T){return w[0]=M[T+0],w[1]=M[T+1],w[2]=M[T+2],w[3]=M[T+3],w[4]=M[T+4],w[5]=M[T+5],w[6]=M[T+6],w[7]=M[T+7],w[8]=M[T+8],w},i.fromColumns=function(w,M,T,E){return w[0]=M[0],w[1]=M[1],w[2]=M[2],w[3]=T[0],w[4]=T[1],w[5]=T[2],w[6]=E[0],w[7]=E[1],w[8]=E[2],w},i.fromMat4=n;const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];i.fromEuler=function(w,M,T){return ru.fromEuler(r,M,T),n(w,r)},i.create=function(w,M,T,E,C,N,P,L,R){const F=e();return F[0]=w,F[1]=M,F[2]=T,F[3]=E,F[4]=C,F[5]=N,F[6]=P,F[7]=L,F[8]=R,F};const s=t();function o(w,M,T){for(let E=0;E<9;E++)if(Math.abs(w[E]-M[E])>T)return!1;return!0}function a(w,M){return w[0]=M[0],w[1]=M[1],w[2]=M[2],w[3]=M[3],w[4]=M[4],w[5]=M[5],w[6]=M[6],w[7]=M[7],w[8]=M[8],w}function l(w,M){if(w===M){const T=M[1],E=M[2],C=M[5];w[1]=M[3],w[2]=M[6],w[3]=T,w[5]=M[7],w[6]=E,w[7]=C}else w[0]=M[0],w[1]=M[3],w[2]=M[6],w[3]=M[1],w[4]=M[4],w[5]=M[7],w[6]=M[2],w[7]=M[5],w[8]=M[8];return w}function c(w,M){const T=M[0],E=M[1],C=M[2],N=M[3],P=M[4],L=M[5],R=M[6],F=M[7],V=M[8],z=V*P-L*F,U=-V*N+L*R,G=F*N-P*R;let B=T*z+E*U+C*G;return B?(B=1/B,w[0]=z*B,w[1]=(-V*E+C*F)*B,w[2]=(L*E-C*P)*B,w[3]=U*B,w[4]=(V*T-C*R)*B,w[5]=(-L*T+C*N)*B,w[6]=G*B,w[7]=(-F*T+E*R)*B,w[8]=(P*T-E*N)*B,w):(console.warn("non-invertible matrix.",M),w)}function u(w){const M=w[0],T=w[1],E=w[2],C=w[3],N=w[4],P=w[5],L=w[6],R=w[7],F=w[8];return M*(F*N-P*R)+T*(-F*C+P*L)+E*(R*C-N*L)}function h(w){return w[0]+w[4]+w[8]}function d(w,M,T){return w[0]=M[0]-T[0],w[1]=M[1]-T[1],w[2]=M[2]-T[2],w[3]=M[3]-T[3],w[4]=M[4]-T[4],w[5]=M[5]-T[5],w[6]=M[6]-T[6],w[7]=M[7]-T[7],w[8]=M[8]-T[8],w}function f(w,M,T){return w[0]=M[0]*T,w[1]=M[1]*T,w[2]=M[2]*T,w[3]=M[3]*T,w[4]=M[4]*T,w[5]=M[5]*T,w[6]=M[6]*T,w[7]=M[7]*T,w[8]=M[8]*T,w}i.isIdentity=function(w,M){return o(w,s,M===void 0?Li:M)},i.hasNaN=function(w){for(let M=0;M<9;M++)if(isNaN(w[M]))return!0;return!1},i.clone=function(w){return a(e(),w)},i.areEqual=o,i.setValue=function(w,M,T,E){w[3*T+M]=E},i.getValue=function(w,M,T){return w[3*T+M]},i.copy=a,i.transpose=l,i.invert=c,i.symmtricFromUpper=function(w,M){return w===M?(w[3]=M[1],w[6]=M[2],w[7]=M[5]):(w[0]=M[0],w[1]=M[1],w[2]=M[2],w[3]=M[1],w[4]=M[4],w[5]=M[5],w[6]=M[2],w[7]=M[5],w[8]=M[8]),w},i.symmtricFromLower=function(w,M){return w===M?(w[1]=M[3],w[2]=M[6],w[5]=M[7]):(w[0]=M[0],w[1]=M[3],w[2]=M[6],w[3]=M[3],w[4]=M[4],w[5]=M[7],w[6]=M[6],w[7]=M[7],w[8]=M[8]),w},i.determinant=u,i.trace=h,i.sub=d,i.add=function(w,M,T){return w[0]=M[0]+T[0],w[1]=M[1]+T[1],w[2]=M[2]+T[2],w[3]=M[3]+T[3],w[4]=M[4]+T[4],w[5]=M[5]+T[5],w[6]=M[6]+T[6],w[7]=M[7]+T[7],w[8]=M[8]+T[8],w},i.mul=function(w,M,T){const E=M[0],C=M[1],N=M[2],P=M[3],L=M[4],R=M[5],F=M[6],V=M[7],z=M[8],U=T[0],G=T[1],B=T[2],D=T[3],O=T[4],j=T[5],q=T[6],Y=T[7],ie=T[8];return w[0]=U*E+G*P+B*F,w[1]=U*C+G*L+B*V,w[2]=U*N+G*R+B*z,w[3]=D*E+O*P+j*F,w[4]=D*C+O*L+j*V,w[5]=D*N+O*R+j*z,w[6]=q*E+Y*P+ie*F,w[7]=q*C+Y*L+ie*V,w[8]=q*N+Y*R+ie*z,w},i.subScalar=function(w,M,T){return w[0]=M[0]-T,w[1]=M[1]-T,w[2]=M[2]-T,w[3]=M[3]-T,w[4]=M[4]-T,w[5]=M[5]-T,w[6]=M[6]-T,w[7]=M[7]-T,w[8]=M[8]-T,w},i.addScalar=function(w,M,T){return w[0]=M[0]+T,w[1]=M[1]+T,w[2]=M[2]+T,w[3]=M[3]+T,w[4]=M[4]+T,w[5]=M[5]+T,w[6]=M[6]+T,w[7]=M[7]+T,w[8]=M[8]+T,w},i.mulScalar=f;const m=Math.PI/3,_=e();i.symmetricEigenvalues=function(w,M){const T=M[1]*M[1]+M[2]*M[2]+M[5]*M[5];if(T===0)w[0]=M[0],w[1]=M[4],w[2]=M[8];else{const E=h(M)/3,C=M[0]-E,N=M[4]-E,P=M[8]-E,L=C*C+N*N+P*P+2*T,R=Math.sqrt(L/6);f(_,i.Identity,E),d(_,M,_),f(_,_,1/R);const F=u(_)/2,V=F<=-1?m:F>=1?0:Math.acos(F)/3;w[0]=E+2*R*Math.cos(V),w[2]=E+2*R*Math.cos(V+2*m),w[1]=3*E-w[0]-w[2]}return w};const v=[.1,0,0],g=[.1,0,0],b=[.1,0,0],p=[.1,0,0],y=[.1,0,0],A=[.1,0,0];i.eigenvector=function(w,M,T){Nn.set(v,M[0]-T,M[1],M[2]),Nn.set(g,M[1],M[4]-T,M[5]),Nn.set(b,M[2],M[5],M[8]-T),Nn.cross(p,v,g),Nn.cross(y,v,b),Nn.cross(A,g,b);const E=Nn.dot(p,p),C=Nn.dot(y,y),N=Nn.dot(A,A);let P=E,L=0;return C>P&&(P=C,L=1),N>P&&(L=2),L===0?Nn.scale(w,p,1/Math.sqrt(E)):L===1?Nn.scale(w,y,1/Math.sqrt(C)):Nn.scale(w,A,1/Math.sqrt(N)),w},i.directionTransform=function(w,M){return n(w,M),c(w,w),l(w,w),w},i.Identity=t(),i.innerProduct=function(w,M){return w[0]*M[0]+w[1]*M[1]+w[2]*M[2]+w[3]*M[3]+w[4]*M[4]+w[5]*M[5]+w[6]*M[6]+w[7]*M[7]+w[8]*M[8]}}(Sx||(Sx={})),function(i){function e(){const t=[.1,0];return t[0]=0,t}i.zero=e,i.clone=function(t){const n=e();return n[0]=t[0],n[1]=t[1],n},i.create=function(t,n){const r=e();return r[0]=t,r[1]=n,r},i.hasNaN=function(t){return isNaN(t[0])||isNaN(t[1])},i.toArray=function(t,n,r){return n[r+0]=t[0],n[r+1]=t[1],n},i.fromArray=function(t,n,r){return t[0]=n[r+0],t[1]=n[r+1],t},i.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t},i.set=function(t,n,r){return t[0]=n,t[1]=r,t},i.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t},i.sub=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t},i.mul=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t},i.div=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t},i.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t},i.round=function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t},i.ceil=function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t},i.floor=function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t},i.distance=function(t,n){const r=n[0]-t[0],s=n[1]-t[1];return Math.sqrt(r*r+s*s)},i.squaredDistance=function(t,n){const r=n[0]-t[0],s=n[1]-t[1];return r*r+s*s},i.magnitude=function(t){const n=t[0],r=t[1];return Math.sqrt(n*n+r*r)},i.squaredMagnitude=function(t){const n=t[0],r=t[1];return n*n+r*r},i.inverse=function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t},i.areEqual=function(t,n){return t[0]===n[0]&&t[1]===n[1]},i.toString=function(t,n){return`[${t[0].toPrecision(n)} ${t[1].toPrecision(n)}}]`}}(gC||(gC={})),function(i){function e(){const n=[.1,0,0,0];return n[0]=0,n}function t(n,r){return n[0]=r.center[0],n[1]=r.center[1],n[2]=r.center[2],n[3]=r.radius,n}i.zero=e,i.clone=function(n){const r=e();return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r},i.create=function(n,r,s,o){const a=e();return a[0]=n,a[1]=r,a[2]=s,a[3]=o,a},i.fromSphere=t,i.ofSphere=function(n){return t(e(),n)},i.hasNaN=function(n){return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])},i.toArray=function(n,r,s){return r[s+0]=n[0],r[s+1]=n[1],r[s+2]=n[2],r[s+3]=n[3],r},i.fromArray=function(n,r,s){return n[0]=r[s+0],n[1]=r[s+1],n[2]=r[s+2],n[3]=r[s+3],n},i.toVec3Array=function(n,r,s){r[s+0]=n[0],r[s+1]=n[1],r[s+2]=n[2]},i.fromVec3Array=function(n,r,s){return n[0]=r[s+0],n[1]=r[s+1],n[2]=r[s+2],n[3]=0,n},i.copy=function(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n},i.set=function(n,r,s,o,a){return n[0]=r,n[1]=s,n[2]=o,n[3]=a,n},i.add=function(n,r,s){return n[0]=r[0]+s[0],n[1]=r[1]+s[1],n[2]=r[2]+s[2],n[3]=r[3]+s[3],n},i.distance=function(n,r){const s=r[0]-n[0],o=r[1]-n[1],a=r[2]-n[2],l=r[3]-n[3];return Math.sqrt(s*s+o*o+a*a+l*l)},i.scale=function(n,r,s){return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[4]=r[4]*s,n},i.round=function(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n[2]=Math.round(r[2]),n[3]=Math.round(r[3]),n},i.ceil=function(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n[2]=Math.ceil(r[2]),n[3]=Math.ceil(r[3]),n},i.floor=function(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n[2]=Math.floor(r[2]),n[3]=Math.floor(r[3]),n},i.squaredDistance=function(n,r){const s=r[0]-n[0],o=r[1]-n[1],a=r[2]-n[2],l=r[3]-n[3];return s*s+o*o+a*a+l*l},i.norm=function(n){const r=n[0],s=n[1],o=n[2],a=n[3];return Math.sqrt(r*r+s*s+o*o+a*a)},i.squaredNorm=function(n){const r=n[0],s=n[1],o=n[2],a=n[3];return r*r+s*s+o*o+a*a},i.transformMat4=function(n,r,s){const o=r[0],a=r[1],l=r[2],c=r[3];return n[0]=s[0]*o+s[4]*a+s[8]*l+s[12]*c,n[1]=s[1]*o+s[5]*a+s[9]*l+s[13]*c,n[2]=s[2]*o+s[6]*a+s[10]*l+s[14]*c,n[3]=s[3]*o+s[7]*a+s[11]*l+s[15]*c,n},i.dot=function(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]+n[3]*r[3]},i.inverse=function(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n[3]=1/r[3],n},i.exactEquals=function(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]},i.equals=function(n,r){const s=n[0],o=n[1],a=n[2],l=n[3],c=r[0],u=r[1],h=r[2],d=r[3];return Math.abs(s-c)<=Li*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(o-u)<=Li*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(a-h)<=Li*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(l-d)<=Li*Math.max(1,Math.abs(l),Math.abs(d))},i.toString=function(n,r){return`[${n[0].toPrecision(r)} ${n[1].toPrecision(r)} ${n[2].toPrecision(r)}  ${n[3].toPrecision(r)}]`}}(vC||(vC={})),function(i){function e(){const m=[.1,0,0,0];return m[0]=0,m}function t(){const m=e();return m[3]=1,m}function n(m,_,v){v*=.5;const g=Math.sin(v);return m[0]=g*_[0],m[1]=g*_[1],m[2]=g*_[2],m[3]=Math.cos(v),m}function r(m,_,v,g){const b=_[0],p=_[1],y=_[2],A=_[3];let w,M,T,E,C,N=v[0],P=v[1],L=v[2],R=v[3];return M=b*N+p*P+y*L+A*R,M<0&&(M=-M,N=-N,P=-P,L=-L,R=-R),1-M>1e-6?(w=Math.acos(M),T=Math.sin(w),E=Math.sin((1-g)*w)/T,C=Math.sin(g*w)/T):(E=1-g,C=g),m[0]=E*b+C*N,m[1]=E*p+C*P,m[2]=E*y+C*L,m[3]=E*A+C*R,m}function s(m,_){const v=_[0]+_[4]+_[8];let g;if(v>0)g=Math.sqrt(v+1),m[3]=.5*g,g=.5/g,m[0]=(_[5]-_[7])*g,m[1]=(_[6]-_[2])*g,m[2]=(_[1]-_[3])*g;else{let b=0;_[4]>_[0]&&(b=1),_[8]>_[3*b+b]&&(b=2);const p=(b+1)%3,y=(b+2)%3;g=Math.sqrt(_[3*b+b]-_[3*p+p]-_[3*y+y]+1),m[b]=.5*g,g=.5/g,m[3]=(_[3*p+y]-_[3*y+p])*g,m[p]=(_[3*p+b]+_[3*b+p])*g,m[y]=(_[3*y+b]+_[3*b+y])*g}return m}i.zero=e,i.identity=t,i.setIdentity=function(m){m[0]=0,m[1]=0,m[2]=0,m[3]=1},i.hasNaN=function(m){return isNaN(m[0])||isNaN(m[1])||isNaN(m[2])||isNaN(m[3])},i.create=function(m,_,v,g){const b=t();return b[0]=m,b[1]=_,b[2]=v,b[3]=g,b},i.setAxisAngle=n,i.getAxisAngle=function(m,_){const v=2*Math.acos(_[3]),g=Math.sin(v/2);return g!==0?(m[0]=_[0]/g,m[1]=_[1]/g,m[2]=_[2]/g):(m[0]=1,m[1]=0,m[2]=0),v},i.multiply=function(m,_,v){const g=_[0],b=_[1],p=_[2],y=_[3],A=v[0],w=v[1],M=v[2],T=v[3];return m[0]=g*T+y*A+b*M-p*w,m[1]=b*T+y*w+p*A-g*M,m[2]=p*T+y*M+g*w-b*A,m[3]=y*T-g*A-b*w-p*M,m},i.rotateX=function(m,_,v){v*=.5;const g=_[0],b=_[1],p=_[2],y=_[3],A=Math.sin(v),w=Math.cos(v);return m[0]=g*w+y*A,m[1]=b*w+p*A,m[2]=p*w-b*A,m[3]=y*w-g*A,m},i.rotateY=function(m,_,v){v*=.5;const g=_[0],b=_[1],p=_[2],y=_[3],A=Math.sin(v),w=Math.cos(v);return m[0]=g*w-p*A,m[1]=b*w+y*A,m[2]=p*w+g*A,m[3]=y*w-b*A,m},i.rotateZ=function(m,_,v){v*=.5;const g=_[0],b=_[1],p=_[2],y=_[3],A=Math.sin(v),w=Math.cos(v);return m[0]=g*w+b*A,m[1]=b*w-g*A,m[2]=p*w+y*A,m[3]=y*w-p*A,m},i.calculateW=function(m,_){const v=_[0],g=_[1],b=_[2];return m[0]=v,m[1]=g,m[2]=b,m[3]=Math.sqrt(Math.abs(1-v*v-g*g-b*b)),m},i.slerp=r,i.invert=function(m,_){const v=_[0],g=_[1],b=_[2],p=_[3],y=v*v+g*g+b*b+p*p,A=y?1/y:0;return m[0]=-v*A,m[1]=-g*A,m[2]=-b*A,m[3]=p*A,m},i.conjugate=function(m,_){return m[0]=-_[0],m[1]=-_[1],m[2]=-_[2],m[3]=_[3],m},i.dot=function(m,_){return m[0]*_[0]+m[1]*_[1]+m[2]*_[2]+m[3]*_[3]},i.fromMat3=s,i.fromEuler=function(m,_,v){const[g,b,p]=_,y=Math.cos(g/2),A=Math.cos(b/2),w=Math.cos(p/2),M=Math.sin(g/2),T=Math.sin(b/2),E=Math.sin(p/2);switch(v){case"XYZ":m[0]=M*A*w+y*T*E,m[1]=y*T*w-M*A*E,m[2]=y*A*E+M*T*w,m[3]=y*A*w-M*T*E;break;case"YXZ":m[0]=M*A*w+y*T*E,m[1]=y*T*w-M*A*E,m[2]=y*A*E-M*T*w,m[3]=y*A*w+M*T*E;break;case"ZXY":m[0]=M*A*w-y*T*E,m[1]=y*T*w+M*A*E,m[2]=y*A*E+M*T*w,m[3]=y*A*w-M*T*E;break;case"ZYX":m[0]=M*A*w-y*T*E,m[1]=y*T*w+M*A*E,m[2]=y*A*E-M*T*w,m[3]=y*A*w+M*T*E;break;case"YZX":m[0]=M*A*w+y*T*E,m[1]=y*T*w+M*A*E,m[2]=y*A*E-M*T*w,m[3]=y*A*w-M*T*E;break;case"XZY":m[0]=M*A*w-y*T*E,m[1]=y*T*w-M*A*E,m[2]=y*A*E+M*T*w,m[3]=y*A*w+M*T*E;break;default:_b()}return m};const o=[0,0,0];function a(m,_){const v=_[0],g=_[1],b=_[2],p=_[3];let y=v*v+g*g+b*b+p*p;return y>0&&(y=1/Math.sqrt(y),m[0]=v*y,m[1]=g*y,m[2]=b*y,m[3]=p*y),m}i.fromUnitVec3=function(m,_,v){let g=Nn.dot(_,v)+1;return g<Li?(g=0,Math.abs(_[0])>Math.abs(_[2])?Nn.set(o,-_[1],_[0],0):Nn.set(o,0,-_[2],_[1])):Nn.cross(o,_,v),m[0]=o[0],m[1]=o[1],m[2]=o[2],m[3]=g,a(m,m),m},i.clone=function(m){const _=e();return _[0]=m[0],_[1]=m[1],_[2]=m[2],_[3]=m[3],_},i.toArray=function(m,_,v){return _[v+0]=m[0],_[v+1]=m[1],_[v+2]=m[2],_[v+3]=m[3],_},i.fromArray=function(m,_,v){return m[0]=_[v+0],m[1]=_[v+1],m[2]=_[v+2],m[3]=_[v+3],m},i.copy=function(m,_){return m[0]=_[0],m[1]=_[1],m[2]=_[2],m[3]=_[3],m},i.set=function(m,_,v,g,b){return m[0]=_,m[1]=v,m[2]=g,m[3]=b,m},i.exactEquals=function(m,_){return m[0]===_[0]&&m[1]===_[1]&&m[2]===_[2]&&m[3]===_[3]},i.equals=function(m,_){const v=m[0],g=m[1],b=m[2],p=m[3],y=_[0],A=_[1],w=_[2],M=_[3];return Math.abs(v-y)<=Li*Math.max(1,Math.abs(v),Math.abs(y))&&Math.abs(g-A)<=Li*Math.max(1,Math.abs(g),Math.abs(A))&&Math.abs(b-w)<=Li*Math.max(1,Math.abs(b),Math.abs(w))&&Math.abs(p-M)<=Li*Math.max(1,Math.abs(p),Math.abs(M))},i.add=function(m,_,v){return m[0]=_[0]+v[0],m[1]=_[1]+v[1],m[2]=_[2]+v[2],m[3]=_[3]+v[3],m},i.normalize=a;const l=[0,0,0],c=[1,0,0],u=[0,1,0];i.rotationTo=function(m,_,v){const g=Nn.dot(_,v);return g<-.999999?(Nn.cross(l,c,_),Nn.magnitude(l)<1e-6&&Nn.cross(l,u,_),Nn.normalize(l,l),n(m,l,Math.PI),m):g>.999999?(m[0]=0,m[1]=0,m[2]=0,m[3]=1,m):(Nn.cross(l,_,v),m[0]=l[0],m[1]=l[1],m[2]=l[2],m[3]=1+g,a(m,m))};const h=e(),d=e();i.sqlerp=function(m,_,v,g,b,p){return r(h,_,b,p),r(d,v,g,p),r(m,h,d,2*p*(1-p)),m};const f=[0,0,0,0,0,0,0,0,0];i.setAxes=function(m,_,v,g){return f[0]=v[0],f[3]=v[1],f[6]=v[2],f[1]=g[0],f[4]=g[1],f[7]=g[2],f[2]=-_[0],f[5]=-_[1],f[8]=-_[2],a(m,s(m,f))},i.toString=function(m,_){return`[${m[0].toPrecision(_)} ${m[1].toPrecision(_)} ${m[2].toPrecision(_)}  ${m[3].toPrecision(_)}]`},i.Identity=t()}(_C||(_C={})),function(i){function e(o,a,l){const c=function(_,v,g){const b=[];for(let y=0;y<v.length;y++)b[y]=v[v.length-y-1];const p=[1];for(let y=1;y<_.length;y++)p[y]=_[b[y-1]];return{dimensions:_,axisOrderFastToSlow:b,axisOrderSlowToFast:v,accessDimensions:p,defaultCtor:g||Float64Array}}(o,a,l),{get:u,set:h,add:d,dataOffset:f,getCoords:m}=t(c);return{rank:o.length,dimensions:o,axisOrderSlowToFast:a,create:n(c),get:u,set:h,add:d,dataOffset:f,getCoords:m}}function t(o){const{dimensions:a,axisOrderFastToSlow:l}=o;switch(a.length){case 1:return{get:(c,u)=>c[u],set:(c,u,h)=>c[u]=h,add:(c,u,h)=>c[u]+=h,dataOffset:c=>c,getCoords:(c,u)=>(u[0]=c,u)};case 2:if(l[0]===0&&l[1]===1){const c=a[0];return{get:(u,h,d)=>u[d*c+h],set:(u,h,d,f)=>u[d*c+h]=f,add:(u,h,d,f)=>u[d*c+h]+=f,dataOffset:(u,h)=>h*c+u,getCoords:(u,h)=>(h[0]=u%c,h[1]=Math.floor(u/c),h)}}if(l[0]===1&&l[1]===0){const c=a[1];return{get:(u,h,d)=>u[h*c+d],set:(u,h,d,f)=>u[h*c+d]=f,add:(u,h,d,f)=>u[h*c+d]+=f,dataOffset:(u,h)=>u*c+h,getCoords:(u,h)=>(h[0]=Math.floor(u/c),h[1]=u%c,h)}}throw new Error("bad axis order");case 3:if(l[0]===0&&l[1]===1&&l[2]===2){const c=a[0],u=a[1],h=c*u;return{get:(d,f,m,_)=>d[f+m*c+_*h],set:(d,f,m,_,v)=>d[f+m*c+_*h]=v,add:(d,f,m,_,v)=>d[f+m*c+_*h]+=v,dataOffset:(d,f,m)=>d+f*c+m*h,getCoords:(d,f)=>{const m=Math.floor(d/c);return f[0]=d%c,f[1]=m%u,f[2]=Math.floor(m/u),f}}}if(l[0]===0&&l[1]===2&&l[2]===1){const c=a[0],u=a[2],h=c*u;return{get:(d,f,m,_)=>d[f+_*c+m*h],set:(d,f,m,_,v)=>d[f+_*c+m*h]=v,add:(d,f,m,_,v)=>d[f+_*c+m*h]+=v,dataOffset:(d,f,m)=>d+m*c+f*h,getCoords:(d,f)=>{const m=Math.floor(d/c);return f[0]=d%c,f[1]=Math.floor(m/u),f[2]=m%u,f}}}if(l[0]===1&&l[1]===0&&l[2]===2){const c=a[1],u=a[0],h=c*u;return{get:(d,f,m,_)=>d[m+f*c+_*h],set:(d,f,m,_,v)=>d[m+f*c+_*h]=v,add:(d,f,m,_,v)=>d[m+f*c+_*h]+=v,dataOffset:(d,f,m)=>f+d*c+m*h,getCoords:(d,f)=>{const m=Math.floor(d/c);return f[0]=m%u,f[1]=d%c,f[2]=Math.floor(m/u),f}}}if(l[0]===1&&l[1]===2&&l[2]===0){const c=a[1],u=a[2],h=c*u;return{get:(d,f,m,_)=>d[m+_*c+f*h],set:(d,f,m,_,v)=>d[m+_*c+f*h]=v,add:(d,f,m,_,v)=>d[m+_*c+f*h]+=v,dataOffset:(d,f,m)=>f+m*c+d*h,getCoords:(d,f)=>{const m=Math.floor(d/c);return f[0]=Math.floor(m/u),f[1]=d%c,f[2]=m%u,f}}}if(l[0]===2&&l[1]===0&&l[2]===1){const c=a[2],u=a[0],h=c*u;return{get:(d,f,m,_)=>d[_+f*c+m*h],set:(d,f,m,_,v)=>d[_+f*c+m*h]=v,add:(d,f,m,_,v)=>d[_+f*c+m*h]+=v,dataOffset:(d,f,m)=>m+d*c+f*h,getCoords:(d,f)=>{const m=Math.floor(d/c);return f[0]=m%u,f[1]=Math.floor(m/u),f[2]=d%c,f}}}if(l[0]===2&&l[1]===1&&l[2]===0){const c=a[2],u=a[1],h=c*u;return{get:(d,f,m,_)=>d[_+m*c+f*h],set:(d,f,m,_,v)=>d[_+m*c+f*h]=v,add:(d,f,m,_,v)=>d[_+m*c+f*h]+=v,dataOffset:(d,f,m)=>m+f*c+d*h,getCoords:(d,f)=>{const m=Math.floor(d/c);return f[0]=Math.floor(m/u),f[1]=m%u,f[2]=d%c,f}}}throw new Error("bad axis order");default:return{get:(c,...u)=>c[r(o,u)],set:(c,...u)=>c[r(o,u)]=u[u.length-1],add:(c,...u)=>c[r(o,u)]+=u[u.length-1],dataOffset:(...c)=>r(o,c),getCoords:(c,u)=>function(h,d,f){const{dimensions:m,axisOrderFastToSlow:_}=h,v=m.length;let g=d;for(let b=0;b<v;b++){const p=m[_[b]];f[_[b]]=g%p,g=Math.floor(g/p)}return f[_[v+1]]=g,f}(o,c,u)}}}function n(o){const{dimensions:a}=o;let l=1;for(let c=0,u=a.length;c<u;c++)l*=a[c];return c=>new(c||o.defaultCtor)(l)}function r(o,a){const{accessDimensions:l,axisOrderFastToSlow:c}=o,u=l.length-1;let h=l[u]*a[c[u]];for(let d=u-1;d>=0;d--)h=(h+a[c[d]])*l[d];return h}function s(o,a){const l=[];for(let c=0;c<o.length;c++)l[c]=o[a[c]];return l}i.create=function(o,a){return{space:o,data:a}},i.Space=e,i.Data1=function(o){return o},i.Vector=function(o,a){return e([o],[0],a)},i.ColumnMajorMatrix=function(o,a,l){return e([o,a],[1,0],l)},i.RowMajorMatrix=function(o,a,l){return e([o,a],[0,1],l)},i.toMat4=function(o,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const c=Math.min(4,a.dimensions[0]),u=Math.min(4,a.dimensions[1]);for(let h=0;h<c;h++)for(let d=0;d<u;d++)ru.setValue(o,h,d,a.get(l,h,d));return o},i.toMat3=function(o,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const c=Math.min(3,a.dimensions[0]),u=Math.min(3,a.dimensions[1]);for(let h=0;h<c;h++)for(let d=0;d<u;d++)Sx.setValue(o,h,d,a.get(l,h,d));return o},i.toVec3=function(o,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const c=Math.min(3,a.dimensions[0]);for(let u=0;u<c;u++)o[u]=l[u];return o},i.toVec4=function(o,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const c=Math.min(4,a.dimensions[0]);for(let u=0;u<c;u++)o[u]=l[u];return o},i.areEqualExact=function(o,a){const l=o.length;if(l!==a.length)return!1;for(let c=0;c<l;c++)if(o[c]!==a[c])return!1;return!0},i.invertAxisOrder=function(o){const a=[];for(let l=0;l<o.length;l++)a[l]=o[o.length-l-1];return a},i.convertToCanonicalAxisIndicesFastToSlow=function(o){const a=new Int32Array(o.length);for(let l=0;l<o.length;l++)a[o[l]]=l;return l=>s(l,a)},i.convertToCanonicalAxisIndicesSlowToFast=function(o){const a=new Int32Array(o.length);for(let l=0;l<o.length;l++)a[o[o.length-l-1]]=l;return l=>s(l,a)}}(Dg||(Dg={})),function(i){let e;function t(r,s){return xU(s.T,r,s,1)}function n(r){return xy(r)}(function(r){function s(o,a=r.float){return{"@type":"tensor",T:o.create(),space:o,valueType:"tensor",baseType:a}}r.str={"@type":"str",T:"",valueType:"str"},r.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},r.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},r.int={"@type":"int",T:0,valueType:"int"},r.coord={"@type":"coord",T:0,valueType:"float"},r.float={"@type":"float",T:0,valueType:"float"},r.Str=function(o){var a;return{"@type":"str",T:(a=o==null?void 0:o.defaultValue)!==null&&a!==void 0?a:"",transform:o==null?void 0:o.transform,valueType:"str"}},r.Int=function(o=0){return{"@type":"int",T:o,valueType:"int"}},r.Float=function(o=0){return{"@type":"float",T:o,valueType:"float"}},r.Tensor=s,r.Vector=function(o,a=r.float){return s(Dg.Vector(o,a["@type"]==="int"?Int32Array:Float64Array),a)},r.Matrix=function(o,a,l=r.float){return s(Dg.ColumnMajorMatrix(o,a,l["@type"]==="int"?Int32Array:Float64Array),l)},r.Aliased=function(o){return o},r.List=function(o,a,l=[]){return{"@type":"list",T:l,separator:o,itemParse:a,valueType:"list"}}})(e=i.Schema||(i.Schema={})),i.is=function(r){return!!r&&!!r.schema&&!!r.value},i.ValueKind={Present:0,NotPresent:1,Unknown:2},i.Undefined=t,i.ofConst=function(r,s,o){return xU(r,s,o,0)},i.ofLambda=n,i.range=function(r,s){return n({value:o=>o+r,rowCount:Math.max(s-r+1,0),schema:e.int})},i.ofArray=function(r){return Hl(r)},i.ofIntArray=function(r){return Hl({array:r,schema:e.int})},i.ofFloatArray=function(r){return Hl({array:r,schema:e.float})},i.ofStringArray=function(r){return Hl({array:r,schema:e.str})},i.ofStringAliasArray=function(r){return Hl({array:r,schema:e.Aliased(e.str)})},i.ofStringListArray=function(r,s=","){return Hl({array:r,schema:e.List(s,o=>o)})},i.ofIntTokens=function(r){const{count:s,data:o,indices:a}=r;return xy({value:l=>xp(o,a[2*l],a[2*l+1])||0,rowCount:s,schema:e.int})},i.ofFloatTokens=function(r){const{count:s,data:o,indices:a}=r;return xy({value:l=>r0(o,a[2*l],a[2*l+1])||0,rowCount:s,schema:e.float})},i.ofStringTokens=function(r){const{count:s,data:o,indices:a}=r;return xy({value:l=>{const c=o.substring(a[2*l],a[2*l+1]);return c==="."||c==="?"?"":c},rowCount:s,schema:e.str})},i.window=function(r,s,o){return Khe(r,s,o)},i.view=function(r,s,o=!0){return Zhe(r,s,o)},i.createFirstIndexMap=function(r){return function(s){const o=new Map;for(let a=0,l=s.rowCount;a<l;a++){const c=s.value(a);o.has(c)||o.set(s.value(a),a)}return o}(r)},i.createIndexer=function(r){return function(s){const o=new Map;for(let a=0,l=s.rowCount;a<l;a++){const c=s.value(a);o.has(c)||o.set(s.value(a),a)}return a=>o.has(a)?o.get(a):-1}(r)},i.mapToArray=function(r,s,o){return function(a,l,c){const u=new c(a.rowCount);for(let h=0,d=a.rowCount;h<d;h++)u[h]=l(a.value(h));return u}(r,s,o||Array)},i.areEqual=function(r,s){return function(o,a){return o===a||o.rowCount===a.rowCount&&o.isDefined===a.isDefined&&o.schema.valueType===a.schema.valueType&&(o.__array&&a.__array?function(l,c){const u=l.__array,h=c.__array;for(let d=0,f=l.rowCount;d<f;d++)if(u[d]!==h[d])return!1;return!0}(o,a):function(l,c){const u=l.value,h=c.value;for(let d=0,f=l.rowCount;d<f;d++)if(u(d)!==h(d))return!1;return!0}(o,a))}(r,s)},i.indicesOf=function(r,s){return function(o,a){const l=[],c=o.value;for(let u=0,h=o.rowCount;u<h;u++)a(c(u))&&(l[l.length]=u);return l}(r,s)},i.asArrayColumn=function(r,s){return r.__array?r:r.isDefined?Hl({array:r.toArray({array:s}),schema:r.schema,valueKind:r.valueKind}):t(r.rowCount,r.schema)},i.copyToArray=function(r,s,o=0){if(!r.isDefined)return;const a=r.__array;if(a)for(let l=0,c=a.length;l<c;l++)s[o+l]=a[l];else for(let l=0,c=r.rowCount;l<c;l++)s[o+l]=r.value(l)},i.isIdentity=function(r){for(let s=0,o=r.rowCount;s<o;s++)if(s!==r.value(s))return!1;return!0}}(si||(si={})),function(i){i.create=function(e){return e},i.has=function(e,t){return!!(e&t)},i.hasAll=function(e,t){return!!t&&(e&t)===t}}(_U||(_U={})),function(i){i.create=function(r=512){return{current:[],offset:0,capacity:r,chunks:[]}},i.getString=function(r){return r.chunks.length?(r.offset>0&&(r.chunks[r.chunks.length]=r.current.length===r.offset?r.current.join(""):r.current.slice(0,r.offset).join("")),r.chunks.join("")):r.current.length===r.offset?r.current.join(""):r.current.splice(0,r.offset).join("")},i.getSize=function(r){let s=0;for(const o of r.chunks)s+=o.length;for(let o=0;o<r.offset;o++)s+=r.current[o].length;return s},i.getChunks=function(r){return r.offset>0&&(r.current.length===r.offset?r.chunks[r.chunks.length]=r.current.join(""):r.chunks[r.chunks.length]=r.current.slice(0,r.offset).join(""),r.offset=0),r.chunks};const e=[];function t(r,s){s>0&&n(r,e[s])}function n(r,s){r.offset===r.capacity&&(r.chunks[r.chunks.length]=r.current.join(""),r.offset=0),r.current[r.offset++]=s}(function(){let r="";for(let s=0;s<512;s++)e[s]=r,r+=" "})(),i.newline=function(r){n(r,`
`)},i.whitespace=t,i.whitespace1=function(r){n(r," ")},i.write=function(r,s){s&&(r.offset===r.capacity&&(r.chunks[r.chunks.length]=r.current.join(""),r.offset=0),r.current[r.offset++]=s)},i.writeSafe=n,i.writePadLeft=function(r,s,o){if(!s)return void t(r,o);t(r,o-s.length),n(r,s)},i.writePadRight=function(r,s,o){if(!s)return void t(r,o);const a=o-s.length;n(r,s),t(r,a)},i.writeInteger=function(r,s){n(r,""+s)},i.writeIntegerAndSpace=function(r,s){n(r,s+" ")},i.writeIntegerPadLeft=function(r,s,o){const a=""+s;t(r,o-a.length),n(r,a)},i.writeIntegerPadRight=function(r,s,o){const a=""+s,l=o-a.length;n(r,a),t(r,l)},i.writeFloat=function(r,s,o){n(r,""+Math.round(o*s)/o)},i.writeFloatPadLeft=function(r,s,o,a){const l=""+Math.round(o*s)/o;t(r,a-l.length),n(r,l)},i.writeFloatPadRight=function(r,s,o,a){const l=""+Math.round(o*s)/o,c=a-l.length;n(r,l),t(r,c)}}(ys||(ys={}));const cl=function(){if(typeof window<"u"&&window.performance){const i=window.performance;return()=>i.now()}return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?()=>{const i=process.hrtime();return 1e3*i[0]+i[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();var bU,SU,s0;function ide(i,e){return i-e}function NV(i=0,e=Number.MAX_SAFE_INTEGER){let t=i;return()=>{const n=t;return t=(t+1)%e,n}}(function(i){const e=typeof btoa<"u"?btoa:n=>Buffer.from(n).toString("base64"),t=[];i.create22=function(){let n=+new Date+cl();for(let r=0;r<16;r++)t[r]=String.fromCharCode((n+255*Math.random())%255|0),n=Math.floor(n/255);return e(t.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},i.createv4=function(){let n=+new Date+cl();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const s=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(r==="x"?s:3&s|8).toString(16)})},i.is=function(n){return typeof n=="string"}})(bU||(bU={})),function(i){class e{has(c){return!1}forEach(c,u){return u}constructor(){this.size=0}}class t{has(c){return c===this.idx}forEach(c,u){return c(this.idx,u),u}constructor(c){this.idx=c,this.size=1}}class n{has(c){return c<this.length&&!!this.mask[c]}_forEach(c,u){for(let h=0;h<this.length;h++)this.mask[h]&&c(h,u)}forEach(c,u){return this._forEach(c,u),u}constructor(c,u){this.mask=c,this.size=u,this.length=c.length}}class r{has(c){return!0}_forEach(c,u){for(let h=0;h<this.size;h++)c(h,u)}forEach(c,u){return this._forEach(c,u),u}constructor(c){this.size=c}}class s{has(c){return this.set.has(c)}_forEach(c,u){for(const h of this.flatten())c(h,u)}flatten(){if(this._flat)return this._flat;const c=new Int32Array(this.size);let u=0;return this.set.forEach(h=>c[u++]=h),function(h){Array.prototype.sort.call(h,ide)}(c),this._flat=c,this._flat}forEach(c,u){return this._forEach(c,u),u}constructor(c){this.set=c,this._flat=void 0,this.size=c.size}}function o(l){return new s(l)}function a(l,c){return new n(l,c)}i.always=function(l){return new r(l)},i.never=new e,i.ofSet=o,i.singleton=function(l){return new t(l)},i.ofUniqueIndices=function(l){const c=l.length;if(c===0)return new e;if(c===1)return new t(l[0]);let u=0;for(const d of l)d>u&&(u=d);if(c===u)return new r(c);if(c/u<1/12){const d=new Set;for(const f of l)d.add(f);return new s(d)}const h=new Int8Array(u+1);for(const d of l)h[d]=1;return new n(h,l.length)},i.ofMask=a,i.hasAny=function(l,c){for(const u of c)if(l.has(u))return!0;return!1},i.complement=function(l,c){let u=0,h=0;if(c.forEach(d=>{l.has(d)||(u++,d>h&&(h=d))}),u/h<1/12){const d=new Set;return c.forEach(f=>{l.has(f)||d.add(f)}),o(d)}{const d=new Uint8Array(h+1);return c.forEach(f=>{l.has(f)||(d[f]=1)}),a(d,u)}}}(SU||(SU={})),function(i){i.create=function(e){return{ref:e}},i.set=function(e,t){return e.ref=t,e}}(s0||(s0={}));const rde=NV(0,2147483647);var by,wU,Sy,bC,bp;function sde(i){const{data:e,indices:t}=i;return function(n,r){const s=t[2*n],o=t[2*r],a=t[2*n+1]-s;if(a!==t[2*r+1]-o)return!1;for(let l=0;l<a;l++)if(e.charCodeAt(l+s)!==e.charCodeAt(l+o))return!1;return!0}}function FV(i,e){return{name:e,blocks:i}}function r3(i,e,t,n=[]){return{categoryNames:i,header:t,categories:e,saveFrames:n,getField(r){const[s,o]=r.split(".");return e[s].getField(o||"")}}}function yb(i,e,t,n){return{rowCount:e,name:i,fieldNames:[...t],getField:r=>n[r]}}(function(i){i.create=function(e,t){return{id:rde(),version:0,value:e,metadata:t}},i.withValue=function(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}})(by||(by={})),function(i){function e(t,n){return s0.set(t,by.withValue(t.ref,n))}i.create=function(t,n){return s0.create(by.create(t,n))},i.update=e,i.set=function(t,n){return s0.set(t,n)},i.updateIfChanged=function(t,n){return t.ref.value!==n?e(t,n):t}}(wU||(wU={})),function(i){function e(n,r,s){const o=Object.create(null),a=Object.keys(r);o._rowCount=s.length,o._columns=a,o._schema=r;for(const l of a)o[l]=si.view(n[l],s);return o}function t(n,r){const s=Object.create(null),{_columns:o}=n;for(let a=0;a<o.length;a++){const l=o[a];s[l]=n[l].value(r)}return s}i.is=function(n){return n&&typeof n._rowCount=="number"&&!!n._columns&&!!n._schema},i.pickColumns=function(n,r,s={}){const o=Object.create(null),a=Object.keys(n);o._rowCount=r._rowCount,o._columns=a,o._schema=n;for(const l of a)if(r[l])o[l]=r[l];else{if(!s[l])throw Error(`Cannot find column '${l}'.`);o[l]=s[l]}return o},i.ofColumns=function(n,r){const s=Object.keys(r);return{_rowCount:r[s[0]].rowCount,_columns:s,_schema:n,...r}},i.ofPartialColumns=function(n,r,s){const o=Object.create(null),a=Object.keys(n);o._rowCount=s,o._columns=a,o._schema=n;for(const l of a)o[l]=l in r?r[l]:si.Undefined(s,n[l]);return o},i.ofUndefinedColumns=function(n,r){const s=Object.create(null),o=Object.keys(n);s._rowCount=r,s._columns=o,s._schema=n;for(const a of o)s[a]=si.Undefined(r,n[a]);return s},i.ofRows=function(n,r){const s=Object.create(null),o=r.length,a=Object.keys(n);s._rowCount=o,s._columns=a,s._schema=n;for(const l of a)s[l]=si.ofLambda({rowCount:o,schema:n[l],value:c=>r[c][l],valueKind:c=>r[c][l]===void 0?1:0});return s},i.ofArrays=function(n,r){var s;const o=Object.create(null),a=Object.keys(n);o._rowCount=0,o._columns=a,o._schema=n;for(const l of a)r[l]!==void 0?(o[l]=si.ofArray({array:r[l],schema:n[l]}),o._rowCount=(s=r[l])===null||s===void 0?void 0:s.length):o[l]=si.Undefined(o._rowCount,n[l]);return o},i.view=e,i.pick=function(n,r,s){const o=[];for(let a=0,l=n._rowCount;a<l;++a)s(a)&&o.push(a);return e(n,r,o)},i.window=function(n,r,s,o){if(s===0&&o===n._rowCount)return n;const a=Object.create(null),l=Object.keys(r);a._rowCount=o-s,a._columns=l,a._schema=r;for(const c of l)a[c]=si.window(n[c],s,o);return a},i.concat=function(n,r){const s=Object.create(null),o=Object.keys(r);s._rowCount=0;for(const c of n)s._rowCount+=c._rowCount;const a={};for(const c of o)a[c]=new Array(s._rowCount);s._columns=o,s._schema=r;let l=0;for(const c of n){for(const u of o)si.copyToArray(c[u],a[u],l);l+=c._rowCount}for(const c of o)s[c]=si.ofArray({array:a[c],schema:r[c]});return s},i.columnToArray=function(n,r,s){n[r]=si.asArrayColumn(n[r],s)},i.sort=function(n,r){const s=new Int32Array(n._rowCount);for(let l=0,c=s.length;l<c;l++)s[l]=l;nde(s,(l,c,u)=>r(c,u));let o=!0;for(let l=0,c=s.length;l<c;l++)if(s[l]!==l){o=!1;break}if(o)return n;const a=Object.create(null);a._rowCount=n._rowCount,a._columns=n._columns,a._schema=n._schema;for(const l of n._columns)a[l]=si.view(n[l],s,!1);return a},i.areEqual=function(n,r){if(n._rowCount!==r._rowCount||n._columns.length!==r._columns.length)return!1;for(const s of n._columns)if(!r[s])return!1;for(const s of n._columns)if(!si.areEqual(n[s],r[s]))return!1;return!0},i.getRow=t,i.pickRow=function(n,r){for(let s=0,o=n._rowCount;s<o;++s)if(r(s))return t(n,s)},i.getRows=function(n){const r=[],{_rowCount:s}=n;for(let o=0;o<s;o++)r[o]=t(n,o);return r},i.toArrays=function(n){const r={},{_columns:s}=n;for(let o=0;o<s.length;o++){const a=s[o];r[a]=n[a].toArray()}return r},i.formatToString=function(n){const r=ys.create(),{_columns:s,_rowCount:o}=n;let a=1;ys.write(r,"|");for(let l=0;l<s.length;l++)ys.write(r,s[l]),ys.write(r,"|"),a+=s[l].length+1;ys.newline(r),ys.write(r,new Array(a+1).join("-")),ys.newline(r);for(let l=0;l<o;l++){ys.write(r,"|");for(let c=0;c<s.length;c++){const u=n[s[c]];u.valueKind(l)===0?(ys.write(r,u.value(l)),ys.write(r,"|")):ys.write(r,".|")}ys.newline(r)}return ys.getString(r)}}(Sy||(Sy={})),function(i){i.ofTables=function(e,t,n){const r=Object.keys(n),s=Object.create(null),o=[];s._name=e,s._tableNames=o,s._schema=t;for(const a of r)Sy.is(n[a])&&(s[a]=n[a],o[o.length]=a);return s},i.getTablesAsRows=function(e){const t={};for(const n of e._tableNames)t[n]=Sy.getRows(e[n]);return t}}(bC||(bC={})),function(i){function e(t,n){const r=Object.keys(n);return{rowCount:r.length>0?n[r[0]].rowCount:0,name:t,fieldNames:r,getField:s=>n[s]}}i.empty=function(t){return{rowCount:0,name:t,fieldNames:[],getField(n){}}},i.ofFields=e,i.ofTable=function(t,n){const r={};for(const s of n._columns)r[s]=bp.ofColumn(n[s]);return e(t,r)}}(yb||(yb={})),function(i){function e(n){const r=n.length,s=l=>{const c=n[l];return c&&c!=="."&&c!=="?"?c:""},o=l=>{const c=n[l];return xp(c,0,c.length)||0},a=l=>{const c=n[l];return r0(c,0,c.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:r,str:s,int:o,float:a,valueKind:l=>{const c=n[l],u=c.length;if(u>1)return 0;if(u===0)return 1;const h=c.charCodeAt(0);return h===46?1:h===63?2:0},areValuesEqual:(l,c)=>n[l]===n[c],toStringArray:l=>l?Qr(r,s,l):n,toIntArray:l=>Qr(r,o,l),toFloatArray:l=>Qr(r,a,l)}}function t(n){const{rowCount:r,valueKind:s,areValuesEqual:o,isDefined:a}=n;let l,c,u;switch(n.schema.valueType){case"float":case"int":l=d=>""+n.value(d),c=n.value,u=n.value;break;case"str":l=n.value,c=d=>{const f=n.value(d);return xp(f,0,f.length)||0},u=d=>{const f=n.value(d);return r0(f,0,f.length)||0};break;case"list":const{separator:h}=n.schema;l=d=>n.value(d).join(h),c=d=>NaN,u=d=>NaN;break;default:throw new Error(`unsupported valueType '${n.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:a,rowCount:r,str:l,int:c,float:u,valueKind:s,areValuesEqual:o,toStringArray:h=>Qr(r,l,h),toIntArray:h=>Qr(r,c,h),toFloatArray:h=>Qr(r,u,h)}}i.ofString=function(n){return e([n])},i.ofStrings=e,i.ofNumbers=function(n){const r=n.length,s=l=>""+n[l],o=l=>n[l],a=l=>!l||l.array&&n instanceof l.array?n:Qr(r,o,l);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:r,str:s,int:o,float:o,valueKind:l=>0,areValuesEqual:(l,c)=>n[l]===n[c],toStringArray:l=>Qr(r,s,l),toIntArray:a,toFloatArray:a}},i.ofTokens=function(n){const{data:r,indices:s,count:o}=n,a=u=>{const h=r.substring(s[2*u],s[2*u+1]);return h==="."||h==="?"?"":h},l=u=>xp(r,s[2*u],s[2*u+1])||0,c=u=>r0(r,s[2*u],s[2*u+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:o,str:a,int:l,float:c,valueKind:u=>{const h=s[2*u],d=s[2*u+1]-h;if(d>1)return 0;if(d===0)return 1;const f=r.charCodeAt(h);return f===46?1:f===63?2:0},areValuesEqual:sde(n),toStringArray:u=>Qr(o,a,u),toIntArray:u=>Qr(o,l,u),toFloatArray:u=>Qr(o,c,u)}},i.ofColumn=t,i.ofUndefined=function(n,r){return t(si.Undefined(n,r))}}(bp||(bp={}));const SC=typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(i,...e)=>window.setImmediate(i,...e),clearImmediate:i=>window.clearImmediate(i)}:{setImmediate,clearImmediate}:function(){const i=function(){const a=typeof window<"u"&&window,l=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return a||typeof global<"u"&&global||l}(),e={},t=typeof document<"u"?document:void 0;let n,r=1;function s(a){delete e[a]}function o(a){const l=e[a];s(a),function(c){const u=c.callback,h=c.args;switch(h.length){case 0:u();break;case 1:u(h[0]);break;case 2:u(h[0],h[1]);break;case 3:u(h[0],h[1],h[2]);break;default:u.apply(void 0,h)}}(l)}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?n=function(a){process.nextTick(function(){o(a)})}:function(){if(i&&i.postMessage&&!i.importScripts){let a=!0;const l=i.onmessage;return i.onmessage=function(){a=!1},i.postMessage("","*"),i.onmessage=l,a}}()?function(){const a="setImmediate$"+Math.random()+"$",l=function(c){c.source===i&&typeof c.data=="string"&&c.data.indexOf(a)===0&&o(+c.data.slice(a.length))};window.addEventListener?window.addEventListener("message",l,!1):window.attachEvent("onmessage",l),n=function(c){window.postMessage(a+c,"*")}}():typeof MessageChannel<"u"?function(){const a=new MessageChannel;a.port1.onmessage=function(l){o(l.data)},n=function(l){a.port2.postMessage(l)}}():t&&"onreadystatechange"in t.createElement("script")?function(){const a=t.documentElement;n=function(l){let c=t.createElement("script");c.onreadystatechange=function(){o(l),c.onreadystatechange=null,a.removeChild(c),c=null},a.appendChild(c)}}():n=function(a){setTimeout(o,0,a)},{setImmediate:function(a,...l){typeof a!="function"&&(a=new Function(""+a));const c={callback:a,args:l};return e[r]=c,n(r),r++},clearImmediate:s}}();function ode(i){SC.setImmediate(i)}const ade={setImmediate:SC.setImmediate,clearImmediate:SC.clearImmediate,immediatePromise:()=>new Promise(ode),delay:(i,e=void 0)=>new Promise(t=>setTimeout(t,i,e))};(function(){try{return!0}catch{return!1}})(),function(){try{const i=sae.DEBUG;return i==="*"||i==="molstar"}catch{return!1}}();var o0;function lde(i,e,t=250){const n=function(r,s,o){const a={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:o,lastNotified:cl(),observer:s,abortToken:a,taskId:r.id,root:{progress:kV(r),children:[]},tryAbort:cde(a)}}(i,e,t);return s3(i,new o3(n,n.root))}function kV(i){return{taskId:i.id,taskName:i.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function cde(i){return e=>{i.abortRequested=!0,i.reason=e||i.reason}}function UV(i){return{progress:{...i.progress},children:i.children.map(UV)}}function OV(i){return i.progress.canAbort&&i.children.every(OV)}async function s3(i,e){o0.markStart(i),e.node.progress.startedTime=cl();try{const t=await i.f(e);return o0.markEnd(i),o0.measure(i),e.info.abortToken.abortRequested&&BV(e.info),t}catch(t){throw fd.isAbort(t)&&(e.isAborted=!0,e.node.children.length>0&&await new Promise(n=>{e.onChildrenFinished=n}),i.onAbort&&i.onAbort()),t}}function BV(i){throw i.abortToken.treeAborted||(i.abortToken.treeAborted=!0,zV(i.root),GV(i,cl())),fd.Aborted(i.abortToken.reason)}function zV(i){const e=i.progress;e.isIndeterminate=!0,e.canAbort=!1,e.message="Aborting...";for(const t of i.children)zV(t)}function GV(i,e){i.lastNotified=e;const t=function(n){return{root:UV(n.root),canAbort:OV(n.root),requestAbort:n.tryAbort}}(i);i.observer(t)}(function(i){i.markStart=function(e){},i.markEnd=function(e){},i.measure=function(e){}})(o0||(o0={}));class o3{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,BV(this.info))}get shouldUpdate(){return this.checkAborted(),cl()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return;const t=this.node.progress;typeof e=="string"?(t.message=e,t.isIndeterminate=!0):(e.canAbort!==void 0&&(t.canAbort=e.canAbort),e.message!==void 0&&(t.message=e.message),e.current!==void 0&&(t.current=e.current),e.max!==void 0&&(t.max=e.max),t.isIndeterminate=t.current===void 0||t.max===void 0,e.isIndeterminate!==void 0&&(t.isIndeterminate=e.isIndeterminate))}update(e,t){if(this.lastUpdatedTime=cl(),this.updateProgress(e),!t)return GV(this.info,this.lastUpdatedTime),this.checkAborted(),ade.immediatePromise()}async runChild(e,t){this.updateProgress(t);const n={progress:kV(e),children:[]},r=this.node.children;r.push(n);const s=new o3(this.info,n);try{return await s3(e,s)}catch(o){if(fd.isAbort(o)&&this.isAborted)return;throw o}finally{const o=r.indexOf(n);if(o>=0){for(let a=o,l=r.length-1;a<l;a++)r[a]=r[a+1];r.pop()}r.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}}const wy=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(i,e){}};var fd,MU,AU,fa,Qh,un;async function wC(i,e,t,n,r){let s=Math.max(e,0),o=0,a=0;if(i.isSynchronous)return n(Number.MAX_SAFE_INTEGER,t),t;let l=cl(),c=0,u=0;for(;(c=n(s,t))>0;){o+=c;const h=cl()-l;u+=h,a+=h,i.shouldUpdate&&(await r(i,t,o),s=Math.round(u*o/a)+1,l=cl(),u=0)}return i.shouldUpdate&&await r(i,t,o),t}function MC(i){return{data:i,position:0,length:i.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function EU(i){for(;i.position<i.length;)switch(i.data.charCodeAt(i.position)){case 9:case 10:case 13:case 32:return void(i.tokenEnd=i.position);default:++i.position}i.tokenEnd=i.position}function TU(i){return!(i.length-i.position<2)&&i.data.charCodeAt(i.position+1)===39&&i.data.charCodeAt(i.position+2)===39}function ude(i,e,t){let n;const r=t-e,s=i.tokenStart-e,o=i.tokenEnd-i.tokenStart;if(o<r)return!1;for(n=e;n<t;++n)if(i.data.charCodeAt(n)!==i.data.charCodeAt(n+s))return!1;return r===o||i.data.charCodeAt(n+s)===46}function VV(i){let e;for(e=i.tokenStart;e<i.tokenEnd;++e)if(i.data.charCodeAt(e)===46)return e;return e}function HV(i,e){return i.data.substring(i.tokenStart,e)}function AC(i){return i.data.substring(i.tokenStart,i.tokenEnd)}function CU(i){const e=function(n){let r=10;for(;n.position<n.length;){const s=n.data.charCodeAt(n.position);switch(s){case 9:case 32:r=s,++n.position;break;case 10:r!==13&&++n.lineNumber,r=s,++n.position;break;case 13:r=s,++n.position,++n.lineNumber;break;default:return r}}return r}(i);if(i.position>=i.length)return void(i.tokenType=6);i.tokenStart=i.position,i.tokenEnd=i.position,i.isEscaped=!1;const t=i.data.charCodeAt(i.position);switch(t){case 35:(function(n){for(;n.position<n.length;){const r=n.data.charCodeAt(n.position);if(r===10||r===13)return;++n.position}})(i),i.tokenType=5;break;case 39:if(TU(i)){(function(n){for(n.position+=3;n.position<n.length;){if(n.data.charCodeAt(n.position)===39&&TU(n))return n.tokenStart+=3,n.tokenEnd=n.position,n.isEscaped=!0,void(n.position+=3);++n.position}n.tokenEnd=n.position})(i),i.tokenType=3;break}case 34:(function(n,r){let s,o;for(++n.position;n.position<n.length;)if(o=n.data.charCodeAt(n.position),o===r)switch(s=n.data.charCodeAt(n.position+1),s){case 9:case 10:case 13:case 32:return n.tokenStart++,n.tokenEnd=n.position,n.isEscaped=!0,void++n.position;default:if(s===void 0)return n.tokenStart++,n.tokenEnd=n.position,n.isEscaped=!0,void++n.position;++n.position}else{if(o===10||o===13)return void(n.tokenEnd=n.position);++n.position}n.tokenEnd=n.position})(i,t),i.tokenType=3;break;case 59:e===10||e===13?function(n){let r,s=59,o=n.position+1;for(;o<n.length;){if(r=n.data.charCodeAt(o),r===59&&(s===10||s===13)){for(n.position=o+1,n.tokenStart++,o--,r=n.data.charCodeAt(o);r===10||r===13;)o--,r=n.data.charCodeAt(o);return n.tokenEnd=o+1,void(n.isEscaped=!0)}(r===13||r===10&&s!==13)&&n.lineNumber++,s=r,++o}n.position=o}(i):EU(i),i.tokenType=3;break;default:i.isImportGet?function(n){for(;n.position<n.length;){if(n.data.charCodeAt(n.position)===93)return++n.position,n.tokenEnd=n.position,void(n.isImportGet=!1);++n.position}}(i):EU(i),i.isEscaped?i.tokenType=3:i.data.charCodeAt(i.tokenStart)===95?(i.inSaveFrame&&function(n){return n.tokenEnd-n.tokenStart==11&&n.data.charCodeAt(n.tokenStart+1)===105&&n.data.charCodeAt(n.tokenStart+2)===109&&n.data.charCodeAt(n.tokenStart+3)===112&&n.data.charCodeAt(n.tokenStart+4)===111&&n.data.charCodeAt(n.tokenStart+5)===114&&n.data.charCodeAt(n.tokenStart+6)===116&&n.data.charCodeAt(n.tokenStart+7)===46&&n.data.charCodeAt(n.tokenStart+8)===103&&n.data.charCodeAt(n.tokenStart+9)===101&&n.data.charCodeAt(n.tokenStart+10)===116}(i)&&(i.isImportGet=!0),i.tokenType=4):i.tokenEnd-i.tokenStart>=5&&i.data.charCodeAt(i.tokenStart+4)===95?function(n){let r=n.data.charCodeAt(n.tokenStart);return!(r!==68&&r!==100||(r=n.data.charCodeAt(n.tokenStart+1),r!==65&&r!==97||(r=n.data.charCodeAt(n.tokenStart+2),r!==84&&r!==116||(r=n.data.charCodeAt(n.tokenStart+3),r!==65&&r!==97))))}(i)?i.tokenType=0:function(n){let r=n.data.charCodeAt(n.tokenStart);return!(r!==83&&r!==115||(r=n.data.charCodeAt(n.tokenStart+1),r!==65&&r!==97||(r=n.data.charCodeAt(n.tokenStart+2),r!==86&&r!==118||(r=n.data.charCodeAt(n.tokenStart+3),r!==69&&r!==101))))}(i)?i.tokenType=1:function(n){if(n.tokenEnd-n.tokenStart!=5)return!1;let r=n.data.charCodeAt(n.tokenStart);return!(r!==76&&r!==108||(r=n.data.charCodeAt(n.tokenStart+1),r!==79&&r!==111||(r=n.data.charCodeAt(n.tokenStart+2),r!==79&&r!==111||(r=n.data.charCodeAt(n.tokenStart+3),r!==80&&r!==112))))}(i)?i.tokenType=2:i.tokenType=3:i.tokenType=3}}function xu(i){for(CU(i);i.tokenType===5;)CU(i)}function My(){return{categoryNames:[],categoryData:Object.create(null)}}function a3(i,e){const t=Object.create(null);for(const n of i){const r=e[n];t[n]=yb(r.name,r.rowCount,r.fieldNames,r.fields)}return t}function PU(i,e,t){return r3(i.categoryNames,a3(i.categoryNames,i.categoryData),e,t)}function hde(i,e){return r3(i.categoryNames,a3(i.categoryNames,i.categoryData),e)}function EC(i,e,t,n,r){if(e in i.categoryData){const s=i.categoryData[e];s.fieldNames.push(...n),Object.assign(s.fields,r)}else i.categoryData[e]={name:e,rowCount:t,fieldNames:n,fields:r},i.categoryNames.push(e)}function dde(i,e){const t=i.tokenStart,n=VV(i),r=HV(i,n),s=Object.create(null),o=[];let a=!0;for(;a;){if(i.tokenType!==4||!ude(i,t,n)){a=!1;break}const l=AC(i).substring(r.length+1);if(xu(i),i.tokenType!==3)return{hasError:!0,errorLine:i.lineNumber,errorMessage:"Expected value."};s[l]=bp.ofTokens({data:i.data,indices:[i.tokenStart,i.tokenEnd],count:1}),o[o.length]=l,xu(i)}return EC(e,r.substr(1),1,o,s),{hasError:!1,errorLine:0,errorMessage:""}}function fde(i,e){const{tokenizer:t,tokens:n,fieldCount:r}=e;let s=e.tokenCount,o=0;for(;t.tokenType===3&&o<i;)fa.add(n[s++%r],t.tokenStart,t.tokenEnd),xu(t),o++;return e.tokenCount=s,o}function pde(i,e){return i.update({message:"Parsing...",current:e.tokenizer.position,max:e.tokenizer.data.length})}async function mde(i,e){const t=i.lineNumber;xu(i);const n=HV(i,VV(i)),r=function(h){let d;for(d=h.tokenStart;d<h.tokenEnd;++d)if(h.data.charCodeAt(d)===46)return!1;return!0}(i),s=[];for(;i.tokenType===4;)s[s.length]=r?AC(i):AC(i).substring(n.length+1),xu(i);const o=n==="_atom_site"?i.data.length/100|0:32,a=[],l=s.length;for(let h=0;h<l;h++)a[h]=fa.create(i.data,o);const c={fieldCount:l,tokenCount:0,tokenizer:i,tokens:a};if(await wC(i.runtimeCtx,1e6,c,fde,pde),c.tokenCount%l!=0)return{hasError:!0,errorLine:i.lineNumber,errorMessage:`The number of values for loop starting at line ${t} is not a multiple of the number of columns.`};const u=c.tokenCount/l|0;if(r)for(let h=0;h<l;h++){const d={"":bp.ofTokens(a[h])};EC(e,s[h].substr(1),u,[""],d)}else{const h=Object.create(null);for(let d=0;d<l;d++)h[s[d]]=bp.ofTokens(a[d]);EC(e,n.substr(1),u,s,h)}return{hasError:!1,errorLine:0,errorMessage:""}}function Lf(i,e){return Qh.error(e,i)}async function gde(i,e){const t=[],n=function(u,h){return{data:u,length:u.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:h}}(i,e);let r="",s=My(),o=[],a=My();const l=function(u,h,d){return{categoryNames:u,header:d,categories:h}}(a.categoryNames,a3(a.categoryNames,a.categoryData),"");let c="";for(e.update({message:"Parsing...",current:0,max:i.length}),xu(n);n.tokenType!==6;){const u=n.tokenType;if(u===0){if(n.inSaveFrame)return Lf(n.lineNumber,"Unexpected data block inside a save frame.");s.categoryNames.length>0&&t.push(PU(s,r,o)),r=i.substring(n.tokenStart+5,n.tokenEnd),s=My(),o=[],xu(n)}else if(u===1){if(n.tokenEnd-n.tokenStart==5)a.categoryNames.length>0&&(o[o.length]=hde(a,c)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return Lf(n.lineNumber,"Save frames cannot be nested.");n.inSaveFrame=!0,c=i.substring(n.tokenStart+5,n.tokenEnd),a=My()}xu(n)}else if(u===2){const h=await mde(n,n.inSaveFrame?a:s);if(h.hasError)return Lf(h.errorLine,h.errorMessage)}else{if(u!==4)return console.log(n.tokenType,MC.getTokenString(n)),Lf(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const h=dde(n,n.inSaveFrame?a:s);if(h.hasError)return Lf(h.errorLine,h.errorMessage)}}}return n.inSaveFrame?Lf(n.lineNumber,`Unfinished save frame (${l.header}).`):((s.categoryNames.length>0||o.length>0)&&t.push(PU(s,r,o)),function(u){return Qh.success(u)}(FV(t)))}function RU(i){return fd.create("Parse CIF",async e=>await gde(i,e))}(function(i){class e{run(o,a=250){return o?lde(this,o,a):this.f(wy)}runAsChild(o,a){return o.isSynchronous?this.f(wy):function(l,c,u){return l.runChild(c,u)}(o,this,a)}runInContext(o){return o.isSynchronous?this.f(wy):function(a,l){return s3(l,a)}(o,this)}constructor(o,a,l){this.name=o,this.f=a,this.onAbort=l,this.id=r()}}function t(s){const o=s;return!!s&&typeof o.id=="number"&&typeof o.name=="string"&&!!o.run}function n(s,o,a){return new e(s,o,a)}i.is=t,i.isAbort=function(s){return!!s&&!!s.isAborted},i.Aborted=function(s){return{isAborted:!0,reason:s,toString:()=>"Aborted"+(s?": "+s:"")}},i.create=n,i.constant=function(s,o){return n(s,async a=>o)},i.empty=function(){return n("",async s=>{})},i.fail=function(s,o){return n(s,async a=>{throw new Error(o)})},i.resolveInContext=function(s,o){return t(s)?o?s.runInContext(o):s.run():s};const r=NV(0,1073741823)})(fd||(fd={})),function(i){i.Synchronous=wy}(MU||(MU={})),function(i){function e(t,n=""){const r=t.progress;if(!t.children.length)return r.isIndeterminate?`${n}${r.taskName}: ${r.message}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}`;const s=n+"  |_ ",o=t.children.map(a=>e(a,s));return r.isIndeterminate?`${n}${r.taskName}: ${r.message}
${o.join(`
`)}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}
${o.join(`
`)}`}i.format=function(t){return e(t.root)}}(AU||(AU={})),function(i){function e(o){return o.data.substring(o.tokenStart,o.tokenEnd)}function t(o){const{data:a}=o;for(;o.position<o.length;)switch(a.charCodeAt(o.position)){case 10:return o.tokenEnd=o.position,++o.position,++o.lineNumber,!0;case 13:return o.tokenEnd=o.position,++o.position,++o.lineNumber,a.charCodeAt(o.position)===10&&++o.position,!0;default:++o.position}return o.tokenEnd=o.position,o.tokenStart!==o.tokenEnd}function n(o){return o.tokenStart=o.position,t(o)}function r(o,a,l){let c=0;for(let u=0;u<a;u++){if(!n(o))return c;fa.addUnchecked(l,o.tokenStart,o.tokenEnd),c++}return c}function s(o,a,l){const{data:c}=o;let u=a,h=l-1,d=c.charCodeAt(u);for(;(d===9||d===32)&&u<=h;)d=c.charCodeAt(++u);for(d=c.charCodeAt(h);(d===9||d===32)&&h>=u;)d=c.charCodeAt(--h);return o.tokenStart=u,o.tokenEnd=h+1,o.position=l,o}i.getTokenString=e,i.reset=function(o){o.position=0,o.lineNumber=1,o.tokenStart=0,o.tokenEnd=0},i.eatLine=t,i.markStart=function(o){o.tokenStart=o.position},i.markLine=n,i.readLine=function(o){return n(o),e(o)},i.readLineTrim=function(o){n(o);const a=o.position;return s(o,o.tokenStart,o.tokenEnd),o.position=a,e(o)},i.markLines=function(o,a){const l=fa.create(o.data,2*a);return r(o,a,l),l},i.readLines=function(o,a){const l=[];for(let c=0;c<a;c++)l.push(i.readLine(o));return l},i.readLinesAsync=async function(o,a,l,c=1e5){const u=fa.create(o.data,2*a);let h=0;return await wC(l,c,o,(d,f)=>{const m=Math.min(a-h,d);return r(f,m,u),h+=m,m},(d,f)=>d.update({message:"Parsing...",current:f.position,max:f.length})),u},i.readAllLines=function(o){const a=i(o),l=fa.create(a.data,Math.max(o.length/80,2));for(;n(a);)fa.add(l,a.tokenStart,a.tokenEnd);return l},i.readAllLinesAsync=async function(o,a,l=1e5){const c=i(o),u=fa.create(c.data,Math.max(o.length/80,2));return await wC(a,l,c,(h,d)=>(function(f,m,_){let v=0;for(let g=0;g<m;g++){if(!n(f))return v;fa.add(_,f.tokenStart,f.tokenEnd),v++}}(d,h,u),d.position<d.length?h:0),(h,d)=>h.update({message:"Parsing...",current:d.position,max:d.length})),u},i.eatValue=function(o){for(;o.position<o.length;)switch(o.data.charCodeAt(o.position)){case 9:case 10:case 13:case 32:return void(o.tokenEnd=o.position);default:++o.position}o.tokenEnd=o.position},i.skipWhitespace=function(o){let a=-1;for(;o.position<o.length;){const l=o.data.charCodeAt(o.position);switch(l){case 9:case 32:a=l,++o.position;break;case 10:a!==13&&++o.lineNumber,a=l,++o.position;break;case 13:a=l,++o.position,++o.lineNumber;break;default:return a}}return a},i.trim=s}(MC||(MC={})),function(i){function e(t,n,r){const s=t;s.offset>s.indicesLenMinus2&&function(o){const a=new Uint32Array(1.61*o.indices.length|0);a.set(o.indices),o.indices=a,o.indicesLenMinus2=a.length-2|0}(s),s.indices[s.offset++]=n,s.indices[s.offset++]=r,t.count++}i.add=e,i.addToken=function(t,n){e(t,n.tokenStart,n.tokenEnd)},i.addUnchecked=function(t,n,r){t.indices[t.offset++]=n,t.indices[t.offset++]=r,t.count++},i.create=function(t,n){return{data:t,indicesLenMinus2:(n=Math.max(10,n))-2|0,count:0,offset:0,indices:new Uint32Array(n)}}}(fa||(fa={})),function(i){i.error=function(n,r=-1){return new e(n,r)},i.success=function(n,r=[]){return new t(n,r)};class e{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(r,s){this.message=r,this.line=s,this.isError=!0}}i.Error=e;class t{constructor(r,s){this.result=r,this.warnings=s,this.isError=!1}}i.Success=t}(Qh||(Qh={})),function(i){var e,t;(e=i.IntDataType||(i.IntDataType={}))[e.Int8=1]="Int8",e[e.Int16=2]="Int16",e[e.Int32=3]="Int32",e[e.Uint8=4]="Uint8",e[e.Uint16=5]="Uint16",e[e.Uint32=6]="Uint32",(t=i.FloatDataType||(i.FloatDataType={}))[t.Float32=32]="Float32",t[t.Float64=33]="Float64",i.getDataType=function(n){let r;return r=n instanceof Int8Array?i.IntDataType.Int8:n instanceof Int16Array?i.IntDataType.Int16:n instanceof Int32Array?i.IntDataType.Int32:n instanceof Uint8Array?i.IntDataType.Uint8:n instanceof Uint16Array?i.IntDataType.Uint16:n instanceof Uint32Array?i.IntDataType.Uint32:n instanceof Float32Array?i.FloatDataType.Float32:n instanceof Float64Array?i.FloatDataType.Float64:i.IntDataType.Int32,r},i.isSignedIntegerDataType=function(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(let r=0,s=n.length;r<s;r++)if(r<0)return!1;return!0}}(un||(un={}));const vde=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function xb(i){let e=i.data;for(let t=i.encoding.length-1;t>=0;t--)e=_de(e,i.encoding[t]);return e}function _de(i,e){switch(e.kind){case"ByteArray":switch(e.type){case un.IntDataType.Uint8:return i;case un.IntDataType.Int8:return function(t){return new Int8Array(t.buffer,t.byteOffset)}(i);case un.IntDataType.Int16:return function(t){return Df(t,2,Int16Array)}(i);case un.IntDataType.Uint16:return function(t){return Df(t,2,Uint16Array)}(i);case un.IntDataType.Int32:return function(t){return Df(t,4,Int32Array)}(i);case un.IntDataType.Uint32:return function(t){return Df(t,4,Uint32Array)}(i);case un.FloatDataType.Float32:return function(t){return Df(t,4,Float32Array)}(i);case un.FloatDataType.Float64:return function(t){return Df(t,8,Float64Array)}(i);default:_b(e.type)}case"FixedPoint":return function(t,n){const r=t.length,s=LU(n.srcType,r),o=1/n.factor;for(let a=0;a<r;a++)s[a]=o*t[a];return s}(i,e);case"IntervalQuantization":return function(t,n){const r=t.length,s=LU(n.srcType,r),o=(n.max-n.min)/(n.numSteps-1),a=n.min;for(let l=0;l<r;l++)s[l]=a+o*t[l];return s}(i,e);case"RunLength":return function(t,n){const r=IU(n.srcType,n.srcSize);let s=0;for(let o=0,a=t.length;o<a;o+=2){const l=t[o],c=t[o+1];for(let u=0;u<c;++u)r[s++]=l}return r}(i,e);case"Delta":return function(t,n){const r=t.length,s=IU(n.srcType,r);if(!r)return t;s[0]=t[0]+(0|n.origin);for(let o=1;o<r;++o)s[o]=t[o]+s[o-1];return s}(i,e);case"IntegerPacking":return function(t,n){return t.length===n.srcSize?t:n.isUnsigned?function(r,s){const o=s.byteCount===1?255:65535,a=r.length,l=new Int32Array(s.srcSize);let c=0,u=0;for(;c<a;){let h=0,d=r[c];for(;d===o;)h+=d,c++,d=r[c];h+=d,l[u]=h,c++,u++}return l}(t,n):function(r,s){const o=s.byteCount===1?127:32767,a=-o-1,l=r.length,c=new Int32Array(s.srcSize);let u=0,h=0;for(;u<l;){let d=0,f=r[u];for(;f===o||f===a;)d+=f,u++,f=r[u];d+=f,c[h]=d,u++,h++}return c}(t,n)}(i,e);case"StringArray":return function(t,n){const r=xb({encoding:n.offsetEncoding,data:n.offsets}),s=xb({encoding:n.dataEncoding,data:t}),o=n.stringData,a=new Array(r.length);a[0]="";for(let u=1,h=r.length;u<h;u++)a[u]=o.substring(r[u-1],r[u]);let l=0;const c=new Array(s.length);for(let u=0,h=s.length;u<h;u++)c[l++]=a[s[u]+1];return c}(i,e)}}function IU(i,e){switch(i){case un.IntDataType.Int8:return new Int8Array(e);case un.IntDataType.Int16:return new Int16Array(e);case un.IntDataType.Int32:return new Int32Array(e);case un.IntDataType.Uint8:return new Uint8Array(e);case un.IntDataType.Uint16:return new Uint16Array(e);case un.IntDataType.Uint32:return new Uint32Array(e);default:return new Int32Array(e)}}function LU(i,e){switch(i){case un.FloatDataType.Float32:return new Float32Array(e);case un.FloatDataType.Float64:default:return new Float64Array(e)}}function Df(i,e,t){return new t(vde?i.buffer:function(n,r){const s=new ArrayBuffer(n.length),o=new Uint8Array(s);for(let a=0,l=n.length;a<l;a+=r)for(let c=0;c<r;c++)o[a+r-c-1]=n[a+c];return s}(i,e))}var ap,Fg,DU,NU,Mn;function yde(i,e,t){let n,r=1;for(n=0;n<e;n++){const s=r*i;if(Math.abs(Math.round(s)-s)<=t)return n;r*=10}return-1}function FU(i){return Fg.classify(i)}(function(i){function e(n){const r=n.growBy*n.elementSize;n.currentSize=r,n.currentIndex=0,n.currentChunk=new n.ctor(r),n.allocatedSize+=r,n.chunks[n.chunks.length]=n.currentChunk}function t(n,r){const{ctor:s,chunks:o,currentIndex:a}=n;if(!o.length)return new s(0);if(o.length===1&&(r||a===n.allocatedSize))return o[0];let l=0;for(let d=0,f=o.length-1;d<f;d++)l+=o[d].length;l+=n.currentIndex;const c=new s(l);let u=0;if(c.buffer)for(let d=0,f=o.length-1;d<f;d++)c.set(o[d],u),u+=o[d].length;else for(let d=0,f=o.length-1;d<f;d++){const m=o[d];for(let _=0,v=m.length;_<v;_++)c[u+_]=m[_];u+=m.length}const h=o[o.length-1];if(c.buffer&&a>=n.currentSize)c.set(h,u);else for(let d=0,f=h.length;d<f;d++)c[u+d]=h[d];return c}i.is=function(n){return n.creator&&n.chunkSize},i.add4=function(n,r,s,o,a){n.currentIndex>=n.currentSize&&e(n);const l=n.currentChunk,c=n.currentIndex;return l[c]=r,l[c+1]=s,l[c+2]=o,l[c+3]=a,n.currentIndex+=4,n.elementCount++},i.add3=function(n,r,s,o){n.currentIndex>=n.currentSize&&e(n);const a=n.currentChunk,l=n.currentIndex;return a[l]=r,a[l+1]=s,a[l+2]=o,n.currentIndex+=3,n.elementCount++},i.add2=function(n,r,s){n.currentIndex>=n.currentSize&&e(n);const o=n.currentChunk,a=n.currentIndex;return o[a]=r,o[a+1]=s,n.currentIndex+=2,n.elementCount++},i.add=function(n,r){return n.currentIndex>=n.currentSize&&e(n),n.currentChunk[n.currentIndex]=r,n.currentIndex+=1,n.elementCount++},i.addRepeat=function(n,r,s){for(let o=0;o<r;o++)n.currentIndex>=n.currentSize&&e(n),n.currentChunk[n.currentIndex++]=s,n.elementCount++;return n.elementCount},i.addMany=function(n,r){const{elementSize:s}=n;for(let o=0,a=r.length;o<a;o+=s){n.currentIndex>=n.currentSize&&e(n);const{currentChunk:l}=n;for(let c=0;c<s;c++)l[n.currentIndex++]=r[o+c];n.elementCount++}return n.elementCount},i.compact=function(n,r=!1){return t(n,r)},i._compact=t,i.create=function(n,r,s,o){const a={ctor:n,elementSize:r,growBy:Math.max(1,Math.ceil(s)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(o===void 0)return a;if(typeof o=="number")return a.currentChunk=new n(o*r),a.allocatedSize=o*r,a.currentSize=a.currentChunk.length,a.chunks[0]=a.currentChunk,a;const l=o;if(l.length%r!=0)throw new Error("initialChunk length must be a multiple of the element size.");return a.currentChunk=l,a.allocatedSize=l.length,a.currentSize=l.length,a.chunks[0]=l,a}})(ap||(ap={})),function(i){function e(u,h){return u>=0?Math.ceil((u+1)/h):Math.ceil((u+1)/(-h-1))}function t({limit8:u,limit16:h},d,f){d.pack8+=e(f,u),d.pack16+=e(f,h),d.count+=1}function n(u,h){u.pack8+=e(h,127),u.pack16+=e(h,32767),u.count+=1}function r(u){return 4*u.count<2*u.pack16?{length:4*u.count,elem:4}:2*u.pack16<u.pack8?{length:2*u.pack16,elem:2}:{length:u.pack8,elem:1}}function s(u,h){const d={pack8:0,pack16:0,count:0};for(let f=0,m=u.length;f<m;f++)t(h,d,u[f]);return{...r(d),kind:"pack"}}function o(u,h){const d={pack8:0,pack16:0,count:0};let f=u[0];for(let m=1,_=u.length;m<_;m++)n(d,u[m]-f),f=u[m];return{...r(d),kind:"delta"}}function a(u,h){const d={pack8:0,pack16:0,count:0};let f=1;for(let m=1,_=u.length;m<_;m++)u[m-1]!==u[m]?(t(h,d,u[m-1]),t(h,d,f),f=1):f++;return t(h,d,u[u.length-1]),t(h,d,f),{...r(d),kind:"rle"}}function l(u,h){const d={pack8:0,pack16:0,count:0};let f=1,m=0,_=0;for(let v=1,g=u.length;v<g;v++){const b=u[v]-m;_!==b?(n(d,_),n(d,f),f=1):f++,_=b,m=u[v]}return n(d,_),n(d,f),{...r(d),kind:"delta-rle"}}function c(u){const h=function(f){let m=!1;for(let _=0,v=f.length;_<v;_++)if(f[_]<0){m=!0;break}return m?{signed:m,limit8:127,limit16:32767}:{signed:m,limit8:255,limit16:65535}}(u),d=[s(u,h),a(u,h),o(u),l(u)];return d.sort((f,m)=>f.length-m.length),d}i.getSize=c,i.classify=function(u){if(u.length<2)return Mn.by(Mn.byteArray);switch(c(u)[0].kind){case"pack":return Mn.by(Mn.integerPacking);case"rle":return Mn.by(Mn.runLength).and(Mn.integerPacking);case"delta":return Mn.by(Mn.delta).and(Mn.integerPacking);case"delta-rle":return Mn.by(Mn.delta).and(Mn.runLength).and(Mn.integerPacking);default:_b()}}}(Fg||(Fg={})),function(i){i.classify=function(e){const{mantissaDigits:t,integerDigits:n}=function(l,c,u){let h=1,d=0;for(let f=0,m=l.length;f<m;f++){if(h>=0){const v=yde(l[f],c,u);v<0?h=-1:v>h&&(h=v)}const _=Math.abs(l[f]);if(_>u){const v=Math.floor(Math.log10(Math.abs(_)))+1;v>d&&(d=v)}}return{mantissaDigits:h,integerDigits:d}}(e,4,1e-6);if(t<0||t+n>10)return Mn.by(Mn.byteArray);if(t===0)return Fg.classify(e);const r=function(l){let c=1;for(let u=0;u<l;u++)c*=10;return c}(t),s=new Int32Array(e.length);for(let l=0,c=e.length;l<c;l++)s[l]=Math.round(r*e[l]);const o=Fg.getSize(s)[0],a=Mn.by(Mn.fixedPoint(r));switch(o.kind){case"pack":return a.and(Mn.integerPacking);case"rle":return a.and(Mn.runLength).and(Mn.integerPacking);case"delta":return a.and(Mn.delta).and(Mn.integerPacking);case"delta-rle":return a.and(Mn.delta).and(Mn.runLength).and(Mn.integerPacking);default:_b()}}}(DU||(DU={}));class bb{and(e){return new bb(this.providers.concat([e]))}encode(e){const t=[];for(const n of this.providers){const r=n(e);if(!r.encodings.length)throw new Error("Encodings must be non-empty.");e=r.data;for(const s of r.encodings)t.push(s)}if(!(e instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:t,data:e}}constructor(e){this.providers=e}}(function(i){function e(n){return new bb([n])}function t(n){switch(n.kind){case"ByteArray":return Mn.byteArray;case"FixedPoint":return Mn.fixedPoint(n.factor);case"IntervalQuantization":return Mn.intervalQuantizaiton(n.min,n.max,n.numSteps);case"RunLength":return Mn.runLength;case"Delta":return Mn.delta;case"IntegerPacking":return Mn.integerPacking;case"StringArray":return Mn.stringArray}}i.by=e,i.fromEncoding=function(n){let r=e(t(n[0]));for(let s=1;s<n.length&&n[s-1].kind!=="IntegerPacking";s++)r=r.and(t(n[s]));return r}})(NU||(NU={})),function(i){i.by=function(o){return new bb([o])};const e={[un.IntDataType.Int16]:function(o,a,l){o.setInt16(2*a,l,!0)},[un.IntDataType.Uint16]:function(o,a,l){o.setUint16(2*a,l,!0)},[un.IntDataType.Int32]:function(o,a,l){o.setInt32(4*a,l,!0)},[un.IntDataType.Uint32]:function(o,a,l){o.setUint32(4*a,l,!0)},[un.FloatDataType.Float32]:function(o,a,l){o.setFloat32(4*a,l,!0)},[un.FloatDataType.Float64]:function(o,a,l){o.setFloat64(8*a,l,!0)}},t={[un.IntDataType.Int16]:2,[un.IntDataType.Uint16]:2,[un.IntDataType.Int32]:4,[un.IntDataType.Uint32]:4,[un.FloatDataType.Float32]:4,[un.FloatDataType.Float64]:8};function n(o){const a=un.getDataType(o);if(a===un.IntDataType.Int8)return function(h){return{encodings:[{kind:"ByteArray",type:un.IntDataType.Int8}],data:new Uint8Array(h.buffer,h.byteOffset)}}(o);if(a===un.IntDataType.Uint8)return function(h){return{encodings:[{kind:"ByteArray",type:un.IntDataType.Uint8}],data:h}}(o);const l=new Uint8Array(o.length*t[a]),c=e[a],u=new DataView(l.buffer);for(let h=0,d=o.length;h<d;h++)c(u,h,o[h]);return{encodings:[{kind:"ByteArray",type:a}],data:l}}function r(o,a){let l=0;for(let c=0,u=o.length;c<u;c++)l+=o[c]/a|0;return l+=o.length,l}function s(o,a){const l=-a-1;let c=0;for(let u=0,h=o.length;u<h;u++){const d=o[u];c+=d>=0?d/a|0:d/l|0}return c+=o.length,c}i.byteArray=n,i.fixedPoint=function(o){return a=>function(l,c){const u=un.getDataType(l),h=new Int32Array(l.length);for(let d=0,f=l.length;d<f;d++)h[d]=Math.round(l[d]*c);return{encodings:[{kind:"FixedPoint",factor:c,srcType:u}],data:h}}(a,o)},i.intervalQuantizaiton=function(o,a,l,c=Int32Array){return u=>function(h,d,f,m,_){const v=un.getDataType(h);if(!h.length)return{encodings:[{kind:"IntervalQuantization",min:d,max:f,numSteps:m,srcType:v}],data:new Int32Array(0)};if(f<d){const p=d;d=f,f=p}const g=(f-d)/(m-1),b=new _(h.length);for(let p=0,y=h.length;p<y;p++){const A=h[p];b[p]=A<=d?0:A>=f?m-1:0|Math.round((A-d)/g)}return{encodings:[{kind:"IntervalQuantization",min:d,max:f,numSteps:m,srcType:v}],data:b}}(u,o,a,l,c)},i.runLength=function(o){let a=un.getDataType(o);if(a===void 0&&(o=new Int32Array(o),a=un.IntDataType.Int32),!o.length)return{encodings:[{kind:"RunLength",srcType:a,srcSize:0}],data:new Int32Array(0)};let l=2;for(let d=1,f=o.length;d<f;d++)o[d-1]!==o[d]&&(l+=2);const c=new Int32Array(l);let u=0,h=1;for(let d=1,f=o.length;d<f;d++)o[d-1]!==o[d]?(c[u]=o[d-1],c[u+1]=h,h=1,u+=2):++h;return c[u]=o[o.length-1],c[u+1]=h,{encodings:[{kind:"RunLength",srcType:a,srcSize:o.length}],data:c}},i.delta=function(o){if(!un.isSignedIntegerDataType(o))throw new Error("Only signed integer types can be encoded using delta encoding.");let a=un.getDataType(o);if(a===void 0&&(o=new Int32Array(o),a=un.IntDataType.Int32),!o.length)return{encodings:[{kind:"Delta",origin:0,srcType:a}],data:new o.constructor(0)};const l=new o.constructor(o.length),c=o[0];l[0]=o[0];for(let u=1,h=o.length;u<h;u++)l[u]=o[u]-o[u-1];return l[0]=0,{encodings:[{kind:"Delta",origin:c,srcType:a}],data:l}},i.integerPacking=function(o){const a=function(l){const c=function(d){for(let f=0,m=d.length;f<m;f++)if(d[f]<0)return!0;return!1}(l),u=c?s(l,127):r(l,255),h=c?s(l,32767):r(l,65535);return 4*l.length<2*h?{isSigned:c,size:l.length,bytesPerElement:4}:2*h<u?{isSigned:c,size:h,bytesPerElement:2}:{isSigned:c,size:u,bytesPerElement:1}}(o);return a.bytesPerElement===4?n(o):function(l,c){const u=c.isSigned?c.bytesPerElement===1?127:32767:c.bytesPerElement===1?255:65535,h=-u-1,d=l.length,f=c.isSigned?c.bytesPerElement===1?new Int8Array(c.size):new Int16Array(c.size):c.bytesPerElement===1?new Uint8Array(c.size):new Uint16Array(c.size);let m=0;for(let v=0;v<d;v++){let g=l[v];if(g>=0)for(;g>=u;)f[m]=u,++m,g-=u;else for(;g<=h;)f[m]=h,++m,g-=h;f[m]=g,++m}const _=n(f);return{encodings:[{kind:"IntegerPacking",byteCount:c.bytesPerElement,isUnsigned:!c.isSigned,srcSize:d},_.encodings[0]],data:_.data}}(o,a)},i.stringArray=function(o){const a=Object.create(null),l=[],c=new Int32Array(o.length),u=ap.create(Int32Array,1,Math.min(1024,o.length<32?o.length+1:Math.round(o.length/8)+1));ap.add(u,0);let h=0,d=0;for(const v of o){if(v==null){c[d++]=-1;continue}let g=a[v];g===void 0&&(h+=v.length,g=l.length,l[g]=v,a[v]=g,ap.add(u,h)),c[d++]=g}const f=ap.compact(u),m=FU(f).encode(f),_=FU(c).encode(c);return{encodings:[{kind:"StringArray",dataEncoding:_.encoding,stringData:l.join(""),offsetEncoding:m.encoding,offsets:m.data}],data:_.data}}}(Mn||(Mn={}));const xde=function(){const i=[];for(let e=0;e<1024;e++)i[e]=String.fromCharCode(e);return i}();function bde(i){throw new Error(i)}const kU=typeof TextDecoder<"u"?new TextDecoder:void 0;function Sde(i,e,t){if(kU){const n=e||t!==i.length?i.subarray(e,e+t):i;return kU.decode(n)}return function(n,r,s){const o=xde;let a,l=0;const c=[];for(let u=r,h=r+s;u<h;u++){const d=n[u];128&d?(224&d)==192?c[l++]=o[(15&d)<<6|63&n[++u]]:(240&d)==224?c[l++]=String.fromCharCode((15&d)<<12|(63&n[++u])<<6|63&n[++u]):(248&d)==240?c[l++]=String.fromCharCode((7&d)<<18|(63&n[++u])<<12|(63&n[++u])<<6|63&n[++u]):bde("Invalid byte "+d.toString(16)):c[l++]=o[d],l===512&&(a=a||[],a[a.length]=c.join(""),l=0)}return a?(l>0&&(a[a.length]=c.slice(0,l).join("")),a.join("")):c.slice(0,l).join("")}(i,e,t)}function wA(i,e){const t={};for(let n=0;n<e;n++)t[Sb(i)]=Sb(i);return t}function MA(i,e){const t=new Uint8Array(e),n=i.offset;for(let r=0;r<e;r++)t[r]=i.buffer[r+n];return i.offset+=e,t}function Ay(i,e){const t=Sde(i.buffer,i.offset,e);return i.offset+=e,t}function AA(i,e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=Sb(i);return t}function Sb(i){const e=i.buffer[i.offset];let t,n;if(!(128&e))return i.offset++,e;if((240&e)==128)return n=15&e,i.offset++,wA(i,n);if((240&e)==144)return n=15&e,i.offset++,AA(i,n);if((224&e)==160)return n=31&e,i.offset++,Ay(i,n);if(!(224&~e))return t=i.dataView.getInt8(i.offset),i.offset++,t;switch(e){case 192:return i.offset++,null;case 194:return i.offset++,!1;case 195:return i.offset++,!0;case 196:return n=i.dataView.getUint8(i.offset+1),i.offset+=2,MA(i,n);case 197:return n=i.dataView.getUint16(i.offset+1),i.offset+=3,MA(i,n);case 198:return n=i.dataView.getUint32(i.offset+1),i.offset+=5,MA(i,n);case 202:return t=i.dataView.getFloat32(i.offset+1),i.offset+=5,t;case 203:return t=i.dataView.getFloat64(i.offset+1),i.offset+=9,t;case 204:return t=i.buffer[i.offset+1],i.offset+=2,t;case 205:return t=i.dataView.getUint16(i.offset+1),i.offset+=3,t;case 206:return t=i.dataView.getUint32(i.offset+1),i.offset+=5,t;case 208:return t=i.dataView.getInt8(i.offset+1),i.offset+=2,t;case 209:return t=i.dataView.getInt16(i.offset+1),i.offset+=3,t;case 210:return t=i.dataView.getInt32(i.offset+1),i.offset+=5,t;case 217:return n=i.dataView.getUint8(i.offset+1),i.offset+=2,Ay(i,n);case 218:return n=i.dataView.getUint16(i.offset+1),i.offset+=3,Ay(i,n);case 219:return n=i.dataView.getUint32(i.offset+1),i.offset+=5,Ay(i,n);case 220:return n=i.dataView.getUint16(i.offset+1),i.offset+=3,AA(i,n);case 221:return n=i.dataView.getUint32(i.offset+1),i.offset+=5,AA(i,n);case 222:return n=i.dataView.getUint16(i.offset+1),i.offset+=3,wA(i,n);case 223:return n=i.dataView.getUint32(i.offset+1),i.offset+=5,wA(i,n)}throw new Error("Unknown type 0x"+e.toString(16))}function wde(i){const e=Object.create(null),t=Object.create(null);for(const n of i.columns)e[n.name]=n;return{rowCount:i.rowCount,name:i.name.substr(1),fieldNames:i.columns.map(n=>n.name),getField(n){const r=e[n];if(r)return t[n]||(t[n]=function(s){const o=s.mask?xb(s.mask):void 0,a=xb(s.data),l=i3(a),c=l?o?m=>o[m]===0?""+a[m]:"":m=>""+a[m]:o?m=>o[m]===0?a[m]:"":m=>a[m],u=l?m=>a[m]:m=>{const _=a[m];return xp(_,0,_.length)},h=l?m=>a[m]:m=>{const _=a[m];return r0(_,0,_.length)},d=o?m=>o[m]:m=>0,f=a.length;return{__array:a,binaryEncoding:s.data.encoding,isDefined:!0,rowCount:f,str:c,int:u,float:h,valueKind:d,areValuesEqual:(m,_)=>a[m]===a[_],toStringArray:m=>Qr(f,c,m),toIntArray:l?m=>vb(a,m):m=>Qr(f,u,m),toFloatArray:l?m=>vb(a,m):m=>Qr(f,h,m)}}(r)),t[n]}}}function UU(i){return fd.create("Parse BinaryCIF",async e=>{const t=[0,3];try{const r=Sb({buffer:n=i,offset:0,dataView:new DataView(n.buffer)});if(!function(o,a){for(let l=0;l<2;l++)if(o[l]>a[l])return!1;return!0}(t,r.version.match(/(\d)\.(\d)\.\d/).slice(1).map(o=>+o)))return Qh.error(`Unsupported format version. Current ${r.version}, required ${t.join(".")}.`);const s=FV(r.dataBlocks.map(o=>{const a=Object.create(null);for(const l of o.categories)a[l.name.substr(1)]=wde(l);return r3(o.categories.map(l=>l.name.substr(1)),a,o.header)}));return Qh.success(s)}catch(r){return Qh.error(""+r)}var n})}var Sp;function kl(i,e,t){return function(n,r,s){const o=Object.create(null);for(const a of Object.keys(n))o[a]=Pde(a,n[a],r,s);return bC.ofTables(r.header,n,o)}(i,e,t)}function Mde(i){switch(i.valueType){case"str":return(e,t,n)=>function(r,s,o,a){return{schema:r,__array:s.__array,isDefined:s.isDefined,rowCount:s.rowCount,value:r.transform==="lowercase"?l=>o(l).toLowerCase():r.transform==="uppercase"?l=>o(l).toUpperCase():o,valueKind:s.valueKind,areValuesEqual:s.areValuesEqual,toArray:r.transform==="lowercase"?l=>Array.from(a(l)).map(c=>c.toLowerCase()):r.transform==="uppercase"?l=>Array.from(a(l)).map(c=>c.toUpperCase()):a}}(i,e,e.str,e.toStringArray);case"int":return(e,t,n)=>OU(i,e,e.int,e.toIntArray);case"float":return(e,t,n)=>OU(i,e,e.float,e.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function OU(i,e,t,n){return{schema:i,__array:e.__array,isDefined:e.isDefined,rowCount:e.rowCount,value:t,valueKind:e.valueKind,areValuesEqual:e.areValuesEqual,toArray:n}}function Ade(i,e,t){const n=i.separator,r=i.itemParse,s=e.getField(t),o=s?a=>s.str(a).split(n).map(l=>r(l.trim())).filter(l=>!!l):a=>[];return{schema:i,__array:void 0,isDefined:!!s,rowCount:e.rowCount,value:o,valueKind:s?s.valueKind:()=>1,areValuesEqual:(a,l)=>function(c,u){const h=c.length;if(h!==u.length)return!1;for(let d=0;d<h;d++)if(c[d]!==u[d])return!1;return!0}(o(a),o(l)),toArray:a=>Qr(e.rowCount,o,a)}}function Ede(i,e,t){const n=i.space,r=e.fieldNames.includes(`${t}[0]`)||e.fieldNames.includes(`${t}[0][0]`)||e.fieldNames.includes(`${t}[0][0][0]`),s=r?0:1,o=e.fieldNames.includes(`${t}_1`)||e.fieldNames.includes(`${t}_11`)||e.fieldNames.includes(`${t}_111`)?"underscore":"brackets",a=function(u,h,d,f){const m=d?0:1;switch(h){case 1:return f==="brackets"?_=>`${u}[${_+m}]`:_=>`${u}_${_+m}`;case 2:return f==="brackets"?(_,v)=>`${u}[${_+m}][${v+m}]`:(_,v)=>`${u}_${_+m}${v+m}`;case 3:return f==="brackets"?(_,v,g)=>`${u}[${_+m}][${v+m}][${g+m}]`:(_,v,g)=>`${u}_${_+m}${v+m}${g+m}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}(t,n.rank,r,o),l=e.getField(a(s,s,s))||si.Undefined(e.rowCount,i),c=u=>function(h,d,f,m){const _=d.create();if(d.rank===1){const v=d.dimensions[0];for(let g=0;g<v;g++){const b=h.getField(m(g));d.set(_,g,b?b.float(f):0)}}else if(d.rank===2){const v=d.dimensions[0],g=d.dimensions[1];for(let b=0;b<v;b++)for(let p=0;p<g;p++){const y=h.getField(m(b,p));d.set(_,b,p,y?y.float(f):0)}}else{if(d.rank!==3)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const v=d.dimensions[0],g=d.dimensions[1],b=d.dimensions[2];for(let p=0;p<v;p++)for(let y=0;y<g;y++)for(let A=0;A<b;A++){const w=h.getField(m(p,y,A));d.set(_,p,y,A,w?w.float(f):0)}}}return _}(e,n,u,a);return{schema:i,__array:void 0,isDefined:l.isDefined,rowCount:e.rowCount,value:c,valueKind:l.valueKind,areValuesEqual:(u,h)=>Dg.areEqualExact(c(u),c(h)),toArray:u=>Qr(e.rowCount,c,u)}}(function(i){function e(t){return t.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}i.canonical=e,i.equal=function(t,n){return e(t)===e(n)},i.create=function(t,n,r=!1){const s=`${t}${n?`.${n}`:""}`;return r?e(s):s}})(Sp||(Sp={}));class Tde{constructor(e,t,n){this._isDefined=n;const r=Object.keys(t);this._rowCount=e.rowCount,this._columns=r,this._schema=t;const s=Object.create(null);for(const o of r)Object.defineProperty(this,o,{get:function(){if(s[o])return s[o];const a=t[o];if(a.valueType==="list")s[o]=Ade(a,e,o);else if(a.valueType==="tensor")s[o]=Ede(a,e,o);else{const l=Mde(a),c=e.getField(o);s[o]=c?l(c,e,o):si.Undefined(e.rowCount,a)}return s[o]},enumerable:!0,configurable:!1})}}function Cde(i,e,t,n){const r=Sp.create(e,i),s=Sp.canonical(r);if(s in t)return t[s];if(n&&r in n)for(const o of n[r]){const a=Sp.canonical(o);if(a in t)return t[a]}}function Pde(i,e,t,n){let r=t.categories[i];if(n){const s=function(c){const u=Object.create(null);for(const h of Object.keys(c.categories))for(const d of c.categories[h].fieldNames)u[Sp.create(h,d,!0)]=c.categories[h].getField(d);return u}(t),o=Object.create(null),a=[];let l=0;for(const c of Object.keys(e)){const u=Cde(c,i,s,n);u&&(o[c]=u,a.push(c),l=u.rowCount)}r={rowCount:l,name:i,fieldNames:[...a],getField:c=>o[c]}}return new Tde(r||yb.empty(i),e,!!r)}var _c=si.Schema;const ce=_c.str,Ve=_c.int,Kt=_c.float,EA=_c.coord,At=_c.Aliased,$c=_c.Matrix,Ey=_c.Vector,Sn=_c.lstr,mh=_c.List,Rde={atom_site:{auth_asym_id:ce,auth_atom_id:ce,auth_comp_id:ce,auth_seq_id:Ve,B_iso_or_equiv:Kt,Cartn_x:EA,Cartn_y:EA,Cartn_z:EA,group_PDB:At(ce),id:Ve,label_alt_id:ce,label_asym_id:ce,label_atom_id:ce,label_comp_id:ce,label_entity_id:ce,label_seq_id:Ve,occupancy:Kt,type_symbol:ce,pdbx_PDB_ins_code:ce,pdbx_PDB_model_num:Ve,pdbx_formal_charge:Ve,pdbx_label_index:Ve,pdbx_sifts_xref_db_name:ce,pdbx_sifts_xref_db_acc:ce,pdbx_sifts_xref_db_num:ce,pdbx_sifts_xref_db_res:ce,ihm_model_id:Ve},atom_site_anisotrop:{id:Ve,type_symbol:ce,U:$c(3,3),U_esd:$c(3,3),pdbx_auth_seq_id:ce,pdbx_auth_asym_id:ce,pdbx_auth_atom_id:ce,pdbx_auth_comp_id:ce,pdbx_label_seq_id:Ve,pdbx_label_alt_id:ce,pdbx_label_asym_id:ce,pdbx_label_atom_id:ce,pdbx_label_comp_id:ce,pdbx_PDB_ins_code:ce},atom_sites:{entry_id:ce,fract_transf_matrix:$c(3,3),fract_transf_vector:Ey(3)},audit_author:{name:ce,pdbx_ordinal:Ve,identifier_ORCID:ce},audit_conform:{dict_location:ce,dict_name:ce,dict_version:ce},cell:{angle_alpha:Kt,angle_beta:Kt,angle_gamma:Kt,entry_id:ce,length_a:Kt,length_b:Kt,length_c:Kt,Z_PDB:Ve,pdbx_unique_axis:ce},chem_comp:{formula:ce,formula_weight:Kt,id:ce,mon_nstd_flag:At(Sn),name:ce,type:At(Sn),pdbx_synonyms:mh(";",i=>i)},chem_comp_bond:{atom_id_1:ce,atom_id_2:ce,comp_id:ce,value_order:At(Sn),pdbx_ordinal:Ve,pdbx_stereo_config:At(Sn),pdbx_aromatic_flag:At(Sn)},citation:{book_publisher:ce,country:ce,id:ce,journal_abbrev:ce,journal_id_ASTM:ce,journal_id_CSD:ce,journal_id_ISSN:ce,journal_volume:ce,page_first:ce,page_last:ce,title:ce,year:Ve,pdbx_database_id_DOI:ce,pdbx_database_id_PubMed:Ve},citation_author:{citation_id:ce,name:ce,ordinal:Ve},database_2:{database_id:At(Sn),database_code:ce},entity:{details:ce,formula_weight:Kt,id:ce,src_method:At(Sn),type:At(Sn),pdbx_description:mh(",",i=>i),pdbx_number_of_molecules:Ve,pdbx_mutation:ce,pdbx_fragment:ce,pdbx_ec:mh(",",i=>i)},entity_poly:{entity_id:ce,nstd_linkage:At(Sn),nstd_monomer:At(Sn),type:At(ce),pdbx_strand_id:mh(",",i=>i),pdbx_seq_one_letter_code:ce,pdbx_seq_one_letter_code_can:ce,pdbx_target_identifier:ce},entity_poly_seq:{entity_id:ce,hetero:At(Sn),mon_id:ce,num:Ve},entry:{id:ce},exptl:{entry_id:ce,method:At(ce)},software:{classification:ce,date:ce,description:ce,name:ce,type:At(Sn),version:ce,pdbx_ordinal:Ve},struct:{entry_id:ce,title:ce,pdbx_descriptor:ce},struct_asym:{details:ce,entity_id:ce,id:ce,pdbx_modified:ce,pdbx_blank_PDB_chainid_flag:At(ce)},struct_conf:{beg_label_asym_id:ce,beg_label_comp_id:ce,beg_label_seq_id:Ve,beg_auth_asym_id:ce,beg_auth_comp_id:ce,beg_auth_seq_id:Ve,conf_type_id:At(Sn),details:ce,end_label_asym_id:ce,end_label_comp_id:ce,end_label_seq_id:Ve,end_auth_asym_id:ce,end_auth_comp_id:ce,end_auth_seq_id:Ve,id:ce,pdbx_beg_PDB_ins_code:ce,pdbx_end_PDB_ins_code:ce,pdbx_PDB_helix_class:ce,pdbx_PDB_helix_length:Ve,pdbx_PDB_helix_id:ce},struct_conn:{conn_type_id:At(Sn),details:ce,id:ce,ptnr1_label_asym_id:ce,ptnr1_label_atom_id:ce,ptnr1_label_comp_id:ce,ptnr1_label_seq_id:Ve,ptnr1_auth_asym_id:ce,ptnr1_auth_comp_id:ce,ptnr1_auth_seq_id:Ve,ptnr1_symmetry:ce,ptnr2_label_asym_id:ce,ptnr2_label_atom_id:ce,ptnr2_label_comp_id:ce,ptnr2_label_seq_id:Ve,ptnr2_auth_asym_id:ce,ptnr2_auth_comp_id:ce,ptnr2_auth_seq_id:Ve,ptnr2_symmetry:ce,pdbx_ptnr1_PDB_ins_code:ce,pdbx_ptnr1_label_alt_id:ce,pdbx_ptnr1_standard_comp_id:ce,pdbx_ptnr2_PDB_ins_code:ce,pdbx_ptnr2_label_alt_id:ce,pdbx_ptnr3_PDB_ins_code:ce,pdbx_ptnr3_label_alt_id:ce,pdbx_ptnr3_label_asym_id:ce,pdbx_ptnr3_label_atom_id:ce,pdbx_ptnr3_label_comp_id:ce,pdbx_ptnr3_label_seq_id:Ve,pdbx_PDB_id:ce,pdbx_dist_value:Kt,pdbx_value_order:At(Sn)},struct_conn_type:{criteria:ce,id:At(Sn),reference:ce},struct_keywords:{entry_id:ce,text:mh(",",i=>i),pdbx_keywords:ce},struct_ncs_oper:{code:At(ce),details:ce,id:Ve,matrix:$c(3,3),vector:Ey(3)},struct_sheet_range:{beg_label_asym_id:ce,beg_label_comp_id:ce,beg_label_seq_id:Ve,end_label_asym_id:ce,end_label_comp_id:ce,end_label_seq_id:Ve,beg_auth_asym_id:ce,beg_auth_comp_id:ce,beg_auth_seq_id:Ve,end_auth_asym_id:ce,end_auth_comp_id:ce,end_auth_seq_id:Ve,id:ce,sheet_id:ce,pdbx_beg_PDB_ins_code:ce,pdbx_end_PDB_ins_code:ce},struct_site:{details:ce,id:ce,pdbx_num_residues:Ve,pdbx_evidence_code:ce,pdbx_auth_asym_id:ce,pdbx_auth_comp_id:ce,pdbx_auth_seq_id:ce,pdbx_auth_ins_code:ce},struct_site_gen:{details:ce,id:ce,label_alt_id:ce,label_asym_id:ce,label_atom_id:ce,label_comp_id:ce,label_seq_id:Ve,auth_asym_id:ce,auth_comp_id:ce,auth_seq_id:ce,site_id:ce,symmetry:ce,pdbx_auth_ins_code:ce,pdbx_num_res:Ve},symmetry:{entry_id:ce,cell_setting:At(Sn),Int_Tables_number:Ve,space_group_name_Hall:ce,"space_group_name_H-M":ce},pdbx_database_status:{status_code:At(ce),status_code_sf:At(ce),status_code_mr:At(ce),entry_id:ce,recvd_initial_deposition_date:ce,SG_entry:At(Sn),deposit_site:At(ce),process_site:At(ce),status_code_cs:At(ce),methods_development_category:At(ce),pdb_format_compatible:At(Sn)},pdbx_nonpoly_scheme:{asym_id:ce,entity_id:ce,mon_id:ce,pdb_strand_id:ce,ndb_seq_num:ce,pdb_seq_num:ce,auth_seq_num:ce,pdb_mon_id:ce,auth_mon_id:ce,pdb_ins_code:ce},pdbx_database_related:{db_name:ce,details:ce,db_id:ce,content_type:At(ce)},pdbx_entity_nonpoly:{entity_id:ce,comp_id:ce,name:ce},pdbx_chem_comp_synonyms:{name:ce,comp_id:ce,provenance:At(ce)},pdbx_chem_comp_identifier:{comp_id:ce,identifier:ce,type:At(ce),program:ce,program_version:ce},pdbx_unobs_or_zero_occ_residues:{id:Ve,polymer_flag:At(Sn),occupancy_flag:At(Ve),PDB_model_num:Ve,auth_asym_id:ce,auth_comp_id:ce,auth_seq_id:ce,PDB_ins_code:ce,label_asym_id:ce,label_comp_id:ce,label_seq_id:Ve},pdbx_struct_mod_residue:{id:Ve,auth_asym_id:ce,auth_comp_id:ce,auth_seq_id:Ve,PDB_ins_code:ce,label_asym_id:ce,label_comp_id:ce,label_seq_id:Ve,parent_comp_id:ce,details:ce},pdbx_struct_oper_list:{id:ce,type:At(ce),name:ce,symmetry_operation:ce,matrix:$c(3,3),vector:Ey(3)},pdbx_struct_assembly:{method_details:ce,oligomeric_details:ce,oligomeric_count:Ve,details:ce,id:ce},pdbx_struct_assembly_gen:{asym_id_list:mh(",",i=>i),assembly_id:ce,oper_expression:ce},pdbx_reference_entity_list:{prd_id:ce,ref_entity_id:ce,type:At(Sn),details:ce,component_id:Ve},pdbx_reference_entity_link:{link_id:Ve,prd_id:ce,details:ce,ref_entity_id_1:ce,ref_entity_id_2:ce,entity_seq_num_1:Ve,entity_seq_num_2:Ve,comp_id_1:ce,comp_id_2:ce,atom_id_1:ce,atom_id_2:ce,value_order:At(Sn),component_1:Ve,component_2:Ve,link_class:At(ce)},pdbx_reference_entity_poly_link:{link_id:Ve,prd_id:ce,ref_entity_id:ce,component_id:Ve,entity_seq_num_1:Ve,entity_seq_num_2:Ve,comp_id_1:ce,comp_id_2:ce,atom_id_1:ce,atom_id_2:ce,value_order:At(Sn)},pdbx_molecule:{prd_id:ce,instance_id:Ve,asym_id:ce},pdbx_molecule_features:{prd_id:ce,class:At(Sn),type:At(Sn),name:ce,details:ce},entity_src_nat:{entity_id:ce,pdbx_organism_scientific:ce,pdbx_plasmid_name:ce,pdbx_src_id:Ve,pdbx_beg_seq_num:Ve,pdbx_end_seq_num:Ve},entity_src_gen:{entity_id:ce,pdbx_gene_src_gene:mh(",",i=>i),pdbx_gene_src_scientific_name:ce,plasmid_name:ce,pdbx_src_id:Ve,pdbx_beg_seq_num:Ve,pdbx_end_seq_num:Ve},pdbx_entity_src_syn:{organism_scientific:ce,entity_id:ce,pdbx_src_id:Ve,pdbx_beg_seq_num:Ve,pdbx_end_seq_num:Ve},pdbx_entity_branch_descriptor:{entity_id:ce,descriptor:ce,type:At(Sn),program:ce,program_version:ce,ordinal:Ve},pdbx_entity_instance_feature:{details:ce,feature_type:At(ce),auth_asym_id:ce,asym_id:ce,auth_seq_num:ce,seq_num:Ve,comp_id:ce,auth_comp_id:ce,ordinal:Ve},pdbx_entity_branch_list:{entity_id:ce,hetero:At(Sn),comp_id:ce,num:Ve},pdbx_entity_branch_link:{link_id:Ve,details:ce,entity_id:ce,entity_branch_list_num_1:Ve,entity_branch_list_num_2:Ve,comp_id_1:ce,comp_id_2:ce,atom_id_1:ce,leaving_atom_id_1:ce,atom_stereo_config_1:At(Sn),atom_id_2:ce,leaving_atom_id_2:ce,atom_stereo_config_2:At(Sn),value_order:At(Sn)},pdbx_entity_branch:{entity_id:ce,type:At(ce)},pdbx_branch_scheme:{entity_id:ce,hetero:At(Sn),asym_id:ce,mon_id:ce,num:Ve,pdb_asym_id:ce,pdb_seq_num:ce,pdb_mon_id:ce,auth_asym_id:ce,auth_seq_num:ce,auth_mon_id:ce},pdbx_chem_comp_related:{comp_id:ce,related_comp_id:ce,relationship_type:At(ce),details:ce},ihm_starting_model_details:{starting_model_id:ce,entity_id:ce,entity_description:ce,asym_id:ce,entity_poly_segment_id:Ve,starting_model_source:At(ce),starting_model_auth_asym_id:ce,starting_model_sequence_offset:Ve,dataset_list_id:Ve},ihm_starting_comparative_models:{id:Ve,starting_model_id:ce,starting_model_auth_asym_id:ce,starting_model_seq_id_begin:Ve,starting_model_seq_id_end:Ve,template_auth_asym_id:ce,template_seq_id_begin:Ve,template_seq_id_end:Ve,template_sequence_identity:Kt,template_sequence_identity_denominator:At(Ve),template_dataset_list_id:Ve,alignment_file_id:Ve},ihm_starting_model_seq_dif:{id:Ve,entity_id:ce,asym_id:ce,seq_id:Ve,comp_id:ce,starting_model_id:ce,db_asym_id:ce,db_seq_id:Ve,db_comp_id:ce,details:ce},ihm_model_representation:{id:Ve,name:ce,details:ce},ihm_model_representation_details:{id:Ve,representation_id:Ve,entity_poly_segment_id:Ve,entity_id:ce,entity_description:ce,entity_asym_id:ce,model_object_primitive:At(ce),starting_model_id:ce,model_mode:At(ce),model_granularity:At(ce),model_object_count:Ve},ihm_struct_assembly_details:{id:Ve,assembly_id:Ve,parent_assembly_id:Ve,entity_description:ce,entity_id:ce,asym_id:ce,entity_poly_segment_id:Ve},ihm_struct_assembly:{id:Ve,name:ce,description:ce},ihm_modeling_protocol:{id:Ve,num_steps:Ve,protocol_name:ce},ihm_modeling_protocol_details:{id:Ve,protocol_id:Ve,step_id:Ve,struct_assembly_id:Ve,dataset_group_id:Ve,struct_assembly_description:ce,step_name:ce,step_method:ce,num_models_begin:Ve,num_models_end:Ve,multi_scale_flag:At(Sn),multi_state_flag:At(Sn),ordered_flag:At(Sn),script_file_id:Ve,software_id:Ve},ihm_multi_state_modeling:{state_id:Ve,state_group_id:Ve,population_fraction:Kt,population_fraction_sd:Kt,state_type:ce,state_name:ce,experiment_type:At(ce),details:ce},ihm_modeling_post_process:{id:Ve,protocol_id:Ve,analysis_id:Ve,step_id:Ve,type:At(ce),feature:At(ce),num_models_begin:Ve,num_models_end:Ve},ihm_ensemble_info:{ensemble_id:Ve,ensemble_name:ce,post_process_id:Ve,model_group_id:Ve,ensemble_clustering_method:At(ce),ensemble_clustering_feature:At(ce),num_ensemble_models:Ve,num_ensemble_models_deposited:Ve,ensemble_precision_value:Kt,ensemble_file_id:Ve},ihm_model_list:{model_id:Ve,model_name:ce,assembly_id:Ve,protocol_id:Ve,representation_id:Ve},ihm_model_group:{id:Ve,name:ce,details:ce},ihm_model_group_link:{model_id:Ve,group_id:Ve},ihm_model_representative:{id:Ve,model_group_id:Ve,model_id:Ve,selection_criteria:At(ce)},ihm_dataset_list:{id:Ve,data_type:At(ce),database_hosted:At(Sn)},ihm_dataset_group:{id:Ve,name:ce,application:At(ce),details:ce},ihm_dataset_group_link:{dataset_list_id:Ve,group_id:Ve},ihm_related_datasets:{dataset_list_id_derived:Ve,dataset_list_id_primary:Ve},ihm_dataset_related_db_reference:{id:Ve,dataset_list_id:Ve,db_name:At(ce),accession_code:ce,version:ce,details:ce},ihm_external_reference_info:{reference_id:Ve,reference_provider:ce,reference_type:At(ce),reference:ce,refers_to:At(ce),associated_url:ce},ihm_external_files:{id:Ve,reference_id:Ve,file_path:ce,content_type:At(ce),file_size_bytes:Kt,details:ce},ihm_dataset_external_reference:{id:Ve,dataset_list_id:Ve,file_id:Ve},ihm_localization_density_files:{id:Ve,file_id:Ve,ensemble_id:Ve,entity_id:ce,entity_poly_segment_id:Ve,asym_id:ce},ihm_predicted_contact_restraint:{id:Ve,group_id:Ve,entity_id_1:ce,entity_id_2:ce,asym_id_1:ce,asym_id_2:ce,comp_id_1:ce,comp_id_2:ce,seq_id_1:Ve,seq_id_2:Ve,rep_atom_1:At(ce),rep_atom_2:At(ce),distance_lower_limit:Kt,distance_upper_limit:Kt,probability:Kt,restraint_type:At(ce),model_granularity:At(ce),dataset_list_id:Ve,software_id:Ve},ihm_cross_link_list:{id:Ve,group_id:Ve,entity_description_1:ce,entity_description_2:ce,entity_id_1:ce,entity_id_2:ce,comp_id_1:ce,comp_id_2:ce,seq_id_1:Ve,seq_id_2:Ve,linker_type:At(ce),dataset_list_id:Ve},ihm_cross_link_restraint:{id:Ve,group_id:Ve,entity_id_1:ce,entity_id_2:ce,asym_id_1:ce,asym_id_2:ce,comp_id_1:ce,comp_id_2:ce,seq_id_1:Ve,seq_id_2:Ve,atom_id_1:ce,atom_id_2:ce,restraint_type:At(ce),conditional_crosslink_flag:At(ce),model_granularity:At(ce),distance_threshold:Kt,psi:Kt,sigma_1:Kt,sigma_2:Kt},ihm_cross_link_result_parameters:{id:Ve,restraint_id:Ve,model_id:Ve,psi:Kt,sigma_1:Kt,sigma_2:Kt},ihm_2dem_class_average_restraint:{id:Ve,dataset_list_id:Ve,number_raw_micrographs:Ve,pixel_size_width:Kt,pixel_size_height:Kt,image_resolution:Kt,image_segment_flag:At(Sn),number_of_projections:Ve,struct_assembly_id:Ve,details:ce},ihm_2dem_class_average_fitting:{id:Ve,restraint_id:Ve,model_id:Ve,cross_correlation_coefficient:Kt,rot_matrix:$c(3,3),tr_vector:Ey(3)},ihm_3dem_restraint:{id:Ve,dataset_list_id:Ve,model_id:Ve,struct_assembly_id:Ve,fitting_method:ce,number_of_gaussians:Ve,cross_correlation_coefficient:Kt},ihm_sas_restraint:{id:Ve,dataset_list_id:Ve,model_id:Ve,struct_assembly_id:Ve,profile_segment_flag:At(Sn),fitting_atom_type:ce,fitting_method:ce,fitting_state:At(ce),radius_of_gyration:Kt,chi_value:Kt,details:ce},ihm_starting_model_coord:{ordinal_id:Ve,starting_model_id:ce,group_PDB:At(ce),id:Ve,type_symbol:ce,entity_id:ce,atom_id:ce,comp_id:ce,seq_id:Ve,asym_id:ce,Cartn_x:Kt,Cartn_y:Kt,Cartn_z:Kt,B_iso_or_equiv:Kt},ihm_sphere_obj_site:{id:Ve,entity_id:ce,seq_id_begin:Ve,seq_id_end:Ve,asym_id:ce,Cartn_x:Kt,Cartn_y:Kt,Cartn_z:Kt,object_radius:Kt,rmsf:Kt,model_id:Ve},ihm_gaussian_obj_site:{id:Ve,entity_id:ce,seq_id_begin:Ve,seq_id_end:Ve,asym_id:ce,mean_Cartn_x:Kt,mean_Cartn_y:Kt,mean_Cartn_z:Kt,weight:Kt,covariance_matrix:$c(3,3),model_id:Ve},ihm_gaussian_obj_ensemble:{id:Ve,entity_id:ce,seq_id_begin:Ve,seq_id_end:Ve,asym_id:ce,mean_Cartn_x:Kt,mean_Cartn_y:Kt,mean_Cartn_z:Kt,weight:Kt,covariance_matrix:$c(3,3),ensemble_id:Ve},ihm_feature_list:{feature_id:Ve,feature_type:At(ce),entity_type:At(ce)},ihm_poly_residue_feature:{ordinal_id:Ve,feature_id:Ve,entity_id:ce,asym_id:ce,comp_id_begin:ce,comp_id_end:ce,seq_id_begin:Ve,seq_id_end:Ve},ihm_derived_distance_restraint:{id:Ve,group_id:Ve,feature_id_1:Ve,feature_id_2:Ve,group_conditionality:At(ce),random_exclusion_fraction:Kt,distance_upper_limit:Kt,restraint_type:At(ce),dataset_list_id:Ve},ma_model_list:{ordinal_id:Ve,model_id:Ve,model_group_id:Ve,model_name:ce,model_group_name:ce,model_type:At(ce),data_id:Ve},ma_target_entity:{entity_id:ce,data_id:Ve,origin:At(ce)},ma_target_entity_instance:{asym_id:ce,entity_id:ce,details:ce},ma_target_ref_db_details:{target_entity_id:ce,db_name:At(ce),db_code:ce,db_accession:ce,seq_db_isoform:ce,seq_db_align_begin:ce,seq_db_align_end:ce,ncbi_taxonomy_id:ce,organism_scientific:ce},ma_data:{id:Ve,content_type:At(ce),content_type_other_details:ce,name:ce},ma_software_group:{ordinal_id:Ve,group_id:Ve,software_id:Ve},ma_qa_metric:{id:Ve,name:ce,type:At(ce),mode:At(ce),software_group_id:Ve},ma_qa_metric_global:{ordinal_id:Ve,model_id:Ve,metric_id:Ve,metric_value:Kt},ma_qa_metric_local:{ordinal_id:Ve,model_id:Ve,label_asym_id:ce,label_seq_id:Ve,label_comp_id:ce,metric_id:Ve,metric_value:Kt}};var Md=si.Schema;const Ln=Md.str,Ide=Md.float,BU=Md.List,Wa=Md.lstr,mo=Md.Aliased,pg=Md.int,Nf=Md.coord,Lde={chem_comp:{formula:Ln,formula_weight:Ide,id:Ln,mon_nstd_parent_comp_id:BU(",",i=>i),name:Ln,one_letter_code:Ln,three_letter_code:Ln,type:mo(Wa),pdbx_synonyms:BU(";",i=>i),pdbx_type:Ln,pdbx_ambiguous_flag:Ln,pdbx_replaced_by:Ln,pdbx_replaces:Ln,pdbx_formal_charge:pg,pdbx_model_coordinates_details:Ln,pdbx_model_coordinates_db_code:Ln,pdbx_ideal_coordinates_details:Ln,pdbx_ideal_coordinates_missing_flag:mo(Wa),pdbx_model_coordinates_missing_flag:mo(Wa),pdbx_initial_date:Ln,pdbx_modified_date:Ln,pdbx_release_status:mo(Ln),pdbx_processing_site:mo(Ln)},chem_comp_atom:{alt_atom_id:Ln,atom_id:Ln,charge:pg,model_Cartn_x:Nf,model_Cartn_y:Nf,model_Cartn_z:Nf,comp_id:Ln,type_symbol:Ln,pdbx_align:pg,pdbx_ordinal:pg,pdbx_model_Cartn_x_ideal:Nf,pdbx_model_Cartn_y_ideal:Nf,pdbx_model_Cartn_z_ideal:Nf,pdbx_stereo_config:mo(Wa),pdbx_aromatic_flag:mo(Wa),pdbx_leaving_atom_flag:mo(Wa)},chem_comp_bond:{atom_id_1:Ln,atom_id_2:Ln,comp_id:Ln,value_order:mo(Wa),pdbx_ordinal:pg,pdbx_stereo_config:mo(Wa),pdbx_aromatic_flag:mo(Wa)},pdbx_chem_comp_descriptor:{comp_id:Ln,descriptor:Ln,type:mo(Wa),program:Ln,program_version:Ln},pdbx_chem_comp_identifier:{comp_id:Ln,identifier:Ln,type:mo(Ln),program:Ln,program_version:Ln}};var R1=si.Schema;const qt=R1.str,Dde=R1.float,Ul=R1.lstr,ms=R1.Aliased,Bo=R1.int,Nde={pdbx_reference_molecule:{prd_id:qt,formula_weight:Dde,formula:qt,type:ms(Ul),type_evidence_code:qt,class:ms(Ul),class_evidence_code:qt,name:qt,represent_as:ms(Ul),chem_comp_id:qt,compound_details:qt,description:qt,representative_PDB_id_code:qt,release_status:ms(Ul),replaces:qt,replaced_by:qt},pdbx_reference_entity_list:{prd_id:qt,ref_entity_id:qt,type:ms(Ul),details:qt,component_id:Bo},pdbx_reference_entity_nonpoly:{prd_id:qt,ref_entity_id:qt,name:qt,chem_comp_id:qt},pdbx_reference_entity_link:{link_id:Bo,prd_id:qt,details:qt,ref_entity_id_1:qt,ref_entity_id_2:qt,entity_seq_num_1:Bo,entity_seq_num_2:Bo,comp_id_1:qt,comp_id_2:qt,atom_id_1:qt,atom_id_2:qt,value_order:ms(Ul),component_1:Bo,component_2:Bo,link_class:ms(qt)},pdbx_reference_entity_poly_link:{link_id:Bo,prd_id:qt,ref_entity_id:qt,component_id:Bo,entity_seq_num_1:Bo,entity_seq_num_2:Bo,comp_id_1:qt,comp_id_2:qt,atom_id_1:qt,atom_id_2:qt,value_order:ms(Ul)},pdbx_reference_entity_poly:{prd_id:qt,ref_entity_id:qt,type:ms(qt),db_code:qt,db_name:qt},pdbx_reference_entity_poly_seq:{prd_id:qt,ref_entity_id:qt,mon_id:qt,parent_mon_id:qt,num:Bo,observed:ms(Ul),hetero:ms(Ul)},pdbx_reference_entity_sequence:{prd_id:qt,ref_entity_id:qt,type:ms(qt),NRP_flag:ms(qt),one_letter_codes:qt},pdbx_reference_entity_src_nat:{prd_id:qt,ref_entity_id:qt,ordinal:Bo,organism_scientific:qt,taxid:qt,db_code:qt,db_name:qt},pdbx_prd_audit:{prd_id:qt,date:qt,processing_site:ms(qt),action_type:ms(qt)}};var $V=si.Schema;const Ii=$V.str,Fde={datablock:{id:Ii,description:Ii},dictionary:{title:Ii,datablock_id:Ii,version:Ii},dictionary_history:{version:Ii,update:Ii,revision:Ii},sub_category:{id:Ii,description:Ii},category_group_list:{id:Ii,parent_id:Ii,description:Ii},item_type_list:{code:Ii,primitive_code:Ii,construct:Ii,detail:Ii},item_units_list:{code:Ii,detail:Ii},item_units_conversion:{from_code:Ii,to_code:Ii,operator:Ii,factor:$V.float}};var I1=si.Schema;const kg=I1.str,Ty=I1.int,Ol=I1.float,Cy=I1.Aliased,Zc=I1.Vector;Cy(kg),Cy(kg),Cy(kg),Cy(kg),Zc(3),Zc(3);const WV={volume_data_3d_info:{name:kg,axis_order:Zc(3,Ty),origin:Zc(3),dimensions:Zc(3),sample_rate:Ty,sample_count:Zc(3,Ty),spacegroup_number:Ty,spacegroup_cell_size:Zc(3),spacegroup_cell_angles:Zc(3),mean_source:Ol,mean_sampled:Ol,sigma_source:Ol,sigma_sampled:Ol,min_source:Ol,min_sampled:Ol,max_source:Ol,max_sampled:Ol},volume_data_3d:{values:Ol}};var zS=si.Schema;const hi=zS.float,TA=zS.int,Dn=zS.str,kde={cell:{angle_alpha:hi,angle_beta:hi,angle_gamma:hi,formula_units_z:TA,length_a:hi,length_b:hi,length_c:hi,volume:hi},chemical:{melting_point:hi,name_common:Dn,name_systematic:Dn},chemical_formula:{moiety:Dn,sum:Dn,weight:hi},space_group:{crystal_system:Dn,it_number:TA,"name_h-m_full":Dn},space_group_symop:{operation_xyz:Dn},geom_bond:{atom_site_label_1:Dn,atom_site_label_2:Dn,distance:hi,publ_flag:Dn,site_symmetry_1:Dn,site_symmetry_2:Dn,valence:hi},audit:{block_doi:Dn},database_code:{cod:Dn,csd:Dn,depnum_ccdc_archive:Dn,depnum_ccdc_fiz:Dn,icsd:Dn,mdf:Dn,nbs:Dn},atom_site:{adp_type:Dn,calc_flag:Dn,disorder_assembly:Dn,disorder_group:Dn,fract_x:hi,fract_y:hi,fract_z:hi,label:Dn,occupancy:hi,refinement_flags:Dn,site_symmetry_multiplicity:TA,type_symbol:Dn,u_iso_or_equiv:hi},atom_site_aniso:{label:Dn,u_11:hi,u:(0,zS.Matrix)(3,3),u_12:hi,u_13:hi,u_22:hi,u_23:hi,u_33:hi},atom_type:{description:Dn,symbol:Dn},atom_type_scat:{dispersion_imag:hi,dispersion_real:hi,source:Dn}},Ude={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},CA=si.Schema.int,Ode={volume_data_3d_info:WV.volume_data_3d_info,segmentation_data_table:{set_id:CA,segment_id:CA},segmentation_data_3d:{values:CA}},zU={parse:i=>typeof i=="string"?RU(i):UU(i),parseText:RU,parseBinary:UU,toDatabaseCollection:function(i,e,t){const n={};for(const r of e.blocks)n[r.header]=kl(i,r,t);return n},toDatabase:kl,schema:{mmCIF:i=>kl(Rde,i),CCD:i=>kl(Lde,i),BIRD:i=>kl(Nde,i),dic:i=>kl(Fde,i),cifCore:i=>kl(kde,i,Ude),densityServer:i=>kl(WV,i),segmentation:i=>kl(Ode,i)}};class Ua{constructor(e,t){var n=t||{};this.streamer=e,this.name=he(n.name,""),this.path=he(n.path,"")}get type(){return""}get __objName(){return""}get isBinary(){return!1}get isJson(){return!1}get isXml(){return!1}parse(){return this.streamer.read().then(()=>AV(this,void 0,void 0,function*(){return yield this._beforeParse(),yield this._parse(),yield this._afterParse(),this[this.__objName]}))}_parse(){}_beforeParse(){}_afterParse(){pt&&tt.log(this[this.__objName])}}class yc extends Ua{constructor(e,t){var n=t||{};super(e,n),this.firstModelOnly=he(n.firstModelOnly,!1),this.asTrajectory=he(n.asTrajectory,!1),this.cAlphaOnly=he(n.cAlphaOnly,!1),this.structure=new Ja(this.name,this.path),this.structureBuilder=new Tce(this.structure)}get type(){return"structure"}get __objName(){return"structure"}}class wb{constructor(e,t,n="",r,s=[]){this.structure=e,this.index=t,this.description=n,this.entityType=function(o){switch(o=o.toLowerCase()){case"polymer":return 1;case"non-polymer":return 2;case"macrolide":return 3;case"water":return 4;default:return 0}}(r||""),this.chainIndexList=s,s.forEach(function(o){e.chainStore.entityIndex[o]=t})}get type(){return function(e){switch(e){case 1:return"polymer";case 2:return"non-polymer";case 3:return"macrolide";case 4:return"water";default:return}}(this.entityType)}getEntityType(){return this.entityType}isPolymer(){return this.entityType===1}isNonPolymer(){return this.entityType===2}isMacrolide(){return this.entityType===3}isWater(){return this.entityType===4}eachChain(e){const t=this.structure.getChainProxy();this.chainIndexList.forEach(function(n){t.index=n,e(t)})}}const Bde={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"};class Mb{constructor(e=Bde){this.cartToFrac=new Tt,this.fracToCart=new Tt,this.a=e.a,this.b=e.b,this.c=e.c,this.alpha=e.alpha,this.beta=e.beta,this.gamma=e.gamma,this.spacegroup=e.spacegroup;const t=wi(this.alpha),n=wi(this.beta),r=wi(this.gamma),s=Math.cos(t),o=Math.cos(n),a=Math.cos(r),l=Math.sin(n),c=Math.sin(r);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-s*s-o*o-a*a+2*s*o*a),e.cartToFrac===void 0){const u=this.a*this.b*c/this.volume,h=(o*a-s)/(l*c);this.fracToCart.set(this.a,0,0,0,this.b*a,this.b*c,0,0,this.c*o,-this.c*l*h,1/u,0,0,0,0,1).transpose(),this.cartToFrac.copy(this.fracToCart).invert()}else this.cartToFrac.copy(e.cartToFrac),this.fracToCart.copy(this.cartToFrac).invert()}getPosition(e){const t=new Float32Array(24);if(e.unitcell){const n=e.unitcell,r=e.center.clone().applyMatrix4(n.cartToFrac).floor(),s=new me;let o=0;const a=function(l,c,u){s.set(l,c,u).add(r).applyMatrix4(n.fracToCart).toArray(t,o),o+=3};a(0,0,0),a(1,0,0),a(0,1,0),a(0,0,1),a(1,1,0),a(1,0,1),a(0,1,1),a(1,1,1)}return t}getCenter(e){return function(t,n=new me){const r=t.length;for(let s=0;s<r;s+=3)n.x+=t[s],n.y+=t[s+1],n.z+=t[s+2];return n.divideScalar(r/3),n}(this.getPosition(e))}getData(e,t={}){const n=he(t.colorValue,"orange"),r=he(t.radius,Math.cbrt(this.volume)/200),s=new Ht(n),o=new me,a=this.getPosition(e),l=Bn(8,s.r,s.g,s.b),c=Mo(8,r),u=new Float32Array(36),h=new Float32Array(36),d=Bn(12,s.r,s.g,s.b),f=Mo(12,r);let m=0;function _(g,b){o.fromArray(a,3*g).toArray(u,m),o.fromArray(a,3*b).toArray(h,m),m+=3}_(0,1),_(0,2),_(0,3),_(1,4),_(1,5),_(2,6),_(3,5),_(4,7),_(5,7),_(2,4),_(7,6),_(3,6);const v=new Qle(this,e);return{vertex:{position:a,color:l,radius:c,picking:v},edge:{position1:u,position2:h,color:d,color2:d,radius:f,picking:v}}}}const Ab={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},zde=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],Gde=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],GU=/\s+/;function VU(i,e,t){let n=`${i}`;return e&&(n+=`:${e}`),t&&(n+=`^${t}`),n}class a0 extends yc{constructor(e,t){const n=t||{};super(e,n),this.hex=he(n.hex,!1),this.inferBonds=he(n.inferBonds,"all")}get type(){return"pdb"}_parse(){pt&&tt.time("PdbParser._parse "+this.name);let e=!1;const t=this.streamer.peekLines(1)[0],n=t.substr(62,4),r=t.substr(72,4);n===r&&r.trim()&&(e=!0);const s=this.type==="pqr",o=this.type==="pdbqt",a=this.structure,l=this.structureBuilder,c=this.hex;let u=10,h=10;const d=this.firstModelOnly,f=this.asTrajectory,m=this.cAlphaOnly,_=a.frames,v=a.boxes;let g,b,p=!1;const y=a.biomolDict;let A,w,M,T,E,C,N,P,L,R,F,V,z,U,G,B,D,O,j,q,Y,ie,ne={};const Q={},le={},se=[];let oe,$;const pe={},xe={},Pe={};let ve,Ue,Le,Z,J,de,Ie;const te={};let X;const ye={helices:[],sheets:[]},ke=ye.helices,ge=ye.sheets,De=a.atomMap,$e=a.atomStore;$e.resize(Math.round(this.streamer.data.length/80)),(s||o)&&$e.addField("partialCharge",1,"float32"),s&&$e.addField("radius",1,"float32");const Ae=a.getAtomProxy(),Ze=a.getAtomProxy();let nt=0,rt=0,Oe=!0;this.streamer.eachChunkOfLines(function(it){(function(at,ht,Qe){for(let je=at;je<ht;++je)if(T=Qe[je],E=T.substr(0,6),E==="ATOM  "||E==="HETATM"){if(Oe&&(f?(p?(g=new Float32Array(3*$e.count),_.push(g)):g=[],b=0):d||(ne={}),ve=1,Ue=ve.toString(),Le=!0,Oe=!1),d&&rt>0)continue;let ee,ze,Ee,Re,Xe,gt=0;if(s){if(Re=T.split(GU),gt=Re.length===10?1:0,V=Re[2],m&&V!=="CA")continue;ee=parseFloat(Re[6-gt]),ze=parseFloat(Re[7-gt]),Ee=parseFloat(Re[8-gt])}else{if(V=T.substr(12,4).trim(),m&&V!=="CA")continue;ee=parseFloat(T.substr(30,8)),ze=parseFloat(T.substr(38,8)),Ee=parseFloat(T.substr(46,8))}if(f){const Mt=3*b;if(g[Mt+0]=ee,g[Mt+1]=ze,g[Mt+2]=Ee,b+=1,p)continue}s?(C=parseInt(Re[1]),Xe="",z=T[0]==="H",N=gt?"":Re[4],P=parseInt(Re[5-gt]),F="",L=Re[3],G="",R=1):(C=parseInt(T.substr(6,5),u),c&&C===99999&&(u=16),z=T[0]==="H",N=T[21].trim(),P=parseInt(T.substr(22,4),h),c&&P===9999&&(h=16),F=T[26].trim(),L=T.substr(17,4).trim()||"MOL",U=parseFloat(T.substr(60,6)),G=T[16].trim(),R=parseFloat(T.substr(54,6)),e||(o?(Xe=T.substr(76,3).trim(),Xe in c4&&(Xe=c4[Xe])):(Xe=T.substr(76,2).trim(),N||(N=T.substr(72,4).trim())),B=parseInt((T.substr(79,1)+T.substr(78,1)).trim()))),$e.growIfFull(),$e.atomTypeId[nt]=De.add(V,Xe),$e.x[nt]=ee,$e.y[nt]=ze,$e.z[nt]=Ee,$e.serial[nt]=C,$e.altloc[nt]=G.charCodeAt(0),$e.occupancy[nt]=isNaN(R)?0:R,s?($e.partialCharge[nt]=parseFloat(Re[9-gt]),$e.radius[nt]=parseFloat(Re[10-gt])):($e.bfactor[nt]=isNaN(U)?0:U,o&&($e.partialCharge[nt]=parseFloat(T.substr(70,6))),isFinite(B)&&($e.formalCharge||$e.addField("formalCharge",1,"int8"),$e.formalCharge[nt]=B));const _t=VU(P,N,F);!z||xe[_t]||zde.includes(L)?Le||Z===N||(ve+=1,Ue=ve.toString()):Z===N&&de===L&&(fb.includes(L)||J===P&&Ie===F)||(ve+=1,Ue=ve.toString(),J=P,de=L,Ie=F),l.addAtom(rt,N,Ue,L,P,z,void 0,F),ne[C]=nt,nt+=1,Le=!1,Z=N}else if(E==="CONECT"){const ee=ne[parseInt(T.substr(6,5))],ze=[11,16,21,26],Ee={};if(ee===void 0)continue;for(let Re=0;Re<4;++Re){let Xe=parseInt(T.substr(ze[Re],5));if(!Number.isNaN(Xe)&&(Xe=ne[Xe],Xe!==void 0))if(ee<Xe?(Ae.index=ee,Ze.index=Xe):(Ae.index=Xe,Ze.index=ee),Ee[Xe]!==void 0)a.bondStore.bondOrder[Ee[Xe]]+=1;else{const gt=Ae.index+"|"+Ze.index;le[gt]===void 0&&(le[gt]=!0,Ee[Xe]=a.bondStore.count,a.bondStore.addBond(Ae,Ze,1))}}}else if(E==="HELIX "){D=T[19].trim(),O=parseInt(T.substr(21,4)),j=T[25].trim(),q=T[31].trim(),Y=parseInt(T.substr(33,4)),ie=T[37].trim();let ee=parseInt(T.substr(39,1));ee=(Ab[ee]||Ab[0]).charCodeAt(0),ke.push([D,O,j,q,Y,ie,ee])}else if(E==="SHEET ")D=T[21].trim(),O=parseInt(T.substr(22,4)),j=T[26].trim(),q=T[32].trim(),Y=parseInt(T.substr(33,4)),ie=T[37].trim(),ge.push([D,O,j,q,Y,ie]);else if(E==="HETNAM")pe[T.substr(11,3)]=T.substr(15).trim();else if(E==="SEQRES"){const ee=T[11].trim();ee!==X&&(te[ee]=[],X=ee),te[ee].push(...T.substr(19).trim().split(GU))}else if(E==="MODRES"){const ee=T.substr(12,3).trim(),ze=T[16].trim(),Ee=T[22].trim(),Re=parseInt(T.substr(18,4).trim()),Xe=VU(Re,ze,Ee);xe[Xe]={resname:ee,chainname:ze,inscode:Ee,resno:Re}}else if(E==="COMPND"){const ee=T.substr(10,70).trim(),ze=ee.indexOf(":"),Ee=ee.substring(0,ze);let Re;Gde.includes(Ee)?($=Ee,Re=ee.substring(ze+2)):Re=ee,Re=Re.replace(/;$/,""),$==="MOL_ID"?(oe={chainList:[],name:""},se.push(oe)):$==="MOLECULE"?(oe.name&&(oe.name+=" "),oe.name+=Re):$==="CHAIN"&&Array.prototype.push.apply(oe.chainList,Re.split(/\s*,\s*/))}else if(T.startsWith("TER")){const ee=a.getChainProxy(a.chainStore.count-1);Pe[ee.chainname]=ee.index,ve+=1,Ue=ve.toString(),Le=!0}else if(E==="REMARK"&&T.substr(7,3)==="350"){if(T.substr(11,12)==="BIOMOLECULE:"){let ee=T.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(ee)&&(ee="BU"+ee),A=new Cu(ee),y[ee]=A}else if(T.substr(13,5)==="BIOMT"){const ee=T.split(/\s+/),ze=parseInt(T[18])-1;ze===0&&(M=new Tt,w.matrixList.push(M));const Ee=M.elements;Ee[0+ze]=parseFloat(ee[4]),Ee[4+ze]=parseFloat(ee[5]),Ee[8+ze]=parseFloat(ee[6]),Ee[12+ze]=parseFloat(ee[7])}else if(T.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||T.substr(11,30)==="                   AND CHAINS:"){T.substr(11,5)==="APPLY"&&(w=A.addPart());const ee=T.substr(41,30).split(",");for(let ze=0,Ee=ee.length;ze<Ee;++ze){const Re=ee[ze].trim();Re&&w.chainList.push(Re)}}}else if(E==="HEADER")a.id=T.substr(62,4);else if(E==="TITLE ")a.title+=(a.title?" ":"")+T.substr(10,70).trim();else if(E==="MODEL ")Oe=!0;else if(E==="ENDMDL"||T.trim()==="END"){if(Oe)continue;f&&!p&&(_.push(new Float32Array(g)),p=!0),rt+=1,Oe=!0}else if(T.substr(0,5)==="MTRIX"){if(T[59]==="1")continue;if(!A||A.name!=="NCS"){const Re="NCS";A=new Cu(Re),y[Re]=A,w=A.addPart()}const ee=T.split(/\s+/),ze=parseInt(T[5])-1;ze===0&&(M=new Tt,w.matrixList.push(M));const Ee=M.elements;Ee[0+ze]=parseFloat(ee[2]),Ee[4+ze]=parseFloat(ee[3]),Ee[8+ze]=parseFloat(ee[4]),Ee[12+ze]=parseFloat(ee[5])}else if(T.substr(0,5)==="ORIGX"){Q.origx||(Q.origx=new Tt);const ee=T.split(/\s+/),ze=parseInt(T[5])-1,Ee=Q.origx.elements;Ee[0+ze]=parseFloat(ee[1]),Ee[4+ze]=parseFloat(ee[2]),Ee[8+ze]=parseFloat(ee[3]),Ee[12+ze]=parseFloat(ee[4])}else if(T.substr(0,5)==="SCALE"){Q.scale||(Q.scale=new Tt);const ee=T.split(/\s+/),ze=parseInt(T[5])-1,Ee=Q.scale.elements;Ee[0+ze]=parseFloat(ee[1]),Ee[4+ze]=parseFloat(ee[2]),Ee[8+ze]=parseFloat(ee[3]),Ee[12+ze]=parseFloat(ee[4])}else if(E==="CRYST1"){const ee=parseFloat(T.substr(6,9)),ze=parseFloat(T.substr(15,9)),Ee=parseFloat(T.substr(24,9)),Re=parseFloat(T.substr(33,7)),Xe=parseFloat(T.substr(40,7)),gt=parseFloat(T.substr(47,7)),_t=T.substr(55,11).trim(),Mt=new Float32Array(9);Mt[0]=ee,Mt[4]=ze,Mt[8]=Ee,v.push(Mt),rt===0&&(Q.a=ee,Q.b=ze,Q.c=Ee,Q.alpha=Re,Q.beta=Xe,Q.gamma=gt,Q.spacegroup=_t)}})(0,it.length,it)}),l.finalize();const qe=se.length;if(qe){a.eachChain(function(Qe){Qe.entityIndex=qe}),se.forEach(function(Qe,je){const ee=Qe.chainList.map(function(ze){return Pe[ze]});a.entityList.push(new wb(a,je,Qe.name,"polymer",ee))});let it=se.length;const at=a.getResidueProxy(),ht={};a.eachChain(function(Qe){Qe.entityIndex===qe&&(at.index=Qe.residueOffset,ht[at.resname]||(ht[at.resname]=[]),ht[at.resname].push(Qe.index))}),Object.keys(ht).forEach(function(Qe){const je=ht[Qe];let ee="non-polymer",ze=pe[Qe]||Qe;fb.includes(Qe)&&(ze="water",ee="water"),a.entityList.push(new wb(a,it,ze,ee,je)),it+=1})}Q.a!==void 0?a.unitcell=new Mb(Q):a.unitcell=void 0,(ke.length||ge.length)&&fV(a,ye),a.finalizeAtoms(),e||kS(a),mb(a,this.inferBonds),a.finalizeBonds(),ke.length||ge.length||FS(a),gb(a),pt&&tt.timeEnd("PdbParser._parse "+this.name)}}Zt.add("pdb",a0),Zt.add("pdb1",a0),Zt.add("ent",a0);class Vde{constructor(e){this.structure=e,this.dict={},this.structure=e}add(e,t,n){this.dict[e]={chemCompType:t},n&&(this.dict[e].bonds=n)}addBond(e,t,n,r){const s=this.dict[e];if(!s)return;s.bonds||(s.bonds={atom1:[],atom2:[],bondOrders:[]});const o=s.bonds;o.atom1.push(t),o.atom2.push(n),o.bondOrders.push(r)}getBonds(e,t){var n;const r=(n=this.dict[e])===null||n===void 0?void 0:n.bonds;if(!r)return;const s=this.structure.atomMap,o=new Map(t.map((d,f)=>{var m;return[(m=s.get(d))===null||m===void 0?void 0:m.atomname,f]})),a=[],l=[],c=[];let u,h;for(let d=0;d<r.atom1.length;d++)(u=o.get(r.atom1[d]))!==void 0&&(h=o.get(r.atom2[d]))!==void 0&&(a.push(u),l.push(h),c.push(r.bondOrders[d]));return{atomIndices1:a,atomIndices2:l,bondOrders:c}}}const Hde=/^\D{1,2}/,$de={HELX_RH_AL_P:"h",STRN:"e",HELX_RH_3T_P:"g",HELX_RH_PI_P:"i",HELX_LH_PP_P:"e",TURN_TY1_P:"t",BEND:"s",OTHER:" "},Wde={AROM:1,DELO:2,DIRECTED:0,DOUB:2,PI:0,POLY:0,QUAD:4,SING:1,TRIP:3};function HU(i){switch(i.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}class Py extends yc{get type(){return"cif"}get isBinary(){return!1}_parse(){var e,t,n,r,s,o,a,l,c,u,h,d,f,m,_,v,g,b,p,y,A;return AV(this,void 0,void 0,function*(){tt.time("CifParser._parse "+this.name);const w=this.structure,M=this.structureBuilder,T=this.firstModelOnly,E=this.asTrajectory,C=w.frames;let N,P;const L=this.isBinary?zU.parseBinary(this.streamer.data):zU.parseText(this.streamer.compressed?K0(this.streamer.data):this.streamer.data),R=yield L.run();if(R.isError)throw R;const F=R.result.blocks[0];if("chem_comp"in F.categories&&"chem_comp_atom"in F.categories&&!("struct"in F.categories))(function(V,z,U){const G=z.atomStore,B=z.atomMap;let D,O;const j=V.chem_comp,q=V.chem_comp_atom,Y=V.chem_comp_bond;let ie;j&&((ie=j.getField("name"))&&(z.title=ie.str(0)),(ie=j.getField("id"))&&(z.id=ie.str(0)));const ne={};if(q){let Q,le,se,oe;O=q.rowCount,G.resize(2*O);const $=q.getField("atom_id"),pe=q.getField("type_symbol"),xe=q.getField("pdbx_component_comp_id"),Pe=q.getField("pdbx_residue_numbering");[["model_Cartn_x","model_Cartn_y","model_Cartn_z"],["pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal"]].forEach(([ve,Ue,Le],Z)=>{var J;const de=q.getField(ve),Ie=q.getField(Ue),te=q.getField(Le),X=Z*O;for(let ye=0;ye<O;++ye){const ke=ye+X;G.growIfFull(),Q=$==null?void 0:$.str(ye),le=pe==null?void 0:pe.str(ye),ne[Q]=ye,G.atomTypeId[ke]=B.add(Q,le),G.x[ke]=de.float(ye),G.y[ke]=Ie.float(ye),G.z[ke]=te.float(ye),G.serial[ke]=ye,se=xe.str(ye),oe=(J=Pe==null?void 0:Pe.int(ye))!==null&&J!==void 0?J:1,U.addAtom(Z,"","",se,oe,!0)}})}if(q&&Y){let Q,le,se;O=Y.rowCount;const oe=q.rowCount,$=z.getAtomProxy(),pe=z.getAtomProxy(),xe=Y.getField("atom_id_1"),Pe=Y.getField("atom_id_2"),ve=Y.getField("value_order");for(D=0;D<O;++D)Q=xe.str(D),le=Pe.str(D),se=HU(ve.str(D)),$.index=ne[Q],pe.index=ne[le],z.bondStore.growIfFull(),z.bondStore.addBond($,pe,se),$.index+=oe,pe.index+=oe,z.bondStore.growIfFull(),z.bondStore.addBond($,pe,se)}})(F.categories,w,M),M.finalize(),w.finalizeAtoms(),w.finalizeBonds(),dd(w);else if("atom_site_type_symbol"in F.categories&&"atom_site_label"in F.categories&&"atom_site_fract_x"in F.categories)(function(V,z,U){var G,B,D=z.atomStore,O=z.atomMap;V.header&&(z.id=V.header,z.name=V.header),z.unitcell=new Mb({a:V.getField("cell_length_a").float(0),b:V.getField("cell_length_b").float(0),c:V.getField("cell_length_c").float(0),alpha:V.getField("cell_angle_alpha").float(0),beta:V.getField("cell_angle_beta").float(0),gamma:V.getField("cell_angle_gamma").float(0),spacegroup:V.getField("symmetry_space_group_name_H-M").str(0)});const j=new me,q=new me,Y=V.getField("atom_site_type_symbol");if(!Y)return;const ie=(G=Y.rowCount)!==null&&G!==void 0?G:0,ne=V.getField("atom_site_type_symbol"),Q=V.getField("atom_site_fract_x"),le=V.getField("atom_site_fract_y"),se=V.getField("atom_site_fract_z"),oe=V.getField("atom_site_occupancy"),$={};for(let Z=0;Z<ie;++Z){D.growIfFull();const J=ne.str(Z),de=Y.str(Z);let Ie=$[de];if(!Ie){const te=de.match(Hde);$[de]=Ie=(B=te==null?void 0:te[0])!==null&&B!==void 0?B:de}D.atomTypeId[Z]=O.add(J,Ie),j.set(Q.float(Z),le.float(Z),se.float(Z)),j.applyMatrix4(z.unitcell.fracToCart),q.add(j),D.x[Z]=j.x,D.y[Z]=j.y,D.z[Z]=j.z,oe&&(D.occupancy[Z]=oe.float(Z)),D.serial[Z]=Z,U.addAtom(0,"","","HET",1,!0)}q.divideScalar(ie),z.center=q,gb(z);const pe=new me,xe=new me,Pe=z.biomolDict.SUPERCELL.partList[0].matrixList;let ve=ie;function Ue(Z){return O.get(D.atomTypeId[Z]).covalent}const Le=new Tt;for(let Z=0;Z<ie;++Z){const J=Ue(Z);j.set(D.x[Z],D.y[Z],D.z[Z]),Pe.forEach(function(de){if(!Le.equals(de)){pe.copy(j),pe.applyMatrix4(de);for(let Ie=0;Ie<ie;++Ie){xe.set(D.x[Ie],D.y[Ie],D.z[Ie]);const te=pe.distanceToSquared(xe),X=Ue(Ie)+J,ye=X+.3,ke=X-.5;if(te<ye*ye&&te>ke*ke)return D.growIfFull(),D.atomTypeId[ve]=D.atomTypeId[Z],D.x[ve]=pe.x,D.y[ve]=pe.y,D.z[ve]=pe.z,D.occupancy[ve]=D.occupancy[Z],D.serial[ve]=ve,D.altloc[ve]=65,U.addAtom(0,"","","HET",1,!0),void(ve+=1)}}})}})(F,w,M),M.finalize(),w.finalizeAtoms(),mb(w),w.finalizeBonds();else{const V={},z={},U=w.atomMap,G=w.atomStore,B=F.categories.atom_site;let D=B.rowCount;const O=B.getField("pdbx_PDB_model_num");if(!((e=O==null?void 0:O.areValuesEqual(0,D-1))===null||e===void 0||e)&&(E||T)){const Z=O.int(0);for(let J=0;J<D;J++)if(O.int(J)>Z){D=J;break}}w.chemCompMap=new Vde(w);const j=F.categories.chem_comp;let q=j.getField("id");const Y=j.getField("type");for(let Z=0;Z<j.rowCount;Z++)w.chemCompMap.add(q.str(Z),Y.str(Z).toUpperCase());if(F.categoryNames.includes("chem_comp_bond")){const Z=F.categories.chem_comp_bond;q=Z.getField("comp_id");const J=Z.getField("atom_id_1"),de=Z.getField("atom_id_2"),Ie=Z.getField("value_order");for(let te=0;te<Z.rowCount;te++){const X=Wde[Ie.str(te)];X&&w.chemCompMap.addBond(q.str(te),J.str(te),de.str(te),X)}}const ie=(Z,J,de)=>{const Ie=Z.getField(J);return Ie?Ie.toFloatArray({array:Float32Array,start:0,end:de}):new Float32Array(de)};G.resize(D),G.x=ie(B,"Cartn_x",D),G.y=ie(B,"Cartn_y",D),G.z=ie(B,"Cartn_z",D),G.serial=B.getField("id").toIntArray({start:0,end:D}),G.bfactor=ie(B,"B_iso_or_equiv",D),G.occupancy=ie(B,"occupancy",D);const ne=B.getField("label_alt_id");ne!=null&&ne.isDefined&&(G.altloc=Uint8Array.from(ne.toStringArray(),Z=>Z.charCodeAt(0)));const Q=B.getField("label_atom_id"),le=B.getField("type_symbol");q=B.getField("label_comp_id");const se=(t=B.getField("auth_seq_id"))!==null&&t!==void 0?t:B.getField("label_seq_id"),oe=B.getField("pdbx_PDB_ins_code"),$=B.getField("auth_asym_id"),pe=B.getField("label_asym_id"),xe=B.getField("group_PDB"),Pe=B.getField("label_entity_id");for(let Z=0;Z<D;Z++){const J=(n=O==null?void 0:O.int(Z))!==null&&n!==void 0?n:1,de=(r=$==null?void 0:$.str(Z))!==null&&r!==void 0?r:"",Ie=(s=pe==null?void 0:pe.str(Z))!==null&&s!==void 0?s:"",te=(o=q==null?void 0:q.str(Z))!==null&&o!==void 0?o:"",X=(a=se==null?void 0:se.int(Z))!==null&&a!==void 0?a:0,ye=(xe==null?void 0:xe.str(Z)[0])==="H",ke=(l=oe==null?void 0:oe.str(Z))!==null&&l!==void 0?l:"",ge=(c=Pe==null?void 0:Pe.int(Z))!==null&&c!==void 0?c:1;G.atomTypeId[Z]=U.add((Q==null?void 0:Q.str(Z))||"",le==null?void 0:le.str(Z)),M.addAtom(J-1,de,Ie,te,X,ye,void 0,ke),V[Ie]=de,z[ge]||(z[ge]=new Set),z[ge].add(w.chainStore.count-1)}if(E){const Z=B.rowCount/D|0,J=B.getField("Cartn_x"),de=B.getField("Cartn_y"),Ie=B.getField("Cartn_z");for(let te=0;te<Z;te++){N=new Float32Array(3*D);const X=te*D,ye=X+D;P=0;for(let ke=X;ke<ye;ke++)N[P+0]=J.float(ke),N[P+1]=de.float(ke),N[P+2]=Ie.float(ke),P+=3;C.push(N)}}const ve=function(Z,J,de){var Ie,te,X,ye,ke,ge;const De=[],$e=[];let Ae,Ze,nt,rt;const Oe=Z.struct_conf;if(Oe!=null&&Oe.fieldNames.includes("pdbx_PDB_helix_class")){const it=Oe.getField("pdbx_beg_PDB_ins_code"),at=Oe.getField("pdbx_end_PDB_ins_code"),ht=Oe.getField("pdbx_PDB_helix_class"),Qe=Oe.getField("beg_label_asym_id"),je=Oe.getField("end_label_asym_id"),ee=Oe.getField("beg_auth_seq_id"),ze=Oe.getField("end_auth_seq_id");for(Ae=0,Ze=Oe.rowCount;Ae<Ze;++Ae){const Ee=ht==null?void 0:ht.int(Ae);Number.isFinite(Ee)&&(nt=(Ie=it==null?void 0:it.str(Ae))!==null&&Ie!==void 0?Ie:"",rt=(te=at==null?void 0:at.str(Ae))!==null&&te!==void 0?te:"",De.push([de[Qe.str(Ae)],ee.int(Ae),nt,de[je.str(Ae)],ze.int(Ae),rt,(Ab[Ee]||Ab[0]).charCodeAt(0)]))}}else if(Oe!=null&&Oe.fieldNames.includes("conf_type_id")){const it=Oe.getField("conf_type_id"),at=Oe.getField("pdbx_beg_PDB_ins_code"),ht=Oe.getField("pdbx_end_PDB_ins_code"),Qe=Oe.getField("beg_label_asym_id"),je=Oe.getField("end_label_asym_id"),ee=Oe.getField("beg_auth_seq_id"),ze=Oe.getField("end_auth_seq_id");let Ee;for(Ae=0,Ze=Oe.rowCount;Ae<Ze;++Ae){const Re=it.str(Ae);(Ee=$de[Re])&&(nt=(X=at==null?void 0:at.str(Ae))!==null&&X!==void 0?X:"",rt=(ye=ht==null?void 0:ht.str(Ae))!==null&&ye!==void 0?ye:"",Ee==="h"||Ee==="g"||Ee==="i"?De.push([de[Qe.str(Ae)],ee.int(Ae),nt,de[je.str(Ae)],ze.int(Ae),rt,Ee.charCodeAt(0)]):Ee==="e"&&$e.push([de[Qe.str(Ae)],ee.int(Ae),nt,de[je.str(Ae)],ze.int(Ae),rt]))}}const qe=Z.struct_sheet_range;if(qe&&$e.length===0){const it=qe.getField("pdbx_beg_PDB_ins_code"),at=qe.getField("pdbx_end_PDB_ins_code"),ht=qe.getField("beg_label_asym_id"),Qe=qe.getField("end_label_asym_id"),je=qe.getField("beg_auth_seq_id"),ee=qe.getField("end_auth_seq_id");for(Ae=0,Ze=qe.rowCount;Ae<Ze;++Ae)nt=(ke=it==null?void 0:it.str(Ae))!==null&&ke!==void 0?ke:"",rt=(ge=at==null?void 0:at.str(Ae))!==null&&ge!==void 0?ge:"",$e.push([de[ht.str(Ae)],je.int(Ae),nt,de[Qe.str(Ae)],ee.int(Ae),rt])}return!(!Oe&&!qe)&&{helices:De,sheets:$e}}(F.categories,0,V);let Ue,Le;if(function(Z,J,de){const Ie={},te=J.biomolDict;if(Z.pdbx_struct_oper_list){const ge=Z.pdbx_struct_oper_list,De=ge.getField("id"),$e=ge.getField("matrix[1][1]"),Ae=ge.getField("matrix[1][2]"),Ze=ge.getField("matrix[1][3]"),nt=ge.getField("matrix[2][1]"),rt=ge.getField("matrix[2][2]"),Oe=ge.getField("matrix[2][3]"),qe=ge.getField("matrix[3][1]"),it=ge.getField("matrix[3][2]"),at=ge.getField("matrix[3][3]"),ht=ge.getField("vector[1]"),Qe=ge.getField("vector[2]"),je=ge.getField("vector[3]");for(let ee=0;ee<ge.rowCount;ee++){const ze=new Tt,Ee=ze.elements;Ee[0]=$e.float(ee),Ee[1]=Ae.float(ee),Ee[2]=Ze.float(ee),Ee[4]=nt.float(ee),Ee[5]=rt.float(ee),Ee[6]=Oe.float(ee),Ee[8]=qe.float(ee),Ee[9]=it.float(ee),Ee[10]=at.float(ee),Ee[3]=ht.float(ee),Ee[7]=Qe.float(ee),Ee[11]=je.float(ee),ze.transpose(),Ie[De.str(ee)]=ze}}if(Z.pdbx_struct_assembly_gen){const ge=Z.pdbx_struct_assembly_gen,De=function(nt){const rt={};return nt.replace(/[()']/g,"").split(",").forEach(function(Oe){if(Oe.includes("-"))for(var qe=Oe.split("-"),it=parseInt(qe[0]),at=parseInt(qe[1]);it<=at;++it)rt[it]=Ie[it];else rt[Oe]=Ie[Oe]}),rt},$e=ge.getField("assembly_id"),Ae=ge.getField("oper_expression"),Ze=ge.getField("asym_id_list");for(let nt=0;nt<ge.rowCount;nt++){const rt=$e.int(nt);let Oe={},qe=Ae.str(nt).replace(/['"]\(|['"]/g,"");if(qe.includes(")(")||qe.indexOf("(")>0){const[Qe,je]=qe.split("(").filter(Ee=>!!Ee),ee=De(Qe),ze=De(je);Object.keys(ee).forEach(function(Ee){Object.keys(ze).forEach(function(Re){const Xe=new Tt;Xe.multiplyMatrices(ee[Ee],ze[Re]),Oe[Ee+"x"+Re]=Xe})})}else Oe=De(qe);const it=[];for(let Qe in Oe)it.push(Oe[Qe]);let at=""+rt;/^(0|[1-9][0-9]*)$/.test(at)&&(at="BU"+at);const ht=Ze.str(nt).split(",").map(Qe=>de[Qe]);te[at]===void 0&&(te[at]=new Cu(at)),te[at].addPart(it,ht)}}if(Z.struct_ncs_oper){const ge=Z.struct_ncs_oper,De="NCS";te[De]=new Cu(De);const $e=te[De].addPart(),Ae=ge.getField("code"),Ze=ge.getField("matrix[1][1]"),nt=ge.getField("matrix[1][2]"),rt=ge.getField("matrix[1][3]"),Oe=ge.getField("matrix[2][1]"),qe=ge.getField("matrix[2][2]"),it=ge.getField("matrix[2][3]"),at=ge.getField("matrix[3][1]"),ht=ge.getField("matrix[3][2]"),Qe=ge.getField("matrix[3][3]"),je=ge.getField("vector[1]"),ee=ge.getField("vector[2]"),ze=ge.getField("vector[3]");for(let Ee=0;Ee<ge.rowCount;Ee++){if(Ae.str(Ee)==="given")return;const Re=new Tt,Xe=Re.elements;Xe[0]=Ze.float(Ee),Xe[1]=nt.float(Ee),Xe[2]=rt.float(Ee),Xe[4]=Oe.float(Ee),Xe[5]=qe.float(Ee),Xe[6]=it.float(Ee),Xe[8]=at.float(Ee),Xe[9]=ht.float(Ee),Xe[10]=Qe.float(Ee),Xe[3]=je.float(Ee),Xe[7]=ee.float(Ee),Xe[11]=ze.float(Ee),Re.transpose(),$e.matrixList.push(Re)}$e.matrixList.length===0&&delete te[De]}const X={};if(Z.cell){const ge=Z.cell,De=ge.getField("length_a").float(0),$e=ge.getField("length_b").float(0),Ae=ge.getField("length_c").float(0),Ze=new Float32Array(9);Ze[0]=De,Ze[4]=$e,Ze[8]=Ae,J.boxes.push(Ze),X.a=De,X.b=$e,X.c=Ae,X.alpha=ge.getField("angle_alpha").float(0),X.beta=ge.getField("angle_beta").float(0),X.gamma=ge.getField("angle_gamma").float(0)}Z.symmetry&&(X.spacegroup=Z.symmetry.getField("space_group_name_H-M").str(0));const ye=new Tt;if(Z.database_PDB_matrix){const ge=Z.database_PDB_matrix,De=ye.elements,$e=ge.getField("origx[1][1]"),Ae=ge.getField("origx[1][2]"),Ze=ge.getField("origx[1][3]"),nt=ge.getField("origx[2][1]"),rt=ge.getField("origx[2][2]"),Oe=ge.getField("origx[2][3]"),qe=ge.getField("origx[3][1]"),it=ge.getField("origx[3][2]"),at=ge.getField("origx[3][3]"),ht=ge.getField("origx_vector[1]"),Qe=ge.getField("origx_vector[2]"),je=ge.getField("origx_vector[3]");De[0]=$e.float(0),De[1]=Ae.float(0),De[2]=Ze.float(0),De[4]=nt.float(0),De[5]=rt.float(0),De[6]=Oe.float(0),De[8]=qe.float(0),De[9]=it.float(0),De[10]=at.float(0),De[3]=ht.float(0),De[7]=Qe.float(0),De[11]=je.float(0),ye.transpose(),X.origx=ye}const ke=new Tt;if(Z.atom_sites){const ge=Z.atom_sites,De=ke.elements,$e=ge.getField("fract_transf_matrix[1][1]"),Ae=ge.getField("fract_transf_matrix[1][2]"),Ze=ge.getField("fract_transf_matrix[1][3]"),nt=ge.getField("fract_transf_matrix[2][1]"),rt=ge.getField("fract_transf_matrix[2][2]"),Oe=ge.getField("fract_transf_matrix[2][3]"),qe=ge.getField("fract_transf_matrix[3][1]"),it=ge.getField("fract_transf_matrix[3][2]"),at=ge.getField("fract_transf_matrix[3][3]"),ht=ge.getField("fract_transf_vector[1]"),Qe=ge.getField("fract_transf_vector[2]"),je=ge.getField("fract_transf_vector[3]");De[0]=$e.float(0),De[1]=Ae.float(0),De[2]=Ze.float(0),De[4]=nt.float(0),De[5]=rt.float(0),De[6]=Oe.float(0),De[8]=qe.float(0),De[9]=it.float(0),De[10]=at.float(0),De[3]=ht.float(0),De[7]=Qe.float(0),De[11]=je.float(0),ke.transpose(),X.scale=ke}X.a!==void 0?J.unitcell=new Mb(X):J.unitcell=void 0}(F.categories,w,V),function(Z,J,de){const Ie=Z.struct_conn;if(Ie){const ye=J.getAtomProxy(),ke=J.getAtomProxy(),ge={},De=Ie.getField("conn_type_id"),$e=Ie.getField("ptnr1_symmetry"),Ae=Ie.getField("pdbx_ptnr1_PDB_ins_code"),Ze=Ie.getField("pdbx_ptnr1_label_alt_id"),nt=Ie.getField("ptnr1_auth_seq_id"),rt=Ie.getField("ptnr1_label_asym_id"),Oe=Ie.getField("ptnr1_label_atom_id"),qe=Ie.getField("ptnr2_symmetry"),it=Ie.getField("pdbx_ptnr2_PDB_ins_code"),at=Ie.getField("pdbx_ptnr2_label_alt_id"),ht=Ie.getField("ptnr2_auth_seq_id"),Qe=Ie.getField("ptnr2_label_asym_id"),je=Ie.getField("ptnr2_label_atom_id"),ee=Ie.getField("pdbx_value_order");for(let ze=0,Ee=Ie.rowCount;ze<Ee;++ze){const Re=De.str(ze);if(Re==="hydrog"||Re==="mismat"||Re==="saltbr"||$e.str(ze)!=="1_555"||qe.str(ze)!=="1_555")continue;const Xe=Ae.str(ze),gt=Ze.str(ze),_t=nt.str(ze)+(Xe?"^"+Xe:"")+":"+de[rt.str(ze)]+"."+Oe.str(ze)+(gt?"%"+gt:"");let Mt=ge[_t];if(!Mt){const be=new ei(_t);if(be.selection.error){pt&&tt.warn("invalid selection for connection",_t);continue}Mt=J.getAtomIndices(be),ge[_t]=Mt}const K=it.str(ze),ae=at.str(ze),ue=ht.str(ze)+(K?"^"+K:"")+":"+de[Qe.str(ze)]+"."+je.str(ze)+(ae?"%"+ae:"");let _e=ge[ue];if(!_e){const be=new ei(ue);if(be.selection.error){pt&&tt.warn("invalid selection for connection",ue);continue}_e=J.getAtomIndices(be),ge[ue]=_e}var te=Mt.length,X=_e.length;if(te>X&&([te,X]=[X,te],[Mt,_e]=[_e,Mt]),te!==0&&X!==0)for(let be=0;be<X;++be)ye.index=Mt[be%te],ke.index=_e[be],ye&&ke?J.bondStore.addBond(ye,ke,HU(ee.str(ze))):tt.log("atoms for connection not found");else pt&&tt.warn("no atoms found for",_t,ue)}}}(F.categories,w,V),function(Z,J,de){var Ie;if(Z.entity){const te=Z.entity,X=te.getField("id"),ye=te.getField("pdbx_description"),ke=te.getField("type"),ge=te.rowCount;for(let De=0;De<ge;++De){const $e=Array.from((Ie=de[X.int(De)])!==null&&Ie!==void 0?Ie:[]);J.entityList[De]=new wb(J,De,ye==null?void 0:ye.str(De),ke.str(De),$e)}}}(F.categories,w,z),(Ue=(u=F.categories.struct)===null||u===void 0?void 0:u.getField("title"))&&(Le=Ue.str(0))&&(w.title=Le),(Ue=(h=F.categories.entry)===null||h===void 0?void 0:h.getField("id"))&&(Le=Ue.str(0))&&(w.id=Le),F.categories.pdbx_audit_revision_history){if(Ue=(d=F.categories.pdbx_audit_revision_history)===null||d===void 0?void 0:d.getField("revision_date")){for(let Z=0;Z<Ue.rowCount;Z++)if(Le=Ue.str(Z)){w.header.releaseDate=Le;break}}if(Ue=(f=F.categories.pdbx_database_status)===null||f===void 0?void 0:f.getField("recvd_initial_deposition_date")){for(let Z=0;Z<Ue.rowCount;Z++)if(Le=Ue.str(Z)){w.header.depositionDate=Le;break}}}else if(F.categories.database_PDB_rev){if(Ue=(m=F.categories.database_PDB_rev)===null||m===void 0?void 0:m.getField("date")){for(let Z=0;Z<Ue.rowCount;Z++)if(Le=Ue.str(Z)){w.header.releaseDate=Le;break}}if(Ue=(_=F.categories.database_PDB_rev)===null||_===void 0?void 0:_.getField("date_original")){for(let Z=0;Z<Ue.rowCount;Z++)if(Le=Ue.str(Z)){w.header.depositionDate=Le;break}}}(Ue=(g=(v=F.categories.reflns)===null||v===void 0?void 0:v.getField("d_resolution_high"))!==null&&g!==void 0?g:(b=F.categories.refine)===null||b===void 0?void 0:b.getField("ls_d_res_high"))&&Ue.valueKind(0)===0&&(w.header.resolution=Ue.float(0)),(Ue=(p=F.categories.refine)===null||p===void 0?void 0:p.getField("ls_R_factor_R_free"))&&Ue.valueKind(0)===0&&(w.header.rFree=Ue.float(0)),(Ue=(y=F.categories.refine)===null||y===void 0?void 0:y.getField("ls_R_factor_R_work"))&&Ue.valueKind(0)===0&&(w.header.rFree=Ue.float(0)),(Ue=(A=F.categories.exptl)===null||A===void 0?void 0:A.getField("method"))&&(w.header.experimentalMethods=Ue.toStringArray().slice()),M.finalize(),w.finalizeAtoms(),mb(w),w.finalizeBonds(),ve?fV(w,ve):FS(w),gb(w),w.extraData.cif=F}pt&&tt.timeEnd("CifParser._parse "+this.name)})}}Zt.add("bcif",class extends Py{get type(){return"bcif"}get isBinary(){return!0}}),Zt.add("cif",Py),Zt.add("mcif",Py),Zt.add("mmcif",Py);Zt.add("gro",class extends yc{get type(){return"gro"}_parse(){pt&&tt.time("GroParser._parse "+this.name);var i,e,t=this.structure,n=this.structureBuilder,r=this.firstModelOnly,s=this.asTrajectory,o=this.cAlphaOnly,a=t.frames,l=t.boxes,c=this.streamer.peekLines(3);t.title=c[0].trim();var u,h,d,f,m=5+(c[2].length-c[2].lastIndexOf(".")-1),_=20+m,v=20+2*m,g=parseInt(c[1]),b=g+3,p=t.atomMap,y=t.atomStore;y.resize(g);var A=0,w=0,M=0;this.streamer.eachChunkOfLines(function(T){(function(E,C,N){for(var P=E;P<C;++P){var L=++M-1,R=N[P];if(R){if(L%b==0)s&&(i=new Float32Array(3*g),a.push(i),e=0);else if(L%b!=1)if(L%b==b-1){var F=R.trim().split(/\s+/),V=new Float32Array(9);if(V[0]=10*parseFloat(F[0]),V[4]=10*parseFloat(F[1]),V[8]=10*parseFloat(F[2]),l.push(V),r)return!0;w+=1}else{if(u=R.substr(10,5).trim(),o&&u!=="CA")continue;var z=10*parseFloat(R.substr(20,m)),U=10*parseFloat(R.substr(_,m)),G=10*parseFloat(R.substr(v,m));if(s){var B=3*e;if(i[B+0]=z,i[B+1]=U,i[B+2]=G,e+=1,L>b)continue}h=R.substr(5,5).trim(),d=parseInt(R.substr(0,5)),f=parseInt(R.substr(15,5)),y.growIfFull(),y.atomTypeId[A]=p.add(u),y.x[A]=z,y.y[A]=U,y.z[A]=G,y.serial[A]=f,n.addAtom(w,"","",h,d,!1,"l"),A+=1}}}})(0,T.length,T)}),n.finalize(),t.finalizeAtoms(),kS(t),mb(t),t.finalizeBonds(),FS(t),pt&&tt.timeEnd("GroParser._parse "+this.name)}});var jde=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function L1(i,e,t){return e?new i(e.buffer,e.byteOffset,e.byteLength/(t||1)):void 0}function TC(i){return L1(DataView,i)}function PA(i){return L1(Int8Array,i)}function Eb(i){return L1(Int32Array,i,4)}function mg(i,e){var t=i.length/2;e||(e=new Int16Array(t));for(var n=0,r=0;n<t;++n,r+=2)e[n]=i[r]<<8^i[r+1];return e}function ja(i,e){var t=i.length/4;e||(e=new Int32Array(t));for(var n=0,r=0;n<t;++n,r+=4)e[n]=i[r]<<24^i[r+1]<<16^i[r+2]<<8^i[r+3];return e}function Tb(i,e,t){var n=i.length,r=1/e;t||(t=new Float32Array(n));for(var s=0;s<n;++s)t[s]=i[s]*r;return t}function Ry(i,e){var t,n;if(!e){var r=0;for(t=0,n=i.length;t<n;t+=2)r+=i[t+1];e=new i.constructor(r)}var s=0;for(t=0,n=i.length;t<n;t+=2)for(var o=i[t],a=i[t+1],l=0;l<a;++l)e[s]=o,++s;return e}function jV(i,e){var t=i.length;e||(e=new i.constructor(t)),t&&(e[0]=i[0]);for(var n=1;n<t;++n)e[n]=i[n]+e[n-1];return e}function Cb(i,e){var t,n,r=i instanceof Int8Array?127:32767,s=-r-1,o=i.length;if(!e){var a=0;for(t=0;t<o;++t)i[t]<r&&i[t]>s&&++a;e=new Int32Array(a)}for(t=0,n=0;t<o;){for(var l=0;i[t]===r||i[t]===s;)l+=i[t],++t;l+=i[t],++t,e[n]=l,++n}return e}function $U(i,e,t){return Tb(Cb(i,Eb(t)),e,t)}function Xde(i,e,t){var n=Cb(i,Eb(t));return function(r,s,o){return Tb(jV(r,Eb(o)),s,o)}(n,e,L1(Float32Array,n,4))}function XV(i){var e=0,t=new DataView(i.buffer);function n(l){for(var c={},u=0;u<l;u++)c[a()]=a();return c}function r(l){var c=i.subarray(e,e+l);return e+=l,c}function s(l){var c=i.subarray(e,e+l);e+=l;var u=65535;if(l>u){for(var h=[],d=0;d<c.length;d+=u)h.push(String.fromCharCode.apply(null,c.subarray(d,d+u)));return h.join("")}return String.fromCharCode.apply(null,c)}function o(l){for(var c=new Array(l),u=0;u<l;u++)c[u]=a();return c}function a(){var l,c,u=i[e];if(!(128&u))return e++,u;if((240&u)==128)return e++,n(c=15&u);if((240&u)==144)return e++,o(c=15&u);if((224&u)==160)return e++,s(c=31&u);if(!(224&~u))return l=t.getInt8(e),e++,l;switch(u){case 192:return e++,null;case 194:return e++,!1;case 195:return e++,!0;case 196:return c=t.getUint8(e+1),e+=2,r(c);case 197:return c=t.getUint16(e+1),e+=3,r(c);case 198:return c=t.getUint32(e+1),e+=5,r(c);case 202:return l=t.getFloat32(e+1),e+=5,l;case 203:return l=t.getFloat64(e+1),e+=9,l;case 204:return l=i[e+1],e+=2,l;case 205:return l=t.getUint16(e+1),e+=3,l;case 206:return l=t.getUint32(e+1),e+=5,l;case 208:return l=t.getInt8(e+1),e+=2,l;case 209:return l=t.getInt16(e+1),e+=3,l;case 210:return l=t.getInt32(e+1),e+=5,l;case 217:return c=t.getUint8(e+1),e+=2,s(c);case 218:return c=t.getUint16(e+1),e+=3,s(c);case 219:return c=t.getUint32(e+1),e+=5,s(c);case 220:return c=t.getUint16(e+1),e+=3,o(c);case 221:return c=t.getUint32(e+1),e+=5,o(c);case 222:return c=t.getUint16(e+1),e+=3,n(c);case 223:return c=t.getUint32(e+1),e+=5,n(c)}throw new Error("Unknown type 0x"+u.toString(16))}return a()}function qde(i,e,t,n){switch(i){case 1:return function(a,l){var c=a.length;l||(l=new Float32Array(c/4));for(var u=TC(l),h=TC(a),d=0,f=0,m=c/4;d<m;++d,f+=4)u.setFloat32(f,h.getFloat32(f),!0);return l}(e);case 2:return PA(e);case 3:return mg(e);case 4:return ja(e);case 5:return L1(Uint8Array,e);case 6:return Ry(ja(e),new Uint8Array(t));case 7:return Ry(ja(e));case 8:return function(a,l){return jV(Ry(a),l)}(ja(e));case 9:return r=ja(e),s=ja(n)[0],Tb(Ry(r,Eb(o)),s,o);case 10:return Xde(mg(e),ja(n)[0]);case 11:return Tb(mg(e),ja(n)[0]);case 12:return $U(mg(e),ja(n)[0]);case 13:return $U(PA(e),ja(n)[0]);case 14:return Cb(mg(e));case 15:return Cb(PA(e))}var r,s,o}function Yde(i,e){var t=(e=e||{}).ignoreFields,n={};return jde.forEach(function(r){var s,o,a,l,c,u=!!t&&t.indexOf(r)!==-1,h=i[r];u||h===void 0||(h instanceof Uint8Array?n[r]=qde.apply(null,(o=TC(s=h),a=o.getInt32(0),l=o.getInt32(4),c=s.subarray(8,12),[a,s=s.subarray(12),l,c])):n[r]=h)}),n}const Kde={0:105,1:115,2:104,3:101,4:103,5:98,6:116,7:108,"-1":NaN};Zt.add("mmtf",class extends yc{get type(){return"mmtf"}get isBinary(){return!0}_parse(){let i,e,t,n,r;pt&&tt.time("MmtfParser._parse "+this.name);const s=this.structure,o=Yde(XV(this.streamer.data));let a,l,c,u,h,d;if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach(function(U){o[U]!==void 0&&(s.header[U]=o[U])}),s.id=o.structureId,s.title=o.title,s.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(h=1,u=o.chainsPerModel[0],c=0,i=0,e=u;i<e;++i)c+=o.groupsPerChain[i];for(l=0,i=0,e=c;i<e;++i)r=o.groupList[o.groupTypeList[i]],l+=r.atomNameList.length;a=o.numBonds,d=[u]}else a=o.numBonds,l=o.numAtoms,c=o.numGroups,u=o.numChains,h=o.numModels,d=o.chainsPerModel;if(a+=c,this.asTrajectory)for(i=0,e=o.numModels;i<e;++i){const U=new Float32Array(3*l),G=l*i;for(t=0;t<l;++t){const B=3*t,D=t+G;U[B]=o.xCoordList[D],U[B+1]=o.yCoordList[D],U[B+2]=o.zCoordList[D]}s.frames.push(U)}const f=new Uint32Array(a),m=new Uint32Array(a),_=new Uint8Array(a),v=new Uint32Array(l),g=new Int8Array(l),b=new Uint32Array(c),p=new Uint32Array(c),y=new Uint32Array(c),A=new Uint16Array(u),w=new Uint32Array(u),M=new Uint32Array(u),T=new Uint32Array(h),E=new Uint32Array(h);let C=0;for(i=0,e=h;i<e;++i){const U=d[i];for(T[i]=C,E[i]=U,t=0;t<U;++t)A[t+C]=i;C+=U}const N=o.groupsPerChain;let P=0;for(i=0,e=u;i<e;++i){const U=N[i];for(w[i]=P,M[i]=U,t=0;t<U;++t)b[t+P]=i;P+=U}let L=0,R=0;for(i=0,e=c;i<e;++i){r=o.groupList[o.groupTypeList[i]];const U=r.atomNameList.length,G=r.formalChargeList,B=r.bondAtomList,D=r.bondOrderList;for(t=0,n=D.length;t<n;++t)f[R]=L+B[2*t],m[R]=L+B[2*t+1],_[R]=D[t],R+=1;for(p[i]=L,y[i]=U,t=0;t<U;++t)v[L]=i,g[L]=G[t],L+=1}const F=o.bondAtomList;if(F)for(o.bondOrderList&&_.set(o.bondOrderList,R),i=0,e=F.length;i<e;i+=2){const U=F[i],G=F[i+1];U<l&&G<l&&(f[R]=U,m[R]=G,R+=1)}s.bondStore.length=_.length,s.bondStore.count=R,s.bondStore.atomIndex1=f,s.bondStore.atomIndex2=m,s.bondStore.bondOrder=_,s.atomStore.length=l,s.atomStore.count=l,s.atomStore.residueIndex=v,s.atomStore.atomTypeId=new Uint16Array(l),s.atomStore.x=o.xCoordList.subarray(0,l),s.atomStore.y=o.yCoordList.subarray(0,l),s.atomStore.z=o.zCoordList.subarray(0,l),s.atomStore.serial=o.atomIdList.subarray(0,l),s.atomStore.bfactor=o.bFactorList.subarray(0,l),s.atomStore.altloc=o.altLocList.subarray(0,l),s.atomStore.occupancy=o.occupancyList.subarray(0,l),s.atomStore.formalCharge=g,s.residueStore.length=c,s.residueStore.count=c,s.residueStore.chainIndex=b,s.residueStore.residueTypeId=o.groupTypeList,s.residueStore.atomOffset=p,s.residueStore.atomCount=y,s.residueStore.resno=o.groupIdList.subarray(0,c),s.residueStore.sstruc=o.secStructList.subarray(0,c),s.residueStore.inscode=o.insCodeList.subarray(0,c),s.chainStore.length=u,s.chainStore.count=u,s.chainStore.entityIndex=new Uint16Array(u),s.chainStore.modelIndex=A,s.chainStore.residueOffset=w,s.chainStore.residueCount=M,s.chainStore.chainname=o.chainNameList.subarray(0,4*u),s.chainStore.chainid=o.chainIdList.subarray(0,4*u),s.modelStore.length=h,s.modelStore.count=h,s.modelStore.chainOffset=T,s.modelStore.chainCount=E;let V={};for(i=0,e=o.groupList.length;i<e;++i){const U=o.groupList[i],G=[];for(t=0,n=U.atomNameList.length;t<n;++t){const ie=U.elementList[t].toUpperCase(),ne=U.atomNameList[t];G.push(s.atomMap.add(ne,ie))}const B=U.chemCompType.toUpperCase(),D=gle.includes(B),O=U.bondOrderList.length,j=new Array(O),q=new Array(O);for(t=0;t<O;++t)j[t]=U.bondAtomList[2*t],q[t]=U.bondAtomList[2*t+1];const Y={atomIndices1:j,atomIndices2:q,bondOrders:U.bondOrderList};V[i]=s.residueMap.add(U.groupName,G,D,B,Y)}for(i=0,e=c;i<e;++i)s.residueStore.residueTypeId[i]=V[s.residueStore.residueTypeId[i]];for(i=0,e=s.atomStore.count;i<e;++i){const U=s.atomStore.residueIndex[i],G=s.residueMap.list[s.residueStore.residueTypeId[U]],B=s.residueStore.atomOffset[U];s.atomStore.atomTypeId[i]=G.atomTypeIdList[i-B]}if(o.secStructList){const U=o.secStructList.length;for(i=0,e=s.residueStore.count;i<e;++i){const G=Kde[s.residueStore.sstruc[i%U]];G!==void 0&&(s.residueStore.sstruc[i]=G)}}if(o.entityList&&o.entityList.forEach(function(U,G){s.entityList[G]=new wb(s,G,U.description,U.type,U.chainIndexList)}),o.bioAssemblyList&&o.bioAssemblyList.forEach(function(U,G){const B=G+1,D=new Cu(""+B);s.biomolDict["BU"+B]=D;let O={};U.transformList.forEach(function(j){const q=new Tt().fromArray(j.matrix).transpose(),Y=j.chainIndexList.map(function(ne){let Q="";for(let le=0;le<4;++le){const se=o.chainNameList[4*ne+le];if(!se)break;Q+=String.fromCharCode(se)}return Q}),ie=O[Y.toString()];ie?ie.matrixList.push(q):O[Y.toString()]=D.addPart([q],Y)})}),o.ncsOperatorList){const U="NCS",G=new Cu(U),B=G.addPart();o.ncsOperatorList.forEach(function(D){const O=new Tt().fromArray(D).transpose();B.matrixList.push(O)}),B.matrixList.length>0&&(s.biomolDict[U]=G)}const z=o.unitCell;z&&Array.isArray(z)&&z[0]?s.unitcell=new Mb({a:z[0],b:z[1],c:z[2],alpha:z[3],beta:z[4],gamma:z[5],spacegroup:o.spaceGroup}):s.unitcell=void 0,hm(s,!0),um(s,!0),s.finalizeAtoms(),s.finalizeBonds(),gb(s),pt&&tt.timeEnd("MmtfParser._parse "+this.name)}});const RA=/\s+/,Zde={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};Zt.add("mol2",class extends yc{get type(){return"mol2"}_parse(){pt&&tt.time("Mol2Parser._parse "+this.name);const i=this.structure,e=this.structureBuilder,t=this.firstModelOnly,n=this.asTrajectory,r=i.frames;let s,o,a=!1;const l=i.atomMap,c=i.atomStore;c.resize(Math.round(this.streamer.data.length/60)),c.addField("partialCharge",1,"float32");let u=0,h=0,d=0,f=-1,m=0,_=0;const v=i.getAtomProxy(),g=i.getAtomProxy();this.streamer.eachChunkOfLines(function(b){(function(p,y,A){for(let w=p;w<y;++w){const M=A[w].trim();if(M!==""&&M[0]!=="#"){if(M[0]==="@")M==="@<TRIPOS>MOLECULE"?(_=1,h=0,++f):M==="@<TRIPOS>ATOM"?(_=2,d=c.count,n&&(o=0,s=new Float32Array(3*m),r.push(s),f>0&&(a=!0))):_=M==="@<TRIPOS>BOND"?3:0;else if(_===1){if(h===0)i.title=M,i.id=M;else if(h===1){const T=M.split(RA);m=parseInt(T[0])}++h}else if(_===2){const T=M.split(RA);if(t&&f>0)continue;const E=parseFloat(T[2]),C=parseFloat(T[3]),N=parseFloat(T[4]);if(n){const U=3*o;if(s[U+0]=E,s[U+1]=C,s[U+2]=N,o+=1,a)continue}const P=T[0],L=T[1],R=T[5].split(".")[0],F=T[6]?parseInt(T[6]):1,V=T[7]?T[7]:"",z=T[8]?parseFloat(T[8]):0;c.growIfFull(),c.atomTypeId[u]=l.add(L,R),c.x[u]=E,c.y[u]=C,c.z[u]=N,c.serial[u]=+P,c.partialCharge[u]=z,e.addAtom(f,"","",V,F,!0),u+=1}else if(_===3){if(t&&f>0||n&&f>0)continue;const T=M.split(RA);v.index=parseInt(T[1])-1+d,g.index=parseInt(T[2])-1+d;const E=Zde[T[3]];i.bondStore.addBond(v,g,E)}}}})(0,b.length,b)}),e.finalize(),i.finalizeAtoms(),kS(i),um(i,!0),hm(i,!0),i.finalizeBonds(),dd(i),FS(i),pt&&tt.timeEnd("Mol2Parser._parse "+this.name)}});Zt.add("pdbqt",class extends a0{get type(){return"pdbqt"}});Zt.add("pqr",class extends a0{get type(){return"pqr"}});const Qde=/> +<(.+)>/;class IA extends yc{get type(){return"sdf"}_parse(){pt&&tt.time("SdfParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=this.firstModelOnly,r=this.asTrajectory,s=this.streamer.peekLines(2);e.id=s[0].trim(),e.title=s[1].trim();const o=e.frames;let a,l,c=!1;const u=e.atomMap,h=e.atomStore;h.resize(Math.round(this.streamer.data.length/50)),h.addField("formalCharge",1,"int8");const d=e.getAtomProxy(),f=e.getAtomProxy();let m=0,_=0,v=0,g=0;const b=[];let p,y,A,w,M,T,E,C,N,P,L,R,F,V,z=!1,U={};e.extraData.sdf=b;let G=!1,B=!1,D=!1,O=[],j=[];const q=new Map;this.streamer.eachChunkOfLines(function(Y){(function(ie,ne,Q){for(let le=ie;le<ne;++le){const se=Q[le];if(G&&se&&(O=se.substring(7).split(" "),j.length&&(O=[...j,...O],j=[]),O[O.length-1]==="-"))O.pop(),j=O;else{if(se.substr(0,4)==="$$$$")_=-1,++v,g=h.count,b.push(U),U={},z=!1,G=!1;else if(_===3)G=se.indexOf(" V3000")>-1,G?q.clear():(y=parseInt(se.substr(0,3)),A=parseInt(se.substr(3,3)),w=4,M=w+y,T=M,E=T+A,r&&(l=0,a=new Float32Array(3*y),o.push(a),v>0&&(c=!0)));else if(G&&O[0]==="COUNTS")y=parseInt(O[1]),r&&(l=0,a=new Float32Array(3*y),o.push(a),v>0&&(c=!0));else if(G&&O.length==2)O[1]==="ATOM"?O[0]==="BEGIN"?B=!0:O[0]==="END"&&(B=!1):O[1]==="BOND"&&(O[0]==="BEGIN"?D=!0:O[0]==="END"&&(D=!1));else if(B||!G&&_>=w&&_<M){if(n&&v>0)continue;let oe=0;if(G){if(C=parseFloat(O[2]),N=parseFloat(O[3]),P=parseFloat(O[4]),R=O[1],F=parseInt(O[0]),q.set(F,m),L=R+F,O.length>6){let $=O.slice(6).find(pe=>pe.indexOf("CHG=")===0);$&&(oe=parseInt($.substring(4)))}}else C=parseFloat(se.substr(0,10)),N=parseFloat(se.substr(10,10)),P=parseFloat(se.substr(20,10)),R=se.substr(31,3).trim(),L=R+(m-g+1);if(r){const $=3*l;if(a[$+0]=C,a[$+1]=N,a[$+2]=P,l+=1,c)continue}h.growIfFull(),h.atomTypeId[m]=u.add(L,R),h.x[m]=C,h.y[m]=N,h.z[m]=P,h.serial[m]=G?F:m,h.formalCharge[m]=oe,t.addAtom(v,"","","HET",1,!0),m+=1}else if(D||!G&&_>=T&&_<E){if(n&&v>0||r&&v>0)continue;G?(d.index=q.get(parseInt(O[2])),f.index=q.get(parseInt(O[3])),V=parseInt(O[1])):(d.index=parseInt(se.substr(0,3))-1+g,f.index=parseInt(se.substr(3,3))-1+g,V=parseInt(se.substr(6,3))),e.bondStore.addBond(d,f,V)}else if(se.substr(0,6)==="M  CHG"){const oe=parseInt(se.substr(6,3));for(let $=0,pe=10;$<oe;++$,pe+=8){const xe=parseInt(se.substr(pe,3))-1+g,Pe=parseInt(se.substr(pe+4,3));h.formalCharge[xe]=Pe}}else se.charAt(0)===">"&&(p=se.match(Qde))?(z=p[1],U[z]=[]):z!==!1&&se&&U[z].push(se);++_}}})(0,Y.length,Y)}),t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),dd(e),pt&&tt.timeEnd("SdfParser._parse "+this.name)}_postProcess(){dd(this.structure)}}Zt.add("sdf",IA),Zt.add("sd",IA),Zt.add("mol",IA);function gg(i,e,t){return parseInt(i.substr(e,t).trim())}class WU extends yc{get type(){return"prmtop"}_parse(){pt&&tt.time("PrmtopParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,r=e.atomStore;r.addField("partialCharge",1,"float32"),r.addField("radius",1,"float32");const s=[],o={},a=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];let l,c,u,h,d;a.forEach(M=>{o[M]=0});let f,m,_,v,g,b=new Uint8Array(0);this.streamer.eachChunkOfLines(function(M){(function(T,E,C){for(let N=T;N<E;++N){const P=C[N],L=P.trim();if(L&&!P.startsWith("%FORMAT")){if(P.startsWith("%FLAG")){const R=P.substr(5).trim();v=0,R==="TITLE"?_=0:R==="POINTERS"?_=1:R==="ATOM_NAME"?_=2:R==="CHARGE"?_=3:R==="MASS"?_=4:R==="RESIDUE_LABEL"?_=5:R==="RESIDUE_POINTER"?_=6:R==="BONDS_INC_HYDROGEN"?(g=0,_=7):R==="BONDS_WITHOUT_HYDROGEN"?(g=o.NBONH,_=8):_=R==="RADII"?9:void 0}else if(_===0)s.push(L);else if(_===1){const R=Math.min(v+10,32);for(let V=0;v<R;++V,++v)o[a[v]]=parseInt(P.substr(8*V,8).trim());l=new Array(o.NATOM),c=new Float32Array(o.NATOM),u=new Float32Array(o.NATOM),r.resize(o.NATOM);const F=o.NBONH+o.MBONA;h=new Uint32Array(F),d=new Uint32Array(F),b=new Uint8Array(F),f=new Array(o.NRES),m=new Uint32Array(o.NRES)}else if(_===2){const R=Math.min(v+20,o.NATOM);for(let F=0;v<R;++F,++v)l[v]=P.substr(4*F,4).trim()}else if(_===3){const R=Math.min(v+5,o.NATOM);for(let F=0;v<R;++F,++v)c[v]=parseFloat(P.substr(16*F,16))/18.2223}else if(_!==4){if(_===5){const R=Math.min(v+20,o.NRES);for(let F=0;v<R;++F,++v)f[v]=P.substr(4*F,4).trim()}else if(_===6){const R=Math.min(v+10,o.NRES);for(let F=0;v<R;++F,++v)m[v]=gg(P,8*F,8)}else if(_===7){const R=Math.min(v+10,3*o.NBONH);for(let F=0;v<R;++F,++v){const V=v%3;V===0&&(h[g]=gg(P,8*F,8)/3),V===1&&(d[g]=gg(P,8*F,8)/3,b[g]=1,++g)}}else if(_===8){const R=Math.min(v+10,3*o.MBONA);for(let F=0;v<R;++F,++v){const V=v%3;V===0&&(h[g]=gg(P,8*F,8)/3),V===1&&(d[g]=gg(P,8*F,8)/3,b[g]=1,++g)}}else if(_===9){const R=Math.min(v+5,o.NATOM);for(let F=0;v<R;++F,++v)u[v]=parseFloat(P.substr(16*F,16))}}}}})(0,M.length,M)}),e.title=s.join(" ");const p=o.NATOM;let y=0,A=f[0],w=1;for(let M=0;M<p;++M)M+1===m[y+1]&&(++y,A=f[y],w=y+1),r.atomTypeId[M]=n.add(l[M]),r.serial[M]=M+1,t.addAtom(0,"","",A,w,!1);r.partialCharge.set(c),r.radius.set(u),e.bondStore.length=b.length,e.bondStore.count=b.length,e.bondStore.atomIndex1=h,e.bondStore.atomIndex2=d,e.bondStore.bondOrder=b,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),um(e,!0),hm(e,!0,!0),kS(e,!0),dd(e),pt&&tt.timeEnd("PrmtopParser._parse "+this.name)}}Zt.add("prmtop",WU),Zt.add("parm7",WU);const Iy=/\s+/,Jde=/(^\*|REMARK)*/;Zt.add("psf",class extends yc{get type(){return"psf"}_parse(){pt&&tt.time("PsfParser._parse "+this.name);const i=this.structure,e=this.structureBuilder,t=i.atomMap,n=i.atomStore;n.addField("partialCharge",1,"float32");const r=[];let s,o,a,l,c,u,h=0,d=0,f=0;this.streamer.eachChunkOfLines(function(m){(function(_,v,g){for(let b=_;b<v;++b){const p=g[b].trim();if(p){if(s===2){const y=p.split(Iy),A=parseInt(y[0]),w=y[1],M=parseInt(y[2]),T=y[3],E=y[4],C=parseFloat(y[6]);w!==a&&(o=i1(d),++d),n.growIfFull(),n.atomTypeId[h]=t.add(E),n.serial[h]=A,n.partialCharge[h]=C,e.addAtom(0,o,o,T,M,!1),h+=1,a=w}else if(s===3){const y=p.split(Iy);for(let A=0,w=y.length;A<w;A+=2)l[f]=parseInt(y[A])-1,c[f]=parseInt(y[A+1])-1,u[f]=1,f+=1}else if(s===1)r.push(p.replace(Jde,"").trim());else if(s!==4){if(s!==5){if(s!==6)if(p.includes("!NATOM")){s=2;const y=parseInt(p.split(Iy)[0]);n.resize(y)}else if(p.includes("!NBOND")){s=3;const y=parseInt(p.split(Iy)[0]);l=new Uint32Array(y),c=new Uint32Array(y),u=new Uint8Array(y)}else p.includes("!NTITLE")?s=1:p.includes("!NTHETA")?s=4:p.includes("!NPHI")?s=5:p.includes("!NIMPHI")&&(s=6)}}}else s=void 0}})(0,m.length,m)}),i.title=r.join(" "),i.bondStore.length=u.length,i.bondStore.count=f,i.bondStore.atomIndex1=l,i.bondStore.atomIndex2=c,i.bondStore.bondOrder=u,e.finalize(),i.finalizeAtoms(),i.finalizeBonds(),um(i,!0),hm(i,!0,!0),dd(i),pt&&tt.timeEnd("PsfParser._parse "+this.name)}});const efe=/\[ (.+) \]/,Ly=/\s+/;Zt.add("top",class extends yc{get type(){return"top"}_parse(){pt&&tt.time("TopParser._parse "+this.name);const i=this.structure,e=this.structureBuilder,t=i.atomMap,n=i.bondStore,r=i.atomStore;r.addField("partialCharge",1,"float32");const s=[],o={};let a,l;this.streamer.eachChunkOfLines(function(b){(function(p,y,A){for(let w=p;w<y;++w){const M=A[w];let T=M.trim();if(!T||T[0]==="*"||T[0]===";")continue;if(T.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");const E=M.match(efe);if(E!==null){const N=E[1];N==="moleculetype"?(l=2,a={atoms:[],bonds:[]}):l=N==="atoms"?3:N==="bonds"?4:N==="system"?0:N==="molecules"?1:void 0;continue}const C=T.indexOf(";");if(C!==-1&&(T=T.substring(0,C).trim()),l===2){const N=T.split(Ly)[0];o[N]=a}else if(l===3){const N=T.split(Ly);a.atoms.push([parseInt(N[2]),N[3],N[4],parseFloat(N[6])])}else if(l===4){const N=T.split(Ly);a.bonds.push([parseInt(N[0]),parseInt(N[1])])}else if(l===0)i.title=T;else if(l===1){const N=T.split(Ly);s.push([N[0],parseInt(N[1])])}}})(0,b.length,b)});let c=0,u=0;s.forEach(function(b){const[p,y]=b,A=o[p];c+=y*A.atoms.length,u+=y*A.bonds.length}),r.resize(c),n.resize(u);let h,d=0,f=0,m=0,_=0,v=0,g=0;s.forEach(function(b){const[p,y]=b,A=o[p],w=i1(_);for(let M=0;M<y;++M){h=-1;const T=fb.includes(p)?w:i1(m);A.atoms.forEach(function(E){const[C,N,P,L]=E;C!==h&&++f,r.atomTypeId[d]=t.add(P),r.serial[d]=d+1,r.partialCharge[d]=L,e.addAtom(0,w,T,N,f+1,!1),++d,h=C}),A.bonds.forEach(function(E){n.atomIndex1[v]=g+E[0]-1,n.atomIndex2[v]=g+E[1]-1,++v}),++m,g+=A.atoms.length}++_}),n.count=u,e.finalize(),i.finalizeAtoms(),i.finalizeBonds(),um(i,!0),hm(i,!0,!0),dd(i),pt&&tt.timeEnd("TopParser._parse "+this.name)}});class GS extends Ua{constructor(e,t){super(e,t),this.frames=new yV(this.name,this.path)}get type(){return"trajectory"}get __objName(){return"frames"}}function vo(i,e){if(i)throw new TypeError("Not a valid NetCDF v3.x file: "+e)}function qV(i){i.offset%4!=0&&i.skip(4-i.offset%4)}function CC(i){const e=i.readUint32(),t=i.readChars(e);return qV(i),t}Zt.add("dcd",class extends GS{get type(){return"dcd"}get isBinary(){return!0}_parse(){pt&&tt.time("DcdParser._parse "+this.name);const i=am(this.streamer.data),e=new DataView(i),t=this.frames,n=t.coordinates,r=t.boxes,s={};let o=0;const a=new Int32Array(i,0,23),l=a[0]!==e.getInt32(0);if(a[0]!==84){const v=i.byteLength;for(let g=0;g<v;g+=4)e.setFloat32(g,e.getFloat32(g),!0)}a[0]!==84&&tt.error("dcd bad format, header block start"),String.fromCharCode(e.getUint8(4),e.getUint8(5),e.getUint8(6),e.getUint8(7))!=="CORD"&&tt.error("dcd bad format, format string");let c=!1,u=!1,h=!1;a[22]!==0&&(c=!0,a[12]!==0&&(u=!0),a[13]===1&&(h=!0)),s.NSET=a[2],s.ISTART=a[3],s.NSAVC=a[4],s.NAMNF=a[10],s.DELTA=c?e.getFloat32(44,l):e.getFloat64(44,l),a[22]!==84&&tt.error("dcd bad format, header block end"),o=o+84+8;const d=e.getInt32(o,l),f=o+1;if((d-4)%80!=0&&tt.error("dcd bad format, title block start"),s.TITLE=K0(new Uint8Array(i,f,d)),e.getInt32(f+d+4-1,l)!==d&&tt.error("dcd bad format, title block end"),o=o+d+8,e.getInt32(o,l)!==4&&tt.error("dcd bad format, natom block start"),s.NATOM=e.getInt32(o+4,l),e.getInt32(o+8,l)!==4&&tt.error("dcd bad format, natom block end"),o=o+4+8,s.NAMNF>0)return void tt.error("dcd format with fixed atoms unsupported, aborting");const m=s.NATOM,_=4*m;for(let v=0,g=s.NSET;v<g;++v){if(u){o+=4;const p=new Float32Array(9);p[0]=e.getFloat64(o,l),p[4]=e.getFloat64(o+16,l),p[8]=e.getFloat64(o+40,l),r.push(p),o+=48,o+=4}const b=new Float32Array(3*m);for(let p=0;p<3;++p){e.getInt32(o,l)!==_&&tt.error("dcd bad format, coord block start",v,p),o+=4;const y=new Float32Array(i,o,m);for(let A=0;A<m;++A)b[3*A+p]=y[A];o+=_,e.getInt32(o,l)!==_&&tt.error("dcd bad format, coord block end",v,p),o+=4}n.push(b),h&&(o+=4+e.getInt32(o,l)+4)}s.DELTA&&(t.deltaTime=20.45482949774598*s.DELTA),s.ISTART>=1&&(t.timeOffset=(s.ISTART-1)*t.deltaTime),pt&&tt.timeEnd("DcdParser._parse "+this.name)}});const mi={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function YV(i){switch(Number(i)){case mi.BYTE:return"byte";case mi.CHAR:return"char";case mi.SHORT:return"short";case mi.INT:return"int";case mi.FLOAT:return"float";case mi.DOUBLE:return"double";default:return"undefined"}}function jU(i){switch(Number(i)){case mi.BYTE:case mi.CHAR:return 1;case mi.SHORT:return 2;case mi.INT:case mi.FLOAT:return 4;case mi.DOUBLE:return 8;default:return-1}}function XU(i){switch(String(i)){case"byte":return mi.BYTE;case"char":return mi.CHAR;case"short":return mi.SHORT;case"int":return mi.INT;case"float":return mi.FLOAT;case"double":return mi.DOUBLE;default:return-1}}function Dy(i,e){if(i!==1){const t=new Array(i);for(let n=0;n<i;n++)t[n]=e();return t}return e()}function PC(i,e,t){switch(e){case mi.BYTE:return i.readBytes(t);case mi.CHAR:return function(n){return n.charCodeAt(n.length-1)===0?n.substring(0,n.length-1):n}(i.readChars(t));case mi.SHORT:return Dy(t,i.readInt16.bind(i));case mi.INT:return Dy(t,i.readInt32.bind(i));case mi.FLOAT:return Dy(t,i.readFloat32.bind(i));case mi.DOUBLE:return Dy(t,i.readFloat64.bind(i));default:return void vo(!0,"non valid type "+e)}}const lp=0,tfe=10,nfe=11,ife=12;function rfe(i,e){const t={recordDimension:{length:i.readUint32()}};t.version=e;const n=function(s){let o,a,l;const c=s.readUint32();if(c===lp)return vo(s.readUint32()!==lp,"wrong empty tag for list of dimensions"),[];{vo(c!==tfe,"wrong tag for list of dimensions");const u=s.readUint32();o=new Array(u);for(let h=0;h<u;h++){const d=CC(s),f=s.readUint32();f===0&&(a=h,l=d),o[h]={name:d,size:f}}return{dimensions:o,recordId:a,recordName:l}}}(i);t.recordDimension.id=n.recordId,t.recordDimension.name=n.recordName,t.dimensions=n.dimensions,t.globalAttributes=qU(i);const r=function(s,o,a){const l=s.readUint32();let c,u=0;if(l===lp)return vo(s.readUint32()!==lp,"wrong empty tag for list of variables"),[];{vo(l!==nfe,"wrong tag for list of variables");const h=s.readUint32();c=new Array(h);for(let d=0;d<h;d++){const f=CC(s),m=s.readUint32(),_=new Array(m);for(let y=0;y<m;y++)_[y]=s.readUint32();const v=qU(s),g=s.readUint32();vo(g<1&&g>6,"non valid type "+g);const b=s.readUint32();let p=s.readUint32();a===2&&(vo(p>0,"offsets larger than 4GB not supported"),p=s.readUint32()),_[0]===o&&(u+=b),c[d]={name:f,dimensions:_,attributes:v,type:YV(g),size:b,offset:p,record:_[0]===o}}}return{variables:c,recordStep:u}}(i,n.recordId,e);return t.variables=r.variables,t.recordDimension.recordStep=r.recordStep,t}function qU(i){let e;const t=i.readUint32();if(t===lp)return vo(i.readUint32()!==lp,"wrong empty tag for list of attributes"),[];{vo(t!==ife,"wrong tag for list of attributes");const n=i.readUint32();e=new Array(n);for(let r=0;r<n;r++){const s=CC(i),o=i.readUint32();vo(o<1||o>6,"non valid type "+o);const a=i.readUint32(),l=PC(i,o,a);qV(i),e[r]={name:s,type:YV(o),value:l}}}return e}class KV{constructor(e){const t=new Gae(e);t.setBigEndian(),vo(t.readChars(3)!=="CDF","should start with CDF");const n=t.readByte();vo(n>2,"unknown version"),this.header=rfe(t,n),this.buffer=t}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return this.header.variables.findIndex(function(t){return t.name===e})!==-1}getDataVariable(e){let t;return t=typeof e=="string"?this.header.variables.find(function(n){return n.name===e}):e,vo(t===void 0,"variable not found"),this.buffer.seek(t.offset),t.record?function(n,r,s){const o=XU(r.type),a=r.size?r.size/jU(o):1,l=s.length,c=new Array(l),u=s.recordStep;for(let h=0;h<l;h++){const d=n.offset;c[h]=PC(n,o,a),n.seek(d+u)}return c}(this.buffer,t,this.header.recordDimension):function(n,r){const s=XU(r.type),o=r.size/jU(s),a=new Array(o);for(let l=0;l<o;l++)a[l]=PC(n,s,1);return a}(this.buffer,t)}}class LA extends GS{get type(){return"nctraj"}get isBinary(){return!0}_parse(){pt&&tt.time("NctrajParser._parse "+this.name);const e=new KV(this.streamer.data),t=this.frames,n=t.coordinates,r=t.boxes,s=t.times;e.getDataVariable("coordinates").forEach(function(o){n.push(new Float32Array(o))}),e.hasDataVariable("cell_lengths")&&e.getDataVariable("cell_lengths").forEach(function(o){r.push(new Float32Array(o))}),e.hasDataVariable("time")&&e.getDataVariable("time").forEach(function(o){s.push(o)}),s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),pt&&tt.timeEnd("NctrajParser._parse "+this.name)}}Zt.add("nctraj",LA),Zt.add("ncdf",LA),Zt.add("nc",LA);Zt.add("trr",class extends GS{get type(){return"trr"}get isBinary(){return!0}_parse(){pt&&tt.time("TrrParser._parse "+this.name);const i=am(this.streamer.data),e=new DataView(i),t=this.frames,n=t.coordinates,r=t.boxes,s=t.times;let o=0;for(;;){o+=8;const a=e.getInt32(o);o+=4,o+=a;const l=e.getInt32(o+8),c=e.getInt32(o+12),u=e.getInt32(o+16),h=e.getInt32(o+28),d=e.getInt32(o+32),f=e.getInt32(o+36),m=e.getInt32(o+40);o+=52;const _=l/9,v=3*m;if(_===8?s.push(e.getFloat64(o)):s.push(e.getFloat32(o)),o+=2*_,l){const g=new Float32Array(9);if(_===8)for(let b=0;b<9;++b)g[b]=10*e.getFloat64(o),o+=8;else for(let b=0;b<9;++b)g[b]=10*e.getFloat32(o),o+=4;r.push(g)}if(o+=c,o+=u,h){let g;if(_===8){g=new Float32Array(v);for(let b=0;b<v;++b)g[b]=10*e.getFloat64(o),o+=8}else{const b=new Uint32Array(i,o,v);for(let p=0;p<v;++p){const y=b[p];b[p]=(255&y)<<24|(65280&y)<<8|y>>8&65280|y>>24&255}g=new Float32Array(i,o,v);for(let p=0;p<v;++p)g[p]*=10,o+=4}n.push(g)}if(o+=d,o+=f,o>=i.byteLength)break}s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),pt&&tt.timeEnd("TrrParser._parse "+this.name)}});const Ff=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]);function DA(i){let e=1,t=0;for(;i>=e&&t<32;)t++,e<<=1;return t}const vg=new Uint8Array(32);function sfe(i,e){let t=1,n=0;vg[0]=1;for(let s=0;s<i;s++){let o,a=0;for(o=0;o<t;o++)a+=vg[o]*e[s],vg[o]=255&a,a>>=8;for(;a!==0;)vg[o++]=255&a,a>>=8;t=o}let r=1;for(t--;vg[t]>=r;)n++,r*=2;return n+8*t}function Ch(i,e,t,n){const r=(1<<t)-1;let s=n[1],o=n[2],a=i[0],l=0;for(;t>=8;)o=o<<8|e[a++],l|=o>>s<<t-8,t-=8;return t>0&&(s<t&&(s+=8,o=o<<8|e[a++]),s-=t,l|=o>>s&(1<<t)-1),l&=r,i[0]=a,i[1]=s,i[2]=o,l}const da=new Int32Array(32);function YU(i,e,t,n,r,s,o){let a=0;for(da[1]=0,da[2]=0,da[3]=0;n>8;)da[a++]=Ch(i,e,8,o),n-=8;n>0&&(da[a++]=Ch(i,e,n,o));for(let l=t-1;l>0;l--){let c=0;for(let u=a-1;u>=0;u--){c=c<<8|da[u];const h=c/r[l]|0;da[u]=h,c-=h*r[l]}s[l]=c}s[0]=da[0]|da[1]<<8|da[2]<<16|da[3]<<24}Zt.add("xtc",class extends GS{get type(){return"xtc"}get isBinary(){return!0}_parse(){pt&&tt.time("XtcParser._parse "+this.name);const i=am(this.streamer.data),e=new DataView(i),t=this.frames,n=t.coordinates,r=t.boxes,s=t.times,o=new Int32Array(6),a=new Int32Array(3),l=new Int32Array(3),c=new Uint32Array(3),u=new Float32Array(3),h=new Float32Array(3);let d=0;const f=new Int32Array(3),m=new Uint32Array(f.buffer);for(;;){let _;const v=e.getInt32(d+4);d+=12;const g=3*v;s.push(e.getFloat32(d)),d+=4;const b=new Float32Array(9);for(let p=0;p<9;++p)b[p]=10*e.getFloat32(d),d+=4;if(r.push(b),v<=9){_=new Float32Array(v);for(let p=0;p<v;++p)_[p]=e.getFloat32(d),d+=4}else{f[0]=f[1]=f[2]=0,a[0]=a[1]=a[2]=0,c[0]=c[1]=c[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,h[0]=h[1]=h[2]=0,_=new Float32Array(g);let p=0;const y=e.getInt32(d);d+=4;const A=e.getFloat32(d);let w;d+=4,o[0]=e.getInt32(d),o[1]=e.getInt32(d+4),o[2]=e.getInt32(d+8),o[3]=e.getInt32(d+12),o[4]=e.getInt32(d+16),o[5]=e.getInt32(d+20),a[0]=o[3]-o[0]+1,a[1]=o[4]-o[1]+1,a[2]=o[5]-o[2]+1,d+=24,(a[0]|a[1]|a[2])>16777215?(l[0]=DA(a[0]),l[1]=DA(a[1]),l[2]=DA(a[2]),w=0):w=sfe(3,a);let M=e.getInt32(d);d+=4;let T=M-1;T=9>T?9:T;let E=Ff[T]/2|0,C=Ff[M]/2|0;c[0]=c[1]=c[2]=Ff[M];let N=4*Math.ceil(e.getInt32(d)/4);d+=4;const P=1/A;let L=0,R=0;const F=new Uint8Array(i,d);for(u[0]=u[1]=u[2]=0;R<y;){w===0?(u[0]=Ch(f,F,l[0],m),u[1]=Ch(f,F,l[1],m),u[2]=Ch(f,F,l[2],m)):YU(f,F,3,w,a,u,m),R++,u[0]+=o[0],u[1]+=o[1],u[2]+=o[2],h[0]=u[0],h[1]=u[1],h[2]=u[2];let V=0;if(Ch(f,F,1,m)===1&&(L=Ch(f,F,5,m),V=L%3,L-=V,V--),L>0){u[0]=u[1]=u[2]=0;for(let z=0;z<L;z+=3){if(YU(f,F,3,M,c,u,m),R++,u[0]+=h[0]-C,u[1]+=h[1]-C,u[2]+=h[2]-C,z===0){let U=u[0];u[0]=h[0],h[0]=U,U=u[1],u[1]=h[1],h[1]=U,U=u[2],u[2]=h[2],h[2]=U,_[p++]=h[0]*P,_[p++]=h[1]*P,_[p++]=h[2]*P}else h[0]=u[0],h[1]=u[1],h[2]=u[2];_[p++]=u[0]*P,_[p++]=u[1]*P,_[p++]=u[2]*P}}else _[p++]=u[0]*P,_[p++]=u[1]*P,_[p++]=u[2]*P;if(M+=V,V<0?(C=E,E=M>9?Ff[M-1]/2|0:0):V>0&&(E=C,C=Ff[M]/2|0),c[0]=c[1]=c[2]=Ff[M],c[0]===0||c[1]===0||c[2]===0)return void console.error("(xdrfile error) Undefined error.")}d+=N}for(let p=0;p<g;p++)_[p]*=10;if(n.push(_),d>=i.byteLength)break}s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),pt&&tt.timeEnd("XtcParser._parse "+this.name)}});class D1 extends Ua{constructor(e,t){const n=t||{};super(e,n),this.volume=new zs(this.name,this.path),this.voxelSize=he(n.voxelSize,1)}get type(){return"volume"}get __objName(){return"volume"}_afterParse(){this.volume.setMatrix(this.getMatrix()),super._afterParse()}getMatrix(){return new Tt}}const ofe=/\s+/,afe=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,Ny=.529177210859;class KU extends D1{get type(){return"cube"}_parse(){pt&&tt.time("CubeParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(6),n={},r=Ny*this.voxelSize;function s(u,h){var d=t[u].trim().split(ofe)[h];return parseFloat(d)}n.atomCount=Math.abs(s(2,0)),n.originX=s(2,1)*Ny,n.originY=s(2,2)*Ny,n.originZ=s(2,3)*Ny,n.NVX=s(3,0),n.NVY=s(4,0),n.NVZ=s(5,0),n.basisX=new me(s(3,1),s(3,2),s(3,3)).multiplyScalar(r),n.basisY=new me(s(4,1),s(4,2),s(4,3)).multiplyScalar(r),n.basisZ=new me(s(5,1),s(5,2),s(5,3)).multiplyScalar(r);const o=new Float32Array(n.NVX*n.NVY*n.NVZ);let a=0,l=0;const c=s(2,0)>0?0:1;this.streamer.eachChunkOfLines(function(u){(function(h,d,f){for(let m=h;m<d;++m){const _=f[m].trim();if(_!==""&&l>=n.atomCount+6+c){const v=_.match(afe);for(let g=0,b=v.length;g<b;++g)o[a]=parseFloat(v[g]),++a}++l}})(0,u.length,u)}),e.header=n,e.setData(o,n.NVZ,n.NVY,n.NVX),pt&&tt.timeEnd("CubeParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=new Tt;return t.multiply(new Tt().makeTranslation(e.originX,e.originY,e.originZ)),t.multiply(new Tt().makeBasis(e.basisZ,e.basisY,e.basisX)),t}}Zt.add("cub",KU),Zt.add("cube",KU);class ZU extends D1{get type(){return"dsn6"}get isBinary(){return!0}_parse(){pt&&tt.time("Dsn6Parser._parse "+this.name);const e=this.volume,t={};let n,r;const s=am(this.streamer.data),o=new Int16Array(s),a=new Uint8Array(s),l=String.fromCharCode.apply(null,a.subarray(0,512));if(l.startsWith(":-)"))t.xStart=parseInt(l.substr(10,5)),t.yStart=parseInt(l.substr(15,5)),t.zStart=parseInt(l.substr(20,5)),t.xExtent=parseInt(l.substr(32,5)),t.yExtent=parseInt(l.substr(38,5)),t.zExtent=parseInt(l.substr(42,5)),t.xRate=parseInt(l.substr(52,5)),t.yRate=parseInt(l.substr(58,5)),t.zRate=parseInt(l.substr(62,5)),t.xlen=parseFloat(l.substr(73,10))*this.voxelSize,t.ylen=parseFloat(l.substr(83,10))*this.voxelSize,t.zlen=parseFloat(l.substr(93,10))*this.voxelSize,t.alpha=parseFloat(l.substr(103,10)),t.beta=parseFloat(l.substr(113,10)),t.gamma=parseFloat(l.substr(123,10)),n=parseFloat(l.substr(138,12))/100,r=parseInt(l.substr(155,8)),t.sigma=100*parseFloat(l.substr(170,12));else{if(o[18]!==100)for(let E=0,C=o.length;E<C;++E){const N=o[E];o[E]=(255&N)<<8|N>>8&255}t.xStart=o[0],t.yStart=o[1],t.zStart=o[2],t.xExtent=o[3],t.yExtent=o[4],t.zExtent=o[5],t.xRate=o[6],t.yRate=o[7],t.zRate=o[8];const M=1/o[17],T=M*this.voxelSize;t.xlen=o[9]*T,t.ylen=o[10]*T,t.zlen=o[11]*T,t.alpha=o[12]*M,t.beta=o[13]*M,t.gamma=o[14]*M,n=o[15]/100,r=o[16],t.gamma=o[14]*M}e.header=t,pt&&tt.log(t,n,r);const c=new Float32Array(t.xExtent*t.yExtent*t.zExtent);let u=512;const h=Math.ceil(t.xExtent/8),d=Math.ceil(t.yExtent/8),f=Math.ceil(t.zExtent/8);for(var m=0;m<f;++m)for(var _=0;_<d;++_)for(var v=0;v<h;++v)for(var g=0;g<8;++g)for(var b=8*m+g,p=0;p<8;++p)for(var y=8*_+p,A=0;A<8;++A){var w=8*v+A;if(!(w<t.xExtent&&y<t.yExtent&&b<t.zExtent)){u+=8-A;break}c[(w*t.yExtent+y)*t.zExtent+b]=(a[u]-r)/n,++u}e.setData(c,t.zExtent,t.yExtent,t.xExtent),t.sigma&&e.setStats(void 0,void 0,void 0,t.sigma),pt&&tt.timeEnd("Dsn6Parser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],r=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];r[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-r[1]*r[1]);const s=[[],t,n,r],o=[0,e.xRate,e.yRate,e.zRate],a=[0,1,2,3],l=new Tt;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.multiply(new Tt().makeRotationY(wi(90))),l.multiply(new Tt().makeTranslation(-e.zStart,e.yStart,e.xStart)),l.multiply(new Tt().makeScale(-1,1,1)),l}}Zt.add("dsn6",ZU),Zt.add("brix",ZU);const Fy=/\s+/;class ZV extends D1{get type(){return"dx"}_parse(){pt&&tt.time("DxParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(30),n=this.parseHeaderLines(t),r=this.volume.header,s=n.dataLineStart,o=r.nx*r.ny*r.nz,a=new Float32Array(o);let l=0,c=0;this.streamer.eachChunkOfLines(function(u){(function(h,d,f){for(let m=h;m<d;++m){if(l<o&&c>s){const _=f[m].trim();if(_!==""){const v=_.split(Fy);for(let g=0,b=v.length;g<b;++g)a[l]=parseFloat(v[g]),++l}}++c}})(0,u.length,u)}),e.setData(a,r.nz,r.ny,r.nx),pt&&tt.timeEnd("DxParser._parse "+this.name)}parseHeaderLines(e){const t={},n=e.length;let r=0,s=0,o=0;for(let a=0;a<n;++a){let l;const c=e[a];if(c.startsWith("object 1"))l=c.split(Fy),t.nx=parseInt(l[5]),t.ny=parseInt(l[6]),t.nz=parseInt(l[7]);else if(c.startsWith("origin"))l=c.split(Fy),t.xmin=parseFloat(l[1]),t.ymin=parseFloat(l[2]),t.zmin=parseFloat(l[3]);else if(c.startsWith("delta"))l=c.split(Fy),o===0?t.hx=parseFloat(l[1])*this.voxelSize:o===1?t.hy=parseFloat(l[2])*this.voxelSize:o===2&&(t.hz=parseFloat(l[3])*this.voxelSize),o+=1;else if(c.startsWith("object 3")){r=a,s+=c.length+1;break}s+=c.length+1}return this.volume.header=t,{dataLineStart:r,headerByteCount:s}}getMatrix(){const e=this.volume.header,t=new Tt;return t.multiply(new Tt().makeRotationY(wi(90))),t.multiply(new Tt().makeTranslation(-e.zmin,e.ymin,e.xmin)),t.multiply(new Tt().makeScale(-e.hz,e.hy,e.hx)),t}}Zt.add("dx",ZV);Zt.add("dxbin",class extends ZV{get type(){return"dxbin"}get isBinary(){return!0}_parse(){pt&&tt.time("DxbinParser._parse "+this.name);const i=am(this.streamer.data),e=function(l,c=10485760,u=`
`){let h="",d=[];for(let f=0;f<l.length;f+=c){const m=K0(l.subarray(f,f+c)),_=m.lastIndexOf(u);if(_===-1)h+=m;else{const v=h+m.substr(0,_);d=d.concat(v.split(u)),h=_===m.length-u.length?"":m.substr(_+u.length)}}return h!==""&&d.push(h),d}(new Uint8Array(i,0,1e3)),t=this.parseHeaderLines(e),n=this.volume.header,r=t.headerByteCount,s=n.nx*n.ny*n.nz,o=new DataView(i),a=new Float32Array(s);for(let l=0;l<s;++l)a[l]=o.getFloat64(8*l+r,!0);this.volume.setData(a,n.nz,n.ny,n.nx),pt&&tt.timeEnd("DxbinParser._parse "+this.name)}});class NA extends D1{get type(){return"mrc"}get isBinary(){return!0}_parse(){pt&&tt.time("MrcParser._parse "+this.name);const e=this.volume,t={},n=am(this.streamer.data),r=new Int32Array(n,0,56),s=new Float32Array(n,0,56),o=new DataView(n);if(t.MAP=String.fromCharCode(o.getUint8(208),o.getUint8(209),o.getUint8(210),o.getUint8(211)),t.MACHST=[o.getUint8(212),o.getUint8(213)],t.MACHST[0]===17&&t.MACHST[1]===17){const l=n.byteLength;for(let c=0;c<l;c+=4)o.setFloat32(c,o.getFloat32(c),!0)}let a;if(t.NX=r[0],t.NY=r[1],t.NZ=r[2],t.MODE=r[3],t.NXSTART=r[4],t.NYSTART=r[5],t.NZSTART=r[6],t.MX=r[7],t.MY=r[8],t.MZ=r[9],t.xlen=s[10]*this.voxelSize,t.ylen=s[11]*this.voxelSize,t.zlen=s[12]*this.voxelSize,t.alpha=s[13],t.beta=s[14],t.gamma=s[15],t.MAPC=r[16],t.MAPR=r[17],t.MAPS=r[18],t.DMIN=s[19],t.DMAX=s[20],t.DMEAN=s[21],t.ISPG=r[22],t.NSYMBT=r[23],t.LSKFLG=r[24],t.originX=s[49],t.originY=s[50],t.originZ=s[51],t.ARMS=s[54],e.header=t,t.MODE===2)a=new Float32Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ);else if(t.MODE===0){if(a=new Float32Array(new Int8Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ)),r[39]===-128&&r[40]===127){const l=(t.DMAX-t.DMIN)/255,c=.5*(t.DMIN+t.DMAX+l);for(let u=0,h=a.length;u<h;++u)a[u]=l*a[u]+c}}else tt.error("MrcParser unknown mode",t.MODE);e.setData(a,t.NX,t.NY,t.NZ),t.ARMS!==0&&e.setStats(t.DMIN,t.DMAX,t.DMEAN,t.ARMS),pt&&tt.timeEnd("MrcParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],r=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];r[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-r[1]*r[1]);const s=[[],t,n,r],o=[0,e.MX,e.MY,e.MZ],a=[0,e.MAPC,e.MAPR,e.MAPS],l=new Tt;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.setPosition(new me(e.originX,e.originY,e.originZ)),l.multiply(new Tt().makeTranslation(e.NXSTART,e.NYSTART,e.NZSTART)),l}}Zt.add("mrc",NA),Zt.add("ccp4",NA),Zt.add("map",NA);const lfe=/\s+/;function FA(i){return i.trim().split(lfe).map(parseFloat)}class QU extends D1{get type(){return"xplor"}_parse(){pt&&tt.time("XplorParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(8),n={};let r;r=t[2].startsWith("REMARKS")?parseInt(t[1].substring(0,8))+2:5;const s=r+3,o=FA(t[r]);n.NA=o[0],n.AMIN=o[1],n.AMAX=o[2],n.NB=o[3],n.BMIN=o[4],n.BMAX=o[5],n.NC=o[6],n.CMIN=o[7],n.CMAX=o[8];const a=FA(t[r+1]);n.a=a[0]*this.voxelSize,n.b=a[1]*this.voxelSize,n.c=a[2]*this.voxelSize,n.alpha=a[3],n.beta=a[4],n.gamma=a[5];const l=n.AMAX-n.AMIN+1,c=n.BMAX-n.BMIN+1,u=n.CMAX-n.CMIN+1,h=l*c*u,d=new Float32Array(h),f=Math.ceil(1+l*c/6);let m=0,_=0;this.streamer.eachChunkOfLines(function(v){(function(g,b,p){for(let y=g;y<b;++y){const A=p[y];if(_>=s&&(_-s)%f!=0&&m<h)for(let w=0,M=6;w<M;++w){const T=parseFloat(A.substr(12*w,12));if(isNaN(T))break;d[m++]=T}else if(m===h){const w=A.trim();if(w&&w!=="-9999"){const M=FA(A);n.RAVE=M[0],n.RSIGMA=M[1]}}++_}})(0,v.length,v)}),e.header=n,e.setData(d,l,c,u),n.RAVE!==0&&n.RSIGMA!==1&&e.setStats(void 0,void 0,n.RAVE,n.RSIGMA),pt&&tt.timeEnd("XplorParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.a,0,0],n=[e.b*Math.cos(Math.PI/180*e.gamma),e.b*Math.sin(Math.PI/180*e.gamma),0],r=[e.c*Math.cos(Math.PI/180*e.beta),e.c*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];r[2]=Math.sqrt(e.c*e.c*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-r[1]*r[1]);const s=[[],t,n,r],o=[0,e.NA,e.NB,e.NC],a=[0,1,2,3],l=new Tt;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.multiply(new Tt().makeTranslation(e.AMIN,e.BMIN,e.CMIN)),l}}function ni(i,e,t){let n,r,s;i/=360,e/=100,t/=100;const o=Math.floor(6*i),a=6*i-o,l=t*(1-e),c=t*(1-a*e),u=t*(1-(1-a)*e);switch(o%6){case 0:n=t,r=u,s=l;break;case 1:n=c,r=t,s=l;break;case 2:n=l,r=t,s=u;break;case 3:n=l,r=c,s=t;break;case 4:n=u,r=l,s=t;break;case 5:n=t,r=l,s=c}return[n,r,s]}Zt.add("xplor",QU),Zt.add("cns",QU);const RC={red:ni(0,100,100),orange:ni(20,100,100),gold:ni(40,100,100),yellow:ni(60,100,100),lime:ni(80,100,100),green:ni(120,80,100),sea:ni(150,100,100),cyan:ni(180,100,85),sky:ni(210,75,95),blue:ni(240,70,100),purple:ni(275,75,100),magenta:ni(300,95,100),hotpink:ni(335,100,100),pink:ni(350,55,100),peach:ni(25,75,100),lilac:ni(275,55,100),pinktint:ni(340,30,100),peachtint:ni(25,50,100),yellowtint:ni(60,50,100),greentint:ni(135,40,100),bluetint:ni(220,40,100),lilactint:ni(275,35,100),white:ni(0,0,100),gray:ni(0,0,50),brown:ni(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},cfe=/[\s,]+/,QV=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,IC=/^{+|}+$/g,ufe=/^['"]+|['"]+$/g,JV=/\s*=\s*/g;function ky(i){let e,t,n,r=[];const s=(i=i.replace(JV,"=")).match(QV);for(let o=1;o<s.length;++o){const a=s[o];if(a[0]==="{")e=a.substring(1,a.length-1);else{const l=a.split("=");l.length===2&&(l[0]==="color"?t=RC[l[1]]:l[0]==="width"?n=parseInt(l[1]):l[0]==="master"&&r.push(l[1].replace(IC,"")))}}return{listName:e,listColor:t,listMasters:r,listWidth:n}}function Uy(i){const e=(i=i.trim()).indexOf("{"),t=i.indexOf("}"),n=i.substr(t+1).split(cfe),r=i.substr(e+1,t-1),s=[parseFloat(n[n.length-3]),parseFloat(n[n.length-2]),parseFloat(n[n.length-1])];let o,a,l,c=!1,u=!1;for(let h=4;h<=n.length;h++){const d=n[n.length-h];d in RC&&(o=RC[n[n.length-h]]),d.startsWith("width")&&(a=parseInt(d.substring(5))),d.startsWith("r=")&&(l=parseFloat(d.split("=")[1])),d.startsWith("P")&&(c=!0),d.startsWith("X")&&(u=!0)}return{label:r,position:s,color:o,radius:l,width:a,isLineBreak:c,isTriangleBreak:u}}function kA(i){const e=i.indexOf("{"),t=i.indexOf("}");return i.substring(e!==-1?e+1:0,t!==-1?t:void 0).trim()}function hfe(i){const e=i.indexOf("}");return e===-1?void 0:i.substr(e+1).trim()}function UA(i){let e="",t=[],n={};const r=(i=i.replace(JV,"=")).match(QV);for(let s=1;s<r.length;++s){const o=r[s];if(o[0]==="{")e=o.substring(1,o.length-1);else{const a=o.split("=");a.length===2?a[0]==="master"?t.push(a[1].replace(IC,"")):n[a[0]]=a[1].replace(IC,""):n[a[0]]=!0}}return{groupName:e,groupFlags:n,groupMasters:t}}Zt.add("kin",class extends Ua{get type(){return"kin"}get __objName(){return"kinemage"}_parse(){pt&&tt.time(`KinParser._parse ${this.name}`);const i={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};let e,t;this.kinemage=i;let n,r,s,o,a,l,c,u,h,d,f,m,_,v,g,b,p,y,A,w,M,T,E=!1,C="",N=!1,P="",L=null,R=null,F=!1,V="",z=!1,U="",G=!1,B=!1;if(this.streamer.eachChunkOfLines(function(D){(function(O,j,q){for(let ie=O;ie<j;++ie){const ne=q[ie];if(ne[0]==="@"&&(E=!1,N=!1,F=!1,z=!1,G=!1,B=!1),ne)if(ne.startsWith("@dotlist")){let{listColor:Q,listName:le,listMasters:se}=ky(ne);E=!0,C="",r=[],s=[],o=[],n=Q,e&&(se=se.concat(e)),t&&(se=se.concat(t)),i.dotLists.push({name:le,masterArray:se,labelArray:r,positionArray:s,colorArray:o})}else if(ne.startsWith("@vectorlist")){let{listMasters:Q,listName:le,listWidth:se,listColor:oe}=ky(ne);Q&&Q.forEach(function($){i.masterDict[$]||(i.masterDict[$]={indent:!1,visible:!1})}),N=!0,P="",L=null,R=null,c=[],u=[],h=[],d=[],f=[],m=[],a=oe,l=[],se&&l.push(se),e&&(Q=Q.concat(e)),t&&(Q=Q.concat(t)),i.vectorLists.push({name:le,masterArray:Q,label1Array:c,label2Array:u,position1Array:h,position2Array:d,color1Array:f,color2Array:m,width:l})}else if(ne.startsWith("@balllist")){let{listName:Q,listColor:le,listMasters:se}=ky(ne);se&&se.forEach(function(oe){i.masterDict[oe]||(i.masterDict[oe]={indent:!1,visible:!1})}),F=!0,V="",g=[],_=[],b=[],p=[],v=le,e&&(se=se.concat(e)),t&&(se=se.concat(t)),i.ballLists.push({name:Q,masterArray:se,labelArray:g,radiusArray:_,positionArray:b,colorArray:p})}else if(ne.startsWith("@ribbonlist")||ne.startsWith("@trianglelist")){let{listMasters:Q,listName:le,listColor:se}=ky(ne);Q&&Q.forEach(function(oe){i.masterDict[oe]||(i.masterDict[oe]={indent:!1,visible:!1})}),z=!0,U="",A=[],w=[],M=[],T=[],y=se,e&&(Q=Q.concat(e)),t&&(Q=Q.concat(t)),i.ribbonLists.push({name:le,masterArray:Q,labelArray:A,positionArray:w,breakArray:M,colorArray:T})}else if(ne.startsWith("@text"))G=!0,i.texts.push(ne.substr(5));else if(ne.startsWith("@caption"))B=!0,i.captions.push(ne.substr(8));else if(E){let{label:Q,color:le,position:se}=Uy(ne);Q==='"'?Q=C:C=Q,le===void 0&&(le=n),r.push(Q),s.push(...se),o.push(...le)}else if(N){let Q=ne.replace(/(?!^){/g,`
{`).split(/\n/);for(var Y=0;Y<Q.length;Y++){let le=Q[Y],{label:se,color:oe,width:$,position:pe,isLineBreak:xe}=Uy(le);se==='"'?se=P:P=se,oe===void 0&&(oe=a),xe||L!==null&&($&&l.push($),c.push(P),h.push(...L),f.push(...R),u.push(se),d.push(...pe),m.push(...oe)),P=se,L=pe,R=oe}}else if(F){let{label:Q,radius:le,color:se,position:oe}=Uy(ne);Q==='"'?Q=V:V=Q,le===void 0&&(le=1),se===void 0&&(se=v),g.push(Q),_.push(le),b.push(...oe),p.push(...se)}else if(z){let{label:Q,color:le,position:se,isTriangleBreak:oe}=Uy(ne);Q==='"'?Q=U:U=Q,le===void 0&&(le=y),A.push(Q),w.push(...se),M.push(oe),T.push(...le)}else if(G)i.texts.push(ne);else if(B)i.captions.push(ne);else if(ne.startsWith("@kinemage"))i.kinemage=parseInt(ne.substr(9).trim());else if(ne.startsWith("@onewidth"))i.onewidth=!0;else if(ne.startsWith("@1viewid"))i["1viewid"]=kA(ne);else if(ne.startsWith("@pdbfile"))i.pdbfile=kA(ne);else if(ne.startsWith("@group")){let{groupName:Q,groupFlags:le,groupMasters:se}=UA(ne);i.groupDict[Q]||(i.groupDict[Q]={dominant:!1,animate:!1},e=se),e&&e.forEach(function(oe){i.masterDict[oe]||(i.masterDict[oe]={indent:!1,visible:!1})});for(let oe in le)i.groupDict[Q][oe]=le[oe]}else if(ne.startsWith("@subgroup")){const{groupName:Q,groupFlags:le,groupMasters:se}=UA(ne);i.subgroupDict[Q]||(i.subgroupDict[Q]={dominant:!1,animate:!1},t=se),t&&t.forEach(function(oe){i.masterDict[oe]||(i.masterDict[oe]={indent:!1,visible:!1})});for(let oe in le)i.subgroupDict[Q][oe]=le[oe]}else if(ne.startsWith("@master")){const Q=kA(ne),le=hfe(ne);i.masterDict[Q]||(i.masterDict[Q]={indent:!1,visible:!1}),le==="on"?i.masterDict[Q].visible=!0:le==="off"?i.masterDict[Q].visible=!1:le==="indent"&&(i.masterDict[Q].indent=!0)}else if(ne.startsWith("@pointmaster")){const{groupName:Q,groupFlags:le}=UA(ne);i.pointmasterDict[Q]={id:Object.keys(le)[0].replace(ufe,"")}}else console.log(ne);else E=!1,N=!1,F=!1,z=!1}})(0,D.length,D)}),i.text=i.texts.join(`
`).trim(),i.caption=i.captions.join(`
`).trim(),i.ribbonLists){let D=[];i.ribbonLists.forEach(function(O){D.push(function(j){let{labelArray:q,positionArray:Y,colorArray:ie,breakArray:ne}=j,Q=[],le=[],se=[],oe=[];for(let $=0;$<ne.length/3;$++){let pe=3*$,xe=9*$;ne[pe+1]||ne[pe+2]||(Q.push(q[pe]),Q.push(q[pe+1]),Q.push(q[pe+2]),oe.push(ne[pe]),oe.push(ne[pe+1]),oe.push(ne[pe+2]),le.push(Y[xe]),le.push(Y[xe+1]),le.push(Y[xe+2]),le.push(Y[xe+3]),le.push(Y[xe+4]),le.push(Y[xe+5]),le.push(Y[xe+6]),le.push(Y[xe+7]),le.push(Y[xe+8]),se.push(ie[xe]),se.push(ie[xe+1]),se.push(ie[xe+2]),se.push(ie[xe+3]),se.push(ie[xe+4]),se.push(ie[xe+5]),se.push(ie[xe+6]),se.push(ie[xe+7]),se.push(ie[xe+8]))}return{name:j.name,masterArray:j.masterArray,labelArray:Q,positionArray:le,breakArray:oe,colorArray:se}}(function(j){let{labelArray:q,positionArray:Y,colorArray:ie,breakArray:ne}=j,Q=[];for(let pe=0;pe<3*(q.length-2);++pe)Q[pe]=q[pe-2*Math.floor(pe/3)];let le=[];for(let pe=0;pe<3*(ne.length-2);++pe)le[pe]=ne[pe-2*Math.floor(pe/3)];let se=[];for(let pe=0;pe<9*(Y.length/3-2);++pe)se[pe]=Y[pe-6*Math.floor(pe/9)];let oe=[];for(let pe=0;pe<9*(ie.length/3-2);++pe)oe[pe]=ie[pe-6*Math.floor(pe/9)];let $=[];for(let pe=0;pe<se.length/3;++pe)$.push(new me(se[3*pe],se[3*pe]+1,se[3*pe]+2));return{name:j.name,masterArray:j.masterArray,labelArray:Q,positionArray:se,breakArray:le,colorArray:oe}}(O)))}),i.ribbonLists=D}pt&&tt.timeEnd(`KinParser._parse ${this.name}`)}});class eH extends Ua{constructor(e,t){super(e,t),this.loader=this.getLoader(),this.surface=new DS(this.name,this.path)}get type(){return"surface"}get __objName(){return"surface"}_parse(){var e=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(e)}}const LC=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};LC.prototype={constructor:LC,setPath:function(i){this.path=i},_createParserState:function(){var i={objects:[],object:{},vertices:[],normals:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);this.object={name:e||"",geometry:{vertices:[],normals:[]},fromDeclaration:t!==!1},this.objects.push(this.object)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},addVertex:function(e,t,n){var r=this.vertices,s=this.object.geometry.vertices;s.push(r[e+0]),s.push(r[e+1]),s.push(r[e+2]),s.push(r[t+0]),s.push(r[t+1]),s.push(r[t+2]),s.push(r[n+0]),s.push(r[n+1]),s.push(r[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var r=this.normals,s=this.object.geometry.normals;s.push(r[e+0]),s.push(r[e+1]),s.push(r[e+2]),s.push(r[t+0]),s.push(r[t+1]),s.push(r[t+2]),s.push(r[n+0]),s.push(r[n+1]),s.push(r[n+2])},addFace:function(e,t,n,r,s,o,a,l){var c,u=this.vertices.length,h=this.parseVertexIndex(e,u),d=this.parseVertexIndex(t,u),f=this.parseVertexIndex(n,u);if(r===void 0?this.addVertex(h,d,f):(c=this.parseVertexIndex(r,u),this.addVertex(h,d,c),this.addVertex(d,f,c)),s!==void 0){var m=this.normals.length;h=this.parseNormalIndex(s,m),d=s===o?h:this.parseNormalIndex(o,m),f=s===a?h:this.parseNormalIndex(a,m),r===void 0?this.addNormal(h,d,f):(c=this.parseNormalIndex(l,m),this.addNormal(h,d,c),this.addNormal(d,f,c))}},addLineGeometry:function(e){this.object.geometry.type="Line";for(var t=this.vertices.length,n=0,r=e.length;n<r;n++)this.addVertexLine(this.parseVertexIndex(e[n],t))}};return i.startObject("",!1),i},parse:function(i){var e,t,n=this._createParserState();i.indexOf(`\r
`)!==-1&&(i=i.replace(/\r\n/g,`
`)),i.indexOf(`\\
`)!==-1&&(i=i.replace(/\\\n/g,""));var r=i.split(`
`),s="",o="",a="",l=[],c=typeof"".trimLeft=="function";for(e=0,t=r.length;e<t;e++)if(s=r[e],(s=c?s.trimLeft():s.trim()).length!==0&&(o=s.charAt(0))!=="#"){if(o==="v"){if((a=s.charAt(1))===" "&&(l=this.regexp.vertex_pattern.exec(s))!==null)n.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a==="n"&&(l=this.regexp.normal_pattern.exec(s))!==null)n.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a!=="t"||this.regexp.uv_pattern.exec(s)===null)throw new Error("Unexpected vertex/normal/uv line: '"+s+"'")}else if(o==="f"){if((l=this.regexp.face_vertex_uv_normal.exec(s))!==null)n.addFace(l[1],l[4],l[7],l[10],l[3],l[6],l[9],l[12]);else if(this.regexp.face_vertex_uv.exec(s)===null)if((l=this.regexp.face_vertex_normal.exec(s))!==null)n.addFace(l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else{if((l=this.regexp.face_vertex.exec(s))===null)throw new Error("Unexpected face line: '"+s+"'");n.addFace(l[1],l[2],l[3],l[4])}}else if(o==="l"){var u=s.substring(1).trim().split(" "),h=[],d=[];if(s.indexOf("/")===-1)h=u;else for(var f=0,m=u.length;f<m;f++){var _=u[f].split("/");_[0]!==""&&h.push(_[0]),_[1]!==""&&d.push(_[1])}n.addLineGeometry(h,d)}else if((l=this.regexp.object_pattern.exec(s))!==null){var v=l[0].substr(1).trim();n.startObject(v)}else if(!this.regexp.material_use_pattern.test(s)){if(!this.regexp.material_library_pattern.test(s)){if(this.regexp.smoothing_pattern.exec(s)===null){if(s==="\0")continue;throw new Error("Unexpected line: '"+s+"'")}}}}var g=[];for(e=0,t=n.objects.length;e<t;e++){var b=n.objects[e].geometry;if(b.vertices.length!==0){var p=new nr;p.setAttribute("position",new Hi(new Float32Array(b.vertices),3)),b.normals.length>0?p.setAttribute("normal",new Hi(new Float32Array(b.normals),3)):p.computeVertexNormals(),g.push(p)}}return g}};Zt.add("obj",class extends eH{get type(){return"obj"}getLoader(){return new LC}});const dfe=["int8","char","uint8","uchar","int16","short","uint16","ushort","int32","int","uint32","uint","float32","float","float64","double"];function OA(i){if(function(e){return dfe.includes(e)}(i))return i;throw new Error(`Unsupported data type: ${i}`)}function ffe(i){if(typeof i!="object"||i===null)throw new Error("Expected element to be an object");if(typeof i.name!="string")throw new Error("Expected element.name to be a string");if(typeof i.count!="number")throw new Error("Expected element.count to be a number");if(!Array.isArray(i.properties))throw new Error("Expected element.properties to be an array")}function BA(i,e,t){switch(e){case"int8":case"char":return{read:n=>i.getInt8(n),size:1};case"uint8":case"uchar":return{read:n=>i.getUint8(n),size:1};case"int16":case"short":return{read:n=>i.getInt16(n,t),size:2};case"uint16":case"ushort":return{read:n=>i.getUint16(n,t),size:2};case"int32":case"int":return{read:n=>i.getInt32(n,t),size:4};case"uint32":case"uint":return{read:n=>i.getUint32(n,t),size:4};case"float32":case"float":return{read:n=>i.getFloat32(n,t),size:4};case"float64":case"double":return{read:n=>i.getFloat64(n,t),size:8};default:throw new Error(`Unsupported data type: ${e}`)}}function pfe(i,e){const t={};let n=0;for(let r=0;r<e.length;r++){const s=e[r],o=s.valueReader;if(s.isList){const a=[],l=s.countReader.read(i+n);n+=s.countReader.size;for(let c=0;c<l;c++)a.push(o.read(i+n)),n+=o.size;t[s.name]=a}else t[s.name]=o.read(i+n),n+=o.size}return[t,n]}class mfe{constructor(){this._color=new Ht,this.propertyNameMapping={},this.customPropertyMapping={}}setPropertyNameMapping(e){this.propertyNameMapping=e}createBuffer(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const t of Object.keys(this.customPropertyMapping))e[t]=[];return e}extractHeaderText(e){let t=0,n=!0,r="";const s=[],o=new TextDecoder().decode(e.subarray(0,5)),a=/^ply\r\n/.test(o);do{const l=String.fromCharCode(e[t++]);l!==`
`&&l!=="\r"?r+=l:(r==="end_header"&&(n=!1),r!==""&&(s.push(r),r=""))}while(n&&t<e.length);return a===!0&&t++,{headerText:s.join("\r")+"\r",headerLength:t}}handleElement(e,t,n,r){if(t==="vertex"){e.vertices.push(n[r.attrX],n[r.attrY],n[r.attrZ]),r.attrNX!==null&&r.attrNY!==null&&r.attrNZ!==null&&e.normals.push(n[r.attrNX],n[r.attrNY],n[r.attrNZ]),r.attrS!==null&&r.attrT!==null&&e.uvs.push(n[r.attrS],n[r.attrT]),r.attrR!==null&&r.attrG!==null&&r.attrB!==null&&(this._color.setRGB(n[r.attrR]/255,n[r.attrG]/255,n[r.attrB]/255).convertSRGBToLinear(),e.colors.push(this._color.r,this._color.g,this._color.b));for(const s of Object.keys(this.customPropertyMapping))for(const o of this.customPropertyMapping[s])e[s].push(n[o])}else if(t==="face"){const s=n.vertex_indices||n.vertex_index,o=n.texcoord;s.length===3?(e.indices.push(s[0],s[1],s[2]),o&&o.length===6&&(e.faceVertexUvs.push(o[0],o[1]),e.faceVertexUvs.push(o[2],o[3]),e.faceVertexUvs.push(o[4],o[5]))):s.length===4&&(e.indices.push(s[0],s[1],s[3]),e.indices.push(s[1],s[2],s[3])),r.attrR!==null&&r.attrG!==null&&r.attrB!==null&&(this._color.setRGB(n[r.attrR]/255,n[r.attrG]/255,n[r.attrB]/255).convertSRGBToLinear(),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b))}}parse(e){let t;if(e instanceof ArrayBuffer){const n=new Uint8Array(e),{headerText:r,headerLength:s}=this.extractHeaderText(n),o=this.parseHeader(r,s);if(o.format==="ascii"){const a=new TextDecoder().decode(n);t=this.parseASCII(a,o)}else t=this.parseBinary(n,o)}else t=this.parseASCII(e,this.parseHeader(e));return t}parseHeader(e,t=0){let n="";const r=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);r!==null&&(n=r[1]);const s={comments:[],elements:[],headerLength:t,objInfo:"",format:"",version:""},o=n.split(/\r\n|\r|\n/);let a;for(let l=0;l<o.length;l++){let c=o[l];if(c=c.trim(),c==="")continue;const u=c.split(/\s+/),h=u.shift();switch(c=u.join(" "),h){case"format":s.format=u[0],s.version=u[1];break;case"comment":s.comments.push(c);break;case"element":a!==void 0&&(ffe(a),s.elements.push(a)),a={name:u[0],count:parseInt(u[1]),properties:[]};break;case"property":if(a===void 0){console.warn("property without element");continue}a.properties.push(gfe(u,this.propertyNameMapping));break;case"obj_info":s.objInfo=c;break;default:console.log("unhandled",h,u)}}return a!==void 0&&s.elements.push(a),s}parseASCII(e,t){const n=this.createBuffer();let r,s;r=(s=/end_header\s+(\S[\s\S]*\S|\S)\s*$/.exec(e))!==null?s[1].split(/\s+/):[];const o=new _fe(r);e:for(let a=0;a<t.elements.length;a++){const l=t.elements[a],c=JU(l.properties);for(let u=0;u<l.count;u++){const h=vfe(l.properties,o);if(!h)break e;this.handleElement(n,l.name,h,c)}}return this.postProcess(n)}parseBinary(e,t){const n=this.createBuffer(),r=t.format==="binary_little_endian",s=new DataView(e,t.headerLength);let o,a=0;for(let l=0;l<t.elements.length;l++){const c=t.elements[l],u=c.properties,h=JU(u),d=this.makeBinaryProperties(u,s,r);for(let f=0;f<c.count;f++){o=pfe(a,d),a+=o[1];const m=o[0];this.handleElement(n,c.name,m,h)}}return this.postProcess(n)}postProcess(e){let t=new nr;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new ai(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new ai(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new ai(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new ai(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(t=t.toNonIndexed(),e.faceVertexUvs.length>0&&t.setAttribute("uv",new ai(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&t.setAttribute("color",new ai(e.faceVertexColors,3)));for(const n of Object.keys(this.customPropertyMapping))e[n].length>0&&t.setAttribute(n,new ai(e[n],this.customPropertyMapping[n].length));return t.computeBoundingSphere(),t}makeBinaryProperties(e,t,n){const r=[];for(let s=0,o=e.length;s<o;s++){const a=e[s];a.isList?r.push(Object.assign(Object.assign({},a),{countReader:BA(t,a.countType,n),valueReader:BA(t,a.type,n)})):r.push(Object.assign(Object.assign({},a),{valueReader:BA(t,a.type,n)}))}return r}}function gfe(i,e){const t=i[0];let n;return n=t==="list"?{isList:!0,name:i[3],type:OA(i[2]),countType:OA(i[1])}:{isList:!1,name:i[1],type:OA(t)},n.name in e&&(n.name=e[n.name]),n}function zA(i,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(i);case"float":case"double":case"float32":case"float64":return parseFloat(i)}return 0}function vfe(i,e){const t={name:"",type:""};for(let n=0;n<i.length;n++){if(e.empty())return null;const r=i[n];if(r.isList){const s=[],o=zA(e.next(),r.countType);for(let a=0;a<o;a++){if(e.empty())return null;s.push(zA(e.next(),r.type))}t[r.name]=s}else t[i[n].name]=zA(e.next(),i[n].type)}return t}function JU(i){const e=i.map(n=>n.name);function t(n){for(let r=0,s=n.length;r<s;r++){const o=n[r];if(e.includes(o))return o}return null}return{attrX:t(["x","px","posx"])||"x",attrY:t(["y","py","posy"])||"y",attrZ:t(["z","pz","posz"])||"z",attrNX:t(["nx","normalx"]),attrNY:t(["ny","normaly"]),attrNZ:t(["nz","normalz"]),attrS:t(["s","u","texture_u","tx"]),attrT:t(["t","v","texture_v","ty"]),attrR:t(["red","diffuse_red","r","diffuse_r"]),attrG:t(["green","diffuse_green","g","diffuse_g"]),attrB:t(["blue","diffuse_blue","b","diffuse_b"])}}class _fe{constructor(e){this.arr=e,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}Zt.add("ply",class extends eH{get type(){return"ply"}getLoader(){return new mfe}});Zt.add("csv",class extends Ua{constructor(i,e){const t=e||{};super(i,t),this.delimiter=he(t.delimiter,","),this.comment=he(t.comment,"#"),this.columnNames=he(t.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}get type(){return"csv"}get __objName(){return"table"}_parse(){const i=this.table.data,e=new RegExp("\\s*"+this.delimiter+"\\s*");let t=0;this.streamer.eachChunkOfLines(n=>{const r=n.length;for(let s=0;s<r;++s){const o=n[s].trim();if(o.startsWith(this.comment))continue;const a=o.split(e);t===0?this.table.columnNames=a:o&&i.push(a),++t}})}});Zt.add("json",class extends Ua{constructor(i,e){const t=e||{};super(i,t),this.string=he(t.string,!1),this.json={name:this.name,path:this.path,data:{}}}get type(){return"json"}get __objName(){return"json"}get isJson(){return!0}_parse(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data}});Zt.add("msgpack",class extends Ua{constructor(i,e){super(i,e||{}),this.msgpack={name:this.name,path:this.path,data:void 0}}get type(){return"msgpack"}get __objName(){return"msgpack"}get isBinary(){return!0}_parse(){pt&&tt.time("MsgpackParser._parse "+this.name),this.msgpack.data=XV(this.streamer.data),pt&&tt.timeEnd("MsgpackParser._parse "+this.name)}});Zt.add("netcdf",class extends Ua{constructor(i,e){super(i,e||{}),this.netcdf={name:this.name,path:this.path,data:void 0}}get type(){return"netcdf"}get __objName(){return"netcdf"}get isBinary(){return!0}_parse(){pt&&tt.time("NetcdfParser._parse "+this.name),this.netcdf.data=new KV(this.streamer.data),pt&&tt.timeEnd("NetcdfParser._parse "+this.name)}});class eO extends Ua{constructor(e,t){super(e,t),this.text={name:this.name,path:this.path,data:""}}get type(){return"text"}get __objName(){return"text"}_parse(){this.text.data=this.streamer.asText()}}Zt.add("txt",eO),Zt.add("text",eO);const yfe=/^['"]|['"]$/g,xfe=/^<([\w-:.]+)\s*/,bfe=/^([^<]*)/,Sfe=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;function wfe(i){return i=i.trim().replace(/<!--[\s\S]*?-->/g,""),{declaration:e(),root:t()};function e(){if(!r(/^<\?xml\s*/))return;const a={attributes:{}};for(;!s()&&!o("?>");){const l=n();if(!l)return a;a.attributes[l.name]=l.value}return r(/\?>\s*/),a}function t(){const a=r(xfe);if(!a)return;const l={name:a[1],attributes:{},children:[]};for(;!(s()||o(">")||o("?>")||o("/>"));){const u=n();if(!u)return l;l.attributes[u.name]=u.value}if(r(/^\s*\/>\s*/))return l;let c;for(r(/\??>\s*/),l.content=function(){const u=r(bfe);return u?u[1]:""}();c=t();)l.children.push(c);return r(/^<\/[\w-:.]+>\s*/),l}function n(){const a=r(Sfe);var l;if(a)return{name:a[1],value:(l=a[2],l.replace(yfe,""))}}function r(a){const l=i.match(a);if(l)return i=i.slice(l[0].length),l}function s(){return i.length===0}function o(a){return i.indexOf(a)===0}}class tH extends Ua{constructor(e,t){const n=t||{};super(e,n),this.useDomParser=he(n.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}get type(){return"xml"}get __objName(){return"xml"}get isXml(){return!0}__xmlParser(e){return wfe(e)}__domParser(e){return new window.DOMParser().parseFromString(e,"text/xml")}_parse(){pt&&tt.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),pt&&tt.timeEnd("XmlParser._parse "+this.name)}}function Zi(i,e){const t=i.getNamedItem(e);return t!==null?t.value:""}function tO(i,e,t=!1){const n=Zi(i,"icode").trim(),r=Zi(i,"chain").trim(),s=Zi(i,"altcode");let o=Zi(i,"resnum");return n&&(o+="^"+n),r&&(o+=":"+r),e&&(o+="."+e),t&&s.trim()&&(o+="%"+s),o+="/"+(parseInt(Zi(i,"model"))-1),o}function Mfe(i){const e=Zi(i,"chain").trim();let t=`[${Zi(i,"rescode")}]${Zi(i,"resnum")}`;return e&&(t+=`:${e}`),t}function GA(i,e,t){i[e]===void 0?i[e]=t:i[e]|=t}function VA(i,e){return i!==null&&i.value===e}function Afe(i,e,t){let n=0;const r=e.getElementsByTagName("clash");for(let s=0,o=r.length;s<o;++s)if(i[Zi(r[s].attributes,"cid")]){n+=1;break}return e.getElementsByTagName("angle-outlier").length>0&&(n+=1),e.getElementsByTagName("bond-outlier").length>0&&(n+=1),e.getElementsByTagName("plane-outlier").length>0&&(n+=1),VA(t.getNamedItem("rota"),"OUTLIER")&&(n+=1),VA(t.getNamedItem("rama"),"OUTLIER")&&(n+=1),VA(t.getNamedItem("RNApucker"),"outlier")&&(n+=1),n}Zt.add("xml",tH);class Efe{constructor(e,t){this.name=e,this.path=t,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"}get type(){return"validation"}fromXml(e){pt&&tt.time("Validation.fromXml");const t=this.rsrzDict,n=this.rsccDict,r=this.rciDict,s=this.clashDict,o=this.clashArray,a=this.geoDict,l=this.geoAtomDict,c=this.atomDict,u=e.getElementsByTagName("Entry");if(u.length===1){const m=u[0].getElementsByTagName("chemical_shift_list");if(m.length===1){const _=m[0].getElementsByTagName("random_coil_index");for(let v=0,g=_.length;v<g;++v){const b=_[v].attributes;r[Mfe(b)]=parseFloat(Zi(b,"value"))}}}const h=e.getElementsByTagName("ModelledSubgroup"),d={},f=[];pt&&tt.time("Validation.fromXml#clashDict");for(let m=0,_=h.length;m<_;++m){const v=h[m],g=v.attributes,b=tO(g);g.getNamedItem("rsrz")!==null&&(t[b]=parseFloat(Zi(g,"rsrz"))),g.getNamedItem("rscc")!==null&&(n[b]=parseFloat(Zi(g,"rscc")));const p=e.createAttribute("sele");p.value=b,g.setNamedItem(p);const y=v.getElementsByTagName("clash");for(let A=0,w=y.length;A<w;++A){const M=y[A].attributes,T=Zi(M,"atom");if($R(T)!=="H"){const E=Zi(M,"cid"),C=tO(g,T,!0);if(c[C]=!0,d[E]===void 0)d[E]={sele1:C,res1:b};else{const N=d[E];N.res1!==b&&(N.sele2=C,N.res2=b,f.push(N.res1,b),s[E]=N,o.push(N))}}}}pt&&tt.timeEnd("Validation.fromXml#clashDict");for(let m=0,_=h.length;m<_;++m){const v=h[m],g=v.attributes,b=Zi(g,"sele");if(Zi(g,"seq")!=="."){const p=Afe(s,v,g);p>0&&(a[b]=p)}else{const p=v.getElementsByTagName("clash"),y=v.getElementsByTagName("mog-bond-outlier"),A=v.getElementsByTagName("mog-angle-outlier");if(y.length>0||A.length>0||p.length>0){const w={};l[b]=w;for(let M=0,T=p.length;M<T;++M){const E=p[M].attributes;s[Zi(E,"cid")]&&GA(w,Zi(E,"atom"),1)}for(let M=0,T=y.length;M<T;++M)Zi(y[M].attributes,"atoms").split(",").forEach(function(E){GA(w,E,2)});for(let M=0,T=A.length;M<T;++M)Zi(A[M].attributes,"atoms").split(",").forEach(function(E){GA(w,E,4)})}}}this.clashSele=f.length?f.join(" OR "):"NONE",pt&&tt.timeEnd("Validation.fromXml")}getClashData(e){pt&&tt.time("Validation.getClashData");const t=e||{},n=t.structure,r=n.atomSet,s=new Ht(he(t.color,"#f0027f")),o=n.getAtomProxy(),a=n.getAtomProxy(),l=new me,c=new me,u=new me,h=this.clashArray,d=h.length,f=new Float32Array(3*d),m=new Float32Array(3*d),_=Bn(d,s.r,s.g,s.b),v=new Float32Array(d),g=new Float32Array(d);pt&&tt.time("Validation.getClashData#atomDict");const b=this.atomDict;n.eachAtom(function(y){const A=function(w){const M=w.inscode,T=w.chainname,E=w.atomname,C=w.altloc;let N=w.resno+"";return M&&(N+="^"+M),T&&(N+=":"+T),E&&(N+="."+E),C&&(N+="%"+C),N+="/"+w.modelIndex,N}(y);b[A]===!0&&(b[A]=y.index)}),pt&&tt.timeEnd("Validation.getClashData#atomDict");let p=0;return h.forEach(function(y,A){if(o.index=b[y.sele1],a.index=b[y.sele2],o.index===void 0||a.index===void 0||!r.isSet(o.index,a.index))return;l.subVectors(a,o).setLength(o.vdw),c.copy(o).add(l),l.subVectors(o,a).setLength(a.vdw),u.copy(a).add(l);const w=o.distanceTo(a)/2,M=Math.sqrt(o.vdw*o.vdw-w*w),T=Math.sqrt(a.vdw*a.vdw-w*w);c.toArray(f,3*p),u.toArray(m,3*p),v[p]=(M+T)/2,g[p]=A,++p}),pt&&tt.timeEnd("Validation.getClashData"),{position1:f.subarray(0,3*p),position2:m.subarray(0,3*p),color:_.subarray(0,3*p),color2:_.subarray(0,3*p),radius:v.subarray(0,p),picking:new Xle(g.subarray(0,p),this,n)}}}function nH(i,e){return i.length===e?i:i.subarray?i.subarray(0,e):(i.length=e,i)}function wp(i,e,t,n,r){if(e.subarray&&i.subarray)i.set(e.subarray(t,t+n),r);else for(var s=0;s<n;s++)i[r+s]=e[t+s]}function DC(i,e,t,n){for(var r=65535&i,s=i>>>16&65535,o=0;t!==0;){t-=o=t>2e3?2e3:t;do s=s+(r=r+e[n++]|0)|0;while(--o);r%=65521,s%=65521}return r|s<<16}Zt.add("validation",class extends tH{constructor(i,e){super(i,e||{}),this.useDomParser=!0,this.validation=new Efe(this.name,this.path)}get __objName(){return"validation"}get isXml(){return!0}_parse(){super._parse(),pt&&tt.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),pt&&tt.timeEnd("ValidationParser._parse "+this.name)}});var Tfe=function(){for(var i,e=[],t=0;t<256;t++){i=t;for(var n=0;n<8;n++)i=1&i?3988292384^i>>>1:i>>>1;e[t]=i}return e}();function Xa(i,e,t,n){var r=Tfe,s=n+t;i^=-1;for(var o=n;o<s;o++)i=i>>>8^r[255&(i^e[o])];return~i}var Oy=30,Cfe=12;function Pfe(i,e){var t,n,r,s,o,a,l,c,u,h,d,f,m,_,v,g,b,p,y,A,w,M,T,E,C;t=i.state,n=i.next_in,E=i.input,r=n+(i.avail_in-5),s=i.next_out,C=i.output,o=s-(e-i.avail_out),a=s+(i.avail_out-257),l=t.dmax,c=t.wsize,u=t.whave,h=t.wnext,d=t.window,f=t.hold,m=t.bits,_=t.lencode,v=t.distcode,g=(1<<t.lenbits)-1,b=(1<<t.distbits)-1;e:do{m<15&&(f+=E[n++]<<m,m+=8,f+=E[n++]<<m,m+=8),p=_[f&g];t:for(;;){if(f>>>=y=p>>>24,m-=y,(y=p>>>16&255)===0)C[s++]=65535&p;else{if(!(16&y)){if(64&y){if(32&y){t.mode=Cfe;break e}i.msg="invalid literal/length code",t.mode=Oy;break e}p=_[(65535&p)+(f&(1<<y)-1)];continue t}for(A=65535&p,(y&=15)&&(m<y&&(f+=E[n++]<<m,m+=8),A+=f&(1<<y)-1,f>>>=y,m-=y),m<15&&(f+=E[n++]<<m,m+=8,f+=E[n++]<<m,m+=8),p=v[f&b];;){if(f>>>=y=p>>>24,m-=y,16&(y=p>>>16&255)){if(w=65535&p,m<(y&=15)&&(f+=E[n++]<<m,(m+=8)<y&&(f+=E[n++]<<m,m+=8)),(w+=f&(1<<y)-1)>l){i.msg="invalid distance too far back",t.mode=Oy;break e}if(f>>>=y,m-=y,w>(y=s-o)){if((y=w-y)>u&&t.sane){i.msg="invalid distance too far back",t.mode=Oy;break e}if(M=0,T=d,h===0){if(M+=c-y,y<A){A-=y;do C[s++]=d[M++];while(--y);M=s-w,T=C}}else if(h<y){if(M+=c+h-y,(y-=h)<A){A-=y;do C[s++]=d[M++];while(--y);if(M=0,h<A){A-=y=h;do C[s++]=d[M++];while(--y);M=s-w,T=C}}}else if(M+=h-y,y<A){A-=y;do C[s++]=d[M++];while(--y);M=s-w,T=C}for(;A>2;)C[s++]=T[M++],C[s++]=T[M++],C[s++]=T[M++],A-=3;A&&(C[s++]=T[M++],A>1&&(C[s++]=T[M++]))}else{M=s-w;do C[s++]=C[M++],C[s++]=C[M++],C[s++]=C[M++],A-=3;while(A>2);A&&(C[s++]=C[M++],A>1&&(C[s++]=C[M++]))}break}if(64&y){i.msg="invalid distance code",t.mode=Oy;break e}p=v[(65535&p)+(f&(1<<y)-1)]}}break}}while(n<r&&s<a);n-=A=m>>3,f&=(1<<(m-=A<<3))-1,i.next_in=n,i.next_out=s,i.avail_in=n<r?r-n+5:5-(n-r),i.avail_out=s<a?a-s+257:257-(s-a),t.hold=f,t.bits=m}var kf=15,nO=852,iO=592,rO=0,HA=1,sO=2,Rfe=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Ife=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Lfe=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Dfe=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function l0(i,e,t,n,r,s,o,a){var l,c,u,h,d,f,m,_,v,g=a.bits,b=0,p=0,y=0,A=0,w=0,M=0,T=0,E=0,C=0,N=0,P=null,L=0,R=new Uint16Array(kf+1),F=new Uint16Array(kf+1),V=null,z=0;for(b=0;b<=kf;b++)R[b]=0;for(p=0;p<n;p++)R[e[t+p]]++;for(w=g,A=kf;A>=1&&R[A]===0;A--);if(w>A&&(w=A),A===0)return r[s++]=20971520,r[s++]=20971520,a.bits=1,0;for(y=1;y<A&&R[y]===0;y++);for(w<y&&(w=y),E=1,b=1;b<=kf;b++)if(E<<=1,(E-=R[b])<0)return-1;if(E>0&&(i===rO||A!==1))return-1;for(F[1]=0,b=1;b<kf;b++)F[b+1]=F[b]+R[b];for(p=0;p<n;p++)e[t+p]!==0&&(o[F[e[t+p]]++]=p);if(i===rO?(P=V=o,f=19):i===HA?(P=Rfe,L-=257,V=Ife,z-=257,f=256):(P=Lfe,V=Dfe,f=-1),N=0,p=0,b=y,d=s,M=w,T=0,u=-1,h=(C=1<<w)-1,i===HA&&C>nO||i===sO&&C>iO)return 1;for(;;){m=b-T,o[p]<f?(_=0,v=o[p]):o[p]>f?(_=V[z+o[p]],v=P[L+o[p]]):(_=96,v=0),l=1<<b-T,y=c=1<<M;do r[d+(N>>T)+(c-=l)]=m<<24|_<<16|v;while(c!==0);for(l=1<<b-1;N&l;)l>>=1;if(l!==0?(N&=l-1,N+=l):N=0,p++,--R[b]==0){if(b===A)break;b=e[t+o[p]]}if(b>w&&(N&h)!==u){for(T===0&&(T=w),d+=y,E=1<<(M=b-T);M+T<A&&!((E-=R[M+T])<=0);)M++,E<<=1;if(C+=1<<M,i===HA&&C>nO||i===sO&&C>iO)return 1;r[u=N&h]=w<<24|M<<16|d-s}}return N!==0&&(r[d+N]=b-T<<24|64<<16),a.bits=w,0}var iH=1,rH=2,Xp=0,ul=-2,sH=1,Bl=12,di=30,Nfe=852,Ffe=592;function oO(i){return(i>>>24&255)+(i>>>8&65280)+((65280&i)<<8)+((255&i)<<24)}function kfe(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Ufe(i){var e;return i&&i.state?((e=i.state).wsize=0,e.whave=0,e.wnext=0,function(t){var n;return t&&t.state?(n=t.state,t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=1&n.wrap),n.mode=sH,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(Nfe),n.distcode=n.distdyn=new Int32Array(Ffe),n.sane=1,n.back=-1,Xp):ul}(i)):ul}function Ofe(i,e){var t,n;return i?(n=new kfe,i.state=n,n.window=null,t=function(r,s){var o,a;return r&&r.state?(a=r.state,s<0?(o=0,s=-s):(o=1+(s>>4),s<48&&(s&=15)),s&&(s<8||s>15)?ul:(a.window!==null&&a.wbits!==s&&(a.window=null),a.wrap=o,a.wbits=s,Ufe(r))):ul}(i,e),t!==Xp&&(i.state=null),t):ul}var $A,WA,aO=!0;function Bfe(i){if(aO){var e;for($A=new Int32Array(512),WA=new Int32Array(32),e=0;e<144;)i.lens[e++]=8;for(;e<256;)i.lens[e++]=9;for(;e<280;)i.lens[e++]=7;for(;e<288;)i.lens[e++]=8;for(l0(iH,i.lens,0,288,$A,0,i.work,{bits:9}),e=0;e<32;)i.lens[e++]=5;l0(rH,i.lens,0,32,WA,0,i.work,{bits:5}),aO=!1}i.lencode=$A,i.lenbits=9,i.distcode=WA,i.distbits=5}function oH(i,e,t,n){var r,s=i.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(wp(s.window,e,t-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((r=s.wsize-s.wnext)>n&&(r=n),wp(s.window,e,t-n,r,s.wnext),(n-=r)?(wp(s.window,e,t-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0}function zfe(i,e){var t,n,r,s,o,a,l,c,u,h,d,f,m,_,v,g,b,p,y,A,w,M,T,E,C=0,N=new Uint8Array(4),P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!i||!i.state||!i.output||!i.input&&i.avail_in!==0)return ul;(t=i.state).mode===Bl&&(t.mode=13),o=i.next_out,r=i.output,l=i.avail_out,s=i.next_in,n=i.input,a=i.avail_in,c=t.hold,u=t.bits,h=a,d=l,M=Xp;e:for(;;)switch(t.mode){case sH:if(t.wrap===0){t.mode=13;break}for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(2&t.wrap&&c===35615){t.check=0,N[0]=255&c,N[1]=c>>>8&255,t.check=Xa(t.check,N,2,0),c=0,u=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&c)<<8)+(c>>8))%31){i.msg="incorrect header check",t.mode=di;break}if((15&c)!=8){i.msg="unknown compression method",t.mode=di;break}if(u-=4,w=8+(15&(c>>>=4)),t.wbits===0)t.wbits=w;else if(w>t.wbits){i.msg="invalid window size",t.mode=di;break}t.dmax=1<<w,i.adler=t.check=1,t.mode=512&c?10:Bl,c=0,u=0;break;case 2:for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(t.flags=c,(255&t.flags)!=8){i.msg="unknown compression method",t.mode=di;break}if(57344&t.flags){i.msg="unknown header flags set",t.mode=di;break}t.head&&(t.head.text=c>>8&1),512&t.flags&&(N[0]=255&c,N[1]=c>>>8&255,t.check=Xa(t.check,N,2,0)),c=0,u=0,t.mode=3;case 3:for(;u<32;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.head&&(t.head.time=c),512&t.flags&&(N[0]=255&c,N[1]=c>>>8&255,N[2]=c>>>16&255,N[3]=c>>>24&255,t.check=Xa(t.check,N,4,0)),c=0,u=0,t.mode=4;case 4:for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.head&&(t.head.xflags=255&c,t.head.os=c>>8),512&t.flags&&(N[0]=255&c,N[1]=c>>>8&255,t.check=Xa(t.check,N,2,0)),c=0,u=0,t.mode=5;case 5:if(1024&t.flags){for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.length=c,t.head&&(t.head.extra_len=c),512&t.flags&&(N[0]=255&c,N[1]=c>>>8&255,t.check=Xa(t.check,N,2,0)),c=0,u=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((f=t.length)>a&&(f=a),f&&(t.head&&(w=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Array(t.head.extra_len)),wp(t.head.extra,n,s,f,w)),512&t.flags&&(t.check=Xa(t.check,n,f,s)),a-=f,s+=f,t.length-=f),t.length))break e;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(a===0)break e;f=0;do w=n[s+f++],t.head&&w&&t.length<65536&&(t.head.name+=String.fromCharCode(w));while(w&&f<a);if(512&t.flags&&(t.check=Xa(t.check,n,f,s)),a-=f,s+=f,w)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(a===0)break e;f=0;do w=n[s+f++],t.head&&w&&t.length<65536&&(t.head.comment+=String.fromCharCode(w));while(w&&f<a);if(512&t.flags&&(t.check=Xa(t.check,n,f,s)),a-=f,s+=f,w)break e}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;u<16;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(c!==(65535&t.check)){i.msg="header crc mismatch",t.mode=di;break}c=0,u=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),i.adler=t.check=0,t.mode=Bl;break;case 10:for(;u<32;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}i.adler=t.check=oO(c),c=0,u=0,t.mode=11;case 11:if(t.havedict===0)return i.next_out=o,i.avail_out=l,i.next_in=s,i.avail_in=a,t.hold=c,t.bits=u,2;i.adler=t.check=1,t.mode=Bl;case Bl:case 13:if(t.last){c>>>=7&u,u-=7&u,t.mode=27;break}for(;u<3;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}switch(t.last=1&c,u-=1,3&(c>>>=1)){case 0:t.mode=14;break;case 1:Bfe(t),t.mode=20;break;case 2:t.mode=17;break;case 3:i.msg="invalid block type",t.mode=di}c>>>=2,u-=2;break;case 14:for(c>>>=7&u,u-=7&u;u<32;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if((65535&c)!=(c>>>16^65535)){i.msg="invalid stored block lengths",t.mode=di;break}t.length=65535&c,c=0,u=0,t.mode=15;case 15:t.mode=16;case 16:if(f=t.length){if(f>a&&(f=a),f>l&&(f=l),f===0)break e;wp(r,n,s,f,o),a-=f,s+=f,l-=f,o+=f,t.length-=f;break}t.mode=Bl;break;case 17:for(;u<14;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(t.nlen=257+(31&c),c>>>=5,u-=5,t.ndist=1+(31&c),c>>>=5,u-=5,t.ncode=4+(15&c),c>>>=4,u-=4,t.nlen>286||t.ndist>30){i.msg="too many length or distance symbols",t.mode=di;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;u<3;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.lens[P[t.have++]]=7&c,c>>>=3,u-=3}for(;t.have<19;)t.lens[P[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,T={bits:t.lenbits},M=l0(0,t.lens,0,19,t.lencode,0,t.work,T),t.lenbits=T.bits,M){i.msg="invalid code lengths set",t.mode=di;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;g=(C=t.lencode[c&(1<<t.lenbits)-1])>>>16&255,b=65535&C,!((v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(b<16)c>>>=v,u-=v,t.lens[t.have++]=b;else{if(b===16){for(E=v+2;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(c>>>=v,u-=v,t.have===0){i.msg="invalid bit length repeat",t.mode=di;break}w=t.lens[t.have-1],f=3+(3&c),c>>>=2,u-=2}else if(b===17){for(E=v+3;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}u-=v,w=0,f=3+(7&(c>>>=v)),c>>>=3,u-=3}else{for(E=v+7;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}u-=v,w=0,f=11+(127&(c>>>=v)),c>>>=7,u-=7}if(t.have+f>t.nlen+t.ndist){i.msg="invalid bit length repeat",t.mode=di;break}for(;f--;)t.lens[t.have++]=w}}if(t.mode===di)break;if(t.lens[256]===0){i.msg="invalid code -- missing end-of-block",t.mode=di;break}if(t.lenbits=9,T={bits:t.lenbits},M=l0(iH,t.lens,0,t.nlen,t.lencode,0,t.work,T),t.lenbits=T.bits,M){i.msg="invalid literal/lengths set",t.mode=di;break}if(t.distbits=6,t.distcode=t.distdyn,T={bits:t.distbits},M=l0(rH,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,T),t.distbits=T.bits,M){i.msg="invalid distances set",t.mode=di;break}t.mode=20;case 20:t.mode=21;case 21:if(a>=6&&l>=258){i.next_out=o,i.avail_out=l,i.next_in=s,i.avail_in=a,t.hold=c,t.bits=u,Pfe(i,d),o=i.next_out,r=i.output,l=i.avail_out,s=i.next_in,n=i.input,a=i.avail_in,c=t.hold,u=t.bits,t.mode===Bl&&(t.back=-1);break}for(t.back=0;g=(C=t.lencode[c&(1<<t.lenbits)-1])>>>16&255,b=65535&C,!((v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(g&&!(240&g)){for(p=v,y=g,A=b;g=(C=t.lencode[A+((c&(1<<p+y)-1)>>p)])>>>16&255,b=65535&C,!(p+(v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}c>>>=p,u-=p,t.back+=p}if(c>>>=v,u-=v,t.back+=v,t.length=b,g===0){t.mode=26;break}if(32&g){t.back=-1,t.mode=Bl;break}if(64&g){i.msg="invalid literal/length code",t.mode=di;break}t.extra=15&g,t.mode=22;case 22:if(t.extra){for(E=t.extra;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.length+=c&(1<<t.extra)-1,c>>>=t.extra,u-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;g=(C=t.distcode[c&(1<<t.distbits)-1])>>>16&255,b=65535&C,!((v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(!(240&g)){for(p=v,y=g,A=b;g=(C=t.distcode[A+((c&(1<<p+y)-1)>>p)])>>>16&255,b=65535&C,!(p+(v=C>>>24)<=u);){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}c>>>=p,u-=p,t.back+=p}if(c>>>=v,u-=v,t.back+=v,64&g){i.msg="invalid distance code",t.mode=di;break}t.offset=b,t.extra=15&g,t.mode=24;case 24:if(t.extra){for(E=t.extra;u<E;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}t.offset+=c&(1<<t.extra)-1,c>>>=t.extra,u-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){i.msg="invalid distance too far back",t.mode=di;break}t.mode=25;case 25:if(l===0)break e;if(f=d-l,t.offset>f){if((f=t.offset-f)>t.whave&&t.sane){i.msg="invalid distance too far back",t.mode=di;break}f>t.wnext?(f-=t.wnext,m=t.wsize-f):m=t.wnext-f,f>t.length&&(f=t.length),_=t.window}else _=r,m=o-t.offset,f=t.length;f>l&&(f=l),l-=f,t.length-=f;do r[o++]=_[m++];while(--f);t.length===0&&(t.mode=21);break;case 26:if(l===0)break e;r[o++]=t.length,l--,t.mode=21;break;case 27:if(t.wrap){for(;u<32;){if(a===0)break e;a--,c|=n[s++]<<u,u+=8}if(d-=l,i.total_out+=d,t.total+=d,d&&(i.adler=t.check=t.flags?Xa(t.check,r,d,o-d):DC(t.check,r,d,o-d)),d=l,(t.flags?c:oO(c))!==t.check){i.msg="incorrect data check",t.mode=di;break}c=0,u=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;u<32;){if(a===0)break e;a--,c+=n[s++]<<u,u+=8}if(c!==(4294967295&t.total)){i.msg="incorrect length check",t.mode=di;break}c=0,u=0}t.mode=29;case 29:M=1;break e;case di:M=-3;break e;case 31:return-4;default:return ul}return i.next_out=o,i.avail_out=l,i.next_in=s,i.avail_in=a,t.hold=c,t.bits=u,(t.wsize||d!==i.avail_out&&t.mode<di&&(t.mode<27||e!==4))&&oH(i,i.output,i.next_out,d-i.avail_out),h-=i.avail_in,d-=i.avail_out,i.total_in+=h,i.total_out+=d,t.total+=d,t.wrap&&d&&(i.adler=t.check=t.flags?Xa(t.check,r,d,i.next_out-d):DC(t.check,r,d,i.next_out-d)),i.data_type=t.bits+(t.last?64:0)+(t.mode===Bl?128:0)+(t.mode===20||t.mode===15?256:0),(h===0&&d===0||e===4)&&M===Xp&&(M=-5),M}function Gfe(i,e){var t,n=e.length;return i&&i.state?(t=i.state).wrap!==0&&t.mode!==11?ul:t.mode===11&&DC(1,e,n,0)!==t.check?-3:oH(i,e,n,n)?(t.mode=31,-4):(t.havedict=1,Xp):ul}var aH=!0,lH=!0;try{String.fromCharCode.apply(null,[0])}catch{aH=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{lH=!1}for(var r1=new Uint8Array(256),Wc=0;Wc<256;Wc++)r1[Wc]=Wc>=252?6:Wc>=248?5:Wc>=240?4:Wc>=224?3:Wc>=192?2:1;function Vfe(i){var e,t,n,r,s,o=i.length,a=0;for(r=0;r<o;r++)(64512&(t=i.charCodeAt(r)))==55296&&r+1<o&&(64512&(n=i.charCodeAt(r+1)))==56320&&(t=65536+(t-55296<<10)+(n-56320),r++),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),s=0,r=0;s<a;r++)(64512&(t=i.charCodeAt(r)))==55296&&r+1<o&&(64512&(n=i.charCodeAt(r+1)))==56320&&(t=65536+(t-55296<<10)+(n-56320),r++),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|63&t):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|63&t):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|63&t);return e}function Hfe(i,e){var t,n,r,s,o=e||i.length,a=new Array(2*o);for(n=0,t=0;t<o;)if((r=i[t++])<128)a[n++]=r;else if((s=r1[r])>4)a[n++]=65533,t+=s-1;else{for(r&=s===2?31:s===3?15:7;s>1&&t<o;)r=r<<6|63&i[t++],s--;s>1?a[n++]=65533:r<65536?a[n++]=r:(r-=65536,a[n++]=55296|r>>10&1023,a[n++]=56320|1023&r)}return function(l,c){if(c<65537&&(l.subarray&&lH||!l.subarray&&aH))return String.fromCharCode.apply(null,nH(l,c));for(var u="",h=0;h<c;h++)u+=String.fromCharCode(l[h]);return u}(a,n)}function $fe(i,e){var t;for((e=e||i.length)>i.length&&(e=i.length),t=e-1;t>=0&&(192&i[t])==128;)t--;return t<0||t===0?e:t+r1[i[t]]>e?t:e}r1[254]=r1[254]=1;var zf=0,Wfe={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function jfe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Xfe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var lO=Object.prototype.toString;function cp(i){if(!(this instanceof cp))return new cp(i);this.options=function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var c in l)l.hasOwnProperty(c)&&(o[c]=l[c])}}return o}({chunkSize:16384,windowBits:0,to:""},i||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||i&&i.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new jfe,this.strm.avail_out=0;var t,n,r,s=Ofe(this.strm,e.windowBits);if(s!==zf)throw new Error(Wfe[s]);this.header=new Xfe,t=this.strm,n=this.header,t&&t.state&&2&(r=t.state).wrap&&(r.head=n,n.done=!1)}cp.prototype.push=function(i,e){var t,n,r,s,o,a,l=this.strm,c=this.options.chunkSize,u=this.options.dictionary,h=!1;if(this.ended)return!1;n=e===~~e?e:e===!0?4:0,typeof i=="string"?l.input=function(d){for(var f=new Uint8Array(d.length),m=0,_=f.length;m<_;m++)f[m]=d.charCodeAt(m);return f}(i):lO.call(i)==="[object ArrayBuffer]"?l.input=new Uint8Array(i):l.input=i,l.next_in=0,l.avail_in=l.input.length;do{if(l.avail_out===0&&(l.output=new Uint8Array(c),l.next_out=0,l.avail_out=c),(t=zfe(l,0))===2&&u&&(a=typeof u=="string"?Vfe(u):lO.call(u)==="[object ArrayBuffer]"?new Uint8Array(u):u,t=Gfe(this.strm,a)),t===-5&&h===!0&&(t=zf,h=!1),t!==1&&t!==zf)return this.onEnd(t),this.ended=!0,!1;l.next_out&&(l.avail_out!==0&&t!==1&&(l.avail_in!==0||n!==4&&n!==2)||(this.options.to==="string"?(r=$fe(l.output,l.next_out),s=l.next_out-r,o=Hfe(l.output,r),l.next_out=s,l.avail_out=c-s,s&&wp(l.output,l.output,r,s,0),this.onData(o)):this.onData(nH(l.output,l.next_out)))),l.avail_in===0&&l.avail_out===0&&(h=!0)}while((l.avail_in>0||l.avail_out===0)&&t!==1);return t===1&&(n=4),n===4?(t=function(d){if(!d||!d.state)return ul;var f=d.state;return f.window&&(f.window=null),d.state=null,Xp}(this.strm),this.onEnd(t),this.ended=!0,t===zf):n!==2||(this.onEnd(zf),l.avail_out=0,!0)},cp.prototype.onData=function(i){this.chunks.push(i)},cp.prototype.onEnd=function(i){i===zf&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=function(e){var t,n,r,s,o,a;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(a=new Uint8Array(r),s=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,s),s+=o.length;return a}(this.chunks)),this.chunks=[],this.err=i,this.msg=this.strm.msg},OR.add("gz",function(i){let e;i instanceof ArrayBuffer&&(i=new Uint8Array(i));try{e=function(t,n){var r=new cp(n);if(r.push(t,!0),r.err)throw r.msg;return r.result}(i)}catch{e=i}return e});class N1{}const cO="https:";vu.add("rcsb",new class extends N1{getUrl(i){const e=Ks(i),t=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);return!["pdb","cif"].includes(e.ext)||e.compressed!==!1&&e.compressed!=="gz"?(e.ext==="mmtf"&&(tt.warn(`MMTF files distribution has been discontinued by RCSB PDB as of July 2024.
 Defaulting to bcif format instead. See https://www.rcsb.org/news/65a1af31c76ca3abcc925d0c for the deprecation notice`),e.base.endsWith(".bb")&&tt.warn("Backbone only files are not available from RCSB PDB anymore."),e.ext=""),e.ext?tt.warn("unsupported ext",e.ext):tt.warn(`mmCif files available from RCSB PDB lack connectivity information.
 Consider using PDBe as the data provider for using "Updated mmCif files" that contain residues connectivity records.`),cO+"//models.rcsb.org/"+t+".bcif.gz"):cO+"//files.rcsb.org/download/"+e.path}getExt(i){return Ks(i).ext||"bcif"}});const _g="//www.ebi.ac.uk/pdbe/entry-files/download/";vu.add("pdbe",new class extends N1{getUrl(i){const e=Ks(i);let t,n=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);switch(e.ext){case"cif":t=_g+n+"_updated.cif";break;case"pdb":case"ent":n.startsWith("pdb")||(n="pdb"+n),t=_g+n+".ent";break;case"bcif":t=_g+e.path;break;case"":t=_g+n+".bcif";break;default:tt.warn("unsupported ext",e.ext),t=_g+n+".bcif"}return"https://"+t}getExt(i){return Ks(i).ext||"bcif"}});const uO="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",hO="/SDF?record_type=3d";vu.add("pubchem",new class extends N1{getUrl(i){const e=Ks(i),t=e.name;let n;return e.ext&&e.ext!=="sdf"&&tt.warn("unsupported ext",e.ext),n=uO+t+hO,function(){const r=window.location.protocol;return r.match(/http(s)?:/gi)===null?"http:":r}()+n}getExt(i){return Ks(i).ext||"sdf"}});class jA extends N1{getUrl(e){return e}getExt(e){return Ks(e).ext}}vu.add("ftp",new jA),vu.add("http",new jA),vu.add("https",new jA);const dO="//alphafold.ebi.ac.uk/files/AF-",fO="-F1-model_v4.pdb";vu.add("alphafold",new class extends N1{getUrl(i){const e=Ks(i),t=e.name;let n;return e.ext&&e.ext!=="pdb"&&tt.warn("unsupported AF ext",e.ext),n=dO+t+fO,"https://"+n}getExt(i){return Ks(i).ext||"pdb"}});function yg(...i){return{type:"select",options:i.reduce((e,t)=>Object.assign(Object.assign({},e),{[t]:t}),{})}}yg("auto","low","medium","high"),yg("scene","camera"),yg("relative","absolute"),yg("perspective","orthographic","stereo"),yg(...Object.keys(aV));function qfe(i){if(i.startsWith("rcsb://")||i.startsWith("pdb://"))return i.split("//")[1].toUpperCase();const e=i.match(/\/(\w{4})\.(pdb|cif)$/i);return e?e[1].toUpperCase():null}const Yfe=({cifUrl:i})=>{const e=Ge.useRef(null),t=Ge.useRef(null),[n,r]=Ge.useState(!0),[s,o]=Ge.useState(null),[a,l]=Ge.useState(!1);return Ge.useEffect(()=>{const c=window.location.search.includes("vr=true")||document.querySelector('canvas[data-engine="three.js"]')!==null;l(c)},[]),Ge.useEffect(()=>{if(!e.current)return;r(!0),o(null);const c=new MV(e.current,{backgroundColor:a?"transparent":"white",quality:"high",impostor:!0});t.current=c;const u=()=>{c.handleResize()};if(window.addEventListener("resize",u),i){console.log("Loading structure from URL:",i);const h=qfe(i);(async()=>{try{let d;if(h){try{if(console.log(`Loading PDB ID ${h} using rcsb:// protocol`),d=await c.loadFile(`rcsb://${h}`,{defaultRepresentation:!1}),d.addRepresentation("cartoon",{colorScheme:"chainname",quality:a?"high":"medium",aspectRatio:2,smoothSheet:!0}),d.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric",quality:a?"high":"medium"}),c.autoView(),a){c.viewerControls.zoom(.8);const f=d.structure?d.structure.center:new Ce(0,0,0);c.viewerControls.center(f)}r(!1);return}catch(f){console.warn("Failed to load with rcsb protocol:",f)}try{if(console.log(`Loading PDB ID ${h} using pdb:// protocol`),d=await c.loadFile(`pdb://${h}`,{defaultRepresentation:!1}),d.addRepresentation("cartoon",{colorScheme:"chainname",quality:a?"high":"medium",aspectRatio:2}),d.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),c.autoView(),a){c.viewerControls.zoom(.8);const f=d.structure?d.structure.center:new Ce(0,0,0);c.viewerControls.center(f)}r(!1);return}catch(f){console.warn("Failed to load with pdb protocol:",f)}}try{if(console.log("Loading structure directly from URL:",i),d=await c.loadFile(i,{defaultRepresentation:!1}),d.addRepresentation("cartoon",{colorScheme:"chainname",quality:a?"high":"medium",aspectRatio:2}),d.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),c.autoView(),a){c.viewerControls.zoom(.8);const f=d.structure?d.structure.center:new Ce(0,0,0);c.viewerControls.center(f)}r(!1);return}catch(f){console.warn("Direct URL loading failed:",f)}if(console.log("Loading fallback example structure (1CRN)"),d=await c.loadFile("rcsb://1CRN",{defaultRepresentation:!1}),d.addRepresentation("cartoon",{colorScheme:"chainname",quality:a?"high":"medium",aspectRatio:2}),d.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),c.autoView(),a){c.viewerControls.zoom(.8);const f=d.structure?d.structure.center:new Ce(0,0,0);c.viewerControls.center(f)}r(!1),o("Using example protein (1CRN) for demonstration. The requested protein could not be loaded.")}catch(d){console.error("All loading attempts failed:",d),o("Failed to load any protein structure. Please check your network connection or try a different PDB ID."),r(!1)}})()}return()=>{window.removeEventListener("resize",u),t.current&&(t.current.dispose(),t.current=null)}},[i,a]),we.jsxs("div",{className:"relative w-full h-full rounded-lg overflow-hidden border-2 border-sky-500/30",children:[n&&we.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-70 z-10",children:we.jsxs("div",{className:"text-white text-center",children:[we.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-sky-500 mx-auto mb-4"}),we.jsx("p",{children:"Loading protein structure..."})]})}),s&&we.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-70 z-10",children:we.jsxs("div",{className:"text-white text-center max-w-md p-4",children:[we.jsx("div",{className:"text-red-500 text-3xl mb-2",children:"⚠️"}),we.jsx("h3",{className:"text-xl font-bold mb-2",children:"Error"}),we.jsx("p",{children:s}),we.jsx("p",{className:"mt-4 text-sm text-gray-400",children:"Try a different protein or check the URL format"})]})}),we.jsx("div",{ref:e,className:"w-full h-full"})]})};function Kfe(i){if(i.startsWith("rcsb://")||i.startsWith("pdb://"))return i.split("//")[1].toUpperCase();const e=i.match(/\/(\w{4})\.(pdb|cif)$/i);return e?e[1].toUpperCase():null}function Zfe({cifUrl:i,position:e=[0,0,0],rotation:t=[0,0,0],scale:n=1,interactive:r=!0}){const s=Ge.useRef(null),o=Ge.useRef(null),a=Ge.useRef(null),l=Ge.useRef(null),[c,u]=Ge.useState(!0),[h,d]=Ge.useState(null),[f,m]=Ge.useState(!1),[_,v]=Ge.useState(!1),[g,b]=Ge.useState(t),[p,y]=Ge.useState(n),A=Ge.useCallback(()=>{v(Q=>!Q)},[]),w=Ge.useRef(r),M=Ge.useRef(.005),T=Ge.useRef(t),E=Ge.useCallback(()=>{s.current&&s.current.rotation.set(T.current[0],T.current[1],T.current[2])},[]);Ge.useEffect(()=>{if(!a.current){const Q=document.createElement("canvas");Q.width=1024,Q.height=1024,Q.style.display="none",document.body.appendChild(Q),a.current=Q;const le=new u6(Q);le.needsUpdate=!0,o.current=le}return()=>{a.current&&(document.body.removeChild(a.current),a.current=null)}},[]),Ge.useEffect(()=>{if(!a.current)return;u(!0),d(null);const Q=new MV(a.current,{backgroundColor:"transparent",quality:"high",impostor:!0});if(l.current=Q,i){console.log("Loading structure from URL:",i);const le=Kfe(i);(async()=>{try{let se;if(le){try{console.log(`Loading PDB ID ${le} using rcsb:// protocol`),se=await Q.loadFile(`rcsb://${le}`,{defaultRepresentation:!1}),se.addRepresentation("cartoon",{colorScheme:"chainname",quality:"high",aspectRatio:2,smoothSheet:!0}),se.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric",quality:"high"}),Q.autoView(),u(!1);return}catch(oe){console.warn("Failed to load with rcsb protocol:",oe)}try{console.log(`Loading PDB ID ${le} using pdb:// protocol`),se=await Q.loadFile(`pdb://${le}`,{defaultRepresentation:!1}),se.addRepresentation("cartoon",{colorScheme:"chainname",quality:"high",aspectRatio:2}),se.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),Q.autoView(),u(!1);return}catch(oe){console.warn("Failed to load with pdb protocol:",oe)}}try{console.log("Loading structure directly from URL:",i),se=await Q.loadFile(i,{defaultRepresentation:!1}),se.addRepresentation("cartoon",{colorScheme:"chainname",quality:"high",aspectRatio:2}),se.addRepresentation("ball+stick",{sele:"hetero and not water",multipleBond:"symmetric"}),Q.autoView(),u(!1);return}catch(oe){console.warn("Direct URL loading failed:",oe)}console.log("Loading fallback example structure (1CRN)"),se=await Q.loadFile("rcsb://1CRN",{defaultRepresentation:!1}),se.addRepresentation("cartoon",{colorScheme:"chainname"}),se.addRepresentation("ball+stick",{sele:"hetero and not water"}),l.current.autoView(),console.log("Protein loaded successfully"),u(!1),m(!0),d("Using example protein (1CRN) for demonstration.")}catch(se){console.error("All loading attempts failed:",se),d("Failed to load any protein structure."),u(!1)}})()}return()=>{l.current&&(l.current.dispose(),l.current=null)}},[i]),Ia(()=>{o.current&&!c&&l.current&&(l.current.viewer.requestRender(),o.current.needsUpdate=!0)}),Ia((Q,le)=>{r&&w.current&&s.current&&b(se=>[se[0],se[1]+M.current,se[2]])});const C=ON("right"),N=ON("left"),[P,L]=Ge.useState(!1),[R,F]=Ge.useState(!1),[V,z]=Ge.useState(!1),U=Ge.useRef(null);Ge.useEffect(()=>{if(C){const Q=()=>{L(!0),w.current=!w.current,console.log("Auto-rotation toggled via right controller:",w.current),z(!0),U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{z(!1)},500)},le=()=>{L(!1)};return C.controller.addEventListener("selectstart",Q),C.controller.addEventListener("selectend",le),()=>{C.controller.removeEventListener("selectstart",Q),C.controller.removeEventListener("selectend",le),U.current&&clearTimeout(U.current)}}},[C]);const[G,B]=Ge.useState(!1),D=Ge.useRef(null);Ge.useEffect(()=>{if(N){const Q=()=>{F(!0),B(!0),D.current&&clearTimeout(D.current)},le=()=>{F(!1),D.current=setTimeout(()=>{B(!1)},500)};return N.controller.addEventListener("selectstart",Q),N.controller.addEventListener("selectend",le),()=>{N.controller.removeEventListener("selectstart",Q),N.controller.removeEventListener("selectend",le),D.current&&clearTimeout(D.current)}}},[N]),Ia(()=>{var Q;if(N&&R){const le=(Q=N.inputSource)==null?void 0:Q.gamepad;if(le&&le.axes.length>=2){const se=le.axes[1];M.current=.001+(1-se)*.01,console.log("Rotation speed adjusted:",M.current)}}});const O=Ge.useMemo(()=>window.location.search.includes("debug=true"),[]),j=({position:Q})=>we.jsx(Tee,{args:[.5,.5,.5],position:Q,visible:!0,"material-wireframe":!0,"material-color":"#ff0000","material-transparent":!0,"material-opacity":.5}),q=()=>{const{scene:Q,raycaster:le,camera:se,gl:oe}=Qi(),$=Ge.useRef(null),[pe,xe]=Ge.useState(!1),Pe=ve=>{if(!$.current)return;const Ue=new xt;Ue.x=ve.clientX/oe.domElement.clientWidth*2-1,Ue.y=-(ve.clientY/oe.domElement.clientHeight)*2+1,le.setFromCamera(Ue,se),le.intersectObject($.current,!0).length>0&&(w.current=!w.current,console.log("Auto-rotation toggled via click:",w.current))};return Ge.useEffect(()=>(oe.domElement.addEventListener("click",Pe),()=>{oe.domElement.removeEventListener("click",Pe)}),[oe.domElement,se,le]),Ge.useEffect(()=>{if(!$.current){const ve=new Kl;ve.position.set(e[0],e[1],e[2]),ve.rotation.set(g[0],g[1],g[2]),ve.scale.set(p,p,p),Q.add(ve),$.current=ve,s.current=ve}return()=>{$.current&&(Q.remove($.current),$.current=null)}},[Q]),Ge.useEffect(()=>{$.current&&($.current.rotation.set(g[0],g[1],g[2]),$.current.scale.set(p,p,p))},[g,p]),Ge.useEffect(()=>{if(l.current&&!c&&!h&&$.current&&!pe){console.log("Initializing direct NGL to Three.js integration");const ve=l.current.viewer;if(!ve||!ve.renderer||!ve.renderer.domElement){console.error("NGL viewer or renderer not available");return}try{const Le=l.current.compList;if(!Le||Le.length===0){console.error("No components found in NGL stage");return}console.log("NGL components found:",Le.length),O&&Le.forEach((Z,J)=>{console.log(`Component ${J} details:`,{name:Z.name,structureType:Z.structure?Z.structure.type:"unknown",atomCount:Z.structure?Z.structure.atomCount:0,reprCount:Z.reprList?Z.reprList.length:0})}),Le.forEach((Z,J)=>{const de=Z.reprList;console.log(`Component ${J} has ${de.length} representations`),de.forEach((Ie,te)=>{const X=Ie.bufferList;console.log(`Representation ${te} has ${X.length} buffers`),X.forEach((ye,ke)=>{try{if(ye.geometry)try{const ge=new xn;if(ye.geometry.attributes.position)try{const Ae=ye.geometry.attributes.position.array;if(Ae&&Ae.length>0)ge.setAttribute("position",new En(new Float32Array(Ae),3));else{console.warn("Position attribute has invalid or empty array");return}}catch(Ae){console.error("Error copying position attribute:",Ae);return}else{console.warn("Buffer geometry missing position attribute");return}if(ye.geometry.attributes.normal)try{const Ae=ye.geometry.attributes.normal.array;Ae&&Ae.length>0&&ge.setAttribute("normal",new En(new Float32Array(Ae),3))}catch(Ae){console.warn("Error copying normal attribute:",Ae)}if(ye.geometry.attributes.color)try{const Ae=ye.geometry.attributes.color.array;Ae&&Ae.length>0&&ge.setAttribute("color",new En(new Float32Array(Ae),3))}catch(Ae){console.warn("Error copying color attribute:",Ae)}if(ye.geometry.index)try{const Ae=ye.geometry.index.array;if(Ae&&Ae.length>0){const Ze=Array.from(Ae).map(Number);Math.max(...Ze)>65535?ge.setIndex(new En(new Uint32Array(Ae),1)):ge.setIndex(new En(new Uint16Array(Ae),1))}}catch(Ae){console.warn("Error copying index attribute:",Ae)}ye.geometry.attributes.normal||ge.computeVertexNormals(),ge.computeBoundingSphere(),ge.computeBoundingBox();let De;if(ye.geometry.attributes.color)De=new eb({vertexColors:!0,metalness:.1,roughness:.7,clearcoat:.2,clearcoatRoughness:.3,envMapIntensity:.5,side:ts});else{let Ae;try{Ae=Ie.getParameters().color||new kt(3447003)}catch(Ze){console.warn("Error getting representation color:",Ze),Ae=new kt(3447003)}De=new eb({color:Ae,metalness:.1,roughness:.7,clearcoat:.2,clearcoatRoughness:.3,envMapIntensity:.5,side:ts})}const $e=new gi(ge,De);$e.name=`protein-${J}-${te}-${ke}`,$e.userData.isProteinPart=!0,$e.userData.reprType=Ie.name,$e.castShadow=!0,$e.receiveShadow=!0,$.current&&($.current.add($e),console.log(`Added protein mesh ${$e.name} to group`)),window.location.search.includes("debug=true")&&console.log(`Mesh ${$e.name} details:`,{vertexCount:ge.attributes.position.count,triangleCount:ge.index?ge.index.count/3:ge.attributes.position.count/3,hasNormals:!!ge.attributes.normal,hasColors:!!ge.attributes.color,isIndexed:!!ge.index})}catch(ge){console.error(`Error creating mesh for buffer ${ke}:`,ge)}}catch(ge){console.error(`Error processing buffer ${ke}:`,ge)}})})}),xe(!0),console.log("Direct NGL integration complete")}catch(Ue){console.error("Error during direct NGL integration:",Ue)}}},[Q,c,h,pe]),null},Y=()=>{const{scene:Q}=Qi();return Ge.useEffect(()=>{if(!s.current){const le=new gd(5,5),se=o.current?new qo({map:o.current,transparent:!0,side:ts}):new qo({color:"white",transparent:!0,opacity:.5}),oe=new gi(le,se);oe.position.set(e[0],e[1],e[2]),oe.rotation.set(g[0],g[1],g[2]),oe.scale.set(p,p,p),Q.add(oe),s.current=oe}return()=>{s.current&&(Q.remove(s.current),s.current.geometry&&s.current.geometry.dispose(),s.current.material instanceof Or?s.current.material.dispose():Array.isArray(s.current.material)&&s.current.material.forEach(le=>le.dispose()),s.current=null)}},[Q]),Ge.useEffect(()=>{s.current&&o.current&&s.current.material instanceof qo&&(s.current.material.map=o.current,s.current.material.needsUpdate=!0)},[o.current]),Ge.useEffect(()=>{s.current&&(s.current.rotation.set(g[0],g[1],g[2]),s.current.scale.set(p,p,p))},[g,p]),null},[ie,ne]=Ge.useState(w.current);return Ge.useEffect(()=>{const Q=setInterval(()=>{ie!==w.current&&ne(w.current)},100);return()=>clearInterval(Q)},[ie]),we.jsxs(we.Fragment,{children:[we.jsx(q,{}),!f&&we.jsx(Y,{}),O&&!c&&!h&&s.current&&we.jsx(we.Fragment,{children:we.jsx(j,{position:e})}),!c&&!h&&we.jsx(Yc,{position:[e[0]+.5,e[1]+1.5,e[2]],transform:!0,children:we.jsx("button",{onClick:A,style:{color:"white",backgroundColor:"rgba(0,0,255,0.7)",padding:"5px",borderRadius:"50%",width:"30px",height:"30px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",border:"none",cursor:"pointer",boxShadow:"0 0 5px rgba(255,255,255,0.5)",transition:"transform 0.2s ease-in-out"},onMouseOver:Q=>Q.currentTarget.style.transform="scale(1.1)",onMouseOut:Q=>Q.currentTarget.style.transform="scale(1)",children:"?"})}),!c&&!h&&we.jsx(Yc,{position:[e[0],e[1]+1.5,e[2]],transform:!0,children:we.jsx("div",{style:{color:"white",backgroundColor:w.current?"rgba(0,128,0,0.7)":"rgba(128,0,0,0.7)",padding:"5px",borderRadius:"50%",width:"20px",height:"20px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",boxShadow:V?"0 0 15px 5px rgba(255,255,255,0.8)":"none",transition:"box-shadow 0.2s ease-in-out"},children:w.current?"⟳":"⏹"})}),!c&&!h&&G&&we.jsx(Yc,{position:[e[0]-.5,e[1]+1.5,e[2]],transform:!0,children:we.jsx("div",{style:{color:"white",backgroundColor:"rgba(0,0,255,0.7)",padding:"5px",borderRadius:"50%",width:"20px",height:"20px",textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",boxShadow:"0 0 15px 5px rgba(0,128,255,0.8)",animation:"pulse 1s infinite"},children:"↕"})}),c&&we.jsx(Yc,{position:[e[0],e[1],e[2]+.1],transform:!0,children:we.jsx("div",{style:{color:"white",backgroundColor:"rgba(0,0,0,0.7)",padding:"10px",borderRadius:"5px",width:"200px",textAlign:"center"},children:"Loading protein data..."})}),h&&we.jsx(Yc,{position:[e[0],e[1],e[2]+.1],transform:!0,children:we.jsxs("div",{style:{color:"white",backgroundColor:"rgba(255,0,0,0.7)",padding:"10px",borderRadius:"5px",width:"200px",textAlign:"center"},children:["Error: ",h]})}),_&&!c&&!h&&we.jsx(Yc,{position:[e[0],e[1]-2,e[2]],transform:!0,children:we.jsxs("div",{style:{color:"white",backgroundColor:"rgba(0,0,0,0.7)",padding:"10px",borderRadius:"5px",width:"200px",textAlign:"center"},children:[we.jsx("h3",{style:{margin:"0 0 10px 0",fontSize:"16px"},children:"Protein Controls"}),we.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"10px"},children:[we.jsx("button",{onClick:()=>{w.current=!w.current,ne(w.current)},style:{backgroundColor:w.current?"#4CAF50":"#f44336",color:"white",padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",flex:"1"},children:w.current?"Stop":"Start"}),we.jsx("button",{onClick:E,style:{backgroundColor:"#2196F3",color:"white",padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",flex:"1"},children:"Reset"})]}),we.jsxs("div",{style:{marginTop:"10px"},children:[we.jsx("label",{style:{marginRight:"10px"},children:"Speed:"}),we.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[we.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",defaultValue:M.current,onChange:Q=>M.current=parseFloat(Q.target.value),style:{width:"120px"}}),we.jsx("div",{style:{marginLeft:"10px",width:"30px",height:"20px",backgroundColor:"rgba(255,255,255,0.2)",borderRadius:"3px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px"},children:Math.round(M.current*1e3)})]})]}),we.jsxs("div",{style:{marginTop:"15px",fontSize:"12px",color:"#aaa"},children:[we.jsx("p",{style:{margin:"5px 0"},children:"Right controller trigger: Toggle rotation"}),we.jsx("p",{style:{margin:"5px 0"},children:"Left controller trigger + move: Adjust speed"})]})]})})]})}function Qfe(){const{scene:i}=Qi(),e=Ge.useRef([]);return Ge.useEffect(()=>{const t=new fR(16777215,.5),n=new dR(16777215,1);return n.position.set(10,10,10),i.add(t),i.add(n),e.current=[t,n],()=>{e.current.forEach(r=>{i.remove(r)}),e.current=[]}},[i]),null}const Jfe=({onClose:i})=>{const[e,t]=Ge.useState(""),[n,r]=Ge.useState([]),[s,o]=Ge.useState(null),[a,l]=Ge.useState(!1),[c,u]=Ge.useState(null),[h,d]=Ge.useState(""),f=async()=>{if(e.trim()){l(!0),u(null),r([]);try{const p=await fetch("https://search.rcsb.org/rcsbsearch/v2/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:{type:"terminal",service:"text",parameters:{value:e}},return_type:"entry"})});if(!p.ok)throw new Error(`API request failed with status ${p.status}`);const y=await p.json();if(console.log("PDB search results:",y),!y.result_set||y.result_set.length===0){u("No results found for your query."),l(!1);return}const A=await Promise.all(y.result_set.slice(0,10).map(async w=>{var T,E,C;const M=w.identifier;if(!M)return console.error("Could not extract PDB ID from result item:",w),null;try{const N=await fetch(`https://data.rcsb.org/rest/v1/core/entry/${M}`);if(!N.ok)throw new Error(`Failed to get details for ${M}: ${N.status}`);const P=await N.json();return{identifier:M,title:((T=P.struct)==null?void 0:T.title)||`PDB ID: ${M}`,organism:((E=P.entity)==null?void 0:E.length)>0&&((C=P.entity[0].src)==null?void 0:C.length)>0?P.entity[0].src[0].organism_scientific:void 0}}catch(N){return console.warn(`Failed to get details for ${M}:`,N),{identifier:M,title:`PDB ID: ${M}`}}}).filter(Boolean));r(A)}catch(p){console.error("PDB search failed:",p),u(p instanceof Error?p.message:"An unknown error occurred.")}finally{l(!1)}}},m=p=>{const A=`rcsb://${p.identifier.trim().toUpperCase()}`;console.log("Loading PDB with protocol:",A),o({name:p.title,url:A})},_=async()=>{if(!h.trim())return;l(!0),u(null);const p=h.trim().toUpperCase();try{const y=await fetch(`https://data.rcsb.org/rest/v1/core/entry/${p}`);if(!y.ok){y.status===404?u(`PDB ID ${p} not found. Please check the ID and try again.`):u(`Error checking PDB ID: ${y.status}`),l(!1);return}const A=`rcsb://${p}`;console.log("Loading direct PDB with protocol:",A),o({name:`PDB ID: ${p}`,url:A}),l(!1)}catch(y){console.error("Error loading PDB ID:",y),u(`Failed to load PDB ID: ${y instanceof Error?y.message:"Unknown error"}`),l(!1)}},v=()=>{o(null),r([]),t(""),u(null)},[g,b]=Ge.useState("2d");return s?we.jsx(Up,{title:s.name,breadcrumbs:["Home","Visualise","Viewer"],onClose:i,children:we.jsxs("div",{className:"w-full h-full flex flex-col items-center p-0 space-y-4",children:[we.jsxs("div",{className:"absolute top-4 left-4 z-10 flex space-x-2",children:[we.jsx(ba,{onClick:v,variant:"secondary",className:"!text-sm !px-3 !py-1",children:"New Search"}),we.jsx(ba,{onClick:()=>b(g==="2d"?"vr":"2d"),variant:g==="vr"?"primary":"secondary",className:"!text-sm !px-3 !py-1",children:g==="2d"?"VR Mode":"2D Mode"})]}),g==="2d"?we.jsx(Yfe,{cifUrl:s.url}):we.jsxs("div",{className:"w-full h-full",children:[we.jsx(I8,{className:"absolute top-4 right-4 z-10"}),we.jsx("div",{className:"absolute top-4 left-4 z-10 flex gap-2",children:we.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:()=>{const p=document.getElementById("vr-controls");p&&(p.style.display=p.style.display==="none"?"block":"none")},children:"Controls"})}),we.jsxs("div",{id:"vr-controls",className:"absolute bottom-4 left-4 z-10 bg-black bg-opacity-70 p-4 rounded text-white",style:{display:"block"},children:[we.jsx("h3",{className:"font-bold mb-2",children:"VR Controls"}),we.jsxs("ul",{className:"list-disc pl-5",children:[we.jsx("li",{children:"Auto-rotation is enabled by default"}),we.jsx("li",{children:"Use the slider to adjust rotation speed"}),we.jsx("li",{children:"Click the protein to toggle rotation on/off"}),we.jsx("li",{children:"Use the Reset button to return to initial position"}),we.jsx("li",{children:"Click the ? button to show/hide controls"}),we.jsx("li",{className:"mt-2 font-bold",children:"VR Controller Actions:"}),we.jsx("li",{children:"Right controller trigger: Toggle auto-rotation"}),we.jsx("li",{children:"Left controller trigger + move: Adjust rotation speed"})]})]}),we.jsx(A8,{className:"w-full h-full",children:we.jsxs(C8,{children:[we.jsx(Qfe,{}),we.jsx(Zfe,{cifUrl:s.url,position:[0,1.5,-2],scale:.5,interactive:!0})]})})]})]})}):we.jsx(Up,{title:"Add Entity",breadcrumbs:["Home","Visualise"],onClose:i,children:we.jsxs("div",{className:"w-full max-w-3xl flex flex-col items-center p-4 space-y-4",children:[we.jsx("h3",{className:"text-xl text-sky-200",children:"Search Protein Data Bank"}),we.jsxs("div",{className:"relative w-full max-w-md flex space-x-2",children:[we.jsx(BT,{placeholder:"Search by protein name (e.g., hemoglobin)...",className:"flex-grow",value:e,onChange:p=>t(p.target.value),onKeyDown:p=>p.key==="Enter"&&f()}),we.jsx(ba,{onClick:f,disabled:a,children:a?"...":we.jsx(AJ,{className:"w-5 h-5"})})]}),we.jsxs("div",{className:"w-full h-64 mt-2 bg-slate-900/50 rounded-lg flex flex-col p-2 overflow-y-auto",children:[a&&we.jsx("p",{className:"text-slate-400 m-auto",children:"Searching..."}),c&&we.jsx("p",{className:"text-red-400 m-auto",children:c}),!a&&!c&&n.length>0&&we.jsx("ul",{className:"space-y-2",children:n.map(p=>we.jsxs("li",{className:"flex justify-between items-center p-2 rounded-md bg-slate-800 hover:bg-sky-900/50 transition-colors",children:[we.jsxs("div",{className:"flex-grow mr-4 overflow-hidden",children:[we.jsx("p",{className:"font-semibold text-white truncate",title:p.title,children:p.title}),p.organism&&we.jsxs("p",{className:"text-sm text-slate-400 truncate",children:[p.organism," (",p.identifier,")"]}),!p.organism&&we.jsxs("p",{className:"text-sm text-slate-400 truncate",children:["PDB ID: ",p.identifier]})]}),we.jsx(ba,{onClick:()=>m(p),size:"sm",children:"Load"})]},p.identifier))}),!a&&!c&&n.length===0&&we.jsx("p",{className:"text-slate-500 m-auto",children:"Search results will appear here."})]}),we.jsxs("div",{className:"flex items-center space-x-2 w-full max-w-md pt-2",children:[we.jsx("hr",{className:"w-full border-slate-600"}),we.jsx("span",{className:"text-slate-400",children:"OR"}),we.jsx("hr",{className:"w-full border-slate-600"})]}),we.jsxs("div",{className:"flex items-center space-x-4",children:[we.jsx(BT,{placeholder:"Enter PDB ID (e.g., 1AKE)",value:h,onChange:p=>d(p.target.value),onKeyDown:p=>p.key==="Enter"&&_()}),we.jsx(ba,{onClick:_,children:"Load"})]})]})})},epe=({onClose:i,distance:e,setDistance:t,yOffset:n,setYOffset:r})=>we.jsx(Up,{title:"Settings",breadcrumbs:["Home","Settings"],onClose:i,children:we.jsxs("div",{className:"w-full max-w-md flex flex-col items-center space-y-8 p-4",children:[we.jsxs("div",{className:"w-full",children:[we.jsxs("label",{htmlFor:"distance-slider",className:"text-xl text-slate-200 block text-center mb-2",children:["Page Distance: ",we.jsx("span",{className:"font-bold text-sky-400 tabular-nums",children:e.toFixed(1)})]}),we.jsx("input",{id:"distance-slider",type:"range",min:"2",max:"8",step:"0.1",value:e,onChange:s=>t(parseFloat(s.target.value)),className:"w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer range-lg [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:h-6 [&::-webkit-slider-thumb]:bg-sky-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:transition-all [&::-webkit-slider-thumb]:hover:bg-sky-400"}),we.jsx("p",{className:"text-sm text-slate-400 text-center mt-2",children:"Adjust how far the UI panels appear from your viewpoint."})]}),we.jsxs("div",{className:"w-full",children:[we.jsxs("label",{htmlFor:"y-offset-slider",className:"text-xl text-slate-200 block text-center mb-2",children:["Vertical Offset: ",we.jsx("span",{className:"font-bold text-sky-400 tabular-nums",children:n.toFixed(1)})]}),we.jsx("input",{id:"y-offset-slider",type:"range",min:"-1.5",max:"1.5",step:"0.1",value:n,onChange:s=>r(parseFloat(s.target.value)),className:"w-full h-3 bg-slate-700 rounded-lg appearance-none cursor-pointer range-lg [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-6 [&::-webkit-slider-thumb]:h-6 [&::-webkit-slider-thumb]:bg-sky-500 [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:transition-all [&::-webkit-slider-thumb]:hover:bg-sky-400"}),we.jsx("p",{className:"text-sm text-slate-400 text-center mt-2",children:"Adjust the vertical position of the UI panels."})]})]})}),gs=({children:i})=>we.jsx("code",{className:"px-2 py-1 bg-slate-700 text-sky-300 rounded-md font-mono text-base",children:i}),tpe=({onClose:i})=>we.jsx(Up,{title:"Help & Instructions",breadcrumbs:["Home","Help"],onClose:i,children:we.jsxs("div",{className:"w-full h-full flex flex-col md:flex-row gap-8 p-4 text-slate-200",children:[we.jsxs("div",{className:"flex-1 bg-slate-800/50 p-6 rounded-lg",children:[we.jsx("h2",{className:"text-2xl font-bold text-white mb-4 border-b-2 border-sky-500/50 pb-2",children:"Desktop Controls"}),we.jsxs("ul",{className:"space-y-4 text-lg",children:[we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Move"}),we.jsxs("div",{className:"flex gap-2",children:[we.jsx(gs,{children:"W"}),we.jsx(gs,{children:"A"}),we.jsx(gs,{children:"S"}),we.jsx(gs,{children:"D"})]})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Look Around"}),we.jsx(gs,{children:"Click / T"})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Open/Close Menu"}),we.jsx(gs,{children:"M"})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Go Back / Exit UI"}),we.jsx(gs,{children:"Esc"})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Select Menu Item"}),we.jsx(gs,{children:"Enter"})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Adjust UI Distance"}),we.jsxs("div",{className:"flex gap-2",children:[we.jsx(gs,{children:"Numpad 4"}),we.jsx(gs,{children:"Numpad 6"})]})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Adjust UI Height"}),we.jsxs("div",{className:"flex gap-2",children:[we.jsx(gs,{children:"Numpad 2"}),we.jsx(gs,{children:"Numpad 8"})]})]})]})]}),we.jsxs("div",{className:"flex-1 bg-slate-800/50 p-6 rounded-lg",children:[we.jsx("h2",{className:"text-2xl font-bold text-white mb-4 border-b-2 border-sky-500/50 pb-2",children:"VR Controls"}),we.jsxs("ul",{className:"space-y-4 text-lg",children:[we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Move"}),we.jsx(gs,{children:"Left Stick"})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Look Around"}),we.jsx("span",{className:"text-slate-300",children:"Move Your Head"})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Open/Close Menu"}),we.jsx(gs,{children:"Left 'Y' Button"})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Go Back / Exit UI"}),we.jsx(gs,{children:"Right 'B' Button"})]}),we.jsxs("li",{className:"flex items-center justify-between",children:[we.jsx("span",{children:"Select Menu Item"}),we.jsx("span",{className:"text-slate-300",children:"Point & Trigger"})]})]})]})]})}),XA=4.8,pO=6,npe=({content:i,onClose:e,pageDistance:t,setPageDistance:n,pageYOffset:r,setPageYOffset:s})=>{const{camera:o}=Qi(),a=Ge.useRef(null);Ia(()=>{if(a.current){const c=t,u=o.position.clone().add(o.getWorldDirection(new Ce).multiplyScalar(c)),h=XA/2,d=Math.max(u.y,h+.2);u.y=d+r,a.current.position.lerp(u,.1),a.current.quaternion.slerp(o.quaternion,.1)}});let l;switch(i.id){case"visualise":l=we.jsx(Jfe,{onClose:e});break;case"host-join":l=we.jsx(Hee,{onClose:e});break;case"assessments":l=we.jsx(Gee,{title:"Assessments",message:"Quizzes And Extra Related Content",onClose:e});break;case"settings":l=we.jsx(epe,{onClose:e,distance:t,setDistance:n,yOffset:r,setYOffset:s});break;case"help":l=we.jsx(tpe,{onClose:e});break;default:l=we.jsxs("div",{className:"text-white",children:[we.jsx("h1",{className:"text-2xl",children:"Unknown Page"}),we.jsx("button",{onClick:e,className:"mt-4 px-4 py-2 bg-sky-500 rounded",children:"Close"})]})}return we.jsxs("group",{ref:a,children:[we.jsxs("mesh",{children:[we.jsx("planeGeometry",{args:[pO,XA]}),we.jsx("meshStandardMaterial",{color:"#111827",side:ts,transparent:!0,opacity:0})]}),we.jsx(Yc,{transform:!0,occlude:!0,position:[0,0,.01],scale:.1,className:"bg-transparent text-white antialiased",style:{width:`${pO*10}rem`,height:`${XA*10}rem`},children:we.jsx("div",{className:"w-full h-full select-none",children:l})})]})},ipe=({onMenuToggle:i,onBack:e,onMenuSelect:t})=>{const{controllers:n,isPresenting:r,player:s}=is(),o=Ge.useRef(!1),a=Ge.useRef(!1),l=Ge.useRef(!1);return Ge.useEffect(()=>{r&&console.log("VR mode active - controller mappings loaded")},[r]),Ia(()=>{var h,d,f,m,_,v,g;if(!r||n.length===0)return;const c=n.find(b=>b.handedness==="left"),u=n.find(b=>b.handedness==="right");if((h=c==null?void 0:c.inputSource)!=null&&h.gamepad){const b=c.inputSource.gamepad.buttons;for(let p=0;p<b.length;p++)(d=b[p])!=null&&d.pressed&&console.log(`Left controller button ${p} pressed`)}if((f=u==null?void 0:u.inputSource)!=null&&f.gamepad){const b=u.inputSource.gamepad.buttons;for(let p=0;p<b.length;p++)(m=b[p])!=null&&m.pressed&&console.log(`Right controller button ${p} pressed`)}if((_=c==null?void 0:c.inputSource)!=null&&_.gamepad){const b=c.inputSource.gamepad.buttons[4];b!=null&&b.pressed&&!o.current&&(console.log("Menu button pressed"),i()),o.current=(b==null?void 0:b.pressed)||!1}if((v=u==null?void 0:u.inputSource)!=null&&v.gamepad){const b=u.inputSource.gamepad.buttons[1];b!=null&&b.pressed&&!a.current&&(console.log("Back button pressed"),e()),a.current=(b==null?void 0:b.pressed)||!1}if((g=u==null?void 0:u.inputSource)!=null&&g.gamepad&&t){const b=u.inputSource.gamepad.buttons[0];b!=null&&b.pressed&&!l.current&&(console.log("Select button pressed"),t()),l.current=(b==null?void 0:b.pressed)||!1}}),null};function rpe(){const[i,e]=Ge.useState(xi.START),[t,n]=Ge.useState(null),[r,s]=Ge.useState(!1),[o,a]=Ge.useState(4),[l,c]=Ge.useState(0),u=Ge.useCallback(()=>{e(xi.EXPLORING)},[]),h=Ge.useCallback(()=>{i===xi.EXPLORING?e(xi.MENU):i===xi.MENU&&e(xi.EXPLORING)},[i]),d=Ge.useCallback(v=>{n(v),e(xi.PAGE_VIEW)},[]),f=Ge.useCallback(()=>{n(null),e(xi.EXPLORING)},[]),m=Ge.useCallback(v=>{s(v)},[]),_=Ge.useCallback(()=>{i===xi.PAGE_VIEW?f():i===xi.MENU&&e(xi.EXPLORING)},[i,f]);return Ge.useEffect(()=>{const v=g=>{g.key.toLowerCase()==="m"&&h(),g.key==="Escape"&&_();const b=.1,p=.1,y=8,A=2,w=1.5,M=-1.5;switch(g.code){case"Numpad8":c(T=>Math.min(w,T+p));break;case"Numpad2":c(T=>Math.max(M,T-p));break;case"Numpad6":a(T=>Math.min(y,T+b));break;case"Numpad4":a(T=>Math.max(A,T-b));break}};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[i,_,h]),we.jsxs("div",{className:"w-screen h-screen bg-black",children:[i===xi.START&&we.jsxs("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-black bg-opacity-70 text-white",children:[we.jsx("h1",{className:"text-5xl font-bold mb-4",children:"Fold VR"}),we.jsxs("p",{className:"text-lg mb-8 text-center leading-relaxed",children:[we.jsx("span",{className:"font-bold",children:"Desktop:"})," Use WASD to move. Press 'M' to open the menu. Click to begin.",we.jsx("br",{}),we.jsx("span",{className:"font-bold",children:"VR:"})," Use left stick to move. Press 'Y' button for menu."]}),we.jsx("button",{onClick:u,className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-lg font-semibold transition-colors",children:"Start Exploring"})]}),i===xi.EXPLORING&&!r&&we.jsxs("div",{className:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-black bg-opacity-50 text-white pointer-events-none",children:[we.jsx("h2",{className:"text-4xl font-bold animate-pulse",children:"Click or Press 'T' to Look"}),we.jsx("p",{className:"text-lg mt-2",children:"Use WASD to move, 'M' for menu, 'Esc' to release control"}),we.jsx("p",{className:"text-sm mt-4 text-slate-300",children:"(In VR, you can look around freely)"})]}),we.jsx(I8,{}),we.jsx(A8,{shadows:!0,camera:{fov:75,position:[0,1.6,5]},children:we.jsxs(C8,{children:[we.jsx(ipe,{onMenuToggle:h,onBack:_,onMenuSelect:i===xi.MENU?d.bind(null,bh[0]):void 0}),we.jsx(CJ,{}),we.jsx(Pee,{gameState:i,isLocked:r,onPointerLockChange:m}),i===xi.MENU&&we.jsx(zee,{onSelectPage:d,pageYOffset:l}),i===xi.PAGE_VIEW&&t&&we.jsx(npe,{content:t,onClose:f,pageDistance:o,setPageDistance:a,pageYOffset:l,setPageYOffset:c})]})})]})}const cH=document.getElementById("root");if(!cH)throw new Error("Could not find root element to mount to");const spe=qA.createRoot(cH);spe.render(we.jsx(t$.StrictMode,{children:we.jsx(rpe,{})}));
